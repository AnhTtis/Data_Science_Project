\subsection{Qualitative evaluation}

We show in Figure~\ref{fig:visu_super} our prototypes and how they are deformed to reconstruct a given input. For each class of the SA dataset, we show an input time series that has been correctly assigned to its corresponding prototype by our model trained with supervision but without $\mathcal{L}_\text{cont}$. We see that the inputs are best reconstructed by a prototype of their class. Looking at any of the columns, we see that prototypes of other classes can also be deformed to reconstruct a given input, but only to a certain extent. This confirms that the transformations considered are simple enough so that the reconstruction power of each prototype is limited, but powerful enough to allow the prototypes to adapt to their input. 

Figure~\ref{fig:visu_unsup} shows the 32 prototypes learned by our unsupervised model on SA, grouped by assigned label. For each prototype, we show an example input sample whose best reconstruction is obtained using this particular prototype and the obtained corresponding reconstruction. We see that prototypes are not equally assigned to classes, with class \textit{Canola} having 14 prototypes when class \textit{Small Grain Gazing} only has 1. This is due to the high imbalance of the classes in the datasets and different intra-class variabilities. Inside a class, different prototypes account for intra-class variability beyond what our deformations can model. 

\begin{table*}[t]
    \centering
    %\scriptsize
    \begin{tabular*}{\linewidth}{@{}ll@{\hskip 11pt}@{\extracolsep{\fill}}*{12}{c}@{}}
        \toprule
        & & \multicolumn{6}{c}{Supervised} & \multicolumn{6}{c}{Unsupervised}\\
        \cmidrule(lr){3-8}\cmidrule(lr){9-14}
        & & \multicolumn{3}{c}{Val} & \multicolumn{3}{c}{Test}  & \multicolumn{3}{c}{Train}  & \multicolumn{3}{c}{Test}\\ \cmidrule(lr){3-5}\cmidrule(lr){6-8}\cmidrule(lr){9-11}\cmidrule(lr){12-14}
        & & {\color{ACC}OA$\uparrow$} & MA$\uparrow$ & {\color{ACC}$\lrec\downarrow$} & {\color{ACC}OA$\uparrow$} & MA$\uparrow$ & {\color{ACC}$\lrec\downarrow$} & {\color{ACC}OA$\uparrow$} & MA$\uparrow$ & {\color{ACC}$\lrec\downarrow$} & {\color{ACC}OA$\uparrow$} & MA$\uparrow$ & {\color{ACC}$\lrec\downarrow$} \\
        \midrule
        \parbox[t]{2.3mm}{\multirow{4}{*}{\rotatebox[origin=c]{90}{PASTIS}}} & Raw prototypes
        & {\color{ACC}$57.3$} & $50.0$ & {\color{ACC}$4.43$} & {\color{ACC}$56.5$} & $48.4$ & {\color{ACC}$4.46$} & {\color{ACC}$69.1$} & $29.8$ & {\color{ACC}$2.77$} & {\color{ACC}$69.0$} & $29.8$ & {\color{ACC}$2.78$}\\
        & ~~$+$~time warping    
        & {\color{ACC}$56.8$} & $53.7$ & {\color{ACC}$4.00$} & {\color{ACC}$56.2$} & $51.4$ & {\color{ACC}$4.04$} & {\color{ACC}$\mathbf{69.2}$} & $\mathbf{30.4}$ & {\color{ACC}$2.53$} & {\color{ACC}$\mathbf{69.1}$} & $\mathbf{30.4}$ & {\color{ACC}$2.53$}\\
        & ~~~~$+$~offset    
        & {\color{ACC}$55.0$} & $55.7$ & {\color{ACC}$\mathbf{2.57}$} & {\color{ACC}$53.5$} & $53.8$ & {\color{ACC}$\mathbf{2.65}$} & {\color{ACC}$67.8$} & $28.5$ & {\color{ACC}$\mathbf{1.91}$} & {\color{ACC}$67.7$} & $28.6$ & {\color{ACC}$\mathbf{1.91}$}\\
	    & ~~~~~~$+$~$\mathcal{L}_\text{cont}$  
	    & {\color{ACC}$\mathbf{74.8}$} & $\mathbf{61.3}$ & {\color{ACC}$2.90$} & {\color{ACC}$\mathbf{73.7}$} & $\mathbf{59.1}$ & {\color{ACC}$3.00$} & {\color{ACC}---} & --- & {\color{ACC}---} & {\color{ACC}---} & --- & {\color{ACC}---}\\
	    \midrule
        \parbox[t]{2.3mm}{\multirow{4}{*}{\rotatebox[origin=c]{90}{TS2C}}} & Raw prototypes 
        & {\color{ACC}$57.4$} & $51.2$ & {\color{ACC}$4.89$} & {\color{ACC}$57.4$} & $49.5$ & {\color{ACC}$4.36$} & {\color{ACC}$56.2$} & $34.2$ & {\color{ACC}$3.52$} & {\color{ACC}$49.5$} & $32.5$ & {\color{ACC}$3.56$}\\
        & ~~$+$~time warping    
        & {\color{ACC}$56.0$} & $51.2$ & {\color{ACC}$4.64$} & {\color{ACC}$59.9$} & $52.3$ & {\color{ACC}$4.15$} & {\color{ACC}$59.1$} & $38.6$ & {\color{ACC}$3.04$} & {\color{ACC}$\mathbf{52.3}$} & $\mathbf{36.0}$ & {\color{ACC}$3.09$}\\
        & ~~~~$+$~offset    
        & {\color{ACC}$56.9$} & $51.8$ & {\color{ACC}$3.50$} & {\color{ACC}$57.3$} & $55.0$ & {\color{ACC}$3.49$} & {\color{ACC}$\mathbf{60.0}$} & $\mathbf{39.3}$ & {\color{ACC}$\mathbf{2.40}$} & {\color{ACC}$52.0$} & $35.5$ & {\color{ACC}$\mathbf{2.53}$}\\
	    & ~~~~~~$+$~$\mathcal{L}_\text{cont}$  
	    & {\color{ACC}$\mathbf{74.5}$} & $\mathbf{64.4}$ & {\color{ACC}$\mathbf{3.46}$} & {\color{ACC}$\mathbf{78.5}$} & $\mathbf{70.5}$ & {\color{ACC}$\mathbf{3.46}$} & {\color{ACC}---} & --- & {\color{ACC}---} & {\color{ACC}---} & --- & {\color{ACC}---}\\
	    \midrule
        \parbox[t]{2.3mm}{\multirow{4}{*}{\rotatebox[origin=c]{90}{SA}}} & Raw prototypes
        \tableABLline{54.8}{50.0}{3.43}{51.3}{46.4}{4.62}\tableABLline{60.9}{50.9}{1.43}{61.9}{47.8}{1.85}\\
        & ~~$+$~time warping    
        \tableABLline{57.5}{53.9}{2.93}{54.5}{49.7}{4.13}\tableABLline{62.2}{53.1}{1.03}{\mathbf{64.1}}{\mathbf{51.7}}{1.46}\\
        & ~~~~$+$~offset    
        \tableABLline{63.5}{58.0}{\mathbf{1.34}}{60.6}{50.0}{\mathbf{2.01}}\tableABLline{\mathbf{63.7}}{\mathbf{54.5}}{\mathbf{0.67}}{63.6}{50.4}{\mathbf{0.91}}\\
	    & ~~~~~~$+$~$\mathcal{L}_\text{cont}$  
	    \tableABLline{\mathbf{71.0}}{\mathbf{64.7}}{1.89}{\mathbf{62.3}}{\mathbf{54.9}}{2.66} & {\color{ACC}---} & --- & {\color{ACC}---} & {\color{ACC}---} & --- & {\color{ACC}---}\\
        \midrule
        \midrule
        \parbox[t]{2.3mm}{\multirow{4}{*}{\rotatebox[origin=c]{90}{DENETHOR}}} & Raw prototypes
        & {\color{ACC}$68.3$} & $58.0$ & {\color{ACC}$3.89$} & {\color{ACC}$61.3$} & $55.5$ & {\color{ACC}$4.58$} & {\color{ACC}$63.8$} & $52.8$ & {\color{ACC}$2.67$} & {\color{ACC}$57.2$} & $48.5$ & {\color{ACC}$2.41$}\\
        & ~~$+$~time warping 
        \tableABLline{70.1}{59.5}{3.52}{\mathbf{62.4}}{56.4}{4.21}\tableABLline{64.8}{54.0}{2.23}{57.6}{51.1}{2.01}\\
        & ~~~~$+$~offset    
        \tableABLline{77.3}{64.9}{\mathbf{2.39}}{59.8}{\mathbf{62.9}}{\mathbf{3.55}}\tableABLline{\mathbf{66.2}}{\mathbf{56.3}}{\mathbf{1.70}}{\mathbf{58.5}}{\mathbf{52.6}}{\mathbf{1.56}}\\
	    & ~~~~~~$+$~$\mathcal{L}_\text{cont}$  
	    \tableABLline{\mathbf{85.1}}{\mathbf{75.5}}{3.00}{56.5}{54.2}{4.35} & {\color{ACC}---} & --- & {\color{ACC}---} & {\color{ACC}---} & --- & {\color{ACC}---}\\
        \bottomrule
    \end{tabular*}
    \caption{\textbf{Detailed evaluation of our method.}~We show the impact of the increasing complexity of our modeling for reconstruction and accuracy on all datasets in both the supervised and unsupervised settings. Note that learning raw prototypes boils down to the NCC method~\cite{cover1967nearest} in the supervised setting and to the K-means algorithm~\cite{macqueen1967classification}  in the unsupervised setting.}
    \label{tab:super_ablation}
    \vspace{-1em}
\end{table*}


\begin{figure*}[t]
    \centering
\setlength{\tabcolsep}{2pt}
\renewcommand{\arraystretch}{1}
\begin{tabular}{@{}cc|ccccc@{}}
    & & \multicolumn{5}{c}{\bf Inputs} \\
    & & Wheat & Barley & Lucerne / Medics & Canola & Small Grain Gazing\\
    & & \showinput{0} &
    \showinput{1} &
    \showinput{2} &
    \showinput{3} &
    \showinput{4}
    \\\midrule
    \multirow{10}{*}{\rotatebox{90}{\bf Prototypes~~~~~~~~~~~~~~~~~~~~~~}}
    & \showproto{0} &
    \boxspect{images/recons/recons_input_0_with_proto_0.pdf}{Kselect} &
    \boxspect{images/recons/recons_input_1_with_proto_0.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_2_with_proto_0.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_3_with_proto_0.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_4_with_proto_0.pdf}{Knotselect}
    \presep\\
    & Wheat & 
    $\lrec=0.134$ &
    $\lrec=0.494$ &
    $\lrec=0.609$ &
    $\lrec=0.575$ &
    $\lrec=0.542$
    \postsep\\
    & \showproto{1} &
    \boxspect{images/recons/recons_input_0_with_proto_1.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_1_with_proto_1.pdf}{Kselect} &
    \boxspect{images/recons/recons_input_2_with_proto_1.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_3_with_proto_1.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_4_with_proto_1.pdf}{Knotselect}
    \presep\\
    & Barley & 
    $\lrec=0.145$ &
    $\lrec=0.456$ &
    $\lrec=0.568$ &
    $\lrec=0.685$ &
    $\lrec=0.589$
    \postsep\\
    & \showproto{2} &
    \boxspect{images/recons/recons_input_0_with_proto_2.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_1_with_proto_2.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_2_with_proto_2.pdf}{Kselect} &
    \boxspect{images/recons/recons_input_3_with_proto_2.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_4_with_proto_2.pdf}{Knotselect}
    \presep\\
    & Lucerne / Medics & 
    $\lrec=0.388$ &
    $\lrec=0.578$ &
    $\lrec=0.501$ &
    $\lrec=0.666$ &
    $\lrec=0.704$
    \postsep\\
    & \showproto{3} &
    \boxspect{images/recons/recons_input_0_with_proto_3.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_1_with_proto_3.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_2_with_proto_3.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_3_with_proto_3.pdf}{Kselect} &
    \boxspect{images/recons/recons_input_4_with_proto_3.pdf}{Knotselect}
    \presep\\
    & Canola & 
    $\lrec=0.302$ &
    $\lrec=0.960$ &
    $\lrec=0.822$ &
    $\lrec=0.249$ &
    $\lrec=0.852$
    \postsep\\
    & \showproto{4} &
    \boxspect{images/recons/recons_input_0_with_proto_4.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_1_with_proto_4.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_2_with_proto_4.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_3_with_proto_4.pdf}{Knotselect} &
    \boxspect{images/recons/recons_input_4_with_proto_4.pdf}{Kselect}
    \presep\\
    & Small Grain Gazing & 
    $\lrec=0.153$ &
    $\lrec=0.510$ &
    $\lrec=0.563$ &
    $\lrec=0.478$ &
    $\lrec=0.537$
\end{tabular}
\vspace{-.5em}
    \caption{
    \textbf{Reconstructions from different prototypes.}~{We show the reconstructions of input samples (columns) from SA~\cite{kondmann2022early} by learned prototypes (lines) in the supervised setting without $\mathcal{L}_\text{cont}$. Selected prototypes (frames) correspond to the lowest reconstruction error.}}
    \label{fig:visu_super}
\end{figure*}

