% ****** Start of file apssamp.tex ******
%
%   This file is part of the APS files in the REVTeX 4.2 distribution.
%   Version 4.2a of REVTeX, December 2014
%
%   Copyright (c) 2014 The American Physical Society.
%
%   See the REVTeX 4 README file for restrictions and more information.
%
% TeX'ing this file requires that you have AMS-LaTeX 2.0 installed
% as well as the rest of the prerequisites for REVTeX 4.2
%
% See the REVTeX 4 README file
% It also requires running BibTeX. The commands are as follows:
%
%  1)  latex apssamp.tex
%  2)  bibtex apssamp
%  3)  latex apssamp.tex
%  4)  latex apssamp.tex
%
\documentclass[%
 reprint,
superscriptaddress,
%groupedaddress,
%unsortedaddress,
%runinaddress,
%frontmatterverbose, 
%preprint,
%preprintnumbers,
%nofootinbib,
%nobibnotes,
%bibnotes,
 amsmath,amssymb,
 aps,twocolumn,
 pra,
%pra,
%prb,
%rmp,
%prstab,
%prstper,
%floatfix,
]{revtex4-2}


\usepackage{graphicx}% Include figure files
\usepackage{bm}% bold math
\usepackage[hypertexnames=false]{hyperref}% add hypertext capabilities
\usepackage[capitalise]{cleveref}

%\usepackage[mathlines]{lineno}% Enable numbering of text and display math
%\linenumbers\relax % Commence numbering lines
\usepackage{braket}
%\usepackage[showframe,%Uncomment any one of the following lines to test 
%%scale=0.7, marginratio={1:1, 2:3}, ignoreall,% default settings
%%text={7in,10in},centering,
%%margin=1.5in,
%%total={6.5in,8.75in}, top=1.2in, left=0.9in, includefoot,
%%height=10in,a5paper,hmargin={3cm,0.8in},
%]{geometry}


\newcommand{\sigmah}{\hat{\sigma}}
\newcommand{\ah}{\hat{a}}
\newcommand{\hc}{\mathrm{h.c.}}

%%%%%%%%%
%%%%%%%%%
%%%%%%%%
\usepackage{physics} % Used in methods relating to LMG
\usepackage{enumerate}
\usepackage{dsfont}

\newcommand{\eff}{\mathrm{eff}}
\newcommand{\emax}{\eta_{\mathrm{max}}}
\renewcommand{\H}{\mathcal{H}}



\begin{document}

% Use the \preprint command to place your local institutional report
% number in the upper righthand corner of the title page in preprint mode.
% Multiple \preprint commands are allowed.
% Use the 'preprintnumbers' class option to override journal defaults
% to display numbers if necessary
%\preprint{}

%Title of paper
\title{Non-Local Multi-Qubit Quantum Gates via a Driven Cavity} 


% repeat the \author .. \affiliation  etc. as needed
% \email, \thanks, \homepage, \altaffiliation all apply to the current
% author. Explanatory text should go in the []'s, actual e-mail
% address or url should go in the {}'s for \email and \homepage.
% Please use the appropriate macro foreach each type of information

% \affiliation command applies to all authors since the last
% \affiliation command. The \affiliation command should follow the
% other information
% \affiliation can be followed by \email, \homepage, \thanks as well.
\author{Sven Jandura}
%\email[]{Your e-mail address}
%\homepage[]{Your web page}
%\thanks{}
%\altaffiliation{}
\affiliation{University of Strasbourg and CNRS, CESQ and ISIS (UMR 7006), aQCess, 67000 Strasbourg, France}


\author{Vineesha Srivastava}
%\email[]{Your e-mail address}
%\homepage[]{Your web page}
%\thanks{}
%\altaffiliation{}
\affiliation{University of Strasbourg and CNRS, CESQ and ISIS (UMR 7006), aQCess, 67000 Strasbourg, France}

\author{Gavin Brennen}
\affiliation{Center for Engineered Quantum Systems, Dept. of Physics \& Astronomy, Macquarie University, 2109 NSW, Australia}

\author{Guido Pupillo}
\affiliation{University of Strasbourg and CNRS, CESQ and ISIS (UMR 7006), aQCess, 67000 Strasbourg, France}


%Collaboration name if desired (requires use of superscriptaddress
%option in \documentclass). \noaffiliation is required (may also be
%used with the \author command).
%\collaboration can be followed by \email, \homepage, \thanks as well.
%\collaboration{}
%\noaffiliation

\date{\today}

\begin{abstract}

We present two protocols for implementing deterministic non-local multi-qubit quantum gates on qubits coupled to a common cavity mode. The protocols rely only on a classical drive of the cavity modes, while no external drive of the qubits is required. In the first protocol,  the state of the cavity follows a closed trajectory in phase space and accumulates a geometric phase depending on the state of the qubits. The second protocol uses an adiabatic evolution of the combined qubit-cavity system to accumulate a dynamical phase. Repeated applications of this protocol allow for the realization of phase
gates with arbitrary phases, e.g. phase-rotation gates and multi-controlled-Z gates.  For both protocols, we provide analytic solutions for the error rates, which scale as $\sim N/\sqrt{C}$, with $C$ the cooperativity and $N$ the qubit number. Our protocols are applicable to a variety of systems and can be generalized by replacing the cavity by a different bosonic mode, such as a phononic mode. We provide estimates of gate fidelities and durations for atomic and molecular qubits coupled to optical or microwave cavities, and suggest applications for quantum error correction.
\end{abstract}

% insert suggested keywords - APS authors don't need to do this
%\keywords{}

%\maketitle must follow title, authors, abstract, and keywords
\maketitle
%Introduction
\emph{Introduction.} 
Quantum technologies such as cryptography \cite{bennett_quantum_2014, ekert_quantum_1991, proietti_experimental_2021}, sensing \cite{bollinger_optimal_1996, giovannetti_quantum-enhanced_2004} and computing \cite{ladd_quantum_2010, shor_polynomial-time_1997, feynman_simulating_1982, grover_fast_1996} require the high-fidelity preparation and manipulation of entangled states, often comprising many qubits. In quantum computing, high-fidelity {\it $N$-qubit} quantum gates may be key to drastically reduce the gate count for quantum algorithms and enable fault tolerant quantum computation schemes
adapted to specific platforms.
In this context, the ability to perform \emph{non-local} quantum operations among  several distant qubits would be highly desirable. In addition to reducing circuit depth and gate count \cite{holmes_impact_2020}, 
it would also enable error correcting codes with non-local gates and stabilizers, e.g. low density parity check (LDPC) codes \cite{gottesman_fault-tolerant_2014, breuckmann_quantum_2021,Cohen:22}, which have considerably lower overhead  than the currently leading approach of surface codes \cite{fowler_surface_2012}.
In many physical platforms, however, both $N$-qubit and non-local operations entangling distant qubits are not natively available and have to be costly synthesized from a sequence of local operations. 

One way to realize non-local gates is via qubit shuttling, which has been demonstrated for trapped ions \cite{pino_demonstration_2021} and neutral atoms \cite{beugnon_two-dimensional_2007, bluvstein_quantum_2022}. Evaluating the cost of non-local operations in this case is nontrivial, as the architecture can perform certain parallel moves simultaneously, but unequal moves must be performed serially. 
Alternatively, non-local gates have been previously proposed or realized with neutral atoms or ions by mediating interactions between qubits via a quantized bosonic mode, using motional modes of trapped ions \cite{cirac_quantum_1995, molmer_multiparticle_1999,sackett_experimental_2000, garcia-ripoll_speed_2003} or optical cavity modes for neutral atom spin qubits \cite{pellizzari_decoherence_1995, zheng_efficient_2000, beige_quantum_2000}. 
For deterministic two-qubit gates, fidelity errors have been found to scale as $\mathcal{O}(C^{-1/2})$ \cite{sorensen_measurement_2003}, with $C$ the cooperativity. Expending additional detector resources, heralded two qubit non-local gates are achievable with error $\mathcal{O}(C^{-1})$ \cite{borregaard_heralded_2015} or even less \cite{ramette_any--any_2021}, but with a failure probability of $\mathcal{O}(C^{-1/2})$.
All proposals above require a direct drive of the qubits via a free space mode (e.g. a laser).

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{cavity_schematic_Fig1.png}
    \caption{(a) A register of qubits is coupled to a common cavity with decay rate $\kappa$. By simply driving the cavity with a single classical field $\eta(t)$ detuned by $\delta$ from the resonance frequency of the cavity, a non-local entangled state like $\ket{{\rm GHZ}}$ is generated, or, with a sequence of drives, non-local gates like a C$_{2}$Z are implemented. (b) Level scheme for each qubit consisting of the computational basis states $\ket{0}$ and $\ket{1}$ (with infinite lifetime), and an ancillary excited state $\ket{e}$ (with lifetime $1/\gamma$). 
    The $\ket{1} \leftrightarrow \ket{e}$ transition is coupled to the cavity with coupling strength $g$ and detuned from the cavity resonance by $\Delta - \delta$.}
    \label{fig:setup}
\end{figure}

In this letter we present two protocols to implement deterministic non-local multi-qubit quantum gates for qubits coupled via a common cavity mode. Here, instead of driving the qubits, both protocols are implemented by driving the cavity mode directly. 
This can be experimentally desirable, since, e.g. several other drives 
on the qubits are usually already required for state preparation, readout, single qubit gates.
The first protocol (A) operates in the limit of a strong drive. It implements a multi-qubit non-local geometric phase gate $\exp(i\theta \hat{n}^2)$, with $\hat{n} = \sum_{j=1}^{N} \ket{1_j}\bra{1_j}$ the number operator for qubits in state $\ket{1}$. Together with single qubit operations, this can be used to generate non-local GHZ states \cite{hein_multi-party_2004}. The second protocol (B) operates in the limit of a weak drive and uses the adiabatic evolution of the joint qubit-cavity system to implement a phase gate $\exp(i \varphi(\hat{n}))$, with $\varphi(\hat{n}) = c_1/(c_2-\hat{n})$ for constants $c_1, c_2$ depending on the parameters of the drive. Repeated applications of protocol B, each with different drive parameters, can be used to implement phase gates with arbitrary phases $\varphi(\hat{n})$. We explicitly discuss the implementation of phase-rotation gates and multi-controlled-Z gates using this approach and show that their fidelities outperform standard single- and two-qubit decompositions for $N>2$. Notably, both protocols can be used to implement a non-local controlled-Z (CZ) gate on two atoms, and thus form, together with single qubit gates, a universal gate set for quantum computing. We provide analytic solutions for gate fidelities in the presence of losses, finding error rates that scale as $\sim N/\sqrt{C}$. These protocols can be applied to different quantum computing platforms. We estimate gate fidelities and durations of CZ gates for cold atoms (both for qubits stored in different hyperfine states and for qubits stored in a ground and in a Rydberg state) and cold molecules, coupled via optical or microwave cavities -- consistent with fast and high-fidelity multi-qubit gates.  


\emph{The setup} we have in mind is  shown in Fig. \ref{fig:setup}. It consists of $N$ three-level systems with computational basis states $\ket{0}$ and $\ket{1}$ and an excited state $\ket{e}$ with transition frequencies $\omega_0$ and $\omega_e$  from $\ket{1}$ to $\ket{0}$ and $\ket{e}$, respectively. A cavity mode with annihilation (creation) operators $a(a^{\dagger})$ and frequency $\omega_c$ couples the states $\ket{1}$ and $\ket{e}$ with coupling strength $g$. This cavity mode is driven by a (complex) classical field of strength $\eta(t)$ according to $H_{\rm drive}=2|\eta| \sin(\omega_L t-\arg(\eta))(\ah^{\dagger}+\ah)$.
This classical field is detuned from the cavity and the $\ket{1}\leftrightarrow\ket{e}$ transition by $\delta=\omega_c-\omega_L$ and $\Delta=\omega_e-\omega_L$, respectively.
The Hamiltonian in the rotating wave approximation and in the rotating frame defined by 
$\hat U_r(t)=\exp\left[it(\omega_L (\ah^\dag \ah +\hat{n}_e) +\sum_j  \omega_0 \ket{0_j}\bra{0_j})\right]$ reads ($\hbar = 1$)
\begin{equation}
    H = \delta \ah^\dag \ah + (\Delta-i\gamma/2)\hat{n}_e + [(g\hat S^- +i\eta)\ah^\dag + \hc],
    \label{eq:Hamiltonian}
\end{equation}
with $\hat{n}_e = \sum_j \ket{e_j}\bra{e_j}$, $\hat S^+ = \sum_j \ket{e_j}\bra{1_j}$, $\hat S^- = (\hat S^+)^\dag$ and $1/\gamma$ the lifetime of $\ket{e}$.  
The system evolves under the Lindblad master equation $\dot{\rho} = -iH\rho +i\rho H^\dag +L\rho L^\dag - \{L^\dag L, \rho\}/2$ with the jump operator $L=\sqrt{\kappa}\ah$ and $1/\kappa$  the lifetime of excitations in the cavity mode. The decay of $\ket{e}$ is treated as population leakage, described by a non-hermitian term in $H$.  Thus, expressions for the  fidelity of the gate protocols derived below will be exact if $\ket{e}$ does not decay back to $\ket{0}$ or $\ket{1}$, and otherwise will provide a lower bound. 
For both protocols, a time-dependent pulse $\eta(t)$ of duration $T$ and with $\eta(0)=\eta(T)=0$ is applied, while $g$, $\delta$ and $\Delta$ are kept constant in time. 

\emph{Protocol A} implements a geometric gate from Hamiltonian~\eqref{eq:Hamiltonian} in the limit $\Delta \rightarrow \infty$ for constant $T$, while keeping $\eta/\Delta$ finite. This is shown by first performing two time-dependent basis transformations acting on the Hilbert space of the cavity mode and of the qubits, respectively [points (i) and (ii) below]. The resulting Hamiltonian $H_\eff$ [see Eq.~\eqref{eq:H_eff}] 
can be immediately used to generate the desired multi-qubit gate.

(i) To motivate the first  basis transformation we note that due to the limit $\eta \rightarrow \infty$ the cavity typically contains many ($\sim |\eta|^2/\delta^2$) photons. However, due to the simultaneous limit $\Delta \rightarrow \infty$ the number of photons only weakly depends on $n$, the number of atoms in state $\ket{1}$. It is thus useful to switch into a time-dependent frame of the cavity which reduces the number of photons. For this, we choose a frame in which for $n=0$ the cavity never contains any photons. 
This is achieved by taking $\tilde{\rho}(t) = D(\alpha(t))\rho(t) D(\alpha(t))^\dag$ and choosing $\alpha$ as the solution of $\dot{\alpha} = -\eta-(i\delta+\kappa/2)\alpha$ with $\alpha(t=0)=0$ and $D(\alpha) = \exp(\alpha \ah^\dag - \alpha^* \ah)$  the displacement operator. 
The evolution of $\tilde{\rho}$ is then given by \cite{supmat}
\begin{equation}
    \tilde{H} = \delta \ah^\dag \ah + (\Delta-i\gamma/2)\hat{n}_e + g[(\ah^\dag - \alpha^*)\hat S^- +\hc]
    \label{eq:H_tilde}
\end{equation}
and $\tilde{L} = L = \sqrt{\kappa}\ah$. Here, the drive of the cavity mode is converted into an effective drive of the qubits with strength $-ig\alpha$.  As the decay in the original frame is compensated by a $\kappa$-dependent choice of $\alpha$,  in this new frame there are no excitations in the cavity mode and no decay events if $n=0$ -- even if in the original frame there may be many excitations and decay events. 

(ii) The aim of the second basis transformation, acting only on the space of the qubits, is to eliminate the $\ket{e}$ state. For this, we move into the frame given by the instantaneous eigenvectors of $\Delta \hat{n}_e -g(\alpha \hat S^+ + \alpha^* \hat S^-)$, which is the part of $\tilde{H}$ that scales with $\Delta$. The related operator is 
$\hat U = \exp\left[\frac{\lambda}{2}\left(-e^{i\mu}\hat S^++e^{-i\mu}\hat S^-\right)\right]$
with  $\cos\lambda = \Delta/\sqrt{4g^2|\alpha|^2+\Delta^2}$ and $\mu = \arg(\alpha)$. The  resulting Hamiltonian $\bar{H} = \hat U\tilde{H}\hat U^\dag + i\dot{\hat U}\hat U^\dag$ reads \cite{supmat}
\begin{eqnarray}
    \bar{H} &=& \delta \ah^\dag \ah + \left(\varepsilon_--i\frac{\gamma_-}{2}\right) \hat{n} +  \left(\varepsilon_+ -i\frac{\gamma_+}{2}\right) \hat{n}_e \label{eq:H_bar}\\ \nonumber
    &+& (\zeta \ah^\dag + \zeta^* \ah)(\hat n-\hat n_e) + \mathcal{O}(1)\hat S^+  + \mathcal{O}(1)\hat S^-
\end{eqnarray}
where 
\begin{equation}
    \zeta = \frac{g^2\alpha}{\sqrt{4g^2|\alpha|^2 + \Delta^2}}
    ,\quad
    \gamma_\pm = \frac{\gamma}{2}\left(1\pm\sqrt{1-4|\zeta|^2/g^2}\right) \nonumber
    \label{eq:protocol_A_gamma}
\end{equation}
and $\varepsilon_\pm = (\Delta\pm g^2\alpha/\zeta)/2 + \mathcal{O}(1)$.
Here, $\mathcal{O}(1)$ refers to the limit $\Delta\rightarrow\infty$. The jump operator $\bar{L}=L$ is not affected by the transformation, which only acts on the qubits.

The terms proportional to $\hat S^+$ and $\hat S^-$ in Eq.~\eqref{eq:H_bar} can be neglected in the limit $\Delta \rightarrow \infty$, because they are independent of $\Delta$, while the gap $|\varepsilon_+-\varepsilon_-|$ diverges.
Since only initial states are considered in which $\ket{e}$ is not populated, also the $\hat n_e$-terms can be neglected in Eq.~\eqref{eq:H_bar}, leading to 
\begin{equation}
    H_\eff = \delta \ah^\dag \ah + \left( \varepsilon_- -i\frac{\gamma_-}{2} + \zeta \ah^\dag + \zeta^* \ah\right)\hat{n}.
    \label{eq:H_eff}
\end{equation}
Up to single-qubit rotations \eqref{eq:H_eff} is now equivalent to the Hamiltonian for a geometric M{\o}lmer-S{\o}rensen gate \cite{molmer_multiparticle_1999}. 

In the following, we give a condition on $\zeta(t)$ to implement a multi-qubit $\exp(i\theta \hat n^2)$ quantum gate and derive an exact expression of the gate infidelity in the presence of losses. For the derivation we assume that the cavity initially contains no excitations \footnote{Note that this assumption is only relevant for the correct calculation of the infidelity, since in the absence of losses ($\gamma=\kappa=0$) the implemented quantum gate is independent from the initial state of the cavity, as for the M{\o}lmer-S{\o}rensen gate.}. Denote by $\mathcal{E}$ the quantum channel obtained by solving the Lindblad master equation with Hamiltonian $H_\eff$ [Eq.~\eqref{eq:H_eff}] and jump operator $L$ from time 0 to time $T$. Now let $q, q' \in \{0,1\}^N$ be two computational basis states, and denote by $n(m)$ the number of 1s in $q(q')$. A direct calculation shows \cite{supmat}
\begin{equation}
   % \mathcal{E}\left(\ket{0}\bra{0} \otimes \ket{q}\bra{q'}\right) = \frac{e^{i\theta_{nm}} \ket{\beta_n}\bra{\beta_m} \otimes \ket{q}\bra{q'}}{\braket{\beta_m}{\beta_n}}
     \mathcal{E}\left(\ket{0}\bra{0} \otimes \ket{q}\bra{q'}\right) = (e^{i\theta_{nm}} \ket{\beta_n}\bra{\beta_m} \otimes \ket{q}\bra{q'})/\braket{\beta_m}{\beta_n} \nonumber
        \label{eq:E_eff}
\end{equation}
where the first and second terms in the tensor product denote the state of the cavity mode and of the qubits, respectively. The coherent states $\ket{\beta_n}$ are given by the solution of $\dot{\beta}_n = -(i\delta + \kappa/2)\beta_n -in\zeta$ with $\beta_n(0)=0$,
while the (complex) phases $\theta_{nm}$ are 
\begin{eqnarray}
     \theta_{nm} = \int_0^T  &\Big[& (m-n)(\zeta(t) \beta_m(t)^* + \zeta(t)^*\beta_n(t))  \\ \nonumber
     &+& i(m+n)\gamma_-(t)/2\Big] \mathrm{d}t.
\end{eqnarray}
Tracing out the state of the cavity mode in $ \mathcal{E}$ %Eq.~\eqref{eq:E_eff} 
gives
\begin{eqnarray}
    \mathcal{E}_\eff(\ket{q}\bra{q'}) =e^{i\theta_{nm}} \ket{q}\bra{q'}.
\end{eqnarray}
We first consider the case $\kappa=\gamma=0$. To implement a gate we choose $\zeta$ such that $\beta_n(t)= nf(t)$ for a real function $f$ with $f(0)=f(T)=0$. This is achieved by taking $\zeta(t) = -\delta f(t) +if'(t)$. Note that if $|\zeta(t)| \leq g/2$ there exists a pulse $\eta(t)$ which corresponds to this choice of $\zeta$. For these $\beta_n$ and $\zeta$, we then obtain $\theta_{nm} = (n^2-m^2)\theta$, with $\theta = \delta \int_0^T  |f(t)|^2\mathrm{d}t$. Hence, $\mathcal{E}_\eff$ is a unitary evolution corresponding to the quantum gate $\exp(i\theta\hat{n}^2)$.

To evaluate the performance of the gate in the presence of losses we compute the average gate fidelity $F$ as
\begin{eqnarray}
    \label{eq:protocol_A_fidelity}
    F &=& \int \mathrm{d}\psi \bra{\psi}e^{i\theta \hat{n}^2 } \mathcal{E}_\eff(\ket{\psi}\bra{\psi})e^{-i\theta\hat{n}^2 }\ket{\psi}\\ \nonumber &=&\frac{\sum_{n=0}^N \binom{N}{n} e^{i\theta_{nn}} 
    + \sum_{n,m=0}^N \binom{N}{n} \binom{N}{m}e^{i\theta_{nm}-i(n^2-m^2)\theta} }{2^N(2^N+1)},
\end{eqnarray}
where the integral in the first expression is taken over the whole computational subspace, and the second expression follows from Ref.~\cite{pedersen_fidelity_2007}.

Of particular interest is the limit $T\rightarrow \infty$ and $\kappa,\gamma \ll g, \delta$, where $1-F$ can be evaluated analytically as \cite{supmat}
\begin{equation}
    1-F = \left(\frac{\kappa}{4(1+2^{-N})\delta} + \frac{\gamma\delta}{2g^2}\right)N\theta.
\end{equation}
The infidelity is minimized for $\delta = \sqrt{\kappa/[2(1+2^{-N})\gamma]}g$, which gives $1-F = N\theta/\sqrt{2(1+2^{-N})C}$,
where $C = g^2/(\gamma\kappa)$ denotes the cooperativity. To our knowledge this is the first analytical solution of $1-F$ for Hamiltonians of the type of Eq.~\eqref{eq:H_eff} in the presence of the relevant losses.

\begin{figure}
    \centering
    \includegraphics[width = \linewidth]{protocol_A_Fig2.pdf}
     \caption{Protocol A: (a) Infidelity of a CZ gate vs pulse duration $T$ for different values of $C$ and $\gamma/\kappa$. Solid lines show the infidelity (analytic result) in the $\Delta \rightarrow \infty$ limit, circles show the infidelity (numerical calculation) at a finite value of $\Delta$, chosen such that $\max_t |\eta(t)|=30g$. For each $T$, $C$ and $\gamma/\kappa$, $\delta$ is optimized to obtain the minimal 1-$F$. (b) Numerical (dots) and analytical (dashed line) value of the infidelity vs $C$ in the $T\rightarrow \infty$ limit for different values of $\gamma/\kappa$.}
    \label{fig:ProtocolA_main_plot}
\end{figure}

Protocol A can be used to implement a CZ gate, up to single qubit gates, by choosing $N=2$ and $\theta=\pi/2$ [here, achieved by $f(t) = \sqrt{4\pi/(3\delta T)}\sin^2(\pi t/T)$]. 
Numerically one finds that there is a $\delta$ with $|\zeta(t)| < g/2$ for a  $t$ as long as $Tg \geq 8.3$.
For the chosen $f$, the infidelity  $1-F$ is shown in Fig.~\ref{fig:ProtocolA_main_plot}(a) as a function of the pulse duration $T$ for several $C$ and ratios $\gamma/\kappa$. The infidelity in the limit $\Delta\rightarrow\infty$ (solid lines) reaches its asymptotic value $1.99/\sqrt{C}$ already for pulse durations of the order of a few 10s of $g^{-1}$ and decreases fastest for $\gamma/\kappa=1$. Panel (a) also shows the infidelity for a finite $\Delta$ (dots), chosen for a maximal driving strength $\max_t |\eta(t)|=30g$. The latter is found to be sufficient to ensure negligible deviations between the infidelities at finite $\Delta$ and $\Delta \rightarrow \infty$. Panel (b) compares the numerical results (circles) with the analytic prediction (dashed line) for $1-F$ vs $C$, finding good agreement for all  $\gamma/\kappa$.  




\emph{Protocol B} uses the same Hamiltonian~\eqref{eq:Hamiltonian} as protocol A, but works for a finite value of $\Delta$ and in the limit $\eta\rightarrow 0$. In the following, we first show how a single pulse $\eta(t)$ can be used to implement phase gates with phases
\begin{equation}
    \varphi(\hat n) = -I/(\delta - \hat n g^2/\Delta) ,
    \label{eq:protocol_B_phi_n}
\end{equation} with $I = \int_0^T |\eta(t)|^2\mathrm{d}t$ the pulse energy.
A combination of several pulses with different detunings $\delta$ and $\Delta$ can then be used to implement phase gates with arbitrary phases $\varphi(\hat n)$, e.g. phase-rotation or  multi-controlled-Z gates.

Consider an initial computational basis state $\ket{q}$ with $n$ qubits in state $\ket{1}$ and a pulse $\eta(t)$ with $\eta(0)=\eta(T)=0$. Since $\ket{q}$ is an eigenstate of $H$ at $\eta=0$ the system adiabatically follows this eigenstate as long as $T$ is large enough. By perturbation theory, the energy of this eigenstate is found to be $ \varepsilon_{n} = -|\eta|^2/(\delta - ng^2/\Delta)$, thus leading to the phases given in Eq.~\eqref{eq:protocol_B_phi_n} \cite{supmat}.

By assuming an adiabatic evolution, we find for computational basis states $\ket{q}$($\ket{q'}$) with $n$($m$) qubits in state $\ket{1}$ that to first order in $\gamma,\kappa$ \cite{supmat}
\begin{equation}
    \mathcal{E}_\eff(\ket{q})\bra{q'}) = c_{nm} e^{i\varphi(n)-\varphi(m)} \ket{q}\bra{q'}
\end{equation}
where $c_{nm} = 1- [(\gamma_n+\gamma_m+(s_n-s_m)^2]$, with
\begin{eqnarray}
    \gamma_n = \frac{\gamma n g^2}{(\Delta \delta -ng^2)^2}I \qquad
    s_n = \frac{\sqrt{\kappa} \Delta}{\Delta \delta -ng^2}\sqrt{I}.
\end{eqnarray}
The average gate fidelity can then be calculated similarly to Eq.~\eqref{eq:protocol_A_fidelity}, with  $c_{nm}$ replacing  $\exp[i\theta_{nm}-i\theta(n^2-m^2)]$. 

To implement a CZ gate ($N=2$), up to single qubit gates, $I$ has to be chosen such that $\int |\bar{\varepsilon}(t)|\mathrm{d}t = \pi$, where $\bar{\varepsilon} = \varepsilon_2-2\varepsilon_1+\varepsilon_0$. Given this choice, the values of $\delta$ and $\Delta$ that maximize $F$ can be found numerically as $\delta = 0.529\sqrt{\kappa/\gamma}g$, $\Delta = -2.09\sqrt{\gamma/\kappa}g$, which gives $1-F = 1.79/\sqrt{C}$. The scaling of $\delta$, $\Delta$ and $F$ with $\gamma$ and $\kappa$ arises because, as shown by direct calculation,  $1-F$ is of the form $1-F = g_1(\delta\Delta)\gamma/\Delta + g_2(\delta\Delta)\kappa/\Delta$, where $g_1$ and $g_2$ are functions independent of $\gamma$ and $\kappa$.

Figure~\ref{fig:ProtocolB_main_plot}(a) shows the infidelity as a function of pulse duration $T$ for an implementation of a CZ gate using protocol B for different values of $C$ and $\gamma/\kappa$. To achieve adiabaticity, here $\eta(t)$ is chosen to rise to $\emax$ with $\sin^2$-shaped flanks of duration $T_0 \leq T/2$, while $T_0$ and $\emax$ satisfy $\int |\bar{\varepsilon}(t)|\mathrm{d}t = \pi$ with the minimal possible slope $\max_t|\dot{\eta}(t)|$. We find that $1-F$ approaches its asymptotic value  $1.79/\sqrt{C}$ for pulse durations $T\sim 10^2-10^3 g^{-1}$, while for smaller $T$ it increases due to diabatic errors. The different behavior for different $\gamma/\kappa$ ratios arises due to a nontrivial behavior of $\bar{\varepsilon}$ away from the perturbative approximation made above. 



\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{protocol_B_Fig3.pdf}
    \caption{Protocol B: (a) Infidelity (numerical calculation) for a CZ gate as a function of pulse duration $T$ for different values of $C$ and $\gamma/\kappa$. (b) Infidelity of a phase-rotation gate with $\alpha = \pi/4$ in the $T\rightarrow \infty$ limit as a function of $N$. Also shown is the infidelity of the same gate implemented using a decomposition into CZ and single-qubit gates using the circuit from Ref.~\cite{barkoutsos_quantum_2018}. (c) Infidelity of a C$_{N-1}$Z gate vs $N$ when implemented using protocol B and by decomposition into CZ and single qubit gates using an ancilla-free %decomposition based on a 
    Gray-code \cite{groen_efficient_2022}.}
    \label{fig:ProtocolB_main_plot}
\end{figure}


By applying Protocol B $N-1$ times with pulses of detunings $\delta_1,...\delta_{N-1}$ and $\Delta_1,...\Delta_{N-1}$ and pulse energies $I_1,...,I_{N-1}$, any desired set of phases $\varphi(n)$ can be implemented, up to a global phase and single qubit gates. To see this, we note that the phases $\varphi_k(n)$ implemented by the $k$-th pulse depend \emph{linearly} on $I_k$ [Eq.~\eqref{eq:protocol_B_phi_n}], and the vectors $(\varphi_1(0),...,\varphi_1(N)), ..., (\varphi_{N-1}(0),...,\varphi_{N-1}(N))$ are \emph{linearly independent}, as long as the $(\delta_k, \Delta_k)$ are pairwise distinct. Hence, for any choice of $\delta_k$ and $\Delta_k$ there exist pulse energies $I_k$ such that for $n\geq 2$ the relation $\sum_k [\varphi_k(n)-n\varphi_k(1)+(n-1)\varphi_k(0)] = \varphi(n)$ is satisfied, i.e. the desired phase gate is implemented up to a global phase and single qubit gates. 





This procedure can be used to obtain, e.g., two classes of multi-qubit gates: Phase-rotation gates $\exp(-i \alpha Z_1 \otimes ... \otimes Z_n)$  -- corresponding to  phases $\varphi(n) = -\alpha (-1)^{n}$ -- and $N$-qubit multi-controlled-Z gates (C$_{N-1}$Z gates), i.e. phase gates with $\varphi(N)=\pi$ and $\varphi(n)=0$ for $n < N$. 
The infidelity for both multi-qubit gates as a function  of $N$ is shown in Fig.~\ref{fig:ProtocolB_main_plot}(b,c) for different values of $\gamma/\kappa$. Here, we take $\delta_k-\Delta_k = 2.09 g/\sqrt{\kappa/\gamma}+0.529 g\sqrt{\kappa/\gamma}$ (the optimal choice for $N=2$), and choose the $\delta_1,...,\delta_{N-1}$ to maximize the fidelity \cite{supmat}. The fixed difference $\delta-\Delta$ means that only the frequency of the drive, not that of the cavity mode or of the $\ket{1}\leftrightarrow\ket{e}$ transition, has to be changed between the different pulses. Note that for the C$_{N-1}$Z gates we  consider the minimal fidelity $F_{\min} = \min_{\ket{\psi}} \bra{\psi}C_{N-1}Z \mathcal{E}_\eff(\ket{\psi}\bra{\psi})C_{N-1}Z\ket{\psi}$ instead of the average gate fidelity to achieve a fair comparison between different $N$. As for protocol A, an approximately linear scaling with $N$ is observed for both gates. Fig.~\ref{fig:ProtocolB_main_plot}(b,c) also shows the infidelity when implementing the gate by decomposing it into CZ and single qubit gates (assumed perfect) first. The direct implementation using protocol B outperforms the implementation using individual CZ gates in both cases.





\emph{Applications.} 
Our protocols can be applied to different quantum computing platforms. As a first example, we consider neutral $^{87}$Rb atoms trapped in optical tweezers and coupled to a fiber Fabry-Perot cavity  \cite{hunger_fiber_2010-1, uphoff_frequency_2015, barontini_deterministic_2015}. We choose $\ket{0} = \ket{5 ~^2S_{1/2}\,F=1\, m_F=0}$, $\ket{1} = \ket{5 ~^2S_{1/2}\,F=2\, m_F=0}$ and $\ket{e} = \ket{5 ~^2P_{3/2}\,F=3\, m_F=0}$, where the linewidth of the $\ket{1}\leftrightarrow\ket{e}$ transition ($\lambda = 780$ nm) is $\gamma = 2\pi \times 6$ MHz (FWHM). For the cavity we assume a finesse $\mathcal{F}\approx 2\times 10^5$, a waist radius $w_r \approx 2\,\mu$m and a length $L \approx 40\, \mu$m \cite{hunger_fiber_2010-1,uphoff_frequency_2015,barontini_deterministic_2015} resulting in a cooperativity of $C = 3\lambda^2\mathcal{F}/(2\pi^3w_r^2) \approx 1500$ with a coupling strength of $g = \sqrt{3\lambda^2c\gamma/(2\pi^2w_r^2L)} \approx 2\pi \times 400$ MHz and $\kappa = \pi c/L\mathcal{F} \approx 2\pi \times 20$ MHz (FWHM), so that $\gamma/\kappa \approx 0.3$ \cite{hunger_fiber_2010-1}. This corresponds to an infidelity $1-F\approx 5\%$ for a CZ gate (for both protocols A and B), which can be achieved in $T\approx 20/g \approx 8$ ns (protocol A) or $T \approx 300/g \approx 120$ ns (protocol B). These gate speeds compare favorably to those for current fast neutral atom gates \cite{jaksch_fast_2000,morgado_quantum_2021}. 

As a second example, we take both $\ket{1}$ and $\ket{e}$ to be Rydberg states, coupled via a superconducting microwave resonator. Specifically, we assume $\ket{1}=\ket{90 ~^2P_{3/2}}$ and $\ket{e}=\ket{90 ~^2S_{1/2}}$ in Cs, with a lifetime of 2 ms and 820 $\mu$s, respectively,  $\omega_e \approx 2\pi \times 5$ GHz and a coupling strength $g\approx 2\pi \times 4$ MHz \cite{pritchard_hybrid_2014}.  Quality factors of $Q> 3\times 10^8$ for microwave stripline resonators have been reported in the multilayer microwave integrated quantum circuit architecture \cite{lei_high_2020}, which yields $\kappa = \omega_e/Q \approx 2\pi \times 17$ Hz, and thus $C = 5\times 10^9$, and $\gamma/\kappa = 12$. Including decay of $\ket{1}$, the infidelity  is $1-F = 3\times 10^{-3}$ for a pulse duration of $T=20/g \approx 800$ ns for protocol A (at $\Delta = 250g$), and $1-F = 5 \times 10^{-3}$ at $T=200/g \approx 8\, \mu$s for protocol B.

As a final platform we consider ultracold polar molecules coupled to a microwave resonator \cite{andre_coherent_2006, rabl_hybrid_2006, sawant_ultracold_2020}. Following Ref.~\cite{andre_coherent_2006}, we assume Ca$^{79}$Br molecules \cite{childs_hyperfine_1981} trapped electrostatically in the vicinity of a  superconducting microwave stripline resonator -- for an implementation using CaF molecules see~\cite{supmat}. We chose the computational basis states $\ket{0} = \ket{N=1, m_N=0,F=1, m_F=0}$, $\ket{1} = \ket{1, 0, 2, 1}$ and $\ket{e} = \ket{2,0,2,1}$, where $N$ is the rotational quantum number in the electronic ground states. For this choice, $\omega_e = 2\pi \times 11$ GHz and coupling strengths up to $g=2\pi \times 400$ kHz can be achieved \cite{andre_coherent_2006}. Additionally to the $\ket{1}\leftrightarrow\ket{e}$ coupling there is an unwanted $\ket{0}\leftrightarrow\ket{e'}$ coupling with coupling strength $g'=g$, where $\ket{e'}= \ket{2,0,1,0}$, which is detuned by $\Delta' = 2\pi \times 16.8$ MHz from the $\ket{1}\leftrightarrow\ket{e}$ transition \footnote{Note that by choosing the quantization axis such that the microwave is $\pi$-polarized a $\ket{0}\leftrightarrow\ket{e}$ coupling can be strongly suppressed}. The effect of this transition can be compensated by a rescaled driving strength $\eta(t)$ and is included in our numerical calculations.  
Assuming again $Q = 3\times 10^8$ yields $\kappa = \omega_e/Q \approx 2\pi \times 37$ Hz, while $\gamma\lesssim 10^{-2}$Hz \cite{buhmann_surface-induced_2008} and can be neglected. For protocol A, we choose reasonable $\Delta = 2\pi \times 12$ MHz, and $\delta = 2\pi \times 400$kHz which, for a CZ gate, gives an infidelity $1- F= 6.1 \times 10^{-5}$ with a gate time of $ T = 200/g \approx  80 \, \mu$s. For protocol B, choosing $\Delta=\delta = 2\pi \times 400$ kHz gives an infidelity $1-F=5.7\times 10^{-4}$ at a pulse duration of $T=10^3/g = 400\, \mu$s.
  
In conclusion, we have proposed two protocols for deterministic non-local multi-qubit quantum gates for qubits coupled to a common cavity. Both protocols are implemented only by a classical drive of the cavity and do not require an external drive of the qubits. 
We note that for superconducting qubits so-called resonator induced phase (RIP) gates on two qubits have been realized \cite{cross_optimized_2015, puri_high-fidelity_2016, paik_experimental_2016}, which also only require a drive of the microwave resonator connecting the qubits, and no drive of the qubits themselves. In contrast to the RIP gates our protocols assume long lived computational states $\ket{0}$ and $\ket{1}$ and an ancillary state $\ket{e}$ with a finite lifetime, and with the $\ket{1}\leftrightarrow\ket{e}$ coupled to the cavity -- naturally available in neutral atom and molecule architectures -- and can work outside of the dispersive regime $\Delta \gg g \sqrt{\langle a^\dag a\rangle}$, allowing for gate times of the order of $g^{-1}$ (protocol A). 

The methods described here have a variety of possible applications including the following ones: (1) Non-local GHZ states enable non-local stabilizer measurements for quantum error correction. By combining the DiVincenzo-Aliferis method \cite{aliferis_2020} for weight $w$ stabilizer measurements together with our mechanism, a non-local GHZ resource state could be encoded on $w$ ancilla located nearby the target register qubits using Protocol A in a time essentially independent of $w$, and \emph{without the need for non-local verification}. These ancilla would then perform spatially local controlled operations on the computational register, and finally decoded to infer the stabilizer measurement outcome and to identify errors in the encoding which can be corrected for by adapting the Pauli frame of the computation. Crucially, because our scheme is invertible this final non-local decoding step can be performed. Furthermore, the measurement can be made fault tolerant \cite{aliferis_2020} by a second level of encoding of the ancilla after the interaction with the register, using spatially local gates. 
(2) Phase-rotation gates are widely used in mappings from fermionic to Pauli operators \cite{seeley_bravyi-kitaev_2012} and are thus of considerable importance for quantum chemistry algorithms.  For angles $\alpha=\pi/2^t$ they form a generating set for the diagonal Clifford hierarchy at level $t$ \cite{Cui_2017}, useful for magic state distillation and code switching.
(3) Non-local C$_{N-1}$Z gates can be utilized for majority voting circuits, e.g. in measurement free quantum error correction \cite{paz-silva_fault_2010,crow_improved_2016,ercan_measurement-free_2018}, when the architecture or code doesn't allow for spatial colocation of the qubits. Even though for $N>2$ the gate is not Clifford, the gate can be used for fault tolerant  error correction when it is controlled by ancillas that carry error syndrome data that is classical \cite{paz-silva_fault_2010,crow_improved_2016,ercan_measurement-free_2018}.


We gratefully acknowledge discussions with Shannon Whitlock. This research has received funding from the European Unionâ€™s Horizon 2020 research
and innovation programme under the Marie Sk{\l}odowska-Curie project 955479 (MOQS) and project 847471(QUSTEC), the Horizon Europe programme HORIZON-CL4-2021-DIGITAL-EMERGING-01-30 via the project 101070144 (EuRyQa) and from the French National
Research Agency under the Investments of the Future
Program projects ANR-21-ESRE-0032 (aQCess) and ANR-22-CE47-0013-02 (CLIMAQS). G.K.B. acknowledges
support from the Australian Research Council Centre
of Excellence for Engineered Quantum Systems (Grant
No. CE 170100009).

 

% Specify following sections are appendices. Use \appendix* if there
% only one appendix.
%\newpage
%\begin{widetext}
%\appendix
%\section{The first appendix}
%\end{widetext}
% If you have acknowledgments, this puts in the proper section head.
%\begin{acknowledgments}
% put your acknowledgments here.
%\end{acknowledgments}

% Create the reference section using BibTeX:
\bibliography{library}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SUPPLEMENTARY %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\appendix
\newpage
\pagebreak

\onecolumngrid

\newcommand{\id}{\mathrm{id}}
\newcommand{\cc}{\mathrm{c.c.}}
\newcommand{\f}{E}
\renewcommand{\ne}{\hat{n}_e}
\renewcommand{\Im}{\mathrm{Im}}
\newcommand{\lf}{\left(\frac{\lambda}{2}\right)}


\vfill
\pagebreak

\setcounter{equation}{0}
\setcounter{figure}{0}
\setcounter{table}{0}
\setcounter{page}{1}
\renewcommand{\theequation}{S\arabic{equation}}
%\renewcommand*{\citenumfont}[1]{S#1}
%\renewcommand*{\bibnumfmt}[1]{[S#1]}

\center{\large{\textbf{Supplementary Information}}}

\raggedright

\section{Protocol A}
\subsection{First basis transformation on the cavity}
Here we discuss the first time-dependent basis transformation on the subsystem of the cavity. For a function $\alpha(t)$ consider the displacement operator $D(\alpha(t)) = \exp(\alpha(t) \ah^\dag - \alpha^*(t) \ah)$. Recall that it satisfies $D(\alpha)\ah D(\alpha)^\dag = \ah - \alpha$ and $D(\alpha)\ah ^\dag D(\alpha)^\dag = \ah^\dag - \alpha^*$, and furthermore
\begin{equation}
    \frac{\mathrm{d}}{\mathrm{d}t}D(\alpha) = [\dot{\alpha}\ah^\dag - \dot{\alpha}^* \ah + i\Im(\dot{\alpha}^*\alpha)]D(\alpha) = D(\alpha)[\dot{\alpha} \ah^\dag - \dot{\alpha}^*\ah -i\Im(\dot{\alpha}^*\alpha)].
\end{equation}
Now we define $\tilde{\rho} = D(\alpha)\rho D(\alpha)^\dag$. It satisfies
\begin{equation}
     \dot{\tilde{\rho}} = -i(H'\tilde{\rho} - \rho (H')^\dag) + L'\tilde{\rho} (L')^\dag -\frac{1}{2}\{(L')^\dag L', \tilde{\rho}\} + \left(\frac{\mathrm{d}}{\mathrm{d}t}D(\alpha)\right)D(\alpha)^\dag \tilde{\rho} + \tilde{\rho}D(\alpha)\left(\frac{\mathrm{d}}{\mathrm{d}t}D(\alpha)^\dag\right)
     \label{eq:si_adiabatic_lindblad_tilde}
\end{equation}
where $H' = D(\alpha)H D(\alpha)^\dag$ and $L' = D(\alpha)L D(\alpha)^\dag$.

We calculate
\begin{equation}
    H' = \delta \ah^\dag \ah + (\Delta -i \gamma/2)\hat n_e + g(\ah^\dag \hat S^- + \ah \hat S^+) + (i\eta - \delta\alpha)\ah^\dag - (i\eta^* + \delta\alpha^*) \ah + -g\alpha^* \hat S^- -g \alpha \hat S^+ + \delta |\alpha|^2 + i(\eta\alpha^*-\eta^*\alpha)
\end{equation}
\begin{equation}
    L'\tilde{\rho}(L')^\dag - \frac{1}{2}\{(L')^\dag L, \tilde{\rho}\} = L\tilde{\rho} L^\dag -\frac{1}{2}\{L^\dag L, \tilde{\rho}\} + \frac{\kappa}{2}(-\alpha^* \ah\rho - \alpha \rho \ah^\dag + \alpha^* \rho \ah + \alpha \ah^\dag \rho)
\end{equation}
and
\begin{equation}
    \left(\frac{\mathrm{d}}{\mathrm{d}t}D(\alpha)\right)D(\alpha)^\dag \tilde{\rho} + \tilde{\rho}D(\alpha)\left(\frac{\mathrm{d}}{\mathrm{d}t}D(\alpha)^\dag\right) = [\dot{\alpha}\ah^\dag - \dot{\alpha}^*\ah, \tilde{\rho}]
\end{equation}
Plugging this into eq.~\eqref{eq:si_adiabatic_lindblad_tilde} gives
\begin{equation}
    \dot{\tilde{\rho}} = -i\tilde{H}\tilde{\rho} +i\tilde{\rho}\tilde{H}^\dag+ L\rho L^\dag -\frac{1}{2}\{L^\dag L, \rho\}
\end{equation}
with
\begin{eqnarray}
    \tilde{H} &=& \delta \ah^\dag \ah + (\Delta -i \gamma/2)\hat n_e + g(\ah^\dag \hat S^- + \ah \hat S^+) -g\alpha^* \hat S^- -g \alpha \hat S^+ \\ \nonumber
    &+&  (i\eta - (\delta - i\kappa/2)\alpha + i\dot{\alpha})\ah^\dag - (i\eta^* + (\delta+i\kappa/2)\alpha^*  +i\dot{\alpha}^*) \ah 
\end{eqnarray}

Now we take $\alpha(t)$ such that
\begin{equation}
    \dot{\alpha} = -\eta  -(i\delta +\kappa/2)\alpha
\end{equation}
which is satisfied by
\begin{equation}
    \alpha(t) = \int_0^t \mathrm{d}t' \eta(t') e^{-(i\delta+\kappa/2)(t-t')}.
\end{equation}
With this choice, $\tilde{H}$ becomes simply
\begin{equation}
     \tilde{H} = \delta \ah^\dag \ah + (\Delta -i \gamma/2)\hat n_e + g(\ah^\dag \hat S^- + \ah \hat S^+)  -g\alpha^* \hat S^- -g \alpha \hat S^+
\end{equation}

\subsection{Second basis transformation on the qubits}
We perform the time dependent basis transformation $\bar{H} = U\tilde{H}U^\dag + i\dot{U}U^\dag$ for 
\begin{equation}
    U = \exp\left[\frac{\lambda}{2}\left(-e^{i\mu}\hat S^+ +e^{-i\mu}\hat S^-\right)\right]
\end{equation}
and
\begin{equation}
    \tilde{H} = \delta \ah^\dag \ah + (\Delta-i\gamma/2)\hat{n}_e + g\ah^\dag \hat S^- + g\ah\hat S^+ -g\alpha \hat S^+ -g\alpha^*\hat S^-.
\end{equation}
We calculate
\begin{equation}
U = \left[\ket{0}\bra{0} + \cos\lf\left(\ket{1}\bra{1}+\ket{e}\bra{e}\right) + \sin\lf\left(-e^{i\mu}\ket{e}\bra{1}+e^{-i\mu}\ket{1}\bra{e}\right) \right]^{\otimes N}
\end{equation}
which gives
\begin{eqnarray}
U\hat S^+U^\dag &=& \cos^2\lf \hat S^+ - e^{-2i\mu}\sin^2\lf \hat S^- + e^{-i\mu}\sin\lf \cos\lf (\hat{n}-\hat{n}_e) \\
U\hat S^-U^\dag &=& \cos^2\lf \hat S^- - e^{2i\mu}\sin^2\lf \hat S^+ + e^{i\mu}\sin\lf \cos\lf (\hat{n}-\hat{n}_e) \\
U\hat{n}_e U^\dag &=& \cos^2\lf \hat{n}_e + \sin^2\lf \hat{n} + \sin\lf \cos\lf \left(e^{-i\mu}\hat S^-+e^{i\mu}\hat S^+\right)
\end{eqnarray}
Now first consider $H^{(0)} = \Delta \hat{n}_e -g\alpha \hat S^+ -g\alpha^*\hat S^-$, the part of $\tilde{H}$ that scales of $\Delta$. We choose $\lambda$ and $\mu$ so that $U H^{(0)} U^\dag$ is diagonal. We find
\begin{eqnarray}
U H^{(0)} U^\dag &=& \left[\Delta \cos^2\lf +g\left(\alpha e^{-i\mu}+\cc\right)\sin\lf\cos\lf\right]\hat{n}_e \\ \nonumber
&+& \left[\Delta \sin^2\lf -g\left(\alpha e^{-i\mu}+\cc\right)\sin\lf\cos\lf\right]\hat{n} \\ \nonumber
&+& \left[\Delta e^{i\mu}\sin\lf\cos\lf + e^{2i\mu}\sin^2\lf g\alpha^* -g\alpha\cos^2\lf \right]\hat S^+ \\ \nonumber
&+& \left[\Delta e^{-i\mu}\sin\lf\cos\lf + e^{-2i\mu}\sin^2\lf g\alpha -g\alpha^*\cos^2\lf \right]\hat S^- 
\end{eqnarray}
The coefficients of $\hat S^+$ and $\hat S^-$ vanish for $\mu = \arg(\alpha)$ and $\lambda$ such that $\Delta\sin\lf\cos\lf = g\alpha(\cos^2\lf - \sin^2\lf)$, which is satisfied for $\cos\lambda = \Delta/\sqrt{\Delta^2 + 4g^2|\alpha|^2}$. We denote by $\varepsilon_-$ and $\varepsilon_+$ the coefficients of $\hat{n}$ and $\hat{n}_e$,respectively, and find
\begin{eqnarray}
\varepsilon_- &=& \Delta \sin^2\lf -2g|\alpha|\sin\lf\cos\lf = \frac{1}{2}\left(\Delta - \sqrt{\Delta^2+4g^2|\alpha|^2}\right) \\
\varepsilon_+ &=& \Delta \cos^2\lf +2g|\alpha|\sin\lf\cos\lf = \frac{1}{2}\left(\Delta + \sqrt{\Delta^2+4g^2|\alpha|^2}\right)
\end{eqnarray}
Now we consider $\tilde{H}-H^{(0)} = \delta \ah^\dag \ah -i\frac{\gamma}{2}\hat{n}_e + g \ah \hat S^+ + g\ah^\dag \hat S-$ and calculate $U(\tilde{H}-H^{(0)})U^\dag$ term by term (the notation $\mathcal{O}(1)$ refers to the limit $\Delta\rightarrow\infty$). 
\begin{equation}
U \ah^\dag \ah U^\dag = \ah^\dag \ah
\end{equation}
\begin{eqnarray}
U \hat{n}_e U^\dag &=& \frac{1-\cos\lambda}{2}\hat{n} + \frac{1+\cos\lambda}{2}\hat{n}_e + \mathcal{O}(1)\hat S^+ + \mathcal{O}(1)\hat S^-  \\ \nonumber
&=& \frac{1}{2}\left(1-\frac{\Delta}{\sqrt{\Delta^2+4g^2|\alpha|^2}}\right)\hat{n} + \frac{1}{2}\left(1+\frac{\Delta}{\sqrt{\Delta^2+4g^2|\alpha|^2}}\right)\hat{n}_e +  \mathcal{O}(1)\hat S^+ + \mathcal{O}(1)\hat S^-
\end{eqnarray}
\begin{equation}
U \hat S^+ U^\dag = \frac{\alpha^*}{\sqrt{\Delta^2+4g^2|\alpha|^2}}(\hat{n}-\hat{n}_e) + \mathcal{O}(1)\hat S^+ + \mathcal{O}(1)\hat S^-
\end{equation}
so that in total we find
\begin{equation}
U\tilde{H}U^\dag = \delta \ah^\dag \ah + (\varepsilon_1-i\gamma_-/2)\hat{n}+(\varepsilon_e-i\gamma_e/2)\hat{n}_e + (\zeta \ah^\dag + \zeta^* \ah)(\hat{n}-\hat{n}_e) + \mathcal{O}(1)\hat S^+ + \mathcal{O}(1)\hat S^-
\end{equation}
where
\begin{eqnarray}
\gamma_\pm = \frac{\gamma}{2}\left(1\pm \frac{\Delta}{\sqrt{\Delta^2+4g^2|\alpha|^2}}\right) \qquad \zeta = \frac{g^2\alpha}{\sqrt{\Delta^2+4g^2|\alpha|^2}}
\end{eqnarray}
Now using the fact that $i\dot{U}U^\dag$ is $\mathcal{O}(1)$ and acts on the qubits only (i.e. contains no $a$ or $a^\dag$ terms) we obtain the expression (3) from the main text for $\bar{H}$.





\subsection{Analytic solution of time evolution under $H_\eff$}
In this section we find the analytic solution of the Lindbladt equation $\dot{\rho} = -iH\rho+i\rho H^\dag +L\rho L^\dag -\frac{1}{2}\{L^\dag L, \rho\}$ under $H = \delta \ah^\dag \ah + (-i\gamma_-(t)/2 + \zeta(t)\ah^\dag + \zeta(t)^* \ah)\hat{n}$ and $L = \sqrt{\kappa}\ah$ for an arbitrary drive $\zeta(t)$ and time dependent decay rate $\gamma_-(t)$. For this, we assume an initial state $\rho(0) = \ket{\beta_n(0)}\bra{\beta_m(0)}\otimes\ket{q}\bra{q'}$, where $\beta_n$ and $\beta_m$ are coherent states and $\ket{q}$($\ket{q'}$) are computational basis states with $n$($m$) qubits in state $\ket{1}$. Note that initial states of this form are a basis of space of all possible initial density matrices, so solving  the Lindbladt equation for the initial state $\rho(0)$ suffices to solve it for an arbitrary initial state.

In the following we show that the solution to the Lindblad equation is given by 
\begin{equation}
\rho(t) = e^{i\theta_{nm}(t)}\frac{\ket{\beta_n(t)}\bra{\beta_m(t)} \otimes \ket{q}\bra{q'}}{\braket{\beta_m(t)|\beta_n(t)}}
\end{equation}
where $\dot{\beta}_n = -(i\delta+\kappa/2)\beta_n - in\zeta$, i.e.
\begin{equation}
\beta_n(t) = \beta_n(0)e^{-(i\delta+\kappa/2)t} -in\int_0^t \mathrm{d}t' \zeta(t')e^{-(i\delta+\kappa/2)(t-t')}
\label{eq:si_beta_n}
\end{equation}
and
\begin{equation}
\theta_{nm}(t) = \int_0^t \mathrm{d}t'  \left[ (m-n)(\zeta(t') \beta_m(t')^* + \zeta(t')^*\beta_n(t'))  
    + i(m+n)\gamma_-(t')/2\right].
\label{eq:si_theta_nm}
\end{equation}

To show this, we make the Ansatz $\rho = \rho_{nm} \otimes \ket{q}\bra{q'}$ with $\rho_{nm}(t) = c_{nm}(t) \ket{\beta_n(t)}\bra{\beta_m(t)}$. The Lindblad equation gives 
\begin{equation}
\dot{\rho}_{nm} = -iH_n\rho_{nm} +i\rho H_m^\dag  + L\rho_{nm} L^\dag -\frac{1}{2}\{L^\dag L, \rho_{nm}\},
\label{eq:si_lindblad_equation_Heff}
\end{equation}
 with $H_n = \delta \ah^\dag \ah + (-i\gamma_-/2 + \zeta \ah^\dag + \zeta^* \ah)n$.

We start by calculating the left side of Eq.~\eqref{eq:si_lindblad_equation_Heff}. It is a property of coherent states that
\begin{equation}
    \frac{\mathrm{d}}{\mathrm{d}t}\ket{\beta_n(t)} = \dot{\beta}_n \ah^\dag \ket{\beta_n}-\frac{1}{2}\frac{\mathrm{d}|\beta_n|^2}{\mathrm{d}t}\ket{\beta_n}
\end{equation}
so that
\begin{eqnarray}
    \dot{\rho}_{nm} = c_{nm}\dot{\beta}_n \ah^\dag \ket{\beta_n}\bra{\beta_m} + c_{nm}\dot{\beta}_m^* \ket{\beta_n}\bra{\beta_m}\ah + \left(\dot{c}_{nm}-\frac{c_{nm}}{2}\frac{\mathrm{d}(|\beta_n|^2+|\beta_m|^2)}{\mathrm{d}t}\right)\ket{\beta_n}\bra{\beta_m}
    \label{eq:error_cavity_lhs}
\end{eqnarray}
Now we evaluate the right side of Eq.~\eqref{eq:si_lindblad_equation_Heff}: 
\begin{eqnarray}
    H_n\rho_{nm}/c_{nm} &=& \delta\beta_n \ah^\dag\ket{\beta_n}\bra{\beta_m} + n\zeta \ah^\dag \ket{\beta_n}\bra{\beta_m} +n\zeta^*\beta_n\ket{\beta_n}\bra{\beta_m} - in\gamma_-/2 \ket{\beta_n}\bra{\beta_m}\label{eq:si_decay_error_Lnm1} \\
    \rho_{nm}H_m^\dag/c_{nm} &=& \delta\beta_m^* \ket{\beta_n}\bra{\beta_m}\ah + m\zeta^* \ket{\beta_n}\bra{\beta_m}\ah +m\zeta \beta_m^*\ket{\beta_n}\bra{\beta_m}+ im\gamma_-/2 \ket{\beta_n}\bra{\beta_m} \label{eq:si_decay_error_Lnm2}\\
    L\rho_{nm} L^\dag/c_{nm} &=& \kappa \beta_n\beta_m^*\ket{\beta_n}\bra{\beta_m} \label{eq:si_decay_error_Lnm3}\\
    \left\{L^\dag L, \rho_{nm} \right\}/c_{nm} &=& \kappa\beta_n \ah^\dag\ket{\beta_n}\bra{\beta_m} + \kappa\beta_m^* \ket{\beta_n}\bra{\beta_m}\ah
    \label{eq:si_decay_error_Lnm4}
\end{eqnarray}
Together, Eq.~\eqref{eq:si_decay_error_Lnm1}-\eqref{eq:si_decay_error_Lnm4} give
\begin{eqnarray}
\label{eq:error_cavity_rhs}
   -iH_n\rho_{nm} +i\rho_{nm} H_m^\dag  + L\rho_{nm} L^\dag -\frac{1}{2}\{L_{nm}^\dag L, \rho_{nm}\} &=& c_{nm}(-i\delta\beta_n -in\zeta-\kappa\beta_n/2)\ah^\dag\ket{\beta_n}\bra{\beta_m} \\
    &+& c_{nm}(i\delta\beta_m^* +im\zeta^*-\kappa\beta_m^*/2)\ket{\beta_n}\bra{\beta_m} \ah \nonumber \\
    &+& c_{nm}(-in\zeta^*\beta_n + im\zeta\beta_m^*+\kappa \beta_n\beta_m^*-(n+m)\gamma_-/2)\ket{\beta_n}\bra{\beta_m} \nonumber
\end{eqnarray}
Equating Eq.~\eqref{eq:error_cavity_lhs} and Eq.~\eqref{eq:error_cavity_rhs} gives Eq.~\eqref{eq:si_beta_n}, as well as
\begin{equation}
\dot{c}_{nm}/c_{nm} = \frac{1}{2}\frac{\mathrm{d}(|\beta_n|^2+|\beta_m|^2)}{\mathrm{d}t} -in\zeta^*\beta_n + im\zeta\beta_m^*+\kappa \beta_n\beta_m^*-(n+m)\gamma_-/2
\end{equation}
Now we take $c_{nm} = e^{i\theta_{nm}}/\braket{\beta_m|\beta_n}$. Using $\braket{\beta_m|\beta_n} = \exp\left(-\frac{1}{2}(|\beta_n|^2+|\beta_m|^2)+\beta_m^*\beta_n\right)$ we obtain
\begin{eqnarray}
i\dot{\theta}_{nm} &=& \frac{\dot{c}_{nm}}{c_{nm}} + \frac{\mathrm{d}}{\mathrm{d}t}\left(-\frac{1}{2}(|\beta_n|^2+|\beta_m|^2)+\beta_m^*\beta_n\right)\label{eq:si_theta_deriv}\\ \nonumber
&=& -in\zeta^*\beta_n + im\zeta\beta_m^*+\kappa \beta_n\beta_m^*-(n+m)\gamma_-/2 + \dot{\beta}_m^*\beta_n + \beta_m^*\dot{\beta_n}\\ \nonumber
&=& i(m-n)\zeta^*\beta_n + i(m-n)\zeta\beta_m^*-(n+m)\gamma_-/2
\end{eqnarray}
where in the last equality we inserted $\dot{\beta}_n = -(i\delta+\kappa/2)\beta_n - in\zeta$. Integrating Eq.~\eqref{eq:si_theta_deriv} gives Eq.~\eqref{eq:si_theta_nm}.

\subsection{Calculation of the Fidelity in the limit $T\rightarrow\infty$}
In the following we show that in the limit $T\rightarrow\infty$ and to first order in $\gamma$ and $\kappa$ the infidelity of protocol A is given by
\begin{equation}
 1-F = \left(\frac{\kappa}{4(1+2^{-N})\delta} + \frac{\gamma\delta}{2g^2}\right)N\theta.
 \label{eq:si_protocol_A_infid}
\end{equation}
In the limit $T\rightarrow\infty$ the solution to $\dot{\beta}_n = -(i\delta+\kappa/2)\beta_n - in\zeta$ can be obtained by an adiabatic approximation. For this, we insert $\dot{\beta}_n = 0$ and obtain 
\begin{equation}
\beta_n = \frac{-in\zeta}{i\delta+\kappa/2} \approx -\frac{n\zeta}{\delta} \left(1+i\frac{\kappa}{2\delta}\right).
\end{equation}
With Eq. (5) (main text) we obtain
\begin{equation}
    \theta_{nm} = (n^2-m^2)\theta +(m-n)^2\frac{i\kappa}{2\delta}\theta + i(m+n)\int_0^T \mathrm{d}t \gamma_-(t)/2
\end{equation}
where $\theta = \frac{1}{\delta}\int_0^T \mathrm{d}t |\zeta(t)|^2$.
Since in the limit $T\rightarrow\infty$ we have $\zeta \rightarrow 0$ we approximate
\begin{equation}
    \gamma_- = \frac{\gamma}{2}\left(1-\sqrt{1-4|\zeta|^2/g^2}\right) \approx \frac{\gamma|\zeta|^2}{g^2}
\end{equation}
so that
\begin{eqnarray}
    \frac{\theta_{nm}}{\theta} = n^2-m^2 + (m-n)^2\frac{i\kappa}{2\delta} + (m+n)\frac{i\gamma\delta}{2g^2}
\end{eqnarray}
Inserting this into Eq. (7) (main text) and using that
\begin{equation}
    \sum_{n,m=0}^N \binom{N}{n}\binom{N}{m} (m-n)^2 = 4^N\frac{N}{2}
\end{equation}
and
\begin{equation}
    \sum_{n=0}^N \binom{N}{n} (n+n) = 2^NN \qquad  \sum_{n,m=0}^N \binom{N}{n}\binom{N}{m} (n+m) = 4^NN
\end{equation}
we obtain Eq.~\eqref{eq:si_protocol_A_infid}.

\section{Protocol B}
\subsection{Eigenenergies of $H$ in perturbation theory}
In this section we calculate perturbations of the eigenenergies of $H$ in the limit $\eta\rightarrow 0$. To find the eigenenergy for a computational basis state $\ket{q}$ with $n$ qubits in state $\ket{1}$ it is sufficient to consider the three states $\ket{0,q}$, $\ket{1,q}$ and $\ket{\chi}=\hat S^+\ket{0,q}/\sqrt{n}$, where the first entry in a ket vector denotes the number of excitations in the cavity mode, and the second entry denotes the state of the qubits. Projected onto these three states, $H$ is given by
\begin{equation}
    H = \underbrace{\delta \ket{1,q}\bra{1,q} + \Delta\ket{\chi}\bra{\chi} + g\sqrt{N}(\ket{1,q}\bra{\chi} + \ket{\chi}\bra{1,q})}_{H_0} + \underbrace{i\eta \ket{1,q}\bra{0,q} -i\eta^*\ket{0,q}\bra{1,q}}_{V}
\end{equation}
Denote by $\ket{p_\pm}$ the eigenstates of $H_0$ and by $E_\pm$ their corresponding energies. The second order perturbation of the eigenenergy of $\ket{0,q}$ is
\begin{equation}
    \varepsilon_n = -\sum_j \frac{|\bra{0,q}V\ket{p_j}|^2}{E_j} = -\eta^2 \bra{1,q}H_0^{-1}\ket{1,q} = -\frac{|\eta|^2\Delta}{\Delta\delta - ng^2}
\end{equation}
The corresponding eigenstate is
\begin{equation}
    \ket{\psi_q(t)} = \ket{0,q} -i\frac{\eta(t)\left(\Delta \ket{1,q} - g\sqrt{n}\ket{\chi}\right)}{\Delta\delta - ng^2}
\end{equation}


\subsection{Effect of losses}
In this section we calculate process $\mathcal{E}_\eff$ of protocol B to first order in $\gamma$ and $\kappa$ in the adiabatic limit. We assume an initial state $\rho(0)= \ket{0,q}\bra{0,q'}$. Let $U(t)$ be unitary evolution in the absence of noise, and let $\tilde{\rho}(t) = U(t)^\dag \rho(t) U(t)$. Then
\begin{equation}
    \dot{\tilde{\rho}} = -\frac{\gamma}{2}U^\dag \hat{n}_eU \tilde{\rho} -\frac{\gamma}{2} \tilde{\rho}  U^\dag \hat{n}_eU + \kappa U^\dag \ah U\tilde{\rho} U^\dag \ah^\dag U - \frac{\kappa}{2} U^\dag \ah^\dag \ah U \tilde{\rho} - \frac{\kappa}{2} \tilde{\rho} U^\dag \ah^\dag \ah U 
\end{equation}
To first order in $\gamma$ and $\kappa$ we thus find using the adiabatic approximation $U(t)\ket{0,q} = e^{-i\varphi_n(t)}\ket{\psi_q(t)}$ with $\varphi_n(t)=\int_0^t \mathrm{d}t' \varepsilon_n(t')$ that
\begin{eqnarray}
    \tilde{\rho}(T) = \ket{0,q}\bra{0,q'} +\int_0^T \mathrm{d}t\Big[ &-&\frac{1}{2}e^{-i\varphi_n(t)}U^\dag(t) (\gamma \hat{n}_e + \kappa \ah^\dag \ah)\ket{\psi_q(t)}\bra{0,q'}\\ \nonumber &-&\frac{1}{2}e^{i\varphi_m(t)} \ket{0,q}\bra{\psi_{q'}(t)} (\gamma \hat{n}_e + \kappa \ah^\dag \ah)U(t)  \\ \nonumber &+& \kappa e^{-i(\varphi_n(t)-\varphi_m(t))}U^\dag(t) \ah \ket{\psi_q(t)}\bra{\psi_{q'}(t)}\ah^\dag U(t) \Big]
\end{eqnarray}
We obtain

\begin{eqnarray}
    c_{nm}:=e^{i(\varphi_n(t)-\varphi_m(t))}\bra{q}\mathcal{E}_\eff(\ket{q}\bra{q'})\ket{q'} &=& \sum_{k=0}^\infty \bra{k,q}\tilde{\rho}(T)\ket{k,q'}
\end{eqnarray}
Up to second order in $\eta$ only terms with $k=0$ contribute, so we obtain
\begin{eqnarray}
 c_{nm}= 1 + \int_0^T \mathrm{d}t \Big[ &-&\frac{1}{2}\bra{\psi_q(t)}(\gamma \hat{n}_e + \kappa \ah^\dag \ah)\ket{\psi_q(t)} -  \frac{1}{2}\bra{\psi_q'(t)}(\gamma \hat{n}_e + \kappa \ah^\dag \ah)\ket{\psi_q'(t)}\\ \nonumber
 &+& \kappa \bra{\psi_q(t)}\ah\ket{\psi_q(t)}\bra{\psi_q'(t)}\ah^\dag\ket{\psi_q'(t)}\Big].
\end{eqnarray}

Using that $\bra{\psi_q}\hat{n}_e\ket{\psi_q} = |\eta|^2g^2n/(\Delta\delta-ng^2)^2$, $\bra{\psi_q}\ah^\dag \ah \ket{\psi_q} = |\eta|^2\Delta^2/(\Delta\delta-ng^2)^2$ and $\bra{\psi_q(t)}\ah\ket{\psi_q(t)} = -i\eta\Delta/(\Delta\delta-ng^2)$ we find
\begin{equation}
    c_{nm} = 1 - \frac{\gamma_n+\gamma_m}{2} - \frac{s_n^2+s_m^2-2s_ns_m}{2}
\end{equation}
with
\begin{equation}
     \gamma_n = \frac{\gamma n g^2}{(\Delta \delta -ng^2)^2}I \qquad
    s_n = \frac{\sqrt{\kappa} \Delta}{\Delta \delta -ng^2}\sqrt{I}.
\end{equation}

\subsection{Using protocol B for arbitrary phase gates}
In this section we discuss how protocol B can be used to implement  phase gates $\exp(i\varphi(\hat{n}))$ for arbitrary $\boldsymbol{\varphi} = (\varphi(0),...,\varphi(N))$ (Here and in the following a bold font is used to indicate vector quantities). We aim to do this by applying $K$ pulses with detunings $\delta_1,...,\delta_K)$ and $\Delta_1,...,\Delta_K$, as well as driving fields $\eta_1(t),...,\eta_K(t)$ and corresponding pulse energies $\boldsymbol{I} = (I_1,...,I_K)$ with $I_k = \int_0^{T_k}|\eta_k(t)|^2\mathrm{dt}$. With this, we implement a phase gate with $\boldsymbol{\varphi} = A\boldsymbol{I}$, where $A$ is a $(N+1)\times K$ matrix with
\begin{equation}
    A_{nk} = -\frac{1}{\delta_k-n g^2/\Delta_k}.
\end{equation}
By adding the infidelities of the individual pulses we obtain an average gate infidelity $\boldsymbol{b}\cdot\boldsymbol{I}$, where
\begin{equation}
    b_k = \frac{1}{2^N(2^{N+1})} \left(\sum_{n=0}^N \binom{N}{n} \epsilon_k^{(n,n)} +\sum_{n,m=0}^N \binom{N}{n}\binom{N}{m} \epsilon_k^{(n,m)}   \right)
    \label{eq:si_bk_linear_program}
\end{equation}
with
\begin{equation}
    \epsilon_k^{(n,m)} = \gamma g^2 \left(\frac{n}{(\Delta_k\delta_k-ng^2)^2}+ \frac{m}{(\Delta_k\delta_k-mg^2)^2}\right) + \kappa\Delta^2 \left(\frac{1}{\Delta_k\delta_k-ng^2}- \frac{1}{\Delta_k\delta_k-ng^2}\right)^2.
\end{equation}
Thus, for a fixed set of detunings $\delta_1,...,\delta_K$ and $\Delta_1,...,\Delta_K$, finding the optimal values of $\boldsymbol{I}$ becomes a linear programming problem:
\begin{align*}
    \text{Find}\quad & \boldsymbol{I}\\
    \text{ that maximizes} \quad& \boldsymbol{b}\cdot \boldsymbol{I}\\
    \text{ subject to }&\quad A\boldsymbol{I} = \boldsymbol{\varphi}\\
    \text{ and } &\quad\boldsymbol{I} \geq 0
\end{align*}
The solution to this linear program can be readily found using the simplex method, which is implemented in various software packages.

Since the solution of the given linear program is always on an extremal point of the simplex given by $\quad A\boldsymbol{I} = \boldsymbol{\varphi}$ and $\boldsymbol{I} \geq 0$, there are exactly $N+1$ indices $k$ such that $I_k \neq 0$. To find the optimal pulse detunings one can thus take the following approach: First take $K \gg N$ and take the $\delta_1,...,\delta_K$ to form a uniformly spaced grid. Take $\Delta_k-\delta_k$ some constant independent of $k$ to ensure that the different pulses can be implemented by only changing the pulse frequency, not the frequency of the cavity or the $\ket{1}\leftrightarrow\ket{e}$ transition. Now the linear program given above is solved, giving $N+1$ indices $k_1$,..., $k_{N+1}$ at which $I_k \neq 0$. To implement the phase gate given by $\boldsymbol{\varphi}$, $N+1$ pulses with detunings $\delta_{k_1}$,...,$\delta_{k_{N+1}}$ and $\Delta_{k_1}$,...,$\Delta_{k_{N+1}}$ as well as pulse energies $I_{k_1},...,I_{k_{N+1}}$ have to be applied.

A reduction to $N-1$ instead of $N+1$ required pulses is obtained if one only aims to implement the phase gate $\exp(i\varphi(\hat{n}))$ up to a global phase and single qubit gates. Formally, this means replacing the constraint $A\boldsymbol{I} = \boldsymbol{\varphi}$ by
\begin{equation}
    \forall n \geq 2 \qquad (A\boldsymbol{I})_n - n(A\boldsymbol{I})_1+(n-1)(A\boldsymbol{I})_0 = \varphi_n
\end{equation}
Since this condition is still linear in $\boldsymbol{I}$, the optimal $\boldsymbol{I}$ can be found as before through a linear program.

With the procedure outlined above, $\boldsymbol{I}$ is chosen to maximize the average gate fidelity. For implementing a C$_{N-1}$Z gate, our goal is instead to maximize the minimal fidelity. This is not possible with our linear programming approach in a straight forward manner, so we resort to a heuristic approach. For this,  we replace the $b_k$ (Eq.~\eqref{eq:si_bk_linear_program}) by
\begin{equation}
    b_k = \frac{1}{(N+1)^2}\sum_{n,m=0}^N \epsilon_k^{(n,n)}
\end{equation}
and solve the corresponding linear program. Compared to Eq.~\eqref{eq:si_bk_linear_program} this approach has the advantage that it weights the performance of the gate for all $n$ and $m$ equally, while Eq.~\eqref{eq:si_bk_linear_program} weights terms with $n, m\sim N/2$ higher than terms with extreme $n$ and $m$. The resulting $\boldsymbol{I}$ are then used to evaluate the minimal fidelity. 

\section{Realistic gate fidelities and gate times for C\lowercase{a}F molecule}

In the main text, we presented an example with CaBr molecules coupled to a microwave resonator. Here we show the example of CaF molecules coupled to a microwave stripline cavity, as proposed in Ref.~\cite{rabl_hybrid_2006}. 
We adopt a local basis $\{\ket{N,S,J,I,F,m_F}\}$ where $N$ is the ro-vibrational number and the others are analogous to the usual atomic quantum numbers. For CaF we can choose the qubit states $\ket{0}=\ket{0,1/2,1/2,1/2,0,0}$, $\ket{1}=\ket{0,1/2,1/2,1/2,1,0}$ and $\ket{e}=\ket{1,1/2,1/2,1/2,1,0}$. Here $\omega_e \approx 2\pi \times 21$ GHz and coupling strength $g\approx 2\pi \times 10$ kHz on the $\ket{1}\leftrightarrow\ket{e}$ transition is achievable\cite{rabl_hybrid_2006}. Analogously to the main text we assume a quality factor $Q = 3 \times 10^{8}$, giving have $\kappa= \omega_e/Q= 2\pi \times 70 Hz$. Again we assume $\gamma < 10^{-2} $Hz \cite{buhmann_surface-induced_2008}, which can be neglected. With the states chosen for CaF, we have the $|0\rangle \leftrightarrow |e\rangle$ transition detuned from the $\ket{1} \leftrightarrow \ket{e}$ transition by $2\pi \times 125$ MHz. For the sake of completeness, we include this transition in our numerical calculations, despite it being highly detuned. 
For protocol A, by choosing $\Delta = \delta = 2\pi \times 100$ kHz we get the CZ gate infidelity as $1- F= 8.3 \times 10^{-4}$ for gate duration of $T = 200/g = 3.2$ ms. For the same set of parameters, protocol B gives a gate error of $1-F =  4.6\times 10^{-4}$ for a pulse duration of $T=300/g = 4.8$ ms. 



%\bibliography{library}



\end{document}
%
% ****** End of file apstemplate.tex ******


