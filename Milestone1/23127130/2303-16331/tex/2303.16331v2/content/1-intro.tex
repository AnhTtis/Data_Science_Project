\section{Introduction}

Decentralized finance (DeFi) aims to transfer the role of trusted but risky intermediaries to more robust decentralized structures.
A remaining weak link is in reliance on off-chain information, such as prices of reference assets, which need to be imported on-chain through oracles.
The issue is that oracle-reported prices cannot be proven on-chain because the price process (usually in USD terms) is not observable there.

Various oracle security models exist, as described in \cite{werner2021sok}, though for the most part, they always involve some sort of trusted party or medianizing of several trusted parties. Even alternatives like referencing time weighted average prices (TWAPs) on decentralized exchanges (DEXs) still essentially involve a trusted party. In particular, to price an asset in USD terms, the standard approach is to use a DEX pair with a USD stablecoin, which shifts the trusted party to the stablecoin issuer as a sort of oracle.
While real trades can be observed on-chain, which is a strength of this method, stablecoin issuers can become insolvent, censor transactions, or otherwise cause the stablecoin to depeg. A resilient oracle system would ideally handle the corner cases of stablecoin pricing.

In this paper, we explore a new direction in oracle design wherein an \emph{estimate} of an off-chain price can in principle verifiable on-chain, which is intended to be used in addition to other oracle methods.
We investigate the theoretical and empirical relationships between activity in on-chain markets and the overall pricing and liquidity in off-chain cryptocurrency markets (e.g., \{BTC, ETH\}/USD price. 
The motivation is to develop methods for proxying off-chain market data using data within an on-chain environment. 



We formalize this as the task of finding a function $f$ that maps on-chain observable data (or features for the machine learning model) to close estimates of off-chain prices, as visualized in Figure~\ref{fig:process-chart}.
We consider a variety of features: \emph{basic features} that are straightforward properties about the network, \emph{economic features} that are computed from basic features and are suggested by fundamental economic models of the network, and features that arise from the usage of DeFi protocols.
Ideally, a good $f$ will also have two further properties: (i) it is difficult/costly to manipulate the output of $f$ through manipulating the inputs, and (ii) outputs of $f$ are provable on-chain.
The hypothesis predicating this structure is that off-chain price data (e.g., in USD terms) is incorporated into the behavior of agents in on-chain markets (e.g., mining, block space, and DeFi markets) and that
on-chain data thus provides some information that can be recovered about the original off-chain prices, as visualized in Figure~\ref{fig:hypothesis-causality}.



\begin{figure}
	\centering
	\begin{subfigure}{0.75\textwidth}
			\centering
			\includegraphics[width=\textwidth]{figures/process-chart}
			\caption{}
			\label{fig:process-chart}
		\end{subfigure}%
	\begin{subfigure}{0.25\textwidth}
			\centering
			\includegraphics[width=\textwidth]{figures/hypothesis-causality}
			\caption{}
			\label{fig:hypothesis-causality}
		\end{subfigure}
	\caption{Proposed structure to estimate prices verifiably on-chain.}
	\label{fig:intro-charts}
\end{figure}



To understand the problem intuitively, compare with the usual financial price prediction problem, in which we would try to identify several drivers of future price and formulate a model to predict future prices with these drivers as features. The problem we consider is the reverse in some ways. In particular, we hypothesize that the price is a driving factor (probably one of many) behind the behavior of agents in on-chain markets, and we want to recover the current period price from the current state of on-chain market behaviors as features.




We explore this problem using a combination of economic theory about on-chain markets and data-driven analysis to explore the degree to which off-chain pricing information can be recovered from on-chain data. We find a meaningful price signal is recoverable as well as several strong empirical relationships with on-chain features. While it is not precise enough to use directly as an oracle, we discuss ways in which it could be used as a trustless sense check for oracle-reported prices. We finish by discussing several significant challenges that remain in developing and executing such a tool.