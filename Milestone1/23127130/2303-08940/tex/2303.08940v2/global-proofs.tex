\subsection{A \texorpdfstring{$\lambda$}{Lambda}-Calculus with Global State}

\subsubsection{General Lemmas}

\propnormalifffinal*

\maybehide{\input{proofs/normal-iff-final}} 

\proptypedunblock*

\maybehide{\input{proofs/lem-typability-implies-unblocked}} 

\begin{lemma}[Relevance]
    Let $\Phi \tr \seqi{\Gam}{t}{\gtype}{(b,m,d)}$ (resp. $\Phi' \tr \seqi{\Gam}{s}{\stype}{(b',m',d')}$). Then $\dom{\Gam} \subseteq \fv{t}$ (resp. $\dom{\Gam} \subseteq \fv{s}$).
\end{lemma}

\maybehide{\begin{proof}
    The proof following by induction over $\Phi$ (resp. $\Phi'$). Case $\Phi$ (resp. $\Phi'$) ends with rule (\ruleAx), (\ruleAxP), or (\ruleLamP) (resp. rule (\ruleEmp)), then $\Phi$ (resp. $\Phi'$) is clearly relevant. The other cases follow easily from the \ih.
\end{proof}}

\subsubsection{Soundness Lemmas (Auxiliary Lemmas)}

\lemzerocounters*

\maybehide{\input{proofs/lem-zero-counters-size-store}} 

\begin{lemma}
    \label{lem:zero-counters-normal}
    Let $\Phi \tr \seqi{\Gam}{t}{\del}{(0,0,d)}$ be tight. If $t \in \normal$, then $\del = \stype \ra \tightt \tim \stype'$ and $\stype =\stype'$.
\end{lemma}

\maybehide{\input{proofs/lem-zero-counters-normal}} 

\lemzeronfs*

\maybehide{\input{proofs/lem-zero-nfs}}

\begin{lemma}
    \label{lem:states-and-state-types}
    Let $\Phi \tr \seqi{\Del}{s}{\stype}{(b,m,d)}$. If $l \in \dom{\stype}$, then $l \in \dom{s}$.
\end{lemma}
  
\maybehide{\input{proofs/lem-states-and-state-types}} 

\begin{lemma}[{\bf Split Lemma}] \mbox{} 
    \label{lem:split-values-stores}
    \begin{enumerate}
        \item {(\bf Values)} \label{lem:com-split-values}  Let $\Phi_v \tr \seqi{\Gam}{v}{\M}{(b,m,d)}$, such that $\M = \sqcup_{\iI} \M_i$. Then, there exist ($\Phi^i_v \tr \seqi{\Gam_i}{v}{\M_i}{(b_i,m_i,d_i)})_{\iI}$, such that $\Gam = +_{\iI} \Gam_i$, $b = +_{\iI} b_i$, $m = +_{\iI} m_i$, and $d = +_{\iI} d_i$.
        \item {\bf (States)} \label{lem:split-state} Let $\Phi_s \tr \seqi{\Gam}{s}{\stype}{(b,m,d)}$, such that $l \in \dom{\stype}$. Then, $s \equivstate \upd{l}{v}{q}$, $\Phi_v \tr \seqi{\Gam_v}{v}{\stype(l)}{(b_v,m_v,d_v)}$ and $\Phi_q \tr \seqi{\Gam_q}{q}{\stype'}{(b_q,m_q,d_q)}$, such that $\Gam = \Gam_v + \Gam_q$, $\stype = \conj{(l : \stype(l))}; \stype'$, $b = b_v+b_q$, $m = m_v+m_q$, and $d = d_v + d_q$.
    \end{enumerate}
\end{lemma}

\maybehide{\input{proofs/lem-split-state}} 

\begin{lemma}
    \label{lem:comp-values-not-neutral}
    Let $\Phi \tr \seqi{\Gam}{t}{\tcomptype{\stype}{\tau}{\stype'}}{(b,m,d)}$. If $t \in \val$, then $\tau \neq \tneutral$.
\end{lemma}

\maybehide{\input{proofs/lem-comp-values-not-neutral}} 

\begin{lemma}
    \label{lem:comp-notabs-implies-negabs}
    Let $\Phi \tr \seqi{\Gam}{t}{\tcomptype{\stype}{\tau}{\stype'}}{(b,m,d)}$, such that $\Gam$ is tight. If $\tau \in \nott{\vl}$, then $\neg\isabs{t}$.
\end{lemma}

\maybehide{\input{proofs/lem-comp-notabs-implies-negabs}} 

\subsubsection{Completeness (Auxiliary Lemmas)}

\begin{lemma}[{\bf Merge for Values}]
    \label{lem:comp-merge-values}
    Let $(\Phi^i_v \tr \seqi{\Gam_i}{v}{\M_i}{(b_i,m_i,d_i)})_{\iI}$. Then, there exists $\Phi_v \tr \seqi{\Gam}{v}{\M}{(b,m,d)}$, such that $\Gam = +_{\iI} \Gam_i$, $\M = +_{\iI} \M_i$, $b = +_{\iI} b_i$, $m = +_{\iI} m_i$, and $d = +_{\iI}$.
\end{lemma}
We omit this proof given its similarity with the proof for system $\syscbv$.

\lemcomtightspreading*

\maybehide{\input{proofs/lem-comp-tight-spreading}} 

\typstates*

\maybehide{\input{proofs/lem-typ-states-type-nfs}} 

\subsubsection{Soundness and Completeness (Main Lemmas)}

\lemcompsubsantisubs*

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate}
        \item \input{proofs/lem-comp-subs}
        \item \input{proofs/lem-comp-antisubs}
    \end{enumerate}
\end{proof}}

\lemexactredexp*

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate} 
        \item \input{proofs/lem-comp-subj-red}
        \item \input{proofs/lem-comp-subj-exp}
    \end{enumerate}
\end{proof}}

\compsoundness*

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate}
        \item \input{proofs/thm-gs-soundness}
        \item \input{proofs/lem-comp-completeness}
    \end{enumerate}
\end{proof}}

