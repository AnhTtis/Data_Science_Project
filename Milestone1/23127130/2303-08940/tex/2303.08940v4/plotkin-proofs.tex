\subsection{Weak Open CBV}

\subsubsection{General Lemmas}

\begin{proposition}[{\bf Diamond}]
    \label{prop:diamond}
The relation $\redcbv$ enjoys the diamond property: if $t \redcbv t_i\ (i=1,2)$ and $t_1 \neq t_2$, then there exists $t_3$ such that $t_i \redcbv t_3\ i=1,2$.
\end{proposition}

\propcharnfs*

\maybehide{\input{proofs/prop-char-nfs}}
  
\begin{lemma}[Relevance]
    Let $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$. Then $\dom{\Gam} \subseteq \fv{t}$.
\end{lemma}

\maybehide{\begin{proof}
    The proof following by induction over $\Phi$. Case $\Phi$ ends with rule (\ruleAx) or (\ruleLamP), then $\Phi$ is clearly relevant. The other cases following easily from the \ih.
\end{proof}}

\subsubsection{Soundness (Auxiliary Lemmas)}

\begin{lemma}
    \label{lem:values-not-neutral}
    Let $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$. If $t \in \val$, then $\tau \not= \tneutral$.
\end{lemma}

\maybehide{\input{proofs/lem-values-not-neutral}}

\begin{lemma}
    \label{lem:notabs-implies-negabs}
    If $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$, such that $\Gam$ is tight. If $\tau \in \nott{\tabs}$, then $\neg\isabs{t}$.
\end{lemma}

\maybehide{\input{proofs/lem-notabs-implies-negabs}}

\begin{lemma}[{\bf Zero Steps and Normal Forms}]
    \label{lem:zero-steps-nfs}
    Let $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$ be tight. $b = 0$ iff $t \in \normal$.
\end{lemma}

\maybehide{\input{proofs/lem-zero-steps-nfs}}

\begin{lemma}
    \label{lem:corr-size-counter}
    Let $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$ be tight. If $b = 0$ then $s = \size{t}$.
\end{lemma}

\maybehide{\input{proofs/lem-corr-size-counter}}

\begin{lemma}[{\bf Split for Values}]
    \label{lem:split-values}
    Let $\Phi_v \tr \seqi{\Gam}{v}{\M}{(b,s)}$, such that $\M = \sqcup_{\iI} \M_i$. Then, there exist ($\Phi^i_v \tr \seqi{\Gam_i}{v}{\M_i}{(b_i,s_i)})_{\iI}$, such that $\Gam = +_{\iI} \Gam_i$, $b = +_{\iI} b_i$, and $s = +_{\iI} s_i$.
\end{lemma}

\maybehide{\input{proofs/lem-split-values}}

\subsubsection{Completeness (Auxiliary Lemmas)}

\begin{lemma}[{\bf Tight Spreading}]
    \label{lem:tight-spreading}
    Let $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$, such that $\Gam$ is tight:
    \begin{enumerate}
        \item \label{lem:tight-spreading:1} If $b = 0$ and $\tau$ is not an arrow type or a multi-type, then $\tau \in \tightt$.
        \item \label{lem:tight-spreading:2} If $t \in \neutral$, then $\tau \in \tightt$.
    \end{enumerate}
\end{lemma}

\maybehide{\input{proofs/lem-tight-spreading}}

\begin{lemma}[{\bf Typability of Normal Forms}]
    \label{lem:typ-nfs}
    If $t \in \normal$, then there exists a tight derivation $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$, such that $s = \size{t}$.
\end{lemma}

\maybehide{\input{proofs/lem-typ-nfs}}

\begin{lemma}[{\bf Merge for Values}]
    \label{lem:merge-values}
    Let $(\Phi^i_v \tr \seqi{\Gam_i}{v}{\M_i}{(b_i,s_i)})_{\iI}$. Then, there exists $\Phi_v \tr \seqi{\Gam}{v}{\M}{(b,s)}$, such that $\Gam = +_{\iI} \Gam_i$, $\M = +_{\iI} \M_i$, $b = +_{\iI} b_i$, and $s = +_{\iI}$.
\end{lemma}

\maybehide{\input{proofs/lem-merge-values}}

\subsubsection{Soundness and Completeness (Main Results)}

\begin{lemma}[{\bf Substitution and Anti-Substitution}]
    \label{lem:subsantisubs}
    \begin{enumerate} \mbox{}
        \item \label{lem:subs} Let $\Phi_t \tr \seqi{\Gam_t; x : \M}{t}{\tau}{(b_t,s_t)}$ and $\Phi_v \tr \seqi{\Gam_v}{v}{\M}{(b_v,s_v)}$, then there exists $\Phi_{t \subs{x}{v}} \tr \seqi{\Gam_t + \Gam_v}{t \subs{x}{v}}{\tau}{(b_t+b_v,s_t+s_v)}$.
        \item \label{lem:antisubs} Let $\Phi_{t \subs{x}{v}} \tr \seqi{\Gam_{t \subs{x}{v}}}{t \subs{x}{v}}{\tau}{(b,s)}$. Then, there exist $\Phi_t \tr \seqi{\Gam_t; x : \M}{t}{\tau}{(b_t,s_t)}$ and $\Phi_v \tr \seqi{\Gam_v}{v}{\M}{(b_v,s_v)}$, such that $\Gam_{t \subs{x}{v}} = \Gam_t + \Gam_v$, $b = b_t + b_v$, and $s = s_t + s_v$.
    \end{enumerate}
\end{lemma}

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate}
        \item \input{proofs/lem-subs}
        \item \input{proofs/lem-antisubs}
    \end{enumerate}
\end{proof}}

\begin{lemma}[{\bf Split Exact Subject Reduction and Expansion}]
    \label{lem:subjred-subjexp} \mbox{}
    \begin{enumerate} 
        \item \label{lem:subj-red} Let $\Phi_t \tr \seqi{\Gam}{t}{\tau}{(b,s)}$ be tight. If $t \dred t'$, then there exists $\Phi_{t'} \tr \seqi{\Gam}{t'}{\tau}{(b-1,s)}$.
        \item \label{lem:subj-exp} Let $\Phi_{t'} \tr \seqi{\Gam}{t'}{\tau}{(b,s)}$ be tight. If $t \dred t'$, then there exists $\Phi_t \tr \seqi{\Gam}{t}{\tau}{(b+1, s)}$.
    \end{enumerate}
\end{lemma}

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate}
        \item \input{proofs/lem-subj-red}
        \item \input{proofs/lem-subj-exp}
    \end{enumerate}
\end{proof}}

\begin{theorem}[{\bf Quantitative Soundness and Completeness}]
    \label{thm:soundnesscompleteness}
  \item \label{thm:soundness} If $\Phi \tr \seqi{\Gam}{t}{\tau}{(b,s)}$ is tight, then there exists $u \in \normal$ such that  $t \drred^b u$ with $\size{u} = s$.
  \item \label{thm:completeness} If $t \drred^b u$ with  $u \in \normal$, then there exists a tight type derivation $\Phi_t \tr \seqi{\Gam}{t}{\tau}{(b, \size{u})}$.
\end{theorem}

\maybehide{\begin{proof} \mbox{}
    \begin{enumerate} 
        \item \input{proofs/thm-soundness}
        \item \input{proofs/thm-completeness}
    \end{enumerate}
\end{proof}}
  

  



