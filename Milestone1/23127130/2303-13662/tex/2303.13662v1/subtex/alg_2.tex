\begin{algorithm}[t]
\begin{algorithmic}\State Initialize $\phi, \beta_{e^{(1)}}, ... , \beta_{e^E}$, learning rate $\gamma$.
\For{$\text{t in 0, 1, ..., }$}
\State Run forward pass and calculate gradient.
\For{$e \in \mathcal{E}$}
    \State select $\beta^{t}_{e'}$ with $e'  = \underset{e' \in \mathcal{E}  \backslash e }{\text{argmax}} \|\beta^{t}_e - \beta^{t}_{e'}\|_2$
    \State $\tilde{\beta}^{t+1}_e = \beta^{t}_e - \gamma \nabla_{\beta^{t}_e} \mathcal{L}_{PG-IRM+}$
    
    \State $\beta^{t+1}_e = \alpha
    \tilde{\beta}^{t+1}_e + (1 - \alpha)  \beta_{e'}$
\EndFor
\State Update $\phi^{t+1} = \phi^{t} - \gamma \nabla_{\phi^t} \mathcal{L}_{PG-IRM+}$.
\EndFor
\end{algorithmic}
\caption{\small Projected Gradient Descent}
\label{alg:proj_grad_appendix}
\end{algorithm}