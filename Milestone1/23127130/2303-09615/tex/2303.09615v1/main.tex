\documentclass[11pt,prd,reprint,twocolumn,notitlepage,nofootinbib]{revtex4-1}

\usepackage{float}
\usepackage{amsmath,bm}
\usepackage{amsfonts}
\usepackage{graphicx, adjustbox}
\usepackage{multirow}
\usepackage{aas_macros}
\usepackage{dblfloatfix}  
%\usepackage{listings}
\usepackage[title]{appendix}
\usepackage[usenames]{xcolor}
\usepackage{hyperref}

% matplotlib colors for text use
\definecolor{mpl_blue}{HTML}{1F77B4}
\definecolor{mpl_orange}{HTML}{FF7F0E}
\definecolor{mpl_green}{HTML}{2CA02C}
\definecolor{mpl_red}{HTML}{D62728}

\newcommand{\CiteNeed}{\textcolor{red}{\scriptsize[citation needed]}}
\newcommand{\CheckMe}{\textcolor{orange}{\scriptsize[check me]}}
\newcommand{\sjv}[1]{\textcolor{mpl_blue}{\it{\textbf{sjv: #1}}} }
\newcommand{\shashwat}[1]{\textcolor{mpl_green}{\it{\textbf{shashwat: #1}}} }

\newcommand{\libstempo}{\texttt{libstempo}}
\newcommand{\enterprise}{\texttt{enterprise}}
\newcommand{\entext}{\texttt{enterprise\_extensions}}
\newcommand{\ptmcmc}{\texttt{PTMCMCSampler}}

\date{\today}

\begin{document}

\title{Generalized optimal statistic for characterizing multiple correlated signals in pulsar timing arrays}

\author{Shashwat C.~Sardesai}
\affiliation{Center for Gravitation, Cosmology and Astrophysics, University of Wisconsin--Milwaukee, P.O. Box 413, Milwaukee WI, 53201, USA}

\author{Sarah J.~Vigeland}
\affiliation{Center for Gravitation, Cosmology and Astrophysics, University of Wisconsin--Milwaukee, P.O. Box 413, Milwaukee WI, 53201, USA}

\begin{abstract}
Pulsar timing arrays are sensitive to low-frequency gravitational waves (GWs), 
including the low-frequency stochastic gravitational wave background (GWB), 
which induces correlated changes in millisecond pulsars' timing residuals 
described by the Hellings-Downs curve. 
Some sources of noise can also induce correlated changes in pulsar timing residuals, 
albeit with different correlation signatures. 
A spatial correlation that differs from Hellings-Downs could also be indicative of non-Einsteinian GW polarizations. 
It is therefore crucial that we be able to characterize the spatial correlation 
in order to distinguish between the GWB and sources of noise. 
The optimal statistic (OS) is a frequentist estimator for the amplitude and significance of a spatially-correlated signal 
in PTA data, and it is widely used to search for the GWB. 
However, the OS cannot perfectly distinguish between different spatial correlations. 
In this paper, we introduce the multiple component optimal statistic (MCOS): a generalization of the OS that allows for multiple correlations to be simultaneously fit to the data. 
We use simulated data to show that this method more accurately recovers injected spatially correlated signals, 
and in particular reduces the risk of a false detection of a signal with the wrong spatial correlation. 
We also demonstrate that this method can be used to recover multiple correlated signals.
\end{abstract}

\maketitle

\section{Introduction}

When massive bodies such as black holes orbit each other, they radiate away energy in the form of gravitational waves (GWs), causing their orbit to shrink until they coalesce. Supermassive black hole binaries (SMBHBs), which form in galaxy mergers, emit low-frequency GWs over many orders of magnitude in frequency 
as they go from subparsec separations to coalescence. 
The incoherent superposition of GWs from a cosmological population of SMBHBs 
produces a stochastic GW background (GWB) in the nanohertz frequency range 
($\sim 10^{-9} - 10^{-7} \; \mathrm{Hz}$) \cite{2013CQGra..30x4009S, 2004ApJ...611..623S, 2019A&ARv..27....5B}.

Pulsars are rapidly spinning neutron stars that emit radio waves that can be observed by radio telescopes. Pulsars have very stable spin rates, 
which makes them ideal for detecting long-period gravitational waves 
\cite{1978SvA....22...36S, 1979ApJ...234.1100D, 1990ApJ...361..300F}. 
In pulsar timing arrays, pulsars essentially act as astronomical clocks, 
allowing us to measure small fluctuations in spacetime over years to decades. 
There are currently four regional PTA experiments: 
the North American Nanohertz Observatory for Gravitational Waves (NANOGrav) \cite{brazier+2019}, 
the European Pulsar Timing Array (EPTA) \cite{2016MNRAS.458.3341D}, 
the Parkes Pulsar Timing Array (PPTA) \cite{2016MNRAS.455.1751R}, 
and the Indian Pulsar Timing Array (InPTA) \cite{2022PASA...39...53T}. 
All of these groups collaborate and share data under the umbrella of the 
International Pulsar Timing Array (IPTA) \cite{pdd+2019}.

The presence of GWs induces correlated changes in the pulse times of arrival, 
with the correlation between two different pulsars depending on their angular separation 
on the sky according to the Hellings-Downs (HD) curve \cite{1983grg1.conf..963H}. 
This characteristic correlation allows us to distinguish between the GWB and 
other astrophysical and terrestrial effects that could affect the pulse times of arrival of many pulsars, such as solar wind, instrumentation errors, a clock error- seen as monopolar correlations, ephemeris errors- which manifest as dipolar correlations, etc. \cite{2012MNRAS.427.2780H,2016MNRAS.455.4339T,2020MNRAS.491.5951H}. 
A correlated signal with a correlation pattern 
that differs from the HD curve could also indicate the presence of 
non-Einsteinian GW polarizations \cite{Lee_2008,2012PhRvD..85h2001C,Gair_2015,Cornish_2018}.

It is therefore crucial to be able to distinguish 
between different cross-correlations. 
One method for doing this is using the OS, 
a frequentist estimator of the amplitude and significance of a correlated 
stochastic process, where the correlation function of interest 
is determined by specifying the overlap reduction function (ORF) 
\cite{2009PhRvD..79h4030A, 2013ApJ...762...94D, 2015PhRvD..91d4048C}. 
One limitation of the OS is that for any real PTA, 
it is not possible to perfectly distinguish between different ORFs. 
In general, the ORFs for different 
cross-correlations are not orthogonal, 
with the overlap between them 
depending on the number of pulsars and their sky locations \cite{2018PhRvD..98d4003V,2021ApJ...923L..22A}. 
In this paper, 
we address this issue by introducing a modified version of the 
OS that allows us to 
simultaneously search for multiple correlated OS signals (MCOS). As we show in this paper, 
this allows us to more accurately characterize the presence 
of correlated signals in PTA data.

This paper is organized as follows. 
In Sec.~\ref{sec:os}, we discuss the OS 
and derive a modified version that can simultaneously fit 
multiple correlation functions. 
In Sec.~\ref{sec:methods}, we describe the methods, signal models, 
and software used to generate and analyze simulated PTA data. 
We generated three types of simulated data sets: 
one containing a GWB (i.e., a common-spectrum process 
with HD correlations), another containing a common-spectrum process 
with GW-like monopole correlations, and finally a model with both a GWB, and GW-like monopole signal injected.
In Sec.~\ref{sec:results} we use the standard OS and 
our MCOS to analyze the simulated data sets. 
We find that simultaneously fitting multiple correlations 
using the MCOS prevents overestimating 
the presence of correlations that are not present, 
while not significantly affecting parameter estimation 
of correlated signals. 
We also demonstrate that the MCOS allows us 
to recover multiple correlated signals from the data. 
We summarize the paper and discuss future work in Sec.~\ref{sec:conclusions}.


\section{Optimal Statistic}
\label{sec:os}

The OS is a frequentist estimator of the amplitude and significance of the stochastic background. 
It only considers the cross-correlations between two different pulsars and not auto-correlation terms of individual pulsars. 
The OS is very fast to compute compared to performing an equivalent Bayesian analysis; 
however, the OS can be biased due to covariance between individual pulsar red noise and a common stochastic process. 
The noise-marginalized OS is a hybrid Bayesian-frequentist method that 
marginalizes over the pulsars' intrinsic red noise \cite{2018PhRvD..98d4003V}. 
It has been shown that this method more accurately estimates the amplitude of the GWB 
in the presence of intrinsic pulsar red noise compared to computing the OS with fixed pulsar red noise parameters.

One method to derive the OS
is to consider fitting the cross-correlations between pulsars to an ORF $\Gamma_{ab}$ with amplitude $A^2$ \cite{2013ApJ...762...94D, 2015PhRvD..91d4048C}. 
We can write the cross-correlation between two pulsars $\rho_{ab}$ as
\begin{equation} \label{eq:cross-corr}
    \rho_{ab} = \left\langle \delta \bold{t}_{a} \delta \bold{t}_{b}^{T} \right\rangle_{a \neq b} \,,
\end{equation}
where $\delta \bold{t}_{a}$ and $\delta \bold{t}_b$ are the timing residuals of two different pulsars ($a \neq b$). 
The chi-squared is
\begin{equation} \label{eq:CHI2}
	\chi^2 = \sum_{ab,a<b} \left( \frac{\rho_{ab} - A^2 \, \Gamma_{ab}}{\sigma_{ab}} \right)^2 \,,
\end{equation}
where $\sigma_{ab}$ are the uncertainties in the cross-correlations and contain contributions from both the common process and intrinsic noise, as shown in \cite{2015PhRvD..91d4048C}. 
The OS is the value of $A^2$ that minimizes the chi-squared:
\begin{equation} \label{eq:os_A2}
	\hat{A}^2 = \frac{\sum_{ab} (\rho_{ab} \Gamma_{ab}/\sigma_{ab}^2)}{\sum_{ab} (\Gamma_{ab}^2/\sigma_{ab}^2)} \,.
\end{equation}
The uncertainty in $\hat{A}^2$ can be found through simple propagation of errors:
\begin{equation} \label{eq:os_err}
	\sigma_{\hat{A}^2}^2 = \left[ \sum_{ab} \left(\frac{\Gamma_{ab}^2}{\sigma_{ab}^2}\right) \right]^{-1} \,.
\end{equation}
The corresponding signal-to-noise ratio (S/N) is
\begin{equation} \label{eq:10}
    \mathrm{S}/\mathrm{N} = \frac{\hat{A}^2}{\sigma_{\hat{A}^2}} \,.
\end{equation}

The OS as derived above assumes the presence of only one spatially correlated process in our data. 
It is possible that PTA data could contain multiple spatially correlated processes, 
e.g., a GWB and a common correlated source of noise.  
As discussed in \citet{2016MNRAS.455.4339T}, some noise sources can produce spatially correlated signals -- 
a clock error appears in PTA data as a common process with monopolar correlations 
between different pulsars, while an ephemeris error produces dipolar correlations. 


If more than one spatially-correlated process is present, the chi-squared becomes
\begin{equation} \label{eq:CHI2 MCOS}
	\chi^2 = \sum_{ab} \left( \frac{\rho_{ab} - \sum_\alpha A_\alpha^2 \, \Gamma^\alpha_{ab}}{\sigma_{ab}} \right)^2 \,,
\end{equation}
where $\alpha$ indexes the different spatially-correlated signals. Minimizing the chi-squared with respect to the amplitude squared value $A_\alpha^2$ gives
\begin{equation} \label{eq:CAB}
	C^\beta - \sum_\alpha \hat{A}_\alpha^2 B^{\alpha\beta} = 0 \,,
\end{equation}
where
\begin{eqnarray}
	C^\beta &\equiv& \sum_{ab} \frac{\rho_{ab} \Gamma_{ab}^\beta}{\sigma_{ab}^2} \,, \label{eq:MCOS_C} \\
	B^{\alpha\beta} &\equiv& \sum_{ab} \frac{\Gamma_{ab}^\alpha \Gamma_{ab}^\beta}{\sigma_{ab}^2} \,. \label{eq:MCOS_B}
\end{eqnarray}
Therefore, $\hat{A}^2_\alpha$ is given by
\begin{equation} \label{eq:OS_MCOS_A2}
	\hat{A}^2_\alpha = \sum_\beta B_{\alpha\beta} C^\beta \,,
\end{equation}
where $B_{\alpha\beta}$ is the inverse of $B^{\alpha\beta}$. 
This is a more general form of Eq.~\eqref{eq:os_A2}: 
when we generalize to multiple ORFs, 
the numerator of Eq.~\eqref{eq:os_A2} becomes $C^\beta$, 
while the denominator becomes $B_{\alpha\beta}$. 
The uncertainty in $\hat{A}^2_\alpha$ is
\begin{equation} \label{eq:OS_MCOS_err}
    \sigma_{\hat{A}^2_\alpha}^2 = B_{\alpha\alpha} \,.
\end{equation}


\section{Methods and Software}
\label{sec:methods}

In this section we describe how to construct the pulsar timing model, including the intrinsic and common red noise, 
and discuss how to retrieve the injected signals. 
We based our simulated data sets on the NANOGrav 12.5-year data set \cite{2021ApJS..252....4A}, 
with the pulsar positions, observing spans, cadences, and white and red noise all taken from that data set. 
In addition, we inject two different kinds of stochastic backgrounds: 
one with HD correlations (i.e., a GWB), and one with GW-like monopolar correlations. 
The methods used are similar to those used in the NANOGrav 12.5-year GWB paper \cite{2020ApJ...905L..34A}: 
below we briefly describe them, highlighting how our methods differ from those in \cite{2020ApJ...905L..34A}.

\subsection{PTA model}

We model the timing residuals for a pulsar $\delta \bold{t}$ as
    \begin{equation} \label{eq:PTA model}
       \delta \bold{t} = M \epsilon + F \bold{a} + \bold{n} \,,
    \end{equation}
\noindent where $M \epsilon$ describes perturbations to the timing model, 
$F \bold{a}$ describes red noise, including both individual pulsar red noise 
and a common stochastic process affecting all of the pulsars, 
and $\bold{n}$ is the uncorrelated white noise. 
We model the red noise using a Fourier series with frequencies $f = 1/T, 2/T, \ldots$, 
where $T$ is the span of the observations, 
and use a power-law model for the power spectral density 
\begin{equation}
    P(f) = \frac{A^2}{12 \pi^2} \left(\frac{f}{f_\mathrm{yr}}\right)^{-\gamma} \mathrm{yr}^3 \,,
    \label{eq:rn_psd}
\end{equation}
where $A$ is the amplitude, 
defined at a reference frequency of $f_\mathrm{yr} = 1/(1 \; \mathrm{year})$, 
and $\gamma$ is the spectral index. 

\subsection{Common stochastic process}

In addition to pulsar red noise and white noise, 
we also include the presence of a common stochastic process. 
For all types of stochastic backgrounds, 
we model the power spectrum as a power law as described in Eq.~\eqref{eq:rn_psd} with $A_\mathrm{gw} = 2 \times 10^{-15}$ and $\gamma = 13/3$. 
The value of $\gamma$ corresponds to that for a GWB made from GWs from 
circular SMBBHs evolving only due to GW emission \cite{2001astro.ph..8028P}. 

We model two different types of stochastic process: 
one with HD correlations, as is expected for a GWB;  
one with spatial correlations described by a GW-like monopole (GWMO); 
The ORF for HD correlations is \cite{1983grg1.conf..963H,2015AmJPh..83..635J}
\begin{eqnarray}
    \Gamma^{\mathrm{HD}}_{ab}(\xi) &=& \frac{\delta_{ab}}{2} + \frac{1}{2} - \frac{(1-\cos\xi)}{4} \left[\frac{1}{2} \right. \nonumber \\
        && \left. - 3 \ln \left(\frac{1-\cos\xi}{2}\right)\right] \,, \label{eq:ORF HD}
\end{eqnarray}
where $\Gamma^{\mathrm{HD}}_{ab}$ is the HD ORF for pulsars with indices $a$ and $b$, and 
$\xi$ is the angular separation between them. 
Note that the maximum correlation between two different pulsars (i.e., $a \neq b$) is $1/2$: 
this is because the GWB induces an Earth term and a pulsar term in each pulsar's residuals, 
and only the Earth terms are correlated. 
The GWMO was introduced in \cite{2021ApJ...923L..22A} and 
the ORF takes the form
\begin{equation}
    \Gamma^{\mathrm{GWMO}}_{ab}(\xi) = \frac{1}{2} + \frac{\delta_{ab}}{2} \,. \label{eq:ORF GWMO}
\end{equation}
The cross-correlation for two different pulsars is $1/2$ rather than $1$ 
because we are assuming the signal has two components: an ``Earth term'' that is correlated 
and a ``pulsar term'' that is uncorrelated (hence why it is described as ``GW-like''). 
The GWMO does not correspond to any physical process, 
but it is similar to the ORF 
produced by a scalar-tensor mode.

\subsection{Simulated data sets}

We use \libstempo~\cite{vallisneri_libstempo_2020} to generate our simulated data sets. 
The simulated data sets are based on the NANOGrav 12.5-year data set \cite{2021ApJS..252....4A}. 
We use the linearized timing models for the pulsars in the 12.5-year data set, 
as well as the dates and times of each observation. We first idealize our pulsar timing residuals and then add uncorrelated white noise 
equal to the measured TOA uncertainties. 
We add pulsar intrinsic red noise, with the maximum likelihood values taken from a Bayesian run of the NANOGrav 12.5-year data set with the values given (see Appendix \ref{app:pulsar_noise}). 
Finally, we add a common stochastic process. 

\subsection{Optimal statistic calculation}

In order to compute the OS, we must specify values for the pulsars' intrinsic white noise and red noise. 
The white noise parameters are the maximum-likelihood values from Bayesian noise analyses where each pulsar is run individually. 
The red noise parameters come from a Bayesian analysis of all the pulsars that simultaneously fits for pulsar intrinsic red noise 
and a common uncorrelated stochastic process. The white noise parameters are not searched over in the Bayesian analysis 
and are instead fixed to the maximum-likelihood values. 
We use uniform priors for the red noise parameters, 
$\log_{10}A \in [-20,-11]$ and $\gamma \in [0, 7]$, 
and the common process amplitude, 
$\log_{10} A_\mathrm{gw} \in [-18, -11]$, while the common process $\gamma_{\mathrm{gw}}$ is fixed to 13/3.
We use \enterprise~\cite{enterprise} and \entext~\cite{ent_ext} to implement the models and compute the likelihood, 
and we use Markov Chain Monte Carlo (MCMC) methods to obtain samples from the posterior 
as implemented in \ptmcmc~\cite{ptmcmc}.

We then compute the OS, 
using the results of the Bayesian analysis 
to determine the pulsar intrinsic red noise 
and common uncorrelated stochastic process. 
There are two ways of doing this. 
The \textit{fixed-noise} version computes the OS at a single noise realization using the red noise values that maximize the likelihood of the Bayesian analysis. 
The \textit{noise-marginalized} version pulls red noise values from the posteriors obtained by the Bayesian analysis in order to compute the OS at many different noise realizations. 
This results in distributions for $\hat{A}^2$ and $\sigma$. 

\begin{figure}[ht]
    \centering
    \includegraphics[width=\columnwidth]{figs/ORFS.png}
    \caption{Comparison between HD (blue), monopole (red), dipole (green), and GWMO (purple) ORFs as a function of angular separation between pulsars. The solid black line indicates a zero amplitude correlation.
    Note that a GWMO has the same functional form as the standard monopole, 
    but a different normalizaton.
    }
    \label{fig:ORFs}
\end{figure}

We can compute the OS for different correlations by using different ORFs. 
In addition to the HD and GWMO ORFs given in Eqs.~\eqref{eq:ORF HD} and \eqref{eq:ORF GWMO}, 
we also consider a standard dipole ORF and monopole ORF:
\begin{eqnarray} \label{eq:ORFs}
    \Gamma^{\mathrm{dipole}}_{ab}(\xi) &=& \cos\xi \,, \\ \label{eq:ORF DI}
    \Gamma^{\mathrm{monopole}}_{ab}(\xi) &=& 1 \,. \label{eq:ORF MO}
\end{eqnarray}
In Figure~\ref{fig:ORFs}, we plot all four ORFs used in this paper. Note that the monopole and GWMO are both constant as a function of angular separation, 
but the monopole as a value of $1$ while the GWMO as a value of $1/2$. This means that any signal that fits one will also fit the other, 
but the inferred amplitudes will differ because the two ORFs have different normalizations. 

We can measure the overlap between different ORFs by computing the ``match statistic'' \cite{2016PhRvD..93j4047C, 2017PhRvD..95d2002T},
\begin{equation} \label{eq:orf_match}
    \Bar{M} = \frac{\sum_{a,b\neq a} \Gamma_{ab} \Gamma'_{ab}}{\sqrt{(\sum_{a,b\neq a} \Gamma_{ab} \Gamma_{ab}) (\sum_{a,b\neq a} \Gamma'_{ab} \Gamma'_{ab})}} \,,
\end{equation}
where $\Gamma$ and $\Gamma'$ are two different ORFs. 
This overlap depends on the number of pulsars in the PTA and their sky locations. 
Table \ref{tab:matchstat} lists the match statistics for the four ORFs considered in this paper for our simulated PTA, which is based on the NANOGrav 12.5-year data set.

\input{table_orfs}

\section{Results}
\label{sec:results}

Here we present the results of analyzing our simulated data sets 
using the standard OS calculation and the modified MCOS. 
We show two types of simulations: 
one with an injected GWB (i.e., 
a common stochastic process with HD correlations), and one with both HD and GWMO correlations. 
We present the recovered OS values and 
corresponding signal-to-noise ratios (S/N) 
for different spatial correlations, 
and compare them to the injected values. We also note the number of realizations with an S/N $\geq$ 3 in Appendix \ref{app:tables}.

We also look at how much the data preferred models 
with multiple correlated signals 
using the Akaike Information Criterion (AIC) \cite{Akaike1998}, 
which is a frequentist analog for the Bayes factor. It is given by
\begin{equation} \label{eq:AIC}
   \mathrm{AIC} = 2k + \chi^2  \,,
\end{equation}
\noindent where $k$ is the number of model parameters (i.e., the number of correlated signal amplitudes), 
and the chi-squared is given by Eq.~\eqref{eq:CHI2} for a single correlated signal 
and Eq.~\eqref{eq:CHI2 MCOS} for multiple correlated signals. 
The factor of $2k$ acts as an Occam's penalty for adding more parameters to a model. 
We compute $\chi^2$ using the maximum-likelihood red noise parameters. 
The relative probability of two models is then given by
\begin{equation} \label{eq:AIC comparison}
    p(\mathrm{AIC}) = e^\frac{(\mathrm{AIC} - \mathrm{AIC_{min}})}{2} \,,
\end{equation}
\noindent where $\mathrm{AIC_{min}}$ is the minimum AIC value out of all available models. These results are also presented in Appendix \ref{app:tables}.

\subsection{GWB simulation}

We created 200 simulations with an injected GWB 
(i.e., a common stochastic signal with HD correlations), 
%We model the signal using a power-law PSD with $\gamma=13/3$ and 
%$A_\mathrm{gw} = 2 \times 10^{-15}$. 
which we analyzed using the traditional OS and the MCOS. 
A complete summary of the results can be found in Table~\ref{tab:hd_sim_results} in Appendix~\ref{app:tables}. 
When we search for one spatial correlation at a time, 
we find a S/N $>3$ for HD correlations in 17\% of the simulations, 
but we also find S/N $>3$ for monopole and dipole correlations 
in 6\% and 5\% of the simulations, respectively, even though there are no monopole-correlated or dipole-correlated signals present in the data sets. 
In Figure~\ref{fig:HD_os_indv}, 
we show histograms for the recovered distributions of $\hat{A}^2$ 
and the S/N for HD, monopole, and dipole correlations. 
On average, we recover higher S/N of HD correlations 
than for monopole or dipole correlations; 
however, we recover S/N $>0$ 
for monopole and dipole correlations in more than half of the simulations, as shown by the dotted lines in Fig. \ref{fig:HD_os_indv}.

\begin{figure}[t]
    \centering
    \includegraphics[width=\columnwidth]{figs/hd_individual.png}
    \vspace{-0.2in}
    \caption{Noise-marginalized OS analysis of 200 simulations
    with an injected GWB. 
    We show results using HD (blue), monopole (red), and dipole (green) ORFs. The left hand columns show the distributions of $\hat{A}^2$, whereas the right hand columns show the S/N histograms.
    The vertical blue line in the top left plot indicates the injected value of $A^2_\mathrm{HD} = 4 \times 10^{-30}$. The colored dashed lines in the S/N plots are the means of the respective ORFs. We find a mean $\hat{A}^2 > 0$ and mean S/N $>0$ for monopole and dipole correlations even though neither were injected in the data.}
    \label{fig:HD_os_indv}
\end{figure}

%\input{table_hd_results}

Figure~\ref{fig:p-p hd diagram} shows $p-p$ plots 
for the recovered $\hat{A}^2$ 
using HD, monopole, and dipole correlations. 
For each simulation, we compute the noise-marginalized mean $\hat{A}^2$ and mean $\sigma_{\hat{A}^2}$, 
and then compute the percentile of the injected value\footnote{We assume the distribution of the OS is a Gaussian centered around the mean value with variance equal to $\sigma$, as has been done in previous work. However, an upcoming paper will show that the OS actually follows a generalized chi-squared distribution.} 
for that type of correlation
($A^2_\mathrm{HD} = 4 \times 10^{-30}$, $A^2_\mathrm{Monopole} = A^2_\mathrm{Dipole} = 0$). 
We then plot the cumulative fraction of realizations for which the 
injected value is at a given percentile or higher. 
If the parameters are accurately recovered, 
we would expect the cumulative number of realizations to equal the percentile: if it does not, that indicates the parameter is being overestimated or underestimated. 
We find that the amplitude of HD correlations is underestimated, which agrees with the results of previous studies of the OS \cite{2018PhRvD..98d4003V}, 
while the amplitudes of monopole and dipole correlations (which were not injected) are overestimated.

\begin{figure}[t]
    \centering
    \includegraphics[width=\columnwidth]{figs/pp_hd_ind.png}
    \vspace{-0.2in}
    \caption{$p-p$ plot for the GWB injected simulations, the horizontal axis is the percentile of the injected $A_\mathrm{corr}^2$ relative to the recovered distribution $\hat{A}^2$. The vertical axis represents the cumulative number of realizations with the particular percentile. The models shown here are HD (top left), monopole (top right), and dipole (bottom left). If the parameters are recovered accurately (neither over or underestimated), the two quantities would be equal (center dashed line), the other dashed lines represent an error of 1 and 2 $\sigma$.}
    \label{fig:p-p hd diagram}
\end{figure}

In contrast, the MCOS more accurately recovers the amplitude of monopole and dipole correlations. 
We show the recovered distributions of $\hat{A}^2$ and the S/N 
for models consisting of multiple correlations 
in Figure~\ref{fig:HD_os_hd_mo}.
The distributions for the amplitude and S/N of HD correlations 
are similar to those obtained when fitting for only HD correlations 
(Figure~\ref{fig:HD_os_indv}, top row), 
but now the distributions for the amplitude and S/N of monopole and dipole correlations 
are centered around zero. 

\begin{figure}[t]
    \centering
    \includegraphics[width=0.4\textwidth]{figs/hd_mccs.png}
    \vspace{-0.2in}
    \caption{MCOS analysis of 200 simulations for GWB simulations for the HD+monopole+dipole ORFs. The left hand column contains histograms of $\hat{A}^2$ and the right hand column contains histograms for the S/N. The solid light blue line is the injected value of $A^2_{\mathrm{HD}} = 4 \times 10^{-30}$. The colored dashed lines in the S/N plots are the means of the respective ORFs. The recovered amplitudes and S/N for monopole and dipole correlations are centered around zero, unlike in Fig.~\ref{fig:HD_os_indv}.}
    \label{fig:HD_os_hd_mo}
\end{figure}

The $p-p$ plots, shown in Figure~\ref{fig:hdsim_pp_mcos}, also show that the MCOS analysis recovers the injected parameters more accurately. 
As before, the amplitude of HD correlations is underestimated, 
but this analysis recovers the amplitude of monopole and dipole correlations much more accurately. 

\begin{figure}[t]
    \centering    \includegraphics[width=0.75\columnwidth]{figs/pp_hd_mccs.png}
    \vspace{-0.2in}
    \caption{$p-p$ plot for the MCOS GWB injected simulations. The model shown here are for the MCOS with HD+monopole+dipole calculated simultaneously. The horizontal axis is the percentile of the injected $A_\mathrm{corr}^2$ relative to the recovered distribution $\hat{A}^2$. The vertical axis represents the cumulative number of realizations with the particular percentile.}
    \label{fig:hdsim_pp_mcos}
\end{figure}

Table~\ref{tab:hd_sim_results} lists the percentage of simulations 
for which each model is preferred.
The model with only HD correlations is the most preferred in 51.5\% of simulations, as expected, considering our injection has only one signal present. The standard monopole and monopole+HD model have nearly the same preference.
We note that these simulations include relatively low-significance HD correlations, 
as can be seen by the fact that the HD S/N $> 3$ in only 17\% of simulations.
but the percentage of models with an HD S/N $> 3$ does not change drastically between the individual and MCOS models.
This means that it is difficult to distinguish between different correlations. Nevertheless, the MCOS analysis allows us to search for the presence of spatial correlations 
and compute the relative probability of different models.


\subsection{GWB + GWMO simulations}

Finally, we looked at how well the MCOS could recover 
multiple correlated signals. 
We generated 200 simulations that contained two stochastic processes: 
one with HD correlations and one with GWMO correlations. 
We used the same amplitude and spectral index $\gamma=13/3$ for both processes. 
We summarize the results of analyzing these simulations in Table~\ref{tab:hd+gwb_sim_results} in Appendix \ref{app:tables}. 

When we analyze the simulations for a single correlation, we find S/N $>3$ for HD correlations in 27\% 
of simulations and for GWMO in 56\% of simulations. 
We note that the average correlation coefficient for HD correlations is lower than 
the average correlation coefficient for GWMO correlations, which explains why 
the single correlation OS recovers the GWMO signal better than the HD signal. 
As shown in Figure~\ref{fig:gwmo+hd_os_indv}, we recover the GWMO signal 
with higher mean S/N than the HD signal. 
We also recover a dipole signal with S/N $>3$ in 21\% of simulations 
even though no such signal has been injected. 
Figure~\ref{fig:pp_hd+gwmo_ind} shows $p-p$ plots for HD, monopole, dipole, 
and GWMO correlations. 
Fitting with only HD correlations results in an overestimate of amplitude, 
while fitting with only GWMO correlations 
fairly accurately recovers the injected amplitude of the GWMO signal. 
Fitting with the monopole correlation significantly underestimates 
the strength of the signal because of the incorrect normalization. 
We also see that the amplitude of a dipolar process (which is not present in the data) 
is significantly overestimated.

\begin{figure}[t]
        \centering
        \includegraphics[width=\columnwidth]{figs/hd+gwmo_individual.png}
    \vspace{-0.2in}
        \caption{Individual correlated signal analysis for 200 GWMO+GWB simulations. Similar to Fig. \ref{fig:HD_os_indv}, histograms of $\hat{A}^2$ and S/N on the left and right hand columns respectively. From top to bottom, the ORFs are HD (blue), monopole (red), dipole (green), and GWMO (purple). The solid light blue line indicates the injected OS of $A_\mathrm{HD}^2 = 4 \times 10^{-30}$ and $A_\mathrm{GWMO}^2 = 4 \times 10^{-30}$. The colored dashed lines in the S/N plots are
the means of the respective ORFs.}
        \label{fig:gwmo+hd_os_indv}
\end{figure}

\begin{figure}[t]
        \centering
        \includegraphics[width=0.5\textwidth]{figs/pp_hd+gwmo_ind.png}
    \vspace{-0.2in}
        \caption{The $p-p$ plots of the GWB+GWMO simulations for the individual analysis of (clockwise from top-left) HD, standard monopole, GWMO, and dipole. The horizontal axis is the percentile of the injected $A_\mathrm{corr}^2$ relative to the recovered distribution $\hat{A}^2$, and the vertical axis is the cumulative number of realizations that meet that percentile. If the parameters are recovered accurately (neither over or underestimated), the two quantities would be equal (central dashed line), the other dashed lines indicate an error of 1 and 2 $\sigma$. }
        \label{fig:pp_hd+gwmo_ind}
\end{figure}

When we use the MCOS to fit for multiple correlations, 
we find that we are able to recover both the HD and GWMO correlations. 
Figure~\ref{fig:gwmo+hd_os_hd_gwmo} shows the recovered amplitudes and S/N, 
while Figure~\ref{fig:pp_hd+gwmo_hd_mo} shows $p-p$ plots for the recovered amplitudes. 
We find that the amplitudes for both the HD and GWMO correlations are underestimated. 
On average, the GWMO signal is recovered with a higher S/N than the HD signal. 
We also see that the dipole amplitude is no longer overestimated. 
Furthermore, including a signal with dipole correlations in the model 
does not significantly affect the parameter estimation of the HD and GWMO signals.

We note that in both Fig. \ref{fig:pp_hd+gwmo_ind} and Fig. \ref{fig:pp_hd+gwmo_hd_mo} the GWMO signal lies away from the diagonal, although it does remain within the $2\sigma$ confidence intervals. We note that the OS is derived in the weak-signal limit \cite{2009PhRvD..79h4030A, Ellis_2013}. 
Given the strength of the GWMO signal used in the simulation, it is likely that the uncertainty in $\hat{A}^2_\mathrm{GWMO}$ is being underestimated.

\begin{figure}[!h]
        \centering
        \includegraphics[width=\columnwidth]{figs/hd+gwmo_hd_gwmo.png}
        \includegraphics[width=\columnwidth]{figs/hd+gwmo_gwmccs.png}
    \vspace{-0.2in}
        \caption{HD and GWMO multiple correlated signal analysis for 200 GWB+GWMO simulations. Similar to Fig. \ref{fig:HD_os_indv}, histograms of the $\hat{A}^2$ and S/N on the left and right hand columns respectively. The solid light blue line indicates the injected OS of $A_\mathrm{HD}^2 = A_\mathrm{GWMO}^2 = 4 \times 10^{-30}$. The colored dashed lines in the S/N plots are the means of the respective ORFs.}
        \label{fig:gwmo+hd_os_hd_gwmo}
\end{figure}

\begin{figure}[t]
        \centering
    \includegraphics[width=\columnwidth]{figs/pp_gwmo+hd_mccs4.png}
    \vspace{-0.2in}
        \caption{The $p-p$ plots for the MCOS analysis of the  GWB+GWMO injections using a model with HD+GWMO+DI. The horizontal axis is the percentile of the injected $A_\mathrm{corr}^2$ relative to the recovered distribution $\hat{A}^2$.}
        \label{fig:pp_hd+gwmo_hd_mo}
\end{figure}

\section{Conclusions}
\label{sec:conclusions}

In this paper, we present a generalization of the OS
that can simultaneously search for multiple correlated signals. 
As we have shown, this allows us to better distinguish between different spatial correlations. 
For a real PTA, the ORFs corresponding to different correlations are not orthogonal, 
and the overlap between them can lead to false detections of spatial correlations. 
The MCOS reduces the probability of a false detection 
and more accurately recovers correlation amplitudes. 
We have performed model selection by computing the AIC, 
which acts as a pseudo-Bayes factor.

We have tested this method using simulated data sets 
containing stochastic signals with HD and GWMO correlations, 
and showed that we were able to identify the type of correlation with the MCOS. 
We also generated simulated data sets that contained both stochastic signals: 
HD and GWMO correlations simultaneously. 
We demonstrated that the MCOS allows both signals to be 
recovered while ruling out any non injected signals.

In this work, we have considered four types of correlations: 
HD, monopole, dipole, and GWMO. 
This method can be used with any number and type of correlations. 
It could be used, for example, 
to simultaneously search for the presence of non-Einsteinian polarizations of the GWB \cite{2012PhRvD..85h2001C,PhysRevD.98.024020,2021ApJ...923L..22A}, 
or to perform model-independent reconstructions 
of correlations using Legendre polynomials \cite{PhysRevD.90.082001}.

In our analyses, we found that all versions of the OS 
tend to underestimate the amplitude of the correlated process. 
This has been found in previous work as well \cite{2018PhRvD..98d4003V}, 
and is due to the assumption of the recovered OS
following a Gaussian distribution. 
An upcoming paper analytically computes the OS distribution, 
and finds that it is better described by a 
generalized chi-square distribution \cite{hmrs23}. 
We have gone ahead and assumed the OS follows a Gaussian distribution 
so our results can be directly compared to previous work looking at parameter estimation 
using the OS -- 
treating the OS distribution as a generalized chi-square distribution 
would likely reduce or remove the observed bias in parameter estimation.

\acknowledgements
We thank Justin Ellis, Jeff Hazboun, David Kaplan, Dusty Madison, Pat Meyers,  Gabe Freedman,
Joe Romano, Xavier Siemens, Abhimanyu Susobhanan, Steve Taylor, and Michele Vallisneri 
for useful discussions. 
We thank Nima Laal for help creating simulated data sets 
with monopole injections. 

This work was supported by 
National Science Foundation (NSF) grant PHY-2011772. 
The authors are members of the NANOGrav collaboration, 
which receives support from NSF Physics Frontiers Center 
award number 1430284 and 2020265.

\newpage

\appendix

\section{Simulation results}
\label{app:tables}
\vspace{-1in}%
\input{table_hd_results}%
\vspace{-1in}%
\input{table_hdgwmo_results}%

\clearpage

\section{Pulsar Red Noise Parameters}
\label{app:pulsar_noise}

Our simulated data sets include intrinsic red noise 
in each pulsar. We model the red noise with a power-law power spectrum 
$P(f) = \frac{A^2}{12 \pi^2} \left(\frac{f}{f_\mathrm{yr}}\right)^{-\gamma} \mathrm{yr}^3 $ (as shown in Equation \ref{eq:rn_psd}. 
The values of $A$ and $\gamma$ used for each pulsar are listed in 
Table~\ref{tab:rednoise}, 
and are based on the noise properties of the NANOGrav 12.5-year data set.  

\input{table_psr_params}

\bibliographystyle{apsrev}
\bibliography{authors}


\end{document}