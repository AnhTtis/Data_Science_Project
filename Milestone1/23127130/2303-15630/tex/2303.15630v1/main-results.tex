%\documentclass{amsart}
%\input{defs.tex}
%
%\begin{document}
%\section{Main results}

In this section we state our main result, which is the existence condition for $d$-GS structures. We then describe the bijections between the different incarnations of $d$-GS structures.

\begin{thm}\label{thm:main}
Let $d\geq 3$ and let $G$ be a $d$-map. There exists a $d$-GS wood (resp. labeling, marked orientation, angular orientation) for $G$ if and only if $G$ is $d$-adapted (that is, if its simple non-facial cycles have length at least $d$). 

Moreover for any fixed $d$, there is an algorithm which takes as input a $d$-adapted map, and computes a $d$-GS wood (resp. labeling, marked orientation, angular orientation) in linear time in the number of vertices.

Lastly, the set $\bW_G$ of $d$-GS woods of $G$, the set $\bL_G$ of $d$-GS labelings of $G$, the set $\bM_G$ of $d$-GS marked orientations of $G$, and the set $\bA_G$ of $d$-GS angular orientations of $G$ are all in bijection.
\end{thm}

%\fig{width=\linewidth}{def-incarnations}{Conditions defining the $d$-grand-Schnyder structures.}


We will prove the existence result stated in Theorem~\ref{thm:main} in Section~\ref{sec:proof-existence}, and we will also describe there the algorithm for computing $d$-GS structures. %In \cite{OB-EF:Schnyder} an existence proof was given for the special case of Schnyder decompositions (which correspond to $d$-GS structures on $d$-angulations) by using a ``min-cut max-flow'' type of argument. It may be possible to adapt this argument in the general case, however the proof in the present article is different: it is constructive and can be used to define a linear time algorithm for computing $d$-GS structures.}
\\


In Section~\ref{sec:lattice} we will show that the set of $d$-GS structure of a given $d$-adapted map can be given a \emph{lattice structure} (in the sense of partially ordered sets), and characterize the covering operations. 
%The order relation in the lattice is easiest to describe in terms of the angular orientation incarnation: a $d$-GS angular orientation $\cA\in \bA_G$ is less than $\cA'\in \bA_G$ if $\cA'$ can be obtained from $\cA$ be repeatedly flipping some counterclockwise simple cycle into a clockwise cycle (more precisely, decreasing the weight of such a cycle, and increasing the weight of the opposite cycle; see Section~\ref{sec:lattice} for details).\\


For the rest of this section, we focus on defining the bijections between the different incarnations of $d$-GS structures.
From now on, we fix an integer $d\geq 3$ and a $d$-map $G$. The outer vertices of $G$ are denoted by $v_1,\ldots,v_d$, and they appear in clockwise order around the outer face of $G$. The bijections between the sets $\bW_G$, $\bL_G$, $\bM_G$ and $\bA_G$ are represented in Figure~\ref{fig:bij-labeling-marked},~\ref{fig:bij-marked-angular} and~\ref{fig:bij-labeling-wood}. We start with the bijections between $\bL_G$, $\bM_G$ and $\bA_G$, which are easier to prove.


%We delay the proof of Proposition~\ref{prop:bij-alpha}. The difficulty is to show that the image of a $d$-GS labeling by $\th$ is a $d$-GS wood, and the image of a $d$-GS labeling by $\th$ is a $d$-GS wood.
%The difficulty lies in establishing that for any $d$-GS labeling $\cL\in \bL_G$, the image $\th(\cL)$ is a $d$-GS wood.


First, we define the bijection $\Phi$ between $d$-GS labelings and $d$-GS marked orientations. Roughly speaking, the bijection $\Phi$ is as follows: the marks encode the label jumps around a face, while the arc weights encode the label jumps around vertices. The bijection $\Phi$ is represented in Figure~\ref{fig:bij-labeling-marked}. We call \emph{marked orientation} of $G$ a weighted orientation of $G$ together with assigning a number of marks to each of its inner corners. 

\begin{definition}
Given a $d$-GS labeling $\cL$ of $G$, we define a marked orientation $\Phi(\cL)$ of $G$ as follows. 
For an inner corner $c$, we denote by $c^-$ the corner preceding $c$ in clockwise order around the face containing $c$, and by $c^+$ the corner following $c$ in clockwise order around the vertex incident to $c$.
\begin{compactitem}
\item The number of marks of an inner corner $c$ in $\Phi(\cL)$ is $\delta-1$, where $\delta$ is the label jump from $c^-$ to $c$.
\item The weight of outer arcs in $\Phi(\cL)$ is 0. 
Let $a$ be an inner arc, and let $c$ be the corner preceding $a$ in clockwise order around the initial vertex of $a$. Then the weight of the inner arc $a$ in $\Phi(\cL)$ is $\delta +\eps-1$, where $\delta$ is label jump from $c^-$ to $c$ and $\eps$ is label jump from $c$ to $c^+$.
\end{compactitem}
%Let $a$ be an inner arc. Let $f$ be the face on the left of $a$, let $v$ be the origin of $a$ and let $c$ be the corner of $f$ incident to $v$. The weight of the inner arc $a$ in $\Phi(\cL)$ is $\delta+\eps$
% $c$ and $c'$ be the corners preceding and following $a$ clockwise order around $v$. The weight of the inner arc $a$ in $\Phi(\cL)$ is the sum of the number of marks in $c$ and the label jump from $c$ to $c'$.
\end{definition}



\fig{width=\linewidth}{bij-labeling-marked}{Bijection $\Phi$ from $d$-GS labelings to $d$-GS marked orientations.}


\begin{prop}\label{prop:bij-beta}
The map $\Phi$ is a bijection between the set $\bL_G$ of $d$-GS labelings of $G$ and the set $\bM_G$ of $d$-GS marked orientations of $G$. 
\end{prop}

\begin{proof}
We first show that the image of a $d$-GS labeling by $\Phi$ is a $d$-GS marked orientation. 
Let $\cL\in \bL_G$ and let $\cM=\Phi(\cL)$. 
First observe that Condition~(L3) for $\cL$ translates into Condition~(M3) for $\cM$. 
Also, Condition (L1) for $\cL$ implies Condition (M1) for $\cM$ as well as the part of Condition~(M2) about weights around vertices. The part of Condition (M2) about edges (weight $d-2$ for every inner edge) is a consequence of the fact that the sum of counterclockwise label jumps around inner edges is $d$, which holds for any $d$-GS labeling by Lemma~\ref{lem:ccw-jumps-edges}. Lastly, Condition (L0) for $\cL$ implies that for any inner arc $a$ whose initial vertex is an outer vertex $v_i$, the weight $\om(a)$ of $a$ is equal to the number of marks $m(a)$ in the corner of $v_i$ on the left of $a$. Moreover, Condition (M1) gives $m(a)\leq d-\deg(f)$ and condition (M3) gives $\om(a)\geq d-\deg(f)$. This gives (M0). Hence, $\cM$ is a $d$-GS marked orientation.


By the above, $\Phi$ is a map from $\bL_G$ to $\bM_G$. It is also clear that $\Phi$ is injective because knowing $\Phi(\cL)$ allows one to determine all the label jumps between ``adjacent corners'' (corners that are consecutive around faces or vertices) which together with Condition (L0) determines the corner labeling $\cL$. The label jumps determined from a marked orientation is indicated in the bottom part of Figure~\ref{fig:bij-labeling-marked}, and provides a tentative inverse mapping for $\Phi$.
In order to prove that $\Phi$ is surjective, we need to take a closer look at this inverse mapping. Namely, we need to check that, starting from a marked orientation $\cM\in \bM_G$, the `jump assignments'' determined as indicated in Figure~\ref{fig:bij-labeling-marked} can be satisfied by a $d$-labeling of $G$ (recall that a \emph{$d$-labeling} is simply an assignment of a value in $[d]$ to each inner corner of $G$).


The \emph{corner-graph} of $G$ is the directed graph $C_G$ defined as follows: the vertices of $C_G$ are the inner corners of $G$, and there is an oriented edge from a corner $c$ to a corner $c'$ in $C_G$ if $c'$ is the corner following $c$ in clockwise order around a face or vertex. The corner graph is represented in Figure~\ref{fig:angular-map}(c).
Note that the corner graph comes with an embedding in the plane determined by $G$; it has three types of inner faces corresponding to the inner vertices, inner faces, and inner edges of $G$ respectively. 
A \emph{$d$-jump function} for $G$ is an assignment of a number in $\{0,1,\ldots,d-1\}$ to each oriented edge of the corner graph $C_G$. A $d$-jump function is called \emph{exact} if its values are equal to the label jumps of a $d$-labeling of $G$. It is easy to see that a $d$-jump function $f$ is exact if and only if every simple cycle $C$ of $C_G$ satisfies:
\begin{equation}\label{eq:jumps-exact}
\sum_{a\in C^+}f(a)-\sum_{a\in C^-}f(a)\in d\ZZ,
\end{equation}
where $C^+$ (resp. $C^-$) is the set of edges of $C_G$ appearing clockwise (resp. counterclockwise) on~$C$. Indeed~\eqref{eq:jumps-exact} is the condition that ensures that labels can be ``propagated'' according to the jump assignments without encountering any conflict. Furthermore, it is easy to check that~\eqref{eq:jumps-exact} holds if and only if it holds for every cycle which is the contour of an inner face of $C_G$. 

In conclusion, if one fixes an assignment of jumps from every inner corner to the next corner around the faces and vertices of $M$, this assignment of jumps corresponds to a $d$-labeling of $G$ if and only if the sum of assigned jumps around each vertex, face and edge of $G$ is a multiple of~$d$. 
Using this criteria, we see that for any marked orientation $\cM\in\bM_G$, Conditions (M1) and (M2) imply that the `jump assignments'' determined as indicated in Figure~\ref{fig:bij-labeling-marked} can be realized by a $d$-labeling of $G$. There is a unique such $d$-labeling such that the corners incident to $v_1$ have label 1, and we denote this $d$-labeling by $\bPhi(\cM)$. Using Condition (M0) and (M1) for $\cM$, we see that the jump assignments for $\bPhi(\cM)$ along the outer edges of $G$ are equal to 1. This implies that $\bPhi(\cM)$ satisfies Condition (L0). Lastly, it is easy to see that Conditions (M1) and (M2) for $\cM$ imply Condition (L1) for $\bPhi(\cM)$, and that Condition (M3) implies Condition (L3), while Condition (L2) holds for $\bPhi(\cM)$ by definition of the jump assignments. Thus, $\bPhi$ is a map from $\bM_G$ to $\cL_G$. 

Finally, it is clear that $\bPhi\circ \Phi=\Id_{\cL_G}$ and $\Phi\circ \bPhi=\Id_{\cM_G}$, hence these are inverse bijections between the $d$-GS labelings and the $d$-GS marked orientations of $G$. 
\end{proof}

Next, we define the bijection $\Psi$ between $d$-GS marked orientations and $d$-GS angular orientations of $G$. This bijection is represented in Figure~\ref{fig:bij-marked-angular}.
In the angular map $G^+$, the \emph{original arcs} are those on original edges (edges of $G$) while the \emph{star arcs} are those on star edges. 
%that have been added to construct $G^+$. 

\begin{definition}
Given a $d$-GS marked orientation $\cM$ of $G$ with arc weights denoted by $\om$, we define a weighted orientation $\Psi(\cM)$ of $G^+$ as follows.
% an angular orientation $\Psi(\cM)$ of $G$ as follows.
\begin{compactitem}
\item The weight in $\Psi(\cM)$ of an original inner arc $a$ is $\om(a)+\deg(f)-d$, where $f$ is the face of $M$ at the left of $a$. The weight of outer arcs in $\Psi(\cM)$ is 0.
\item Let $c$ be an inner corner of $G$, let $m$ be the number of marks of $c$ and let $f$ be the face of $G$ containing $c$. The weight in $\Psi(\cM)$ of the star arc from the star vertex $v_f$ to $c$ is~$m$, and the weight of the star arc from $c$ to $v_f$ is $d-\deg(f)-m$.
\end{compactitem}
\end{definition}


\fig{width=\linewidth}{bij-marked-angular}{Bijection $\Psi$ between $d$-GS marked orientations and $d$-GS angular orientations.}

\begin{prop}\label{prop:bij-gamma}
The map $\Psi$ is a bijection between the set $\bM_G$ of $d$-GS marked orientations of $G$ and the set $\bA_G$ of $d$-GS angular orientations of $G$. 
\end{prop}

\begin{proof}
We first show that the image of a $d$-GS marked orientation by $\Psi$ is a $d$-GS angular orientation. 
Let $\cM\in \bM_G$ and let $\cA=\Psi(\cM)$. It is clear that Conditions (M0) and (M1) for $\cM$ imply Conditions (A0) and (A1) respectively for $\cA$. Also Condition (M2) for an inner edge $e$ of $\cM$ (weight $d-2$ in $\cM$) implies condition (A2) for $e$ (weight $d-2-(d-\deg(f))-(d-\deg(f'))=\deg(f)+\deg(f')-d-2$ in $\cA$). Lastly, Condition (M2) for a vertex $v$ of $M$ (outgoing weight $d+\#marks$ in $\cM$) implies Condition (A2) for $v$. Indeed, for any original arc $a$ out of $v$, with $a'$ the preceding star arc in clockwise
order around $v$, the sum of the weights (in $\cA$) of $a$ and $a'$ is equal to $\om(a)-m$, where $m$ is the number of marks in the corner preceding $a$. 

It is easy to invert the mapping $\Psi$. Given a $d$-GS angular orientation $\cA$ of $G$ with arc weights denoted by $\om^+$, we define a marked orientation $\bPsi(\cM)$ of $G$ as follows.
\begin{compactitem}
\item The weight in $\bPsi(\bM)$ of an arc $a$ of $M$ is $\om^+(a)-\deg(f)+d$, where $f$ is the face of $M$ at the left of $a$. The weight of outer arcs in $\bPsi(\cA)$ is 0.
\item Let $c$ be an inner corner of $G$ in a face $f$. The number of marks of $c$ in $\bPsi(\cA)$ is the weight of the star arc from the star vertex $v_f$ to $c$.
\end{compactitem}

As before, it is easy to see that Conditions (A0), (A1) and (A2) for $\cA$ imply Conditions (M0), (M1) and (M2) respectively for $\bPsi(\cM)$. Moreover, Condition (M3) for $\bPsi(\cM)$ is immediate from the definition, hence $\bPsi(\cM)$ is a $d$-GS marked orientation.
Lastly, it is clear that $\bPsi\circ\Psi=\Id_{\bM_G}$ and $\Psi\circ\bPsi=\Id_{\bA_G}$, thus $\Psi,\bPsi$ are bijections.
\end{proof}




Lastly, we define a bijection $\Th$ between $d$-GS labelings and $d$-GS woods of $G$. This bijection is represented in Figure~\ref{fig:bij-labeling-wood}. Recall from Section~\ref{subsec:GS-woods} that we can interpret a $d$-GS wood $(W_1,\ldots,W_d)$ of $G$ in terms of ``arc colorings'': we say that an arc $a$ has color $i$ if it belongs to the spanning tree $W_i$, where $W_i$ is oriented toward its root $v_{i}$ as usual. By Condition (W1), the colors of a given arc are cyclically consecutive, and it will be convenient to use some notation for such intervals. For elements $i,j$ of $[d]$, we denote by $[i:j[$ the set of integers $\{i,i+1,i+2,\ldots,j-1\}$ modulo $d$. More precisely, if $i\leq j$ then $[i:j[:=\{k\in [d] \mid i\leq k<j\}$ and if $j<i$, then $[i:j[:=\{k\in [d]\mid k\geq i\textrm{ or }k<j\}$ (note the special case $[i:i[=\emptyset$). Roughly speaking, the bijection $\Th$ from $d$-GS labelings to $d$-GS woods is obtained by assigning to each arc $a$ the set of colors $[i:j[$, where $i,j$ are the labels preceding and following $a$. The precise definition is as follows.



\begin{definition}[Bijection between labelings and woods]
Given a $d$-GS labeling $\cL$ of $G$, we define a tuple $\Th(\cL)=(W_1,\ldots,W_d)$ of subsets of arcs of $G$ (interpreted as an arc coloring) as follows.
\begin{compactitem}
\item For all $i\in [d]$, the outer arc from $v_i$ to $v_{i+1}$ has all the colors except $i$, while the outer arc from $v_{i+1}$ to $v_{i}$ has no color.
%For all $k\in[d]$, the set $W_k$ contains all the outer arcs $(v_i,v_{i+1})$ for $k\in [d]$ (with the usual convention $v_{d+1}=v_1$) except those incident to $v_k$ and $v_{k+1}$.
\item An inner arc $a$ of $G$ has color set $[i:j[$, where $i$ and $j$ are the labels of the corners at the left and right of the arc $a$ respectively, at the initial vertex of~$a$. 
%For all $k\in[d]$, an inner arc $a$ of $G$ is in $W_k$ if and only if $k$ is in the set $[i:j[$, where $i$ and $j$ are the labels of the corners at the left and right of the arc $a$ respectively at the initial vertex of $a$. 
\end{compactitem}
Given a $d$-GS wood $\cW$ of $G$ (interpreted in terms of arc coloring), we define a corner labeling $\bTh(\cW)$ as follows.
\begin{compactitem}
\item The inner corners incident to the outer vertex $v_{i}$ receive label $i$.
\item A corner $c$ incident to an inner vertex $v$ has label $i$ if it is between the outgoing arcs of color $i-1$ and $i$ in clockwise order around $v$.
\end{compactitem}
\end{definition}

\fig{width=\linewidth}{bij-labeling-wood}{Bijection $\Th$ between $d$-GS labelings and $d$-GS woods.}

\begin{remark}
In the definition of $\bTh$, the rule for setting the corner labels for inner vertices and outer vertices can be unified, up to using the appropriate convention. Namely, given a $d$-GS wood $\cW$ of $G$, one can add an outgoing edge of color $k$ from $v_k$ to $v_{k-1}$ for all $k\in[d]$. With this convention, every vertex $v$ of $G$ has one outgoing arc of each color, and each inner corner incident to $v$ has label $i$ if it is between the outgoing arcs of color $i-1$ and $i$ in clockwise order around $v$.
\end{remark}


\begin{prop}\label{prop:bij-theta}
The map $\Th$ is a bijection between the set $\bL_G$ of $d$-GS labelings of $G$ and the set $\bW_G$ of $d$-GS woods of $G$. The map $\bTh$ is the inverse bijection. 
\end{prop}

The proof of Proposition~\ref{prop:bij-theta} is a bit technical and we postpone it to Section~\ref{sec:remaining-proofs}. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%% The rest of this section is devoted to the proof of Proposition~\ref{prop:bij-theta}.
%% \begin{lemma}\label{lem:image-theta}
%% Let $G$ be a $d$-map. For any $d$-GS labeling $\cL$ of $G$, the image $\Th(\cL)$ is a $d$-GS wood.
%% \end{lemma}
%% \begin{proof}
%% Let $\cL\in \bL_G$, and let $\cW=(W_1,\ldots,W_d)=\Th(\cL)$ be the corresponding arc coloring (where $W_i$ is the set of arcs of color $i$). 
%% %Before proving that the subsets of arcs $W_1,\ldots, W_d$ are trees, 
%% We observe that $\cW$ satisfy Condition (W1) because in $\cL$ the sum of label-jumps in clockwise order around any inner vertex is $d$. 
%% Next, we show that $\cW$ satisfy Condition (W2). 
%% Let $a$ be an inner arc of $G$ oriented from $u$ to $v$. We assume that $a$ has color $i$ in $\cW$, and that $v$ is an inner vertex. 
%% We want to show that $a$ appears strictly between the outgoing arc of color $i+1$ and the outgoing arc of color $i+1$ around $v$. 
%% Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}.
%% Since the arc $a$ has color $i$, we have $i\in [i_1:i_2[$. Moreover, since the label jumps are all positive around faces by Condition (L2), we have $i-1,i, i+1\in [i_4:i_1[\cup [i_1:i_2[\cup [i_1:i_3[$. By Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around the arc $a$ is equal to $d$, hence the sets $[i_4,i_1[$, $[i_1:i_2[$, $[i_2:i_3[$, and $[i_3:i_4[$ are disjoint (and give a partition of $[d]$). This implies that the arcs of color $i-1$, $i$ and $i+1$ will appear in this order in clockwise order around $v$ starting at the corner labeled $i_4$ and ending at the corner labeled $i_3$, which proves that the arc $a$ satisfies (W2).

%% \fig{width=.3\linewidth}{labels-around-edge}{Corner labels around an edge.}

%% Next, we show that the set of arcs $W_i$ is a spanning tree oriented toward $v_{i}$ for all $i\in [d]$. 
%% By (W1), every inner vertex is incident to exactly 1 outgoing arc of color $i$ for all $i\in[d]$. 
%% Let $v$ be an inner vertex. We consider the path $P_i(v)$ starting at $v$ which is obtained by following the arcs of color $i$ until reaching an outer vertex or an inner vertex already visited. Suppose for contradiction that there exists an inner vertex $v$ and a color $i\in [d]$, such that $P_i(v)$ ends at an inner vertex, so that $P_i(v)$ contains a cycle $C_i(v)$. We pick $v$ and $i$ such that the number of faces contained in the cycle $C_i(v)$ is minimal. Suppose first that $C_i(v)$ is directed clockwise. In this case, because of Condition (W2), for every vertex $u$ on $C_i(v)$, the outgoing edge of color $i+1$ at $u$ is either the same as the outgoing arc of color $i$ or goes strictly inside $C_i(v)$. This implies that the path $P_{i+1}(u)$ cannot reach vertices laying outside of the region enclosed by $C_i(v)$. By the minimality condition on $C_i(v)$, we conclude that $C_{i+1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$. Repeating the argument, we get $C_j(u)=C_i(v)$ for all $j\in [d]$. We reach a contradiction because, by definition of $\be$, no arc can have all the colors in $[d]$. Similarly, if one supposes that $C_i(v)$ is directed counterclockwise, then one can prove that $C_{i-1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$, and this leads to a contradiction as before. This concludes the proof that for all $v$, the path $P_i(v)$ reaches an outer vertex. Lastly, since the labeling $\cL$ satisfy (L0) it is easy to see that the outer vertices $v_i$ and $v_{i+1}$ are not incident to ingoing inner arcs of color $i$. Thus, all the paths $P_i(v)$ end at an outer vertex distinct from $v_{i}, v_{i+1}$, which implies that the set of arcs $W_i$ forms a spanning tree oriented toward $v_{i}$. Moreover $v_i,v_{i+1}$ are no incident to ingoing arcs of color $i$, hence $\cW$ satisfies (W0).

%% It remains to show that $\cW$ satisfies (W3). Consider an inner arc $a$ oriented from $u$ to $v$. Let $f$ be the face at the right of $a$. Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}. 
%% Suppose that $a$ has color $i$, or that $a$ is strictly between the outgoing arcs of color $i$ and $i+1$ in clockwise order around $u$. Suppose also that the number $\eps:=|[i_3:i_4[|$ of colors of the arc $-a$ satisfies $d-\deg(f)-\eps>0$. 
%% In order to prove that the arc $a$ satisfy condition (W3), it suffices to prove that $[i:i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. Since, by Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around $a$ is $d$, we have $[i_4:i_3[=[i_4:i_2[\cup [i_1:i_3[$. Moreover, under our hypotheses, $i\in[i_4:i_2[$, and $[i+1:i+1+\delta[\subseteq [i_1:i_3[$, where $\delta=|[i_2:i_3[|$.
%% Lastly, by Condition (L3) we have $\delta\geq d+1-\deg(f)-\eps$, hence $[i+1:i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. This concludes the proof of that Condition (W3) holds. Thus $\cW$ is a $d$-GS wood.
%% \end{proof}

%% \begin{lemma}\label{lem:image-theta-inverse}
%% Let $G$ be a $d$-map. For any $d$-GS wood $\cW$ of $G$, the image $\bTh(\cW)$ is a $d$-GS labeling.
%% \end{lemma}

%% \begin{proof}
%% Let $\cW$ be a $d$-GS wood of $G$, and let $\cL=\bTh(\cW)$. Condition (L0) holds for $\cL$ by definition of $\bTh$. Moreover it is clear that Condition (W1) for $\cW$ implies that the sum of label jumps clockwise around inner vertices is always $d$. In order to establish that $\cL$ satisfies (L1) and (L2) we need to establish the two technical results.

%% \noindent \textbf{Claim 1:} For every inner edge $e$ of $G$, the 4 corners incident to $e$ cannot all have the same label.

%% Suppose for the sake of contradiction, that an inner edge $e$ has its 4 incident corners labeled $i$. Let $u,v$ be the endpoints of $e$. Without loss of generallity, we can suppose that $v$ is an inner vertex. Consider the paths $P_1(v),\ldots,P_d(v)$ of color $1,2,\ldots,d$ starting at $v$ as defined in Section~\ref{subsec:GS-woods}. Let $R_i(v)$ be the region delimited by the paths $P_{i-1}(v)$ and $P_i(v)$. Since the corners incident to $e$ have label $i$, the edge $e$ is in $R_i(v)$, hence $u$ is in $R_i(v)$. By Lemma~\ref{lem:vi-not-in-Ri} this implies that $u\neq v_i$. Since $u$ is incident to some corners labeled $i$, we conclude that $u$ is not an outer vertex. Hence both $u$ and $v$ are inner vertex. Moreover $u$ is in $R_i(v)$, and symmetrically $v$ is in $R_i(u)$.
%% By Corollary~\ref{cor:containment-regions} the region $R_i(u)$ is strictly contained in $R_i(v)$, and $R_i(v)$ is strictly contained in $R_i(u)$, which gives a contradiction. Hence Claim 1 holds




%% Next, we look at the label situation around inner edges. Let $a$ be an inner arc of $G$ and let $i_1,i_2,i_3,i_4$ be the labels of the incident corners as indicated in Figure~\ref{fig:labels-around-edge}. 

%% \noindent \textbf{Claim 2:} The sum of label jumps in counterclockwise order around $a$ is $d$, and moreover $i_2\neq i_3$ and $i_1\neq i_4$.


%% Let us first prove Claim 2 in the case $i_1\neq i_2$. If $i_1\neq i_2$ then by property (W2) of $\cW$ we have $[i_1:i_2[\cap [i_3,i_4[=\emptyset$, hence the sum of label jumps in counterclockwise order around $a$ is $d$. Moreover, still by property (W2), $i_2\neq i_3$ and $i_1\neq i_4$ so Claim 2 holds. 
%% By symmetry, if $i_3\neq i_4$, then Claim 2 holds.
%% Lastly, if $i_1=i_2$ and $i_3=i_4$, then $i_1=i_2\neq i_3=i_4$ by Claim 1, which implies again that the sum of label jumps in counterclockwise order around $e$ is $d$, and Claim 2 holds again.

%% Claim 2 trivially implies that $\cL$ satisfies (L2). Moreover, Claim 2 implies that the sum of label jumps clockwise around every inner face is at least $d$ (since it is a multiple of $d$ and cannot be 0). Next, we use Equation~\eqref{eq:sum-jumps-relation} between the sum of label jumps around vertices, edges and faces.
%% Using Claim 2, we get
%% \begin{equation}\label{eq:sum-jumps-relation2}
%% d(|F|+|V|)\leq \sum_{f\in F}\cwjump(f)+ \sum_{v\in V}\cwjump(v)=d+\sum_{e\in E}\ccwjump(e)=d(1+|E|),
%% \end{equation}
%% where $V,F,E$ are the set of inner vertices, faces, and edges of $G$ respectively. By the Euler relation we have $|F|+|V|=1+|E|$, hence the inequality in~\eqref{eq:sum-jumps-relation2} is an equality. Thus the sum of label jumps clockwise around every inner fave is $d$. This complete the proof that $\cL$ satisfies (L1).

%% It remains to prove that $\cL$ satisfies (L3). Consider an inner arc $a$ oriented from $u$ to $v$ with incident corners labeled $i_1,i_2,i_3,i_4$ as indicated in Figure~\ref{fig:labels-around-edge}. Let $f$ be the face at the right of $a$, let $\delta=|[i_2,i_3[|$ and let $\eps=|[i_3,i_4[|$. We want to show $\delta+\eps\geq d-\deg(f)+1$.
%% If $d-\deg(f)-\eps<0$, then this inequality clearly holds (since $\delta>0$). Suppose now that $d-\deg(f)-\eps\geq 0$, and consider Consider (W3) of $\cW$. If $i_1\neq i_2$, then Condition (W3) applied to color $i=i_2-1$ of $a$ gives $\delta\geq d-\deg(f)-\eps+1$ as wanted. If $i_1=i_2$, then $a$ is between the outgoing arc of $W_i$ and $W_{i+1}$ around $u$ for $i=i_2-1$ and we also get $\delta\geq d-\deg(f)-\eps+1$ as wanted. This shows that $\cL$ satisfies (L3), which completes the proof that $\cL$ is a $d$-GS labeling.
%% \end{proof}

%% \begin{proof}[Proof of Proposition~\ref{prop:bij-theta}] Let $G$ be $d$-map. 
%% By Lemmas~\ref{lem:image-theta} and~\ref{lem:image-theta-inverse}, $\Th$ is a map from $\bL_G$ to $\bW_G$, and $\bTh$ is a map from $\bW_G$ to $\bL_G$. It is easy to see that $\bTh\circ \Th=\Id_{\bL_G}$ and $\Th\circ \bTh=\Id_{\bW_G}$. Thus these are inverse bijections. 
%% \end{proof}

%% Before closing this section, we prove Lemma~\ref{lem:W2'}. 
%% \begin{proof}
%% Let $G$ be a $d$-adapted map, and let $\bW_G'$ be the set of maps satisfying Conditions (W0), (W1) and (W2'). We clearly have the inclusion $\bW_G'\subseteq \bW_G$ and want to show $\bW_G'= \bW_G$. 

%% Let $\bTh'$ be the extension of the map $\bTh$ to $\bW_G'$ (with the same definition as $\bTh$). Let $\cW\in \bW_G'$ and let $\cL=\bTh'(\cW)$. We claim that $\cL$ is in $\bL_G$. We reason as in the proof of Lemma~\ref{lem:image-theta-inverse}, and since $\cW$ satisfies (W0), (W1) and (W2), we get that $\cL$ satisfy (L0), (L1), (L2). It remains to prove Condition (L3) for every arc $a$. We adopt the notation $i_1,i_2,i_3,i_4$, $f$, $\delta=|[i_2,i_3|$ and $\eps=|[i_3,i_4|$ from the proof of Lemma~\ref{lem:image-theta-inverse}. We need to show $\delta+\eps\geq d-\deg(f)+1$. If $i_1\neq i_2$ then Condition (W2') applied to color $i=i_2-1$ of $a$ gives $\delta\geq d-\deg(f)-\eps+1$ as wanted. We now consider the case $i_1=i_2$. Let $f'$ be the face at the left of $a$. Since $G$ is $d$-adapted, we must have $\deg(f)+\deg(f')-2\geq d$ (because $\deg(f)+\deg(f')-2$ is the length of a non-facial cycle of $G$: the contour of the face one would obtain by deleting $e$ and merging $f$ and $f'$). Moreover, $|[i_4,i_1[|\leq d-\deg(f')+1$ because the sum of label jumps around $f'$ is $d$ and each jump is at least 1.
%% Since the sum of label jumps in counterclockwise order around $a$ is $d$, one obtains
%% $$\delta+\eps=d-|[i_4,i_1[|\geq \deg(f')-1\geq d-\deg(f)+1.$$
%% Thus Condition (L3) holds and $\cL$ is in $\bL_G$.

%% Since the image of $\bTh'$ is in $\bL_G$, we can compose this map with $\Th$. For all $\cW\in \bW_G'$ one clearly has $\Th \circ \bTh'(\cW)=\cW$, hence $\cW$ is in the image of $\Th$, which is in $\bW_G$ by Lemma~\ref{lem:image-theta}. This concludes the proof that $\bW_G'= \bW_G$. 
%% \end{proof}

%\end{document}

