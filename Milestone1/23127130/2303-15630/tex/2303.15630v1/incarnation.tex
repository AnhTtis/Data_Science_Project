%\documentclass[a4paper]{amsart}
%\input{defs.tex}
%\begin{document}
%\section{Incarnations}




In this section we define the $d$-grand-Schnyder structures under their four possible incarnations: \emph{GS woods}, \emph{GS labelings}, \emph{GS marked orientations}, and \emph{GS angular orientations}. The definition of those structures is summarized in Figure~\ref{fig:def-incarnations}.
As we will state in Section \ref{sec:statements}, these structures exist for a $d$-map if and only if this $d$-map is $d$-adapted. % (that is, its non-facial cycles have length at least $d$). 

\subsection{Grand-Schnyder corner labelings}\label{subsec:GS-labeling}
In this subsection, we define the \emph{grand-Schnyder corner labelings} for $d$-maps.   
A \emph{$d$-labeling} of a $d$-map $G$ is an assignment of a \emph{label} in $[d]:=\{1,\ldots,d\}$ to each inner corner of $G$.
A $d$-grand-Schnyder corner labelings of $G$ is a $d$-labeling satisfying certain local conditions represented in Figure~\ref{fig:def-incarnations} (top row).
These conditions are best expressed in terms of \emph{jumps}.

Consider a $d$-labeling of a $d$-map $G$. Let $c$ and $c'$ be two inner corners of $G$, and let $i$ and $i'$ be their respective labels. The \emph{label jump} from the corner $c$ to the corner $c'$ is defined as the integer $\delta$ in $\{0,1,\ldots,d-1\}$ such that $i+\delta=i'\mod d$ (in other words, the label jump $\delta$ is $i'-i$ if $i'-i\geq 0$, and $i'-i+d$ otherwise).
For an inner vertex $v$ of $G$, the \emph{sum of clockwise jumps} around~$v$ is the sum of label jumps between consecutive corners in clockwise order around~$v$. Similarly, the \emph{sum of clockwise jumps} around a face $f$ is the sum of label jumps between consecutive corners in clockwise order around~$f$. Note that the sum of clockwise jumps around a vertex or face is necessarily a multiple of $d$: it is equal to $k\, d$, where $k$ is the number of strict decreases of labels in clockwise order around the vertex or face (a strict decrease is when the label of a corner is strictly larger than the label of the following corner).



\begin{definition}\label{def:GS-labeling}
Let $d\geq 3$, and let $G$ be a $d$-map. As usual, we assume that the outer vertices of $G$ are denoted by $v_1,\ldots,v_d$ in clockwise order around the outer face.
A \emph{$d$-grand-Schnyder corner labeling} of $G$ is an assignment to each inner corner of $G$ of a label in $[d]$ satisfying the following conditions.
\begin{itemize}
\item[(L0)] For all $i\in [d]$, all the corners incident to $v_i$ have label $i$.
\item[(L1)] For every inner vertex or face of $G$, the sum of clockwise jumps around this vertex or face is $d$.
\item[(L2)] The label jumps from a corner to the next corner around a face are always positive (equivalently, consecutive corners around a face have distinct labels).
\item[(L3)] Let $e$ be an inner edge and let $f$ be an incident face. Let $c$ and $c'$ be the consecutive corners incident to $e$ in clockwise order around~$f$, and let $v$ be the vertex incident to $c'$. The label jump $\delta$ from $c$ to $c'$ and the label jump $\eps$ from $c'$ to the next corner in clockwise order around~$v$ satisfy $\delta+\eps> d-\deg(f)$.
%Let $c$ and $c'$ be consecutive corners in clockwise order around an inner face $f$, and let $v$ be the vertex incident to $c'$.
%The label jump $\delta$ from $c$ to $c'$ and the label jump $\eps$ from $c'$ to the next corner in clockwise order around~$v$ satisfy $\delta+\eps> d-\deg(f)$.
\end{itemize}
\end{definition}
The definition of  $d$-grand-Schnyder corner labelings, or \emph{$d$-GS labelings} for short, is represented in the top row of Figure~\ref{fig:def-incarnations}.

%\ref{fig:def-labeling}.\fig{width=\linewidth}{def-labeling}{Conditions (L0), (L1), (L2) and (L3) defining $d$-GS labelings.}
\fig{width=\linewidth}{def-incarnations}{Conditions defining the $d$-grand-Schnyder structures. The orientation weights are indicated by arrowheads (the number of arrowhead indicates the weight), while the markings are indicated by arcs in the corners (the number of arcs indicates the number of marks).}

Let us make a few easy observations about Definition~\ref{def:GS-labeling}.
\begin{remark}%\label{rk:ccw-jumps-edges}
\begin{compactitem}
\item Condition (L1) could alternatively be stated as saying that there is exactly one decrease of labels in clockwise order around any inner vertex or face. 
\item Conditions (L1) and (L2) imply that, clockwise around an inner face $f$, the label jumps from a corner to the next are all between $1$ and $1+d-\deg(f)$. These conditions also imply that the labels around any inner face are all distinct.
\end{compactitem}
\end{remark}

Let us prove one more easy property of $d$-GS labelings.
\begin{lemma}\label{lem:ccw-jumps-edges}
Let $\cL$ be a $d$-GS labeling of a $d$-map $G$. For an inner edge $e$, we consider the 4 corners incident to $e$ and the 4 label jumps in counterclockwise order around~$e$ as represented in Figure~\ref{fig:edge-jumps}. The sum of label jumps counterclockwise around $e$ is equal to~$d$.
\end{lemma}

\fig{width=.9\linewidth}{edge-jumps}{(a) The label jumps in counterclockwise order around an inner edge~$e$. By Lemma~\ref{lem:ccw-jumps-edges} these label jumps always add up to $d$ in a $d$-GS labeling. (b) The Condition (W2') replacing Conditions (W2) and (W3) for $d$-GS woods of $d$-adapted maps.}

Lemma \ref{lem:ccw-jumps-edges} is illustrated in Figure \ref{fig:edge-jumps}(a). Note that by Lemma \ref{lem:ccw-jumps-edges}, Condition (L3) for $d$-GS labelings can be completed to say that the label jumps $\delta, \eps$ must satisfy $d-\deg(f)< \delta+\eps\leq d-1$.

\begin{proof} Let $\cwjump(x)$ (resp. $\ccwjump(e)$) be the sum of label jumps in clockwise order around an inner vertex or inner face $x$ (resp. in counterclockwise order around an inner edge $e$). We observe that a clockwise jump around a vertex or a face is a counterclockwise jump around an inner edge, or a jump along one of the outer edges (there are $d$ such jumps, and each has value $1$). This gives
 \begin{equation}\label{eq:sum-jumps-relation}
\sum_{f\in F}\cwjump(f)+ \sum_{v\in V}\cwjump(v)=d+\sum_{e\in E}\ccwjump(e),
\end{equation}
where $V,F,E$ are the sets of inner vertices, inner faces, and inner edges respectively. By Condition (L1), the left-hand side is $d(|V|+|F|)$, which is equal to $d+d|E|$ by the Euler relation. By Condition (L2), we have $\ccwjump(e)\geq d$ for all $e\in E$ (since $\ccwjump(e)$ is a positive multiple of $d$), which by the preceding implies $\ccwjump(e)= d$ for all $e\in E$.
\end{proof}



\subsection{Grand-Schnyder woods}\label{subsec:GS-woods}
In this subsection we define grand-Schnyder woods for $d$-maps. These are $d$-tuples of oriented spanning trees satisfying certain conditions represented in Figure~\ref{fig:def-incarnations} (second row). The definition below does not actually specify that the woods are trees; this property is actually a consequence of the other conditions, as stated in Proposition \ref{prop:Wi-are-trees}.

%Let $G$ be a $d$-map, and let $T$ be a subset of its edges. We say that $T$ is a \emph{tree} if this set of edges together with the incident vertices forms a connected, acyclic graph. Given a tree $T$ and an incident vertex $v$, we can choose $v$ as the \emph{root} of $T$, and apply the usual ``genealogy'' vocabulary about trees, where $v$ is an \emph{ancestor} of all the the other vertices and every non-root vertex incident to $T$ has a \emph{parent} in $T$, etc. We can \emph{orient the tree $T$ toward its root} by orienting every edge from child to parent. With this orientation, every non-root vertex of $T$ is incident to one outgoing edge in $T$ (the edge leading to its parent).

\begin{definition}\label{def:woods}
Let $d\geq 3$, and let $G$ be a $d$-map. As usual, we assume that the outer vertices of $G$ are denoted by $v_1,\ldots,v_d$ in clockwise order around the outer face.
A \emph{$d$-grand-Schnyder wood} of $G$ is a $d$-tuple $W=(W_1,\ldots,W_d)$ of subsets of arcs of $G$ satisfying the following conditions:
\begin{itemize}
\item[(W0)] 
%For all $i\in [d]$, every vertex $v\neq v_i$ is the initial vertex of exactly one arc in $W_i$, while $v_i$ is not the initial vertex of any arc in $W_i$.
For all $i\in [d]$, every vertex $v\neq v_i$ has exactly one outgoing arc in $W_i$, while $v_i$ has no outgoing arc in $W_i$.
For all $k\neq i$, the arc in $W_i$ going out of the outer vertex $v_k$ is the  outer arc oriented from $v_k$ to $v_{k+1}$.
Lastly, $W_i$ does not contain any inner arc oriented toward $v_{i}$ or $v_{i+1}$. 
\item[(W1)] Let $v$ be an inner vertex with incident outgoing arcs $a_1,a_2,\ldots,a_d$ in the sets $W_1,W_2,\ldots,W_d$ respectively. The arcs  $a_1,a_2,\ldots,a_d$ are not all equal, and they appear in clockwise order around~$v$ (with the situation $a_i=a_{i+1}$ allowed).
%\item[(W1)] Around every internal vertex $v$, the incident outgoing arcs $a_1,a_2,\ldots,a_d$ in the oriented trees $W_1,W_2,\ldots,W_d$ respectively appear in clockwise order around~$v$ (with the situation $a_i=a_{i+1}$ allowed for all $i$).
\item[(W2)] Let $v$ be an inner vertex with incident outgoing arcs $a_1,a_2,\ldots,a_d$ in the sets $W_1,W_2,\ldots,W_d$ respectively. Let $a$ be an arc oriented toward $v$. 
If the arc $a$ belongs to the set $W_i$, then $a$ appears strictly between $a_{i+1}$ and $a_{i-1}$ in clockwise order around~$v$ (by ``strictly'', we mean that $a$ is not on the same edges as $a_{i-1}$ or $a_{i+1}$).\footnote{There is a possible ambiguity in Definition~\ref{def:woods} that we ought to clarify. Let $(W_1,\ldots,W_d)$ be a $d$-GS wood of $G$. Let $v$ be an inner vertex with incident outgoing arcs $a_1,a_2,\ldots,a_d$ in the sets $W_1,W_2,\ldots,W_d$ respectively (recall that they are not all equal). If $a_i=a_{i+1}=a_{i+2}=\cdots=a_j$, then we consider that there is no edge incident to $v$ appearing strictly between $a_i$ and $a_j$, but there are edges appearing strictly between $a_j$ and $a_i$  (every edge incident to $v$ except the one containing $a_i=a_j$).}
\item[(W3)] Let $v$ be a vertex with outgoing arcs $a_1,a_2,\ldots,a_d$ in the sets $W_1,W_2,\ldots,W_d$ respectively (if $v=v_k$ is the root of $W_{k}$ we adopt the convention $a_{k}:=(v_{k},v_{k-1})$). Let $a$ be an inner arc oriented toward $v$, let $f$ be the face at the right of $a$, and let $\eps$ be the number of sets $W_1,W_2,\ldots,W_d$ containing the opposite arc $-a$. 
If $d-\deg(f)-\eps\geq 0$ and the arc $a$ belongs to the set $W_i$, then $a$ appears strictly between $a_{i+1+d-\deg(f)-\eps}$ and $a_{i}$ in clockwise order around~$v$. The same holds if $d-\deg(f)-\eps\geq 0$ and the arc $a$ belongs to none of the sets $W_1,W_2,\ldots,W_d$ but appears between the outgoing arcs in $W_i$ and $W_{i+1}$ in clockwise order around the initial vertex of~$a$.
\end{itemize}
\end{definition}
 

%% \begin{definition}\label{def:woods}
%% Let $d\geq 3$, and let $G$ be a $d$-map. As usual, we assume that the outer vertices of $G$ are denoted by $v_1,\ldots,v_d$ in clockwise order around the outer face.
%% A \emph{$d$-grand-Schnyder wood} of $G$ is a $d$-tuple $W=(W_1,\ldots,W_d)$ of subsets of arcs of $G$ such that 
%% \begin{itemize}
%% %OLD CONVENTION \item[(W0)] For all $i\in [d]$, the set of edges $W_i$ is a tree incident to all the vertices of $G$ except $v_i,v_{i+1}$, and containing all the outer edges except those incident to $v_i$ or $v_{i+1}$. We take $v_{i-1}$ to be the root of the tree $W_i$ and we orient $W_i$ toward its root. 
%% \item[(W0)] For all $i\in [d]$, the set of arcs $W_i$ forms an spanning tree of $G$ oriented toward the root vertex $v_i$. The spanning tree $W_i$ contains the outer arcs $\{v_k,v_{k+1}\}$ for all $k\in[d]\setminus \{i\}$. Moreover, $W_i$ does not contain any inner arc incident to $v_{i}$ or $v_{i+1}$. 

%% \item[(W1)] Any internal vertex $v$ is the initial vertex of exactly one arc $a_i$ in $W_i$. The arcs  $a_1,a_2,\ldots,a_d$ appear in clockwise order around~$v$ (with the situation $a_i=a_{i+1}$ allowed for all $i$).
%% %\item[(W1)] Around every internal vertex $v$, the incident outgoing arcs $a_1,a_2,\ldots,a_d$ in the oriented trees $W_1,W_2,\ldots,W_d$ respectively appear in clockwise order around~$v$ (with the situation $a_i=a_{i+1}$ allowed for all $i$).
%% \item[(W2)] Let $v$ be an inner vertex with incident outgoing arc $a_1,a_2,\ldots,a_d$ in the trees $W_1,W_2,\ldots,W_d$ respectively. Let $a$ be an arc oriented toward $v$. 
%% If the arc $a$ belongs to the oriented tree $W_i$, then $a$ appears strictly between $a_{i+1}$ and $a_{i-1}$ in clockwise order around~$v$ (by ``strictly'', we mean that $a\neq a_{i+1}$ and  $a\neq a_{i-1}$).
%% \item[(W3)] Let $v$ be a vertex with outgoing arc $a_1,a_2,\ldots,a_d$ in the trees $W_1,W_2,\ldots,W_d$ respectively (if $v=v_k$ is the root of $W_{k}$ we adopt the convention $a_{k}:=(v_{k},v_{k-1})$). Let $a$ be an inner arc oriented toward $v$, let $f$ be the face at the right of $a$, and let $\eps$ be the number of oriented trees $W_1,W_2,\ldots,W_d$ containing the opposite arc $-a$. 
%% If $d-\deg(f)-\eps\geq 0$ and the arc $a$ belongs to the oriented trees $W_i$, then $a$ appears strictly between $a_{i+1+d-\deg(f)-\eps}$ and $a_{i}$ in clockwise order around~$v$. The same holds if $d-\deg(f)-\eps\geq 0$ and the arc $a$ belongs to none of the trees $W_1,W_2,\ldots,W_d$ but appears between the outgoing arcs in $W_i$ and $W_{i+1}$ in clockwise order around the initial vertex of~$a$.
%% %\item[(W4)] Let $a$ be an arc oriented toward the outer vertex $v_k$, and let $f$ be the face on its right. Then $a$ does not belong to the tree $W_{i}$ for all $i\in[k+1,k+1+d-\deg(f)[$.
%% %OLD VERSION (incomplete requirement for non-adapted maps). We suppose as before that $e$ is an ingoing edge of $W_i$ at $v$. Let $f$ be the face at the right of $e$, and let $k$ be the number of trees $W_1,W_2,\ldots,W_d$ for which $e$ is outgoing at $v$. If $d-\deg(f)-k\geq 0$, then $e$ is strictly between $a_{i+1+d-\deg(f)-k}$ and $a_{i-1}$ in clockwise order around~$v$.
%% \end{itemize}
%% \end{definition}


The definition of $d$-grand-Schnyder woods, or \emph{$d$-GS woods} for short, is illustrated in the second row of Figure~\ref{fig:def-incarnations}. 
 
We now prove a few additional facts that can be deduced from Conditions (W0-W3). 
Conditions (W0-W3) are all ``local'' (specifying what happens around vertices), but they actually imply the ``global property'' that the sets $W_1,\ldots,W_d$ are spanning trees as stated below (and as reflected in the figure representing Condition (W0)).
\begin{prop}\label{prop:Wi-are-trees}
Let $G$ be a $d$-map. If $\cW=(W_1,\ldots,W_d)$ is a $d$-GS wood (or even if these sets of arcs only satisfy Conditions (W0-W2)), then for all $i\in[d]$, $W_i$ is a spanning tree of $G$ oriented toward its root $v_i$.
\end{prop}

\begin{proof} Suppose that $\cW$ satisfies Conditions  (W0-W2). 
For an inner vertex $v$ and an index $i\in[d]$, let $P_i(v)$ be the directed path starting at $v$ which is obtained by following the outgoing arcs in $W_i$ until reaching an outer vertex or an inner vertex already visited. We want to show that $P_i(v)$ reaches an outer vertex.
Suppose for contradiction that there exists an inner vertex $v$ and a color $i\in [d]$, such that $P_i(v)$ ends at an inner vertex, so that $P_i(v)$ contains a cycle $C_i(v)$. We pick $v$ and $i$ such that the number of faces contained in the cycle $C_i(v)$ is minimal. Suppose, for concreteness, that $C_i(v)$ is directed clockwise. In this case, because of Condition~(W2), for every vertex $u$ on $C_i(v)$, the outgoing edge in $W_{i+1}$ at $u$ is either the same as the outgoing arc in $W_i$ or goes strictly inside $C_i(v)$. This implies that the path $P_{i+1}(u)$ cannot reach vertices laying outside of the region enclosed by $C_i(v)$. By the minimality condition on $C_i(v)$, we conclude that $C_{i+1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$. Repeating the argument, we get $C_j(u)=C_i(v)$ for all $j\in [d]$. This means that the outgoing arcs in $W_1,\ldots, W_d$ at $u$ are all equal, which contradicts Condition (W1).
Similarly, if one assumes that $C_i(v)$ is directed counterclockwise, then one can prove that $C_{i-1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$, and this leads to a contradiction as before. This concludes the proof that for all $v$, the path $P_i(v)$ reaches an outer vertex. Given Condition (W0), we see that there is a directed path in $W_i$ from any vertex to $v_i$, hence $W_i$ is a spanning tree of $G$ rooted at $v_i$.
\end{proof}


%\OB{The following remark replaces a statement added by Eric. We should refer back to it when talking about the connection to transversal structures.}
\begin{remark} Let $W=(W_1,\ldots,W_d)$ be a $d$-GS wood for a $d$-map $G$. By definition, the vertices $v_i$ and $v_{i+1}$ have degree 1 in the spanning tree $W_i$. Hence, removing from $W_i$ the outer edges, one gets a forest $W_i'$ made of $d-2$ subtrees rooted at the outer vertices $v_j,~j\neq i,i+1$, and spanning all the inner vertices. In the classical case $d=3$ of Schnyder, $W_i'$ is a subtree rooted at $v_{i-1}$ and spanning all the inner vertices as represented in Figure \ref{fig:triangulation2}. Note also that Condition~(W3) adds additional constraints about the incidence of $W_i$ with the outer vertices. For instance, if the inner faces of $G$ have degree at most $d-k$, then $v_j$ is not incident to any edge of $W_i'$ for all $j$ in $\{i,i+1,\ldots, i+k+1\}$. Hence in this case the forest $W_i'$ consists of $d-2-k$ subtrees rooted at the outer vertices $v_j,~j\notin \{i,i+1,\ldots, i+k+1\}$ (the other outer vertices are isolated).
\end{remark}
%% \OB{The following sentence replaces an equivalent statement added by Eric (but I am not sure it is necessary).\\
%% Next, we note for an inner arc $a$ of $G$ directed toward the outer vertex $v_i$, Conditions (W2) and (W3) imply that $a$ cannot belong to $W_i,W_{i-1},\ldots,W_{i-1-d+\mathrm{deg}(f)}$, where $f$ is the face on the right of~$a$ (in particular, the last statement in (W0) is redudant).}

%\EF{First, these conditions imply that, for $i\in[d]$, and for $a$ an inner arc in $W_i$ ending at an outer vertex (case where $\epsilon=0$ in (W3)), the terminal vertex of $a$ avoids $\{v_{i},\ldots,v_{i+1+d-\mathrm{deg}(f)}\}$, where $f$ is the face on the right of~$a$ (this implication does not require the last statement in (W0), which is thus redundant).}

Lastly, let us mention that Condition (W3) can be simplified if we suppose that the $d$-map $G$ is $d$-adapted. More precisely, for a $d$-adapted map $G$, the last sentence in Condition (W3) (about arcs not belonging to any of the oriented trees $W_1,\ldots W_d$) can be removed (because it becomes redundant with the other conditions). This will be shown in Section~\ref{sec:statements}, where we will prove the following statement.
\begin{lemma}\label{lem:W2'}
For a $d$-adapted map $G$, Conditions (W2) and (W3) can be replaced by the following single condition:
\begin{itemize}
\item[(W2')] Let $v$ be a vertex with outgoing arcs $a_1,a_2,\ldots,a_d$ in the trees $W_1,W_2,\ldots,W_d$ respectively (if $v=v_k$ is the root of $W_{k}$ we adopt the convention $a_{k}:=(v_{k},v_{k-1})$). Let $a$ be an inner arc oriented toward $v$. 
If the arc $a$ belongs to the oriented tree $W_i$, then $a$ appears strictly between $a_{i+1+m}$ and $a_{i-1}$ in clockwise order around~$v$, where $m=\max(0,d-\deg(f)-\eps)$, $f$ is the face at the right of $a$, and $\eps$ is the number of oriented trees $W_1,W_2,\ldots,W_d$ containing the opposite arc $-a$. 
\end{itemize}
\end{lemma}

It is convenient to think of a $d$-GS wood of $G$ as a \emph{coloring} of the arcs of $G$ with some subsets of colors in $[d]$. We say that an arc $a$ of $G$ has a \emph{color} $i\in[d]$ if this arc belong to the set $W_i$. Note that a given arc can have several colors but that these colors are necessarily consecutive (modulo $d$), because of Condition (W1). Note also that, by condition (W2), if an arc has color~$i$, then the opposite arc $-a$ does not have color $i-1$, $i$ or $i+1$. Hence the intervals of colors of the arcs $a$ and $-a$ are disjoint and non-consecutive. In Section \ref{sec:remaining-proofs}, we will establish the following bounds for the number of colors of an inner edge.
\begin{lemma} \label{lem:nb-color-arcs}
Let $G$ be a $d$-map. For any $d$-GS wood of $G$, the total numbers of colors $n_e$ of an inner edge $e$ (that is, the sum of the numbers of colors of the two arcs corresponding to $e$) satisfies
$$\deg(f)+\deg(f')-d-2~\leq ~n_e~\leq~ d-2,$$ 
where $f,f'$ are the faces incident to $e$. In particular, if $G$ is a $d$-angulation, then every inner edge has $d-2$ colors. 
\end{lemma}




%% We will prove \ref{lem:nb-color-arcs} in Section \ref{sec:statements}.

%% Note in particular that an inner edge can have at most $d-2$ colors. 
%% \OB{The preceding is not clear: we would still need to rule out a 1-way edge with $d-1$ colors... I need to think about this.}
%% On the other hand, although this does not immediately follow from the definitions, we will see that the any inner edge $e$ must have at least $\deg(f)+\deg(f')-d-2$ colors, where $f,f'$ are the faces incident to $e$; see Remark~\ref{rk:nb-color-arcs}. In particular, for a $d$-GS wood of a $d$-angulation, every inner edge has exactly $d-2$ colors. 


%% \begin{lemma}
%% In Definition \ref{def:woods} of $d$-GS wood one does not actually need to specify that the sets $W_1,\ldots, W_d$ are oriented spanning trees in Condition (W0). 
%% Instead, one could replace the Condition  ``the set of arcs $W_i$ forms an spanning tree of $G$ oriented toward the root vertex $v_i$'' by  ``for all $i\in[d]$, the set $W_i$ contains exactly one outgoing arc at every vertex $v\neq v_i$, and no outgoing arc at $v_i$.''
%% \end{lemma}

%% \begin{proof}
%% \end{proof}

We now explain how a $d$-GS wood structure makes it possible to define paths and regions associated to each vertex.
Let $G$ be a $d$-map and let $\cW=(W_1,\ldots,W_d)$ be a $d$-GS wood. Let~$v$ be an inner vertex. For all $i$ in $[d]$, let $r_i(v)$ be the first outer vertex on the directed path from~$v$ to the root $v_{i}$ in the oriented spanning tree $W_i$. We define $P_i(v)$ as the directed path of $W_i$ from $v$ to $r_i(v)$, and call it the \emph{path of color $i$ starting at $v$}. 

The paths $P_1(v),P_2(v),\ldots,P_d(v)$ can have vertices and edges in common but they cannot ``cross'' each other, as we now explain. Let $P,Q$ be two simple directed paths on $G$. We say that \emph{$P$ crosses $Q$ from left to right} if $P$ has a sequence of successive arcs $a_0,a_1,\ldots a_k$, for some $k\geq 1$, such that
\begin{compactitem}
\item the arcs $a_1,\ldots,a_{k-1}$ are all on $Q$ (either in the direction of $Q$ or in the opposite direction),
\item the terminal vertex $u$ of $a_0$ is on $Q$ but is not an extremity of $Q$, and $a_0$ is strictly on the left of $Q$ around~$u$,
\item the initial vertex $u'$ of $a_k$ is on $Q$ but is not an extremity of $Q$, and $a_k$ is strictly on the right of $Q$ around~$u'$.
\end{compactitem}
A path $P$ crossing a path $Q$ from left to right is represented in Figure~\ref{fig:crossing-pathsa}. We define a crossing from right to left symmetrically. Note that if $P$ crosses $Q$ from left to right, then $Q$ crosses $P$ from right to left. 
We say that the paths $P$ and $Q$ are \emph{non-crossing} if $P$ does not cross $Q$ from left to right nor from right to left. 
A basic observation is that, by Condition (W2) of $\cW$, the path $P_{i}(v)$ cannot cross $P_{i+1}(v)$ from left to right, and $P_{i}(v)$ cannot cross $P_{i-1}(v)$ from right to left. We will prove that more is true.
 
\fig{width=.25\linewidth}{crossing-pathsa}{A path $P$ crossing a path $Q$ from left to right.} 
%\fig{width=.3\linewidth}{crossing-paths}{(a)A path $P$ crossing a path $Q$ from left to right. (b) The situation in the proof of Lemma~\ref{lem:beam-of-paths}.}


\begin{lemma} \label{lem:beam-of-paths}
Let $G$ be a $d$-map and let $\cW=(W_1,\ldots,W_d)$ be a $d$-GS wood (or even if these sets of arcs only satisfy Conditions (W0-W2)). Let $v$ be an inner vertex and let $P_1(v),P_2(v),\ldots,P_d(v)$ be the paths of color $1,2,\ldots,d$ starting at $v$. The paths $P_1(v),P_2(v),\ldots,P_d(v)$ are pairwise non-crossing and their endpoints $r_1(v),r_2(v),\ldots,r_d(v)$ appear in clockwise order (weakly) around the outer face of $G$.
\end{lemma}

\fig{width=.8\linewidth}{beam-of-paths}{(a) The paths $P_1(v),P_2(v),\ldots,P_d(v)$ are non-crossing. (b) The region $R_i(v)$.}
Lemma~\ref{lem:beam-of-paths} is represented in Figure~\ref{fig:beam-of-paths}(a). We postpone the proof to Section \ref{sec:remaining-proofs}.
Since the paths $P_1(v),\ldots,P_d(v)$ starting at a vertex $v$ are non-crossing, one can define the region $R_1(v),\ldots,R_d(v)$ that they delimit. Precisely, we define $R_i(v)$ as the submap of $G$ lying between $P_{i-1}(v)$ and $P_i(v)$ as represented in Figure~\ref{fig:beam-of-paths}(b): $R_i(v)$ is the set of vertices, faces and edges enclosed by the cycle made of $P_{i-1}(v)$, $P_i(v)$ and the set of outer edges between $r_{i-1}(v)$ and $r_i(v)$ in clockwise direction around the outer face (the vertices and faces on this cycle are part of $R_i(v)$). The regions $R_1(v),\ldots,R_d(v)$ play an important part in the applications of Schnyder woods in the classical case $d=3$ \cite{Schnyder:wood1,Schnyder:wood2}.

%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% \begin{proof}
%% Let $i,j$ be distinct colors in $[d]$. Let us prove that $P_i(v)$ and $P_j(v)$ are non-crossing for all vertices $v$ of $G$, with the convention that $P_i(v)$ is reduced to a vertex when $v$ is an outer vertex. We make an induction on $|P_i(v)|+|P_j(v)|$, where $|P|$ denotes the length of the path~$P$. The base case $|P_i(v)|+|P_j(v)|=0$ (outer vertices) is trivial. Let $v$ be an inner vertex. If the paths $P_i(v)$ and $P_j(v)$ have no common inner vertices beside $v$, then these path are non-crossing. Assume now that there are other common inner vertices, and let $u$ be the first inner vertex on $P_i(v)$ which belongs to $P_j(v)$ and is different from $v$. By induction, we can assume that $P_i(u)$ and $P_j(u)$ are non-crossing, and we need to examine what happens at $u$.

 
%% If the first arc of $P_i(v)$ and $P_j(v)$ is equal (with endpoint $u$), then it is clear that $P_i(v)$ and $P_j(v)$ are non-crossing. Suppose now that the first arc of $P_i(v)$ and $P_j(v)$ are different. 
%% The situation is represented in Figure~\ref{fig:crossing-paths}(b).
%% Let $P_i$ (resp. $P_j$) be the part of $P_i(v)$ ($P_j(v)$) from $v$ to $u$. The union of $P_i$ and $P_j$ form a simple cycle $C$. Without loss of generality (up to changing the role of $i$ and $j$), we can assume that the finite region enclosed by $C$ is on the right of $P_i$ and the left of $P_j$. By Condition (W1), for all $k\in [i+1,j[$, the path $P_k(v)$ starts \emph{weakly inside} of $C$ (that is, on $C$ or strictly inside of $C$), and we consider the initial portion $P_k$ of $P_k(v)$ before the first arc strictly out of $C$.
%% %We claim that the end of $P_k$ is $u$ for all $k\in [i+1,j[$. 
%% Observe that $P_{i+1}$ ends on $P_j$ (since, by Condition (W2) $P_{i+1}(v)$ cannot cross $P_i(v)$ from right to left), hence $P_{i+2}$ ends on $P_j$ (since $P_{i+2}(v)$ cannot cross $P_{i+1}(v)$ from right to left), etc. Hence the path $P_k$ ends on $P_j$ for all $k\in [i+1,j[$. By a symmetric argument (starting with $P_{j-1}$), the paths $P_k$ ends on $P_i$ for all $k\in [i+1,j[$. In conclusion, all the paths $P_k$ end at $u$. For $k\in[i,j+1[$, let $a_0^k$ be the last arc of $P_{k}(v)$ before $u$ and let $a_1^k$ be the following arc. Since $a_0^k$ is weakly inside $C$ for all $k\in [i,j+1[$, and $a_1^k$ is strictly outside $C$ for all $k\in [i+1,j[$, it is not hard to see that Condition (W2) implies that the arcs $a_0^i,a_1^i,a_1^{i+1},\ldots,a_1^{j},a_0^j$ appear in clockwise order (weakly) around~$u$. From this and the fact that $P_i(u)$ and $P_j(u)$ are non-crossing it is not hard to see that $P_i(v)$ and $P_j(v)$ are non-crossing.

%% It remains to prove the statement about the clockwise order of $r_1(v),r_2(v),\ldots,r_d(v)$. This amounts to proving that for $i<j<k$ in $[d]$, the vertices $r_i(v),r_j(v)$ and $r_k(v)$ are in clockwise order around the outer face of $G$. This easily follows from the non-crossing property together with Condition (W1), and we omit the details.
%% \end{proof}

%% Since the paths $P_1(v),\ldots,P_d(v)$ starting at $v$ are non-crossing, one can define the region $R_1(v),\ldots,R_d(v)$ that they delimit. Precisely, we define $R_i(v)$ as the submap of $G$ lying between $P_{i-1}(v)$ and $P_i(v)$ as represented in Figure~\ref{fig:beam-of-paths}(b): $R_i(v)$ is the set of vertices, faces and edges enclosed by the cycle made of $P_{i-1}(v)$, $P_i(v)$ and the set of outer edges between $r_{i-1}(v)$ and $r_i(v)$ in clockwise direction around the outer face (the vertices and faces on this cycle are part of $R_i(v)$).


%% \begin{lemma}\label{lem:vi-not-in-Ri}
%% Let $G$ be a $d$-map and let $\cW$ be a $d$-GS wood. Let $v$ be an inner vertex. For $i$ in $[d]$, let $r_i(v)$ be the endpoint of the path $P_i(v)$ of color $i$ starting at $v$. For all $i\in [d]$, the outer vertex $v_i$ appears strictly between $r_{i}(v)$ and $r_{i-1}(v)$ in clockwise order around the outer face of $G$. Equivalently, $v_i$ does not belong to the region $R_i(v)$.
%% \end{lemma}
%% Lemma~\ref{lem:vi-not-in-Ri} is represented in Figure~\ref{fig:beam-of-paths}(b).

%% \begin{proof}
%% For some outer vertices $u_1,\ldots, u_k$, we say that $u_1,\ldots, u_k$ \emph{appear clockwise} to mean that they are appear in clockwise order weakly around the outer face of $G$. Suppose for contradiction that Lemma~\ref{lem:vi-not-in-Ri} does not hold. For concreteness let us suppose that $v_1$ is in $R_1(v)$. Since $r_1(v)\neq v_1,v_2$ and $r_d(v)\neq v_d,v_1$ by Condition (W0), this implies that $r_d(v), v_d, v_1,v_2, r_1(v)$ appear clockwise. Since $r_2(v)\neq v_2,v_3$, Lemma~\ref{lem:beam-of-paths} implies that $r_d(v), v_d, v_1,v_2, v_3, r_2(v)$  appear clockwise. Continuing in this manner, we get that $r_d(v), v_d, v_1,v_2, v_d, r_{d-1}(v)$ appear clockwise. This gives $r_d(v)=v_d$, which contradicts (W0).
%% \end{proof}

%% \begin{cor} \label{cor:containment-regions}
%% Let $G$ be a $d$-map and let $\cW$ be a $d$-GS wood. Let $v,v'$ be distinct inner vertices of~$G$. If $v'$ belongs to the region $R_i(v)$ for some $i\in[d]$, then $R_{i}(v')$ is contained in $R_{i}(v)$, and $R_i(v')\neq R_i(v)$.
%% \end{cor}


%% \begin{proof}
%% Suppose that $v'$ belongs to $R_i(v)$. Observe that if the paths $P_i(v')$ and $P_i(v)$ has a vertex in common, then these paths will ``merge'' and $r_{i}(v')=r_{i}(v)$. Moreover, Condition (W2) implies that $P_{i}(v')$ cannot cross $P_{i-1}(v)$ from right to left. Hence, the path $P_i(v')$ stays inside $R_{i}(v)$. Similarly,  $P_{i-1}(v')$ stays inside $R_{i}(v)$. 
%% In particular, the endpoints $r_{i-1}(v')$ and $r_{i}(v')$ are both between $r_{i-1}(v)$ and $r_i(v)$ in clockwise order around the outer face of $G$. Furthermore, Lemma~\ref{lem:vi-not-in-Ri} implies that the vertices $r_{i-1}(v),\,r_{i-1}(v'),\,r_{i}(v'),\,r_i(v)$ appear in this order clockwise around the outer face of $G$. Thus $R_{i}(v')$ is contained in $R_{i}(v)$. Lastly,  $R_i(v')\neq R_i(v)$ because otherwise the paths $P_{i-1}(v')$ and $P_i(v')$ would both go through $v$, which is impossible by Condition (W2) at $v$.
%% \end{proof}


%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Grand-Schnyder marked orientations}\label{subsec:GS-marked}
In this subsection, we define grand-Schnyder marked orientations for $d$-maps. 
Recall from Section~\ref{sec:notation}, that a \emph{weighted orientation} of a graph is an assignment of a non-negative integer to each arc of this graph called its \emph{weight}. A \emph{corner marking} of a plane map $G$ is the assignment of a non-negative number to each inner corner of $G$; this number is interpreted as the ``number of marks" of the corner. 
%non-negative number of \emph{marks} to each inner corner of $G$.
A $d$-GS marked orientation is a weighted orientation together with a corner marking satisfying certain conditions represented in Figure~\ref{fig:def-incarnations} (third row).


\begin{definition}\label{def:marked}
Let $d\geq 3$, and let $G$ be a $d$-map.
A \emph{$d$-grand-Schnyder marked orientation} of $G$ is a weighted orientation of $G$, together with a corner marking satisfying the following conditions.
\begin{itemize}
\item[(M0)] The weight of every outer arc is 0. For any inner arc $a$ whose initial vertex is an outer vertex $v_i$, the weight of $a$ and the number of marks in the corner of $v_i$ on the left of $a$ are both equal to $d-\deg(f)$, where $f$ is the face on the left of $a$. %For any inner arc $a$ whose initial vertex is an outer vertex $v_i$, the weight of $a$ is equal to the number of marks in the corner of $v_i$ on the left of $a$. 
\item[(M1)] For any inner face $f$, the total number of marks in the corners of $f$ is $d-\deg(f)$.
\item[(M2)] The weight of every inner edge is $d-2$, and the outgoing weight of every inner vertex $v$ is $d+m$,  where $m$ is the number of marks in the corners incident to~$v$. 
\item[(M3)] The weight of every inner arc $a$ is at least $d-\deg(f)$, where $f$ is the face on the left of~$a$.
\end{itemize}
\end{definition}
The definition of $d$-grand-Schnyder marked orientations, or \emph{$d$-GS marked orientations} for short, is illustrated in the third row of Figure~\ref{fig:def-incarnations}.
%in Figure~\ref{fig:def-marked}.
%\fig{width=\linewidth}{def-marked}{Conditions (M0), (M1), (M2) and (M3) defining $d$-GS marked orientations. The weights of the orientation are indicated by arrowheads (the number of arrowhead indicates the weight), while the markings are indicated by arcs in the corners (the number of arcs indicates the number of marks).}
%\begin{remark}\label{rk:M0-improved}


%% Although this is not immediate from the definition, the above conditions imply the following strengthening of Condition (M0): 
%% \begin{itemize}
%% \item[(M0')] For any inner arc $a$ whose initial vertex is an outer vertex $v_i$, the weight of $a$ and the number of marks in the corner of $v_i$ on the left of $a$ are both equal to $d-\deg(f)$, where $f$ is the face on the left of $a$.
%% \end{itemize}
%% TODO: Explain counting argument (or leave the proof for later).
%% %\end{remark}


\subsection{Grand-Schnyder angular orientations}\label{subsec:GS-angular}
In this subsection, we define grand-Schnyder angular orientations of $d$-maps. 
The \emph{angular map} of a plane map $G$ is the plane map $G^+$ obtained from $G$ by placing a new vertex $v_f$ in each inner face $f$ of $G$, and joining $v_f$ to all the vertices of $G$ incident to $f$ (more precisely, one edge from $v_f$ to each corner of $f$). The angular map $G^+$ has two types of vertices and edges: the \emph{original vertices and edges} of $G$, and the new vertices and edges that we call \emph{star vertices and edges}. The angular map is represented in Figure \ref{fig:angular-map}.
 %A $d$-grand-Schnyder angular orientation of a $d$-map $G$ is a weighted orientation of the angular map $G^+$ satisfying certain conditions represented in Figure~\ref{fig:def-incarnations} (bottom row). 
 

\fig{width=\linewidth}{angular-map}{(a) A 5-map $G$. (b) The angular map $G^+$. (c) The corner graph $C_G$.}

\begin{definition}\label{def:angular}
Let $d\geq 3$, and let $G$ be a $d$-map.
A \emph{$d$-grand-Schnyder angular orientation} of $G$ is a weighted orientation of the angular map $G^+$ satisfying the following conditions.
\begin{itemize}
\item[(A0)] The weight of every outer arc is 0. Any inner arc $a$ of $G^+$ whose initial vertex is an outer vertex $v_i$ has weight $0$, unless $a$ is the arc following the outer edge $(v_i,v_{i-1})$ around~$v_i$ (for this arc there is no condition).
\item[(A1)] The outgoing weight of any star vertex $v_f$ is $d-\deg(f)$, and the weight of every star edge incident to $v_f$ is $d-\deg(f)$.
%For any star vertex $v_f$, the weight of every star edge incident to $v_f$ are $d-\deg(f)$, and the outgoing weight of $v_f$ is $d-\deg(f)$. 
\item[(A2)] The outgoing weight of every inner original vertex is $d$. The weight of any original inner edge $e$ is $\deg(f)+\deg(f')-d-2$, where $f,f'$ are the faces of $G$ incident to~$e$. 
\end{itemize}
\end{definition}
The definition of $d$-grand-Schnyder angular orientations, or \emph{$d$-GS angular orientations} for short, is illustrated in the bottom row of Figure~\ref{fig:def-incarnations}. 

\begin{remark}\label{rk:frozen}
In the representation of Condition (A0) the weight of one of the star edges out of $v_i$ is indicated as $x$. Although this weight is not explicitly specified by Condition (A0), this weight is actually $d-\deg(f)$, where $f$ is the face of $G$ containing this star edge. Indeed, this is implied by combining Condition (A1) at $v_f$ with Condition (A0) for the other outer vertices incident to $f$.
\end{remark}
%in Figure~\ref{fig:def-angular}.
%\fig{width=\linewidth}{def-angular}{Conditions (A0), (A1) and (A2) defining $d$-GS angular orientations. The weights of the orientation are indicated by arrowheads.}



%\bibliography{biblio-Schnyder}
%\end{document}
