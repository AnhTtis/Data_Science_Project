%\documentclass{amsart}
%\input{defs.tex}
%\begin{document}     


In this Section we prove Lemma~\ref{lem:beam-of-paths} about $d$-GS woods and establish some further consequences. Then, we prove Proposition~\ref{prop:bij-theta} establishing the bijection between $d$-GS woods and $d$-GS labelings, and some easy corollaries.

\subsection{Proof of Lemma~\ref{lem:beam-of-paths} and consequences}
\begin{proof}[Proof of Lemma~\ref{lem:beam-of-paths}]
Let $i,j$ be distinct colors in $[d]$. Let us prove that $P_i(v)$ and $P_j(v)$ are non-crossing for all vertices $v$ of $G$, with the convention that $P_i(v)$ is reduced to a vertex when $v$ is an outer vertex. We make an induction on $|P_i(v)|+|P_j(v)|$, where $|P|$ denotes the length of the path~$P$. The base case $|P_i(v)|+|P_j(v)|=0$ (outer vertices) is trivial. Let $v$ be an inner vertex. If the paths $P_i(v)$ and $P_j(v)$ have no common inner vertices beside $v$, then these paths are non-crossing. Assume now that there are other common inner vertices, and let $u$ be the first inner vertex on $P_i(v)$ which belongs to $P_j(v)$ and is different from $v$. By induction, we can assume that $P_i(u)$ and $P_j(u)$ are non-crossing, and we need to examine what happens at $u$.

 
If the first arc of $P_i(v)$ and $P_j(v)$ is equal (with endpoint $u$), then it is clear that $P_i(v)$ and $P_j(v)$ are non-crossing. Suppose now that the first arcs of $P_i(v)$ and $P_j(v)$ are different. 
The situation is represented in Figure~\ref{fig:crossing-pathsb}.
Let $P_i$ (resp. $P_j$) be the part of $P_i(v)$ ($P_j(v)$) from $v$ to~$u$. The union of $P_i$ and $P_j$ forms a simple cycle $C$. For concreteness, let us assume that 
 the finite region enclosed by $C$ is on the right of $P_i$ and on the left of $P_j$ (the other case being treated in the exact same manner). By Condition (W1), for all $k\in [i+1:j[$, the path $P_k(v)$ starts \emph{weakly inside} of $C$ (that is, on $C$ or strictly inside of $C$), and we consider the initial portion $P_k$ of $P_k(v)$ before the first arc strictly out of $C$.
%We claim that the end of $P_k$ is $u$ for all $k\in [i+1,j[$. 
Observe that $P_{i+1}$ ends on $P_j$ (since, by Condition (W2) $P_{i+1}(v)$ cannot cross $P_i(v)$ from right to left), hence $P_{i+2}$ ends on $P_j$ (since $P_{i+2}(v)$ cannot cross $P_{i+1}(v)$ from right to left), etc. Hence the path $P_k$ ends on $P_j$ for all $k\in [i+1:j[$. By a symmetric argument (starting with $P_{j-1}$), the path $P_k$ ends on $P_i$ for all $k\in [i+1:j[$. In conclusion, all the paths $P_k$ end at $u$. For $k\in[i:j+1[$, let $a_0^k$ be the last arc of $P_{k}(v)$ before $u$ and let $a_1^k$ be the following arc. Since $a_0^k$ is weakly inside $C$ for all $k\in [i:j+1[$, and $a_1^k$ is strictly outside $C$ for all $k\in [i+1:j[$, %it is not hard to see that 
Condition (W2) implies that the arcs $a_0^i,a_1^i,a_1^{i+1},\ldots,a_1^{j},a_0^j$ appear in clockwise order (weakly) around~$u$. From this and the fact that $P_i(u)$ and $P_j(u)$ are non-crossing it is not hard to see that $P_i(v)$ and $P_j(v)$ are non-crossing (indeed, if $P_i(u)$ was to enter $C$ by crossing $P_j(v)$, then it would have to cross $P_j(v)$ again to exit $C$ and this would violate the induction hypothesis).
\fig{width=.3\linewidth}{crossing-pathsb}{The situation in the proof of Lemma~\ref{lem:beam-of-paths}.}

It remains to prove the statement about the clockwise order of $r_1(v),r_2(v),\ldots,r_d(v)$. This amounts to proving that for $i<j<k$ in $[d]$, the vertices $r_i(v),r_j(v)$ and $r_k(v)$ are (weakly) in clockwise order around the outer face of $G$. This easily follows from the non-crossing property together with Condition (W1), and we omit the details.
\end{proof}

%% Since the paths $P_1(v),\ldots,P_d(v)$ starting at $v$ are non-crossing, one can define the region $R_1(v),\ldots,R_d(v)$ that they delimit. Precisely, we define $R_i(v)$ as the submap of $G$ lying between $P_{i-1}(v)$ and $P_i(v)$ as represented in Figure~\ref{fig:beam-of-paths}(b): $R_i(v)$ is the set of vertices, faces and edges enclosed by the cycle made of $P_{i-1}(v)$, $P_i(v)$ and the set of outer edges between $r_{i-1}(v)$ and $r_i(v)$ in clockwise direction around the outer face (the vertices and faces on this cycle are part of $R_i(v)$).


\begin{lemma}\label{lem:vi-not-in-Ri}
Let $G$ be a $d$-map and let $\cW$ be a $d$-GS wood (or a $d$-tuple of sets of arcs only satisfying Conditions (W0-W2)). Let $v$ be an inner vertex. For $i$ in $[d]$, let $r_i(v)$ be the endpoint of the path $P_i(v)$ of color $i$ starting at $v$. For all $i\in [d]$, the outer vertex $v_i$ appears strictly between $r_{i}(v)$ and $r_{i-1}(v)$ in clockwise order around the outer face of $G$. Equivalently, $v_i$ does not belong to the region $R_i(v)$.
\end{lemma}
Lemma~\ref{lem:vi-not-in-Ri} is represented in Figure~\ref{fig:beam-of-paths}(b).

\begin{proof}
For some outer vertices $u_1,\ldots, u_k$, we say that $u_1,\ldots, u_k$ \emph{appear clockwise} to mean that they are appear in clockwise order weakly around the outer face of $G$. Suppose for contradiction that Lemma~\ref{lem:vi-not-in-Ri} does not hold. For concreteness, let us suppose that $r_{d}(v), v_1, r_{1}(v)$ appear clockwise.
%$v_1$ is in $R_1(v)$. 
Since $r_1(v)\neq v_1,v_2$ and $r_d(v)\neq v_d,v_1$ by Condition (W0), this implies that $r_d(v), v_d, v_1,v_2, r_1(v)$ appear clockwise. Since $r_2(v)\neq v_2,v_3$, Lemma~\ref{lem:beam-of-paths} implies that $r_d(v), v_d, v_1,v_2, v_3, r_2(v)$ appear clockwise. Continuing in this manner, we get that $r_d(v), v_d, v_1,v_2, v_d, r_{d-1}(v)$ appear clockwise. This gives $r_d(v)=v_d$, which contradicts (W0).
\end{proof}

\begin{cor} \label{cor:containment-regions}
Let $G$ be a $d$-map and let $\cW$ be a $d$-GS wood (or even if these sets of arcs only satisfy Conditions (W0-W2)). Let $v,v'$ be distinct inner vertices of~$G$. If $v'$ belongs to the region $R_i(v)$ for some $i\in[d]$, then $R_{i}(v')$ is contained in $R_{i}(v)$, and $R_i(v')\neq R_i(v)$.
\end{cor}


\begin{proof}
Suppose that $v'$ belongs to $R_i(v)$. Observe that if the paths $P_i(v')$ and $P_i(v)$ have a vertex in common, then these paths will ``merge'' and $r_{i}(v')=r_{i}(v)$. Moreover, Condition (W2) implies that $P_{i}(v')$ cannot cross $P_{i-1}(v)$ from right to left. Hence, the path $P_i(v')$ stays inside $R_{i}(v)$. Similarly, $P_{i-1}(v')$ stays inside $R_{i}(v)$. 
In particular, the endpoints $r_{i-1}(v')$ and $r_{i}(v')$ are both between $r_{i-1}(v)$ and $r_i(v)$ in clockwise order around the outer face of $G$. Furthermore, Lemma~\ref{lem:vi-not-in-Ri} implies that the vertices $r_{i-1}(v),\,r_{i-1}(v'),\,r_{i}(v'),\,r_i(v)$ appear in this order clockwise around the outer face of $G$. Thus $R_{i}(v')$ is contained in $R_{i}(v)$. Lastly, $R_i(v')\neq R_i(v)$ because otherwise one of the paths $P_{i-1}(v')$ or $P_i(v')$ would have to go through $v$, which is impossible by Condition (W2) at $v$.
\end{proof}






\subsection{Proof of Proposition~\ref{prop:bij-theta} and consequences.}
We will now prove Proposition~\ref{prop:bij-theta} and Lemma~\ref{lem:W2'}.
\begin{lemma}\label{lem:image-theta}
Let $G$ be a $d$-map. For any $d$-GS labeling $\cL$ of $G$, the image $\Th(\cL)$ is a $d$-GS wood.
\end{lemma}

\begin{proof}
Let $\cL\in \bL_G$, and let $\cW=(W_1,\ldots,W_d)=\Th(\cL)$ be the corresponding arc coloring (where $W_i$ is the set of arcs of color $i$).


In $\cL$ the sum of label jumps in clockwise order around any inner vertex is $d$, hence the inner vertices of $G$ are incident to one outgoing arc of color $i$ for all $i\in [d]$, and the colors are not all on the same arc. 
Moreover, by definition of $\Th$, the outer vertex $v_k$ of $G$ is incident to one outgoing arc of color $i$ for all $i\neq k$, and no outgoing arc of color $k$. Lastly, it is easy to see that Property (L0) of $\cL$ implies that $v_i$ and $v_{i+1}$ are not incident to ingoing arcs of color $i$. Hence $\cW$ satisfies (W0).

For any inner vertex $v$, the sum of label jumps in clockwise order around $v$ is $d$. This implies that the outgoing arcs of color $1,2,\ldots,d$ at $v$ appear in clockwise order around $v$. Hence $\cW$ satisfies (W1).

%Before proving that the subsets of arcs $W_1,\ldots, W_d$ are trees, 
%We observe that $\cW$ satisfy Condition (W1) because in $\cL$ the sum of label jumps in clockwise order around any inner vertex is $d$. 
Next, we show that $\cW$ satisfies Condition (W2). 
Let $a$ be an inner arc of $G$ oriented from $u$ to $v$. We assume that $a$ has color $i$ in $\cW$, and that $v$ is an inner vertex. 
We want to show that $a$ appears strictly between the outgoing arc of color $i+1$ and the outgoing arc of color $i-1$ around $v$. 
Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}.
 Since the arc $a$ has color $i$, we have $i\in [i_1:i_2[$. Moreover, since the label jumps are all positive around faces by Condition (L2), we have $i-1,i, i+1\in [i_4:i_1[\cup [i_1:i_2[\cup [i_2:i_3[$. By Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around the arc $a$ is equal to $d$, hence the sets $[i_4:i_1[$, $[i_1:i_2[$, $[i_2:i_3[$, and $[i_3:i_4[$ are disjoint (and give a partition of $[d]$). This implies that the arcs of color $i-1$, $i$ and $i+1$ appear in this order in clockwise order around $v$ starting at the corner labeled $i_4$ and ending at the corner labeled $i_3$, which proves that the arc $a$ satisfies (W2).

\fig{width=.3\linewidth}{labels-around-edge}{Corner labels around an edge.}

%Next, we show that the set of arcs $W_i$ is a spanning tree oriented toward $v_{i}$ for all $i\in [d]$. By (W1), every inner vertex is incident to exactly 1 outgoing arc of color $i$ for all $i\in[d]$. Let $v$ be an inner vertex. We consider the path $P_i(v)$ starting at $v$ which is obtained by following the arcs of color $i$ until reaching an outer vertex or an inner vertex already visited. Suppose for contradiction that there exists an inner vertex $v$ and a color $i\in [d]$, such that $P_i(v)$ ends at an inner vertex, so that $P_i(v)$ contains a cycle $C_i(v)$. We pick $v$ and $i$ such that the number of faces contained in the cycle $C_i(v)$ is minimal. Suppose first that $C_i(v)$ is directed clockwise. In this case, because of Condition (W2), for every vertex $u$ on $C_i(v)$, the outgoing edge of color $i+1$ at $u$ is either the same as the outgoing arc of color $i$ or goes strictly inside $C_i(v)$. This implies that the path $P_{i+1}(u)$ cannot reach vertices laying outside of the region enclosed by $C_i(v)$. By the minimality condition on $C_i(v)$, we conclude that $C_{i+1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$. Repeating the argument, we get $C_j(u)=C_i(v)$ for all $j\in [d]$. We reach a contradiction because, by definition of $\Th$, no arc can have all the colors in $[d]$. Similarly, if one supposes that $C_i(v)$ is directed counterclockwise, then one can prove that $C_{i-1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$, and this leads to a contradiction as before. This concludes the proof that for all $v$, the path $P_i(v)$ reaches an outer vertex. Lastly, since the labeling $\cL$ satisfy (L0) it is easy to see that the outer vertices $v_i$ and $v_{i+1}$ are not incident to ingoing inner arcs of color $i$. Thus, all the paths $P_i(v)$ end at an outer vertex distinct from $v_{i}, v_{i+1}$, which implies that the set of arcs $W_i$ forms a spanning tree oriented toward $v_{i}$. Moreover $v_i,v_{i+1}$ are no incident to ingoing arcs of color $i$, hence $\cW$ satisfies (W0).

It remains to show that $\cW$ satisfies (W3). Consider an inner arc $a$ oriented from $u$ to $v$. Let $f$ be the face at the right of $a$. Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}. 
Suppose that $a$ has color $i$, or that $a$ is strictly between the outgoing arcs of color $i$ and $i+1$ in clockwise order around $u$. Suppose also that the number $\eps:=|[i_3:i_4[|$ of colors of the arc $-a$ satisfies $d-\deg(f)-\eps>0$. 
In order to prove that the arc $a$ satisfies Condition~(W3), it suffices to prove that $[i:i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. Since, by Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around $a$ is $d$, we have $[i_4:i_3[=[i_4:i_2[\cup [i_1:i_3[$. Moreover, under our hypotheses, $i\in[i_4:i_2[$, and $[i+1:i+1+\delta[\subseteq [i_1:i_3[$, where $\delta=|[i_2:i_3[|$.
Lastly, by Condition (L3) we have $\delta\geq d+1-\deg(f)-\eps$, hence $[i :i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. This concludes the proof that Condition (W3) holds. Thus, $\cW$ is a $d$-GS wood.
\end{proof}

%% \begin{proof}
%% Let $\cL\in \bL_G$, and let $\cW=(W_1,\ldots,W_d)=\Th(\cL)$ be the corresponding arc coloring (where $W_i$ is the set of arcs of color $i$). 
%% %Before proving that the subsets of arcs $W_1,\ldots, W_d$ are trees, 
%% We observe that $\cW$ satisfy Condition (W1) because in $\cL$ the sum of label jumps in clockwise order around any inner vertex is $d$. 
%% Next, we show that $\cW$ satisfy Condition (W2). 
%% Let $a$ be an inner arc of $G$ oriented from $u$ to $v$. We assume that $a$ has color $i$ in $\cW$, and that $v$ is an inner vertex. 
%% We want to show that $a$ appears strictly between the outgoing arc of color $i+1$ and the outgoing arc of color $i+1$ around $v$. 
%% Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}.
%% Since the arc $a$ has color $i$, we have $i\in [i_1:i_2[$. Moreover, since the label jumps are all positive around faces by Condition (L2), we have $i-1,i, i+1\in [i_4:i_1[\cup [i_1:i_2[\cup [i_1:i_3[$. By Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around the arc $a$ is equal to $d$, hence the sets $[i_4,i_1[$, $[i_1:i_2[$, $[i_2:i_3[$, and $[i_3:i_4[$ are disjoint (and give a partition of $[d]$). This implies that the arcs of color $i-1$, $i$ and $i+1$ will appear in this order in clockwise order around $v$ starting at the corner labeled $i_4$ and ending at the corner labeled $i_3$, which proves that the arc $a$ satisfies (W2).

%% \fig{width=.3\linewidth}{labels-around-edge}{Corner labels around an edge.}

%% Next, we show that the set of arcs $W_i$ is a spanning tree oriented toward $v_{i}$ for all $i\in [d]$. 
%% By (W1), every inner vertex is incident to exactly 1 outgoing arc of color $i$ for all $i\in[d]$. 
%% Let $v$ be an inner vertex. We consider the path $P_i(v)$ starting at $v$ which is obtained by following the arcs of color $i$ until reaching an outer vertex or an inner vertex already visited. Suppose for contradiction that there exists an inner vertex $v$ and a color $i\in [d]$, such that $P_i(v)$ ends at an inner vertex, so that $P_i(v)$ contains a cycle $C_i(v)$. We pick $v$ and $i$ such that the number of faces contained in the cycle $C_i(v)$ is minimal. Suppose first that $C_i(v)$ is directed clockwise. In this case, because of Condition (W2), for every vertex $u$ on $C_i(v)$, the outgoing edge of color $i+1$ at $u$ is either the same as the outgoing arc of color $i$ or goes strictly inside $C_i(v)$. This implies that the path $P_{i+1}(u)$ cannot reach vertices laying outside of the region enclosed by $C_i(v)$. By the minimality condition on $C_i(v)$, we conclude that $C_{i+1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$. Repeating the argument, we get $C_j(u)=C_i(v)$ for all $j\in [d]$. We reach a contradiction because, by definition of $\Th$, no arc can have all the colors in $[d]$. Similarly, if one supposes that $C_i(v)$ is directed counterclockwise, then one can prove that $C_{i-1}(u)$ is equal to $C_i(v)$ for any vertex $u$ on $C_i(v)$, and this leads to a contradiction as before. This concludes the proof that for all $v$, the path $P_i(v)$ reaches an outer vertex. 
%% Lastly, since the labeling $\cL$ satisfy (L0) it is easy to see that the outer vertices $v_i$ and $v_{i+1}$ are not incident to ingoing inner arcs of color $i$. Thus, all the paths $P_i(v)$ end at an outer vertex distinct from $v_{i}, v_{i+1}$, which implies that the set of arcs $W_i$ forms a spanning tree oriented toward $v_{i}$. Moreover $v_i,v_{i+1}$ are no incident to ingoing arcs of color $i$, hence $\cW$ satisfies (W0).

%% It remains to show that $\cW$ satisfies (W3). Consider an inner arc $a$ oriented from $u$ to $v$. Let $f$ be the face at the right of $a$. Let $i_1,i_2,i_3,i_4$ be the labels in counterclockwise order around $a$ as indicated in Figure~\ref{fig:labels-around-edge}. 
%% Suppose that $a$ has color $i$, or that $a$ is strictly between the outgoing arcs of color $i$ and $i+1$ in clockwise order around $u$. Suppose also that the number $\eps:=|[i_3:i_4[|$ of colors of the arc $-a$ satisfies $d-\deg(f)-\eps>0$. 
%% In order to prove that the arc $a$ satisfy condition (W3), it suffices to prove that $[i:i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. Since, by Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps counterclockwise around $a$ is $d$, we have $[i_4:i_3[=[i_4:i_2[\cup [i_1:i_3[$. Moreover, under our hypotheses, $i\in[i_4:i_2[$, and $[i+1:i+1+\delta[\subseteq [i_1:i_3[$, where $\delta=|[i_2:i_3[|$.
%% Lastly, by Condition (L3) we have $\delta\geq d+1-\deg(f)-\eps$, hence $[i+1:i+2+d-\deg(f)-\eps[\subseteq [i_4:i_3[$. This concludes the proof of that Condition (W3) holds. Thus $\cW$ is a $d$-GS wood.
%% \end{proof}

\begin{lemma}\label{lem:image-theta-inverse}
Let $G$ be a $d$-map. For any $d$-GS wood $\cW$ of $G$, the image $\bTh(\cW)$ is a $d$-GS labeling.
\end{lemma}

\begin{proof}
Let $\cW$ be a $d$-GS wood of $G$, and let $\cL=\bTh(\cW)$. Condition (L0) holds for $\cL$ by definition of $\bTh$. Moreover it is clear that Condition (W1) for $\cW$ implies that the sum of label jumps clockwise around inner vertices is always $d$. In order to establish that $\cL$ satisfies (L1) and (L2) we need to establish two technical results about the label situation around inner edges. 

\noindent \textbf{Claim 1:} For every inner edge $e$ of $G$, the 4 corners incident to $e$ cannot all have the same label.

Suppose, for contradiction, that all 4 corners incident to $e$ have the same label $j$. Let $a$ be an arc of $e$, and let $u$ and $v$ be the initial and terminal vertices respectively. Let $i=j-1$. By definition, the arc $a$ (resp. $-a$) belongs to none of the sets $W_1,\ldots, W_d$ but appears between the outgoing arc in $W_{i}$ and $W_{i+1}$ in clockwise order around $u$ (resp. $v$). This contradicts Condition (W3) for $a$.
%% Suppose for the sake of contradiction, that an inner edge $e$ has its 4 incident corners labeled $i$. First observe that $e$ is not a loop by Condition (W3), so $e$ has 2 distinct endpoints $u,v$. Note that $u$ and $v$ cannot both be outer vertices by Condition (L0). Hence, we can suppose that $v$ is an inner vertex without loss of generality. Consider the paths $P_1(v),\ldots,P_d(v)$ of color $1,2,\ldots,d$ starting at $v$ as defined in Section~\ref{subsec:GS-woods}. Let $R_i(v)$ be the region delimited by the paths $P_{i-1}(v)$ and $P_i(v)$. Since the corners incident to $e$ have label $i$, the edge $e$ is in $R_i(v)$, hence $u$ is in $R_i(v)$. By Lemma~\ref{lem:vi-not-in-Ri} this implies that $u\neq v_i$. Since $u$ is incident to some corners labeled $i$, we conclude that $u$ is not an outer vertex. Hence, both $u$ and $v$ are inner vertices. Moreover, $u$ is in $R_i(v)$, and symmetrically $v$ is in $R_i(u)$.
%% By Corollary~\ref{cor:containment-regions}, the region $R_i(u)$ is strictly contained in $R_i(v)$, and $R_i(v)$ is strictly contained in $R_i(u)$. This is a contradiction, hence Claim 1 holds.

\noindent \textbf{Claim 2:} Let $a$ be an inner arc of $G$, and let $i_1,i_2,i_3,i_4$ be the labels of the incident corners as indicated in Figure~\ref{fig:labels-around-edge}. The sum of label jumps in counterclockwise order around $a$ is $d$, and moreover $i_2\neq i_3$ and $i_1\neq i_4$.


Let us first prove Claim 2 in the case $i_1\neq i_2$. If $i_1\neq i_2$ then by property (W2) of $\cW$ we have $[i_1:i_2[\cap [i_3:i_4[=\emptyset$, hence the sum of label jumps in counterclockwise order around $a$ is~$d$. Moreover, still by property (W2), $i_2\neq i_3$ and $i_1\neq i_4$ so Claim 2 holds. 
By symmetry, if $i_3\neq i_4$, then Claim 2 holds.
Lastly, if $i_1=i_2$ and $i_3=i_4$, then $i_1=i_2\neq i_3=i_4$ by Claim 1, which implies again that the sum of label jumps in counterclockwise order around $e$ is $d$, and Claim 2 holds again.

Claim 2 trivially implies that $\cL$ satisfies (L2). Moreover, Claim 2 implies that the sum of label jumps clockwise around every inner face is at least $d$ (since it is a multiple of $d$ and cannot be 0). Next, we use Equation~\eqref{eq:sum-jumps-relation} between the sum of label jumps around vertices, edges and faces.
Using Claim 2, we get
\begin{equation}\label{eq:sum-jumps-relation2}
d(|V|+|F|)\leq \sum_{v\in V}\cwjump(v)+\sum_{f\in F}\cwjump(f) =d+\sum_{e\in E}\ccwjump(e)=d(1+|E|),
\end{equation}
where $V,F,E$ are the set of inner vertices, faces, and edges of $G$ respectively. By the Euler relation we have $|V|+|F|=1+|E|$, hence the inequality in~\eqref{eq:sum-jumps-relation2} is an equality. Thus the sum of label jumps clockwise around every inner face is $d$. This complete the proof that $\cL$ satisfies (L1).

It remains to prove that $\cL$ satisfies (L3). Consider an inner arc $a$ oriented from $u$ to $v$ with incident corners labeled $i_1,i_2,i_3,i_4$ as indicated in Figure~\ref{fig:labels-around-edge}. Let $f$ be the face at the right of $a$, let $\delta=|[i_2:i_3[|$ and let $\eps=|[i_3:i_4[|$. We want to show $\delta+\eps\geq d-\deg(f)+1$.
If $d-\deg(f)-\eps<0$, then this inequality clearly holds (since $\delta>0$). Suppose now that $d-\deg(f)-\eps\geq 0$, and consider Consider (W3) of $\cW$. If $i_1\neq i_2$, then Condition (W3) applied to color $i=i_2-1$ of $a$ gives $\delta\geq d-\deg(f)-\eps+1$ as wanted. If $i_1=i_2$, then $a$ is between the outgoing arcs of $W_i$ and $W_{i+1}$ around $u$ for $i=i_2-1$ and we also get $\delta\geq d-\deg(f)-\eps+1$ as wanted. This shows that $\cL$ satisfies (L3), which completes the proof that $\cL$ is a $d$-GS labeling.
\end{proof}

\begin{proof}[Proof of Proposition~\ref{prop:bij-theta}] Let $G$ be $d$-map. 
By Lemmas~\ref{lem:image-theta} and~\ref{lem:image-theta-inverse}, $\Th$ is a map from $\bL_G$ to $\bW_G$, and $\bTh$ is a map from $\bW_G$ to $\bL_G$. It is easy to see that $\bTh\circ \Th=\Id_{\bL_G}$ and $\Th\circ \bTh=\Id_{\bW_G}$. Thus these are inverse bijections. 
\end{proof}

Before closing this section, we prove Lemmas~\ref{lem:nb-color-arcs} and~\ref{lem:W2'} as corollaries of Proposition~\ref{prop:bij-theta}.


\begin{proof}[Proof of Lemma~\ref{lem:nb-color-arcs}]
Let $G$ be a $d$-map, let $e$ be an inner edge, and let $f$ and $f'$ be the faces incident to $e$. Let $n_e$ be the number of colors of $e$. Consider the $d$-GS labeling $\cL=\bTh(\cW)$. By Lemma~\ref{lem:ccw-jumps-edges}, the sum of label jumps in counterclockwise order around $e$ is $d$. This is represented in Figure~\ref{fig:edge-jumps}, and we refer to this figure to define the label jumps $\delta, \eps,\delta',\eps'$ around $e$. The number of colors of $e$ in $\cW$ is 
$$n_e=\eps+\eps'=d-\delta-\delta'.$$ 
Moreover, $1\leq \delta\leq d-\deg(f)+1$ and $1\leq \delta'\leq d-\deg(f')+1$ because the sum of label jumps around faces is $d$ and each jump is at least 1. This gives $\deg(f)+\deg(f')-d-2\leq n_e\leq d-2$ as claimed.
\end{proof}
 
\begin{proof}[Proof of Lemma~\ref{lem:W2'}]
Let $G$ be a $d$-adapted map, and let $\bW_G'$ be the set of maps satisfying Conditions (W0), (W1) and (W2'). We clearly have the inclusion $\bW_G\subseteq \bW_G'$ and want to show $\bW_G'= \bW_G$. 

Let $\bTh'$ be the extension of the map $\bTh$ to $\bW_G'$ (with the same definition as $\bTh$). Let $\cW\in \bW_G'$ and let $\cL=\bTh'(\cW)$. We want to show that $\cL$ is in $\bL_G$. We reason as in the proof of Lemma~\ref{lem:image-theta-inverse}, except we cannot assume that $\cW$ satisfies (W3). In the proof of Lemma~\ref{lem:image-theta-inverse}, (W3) was used to justify Claim 1, and to justify that $\cL$ satisfies (L3). Let us now give an alternative proof of Claim 1, which does not use (W3). 

Suppose for the sake of contradiction, that an inner edge $e$ has its 4 incident corners labeled $i$. Since $G$ is $d$-adapted, it has no loop, hence $e$ has 2 distinct endpoints $u,v$. Note that $u$ and $v$ cannot both be outer vertices by Condition (L0). Hence, we can suppose that $v$ is an inner vertex without loss of generality. Consider the paths $P_1(v),\ldots,P_d(v)$ of colors $1,2,\ldots,d$ starting at $v$ as defined in Section~\ref{subsec:GS-woods}. Let $R_i(v)$ be the region delimited by the paths $P_{i-1}(v)$ and $P_i(v)$. Since the corners incident to $e$ have label $i$, the edge $e$ is in $R_i(v)$, hence $u$ is in $R_i(v)$. By Lemma~\ref{lem:vi-not-in-Ri} this implies that $u\neq v_i$. Since $u$ is incident to some corners labeled $i$, we conclude that $u$ is not an outer vertex. Hence, both $u$ and $v$ are inner vertices. Moreover, $u$ is in $R_i(v)$, and symmetrically $v$ is in $R_i(u)$.
By Corollary~\ref{cor:containment-regions}, the region $R_i(u)$ is strictly contained in $R_i(v)$, and $R_i(v)$ is strictly contained in $R_i(u)$. This is a contradiction, hence Claim 1 holds.

It remains to prove that $\cL$ satisfies (L3). Let $a$ be an inner arc of $G$. 
%We reason as in the proof of Lemma~\ref{lem:image-theta-inverse}, and since $\cW$ satisfies (W0), (W1) and (W2), we get that $\cL$ satisfy (L0), (L1), (L2). It remains to prove Condition (L3) for every arc $a$. We adopt the notation $i_1,i_2,i_3,i_4$, $f$, $\delta=|[i_2,i_3[|$ and $\eps=|[i_3,i_4[|$ from the proof of Lemma~\ref{lem:image-theta-inverse}. 
We need to show $\delta+\eps\geq d-\deg(f)+1$. If $i_1\neq i_2$ then Condition (W2') applied to color $i=i_2-1$ of $a$ gives $\delta\geq d-\deg(f)-\eps+1$ as wanted. We now consider the case $i_1=i_2$. Let $f'$ be the face at the left of $a$. Since $G$ is $d$-adapted, we must have $\deg(f)+\deg(f')-2\geq d$ (because $\deg(f)+\deg(f')-2$ is the length of a non-facial cycle of $G$: the contour of the face one would obtain by deleting $e$ and merging $f$ and $f'$). Moreover, $|[i_4:i_1[|\leq d-\deg(f')+1$ because the sum of label jumps around $f'$ is $d$ and each jump is at least 1.
Since the sum of label jumps in counterclockwise order around $a$ is $d$, one obtains
$$\delta+\eps=d-|[i_4:i_1[|\geq \deg(f')-1\geq d-\deg(f)+1.$$
Thus Condition (L3) holds and $\cL$ is in $\bL_G$.

Since the image of $\bTh'$ is in $\bL_G$, we can compose this map with $\Th$. For all $\cW\in \bW_G'$ one clearly has $\Th \circ \bTh'(\cW)=\cW$, hence $\cW$ is in the image of $\Th$, which is in $\bW_G$ by Lemma~\ref{lem:image-theta}. This concludes the proof that $\bW_G'= \bW_G$. 
\end{proof}


% \end{document}

