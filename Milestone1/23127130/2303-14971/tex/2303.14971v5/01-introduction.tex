State-of-the-art SAT and SMT solvers deal very efficiently with formulas expressed in Conjunctive Normal Form (CNF). In real-world scenarios, however, it is common for problems to be expressed as non-CNF formulas. Hence, these problems are converted into CNF before being processed by the solver.
This conversion is generally done by using variants of the~\citeA{tseitin68} or the~\citeA{plaisted1986structure} transformations, which generate a linear-size equisatisfiable CNF formula by labelling sub-formulas with fresh Boolean atoms.
These transformations can be employed also for SAT and SMT enumeration (AllSAT and AllSMT, respectively), by projecting the %\ignoreinlong{models}\ignoreinshort{
truth assignments
%} 
onto the original atoms only.

When passing from \emph{solving} to \emph{enumeration}, however, the capability of enumerating \emph{partial} satisfying assignments that are as small as possible is crucial, because each prevents from enumerating a number of total assignments that is exponential w.r.t.\ the number of unassigned atoms.
This raises the question of whether CNF encodings conceived for solving are also effective for enumeration.
%A study on the impact of the CNF encoding on feature model analysis has been done by Kuiter et al.~\cite{kuiter_tseitin_2022}. 
To the best of our knowledge, however, no research has yet been published to analyse how the different CNF encodings may affect the effectiveness of the solvers for AllSAT and AllSMT.

In this paper, we investigate, both theoretically and empirically, the effectiveness of CNF conversion for %\ignoreinshort{
SAT and SMT %} 
enumeration, %
%\ignoreinshort{
both in the disjoint and non-disjoint cases. %}. 
%\ignoreinlong{We focus on AllSAT, restricting to disjoint enumeration. We expect analogous results for AllSMT.}\@ 
The contribution of this paper is twofold.

First, on the negative side, we show that the commonly-employed CNF transformations for solving are not suitable for enumeration.\@ In particular, we notice that the Tseitin encoding introduces top-level label definitions for sub-formulas with double implications, which need to be satisfied as well, and thus prevent the solver from producing short partial assignments.
We also notice that the Plaisted and Greenbaum transformation solves this problem only in part by labelling sub-formulas only with single implications if they occur with single polarity, but it has similar issues to the Tseitin transformation when sub-formulas occur with both polarities.

Second, on the positive side, we prove theoretically and we show empirically
that converting the formula into Negation Normal Form (NNF) before applying the Plaisted and Greenbaum transformation can fix the problem and drastically improve the effectiveness of the enumeration process by up to orders of magnitude.

This analysis is confirmed by an experimental evaluation of non-CNF problems originating from both synthetic and real-world-inspired applications.
%We preprocess each formula using different CNF transformations, and measure the number of partial assignments and the execution times for each transformation. 
The results confirm the theoretical analysis, showing that the %\ignoreinshort{
proposed %}
combination of NNF with the Plaisted and Greenbaum CNF allows for a
%\ignoreinlong{significant}
%\ignoreinshort{
drastic %} 
reduction in both the number of partial assignments and the execution time.

% \begin{ignoreinshortenv}
\paragraph*{Disclaimer.}
A preliminary and much shorter version of this paper was presented at SAT 2023~\cite{masinaCNFConversionDisjoint2023}.
In this paper, we present the following novel contributions:
\begin{itemize}
  \item we formalize the main claim of the paper and formally prove it (\Cref{th:existsetaB} in \sref{sec:solution});
  \item we extend the analysis to non-disjoint AllSAT and to disjoint and non-disjoint AllSMT;
  \item we extend the empirical evaluation to a much broader set of benchmarks, including also non-disjoint AllSAT and disjoint and non-disjoint AllSMT, which confirm the theoretical results.
        Moreover, we extend the timeout of each job-pair from 1200s to 3600s,
        providing thus a more informative comparison;
  \item we present a much more detailed related work section.
\end{itemize}
% \end{ignoreinshortenv}

% \begin{ignoreinlongenv}
%     \paragraph*{Related Work.} %%RS: ok va bene
%     %\begin{gmchange}
%     The impact of using different CNF encodings on the performance for SAT and SMT solving has been widely studied in the literature~\cite{boy_de_la_tour_optimality_1992,jacksonClauseFormConversions2005,bjork_successful_2009,kuiter_tseitin_2022}.

%     Beyond the basic task of SAT and SMT solving, several applications in probabilistic reasoning require quantifying the number of solutions of a SAT or SMT formula. Whereas for some applications it is sufficient to count the number of satisfying assignments, others require to enumerate all of them.
%     In particular, SAT and SMT disjoint enumeration play a foundational role in probabilistic reasoning frameworks such as \emph{\#SMT}~\cite{chistikovApproximateCountingSMT2017} and \emph{Weighted Model Integration}~\cite{morettin-wmi-ijcar17,morettin-wmi-aij19,spallitta_smt-based_2022}. %, in which for each model an integral has to be computed. 
%     Specifically, in the case of \#SMT(\larat) we need to sum up the volumes corresponding to each of the assignments, whereas in WMI we need to integrate some function $w$ over the convex polytopes defined by each of the assignments. Hence, in these cases, it is essential to enumerate disjoint partial \ignoreinlong{models}\ignoreinshort{\GMCHANGE{truth assignments}} that are as small and as few as possible.

%     The problem of model minimization for Tseitin-encoded problems was addressed by~\citeA{hutchison_minimizing_2013}. They first propose to simplify the formula by considering its original structure and the current model; then they use iterative calls to a SAT solver to obtain a minimal model by imposing increasingly tighter cardinality constraints. This approach can be used to find a single short model, but it can be very expensive and thus it is unsuitable for model enumeration.
% \end{ignoreinlongenv}


%    \end{gmchange}
\paragraph*{Content.}
The paper is organized as follows. In~\sref{sec:background} we introduce the theoretical background necessary to understand the rest of the paper. In~\sref{sec:problem} we analyse the problem of the classical CNF-izations when used for AllSAT
%\ignoreinshort{\ 
and AllSMT.\@
%}.
In~\sref{sec:solution} we propose one possible solution, whose effectiveness is evaluated on both synthetic and real-world inspired benchmarks in~\sref{sec:experiments}. %\ignoreinshort{
The related work is presented in~\sref{sec:related-work}. %} 
We conclude the paper in~\sref{sec:conclusions}, drawing some final remarks and indicating possible future work.
