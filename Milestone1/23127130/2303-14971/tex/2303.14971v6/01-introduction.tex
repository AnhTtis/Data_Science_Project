State-of-the-art SAT and SMT solvers deal very efficiently with formulas expressed in Conjunctive Normal Form (CNF). In real-world scenarios, however, it is common for problems to be expressed as non-CNF formulas. Hence, these problems are converted into CNF before being processed by the solver.
This conversion is generally done by using variants of the~\citeA{tseitinComplexityDerivationPropositional1983} or the~\citeA{plaistedStructurepreservingClauseForm1986} transformations, which generate a linear-size equisatisfiable CNF formula by labeling sub-formulas with fresh Boolean atoms.
These transformations can also be employed for SAT and SMT enumeration (AllSAT and AllSMT, respectively), by projecting the %\ignoreinlong{models}\ignoreinshort{
truth assignments
%} 
onto the original atoms only.

When passing from plain \emph{solving} to \emph{enumeration}, however, the capability of enumerating \emph{partial} satisfying assignments that are as small as possible is crucial, because each prevents from enumerating a number of total assignments that is exponential w.r.t.\ the number of unassigned atoms.
This raises the question of whether CNF encodings conceived for solving are also effective for enumeration.
%A study on the impact of the CNF encoding on feature model analysis has been done by Kuiter et al.~\cite{kuiterTseitinNotTseitin2022}. 
To the best of our knowledge, however, no research has yet been published to analyze how the different CNF encodings may affect the effectiveness of the solvers for AllSAT and AllSMT.

\paragraph*{Contributions.}
In this paper, we investigate, both theoretically and empirically, the effectiveness of different CNF transformations for %\ignoreinshort{
SAT and SMT %} 
enumeration, %
%\ignoreinshort{
both in the disjoint and non-disjoint cases. %}. 
%\ignoreinlong{We focus on AllSAT, restricting to disjoint enumeration. We expect analogous results for AllSMT.}\@ 
The contribution of this paper is twofold.

First, on the negative side, we show that the commonly-employed CNF transformations for solving are not suitable for enumeration.\@ In particular, we notice that the Tseitin transformation introduces top-level label definitions for sub-formulas with double implications, which need to be satisfied as well, and thus prevent the solver from producing short partial assignments.
We also notice that the Plaisted and Greenbaum transformation solves this problem only in part by labeling sub-formulas only with one-way implications if they occur with single polarity, but it has similar issues to the Tseitin transformation when sub-formulas occur with both polarities.

Second, on the positive side, we prove theoretically and we show empirically
that converting the formula into Negation Normal Form (NNF) before applying the Plaisted and Greenbaum transformation can fix the problem and drastically improve the effectiveness of the enumeration process by up to orders of magnitude.

This analysis is confirmed by an experimental evaluation of non-CNF problems originating from both synthetic and real-world-inspired applications.
%We preprocess each formula using different CNF transformations, and measure the number of partial assignments and the execution times for each transformation. 
The results confirm the theoretical analysis, showing that the %\ignoreinshort{
proposed %}
combination of NNF with the Plaisted and Greenbaum CNF allows for a
%\ignoreinlong{significant}
%\ignoreinshort{
drastic %} 
reduction in both the number of partial assignments and the execution time.

% \begin{ignoreinshortenv}

% \GSTODO{Chiamerei "Contributions" il paragrafo successivo? Okay che partiamo con il lavoor precedente, ma cos√≠ sembra che tutto sia nel lavoro precedente.}
% \GMNOTE{L'ho cambiato su richiesta di un reviewer, possiamo tenere ``Contributions'' se preferite}

\paragraph*{Previous works.}
A preliminary %and much shorter 
version of this paper was presented at SAT 2023~\cite{masinaCNFConversionDisjoint2023}.
In this paper, we present the following novel contributions:
\begin{itemize}
  \item we formalize the main claim of the paper and formally prove it (\Cref{th:existsetaB} in \sref{sec:solution});
  \item we extend the analysis to non-disjoint AllSAT and disjoint and non-disjoint AllSMT;
  \item we extend the empirical evaluation to a much broader set of benchmarks, including also non-disjoint AllSAT and disjoint and non-disjoint AllSMT, which confirm the theoretical results.
    We extend the evaluation by using also the novel AllSAT and
    AllSMT enumerators \tabularallsat{} and \tabularallsmt{},
    obtaining similar results as with \mathsat{}.
        Moreover, we extend the timeout of each job-pair from 1200s to 3600s,
        providing thus a more informative comparison;
  \item we present a much more detailed related work section.
\end{itemize}

\paragraph*{Organization.}
The paper is organized as follows. In~\sref{sec:background} we introduce the theoretical background necessary to understand the rest of the paper. In~\sref{sec:problem} we analyze the problem of the classical CNF transformations when used for AllSAT
%\ignoreinshort{\ 
and AllSMT.\@
%}.
In~\sref{sec:solution} we propose one possible solution, whose effectiveness is evaluated on both synthetic and real-world inspired benchmarks in~\sref{sec:experiments}. %\ignoreinshort{
The related work is presented in~\sref{sec:related-work}. %} 
We conclude the paper in~\sref{sec:conclusions}, drawing some final remarks and indicating possible future work.
