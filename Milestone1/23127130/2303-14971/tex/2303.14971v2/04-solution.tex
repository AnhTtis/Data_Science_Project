In this section, we propose a possible solution to address the shortcomings of \TseitinCNF{} and \PlaistedCNF{} CNF-izations in model enumeration, described in~\sref{sec:problem}. We show that a simple preprocessing can avoid this situation. We transform the input formula into NNF, using a DAG representation to avoid the exponential blow-up due to ``$\iff$''s, and then use \PlaistedCNF{} on the resulting NNF formula.\@ In fact, NNF guarantees that each sub-formula occurs only positively, as every sub-formula $\vi_i$ occurring with double polarity is converted into two syntactically different sub-formulas $\poslab{\vi_i}\defas\NNF{\vi_i}$ and $\neglab{\vi_i}\defas\NNF{\neg\vi_i}$ ---each occurring only positively--- which are then labelled ---with single implications--- with two distinct atoms $\poslab{B_i}$ and $\neglab{B_i}$ respectively. We first illustrate the benefit of this additional preprocessing with the following example.

\begin{example}%
    \label{ex3}
    Consider the formula $\vi$ of~\cref{ex1}. By converting it into NNF, we obtain:
    \begin{equation}
        \vinnf\defas
        \overbrace{(A_1\wedge A_2)}^{B_1}\vee
        \underbrace{(
            \overbrace{(
                \underbrace{(
                    \overbrace{(\neg A_3\wedge\neg A_4)}^{\neglab{B_2}}\vee
                    \overbrace{(\neg A_5\wedge\neg A_6)}^{\neglab{B_3}}
                )}_{\neglab{B_4}}\vee A_7
            )}^{B_5} \wedge
            \overbrace{(
                \underbrace{(
                    \overbrace{(     A_3\vee       A_4)}^{\poslab{B_2}}\wedge
                    \overbrace{(     A_5\vee       A_6)}^{\poslab{B_3}}
                )}_{\poslab{B_4}}\vee\neg A_7
            )}^{B_6}
        )}_{B_{7}}
    \end{equation}
    % We remark that, by definition, each sub-formula of $\vinnf$ occurs only with positive polarity. For instance, consider the sub-formula $(A_3\vee A_4)$ that occurs in $\vi$ with double polarity. In $\vinnf$, the positive occurrence remains the same, while the negative occurrence is converted into $(\neg A_3\wedge\neg A_4)$. This implies that the two occurrences correspond to two different sub-formula, each occurring only positively, and thus they will be labelled with two different atoms.
    Suppose, then, that the formula is converted into CNF using \PlaistedCNF{}. Then, the following CNF formula is obtained:
    \begin{subequations}%
        \label{eq:ex3:vicnf}
    \begin{alignat}{2}
        \vinnfcnfpg\defas
        &(\neg B_1\vee\pos A_1)\wedge(\neg B_1\vee\pos A_2)&\wedge
        &\quad\eqcomment{(B_1\imp (\pos A_1\wedge\pos A_2))}\label{eq:ex3:vicnf:line1}\\
        &(\neg \neglab{B_2}\vee\neg A_3)\wedge(\neg \neglab{B_2}\vee\neg A_4)&\wedge&\quad\eqcomment{(\neglab{B_2}\imp (\neg A_3\wedge\neg A_4))}\label{eq:ex3:vicnf:line2}\\
        &(\neg \neglab{B_3}\vee\neg A_5)\wedge(\neg \neglab{B_3}\vee\neg A_6)&\wedge&\quad\eqcomment{(\neglab{B_3}\imp (\neg A_5\wedge\neg A_6))}\label{eq:ex3:vicnf:line3}\\
        &(\neg \neglab{B_4}\vee\pos \neglab{B_2}\vee\pos \neglab{B_3})&\wedge&\quad\eqcomment{(\neglab{B_4}\imp (\pos \neglab{B_2}\vee\pos \neglab{B_3}))}\label{eq:ex3:vicnf:line4}\\
        &(\neg B_5\vee\pos \neglab{B_4}\vee\pos A_7)&\wedge&\quad\eqcomment{(B_5\imp (\pos \neglab{B_4}\vee\pos A_7))}\label{eq:ex3:vicnf:line5}\\
        &(\neg \poslab{B_2}\vee\pos A_3\vee\pos A_4)&\wedge&\quad\eqcomment{(\poslab{B_2}\imp (\pos A_3\vee\pos A_4))}\label{eq:ex3:vicnf:line6}\\
        &(\neg \poslab{B_3}\vee\pos A_5\vee\pos A_6)&\wedge&\quad\eqcomment{(\poslab{B_3}\imp (\pos A_5\vee\pos A_6))}\label{eq:ex3:vicnf:line7}\\
        &(\neg \poslab{B_4}\vee\pos \poslab{B_2})\wedge(\neg \poslab{B_4}\vee\pos \poslab{B_3})&\wedge&\quad\eqcomment{(\poslab{B_4}\imp (\pos \poslab{B_2}\wedge\pos \poslab{B_3}))}\label{eq:ex3:vicnf:line8}\\
        &(\neg B_6\vee\pos \poslab{B_4}\vee\neg A_7)&\wedge&\quad\eqcomment{(B_6\imp (\pos \poslab{B_4}\vee\neg A_7))}\label{eq:ex3:vicnf:line9}\\
        &(\neg B_{7}\vee\pos B_5)\wedge(\neg B_{7}\vee\pos B_6)&\wedge&\quad\eqcomment{(B_{7}\imp (\pos B_5\wedge\pos B_6))}\label{eq:ex3:vicnf:line10}\\
        &(\pos B_1\vee\pos B_{7})&&\label{eq:ex3:vicnf:line11}
    \end{alignat}
    \end{subequations}
    Suppose, e.g., that the solver picks non-deterministic choices, deciding the atoms in the order 
    $\set{B_1,A_1,A_2,\neglab{B_3},A_5,A_6,\neglab{B_2},A_3,A_4,\neglab{B_4},B_5,A_7,\poslab{B_2},\poslab{B_3},\poslab{B_4},B_6,B_{7}}$,
    branching with a negative value first.
    Then, the first total truth assignment found is:
    \begin{equation}
        \label{ex3:eta}
        \eta\defas\set{
            \underbrace{\neg B_1, \neglab{B_2},\neg \neglab{B_3},\neglab{B_4},B_5,\neg \poslab{B_2},\neg \poslab{B_3},\neg \poslab{B_4},B_6,B_{7}}_{\etaB},
            \underbrace{\neg A_1,\neg A_2,\neg A_3,\neg A_4,\neg A_5,\neg A_6,\neg A_7}_{\etaA}}.
    \end{equation}

    In this case, the minimization procedure returns $\muA\defas\set{\neg A_3,\neg A_4, \neg A_7}$ as in~\eqref{eq:ex1:muAprime}, achieving full minimization. With this additional preprocessing, in fact, the solver is no longer forced to assign a truth value to $A_5$ or $A_6$.
    This is possible because, even though $(A_5\vee A_6)$ occurs with double polarity in $\vi$, in $\NNF{\vi}$ its positive and negative occurrences are converted into $(A_5\vee A_6)$ and $(\neg A_5\wedge\neg A_6)$ respectively. Since they appear as two syntactically-different sub-formulas, \PlaistedCNF{} labels them ---with single implications--- using two different atoms $\poslab{B_3}$ and $\neglab{B_3}$ respectively. This allows the solver to find a model $\eta$ that assigns both $\neglab{B_3}$ and $\poslab{B_3}$ to false. Hence, the clauses in \eqref{eq:ex3:vicnf:line3} and~\eqref{eq:ex3:vicnf:line7} are satisfied even without assigning $A_5$ and $A_6$, and thus these atoms can be dropped by the minimization procedure.
    \exdone{}
\end{example}

This example shows that the solver can enumerate shorter partial assignments if the formula is converted into NNF before applying \PlaistedCNF{}. The key idea behind this additional preprocessing is that each sub-formula of $\NNF{\vi}$ occurs only positively, so that \PlaistedCNF{} labels them with single implications, and the solver is no longer forced to assign them a truth value. 
Consider a sub-formula $\vi_i$ that occurs with double polarity in
$\vi$.
In $\NNF{\vi}$ the two subformulas
$\poslab{\vi_i}\defas\NNF{\vi_i}$ and
$\neglab{\vi_i}\defas\NNF{\neg\vi_i}$ occur only positively.
Then, 
instead of adding $(B_i\iff\vi_i)$, we add $(\poslab{B_i}\imp\poslab{\vi_i})\wedge(\neglab{B_i}\imp\neglab{\vi_i})$, and the solver can find a truth assignment $\eta$ that assigns both $\neglab{B_i}$ and $\poslab{B_i}$ to false. (In~\cref{ex3}, instead of $(B_3\iff(A_5\vee A_6))$ we add $(\poslab{B_3}\imp(A_5\vee A_6))$ and $(\neglab{B_3}\imp(\neg A_5\wedge\neg A_6))$.) Thus, the clauses deriving from $\vi_i$ can be satisfied even without assigning a truth value to $\vi_i$, whose atoms can be dropped by the minimization procedure ---provided that they are not forced to be assigned by some other sub-formula of $\vi$. (In the example, by setting $\etaB(\poslab{B_3})=\etaB(\poslab{B_3})=\bot$, the clauses in~\eqref{eq:ex3:vicnf:line3} and~\eqref{eq:ex3:vicnf:line7} are satisfied even without assigning $A_5$ and $A_6$.)
To improve the efficiency of the procedure, we also add the clause $(\neg \poslab{B_i}\vee\neg\neglab{B_i})$ in order to prevent the solver from assigning both $\poslab{B_i}$ and $\neglab{B_i}$ to true, and thus from exploring inconsistent search branches.

\begin{remark}%
    \label{rem:ex3:preconv}
    We notice that the pre-conversion into NNF is typically never used in plain SAT \emph{solving}, because it causes the unnecessary duplication of labels $\poslab{B_i}$ and $\neglab{B_i}$, with extra overhead and no benefit for the solver.
\end{remark}
