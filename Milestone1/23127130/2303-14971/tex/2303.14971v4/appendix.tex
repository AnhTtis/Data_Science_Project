%\begin{gmchange}
\begin{section}{Proof for~\cref{th:nnfdaglinear}}%
    \label{sec:proofnnfdaglinear}
    We present the proof for~\cref{th:nnfdaglinear} in~\cref{sec:background:propositional-logic}.
    \begin{proof}    
    The NNF DAG that represents \NNF{\vi} is a sub-graph of the 2-root DAG for the
    pair $\langle{\NNF{\vi}},\NNF{\neg\vi}\rangle$. \RSCHANGE{We prove
    that the latter grows linearly in size w.r.t. $\vi$ by reasoning
    inductively on the structure of \vi. (The size of a DAG ``...'' is denoted with ``|\dots|''.) }
    %i.e.\ ``|\dots|'' is \#nodes(\dots)+\#arcs(\dots).
%    We prove it by induction on the structure of \vi.
    \begin{description}
        \item[if $\vi$ is an atom:] then $\NNF{\vi}=\vi$ \RSCHANGE{and
          $\NNF{\neg\vi}=\neg\vi$, so that} $|\langle\NNF{\vi},\NNF{\neg\vi}\rangle|=2$.
      \item[if $\vi\defas\neg\vi_1$:] \RSCHANGE{we assume by induction that
        we have computed
        \tuple{\NNF{\vi_1},\NNF{\neg\vi_1}}. Then
        $\tuple{\NNF{\vi},\NNF{\neg\vi}}=\tuple{\NNF{\neg\vi_1},\NNF{\vi_1}}$
        (i.e., we just invert the
        order of the pair), so that
        $|\tuple{\NNF{\vi},\NNF{\neg\vi}}|=|\tuple{\NNF{\neg\vi_1},\NNF{\vi_1}}|=|\tuple{\NNF{\vi_1},\NNF{\neg\vi_1}}|$. }
        

        % $|\langle\NNF{\neg\vi_1},\NNF{\vi_1}\rangle|=|\langle\NNF{\vi_1},\NNF{\neg\vi_1}\rangle|$.
        \item[if $\vi\defas(\vi_1\bowtie\vi_2)$ s.t.\
          $\bowtie~\in\set{\wedge,\vee,\imp,\iff}$:]
          \RSCHANGE{we assume by induction
        we have computed
        \tuple{\NNF{\vi_1},\NNF{\neg\vi_1}} and
        \tuple{\NNF{\vi_2},\NNF{\neg\vi_2}}. Then we show that}
    \begin{equation}\label{eq:recursize}
        |\langle \NNF{\vi},\NNF{\neg\vi}\rangle| \leq
         18+|\langle \NNF{\vi_1},\NNF{\neg\vi_1}\rangle|+|\langle
         \NNF{\vi_2},\NNF{\neg\vi_2}\rangle|.
    \end{equation}
    Specifically:
    \begin{description}
        \item[if $\bowtie$ is $\wedge$:] 
        the DAGs for $\NNF{\vi}$ and $\NNF{\neg\vi}$ add 2 ``$\wedge/\vee$'' nodes and $2+2$ arcs:\\
            $
            \begin{aligned}
                \quad\NNF{\pos\phantom{(}\vi_1\wedge\vi_2\phantom{)}}\defas\NNF{\pos\vi_1}\wedge\NNF{\pos\vi_2};\\
                \quad\NNF{\neg(\vi_1\wedge\vi_2)}\defas\NNF{\neg\vi_1}\vee\NNF{\neg\vi_2}.            
            \end{aligned}
            $
            \\\RSCHANGE{Thus, $|\langle \NNF{\vi},\NNF{\neg\vi}\rangle| =
              6+|\langle \NNF{\vi_1},\NNF{\neg\vi_1}\rangle|+|\langle
         \NNF{\vi_2},\NNF{\neg\vi_2}\rangle|$.}
        \item[if $\bowtie$ is $\vee$:]
        the DAGs for $\NNF{\vi}$ and $\NNF{\neg\vi}$ add 2 ``$\wedge/\vee$'' nodes and $2+2$ arcs:\\
            $
            \begin{aligned}
                \quad\NNF{\pos\phantom{(}\vi_1\vee\vi_2\phantom{)}}\defas\NNF{\pos\vi_1}\vee\NNF{\pos\vi_2};\\
                \quad\NNF{\neg(\vi_1\vee\vi_2)}\defas\NNF{\neg\vi_1}\wedge\NNF{\neg\vi_2}.            
            \end{aligned}
            $
            \\\RSCHANGE{Thus, $|\langle \NNF{\vi},\NNF{\neg\vi}\rangle| =
              6+|\langle \NNF{\vi_1},\NNF{\neg\vi_1}\rangle|+|\langle
         \NNF{\vi_2},\NNF{\neg\vi_2}\rangle|$.}
        \item[if $\bowtie$ is $\imp$:]
        the DAGs for $\NNF{\vi}$ and $\NNF{\neg\vi}$ add 2 ``$\wedge/\vee$'' nodes and $2+2$ arcs:\\
            $
            \begin{aligned}
                \quad\NNF{\pos\phantom{(}\vi_1\imp\vi_2\phantom{)}}\defas\NNF{\neg\vi_1}\vee\NNF{\pos\vi_2};\\
                \quad\NNF{\neg(\vi_1\imp\vi_2)}\defas\NNF{\pos\vi_1}\wedge\NNF{\neg\vi_2}.            
            \end{aligned}
            $
            \\\RSCHANGE{Thus, $|\langle \NNF{\vi},\NNF{\neg\vi}\rangle| =
              6+|\langle \NNF{\vi_1},\NNF{\neg\vi_1}\rangle|+|\langle
         \NNF{\vi_2},\NNF{\neg\vi_2}\rangle|$.}
        \item[if $\bowtie$ is $\iff$:]
        the DAGs for $\NNF{\vi}$ and $\NNF{\neg\vi}$ share the sub-DAGs for
        $\NNF{\vi_1}$, $\NNF{\neg\vi_1}$, $\NNF{\vi_2}$, $\NNF{\neg\vi_2}$, adding
        3+3 ``$\wedge$''/``$\vee$'' nodes and $6+6$ arcs:\\
            $
            \begin{aligned}
                \quad\NNF{\pos\phantom{(}\vi_1\iff\vi_2\phantom{)}}\defas(\NNF{\neg\vi_1}\vee\NNF{\pos\vi_2})\wedge(\NNF{\pos\vi_1}\vee \NNF{\neg\vi_2});\\
                \quad\NNF{\neg(\vi_1\iff\vi_2)}\defas(\NNF{\pos\vi_1}\vee\NNF{\pos\vi_2})\wedge(\NNF{\neg\vi_1}\vee\NNF{\neg\vi_2}).            
            \end{aligned}
            $
            \\\RSCHANGE{Thus, $|\langle \NNF{\vi},\NNF{\neg\vi}\rangle| =
              18+|\langle \NNF{\vi_1},\NNF{\neg\vi_1}\rangle|+|\langle
         \NNF{\vi_2},\NNF{\neg\vi_2}\rangle|$.}
    \end{description}
    \end{description}
    \RSCHANGE{Therefore, overall, from \eqref{eq:recursize} we have
      that $|\langle \NNF{\vi},\NNF{\neg\vi}\rangle|$ is $O(|\vi|)$.}
    %18\cdot|\vi|$.}
%
    % RS; gia' detto nel main part del paper
    % Intuitively, we only need at most 2 nodes for each sub-formula $\vi_i$ of $\vi$,
    % representing $\NNF{\vi_i}$ and $\NNF{\neg\vi_i}$ for positive and negative
    % occurrences of $\vi_i$ respectively. These nodes are shared among up
    % to exponentially-many branches generated by expanding the nested iffs.
    \end{proof}
\end{section}
%\end{gmchange}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
%\begin{gmchange}
  \newcommand{\muof}[1]{\residual{#1}{\mu}}
\begin{section}{Proof for~\cref{th:muAnnf}}%
    \label{sec:proofmuAnnf}

    \begin{rschange}
\input{fig_threevalues}
    In the following the symbol ``\any'' denotes any formula which is not
in $\set{\top,\bot}$. Following \cite{sebastiani_are_2020}, we adopt a 3-value
semantics for residuals $\residual{\vi}{\mu}\in\set{\top,\bot,\any}$,
so that ``$\residual{\vi}{\mu}=\any$'' means
``$\residual{\vi}{\mu}\not\in\set{\top,\bot}$'' and
``$\residual{\vi_1}{\mu}=\residual{\vi_2}{\mu}$'' means that the two
residuals $\residual{\vi_1}{\mu}$ and $\residual{\vi_2}{\mu}$ are either both $\top$, or both $\bot$, or neither is in
\set{\top,\bot}. (Notice that, in the latter case,
$\residual{\vi_1}{\mu}=\residual{\vi_2}{\mu}$ even when
$\residual{\vi_1}{\mu}$ and $\residual{\vi_2}{\mu}$ are different
formulas.)
We extend this definition to tuples in an obvious way:
$\tuple{\residual{\vi_1}{\mu},\dots,\residual{\vi_n}{\mu}}=
\tuple{\residual{\psi_1}{\mu},\dots,\residual{\psi_n}{\mu}}$ iff
$\residual{\vi_i}{\mu}=\residual{\psi_i}{\mu}$ for each $i\in[1\dots n]$.
        
The 3-value semantics of the Boolean operators is
reported for convenience in
Figure~\ref{fig:threeval}.
As a straightforward consequence of the above semantics, we have that:
\begin{eqnarray*}
\residual{(\neg\vi)}{\mu}&=&\neg(\residual{\vi}{\mu})\ \  \mbox{(hereafter
  simply ``$\residual{\neg\vi}{\mu}$'')}\\
\residual{(\vi_1\bowtie\vi_2)}{\mu}&=&
  \residual{\vi_1}{\mu}\bowtie\residual{\vi_2}{\mu}\ \  \mbox{for $\bowtie\ \in \set{\wedge,\vee,\imp,\iff}$}.
\end{eqnarray*}
Also, the usual transformations apply:
$\muof{\neg(\vi_1\wedge\vi_2)}=\muof{\neg\vi_1}\vee\muof{\neg\vi_2}$,
$\muof{\neg(\vi_1\vee\vi_2)}=\muof{\neg\vi_1}\wedge\muof{\neg\vi_2}$,
$\muof{(\vi_1\iff\vi_2)}=
(\neg\muof{\vi_1}\vee\muof{\vi_2})\wedge(\muof{\vi_1}\vee\neg\muof{\vi_2})$
and
$\muof{\neg(\vi_1\iff\vi_2)}=
(\muof{\vi_1}\vee\muof{\vi_2})\wedge(\neg\muof{\vi_1}\vee\neg\muof{\vi_2})$.
%
For convenience, sometimes we denote as $\bar{v}$ the
complement of $v\in\set{\top,\bot,\any}$, i.e. $\bar{v}\defas\neg v$,
so that
$\bar{\top}=\bot, \bar{\bot}=\top,
        \bar{\any}=\any$. 

      We prove the following property, from which 
      \cref{th:muAnnf}
    in~\cref{sec:background:propositional-logic} follows directly. 

% \ignore{\begin{property}%
%     \label{th:muAnnf2}
%     Consider a Boolean formula $\vi(\allA)$, and let $\NNF{\vi}$ be its NNF DAG. 
%     Consider a partial assignment $\muA$ on $\allA$. Then
%     $\residual{\vi}{\muA}=v$ iff $\residual{\NNF{\vi}}{\muA}=v$ for $v\in\set{\top,\bot,\any}$.
% \end{property}}

\begin{property}
  Consider a Boolean formula $\vi(\allA)$, and let $\NNF{\vi}$ be its
  NNF DAG. Consider a partial assignment $\muA$ on $\allA$. 
  % Let $\langle\NNF{\vi},\NNF{\neg\vi}\rangle$ be the 2-root DAG as
  % in~\cref{sec:proofnnfdaglinear}.
  Then:
  \begin{equation}
    \label{eq:nnfeq}
            \pair{\residual{\vi}{\muA}}{\residual{\neg\vi}{\muA}}=\pair{\residual{\NNF{\vi}}{\muA}}{\residual{\NNF{\neg\vi}}{\muA}}.    
  \end{equation}
        
\end{property}
      \end{rschange}

\begin{proof}%
  % RS: spostato sopra
        % We first notice that $\residual{\vi}{\muA}=v$ iff
        % $\residual{\neg\vi}{\muA}=\bar{v}$, where $\bar{v}$ is the
        % complement of $v$, i.e.\ $\bar{\top}=\bot, \bar{\bot}=\top,
        % \bar{\any}=\any$.
  \begin{rschange}
        As in~\cref{sec:proofnnfdaglinear}, we prove this fact by reasoning on the 2-root DAG for the
        pair $\langle\NNF{\vi},\NNF{\neg\vi}\rangle$. Specifically, we
        prove \eqref{eq:nnfeq}
        by induction on the structure of $\vi$.    
  \end{rschange}


        %% RS: spostato a sopra
        % (With a little abuse of notation, we say that $\residual{\vi}{\muA}=\residual{\psi}{\muA}$ even in the case when $\residual{\vi}{\muA}$ and $\residual{\psi}{\muA}$ are different formulas s.t.\ $\residual{\vi}{\muA},\residual{\psi}{\muA}\notin\set{\top,\bot}$, meaning that they both fall in the case $\any$.)
        \begin{description}
            \item[if $\vi$ is an atom:] then $\NNF{\vi}=\vi$ and $\NNF{\neg\vi}=\neg\vi$, so that $\residual{\vi}{\muA}=\residual{\NNF{\vi}}{\muA}$ and $\residual{\neg\vi}{\muA}=\residual{\NNF{\neg\vi}}{\muA}$.
            %------------------- NOT -------------------
            \item[if $\vi\defas\neg\vi_1$:] we assume by induction
              that
              $\pair{\residual{\vi_1}{\muA}}{\residual{\neg\vi_1}{\muA}}=\pair{\residual{\NNF{\vi_1}}{\muA}}{\residual{\NNF{\neg\vi_1}}{\muA}}$.
              \RSCHANGE{Let $v$ be
                s.t. $\pair{\residual{\vi}{\muA}}{\residual{\neg\vi}{\muA}}=\pair{v}{\bar{v}}$. Then:}
            \[
            \begin{aligned}
                \pair{\residual{\neg\vi_1}{\muA}}{\residual{\vi_1}{\muA}}=\pair{v}{\bar{v}}& \Iff \\
                \pair{\residual{\vi_1}{\muA}}{\residual{\neg\vi_1}{\muA}}=\pair{\bar{v}}{v}& \Iffind \\
                \pair{\residual{\NNF{\vi_1}}{\muA}}{\residual{\NNF{\neg\vi_1}}{\muA}}=\pair{\bar{v}}{v}& \Iff \\
                \pair{\residual{\NNF{\neg\vi_1}}{\muA}}{\residual{\NNF{\vi_1}}{\muA}}=\pair{v}{\bar{v}}&
            \end{aligned}
            \]

            % then $\langle\residual{\neg\vi_1}{\muA},\residual{\vi_1}{\muA}\rangle=\langle v,\bar{v}\rangle$ iff $\langle\residual{\vi_1}{\muA},\residual{\neg\vi_1}{\muA}\rangle=\langle\bar{v},v\rangle$. By induction hypothesis, this holds iff $\langle\residual{\NNF{\vi_1}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA}\rangle=\langle\bar{v},v\rangle$, and so iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle v,\bar{v}\rangle$;%, hence $\residual{\NNF{\vi}}{\muA}=v$ and $\residual{\NNF{\neg\vi}}{\muA}=\bar{v}$. 
            \item[if $\vi\defas(\vi_1\bowtie\vi_2)$:] s.t.\ $\bowtie~\in\set{\wedge,\vee,\imp,\iff}$. We assume by induction that 
            \[
                \begin{aligned}
                    \pair{\residual{\vi_1}{\muA}}{\residual{\neg\vi_1}{\muA}}=\pair{\residual{\NNF{\vi_1}}{\muA}}{\residual{\NNF{\neg\vi_1}}{\muA}}, \\
                    \pair{\residual{\vi_2}{\muA}}{\residual{\neg\vi_2}{\muA}}=\pair{\residual{\NNF{\vi_2}}{\muA}}{\residual{\NNF{\neg\vi_2}}{\muA}}.
                \end{aligned}
            \]
            Then,
            \begin{description}
                %--------------- AND ------------------------
                \item[if $\bowtie$ is $\wedge$:]
                \[
                  \begin{aligned}[t]
                    \langle\residual{(\vi_1\wedge\vi_2)}{\muA},\residual{\neg(\vi_1\wedge\vi_2)}{\muA}\rangle=
                    %\langle\residual{\vi_1}{\muA}\wedge\residual{\vi_2}{\muA},\neg(\residual{\vi_1}{\muA}\wedge\residual{\vi_2}{\muA})\rangle=
                    \langle\residual{\vi_1}{\muA}\wedge\residual{\vi_2}{\muA},\residual{\neg\vi_1}{\muA}\vee\residual{\neg\vi_2}{\muA}\rangle&\eqind\\
                    \langle\residual{\NNF{\vi_1}}{\muA}\wedge\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\neg\vi_2}}{\muA}\rangle&=\\
                    \langle\residual{(\NNF{\vi_1}\wedge\NNF{\vi_2})}{\muA},\residual{(\NNF{\neg\vi_1}\vee\NNF{\neg\vi_2})}{\muA}\rangle&=\\
                    \langle\residual{\NNF{\vi_1\wedge\vi_2}}{\muA},\residual{\NNF{\neg(\vi_1\wedge\vi_2)}}{\muA}\rangle&
                \end{aligned}  
                \]
                %--------------- OR ------------------------
                \item[if $\bowtie$ is $\vee$:]
                \[
                    \begin{aligned}[t]
                        \langle\residual{(\vi_1\vee\vi_2)}{\muA},\residual{\neg(\vi_1\vee\vi_2)}{\muA}\rangle=
                        %\langle\residual{\vi_1}{\muA}\vee\residual{\vi_2}{\muA},\neg(\residual{\vi_1}{\muA}\vee\residual{\vi_2}{\muA})\rangle=
                        \langle\residual{\vi_1}{\muA}\vee\residual{\vi_2}{\muA},\residual{\neg\vi_1}{\muA}\wedge\residual{\neg\vi_2}{\muA}\rangle&\eqind\\
                        \langle\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA}\wedge\residual{\NNF{\neg\vi_2}}{\muA}\rangle&=\\
                        \langle\residual{(\NNF{\vi_1}\vee\NNF{\vi_2})}{\muA},\residual{(\NNF{\neg\vi_1}\wedge\NNF{\neg\vi_2})}{\muA}\rangle&=\\
                        \langle\residual{\NNF{\vi_1\vee\vi_2}}{\muA},\residual{\NNF{\neg(\vi_1\vee\vi_2)}}{\muA}\rangle&
                    \end{aligned}
                \]
                %--------------- IMPLIES ------------------------
                \item[if $\bowtie$ is $\imp$:]
                \[
                    \begin{aligned}[t]
                        \langle\residual{(\vi_1\imp\vi_2)}{\muA},\residual{\neg(\vi_1\imp\vi_2)}{\muA}\rangle=
                        %\langle\residual{\neg\vi_1}{\muA}\vee\residual{\vi_2}{\muA},\neg(\residual{\neg\vi_1}{\muA}\vee\residual{\vi_2}{\muA})\rangle=
                        \langle\residual{\neg\vi_1}{\muA}\vee\residual{\vi_2}{\muA},\residual{\vi_1}{\muA}\wedge\residual{\neg\vi_2}{\muA}\rangle&\eqind\\
                        \langle\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\vi_1}}{\muA}\wedge\residual{\NNF{\neg\vi_2}}{\muA}\rangle&=\\
                        \langle\residual{(\NNF{\neg\vi_1}\vee\NNF{\vi_2})}{\muA},\residual{(\NNF{\vi_1}\wedge\NNF{\neg\vi_2})}{\muA}\rangle&=\\
                        \langle\residual{\NNF{\vi_1\imp\vi_2}}{\muA},\residual{\NNF{\neg(\vi_1\imp\vi_2)}}{\muA}\rangle&
                    \end{aligned}
                \]
                %--------------- IFF ------------------------
                \item[if $\bowtie$ is $\iff$:]
                \[
                    \begin{aligned}
                        \langle\residual{(\vi_1\iff\vi_2)}{\muA},\residual{\neg(\vi_1\iff\vi_2)}{\muA}\rangle&=\\
                        \langle\residual{((\neg\vi_1\vee\vi_2)\wedge(\vi_1\vee\neg\vi_2))}{\muA},\residual{((\vi_1\vee\vi_2)\wedge(\vi_1\vee\vi_2))}{\muA}\rangle&=\\
                        % push the residual inside the conjunctions and disjunctions
                        \langle(\residual{\neg\vi_1}{\muA}\vee\residual{\vi_2}{\muA})\wedge(\residual{\vi_1}{\muA}\vee\residual{\neg\vi_2}{\muA}),(\residual{\vi_1}{\muA}\vee\residual{\vi_2}{\muA})\wedge(\residual{\vi_1}{\muA}\vee\residual{\vi_2}{\muA})\rangle&\eqind\\
                        % apply induction hypothesis by changing each psi into NNF(psi)
                        \langle(\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})\wedge(\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\neg\vi_2}}{\muA}),\\
                        (\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})\wedge(\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})\rangle&=\\
                        % extract only the residual (and not NNF) from the conjunctions and disjunctions
                        \langle\residual{((\NNF{\neg\vi_1}\vee\NNF{\vi_2})\wedge(\NNF{\vi_1}\vee\NNF{\neg\vi_2}))}{\muA},&\\\residual{((\NNF{\vi_1}\vee\NNF{\vi_2})\wedge(\NNF{\vi_1}\vee\NNF{\vi_2}))}{\muA}\rangle&=\\
                        % say that NNF(...) is NNF(\vi_1 \iff \vi_2)
                        \langle\residual{\NNF{\vi_1\iff\vi_2}}{\muA},\residual{\NNF{\neg(\vi_1\iff\vi_2)}}{\muA}\rangle&
                    \end{aligned}
                \]
                

                % %--------------- OR ------------------------
                % \item[if $\bowtie$ is $\vee$:] then $\residual{\NNF{\vi}}{\muA}=\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA}$ and 
                % $\residual{\NNF{\neg\vi}}{\muA}=\residual{\NNF{\neg\vi_1}}{\muA}\wedge\residual{\NNF{\neg\vi_2}}{\muA}$, so that:
                % \begin{alphaenumerate}
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\top,\bot\rangle$ iff $\residual{\vi_1}{\muA}=\top,\residual{\neg\vi_1}{\muA}=\bot$ or $\residual{\vi_2}{\muA}=\top,\residual{\neg\vi_2}{\muA}=\bot$. By induction hypothesis, this holds iff $\residual{\NNF{\vi_1}}{\muA}=\top,\residual{\NNF{\neg\vi_1}}{\muA}=\bot$ or $\residual{\NNF{\vi_2}}{\muA}=\top,\residual{\NNF{\neg\vi_2}}{\muA}=\bot$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\top,\bot\rangle$;
                    
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\bot,\top\rangle$ iff $\residual{\vi_1}{\muA}=\residual{\vi_2}{\muA}=\bot,\residual{\neg\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=\top$. By induction hypothesis, this holds iff $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\bot,\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=\top$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\bot,\top \rangle$;
                % \end{alphaenumerate}
                % %------------------- IMPL ----------------------
                % \item[if $\bowtie$ is $\imp$:] then $\residual{\NNF{\vi}}{\muA}=\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA}$ and 
                % $\residual{\NNF{\neg\vi}}{\muA}=\residual{\NNF{\vi_1}}{\muA}\wedge\residual{\NNF{\neg\vi_2}}{\muA}$, so that:
                % \begin{alphaenumerate}
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\top,\bot\rangle$ iff $\residual{\vi_1}{\muA}=\bot,\residual{\neg\vi_1}{\muA}=\top$ or $\residual{\vi_2}{\muA}=\top,\residual{\neg\vi_2}{\muA}=\bot$. By induction hypothesis, this holds iff $\residual{\NNF{\vi_1}}{\muA}=\bot,\residual{\NNF{\neg\vi_1}}{\muA}=\top$ or $\residual{\NNF{\vi_2}}{\muA}=\top,\residual{\NNF{\neg\vi_2}}{\muA}=\bot$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\top,\bot\rangle$;
                    
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\bot,\top\rangle$ iff $\residual{\neg\vi_1}{\muA}=\residual{\vi_2}{\muA}=\bot,\residual{\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=\top$. By induction hypothesis, this holds iff $\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\bot,\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=\top$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\bot,\top \rangle$;
                % \end{alphaenumerate}

                % %------------------- IFF ----------------------
                % \item[if $\bowtie$ is $\iff$:] then $\residual{\NNF{\vi}}{\muA}=(\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\neg\vi_2}}{\muA})\wedge(\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})$ and $\residual{\NNF{\neg\vi}}{\muA}=(\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})\wedge(\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\neg\vi_2}}{\muA})$, so that:    
                % \begin{alphaenumerate}
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\top,\bot\rangle$ iff $\residual{\vi_1}{\muA}=\residual{\vi_2}{\muA}=v,\residual{\neg\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=\bar{v}$. By induction hypothesis, this holds iff $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=v,\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=\bar{v}$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\top,\bot\rangle$;
                    
                %     \item $\langle\residual{\vi}{\muA},\residual{\neg\vi}{\muA}\rangle=\langle\bot,\top\rangle$ iff $\residual{\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=v,\residual{\neg\vi_1}{\muA}=\residual{\vi_2}{\muA}=\bar{v}$. By induction hypothesis, this holds iff $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=v,\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\bar{v}$, hence iff $\langle\residual{\NNF{\vi}}{\muA},\residual{\NNF{\neg\vi}}{\muA}\rangle=\langle\bot,\top\rangle$;
                % \end{alphaenumerate}

                % \item[if $\bowtie$ is $\vee$:] then $\residual{\NNF{\vi}}{\muA}=\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA}$, so that:
                % \begin{alphaenumerate}
                %     \item if $\residual{\vi}{\muA}=\top$ then $\residual{\vi_1}{\muA}=\top$ or $\residual{\vi_2}{\muA}=\top$. By induction hypothesis, $\residual{\NNF{\vi_1}}{\muA}=\top$ or $\residual{\NNF{\vi_2}}{\muA}=\top$, hence $\residual{\NNF{\vi}}{\muA}=\top$;
                    
                %     \item if $\residual{\vi}{\muA}=\bot$ then $\residual{\vi_1}{\muA}=\residual{\vi_2}{\muA}=\bot$. By induction hypothesis, $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\bot$, hence $\residual{\NNF{\vi}}{\muA}=\bot$;
                    
                %     \item if $\residual{\vi}{\muA}=\star$ then
                %     $\langle\residual{\vi_1}{\muA},\residual{\vi_2}{\muA}\rangle\in\set{\langle\bot,\star\rangle,\langle\star,\bot\rangle,\langle\star,\star\rangle}$. By induction hypothesis, $\langle\residual{\NNF{\vi_1}}{\muA},\residual{\NNF{\vi_2}}{\muA}\rangle\in\set{\langle\bot,\star\rangle,\langle\star,\bot\rangle,\langle\star,\star\rangle}$, hence $\residual{\NNF{\vi}}{\muA}=\star$;
                % \end{alphaenumerate}

                % \item[if $\bowtie$ is $\imp$:] then $\residual{\NNF{\vi}}{\muA}=\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA}$, so that:
                % \begin{alphaenumerate}
                %     \item if $\residual{\vi}{\muA}=\top$ then $\residual{\vi_1}{\muA}=\bot$ or $\residual{\vi_2}{\muA}=\top$. By induction hypothesis, $\residual{\NNF{\vi_1}}{\muA}=\bot$ or $\residual{\NNF{\vi_2}}{\muA}=\top$, hence $\residual{\NNF{\vi}}{\muA}=\top$;
                    
                %     \item if $\residual{\vi}{\muA}=\bot$ then $\residual{\vi_1}{\muA}=\top$ and $\residual{\vi_2}{\muA}=\bot$. By induction hypothesis, $\residual{\NNF{\vi_1}}{\muA}=\top$ and $\residual{\NNF{\vi_2}}{\muA}=\bot$, hence $\residual{\NNF{\vi}}{\muA}=\bot$;
                    
                %     \item if $\residual{\vi}{\muA}=\star$ then
                %     $\langle\residual{\neg\vi_1}{\muA},\residual{\vi_2}{\muA}\rangle\in\set{\langle\top,\star\rangle,\langle\star,\bot\rangle,\langle\star,\star\rangle}$. By induction hypothesis, $\langle\residual{\NNF{\neg\vi_1}}{\muA},\residual{\NNF{\vi_2}}{\muA}\rangle\in\set{\langle\top,\star\rangle,\langle\star,\bot\rangle,\langle\star,\star\rangle}$, hence $\residual{\NNF{\vi}}{\muA}=\star$;
                % \end{alphaenumerate}
                % \item[if $\bowtie$ is $\iff$:] then $\residual{\NNF{\vi}}{\muA}=(\residual{\NNF{\neg\vi_1}}{\muA}\vee\residual{\NNF{\vi_2}}{\muA})\wedge(\residual{\NNF{\vi_1}}{\muA}\vee\residual{\NNF{\neg\vi_2}}{\muA})$, so that:
                % \begin{alphaenumerate}
                %     % \item if $\residual{\vi}{\muA}=\top$ then either $\residual{\vi_1}{\muA}=\residual{\vi_2}{\muA}=\top$, $\residual{\neg\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=\bot$ or $\residual{\vi_1}{\muA}=\residual{\vi_2}{\muA}=\bot$,$\residual{\neg\vi_1}{\muA}=\residual{\neg\vi_2}{\muA}=\top$. By induction hypothesis, either $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\top$,$\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=\bot$ or $\residual{\NNF{\vi_1}}{\muA}=\residual{\NNF{\vi_2}}{\muA}=\bot$,$\residual{\NNF{\neg\vi_1}}{\muA}=\residual{\NNF{\neg\vi_2}}{\muA}=\top$, hence $\residual{\NNF{\vi}}{\muA}=\top$;
                %     \item if $\residual{\vi}{\muA}=\top$ then $\langle\residual{\vi_1}{\muA},\residual{\vi_2}{\muA},\residual{\neg\vi_1}{\muA},\residual{\neg\vi_2}{\muA}\rangle\in\set{\langle\top,\top,\bot,\bot\rangle,\langle\bot,\bot,\top,\top\rangle}$. By induction hypothesis, $\langle\residual{\NNF{\vi_1}}{\muA},\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA},\residual{\NNF{\neg\vi_2}}{\muA}\rangle\in\set{\langle\top,\top,\bot,\bot\rangle,\langle\bot,\bot,\top,\top\rangle}$, hence $\residual{\NNF{\vi}}{\muA}=\top$;
                    
                %     \item if $\residual{\vi}{\muA}=\bot$ then $\langle\residual{\vi_1}{\muA},\residual{\vi_2}{\muA},\residual{\neg\vi_1}{\muA},\residual{\neg\vi_2}{\muA}\rangle\in\set{\langle\top,\bot,\bot,\top\rangle,\langle\bot,\top,\top,\bot\rangle}$. By induction hypothesis, $\langle\residual{\NNF{\vi_1}}{\muA},\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA},\residual{\NNF{\neg\vi_2}}{\muA}\rangle\in\set{\langle\top,\bot,\bot,\top\rangle,\langle\bot,\top,\top,\bot\rangle}$, hence $\residual{\NNF{\vi}}{\muA}=\bot$;
                    
                %     \item if $\residual{\vi}{\muA}=\star$ then $\langle\residual{\vi_1}{\muA},\residual{\vi_2}{\muA},\residual{\neg\vi_1}{\muA},\residual{\neg\vi_2}{\muA}\rangle\in\{\langle\top,\star,\bot,\star\rangle$, $\langle\bot,\star,\top,\star\rangle$, $\langle\star,\top,\star,\bot\rangle$, $\langle\star,\bot,\star,\top\rangle$, $\langle\star,\star,\star,\star\rangle\}$. By induction hypothesis, \\$\langle\residual{\NNF{\vi_1}}{\muA},\residual{\NNF{\vi_2}}{\muA},\residual{\NNF{\neg\vi_1}}{\muA},\residual{\NNF{\neg\vi_2}}{\muA}\rangle\in\{\langle\top,\star,\bot,\star\rangle$, $\langle\bot,\star,\top,\star\rangle$, $\langle\star,\top,\star,\bot\rangle$, $\langle\star,\bot,\star,\top\rangle$, $\langle\star,\star,\star,\star\rangle\}$, hence $\residual{\NNF{\vi}}{\muA}=\star$;
                % \end{alphaenumerate}
            \end{description}
        \end{description}

.
    \end{proof}
        \RSCHANGE{Thus,
        $\pair{\residual{\vi}{\muA}}{\residual{\neg\vi}{\muA}}=\pair{\residual{\NNF{\vi}}{\muA}}{\residual{\NNF{\neg\vi}}{\muA}}$
        so that $\residual{\vi}{\muA}=v$ iff
        $\residual{\NNF{\vi}}{\muA}=v$ for every
        $v\in\set{\top,\bot}$, so that \cref{th:muAnnf}
    in~\cref{sec:background:propositional-logic} holds.}
        
      \end{section}
%\end{gmchange}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\begin{gmchange}
\begin{section}{Proof for~\cref{th:existsetaB}}%
    \label{sec:proofexistsetaB}
    We present the proof for~\cref{th:existsetaB} in~\cref{sec:solution}.
\begin{proof}%
    We first show how such a $\etaB$ can be built, then we prove that it satisfies \vinnfcnfpg.
    %In order to simplify the proof, we assume that all sub-formulas occur with double polarity in $\vi$.
    For every sub-formula $\vi_i$ of $\vi$, whose positive and negative occurrences in $\vinnfcnfpg$ are associated with the variables $\poslab{B_i}$ and $\neglab{B_i}$ respectively, do:
    \begin{alphaenumerate}
        \item if $\residual{\vi_i}{\muA} = \top$, and hence $\residual{\NNF{\vi_i}}{\muA}=\top$ and $\residual{\NNF{\neg\vi_i}}{\muA}=\bot$ by \cref{th:muAnnf}, then set $\etaB(\poslab{B_i})=\top$ and $\etaB(\neglab{B_i})=\bot$;
        \item if $\residual{\vi_i}{\muA} = \bot$, and hence $\residual{\NNF{\vi_i}}{\muA}=\bot$ and $\residual{\NNF{\neg\vi_i}}{\muA}=\top$ by \cref{th:muAnnf}, then set $\etaB(\poslab{B_i})=\bot$ and $\etaB(\neglab{B_i})=\top$;
        \item otherwise if $\residual{\vi_i}{\muA} \notin \set{\top,\bot}$, then let $\etaB(\poslab{B_i})=\etaB(\neglab{B_i})=\bot$;
    \end{alphaenumerate}
    (If $\vi_i$ occurs only positively or negatively, then we only assign $\poslab{B_i}$ or $\neglab{B_i}$ respectively.)\\
    We prove that $\muA\cup\etaB\models\vinnfcnfpg$ by induction on the structure of $\vinnfcnfpg$.
    Consider a sub-formula $\vi_i$ of $\vi$. Then
    \begin{romanenumerate}
        \item $\vinnfcnfpg\defas\PlaistedCNF(
            \overbrace{\NNF{\vi}[\NNF{\vi_i}|\poslab{B_i}]}^{(1)} \wedge 
            \overbrace{\left(\neg \poslab{B_i}\vee\NNF{\vi_i}\right)}^{(2)})$ if $\vi_i$ occurs positively in $\vi$;
        \item $\vinnfcnfpg\defas\PlaistedCNF(
            \overbrace{\NNF{\vi}[\NNF{\neg\vi_i}|\neglab{B_i}]}^{(3)} \wedge 
            \overbrace{\left(\neg \neglab{B_i}\vee\NNF{\neg\vi_i}\right)}^{(4)})$ if $\vi_i$ occurs negatively in $\vi$;
    \end{romanenumerate}
    % \begin{subequations}
    % \begin{align}
    %     \vinnfcnfpg\defas\PlaistedCNF\Big(
    %         \label{eq:proof:a}&\NNF{\vi}[\NNF{\vi_i},\NNF{\neg\vi_i}/\poslab{B_i},\neglab{B_i}]
    %      \wedge\\
    %      \label{eq:proof:b}& \left(\neg \poslab{B_i}\vee\NNF{\vi_i}\right) \wedge \\
    %      \label{eq:proof:c}& \left(\neg \neglab{B_i}\vee\NNF{\neg\vi_i}\right)\Big).
    % \end{align}
    % \end{subequations}
    For each pair of cases we have:
    \begin{alphaenumerate}
        \item\begin{romanenumerate}
            \item $\muA\cup\etaB\models
                (1)$ since we substitute $\top$ for $\top$; $\muA\cup\etaB\models
                (2)$ since $\muA\models\NNF{\vi_i}$; 
            \item $\muA\cup\etaB\models
                (3)$ since we substitute $\bot$ for $\bot$; $\muA\cup\etaB\models
                (4)$ since $\muA\models\neg\neglab{B_i}$; 
            \end{romanenumerate}
        \item \begin{romanenumerate}
            \item $\muA\cup\etaB\models
                (1)$ since we substitute $\bot$ for $\bot$; $\muA\cup\etaB\models
                (2)$ since $\muA\models\neg\poslab{B_i}$; 
            \item $\muA\cup\etaB\models
                (3)$ since we substitute $\top$ for $\top$; $\muA\cup\etaB\models
                (4)$ since $\muA\models\NNF{\neg\vi_i}$;  
            \end{romanenumerate}
        \item \begin{romanenumerate}
            \item $\muA\cup\etaB\models
                (1)$ since we substitute $\bot$ for $*$; $\muA\cup\etaB\models
                (2)$ since $\muA\models\neg\poslab{B_i}$; 
            \item $\muA\cup\etaB\models
                (3)$ since we substitute $\bot$ for $*$; $\muA\cup\etaB\models
                (4)$ since $\muA\models\neg\neglab{B_i}$;  
            \end{romanenumerate}
        %----------------------------------------
        % \item $\muA\cup\etaB\models%\eqref{eq:proof:a}
        % (1)$ because we substitute $\top$ for $\top$ and $\bot$ for $\bot$; $\muA\cup\etaB\models%\eqref{eq:proof:b}
        % (2)$ because $\muA\models\NNF{\vi_i}$; $\muA\cup\etaB\models%\eqref{eq:proof:c}
        % TODO$ because $\etaB\models\neg\neglab{B_i}$;
        % \item $\muA\cup\etaB\models%\eqref{eq:proof:a}
        % TODO$ because we substitute $\bot$ for $\bot$ and $\top$ for $\top$; $\muA\cup\etaB\models%\eqref{eq:proof:b}
        % TODO$ because $\etaB\models\neg\poslab{B_i}$; $\muA\cup\etaB\models%\eqref{eq:proof:c}
        % TODO$ because $\muA\models\NNF{\neg\vi_i}$;
        % \item $\muA\cup\etaB\models%\eqref{eq:proof:a}
        % TODO$ because $\muA$ satisfies $\vi$ even without assigning a truth value to $\vi_i$, so that we can safely substitute both $\NNF{\vi_i}$ and $\NNF{\neg\vi_i}$ with $\bot$; $\muA\cup\etaB\models%\eqref{eq:proof:b}
        % TODO$ because $\etaB\models\neg\poslab{B_i}$;
        % $\muA\cup\etaB\models%\eqref{eq:proof:c}
        % TODO$ because $\etaB\models\neg\neglab{B_i}$.
    \end{alphaenumerate}
    Therefore, $\muA\cup\etaB\models\vinnfcnfpg$.
\end{proof}
\end{section}
\end{gmchange}
