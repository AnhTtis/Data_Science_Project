\section{Positive Switched Systems}
\label{sec:switched}

This section will extend the approach of Section \ref{sec:stab} to switched linear systems.

\subsection{Problem Setting}

The ground-truth switched system will be composed of $N_s$ subsystems with parameters $(A_s, B_s)$ for $s\in1..N_s$. A right-continuous switching function $S: [0, \infty) \rightarrow 1..N_s$ (\ac{CTS}) or $S: \N \rightarrow 1..N_s$ (\ac{DTS}) is used to define a switched system trajectory. Given a switching sequence $S$, the switched system trajectory  $x(t)$ satisfies 
\begin{align}
\label{eq:switched_traj}
    \delta x(t) &= A_{S(t)} x(t) + B_{S(t)} u_{S(t)}(t) & \forall t \geq 0.
\end{align}

System \eqref{eq:sys} is an instance of  \eqref{eq:switched_traj} with only a single subsystem $(A, B)$. We will assume in this  paper that $S$ may switch between subsystems arbitrarily often, and is not subject to dwell-time constraints. The matrices $B_{s} \in \R^{n \times m_s}$ are allowed to have different number of inputs $m_s$.

Data from \eqref{eq:data} is collected with the addition of a known switching sequence $\bs$ to form $\dc = (\bx, \bu, \xd, \bs)$: 
\begin{align}
\label{eq:data_switch}
    \begin{array}{ccllll}
        \bx & := & [x(0) & x(1) &  \ldots & x(T-1) ]   \\
        \bu & := & [u(0) & u(1) & \ldots & u(T-1)] \\ 
        \xd & := & [\delta x(0) & \delta x(1) &  \ldots & \delta x(T-1) ] \\
        \bs & := & [S(0) & S(1) &  \ldots & S(T-1) ].
    \end{array}
\end{align}

Our goal is to find \acp{DLCLF} and controllers to stabilize all possible systems \eqref{eq:switched_traj} consistent with \eqref{eq:data_switch}. We will discuss scenarios where the switching sequence $S(t)$ is unknown or is known.
%, and can be controlled.
 
\subsection{Data-Consistency Polytope}

We will collect together columns of $(\bx, \bu, \xd)$ that have the same switching subsystem. As an example, $(\bx^s, \bu^s, \xd^s)$ are the matrices formed from data in $\dc$ where $S(t) = s$. For notational convenience, we will use the abbreviations $a_s = \vvec{A_s}$ and $b_s = \vvec{B_s}$ for $s=1..N_s$. Given an $L_\infty$ noise bound $\epsilon$ for the discrepancy \eqref{eq:discrepancy}, we express the set of all $\dc$-consistent switched systems as the intersection of subsystem polytopes from \eqref{eq:data_single}
\begin{subequations}
\label{eq:data_switched}
\begin{align}
G^{\text{data}}_s &= \begin{bmatrix}(\bx^s)^T \otimes I_n & (\bu^s)^T \otimes I_n \end{bmatrix}\\
    \Sigma^{\text{data}}_{\dc, s} &=  \left\{ (A, B) \mid G^{\textrm{data}}_s \begin{bmatrix} a_s \\ b_s\end{bmatrix} \leq   \begin{bmatrix}\epsilon\1_{nT} +\vvec{\xd^s} \\ \epsilon\1_{nT} -\vvec{\xd^s}\end{bmatrix} \right\} \\
    \Sigma^{\text{data}}_{\dc} &= \bigcap_{s=1}^{N_s}\Sigma^{\text{data}}_{\dc, s}.
\end{align}
\end{subequations}
    % \Sigma_\dc^{\text{data}} &= \left\{ (A, B) \mid G^{\textrm{data}}_1 \begin{bmatrix} a \\ b\end{bmatrix} \leq   \begin{bmatrix}\epsilon\1_{nT} +\vvec{\xd} \\ \epsilon\1_{nT} -\vvec{\xd}\end{bmatrix} \right\}.

\subsection{Stabilizing Polytope}

This section will list stabilization tasks and their nominal \ac{DLCLF}-based criteria for stabilization. Each task description will conclude with a presentation of their \ac{DDC} stabilization polytope. 
The specific \ac{LP} of the form of Theorem \eqref{eq:lp_stab} will be skipped; it is enough to note that 
Extended Farkas Lemma \ref{lem:ext_farkas} will be used to compute stabilizing controllers based on the data-consistent polytope \eqref{eq:data_switched}  and the respective stabilizing polytope.

\subsubsection{Common DLCLF, Common Controller}
\label{sec:common_controller}

This task will require the number of inputs are the same among all subsystems $\exists m : m_s = m \forall s\in1..N_s$, and that the controller is unaware of the current switching sequence $S(t)$. 

\begin{thm}
\label{thm:positive_stable_common}
The switched system \eqref{eq:switched_traj} is positive-stabilized by the switching-independent state-feedback controller $u=Kx$ if there exists \iac{DLCLF} with $v > 0$, a matrix $X = \diag{v}$, a tolerance $\eta>0$, and a matrix $Y \in \R^{m \times n}$ such that $\forall s=1..N_s:$
\begin{subequations}
\begin{align}
    -(A_s X + B_s Y) \1_n -\eta \1_n& \in \R_{\geq 0}^n  & & \text{(\ac{CTS})} \label{eq:stab_delta_common_c} \\
    v-(A_s X + B_s Y) \1_n -\eta \1_n& \in \R_{\geq 0}^n & & \text{(\ac{DTS})} \label{eq:stab_delta_common_d}.
\end{align}
\end{subequations}
The control gain $K$ is recovered by $K=Y X^{-1}$.
\end{thm}
\begin{proof}
Switched-stabilization for a common \ac{DLCLF} is documented in \cite[Proposition 3.4]{blanchini2015switched} without applied control. The control term $Y$ is used as an extension of \cite{rami2007controller} (summarized in Theorem \ref{thm:stab_control}). The convergence of this \ac{DLCLF} scheme is established in \cite{pastravanu2014max}.
\end{proof}

Letting $P_2 = \{(A, B) \mid G_2[a^T b^T]^T \leq h_2\}$ be the single-system stabilization polytope (according to the notation in Section \ref{sec:stab_program}) with a common $(v, X, Y)$, the switched system stabilizing polytope is,
\begin{align}
    P_2^{\text{sw1}} &= \bigcup_{s=1}^{N_s} \{(A_s, B_s) \mid G_2[a_s^T, \ b_s^T]^T \leq h_2\}.
\end{align}



\subsubsection{Common DLCLF, Different Controller}
\label{sec:different_controller}
This task will allow the controller to access the switching sequence $S(t)$. Each subsystem $s$ is equipped with its own controller $K_s \in \R^{n \times m_s}$, in which the number of inputs $m_s$ is allowed to be different between subsystems. 

\begin{thm}
\label{thm:diff_sys}
System \eqref{eq:switched_traj} is positive-stabilized by the switching-dependent state-feedback controller $u(t)=K_{S(t)} x(t)$ if there exists \iac{DLCLF} with $v > 0$, a matrix $X = \diag{v}$, a tolerance $\eta>0$, and matrices $Y_s \in \R^{m_s \times n}$ such that $\forall s=1..N_s:$
\begin{subequations}
\begin{align}
    -(A_s X + B_s Y_s) \1_n -\eta \1_n& \in \R_{\geq 0}^n  & & \text{(\ac{CTS})} \label{eq:stab_delta_switch_c} \\
    v-(A_s X + B_s Y_s) \1_n -\eta \1_n& \in \R_{\geq 0}^n & & \text{(\ac{DTS})} \label{eq:stab_delta_switch_d}.
\end{align}
\end{subequations}
The subsystem control gains are recovered by $K_s = Y_s X^{-1}$ for $s=1..N_s$.
\end{thm}
\begin{proof}
The \ac{DLCLF} $\max(x./v)$ is common among all subsystems. Allowing the controller $K_s$ to change between subsystems allows more freedom to attempt solution for a positive-stabilizing controller.
\end{proof}

Let $G_2(v, X, Y)$ be the stabilizing polytope from the \ac{CTS} \eqref{eq:poly_stab_c} or the \ac{DTS} \eqref{eq:poly_stab_d} as appropriate. The switching-aware positive-stabilizing polytope $P^{\text{sw2}}_2$ is
\begin{align}
    P_2^{\text{sw2}} &= \bigcup_{s=1}^{N_s} \{(A_s, B_s) \mid G_2(v, X, Y_s)[a_s^T, \; b_s^T]^T \leq h_2\}.
\end{align}

