\section{Peak-to-Peak Gain Regulation}
\label{sec:peaktopeak}
This section performs worst-case peak-to-peak (p2p) gain minimization using the Extended Farkas Lemma.

System \eqref{eq:sys} may be affected by an external noise process $\xi \in \R^e$ to form dynamics with a controlled output of $z \in \R^p$
\begin{subequations}
\label{eq:sys_xi}
\begin{align}
    \dx(t) &= A x (t) + B u(t) + E \xi(t) \\
    z(t) &= C x (t) + D u(t) + F \xi(t).
\end{align}
\end{subequations}
For a given set of parameters $(A, B, C, D, E, F)$ with $C \in \R^{p \times n}, \ D \in \R^{p \times m}, \ E \in \R^{n \times e}, \ F \in \R^{p \times e}$, this peak-to-peak gain may be computed by solving \iac{LP},
\begin{lem}[\cite{briat2013positive}]
\label{lem:p2p_clean}
There exists a state-feedback controller $u=Kx$ with $K, Y \in \scr$ and $v \in \R^n_{>0}$ such that peak-to-peak gain of \eqref{eq:sys_xi} is less than or equal to $\gamma \geq 0$ for continuous-time if
\begin{subequations}
\label{eq:p2p_c_clean}
\begin{align}
&-(A X + B Y)\1_n - E \1_e \in \R^{n}_{> 0} \label{eq:p2p_c_clean_dyn} \\
& \gamma \1_q - (C X + D Y)\1_n - F \1_e \in \R^{q}_{> 0} \\
& C X + D Y \in \R^{q \times n}_{\geq 0} \\
& AX + BY \ \textrm{is Metzler},
\end{align}
\end{subequations}
and for discrete-time if
\begin{subequations}
\label{eq:p2p_d_clean}
\begin{align}
&v -(A X + B Y)\1_n - E \1_e \in \R^{n}_{> 0} \label{eq:p2p_d_clean_dyn}\\
& \gamma \1_q - (C X + D Y)\1_n - F \1_e \in \R^{q}_{> 0} \\
& C X + D Y \in \R^{q \times n}_{\geq 0} \\
& AX + BY \in \R^{n \times n}_{\geq 0},
\end{align}
\end{subequations}
whereby the state-feedback gain can be recovered by $K = Y X^{-1}$.
\end{lem}

% \begin{rmk}
% The constraint $CX + DY \R^{q \times n}_{\geq 0}$ can impose sign-patterns on $K$. When $C, D$ are nonnegative matrices such that $C'D = 0$, it follows that all elements of $Y$ appearing in the expression $DY$ must also be nonnegative.
% \end{rmk}

% It is desired to find a control matrix $K \in \scr$ such that the peak-to-peak ($L_\infty \rightarrow L_\infty$) gain from $\xi \rightarrow z$ is minimized. 


We aim to solve the following problem:
\begin{prob}
\label{prob:p2p}
Find a state-feedback controller $u=Kx$ with $K \in \scr$ to minimize the worst-case peak-to-peak gain $\xi \rightarrow z$ for any data-consistent plant $(A, B) \in  \Sigma_\dc$.
\end{prob}
\begin{rmk}
The $\epsilon$-corrupted data in $\dc$ is obtained when $\xi(t)=0$ at all time samples. It is further assumed that the matrices $(C, D, E, F)$ are all fixed and are known in advance.
\end{rmk}

Peak-to-peak polytopes for $(A, B)$ in \eqref{eq:p2p_c_clean} and \eqref{eq:p2p_d_clean} may be construct in a similar manner to the stabilizing polytopes $P_2$ in Section \ref{sec:stab_poly}. The right hand sides of these polytopes for \acp{CTS} and \acp{DTS} are,
\begin{align}
\label{eq:h_answer_p2p}
    h_2^{\textrm{p2p}:\, C} &=  \begin{bmatrix} -\eta \1_n - E \1_e\\ \0_{n(n-1)} \end{bmatrix} & h_2^{\textrm{p2p}:\, D} &=  \begin{bmatrix} v-\eta \1_n - E \1_e\\ \0_{n^2} \end{bmatrix}.
\end{align}

\begin{thm}
\label{thm:p2p}
Problem \ref{prob:p2p} has a solution iff the following \ac{LP} in variables $(v, Y, Z, \gamma)$ is feasible,
\begin{subequations}
\label{eq:p2p}
\begin{align}
    \gamma^* =&\min_{\gamma \in \R}  \qquad \gamma \label{eq:p2p_obj}\\
    & Z G_1 = G_2(v, Y), \qquad Z h_1 \leq h_2^{\textrm{p2p}}(v, Y) \label{eq:p2p_farkas}\\
   & (\gamma-\eta) \1_q - (C X + D Y)\1_n - F \1_e \in \R^{q}_{\geq 0} \\
& C X + D Y \in \R^{q \times n}_{\geq 0} \\
    & v-\eta \1_n \in \R_{\geq 0}^n, \ Y \in \scr, \ Z \in \R_{\geq 0} ^{q \times 2 n T}, \label{eq:lp_p2p_var}
\end{align}
whereby the p2p-minimizing state feedback gain $K \in \scr$ can be recovered by $K=Y X^{-1}$.
\end{subequations}
\end{thm}
\begin{proof}
The outer (peak-to-peak) polytope is $P_2^{\textrm{p2p}} = \{(A, B) \mid  G_2 [a^T \ b^T]^T \leq h_2^{\textrm{p2p}}\}$ for the appropriate continuous-time or discrete-time vector in  \eqref{eq:h_answer_p2p}, as constructed from conditions \eqref{eq:p2p_c_clean_dyn} or \eqref{eq:p2p_d_clean_dyn}. The Extended Farkas Lemma \ref{lem:ext_farkas} is then applied in \eqref{eq:p2p_farkas} to ensure that $\gamma$ is an upper bound for the peak-to-peak gain of all consistent systems. The objective in \eqref{eq:p2p_obj} reduces this gain as much as possible. The minimum is achieved because all constraints in \eqref{eq:p2p} are strict (due to the given tolerance $\eta > 0$).
\end{proof}


% For a given $\gamma \in \R, \ Y \in \scr, \ v \in \R_{>0}$ with $X = \diag{v}$ such that $C X + DY$ is nonnegative, the polytope $P_2^C$ of continuous-time plants with a peak-to-peak gain less than $\gamma$ (by \eqref{eq:p2p_c_clean}) is,
% \begin{subequations}
% \label{eq:poly_p2p_c}
% \begin{align}
%     P^{C}_2 &= \left\{(A, B) \mid G^C_2 \begin{bmatrix} a \\ b \end{bmatrix} \leq \begin{bmatrix} -\eta \1_n - E \1_e\\ \0_{n(n-1)} \end{bmatrix}\right\}.
% \end{align}
% \end{subequations}
 

% \urg{Section VI of \cite{rantzer2018tutorial} cites \cite{briat2013positive}, which offers an \ac{LP} to perform $L_\infty \rightarrow L_\infty$ norm minimization given an external disturbance process. This derivation is restricted to Continuous-time, we can replicate this and note that a discrete-time \ac{LP} is (probably) similar.}