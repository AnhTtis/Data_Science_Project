\begin{algorithm}[h]
\caption{Training with \Method{}.}\label{alg:method}
\algnewcommand{\IfThen}[2]{% \IfThenElse{<if>}{<then>}
    \State{\algorithmicif\ {#1}\ \algorithmicthen\ {#2}}
    \algorithmicend\ \algorithmicif}
\newcommand{\algcmt}{\algorithmiccomment}
\begin{algorithmic}[1]
\Function{\MethodVerb{}}{%
    \( \ueset, B, f_\btheta, N, W, \alpha, K, \augdist \)~\!}
\For{\( n \in \bracks{1, \ldots, N} \)}
\IfThen{\( n \geq W \)}{\( K \gets 1 \)}
\algcmt{Disable adversarial augmentations after warmup.}
\For{\( (\bx, \by) \sim \mathrm{minibatch}(\ueset, B) \)}
\algcmt{Mini-batch sampling.}
\For{\( i \in \bracks{1, \ldots, B} \)}
\algcmt{For each image in mini-batch\ldots}
\For{\( j \in \bracks{1, \ldots, K} \)}
\algcmt{\ldots repeat \( K \) augmentations.}
    \State{\( \mathrm{aug} \sim \augdist \)}
    \algcmt{Sample augmentation policy\ldots}
    \State{\(
        \mathbf{L}_{ij} \gets \loss\parens{
            f_\btheta \parens{\mathrm{aug}(\bx_i)}, \by_i
        }
    \)}
    \algcmt{\ldots evaluate the loss function for the augmented image.}
\EndFor{}
\State{\(
    \mathbf{L}^\mathrm{adv}_{i}
    \gets \max_{j \in \bracks{1, \ldots, K}} \mathbf{L}_{ij}
\)}
\algcmt{Find the augmented image with maximum loss.}
\EndFor{}
\State{\(
    \btheta \gets \btheta -
        \alpha \nabla_{\btheta}
        \frac1B \sum_{i \in \bracks{1, \ldots, B}}
            \mathbf{L}^\mathrm{adv}_i
\)}
\algcmt{Gradient decent on the mini-batch of max-loss images.}
\EndFor{}
\EndFor{}
\State{\Return \(\btheta\)}
\EndFunction
\end{algorithmic}
\end{algorithm}
