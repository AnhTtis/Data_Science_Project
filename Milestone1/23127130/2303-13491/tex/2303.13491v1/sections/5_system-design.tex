\section{System Design}\label{sec:design}

To help users implement the approach mentioned in \autoref{sec:approach}, we developed an interactive prototyping system, \textit{FraudAuditor}. This section presents a system overview and introduces the details of the visual design and interactions.

\subsection{System Overview}

The system contains four views, as shown in \autoref{fig:teaser}: the network analysis view, the group comparison view, the patient comparison view, and the patient behavior view. We describe an analysis flow to demonstrate how these four views help the user discover, analyze, and validate suspicious groups of collusive fraud based on health insurance data. The user first learns the data distribution from the bar chart of patient attributes in the network analysis view (\textbf{R1}), based on which he can interactively filter the data of interest (\textbf{R2}). Then he sets parameters on co-visit behavior and generates the co-visit network between patients in the patient co-visit network view (\textbf{R3}). The results of the automatic detection model are also displayed in the network in real-time by highlighting. The attribute distribution, similarity, and ranking of detected groups can be viewed in the group comparison view (\textbf{R5}). He clicks on the top-ranked group, and its position in the network is highlighted simultaneously. In the patient comparison view, he compares different patients in the group using the disease and drug similarity matrix, stacked bar chart, and area chart (\textbf{R6}). From there, he selects several suspicious patients and goes to the patient behavior view for further investigation. He visually analyzes the visit pattern and co-visit distribution of patients from the visit sequence visualization. Combined with the visualization of contextual information such as diseases and drugs, he infers and labels these patients as engaging in collusive fraud (\textbf{R7}).

\begin{figure*}[ht!]
    \centering % avoid the use of \begin{center}...\end{center} and use \centering instead (more compact)
    \includegraphics[width=\linewidth]{figures/teaser.pdf}
    \caption{\textit{FraudAuditor} facilitates the identification, examination, and annotation of collusive fraud in health insurance. (a) The network analysis view supports interactive filtering of patient attributes and constructing a co-visit network. (b) The group comparison view provides interactive filtering, similarity analysis, and ranking of groups. (c) The patient comparison view helps users analyze the similarity and distribution of diseases, drugs, and other attributes among patients within a group and helps select suspicious patients to be analyzed. (d) The patient behavior view supports the inspection and annotation of detailed patient visit records and the analysis of co-visit behaviors.}
    \label{fig:teaser}
\end{figure*}

\subsection{Network Analysis View}

The network analysis view (\autoref{fig:teaser}-a) has two parts: (1) The patient attributes view gives an overview of patients by showing attribute distributions and supports interactive filtering of data of interest (\textbf{R1, R2}). (2) The patient co-visit network lets users interactively define co-visit behaviors, browse the resulting co-visit network, and visually inspect suspicious groups detected by automated algorithms (\textbf{R3}).

In the patient attributes view (\autoref{fig:teaser}-a1), bars indicate the distribution of patient attributes, including the distribution of patients in terms of the number of visits, age, and total fee, as well as the number of visits to different medical institutions. At first, all patients are selected, and users can click on a bar to deselect/re-select the corresponding patients. Patients that are not selected are represented by a translucent background, and a mouse hovering over the corresponding bar will bring up a tooltip showing the total number of patients belonging to the original and current patients in the interval, making it easy for users to compare the distribution of patients under different filtering conditions.

In the patient co-visit network (\autoref{fig:teaser}-a2), the control panel above allows users to interactively configure the definition of co-visit behavior. A slider controls the minimum number of co-visits, and a drop-down menu sets the maximum time gap, such as 1 hour, 6 hours, etc.
% The maximum time gap for a co-visit can be adjusted via a drop-down menu, including 1 hour, 6 hours, etc., and the minimum number of co-visits can be controlled via a slider. 
Users can browse the co-visit network by clicking "Generate Graph" and iteratively changing the co-visit definition or filtering conditions in the patient attributes view if the results are unsatisfactory.
% Clicking on the "Generate Graph" button allows users to browse the currently defined co-visit network and if the results are unsatisfactory, users can iteratively modify the definition or select different filtering conditions in the patient attributes view.
Suspicious groups detected by the automated algorithm are displayed in the network simultaneously and marked in purple, where small groups can be filtered by adjusting the minimum component size slider. \rc{The node-link diagram was applied to visualize the graph. Because node-link diagram performs well in showing direct and indirect relationships among patients, which can support tasks on connection analysis and topology exploration.} Each node in the network represents a patient, and the edge between two nodes reflects their co-visit relationship, whose width represents the strength of the co-visit relationship (see \autoref{sec:sgm}). The network supports zooming and panning for navigation. Patients are highlighted, and patient ID and group ID (if any) are displayed when the mouse hovers over a node. If the node belongs to a group, all nodes in that group are highlighted. 
To help users understand the analysis provenance, selected, suspicious, normal, and other nodes are mapped to different visual encodings.
% Nodes with different statuses, e.g., selected, suspicious group, marked as normal, etc., are mapped to different visual encodings to facilitate users' understanding of the analysis provenance.

\subsection{Group Comparison View}

The group comparison view (\autoref{fig:teaser}-b) consists of three parts: (1) The group attributes view provides an overview of group-level attributes as well as interactive filtering capabilities. (2) The group projection supports similarity analysis of groups (3) The group rank allows sorting groups across multiple dimensions. Through initial filtering and careful selection, users can identify suspicious groups that need to be focused on for analysis (\textbf{R5}).

The group attributes view (\autoref{fig:teaser}-b1) uses bar charts to show the distribution of groups on various metrics, including the number of patients (p), the total fee per capita (f), the number of co-visits (c), the average number of days between multiple co-visits (d), and the minimum time gap within a co-visit (g), which are common metrics used by health insurance audit experts to evaluate how suspicious a group is. The view also supports interactive filtering to help narrow down the groups to be analyzed.

The group projection (\autoref{fig:teaser}-b2) maps groups to a two-dimensional plane, helping users to compare similarities and differences between groups and to detect clusters or outliers that are worthy of analysis. Using the group-level features mentioned above, the original groups are represented as a set of feature vectors. \rc{To compare the distribution of groups over different features, we used kernel PCA~\cite{scholkopf1998nonlinear} because it maintains the covariance of the data and is able to handle linearly indistinguishable cases.}
%To allow users to perceive the distribution of groups in a multidimensional space, the Kernel PCA~\cite{scholkopf1998nonlinear} is employed because it can handle linearly indistinguishable cases by using kernel functions compared to the traditional PCA~\cite{wold1987principal}. 
In the projection result, each triangle represents a group, and the distance between them reflects their similarity to some extent. Depending on the group status, e.g., filtered-out or user-selected, different visual encoding is applied to the group. The group that needs further investigation can be selected by clicking on it.

The group rank view (\autoref{fig:teaser}-b3) provides a drop-down menu for selecting the ranking keyword, where single group metrics or overall scores can be used.
We created a customized radar chart to visually compare groups across multiple criteria.
% To help users compare groups, we designed a customized radar chart to visually represent the group characteristics across multiple metrics. 
In \autoref{fig:radar}-a, each axis represents the metric mentioned above. Five gray lines run through each axis from inside to outside, statistically representing the lower fence, first, second, third quartile, and upper fence~\footnote{\url{https://en.wikipedia.org/wiki/Quartile}} of each group on each metric. For comparison, data transformations (e.g., adding negative signs) make all metrics more anomalous as they grow. A gray area indicates each metric's average value for reference.
% The average value on each metric is enclosed in a gray area as a reference.
The blue area shows the current group, whose size visually reflects the group's degree of suspicion.
A special arrow alerts users to outliers above the upper fence.
% For outliers beyond the upper fence, a special arrow is designed to draw the user's attention.
Hovering over this glyph displays details of the group and each metric. 
% When this glyph is hovered, the details of the group and each metric are displayed.
Users can click to select the corresponding group for subsequent analysis.


\begin{figure}[tb]
    \centering % avoid the use of \begin{center}...\end{center} and use \centering instead (more compact)
    % width=0.5\textwidth
    \includegraphics[width=\columnwidth]{figures/glyph-v3.pdf}
    \caption{Explanation of visual design. (a) Customized radar chart. Five axes represent different group metrics. The darker gray area represents the average of all groups on these metrics, and the blue area represents the current group. If the value on one axis exceeds $Q3 + 1.5\mathrm{IQR}$, it is marked with an arrow as an outlier. (b)The co-visit link of note metaphor, and the width represents the number of co-visits.}
    % \caption{Customized radar chart and the co-visit diagram of note metaphor.}
    \label{fig:radar}
\end{figure}

\subsection{Patient Comparison View}

The patient comparison view (\autoref{fig:teaser}-c) has two types of visualizations: (1) A similarity matrix of diseases and drugs that supports comparisons between patients and helps users determine whether diseases and drugs correspond to each other. (2) Stacked bar charts and area charts of the patient attribute to help analyze the contribution of different patients to the group. Through similarity and attribute comparison, users can identify suspicious patients (\textbf{R6}).

\rc{To further select suspicious patients and exclude innocent ones, users need to study the similarity of disease and drugs within a group. We show the similarity between each pair of patients in a matrix} (\autoref{fig:teaser}-c1). Cells are divided into two categories, with the upper left corner representing drug similarity and the lower right corner representing disease similarity. Both the horizontal and vertical axes of the matrix are the patients within the selected group and have the same order. Each cell is color-coded in green with the degree of similarity between the corresponding patients; the darker, the more similar. When the mouse hovers over a cell, the specific values of diseases and drug similarity and the corresponding patient IDs are displayed, and the diagonally symmetrical cell is also highlighted for comparison. To discover patterns of patient clustering on diseases and drugs, the system supports matrix reordering, where hierarchical clustering methods are used to determine new patient orders. The patient can be selected for a more detailed analysis by clicking on labels. \rc{Since there are usually at most a dozen fraudsters in a group, the matrix is less prone to visual clutter.}

\rc{If suspicious patients are found (e.g., with similar diseases but large differences in drugs), users need contextual information to further assess the rationality of drug purchase behavior.} In the stacked bar chart and stacked area chart (\autoref{fig:teaser}-c2), users can study contextual information about diseases, drugs, medical institutes visited, total fees, etc., in order to verify suspicious patients. The data corresponding to patients selected by users is highlighted, while the data for unselected patients becomes translucent to provide a clear picture of the proportion of these patients in the overall group on different attributes. When the mouse hovers over a bar or area, information about each selected patient and the entire group in that attribute interval is displayed in a tooltip.


% The \textit{Patient Comparison View} enables users to compare drug and disease similarities among the patients of the selected groups and select patients of interest to explore the detailed attributes (\textbf{R5}), such as medical costs, and their treatment history in the \textit{Patient Behavior View}.
% \textit{FraudAuditor} visualizes drug and disease similarities between patients of selected groups in a matrix-based view, as the matrix view is scalable to show various numbers of patients. Individual patients are represented by rows and columns in the same order from left to right and from bottom to top. The upper-left part of the table cells depicts the drug similarity whereas the bottom-right part describes disease similarities between two patients. The darker the table cell is, the more similar the disease or drug between the two patients.
% Additionally, the left and bottom sides of the matrix summarize the counts of drugs and diseases in bar charts where the x-axis lists the top 5 diseases or drugs in descending order of their number and the y-axis shows the corresponding quantities.
% The right side view summarizes the medical institutions and medical costs of selected groups in bar charts and time-varying costs in an area chart. The bar charts and the area chart also act as stacked charts where the detailed attributes of user-selected patients are shown as a new layer over the original bars or areas as stacked bars or areas.

% \textit{Interactions.} User interactions support patient-level comparison and patient selection for detailed explorations. Users can sort the patients in the matrix based on their drug and disease similarities to facilitate pattern discovery using the drop-down menu at the top. Mousing over a cell displays the pair of patient IDs and their drug and disease similarity values. Clicking on the patient labels, users select the patients to explore the detailed data in the \textit{Patient Behavior View}. Hovering over the labels of selected patients in the matrix view highlights the corresponding stacked bars and areas in the right charts. Hovering over the charts shows the attribute and its total value along with the values of selected patients.

\subsection{Patient Behavior View}

The patient behavior view (\autoref{fig:teaser}-d) contains: (1) a line chart of the number of visits over time for locating anomalies and navigation; and (2) a visualization of the patients' visit sequence that shows the evolution of patients' visits and highlights co-visits. Users can analyze visit behavior at the different temporal granularity and combine rich contextual information and domain knowledge to reason and verify whether it is collusive fraud (\textbf{R7}).

The line chart (\autoref{fig:teaser}-d1) at the bottom reflects the temporal change in the number of visits to support users in locating time periods with significant fluctuations and detecting periodic visits, etc. The gray boxes represent selected time periods and allow for range swiping and panning.

In the visit sequence visualization (\autoref{fig:teaser}-d2), each timeline corresponds to one patient's visit history during the selected time period. Different time periods lead to different view granularities, such as a month, week, day, etc., which helps improve readability and reduce the cognitive load. The bars on the timeline represent the patient's visit behavior, where the position encodes the visit time, the color represents the disease type, and the height refers to the number of visits for the corresponding disease. This allows users to quickly grasp information about the patient's main diseases, frequency of visits, etc. Since there are many possible disease types, to avoid visual clutter, we give different colors to the top 5 diseases, while the rest are represented in gray. Users can view specific information about diseases through the legend on the right side. The number of patients in the visible area can be adjusted using the plus or minus buttons on the right, and clicking the full-screen button displays all selected patients in the current window.

To represent the co-visit behavior between patients, we designed a co-visit link to explicitly show this suspicious behavior. As shown in \autoref{fig:radar}-b, if there is co-visit behavior between two patients, we extend a line at the corresponding position of each of the two patients' timelines and link them to each other with a vertical line. In addition, since the current timeline may contain aggregated visit events, the width of the vertical line is used to encode the number of co-visits. We did not use arcs to connect co-visit behaviors because they tend to cause more crossings and visual clutter.

To support an in-depth analysis of co-visit behavior, users can select the threshold in the co-visit time gap drop-down box to switch to the co-visit view (see \autoref{fig:case1}-e) and examine all co-visit behaviors within the selected time period.
% where all co-visit behaviors during the selected time period are revealed. 
When the mouse hovers above the bar, further contextual information about this co-visit appears, including each patient's visit time, medical institution, list of drugs, etc. Users can check a patient's age, gender, disease, and drug costs by clicking on the patient ID.
% Clicking on the patient ID allows users to check their age, gender, and cost information for the corresponding diseases and drugs. 
This supporting information helps users reason and verify if they are committing collusive fraud. If the review is complete, users can click the pencil button in the upper right corner to annotate these patients with a reason on the pop-up labeling page.


% The patient behavior view enables users to analyze individual patient's treatment history in a timeline (\textbf{R6}). Each row represents the treatment timeline of a selected patient. A bar in the timeline represents the number of visits for a specific disease during a certain time frame. We color-encoded the bars of the top 5 diseases and show the rest of the diseases in gray. Through exploring the timeline of a patient, users can see the main diseases the patient has suffered from and the patterns of his/her medical visits.
% If co-visits exist in a certain time frame, the corresponding patients will be connected with a vertical line; the thickness of the line encodes the number of co-visits. The line chart at the bottom summarizes the total number of visits of selected patients during the entire time frame.

% \textit{Interactions.} Interactions allow users to compare and analyze patientsâ€™ treatment histories in various time frames (\textbf{R6}). The line chart at the bottom provides the navigation control enabling users to select a certain time frame of interest. Specifically, users can pan and change the width of the gray area on the line chart to explore the detailed patient behaviors of a selected time frame in the upper timelines. As the aggregation granularity of the timeline changes, such as the granularity of one day, one month, or one year, the bars and vertical lines expand and merge accordingly to show the data in a specific period.
% The right side lists other controllers which allow users to zoom in and out the patient timelines vertically to compare multiple patients or analyze a single patient or revert back to the original state using the refresh button. The legend of the top 5 diseases on the right side enables users to turn on/off the color-encodings of the diseases to focus on one or multiple diseases in the timelines.

% Users can click on the pencil icon on the top right corner to make annotations. The annotation view lists the selected groups and their patients. Users can choose to take notes for a whole group or individual patients, such as annotating about group fraud or regular prescription change of traditional Chinese medicines. Marked patients will be updated in the patient co-visit network and group projection view.

\textbf{Alternative design.} Before we finalized the bar chart for the patient visit record, we had three alternative designs: the pie chart, the treemap, and Nightingale's rose chart. In \autoref{fig:alter}, the number of visits is denoted by height, angle, area, and radius, respectively. Although the latter three representations are more compact, the visual elements representing each disease have different angles, making comparisons difficult. Also, for the pie chart and Nightingale's rose chart, the radius and area are squared, which can easily mislead users. The bar chart, on the other hand, has a fixed orientation, which is suitable for disease comparison.


% The horizontal axis represents time, and the color represents disease. Each block reflects the top 5 diseases and the number of visits under a certain aggregation granularity of time. 
% The number of visits is 
% For treemap, the area of each rectangle is proportional to the percentage of visits for the corresponding disease in the total number of visits. 
% For the pie chart, the size of the circle represents the proportion of the disease in the whole. For the rose chart, the length of the fan radius represents the number of visits. 
% However, with treemap, pie chart and Nightingale's rose, each disease has a different perspective and it is difficult to compare the number of visits between different diseases. On the other hand, for pie chart and Nightingale's rose, the relationship between radius and area is square, which is easy for users to misunderstand, while for bar charts, the orientation of the columns is the same, so it is easy to compare the same and different diseases.

\begin{figure}[tb]
    \centering % avoid the use of \begin{center}...\end{center} and use \centering instead (more compact)
    % width=0.5\textwidth
    \includegraphics[width=0.9\columnwidth]{figures/alternative-design.pdf}
    \caption{Alternative design of patient medical visit behavior. The number of visits is indicated by (a) the height of the bar, (b) the angle of the sector, (c) the area of the rectangle, and (d) the radius of the sector.}
    \label{fig:alter}
\end{figure}