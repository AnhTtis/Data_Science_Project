%%%%%%%%%%%%%%%%
\section{Simulation Results}
%%%%%%%%%%%%%%%%
\label{sec: simulation result}

In this section, we present the simulation setup and the key results.
We establish a 3D coordinate system with its origin at the center of \acrshort{rhs}, its x-axis along the perpendicular direction of \acrshort{rhs}, and its z-axis pointing vertically upward.
The \acrshort{roi} is a cuboid region centering at $(10,0,0)$~m and has dimensions $(10,10,2)$~m.
The distribution of users' positions, i.e. $\gls{userDistribu}$, is a 3D uniform distribution within the \acrshort{roi}.
The gains of each \acrshort{me} and user's antenna are $g_i^{\elem}=g_{i}^{\user}=1$, while it is worth noticing that the proposed system and algorithm can adapt to \acrshort{me}s with other patterns of gain.

Moreover, the \acrshort{rhs} board in the simulation is made of FR-4, which is a typical dielectric material used for printed circuit boards and has $n_{\mathrm{r}}=2.1$.
The \gls{numBand} bands of the system are centered at $(2+0.5i)$~GHz with a  $500$~MHz interval, and the average wavelength of the center frequencies is denoted by $\lambda_{\mathrm{avr}}$.
The interval between adjacent \acrshort{me}s is set to be $0.3\lambda_{\mathrm{avr}}$.
Besides, based on~\cite{Barriac2006Space}, $P_{\mathrm{pap}}(\bm \theta)$ in~(\ref{equ: V i}) is modeled as a Laplacian function with zero mean and angular spread $10^{\circ}$ in both azimuth and elevation, scaled by the average LoS power within the \acrshort{roi}.
The other parameters are listed in Table~\ref{table: parameter}.

\input{./table_1.tex}

\emph{Firstly}, we show the effectiveness of the proposed algorithm in terms of \acrshort{crlb} minimization and the computational efficiency.
We compare it with two benchmark algorithms: 
\begin{itemize}[leftmargin=*]
\item \textbf{Direct Gradient Descent}: Problem (P1) is solved by using gradient descent directly without alternating variables. Gradients are calculated based on the Propositions~\ref{prop: grad of crlb with c} and~\ref{prop: grad of crlb with s}. For a fair comparison, the total number of update steps is set to $2\times \gls{numMaxIteration} \times \gls{numUpdate}$, and the interior point approach with \acrshort{cg} method is also adopted. 
\item \textbf{Genetic Algorithm}: The genetic algorithm is employed as in~\cite{Nguyen2020Reconfigurable}, which minimizes the \acrshort{crlb} by optimizing \gls{sigSet} and \gls{codeSet} jointly. The standard Matlab implementation is adopted with the maximum number of generations set to $10$.
\end{itemize}


\begin{figure}[!t]
\centerline{ \includegraphics[width=1\linewidth]{./formal_figures/fig_1_res.pdf} }
\vspace{-0.5em}
\caption{Average optimization results of (a) CRLB and (b) computational time of the proposed and benchmark algorithms. \gls{numSamples} is set to $10$ ensure fast output, and $30$ independent trails are performed to reduce the impact of sampling randomness. The length of the ``I''-shaped bars in (a) represents the standard deviations of the results.}
\label{fig: simul res 1}
\end{figure}

Figs.~\ref{fig: simul res 1} (a) and (b) show the comparison results of the resulting \acrshort{crlb} and the normalized computational time for the proposed and benchmark algorithms, respectively.
It can be observed that the proposed algorithm results in lower \acrshort{crlb} values and takes less computational time compared with the benchmark algorithms.
Fig.~\ref{fig: simul res 1} (a) also shows that the resulting \acrshort{crlb} of the proposed algorithm decreases with \gls{numBand} given fixed $\gls{numBand}\gls{numFrame}$, which proves the effectiveness of using \acrshort{mb} technique.
Moreover, the \acrshort{crlb} gap between the proposed algorithm and the benchmarks increases with \gls{numBand}.
This implies that the advantage of the proposed algorithm becomes more pronounced as \gls{numBand} increases. 


\emph{Secondly}, we show the effectiveness of the optimized \acrshort{and} beamforming in terms of its resulting positioning precision and its benefit for the communication capacity.
We compare the optimized \acrshort{and} beamforming with two benchmark beamforming used in~\cite{Zohair2021Near}:
\begin{itemize}[leftmargin=*]
\item \textbf{Directional}: The \acrshort{and} beamforming is designed to generate focused beams scanning the \acrshort{roi} during the frames in the positioning phase.
\item \textbf{Random}: Elements of \gls{codeSet} follow a uniform distribution in range $[0,1]$, and elements of \gls{sigSet} take uniform values that satisfy the power constraint.
\end{itemize}


Figs.~\ref{fig: simul res 2} (a) and (b) show the violin plot and the box plot comparing the performance of different beamformings in terms of the \acrshort{mse} of positioning and the communication capacity loss due to positioning errors, respectively of $256$ nodes.
Specifically, in Fig.~\ref{fig: simul res 2}~(a), the \acrshort{mse} of positioning is evaluated by the training result of a neural network with a single hidden-layer.
The neural networks in different cases are trained by datasets each containing $10^5$ pairs of simulated received signals and position labels obtained by the system with different beamforming.
During the training, the division between training, validation, and test data follows ratio $7\!:\!1.5\!:\!1.5$.
It can be observed in Fig.~\ref{fig: simul res 2}~(a) that, on average, by using the optimized \acrshort{and} beamforming, the system reduces \acrshort{mse} of positioning by $42\%$ and $69\%$, compared to the Directional and Random beamforming benchmarks.


Besides, in Fig.~\ref{fig: simul res 2}~(b), the communication capacity loss is evaluated by the difference between the capacity of band $1$ when the \acrshort{bs} steers its beam towards user's true position and that when the beam is steered towards the estimated position.
It can be observed that the optimized \acrshort{and} beamforming results in $82\%$ and $86\%$ reduction in median levels of capacity loss, compared with Directional and Random benchmarks, respectively.
Moreover, the interquartile range, i.e., the range between 25\% and 75\% levels, of the capacity loss is also significantly reduced by the proposed algorithm, which are $50\%$ and $64\%$ lower than those of the benchmarks.

\begin{figure}[!t]
\centerline{ \includegraphics[width=1\linewidth]{./formal_figures/fig_2_res.pdf} }
\vspace{-0.1em}
\caption{(a) \gls{mse} of positioning and (b) communication capacity loss due to positioning error given different \acrshort{and} beamforming. In (a), $50$ independent training are conducted for the neural network. Each dot represents the result of a single trial, the filled regions indicate the overall distribution of the results, and ``x'' represents the mean value. In (b), the best training result of each case is used, and $1000$ random positions are sampled. The translucent background figures indicate the patterns of the capacity loss of individual samples. The red boxplots show the distribution of the results, with the bottom, middle, and top lines indicating the $25$th, $50$th, and $75$th percentiles, respectively.}
\label{fig: simul res 2}
\vspace{-0.5em}
\end{figure}



\endinput