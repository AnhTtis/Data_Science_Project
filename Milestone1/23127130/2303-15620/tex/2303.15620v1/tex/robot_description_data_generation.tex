\section{Robot Description and Data Generation}\label{sec:robot_description_data_generation}
In this section, we describe the robot model that is used for this study and how the data are generated and prepared.

\subsection{Robot Description}
We assume a four-link planar robot based on Wandercraft's exoskeleton Atalante \cite{ref:wandercraft, ref:omar} . The four links are joined by three actuated revolute joints, called the ankle, knee, and hip. Figure \ref{fig:fourlinkrobot} depicts the chosen robot.  

\begin{figure}[!h]
    \centering
    \includegraphics[width=0.23\textwidth]{img/fall_detection/robot_description/planar_four_link_final.png}
    \captionsetup{font=scriptsize}
    \caption{Four-link robot model used in our study.
    }
    \label{fig:fourlinkrobot}
\end{figure}

\subsection{Equations of Motion and  Simulation Environment}
The equations of motion are given by \ref{eq:floating_base_fall} and \ref{eq:accelConstEq} 
\begin{align}
    \label{eq:floating_base_fall}
    D(q)\ddot{q}+C(q,\dot{q})\dot{q}+G(q)&= Bu+J^T(q)\Gamma \\
    \label{eq:accelConstEq}
    J(q)\ddot{q} + \dot{J}(q,\dot{q})\dot{q}&=0,
\end{align}
where $q$ is the vector of generalized coordinates, $u$ is the torque input vector, $D$, $C$, $G$, and $B$ are the inertia, Coriolis, gravity, and torque distribution matrices/vector, respectively, $J$ is the Jacobian mapping the contact wrenches to the generalized coordinates, and $\Gamma$ is the contact wrench. The floating-base Lagragian model is given by \eqref{eq:floating_base_fall} while the contact/acceleration constraint is given by \eqref{eq:accelConstEq} \cite{ref:Jessy,ref:mlsTxtBook,ref:lynch2017modern}. The generalized coordinates are taken as
\begin{equation*}
    \begin{bmatrix}
     \text{\rm foot~x}  \\
    \text{\rm foot~z} \\
    \text{\rm foot~angle ($\theta _f$)} \\
    \text{\rm ankle~angle  ($\theta _a$)} \\
    \text{\rm knee~angle  ($\theta _k$)} \\
    \text{\rm hip~angle  ($\theta _h$)} 
    \end{bmatrix}.
\end{equation*}



A PD controller to maintain the robot in a standing position was designed and implemented in MATLAB \cite{ref:MATLAB}. The PD controller seeks to keep the foot flat on the ground while maintaining the CoM inside the support polygon.  The simulation environment uses MATLAB's ODE45 function and compliant ground contact forces represented as a spring-damper. 

\subsection{Data Generation } 
Four hundred trajectories each are generated for abrupt and incipient faults, with a sampling time of 0.03s and a disturbing force applied to the torso. To emulate disturbances that might cause the robot to oscillate slightly while standing, a random impulse force in the range of 0-159N and lasting for 0.075s is applied at time zero, but only the data after 2 seconds is kept. The abrupt faults last for 0.075 seconds with magnitudes ranging from 0-320N , while the incipient faults last for 1.0 seconds and range from 0-46N. The ranges, based on previous experiments, are chosen such that half the trajectories end in a fall (we'll refer to these trajectories as \textit{faulty trajectories}), and half of the safe (non-falling) trajectories have a heel or toe lift. Similar to \cite{ref:kalyanakrishnan2011learning}, the force magnitudes are generated using a uniform distribution. The abrupt force is applied at random between 2.5s and 3.5s, while the incipient fault is applied at random between 2.0s and 3.5s. The application time for the incipient fault is longer because, in order not to include an abrupt deviation in the robot's nominal states, only the data collected after the force is applied is kept. 

% The force is applied at 0.25s and the ranges, based on previous experiments, are chosen such that half the trajectories end in a fall (weâ€™ll refer to these trajectories as faulty trajectories), and half of the safe (non-falling) trajectories have a foot lift. Similar to \cite{ref:kalyanakrishnan2011learning}, the force magnitudes are generated using a uniform distribution. For the abrupt fault, the force lasts for 0.075 seconds with magnitudes ranging from 0-320N, while the forces for the incipient fault last for 1.0 seconds and range from 0-46N. To better emulate incipient faults, only the data collected after the force is applied is kept \jwg{Previous sentence not clear for me. Also, I think it can go later...}. 

%  \begin{figure*}
% \centering
%     \subfloat[Abrupt Fault Trajectory with a Force of 156N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/fast_acting_safe_156N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionchairx}
%         }
%         \hfil
%         \subfloat[Abrupt Fault Trajectory with a Force of 298 N ]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/fast_acting_fall_298N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionchairy} 
%         }
        
%         \hfil
%         \centering
%           \subfloat[Incipient Fault Trajectory with a Force of 23N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/slow_acting_safe_23N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionRightFootx}
%         }
%         \hfil
%         \subfloat[Incipient Fault Trajectory with a Force of 30N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/slow_acting_fall_30N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionRightFooty} 
%         }
%       \caption{Snapshots of safe and faulty trajectories for both incipient and abrupt faults \eva{should I keep this figure?}}
%       \label{fig:traj_anim}
% \end{figure*}

% \begin{figure}
%     \centering
%     \includegraphics[width=0.45\textwidth]{img/fall_detection/robot_description/slow_acting_fall_30N.jpg}
%     \caption{Snapshot of Incipient Fault Trajectory with a Force of 30N}
%     \label{fig:traj_anim}
% \end{figure}
%  \begin{figure*}
% \centering
%     \subfloat[Abrupt Fault Trajectory with a Force of 156N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/fast_acting_safe_156N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionchairx}
%         }
%         \hfil
%         \subfloat[Abrupt Fault Trajectory with a Force of 298 N ]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/fast_acting_fall_298N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionchairy} 
%         } 
%         \hfil
%         \centering
%           \subfloat[Incipient Fault Trajectory with a Force of 23N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/slow_acting_safe_23N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionRightFootx}
%         }
%         \hfil
%         \subfloat[Incipient Fault Trajectory with a Force of 30N]{
%       \resizebox{.45\linewidth}{!}{\includegraphics{img/fall_detection/robot_description/slow_acting_fall_30N.jpg}}
%         % \label{fig:sts_asymTorque_sitFrictionRightFooty} 
%         }
%       \caption{Snapshots of safe and faulty trajectories for both incipient and abrupt faults \eva{should I keep this figure?}}
%       \label{fig:traj_anim}
% \end{figure*}


