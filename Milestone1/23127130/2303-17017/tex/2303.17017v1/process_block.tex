
\caption{}
\label{alg:procmix}
\begin{algorithmic}[1]

\Function{\texttt{$\mathtt{process\_mixed\_block}$}}{$B$}
    \State{$\mathtt{successors}$ = []}
    %\State{B.actualizar\_HIT()}
    \If{B.$\mathtt{terms\_to\_process}$ == []}  \Comment{Need to compute a new group of terms} \label{ifttpvacio} 
        \State{Generate terms using B.$\mathtt{witnesses}$ and B.$\mathtt{new\_witnesses}$ in B.$\mathtt{terms\_to\_process}$ } \label{nuevosaprocesar}
        \State{B.$\mathtt{new\_witnesses}$ = []} \label{fittpvacio}
    \EndIf
    \State{$\mathtt{t}$ = pop(B.$\mathtt{terms\_to\_process}$)}
    \State{B.$\mathtt{step}$ = B.$\mathtt{step}$ + 1} \label{line:step+1}
    \State{$\mathtt{complement\_block}$ = B.$\mathtt{tuples}$} \Comment{Initialize with all tuples}
    \State{$\mathtt{complement\_formula}$ = $\top$}
    \For{s $\in$ B.$\mathtt{witnesses}$} \label{line:forsplit}
        \State{$\mathtt{eq\_tuples}$ = [v $\in$ B.$\mathtt{tuples}$ : $\mathtt{t}$(v) == s(v)]} \Comment{Tuples for a new block}
        \If{$\mathtt{eq\_tuples}$ != []}
            \State{$\mathtt{successor}$ := Block($\mathtt{eq\_tuples}$, B.$\mathtt{witnesses}$, B.$\mathtt{new\_witnesses}$,}
            \Statex{\hspace{4.7cm} B.$\mathtt{terms\_to\_process}$, B.$\mathtt{formula}$ $\land$ $t=s$, B.$\mathtt{step}$)}
            \State{$\mathtt{successors}$.append($\mathtt{successor}$)}
            
            \Comment{Delete the tuples that appear in the new block}
            
            \State{$\mathtt{complement\_block}$ = $\mathtt{complement\_block}$ - $\mathtt{eq\_tuples}$} \label{line:deletetuples}

            \Comment{Append the negation formula}
            
            \State{$\mathtt{complement\_formula}$ = B.$\mathtt{formula}$ $\land$ $\mathtt{complement\_formula}$ $\land$ $(t\neq s)$ }
        \EndIf
    \EndFor
    \If{$\mathtt{complement\_block}$ != []}
        \State{$\mathtt{successor}$ = Block($\mathtt{complement\_block}$, B.$\mathtt{witnesses}$ + [$\mathtt{t}$],}
         
         \Statex{\hspace{4.1cm}B.$\mathtt{new\_witnesses}$ + [$\mathtt{t}$], B.$\mathtt{terms\_to\_process}$,}
        \Statex{\hspace{4.051cm} $\mathtt{complement\_formula}$, B.$\mathtt{step}$)}
        \State{$\mathtt{successors}$.append($\mathtt{successor}$)} \label{line:endsplit}
    \EndIf
    \If{there is exactly one entry in $\mathtt{successors}$}
        \Comment{$\mathtt{formula}$ does not need to increase} \label{line:unhijo}
        \State{$\mathtt{successors}$[0].$\mathtt{formula}$ = B.$\mathtt{formula}$}
    \EndIf
    \State{\Return{$\mathtt{successors}$}}\label{line:returnsuccessors}
\EndFunction

\end{algorithmic}