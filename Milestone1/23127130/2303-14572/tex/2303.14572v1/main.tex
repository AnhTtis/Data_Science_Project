\documentclass[11pt, letterpaper]{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage,times}




\usepackage{amsmath,amsfonts,amsthm,amssymb,multirow}
\usepackage{thm-restate}
\usepackage{times}
\usepackage{graphicx}
\usepackage{floatpag}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{bbold}
\usepackage{enumitem}
\usepackage{subcaption} 
\usepackage{calc}
\usepackage{tikz}
\usetikzlibrary{decorations.markings,decorations.pathreplacing,arrows, automata, positioning, quotes, shapes,backgrounds, arrows.meta}
\tikzstyle{vertex}=[circle, draw, inner sep=0pt, minimum size=4pt, fill = black]
\newcommand{\vertex}{\node[vertex]}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage[colorlinks,citecolor=blue,linkcolor=blue,urlcolor=red,pagebackref]{hyperref}
\usepackage{comment}
\usepackage[T1]{fontenc}

\makeatletter
\newcommand{\multiline}[1]{%
  \begin{tabularx}{\dimexpr\linewidth-\ALG@thistlm}[t]{@{}X@{}}
    #1
  \end{tabularx}
}
\makeatother
\usepackage{mathtools}
\usepackage{diagbox}
\DeclarePairedDelimiter\abs{\lvert}{\rvert}%

\makeatletter
\def\BState{\State\hskip-\ALG@thistlm}
\makeatother

\newcommand{\ceil}[1]{\lceil #1 \rceil}
\newcommand{\floor}[1]{\lfloor #1 \rfloor}

\usepackage[compact]{titlesec}
\titlespacing{\section}{0pt}{3ex}{2ex}
\titlespacing{\subsection}{0pt}{2ex}{1ex}
\titlespacing{\subsubsection}{0pt}{0.5ex}{0ex}

\newenvironment{reminder}[1]{\smallskip

\noindent {\bf Reminder of #1 }\em}{\smallskip}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{fact}[theorem]{Fact}
\newtheorem{rules}[theorem]{Rule}

\newtheorem{remark}[theorem]{Remark}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newenvironment{proofof}[1]{{\bf Proof of #1.  }}{\hfill$\Box$}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{hypothesis}{Hypothesis}
\newtheorem{conjecture}{Conjecture}
\newtheorem{fconjecture}[theorem]{``Conjecture''}
\newtheorem{observation}[theorem]{Observation}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{conj}[theorem]{Conjecture}
\newtheorem{fconj}[theorem]{``Conjecture''}


\makeatletter
\let\c@fconjecture\c@conjecture
\makeatother

\makeatletter
\let\c@fconj\c@conj
\makeatother

\newtheorem{innercustomhypo}{Hypothesis}
\newenvironment{customhypo}[1]
{\renewcommand\theinnercustomhypo{#1}\innercustomhypo}
{\endinnercustomhypo}


\def \imp {\rightarrow}
\def \qed {\hfill $\Box$}
\def \R {{\mathbb R}}
\def \sR {{\mathcal R}}
\def \eps {\varepsilon}
\def \N {{\mathbb N}}
\def \Z {{\mathbb Z}}

\def \poly {\mathop{\rm poly}} %
\def \polylog {\mathop{\rm polylog}}%
\def\th{{\text{\rm th}}}
\def\tO{\widetilde{O}}

\newcommand{\de}{\delta}
\newcommand{\D}{\Delta}
\newcommand{\MMM}{{\cal M}}
\newcommand{\MM}{{\cal M}^\star}
\newcommand{\MMMp}{{\mbox{\rm M}}}
\newcommand{\MMp}{{\mbox{\rm M}^\star}}
\newcommand{\CAP}[1]{$(\le #1)$}
\newcommand{\Var}{\mathrm{Var}}

\newcommand{\negbigskip}{\vspace{-\bigskipamount}}
\newcommand{\OO}{\widetilde{O}}
\newcommand{\OOmega}{\widetilde{\Omega}}
\newcommand{\Ex}{\mathbb{E}}

\newcommand{\OV}{\mbox{\sf OV}}
\newcommand{\OVCount}{\mbox{\sf \#OV}}
\newcommand{\RealAPSP}{\mbox{\sf Real-APSP}}
\newcommand{\IntAPSP}{\mbox{\sf Int-APSP}}
\newcommand{\APSP}{\mbox{\sf APSP}}
\newcommand{\APSPCount}{\mbox{\sf \#APSP}}
\newcommand{\APSPCountMod}[1]{\mbox{\sf \#$_{\scriptsize {\rm mod}\, #1}$APSP}}

\newcommand{\MinPlus}{\mbox{\sf Min-Plus-Product}}
\newcommand{\MinPlusCount}{\mbox{\sf \#Min-Plus-Product}}
\newcommand{\Equality}{\mbox{\sf Equality-Product}}
\newcommand{\ExistEquality}{\mbox{\sf $\exists$Equality-Product}}
\newcommand{\Dominance}{\mbox{\sf Dominance-Product}}
\newcommand{\ExactTri}{\mbox{\sf Exact-Tri}}
\newcommand{\AEExactTri}{\mbox{\sf AE-Exact-Tri}}
\newcommand{\ExactTriCount}{\mbox{\sf \#Exact-Tri}}
\newcommand{\AEExactTriCount}{\mbox{\sf \#AE-Exact-Tri}}
\newcommand{\AEExactTriCountReal}{\mbox{\sf \#AE-Real-Exact-Tri}}
\newcommand{\NegTri}{\mbox{\sf Neg-Tri}}
\newcommand{\AENegTri}{\mbox{\sf AE-Neg-Tri}}
\newcommand{\AENegTriCount}{\mbox{\sf \#AE-Neg-Tri}}
\newcommand{\AENegTriCountReal}{\mbox{\sf \#AE-Real-Neg-Tri}}
\newcommand{\NegTriCount}{\mbox{\sf \#Neg-Tri}}
\newcommand{\AEZeroTri}{\mbox{\sf AE-Zero-Tri}}
\newcommand{\AEMonoTri}{\mbox{\sf AE-Mono-Tri}}
\newcommand{\ExactKClique}{\mbox{\sf Exact-$k$-Clique}}
\newcommand{\ExactKCliqueCount}{\mbox{\sf \#Exact-$k$-Clique}}
\newcommand{\MinKClique}{\mbox{\sf Min-$k$-Clique}}
\newcommand{\MinKCliqueCount}{\mbox{\sf \#Min-$k$-Clique}}
\newcommand{\MinPlusConv}{\mbox{\sf Min-Plus-Convolution}}
\newcommand{\MinPlusConvCount}{\mbox{\sf \#Min-Plus-Convolution}}
\newcommand{\MinEqualityConv}{\mbox{\sf Min-Equal-Convolution}}

\newcommand{\MinWitness}{\mbox{\sf Min-Witness-Prod}}%
\newcommand{\MinWitnessEq}{\mbox{\sf Min-Witness-Eq-Prod}}
\newcommand{\MinEqualityProd}{\mbox{\sf Min-Equal-Prod}}
\newcommand{\MaxMin}{\mbox{\sf Max-Min-Prod}}

\newcommand{\uAPSP}{\mbox{\sf u-dir-APSP}}
\newcommand{\APSLP}{\mbox{\sf undir-APSLP$_{1, 2}$}}
\newcommand{\APSLPIntro}{\mbox{\sf undir-APSLP}}
\newcommand{\APLSP}{\mbox{\sf undir-APLSP$_{1, 2}$}}
\newcommand{\APLSPIntro}{\mbox{\sf undir-APLSP}}

\newcommand{\BatchMode}{\mbox{\sf Batch-Range-Mode}}


\newcommand{\ThreeSUM}{\mbox{\sf 3SUM}}
\newcommand{\ThreeSUMCount}{\mbox{\sf \#3SUM}}
\newcommand{\AllThreeSUM}{\mbox{\sf All-Nums-3SUM}}
\newcommand{\AllThreeSUMCount}{\mbox{\sf \#All-Nums-3SUM}}
\newcommand{\AllThreeSUMCountReal}{\mbox{\sf \#All-Nums-Real-3SUM}}
\newcommand{\ThreeSUMConv}{\mbox{\sf 3SUM-Convolution}}
\newcommand{\ThreeSUMConvCount}{\mbox{\sf \#3SUM-Convolution}}
\newcommand{\AllThreeSUMConv}{\mbox{\sf All-Nums-3SUM-Convolution}}
\newcommand{\AllThreeSUMConvCount}{\mbox{\sf \#All-Nums-3SUM-Convolution}}

\newcommand{\MonoConv}{\mbox{\sf Mono-Convolution}}
\newcommand{\MonoConvCount}{\mbox{\sf \#Mono-Convolution}}
\newcommand{\BMM}{\mbox{\sf BMM}}

\newcommand{\StrongAPSP}{Strong APSP Hypothesis}
\newcommand{\StrongAPSPPDF}{Strong APSP Hypothesis}
\newcommand{\StrongAPSPShort}{Strong APSP}
\newcommand{\StrongConv}{Strong Min-Plus Convolution Hypothesis}
\newcommand{\StrongConvShort}{Strong Min-Plus Convolution}
\newcommand{\uAPSPH}{u-dir-APSP Hypothesis}



\newcommand{\TunwtdirAPSP}{\textsc{{u}-dir-apsp}}%
\newcommand{\Tminwit}{\textsc{min-witness-prod}}
\newcommand{\TundirAPLSP}{\textsc{undir-aplsp}_{1,2}}
\newcommand{\TundirAPSLP}{\textsc{undir-apslp}_{1,2}}
\newcommand{\Trangemode}{\textsc{batched-range-mode}}%
\newcommand{\Tminwiteq}{\textsc{min-witness-eq-prod}}
\newcommand{\Tgeneq}{\textsc{gen-eq-prod}}
\newcommand{\Teq}{\textsc{eq-prod}}

\newcommand{\up}[1]{\left\lceil#1\right\rceil}
\newcommand{\nhat}{\hat{n}}

\newcommand{\lam}{\lambda}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\setlist[itemize]{leftmargin=*}
\setlist[enumerate]{leftmargin=*}

\title{Fredman's Trick Meets Dominance Product: Fine-Grained Complexity of Unweighted APSP, 3SUM Counting, and More}

\author{Timothy M. Chan\thanks{Supported by NSF Grant CCF-2224271.}\\UIUC\\tmc@illinois.edu \and Virginia {Vassilevska Williams}\thanks{Supported by an NSF CAREER Award, NSF Grant CCF-2129139 and BSF Grant BSF:2012338, a Google Research Fellowship and a Sloan Research Fellowship.}\\MIT\\virgi@mit.edu \and Yinzhan Xu\thanks{Partially supported by NSF Grant CCF-2129139.}\\MIT\\xyzhan@mit.edu}
\date{}

\begin{document}
\pagenumbering{gobble} 
\maketitle

\begin{abstract}
In this paper we carefully combine Fredman's trick [SICOMP'76] and Matou\v{s}ek's approach for dominance product [IPL'91] to obtain powerful results in fine-grained complexity:
\begin{itemize}
    \item 
    Under the hypothesis that APSP for undirected graphs with edge weights in $\{1, 2, \ldots, n\}$ requires $n^{3-o(1)}$ time (when $\omega=2$), we show a variety of conditional lower bounds, including an $n^{7/3-o(1)}$ lower bound for unweighted directed APSP and an $n^{2.2-o(1)}$ lower bound for computing the Minimum Witness Product between two $n \times n$ Boolean matrices, even if $\omega=2$, improving upon their trivial $n^2$ lower bounds. Our techniques can also be used to reduce the unweighted directed APSP problem to other problems. In particular, we show that (when $\omega = 2$), if unweighted directed APSP requires $n^{2.5-o(1)}$ time, then Minimum Witness Product requires $n^{7/3-o(1)}$ time. 
    
    \item We show that, surprisingly, many central problems in fine-grained complexity are equivalent to their natural counting versions. In particular, we show that Min-Plus Product and Exact Triangle are subcubically equivalent to their counting versions, and 3SUM is subquadratically equivalent to its counting version. 

    \item We obtain new algorithms using new variants of the Balog-Szemer\'edi-Gowers theorem from additive combinatorics.  For example, we  get an $O(n^{3.83})$ time deterministic algorithm for exactly counting the number of shortest paths in an arbitrary weighted graph, improving the textbook $\widetilde{O}(n^{4})$ time algorithm. We also get  faster algorithms for 3SUM in preprocessed universes, and deterministic algorithms for 3SUM on monotone sets in $\{1, 2, \ldots, n\}^d$. 
\end{itemize}
\end{abstract}

\newpage

\tableofcontents
\newpage

\pagenumbering{arabic} 
\section{Introduction}
\input{intro}

\section{Problem Definitions}
\label{sec:prelim}
\input{prelim}


\section{Conditional Lower Bounds for Problems with Intermediate Complexity:\texorpdfstring{\\}{} u-dir-APSP under the \texorpdfstring{\StrongAPSP{}}{\StrongAPSPPDF{}}}
\label{sec:intapsp-lower-bound}
\input{int_apsp_reduce_preview}

\section{Equivalences Between Counting and Detection Problems:\texorpdfstring{\\}{} \#Exact-Triangle vs.\ Exact-Triangle}
\label{sec:counting:preview}
\input{counting_preview}

\section{Alternative to BSG: A Triangle Decomposition Theorem and Its Applications}
\label{sec:decomposition-zero-tri}
\input{tri_decompose}


\section{More Lower Bounds under the \texorpdfstring{\StrongAPSP{}}{\StrongAPSPPDF{}}}
\label{sec:intapsp-lower-bound:more}
\input{int_apsp_reduce_more}


\section{More Equivalences Between Counting and Detection Problems}
\label{sec:counting}
\input{counting}


\section{Counting Algorithms in Other Models}
\label{sec:other_models}
\input{co-nondet}


\section{BSG Theorems Revisited}
\label{sec:bsg}
\input{bsg}

\section{Lower Bounds for Min-Equality Convolution}
\label{sec:min-equal-conv}
\input{min_eq_conv}

\section{Acknowledgement}
We would like to thank Lijie Chen for suggesting the quantum \ThreeSUMCount{} problem. 

\bibliographystyle{alpha}
\bibliography{ref}

\appendix

\section{Still More Equivalences Between Counting and Detection Problems}
\label{sec:more_counting}
\input{more_counting}


\input{more_bsg}


\end{document}