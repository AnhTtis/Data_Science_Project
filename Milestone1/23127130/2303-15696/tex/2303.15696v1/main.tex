\documentclass[%
%reprint,
%superscriptaddress,
%groupedaddress,
%unsortedaddress,
%runinaddress,
%frontmatterverbose, 
%preprint,
%preprintnumbers,
nofootinbib,
%nobibnotes,
%bibnotes,
%sor,
%jor,
 %aps
amsmath,amssymb,
%onecolumn,
%pra,
%prb,
%rmp,
%prstab,
%prstper,
%floatfix,
]{aastex631}

\usepackage{graphicx}
\usepackage{dcolumn}
\usepackage{bm}
\usepackage{braket}
\usepackage{hyperref}
% %\usepackage[symbol]{footmisc}
\usepackage{xcolor, soul}
\usepackage{pygtex}
\usepackage{physics, amsmath}
\usepackage{inputenc}
% \usepackage[normalem]{ulem} 

%%%%%%%%%% acronym definitions %%%%%%%%%%%%%%
\usepackage[acronym]{glossaries}
\makeglossaries
%% Acronyms
\newacronym[plural=GWs,firstplural=gravitational waves (GWs)]{gw}{GW}{gravitational wave}
\newacronym[plural=BHs,firstplural=black holes (BHs)]{bh}{BH}{black hole}
\newacronym[plural=CBCs,firstplural=compact binary coalescences (CBCs)]{cbc}{CBC}{compact binary coalescence}
\newacronym[plural=SGWBs,firstplural=stochastic gravitational-wave backgrounds (SGWBs)]{sgwb}{SGWB}{stochastic gravitational-wave background}
\newacronym[plural=GWBs, firstplural=gravitational-wave backgrounds (GWBs)]{gwb}{GWB}{gravitational-wave background}
\newacronym[plural=DFTs, firstplural=discrete Fourier transforms (DFTs)]{dft}{DFT}{discrete Fourier transform}
\newacronym[plural=MVUEs, firstplural=minimum-variance unbiased estimators(MVUEss)]{mvue}{MVUE}{minimum-variance unbiased estimator}
\newacronym{ligo}{LIGO}{Laser Interferometer Gravitational-wave Observatory}
\newacronym{lvk}{LVK}{LIGO, Virgo, and KAGRA Collaboration}
\newacronym{lisa}{LISA}{Laser Interferometer Space Antenna}
\newacronym{et}{ET}{Einstein Telescope}
\newacronym{ce}{CE}{Cosmic Explorer}
\newacronym[plural=BBHs,firstplural=binary black holes (BBHs)]{bbh}{BBH}{binary black hole}
\newacronym[plural=BNSs,firstplural=binary neutron stars (BNSs)]{bns}{BNS}{binary neutron star}
\newacronym[plural=MDSCs,firstplural=mock data and science challenges (MDSCs)]{mdsc}{MDSC}{mock data and science challenges}
\newacronym[plural=IFTed,firstplural=inverse--discrete Fourier transformed (IFTed)]{ift}{IFT}{inverse--discrete Fourier transform}
\newacronym{plpp}{PLPP}{power-law-plus-peak}
\newacronym{pl}{PL}{power-law}
\newacronym{snr}{SNR}{signal-to-noise ratio}
\newacronym{psd}{PSD}{power spectral density}
\newacronym[plural=ORFs, firstplural=overlap reduction functions (ORFs)]{orf}{ORF}{overlap reduction function}
\newacronym{asd}{ASD}{amplitude spectral density}
\newacronym{csd}{CSD}{cross-spectral density}
\newacronym{gwosc}{GWOSC}{Gravitational-wave Open Science Center}
\newacronym{ks}{KS}{Kolmogorov-Smirnov}
\newacronym{gr}{GR}{General Relativity}
\newacronym{pi}{PI}{power-law integrated sensitivity}

% \newcommand{\air}[1]{\textcolor{orange}{[{\bf AIR}: #1]}}
% \newcommand{\lt}[1]{\textcolor{teal}{[{\bf LT}: #1]}}
% \newcommand{\fdl}[1]{\textcolor{violet}{[{\bf FDL}: #1]}}
% \newcommand{\arr}[1]{\textcolor{pink}{[{\bf ARR}: #1]}}
% \newcommand{\kt}[1]{\textcolor{magenta}{[{KT}: #1]}}
% \newcommand{\mla}[1]{\textcolor{brown}{[{\bf MLA}: #1]}}
% \newcommand{\kj}[1]{\textcolor{blue}{[{KJ}: #1]}}
% \newcommand{\sk}[1]{\textcolor{brown}{[{SK}: #1]}}
% \newcommand{\pmm}[1]{\textcolor{purple}{[{PMM}: #1]}}

\begin{document}
\nolinenumbers
\title{{\tt pygwb}: Python-based library for gravitational-wave background searches}

\author{Arianna I. Renzini}
\email{arenzini@caltech.edu}
\affiliation{LIGO Laboratory,  California  Institute  of  Technology,  Pasadena,  California  91125,  USA}
\affiliation{Department of Physics, California Institute of Technology, Pasadena, California 91125, USA}
\author{Alba Romero-Rodríguez}
 \affiliation{Theoretische Natuurkunde, Vrije Universiteit Brussel, Pleinlaan 2, B-1050 Brussels, Belgium} 
\author{Colm Talbot}
\affiliation{Kavli Institute for Astrophysics and Space Research, Massachusetts Institute of Technology, 77 Massachusetts Ave, Cambridge, MA 02139, USA}
\author{Max Lalleman}
 \affiliation{Universiteit Antwerpen, Prinsstraat 13, 2000 Antwerpen, Belgium} 
\author{Shivaraj Kandhasamy}
\affiliation{Inter-University Centre for Astronomy and Astrophysics, Pune 411007, India}
\author{Kevin Turbang}
\affiliation{Universiteit Antwerpen, Prinsstraat 13, 2000 Antwerpen, Belgium}
\affiliation{Theoretische Natuurkunde, Vrije Universiteit Brussel, Pleinlaan 2, B-1050 Brussels, Belgium} 
\author{Sylvia Biscoveanu}
\affiliation{Kavli Institute for Astrophysics and Space Research, Massachusetts Institute of Technology, 77 Massachusetts Ave, Cambridge, MA 02139, USA}
\affiliation{LIGO Laboratory, Massachusetts Institute of Technology, 185 Albany St, Cambridge, MA 02139, USA}
\author{Katarina Martinovic}
\affiliation{Theoretical Particle Physics and Cosmology Group,  Physics Department, \\ King's College London, University of London, Strand, London WC2R 2LS, United Kingdom}
\author{Patrick Meyers}
\affiliation{Theoretical Astrophysics Group, California Institute of Technology, Pasadena, CA 91125, USA}
\author{Leo Tsukada}
\affiliation{Department of Physics, The Pennsylvania State University, University Park, Pennsylvania 16802, USA}
\affiliation{Institute for Gravitation and the Cosmos, The Pennsylvania State University, University Park, Pennsylvania 16802, USA}
\author{Kamiel Janssens}
 \affiliation{Universiteit Antwerpen, Prinsstraat 13, 2000 Antwerpen, Belgium}
 \affiliation{Universit\'e C$\hat{o}$te d’Azur, Observatoire C$\hat{o}$te d’Azur, ARTEMIS, Nice, France}
\author{Derek Davis}
\affiliation{LIGO Laboratory,  California  Institute  of  Technology,  Pasadena,  California  91125,  USA}
\affiliation{Department of Physics, California Institute of Technology, Pasadena, California 91125, USA}
\author{Andrew Matas}
\affiliation{Max Planck Institute for Gravitational Physics (Albert Einstein Institute), D-14476 Potsdam, Germany}
\author{Philip Charlton}
\affiliation{OzGrav, Charles Sturt University, Wagga Wagga, New South Wales 2678, Australia}
\author{Guo-Chin Liu}
\affiliation{Department of Physics, Tamkang University, Danshui Dist., New Taipei City 25137, Taiwan}
\author{Irina Dvorkin}
\affiliation{Institut d’Astrophysique de Paris, Sorbonne Universit\'e \& CNRS, UMR 7095, 98 bis bd Arago, F-75014 Paris, France}
\affiliation{Université Paris Cité, CNRS, Astroparticule et Cosmologie, F-75013 Paris, France}
\author{Sharan Banagiri}
\affiliation{Center for Interdisciplinary Exploration and Research in Astrophysics (CIERA), Northwestern University, 1800 Sherman Ave, Evanston, IL 60201, USA}
\author{Sukanta Bose}
\affiliation{Inter-University Centre for Astronomy and Astrophysics, Pune 411007, India}
\author{Thomas Callister}
\affiliation{Kavli Institute for Cosmological Physics, The University of Chicago, 5640 S. Ellis Ave., Chicago, IL 60615, USA}
\author{Federico De Lillo}
\affiliation{Centre for Cosmology, Particle Physics and Phenomenology (CP3),\\
Universit\'e catholique de Louvain, Louvain-la-Neuve, B-1348, Belgium}
\author{Luca D'Onofrio}
\affiliation{Universit\`a di Napoli "Federico II", Dipartimento di Fisica "Ettore Pancini", Compl. Univ. di Monte S. Angelo, Via Cinthia 21, I-80126, Napoli, Italy}
\affiliation{INFN, Sezione di Napoli, Compl. Univ. di Monte S. Angelo, Edificio G, Via Cinthia, I-80126, Napoli, Italy}
\author{Fabio Garufi}
\affiliation{Universit\`a di Napoli "Federico II", Dipartimento di Fisica "Ettore Pancini", Compl. Univ. di Monte S. Angelo, Via Cinthia 21, I-80126, Napoli, Italy}
\affiliation{INFN, Sezione di Napoli, Compl. Univ. di Monte S. Angelo, Edificio G, Via Cinthia, I-80126, Napoli, Italy}
\author{Gregg Harry}
\affiliation{Physics Department, American University, Washington, DC 20016, USA}
\author{Jessica Lawrence}
\affiliation{Department of Physics, Texas Tech University, Lubbock, TX 79409, USA}
\author{Vuk Mandic}
\affiliation{School of Physics and Astronomy, University of Minnesota, Minneapolis, MN 55455, USA}
\author{Adrian Macquet}
\affiliation{Institut de F\'{\i}sica d’Altes Energies (IFAE), The Barcelona Institute of Science and Technology, Campus UAB, 08193 Bellaterra (Barcelona) Spain}
\author{Ioannis Michaloliakos}
\affiliation{Department of Physics, University of Florida, Gainesville, Florida 32611, USA}
\author{Sanjit Mitra}
\affiliation{Inter-University Centre for Astronomy and Astrophysics, Pune 411007, India}
\author{Kiet Pham}
\affiliation{School of Physics and Astronomy, University of Minnesota, Minneapolis, MN 55455, USA}
\author{Rosa Poggiani}
\affiliation{Universit\`a di Pisa, I-56127 Pisa, Italy}
\affiliation{INFN, Sezione di Pisa, I-56127 Pisa, Italy}
\author{Tania Regimbau}
\affiliation{LAPP, CNRS, 9 Chemin de Bellevue, 74941 Annecy-le-Vieux, France}
\author{Joseph D. Romano}
\affiliation{Department of Physics, Texas Tech University, Lubbock, TX 79409, USA}
\author{Nick van Remortel}
 \affiliation{Universiteit Antwerpen, Prinsstraat 13, 2000 Antwerpen, Belgium}
\author{Haowen Zhong}
\affiliation{School of Physics and Astronomy, University of Minnesota, Minneapolis, MN 55455, USA}


\begin{abstract}
The collection of gravitational waves (GWs) that are either too weak or too numerous to be individually resolved is commonly referred to as the gravitational-wave background (GWB). % would arise from the superposition of gravitational waves that are too weak to be individually resolved. %
A confident detection and model-driven characterization of such a signal will provide invaluable information about the evolution of the Universe and the population of GW sources within it. %
We present a new, user-friendly Python--based package for gravitational-wave data analysis to search for an isotropic GWB in ground--based interferometer data. %
We employ cross-correlation spectra of GW detector pairs to construct an optimal estimator of the Gaussian and isotropic GWB, and Bayesian parameter estimation to constrain GWB models. %
The modularity and clarity of the code allow for both a shallow learning curve and flexibility in adjusting the analysis to one's own needs. %
We describe the individual modules which make up {\tt pygwb}, following the traditional steps of stochastic analyses carried out within the LIGO, Virgo, and KAGRA Collaboration. %
We then describe the built-in pipeline which combines the different modules and validate it with both mock data and real GW data from the O3 Advanced LIGO and Virgo observing run. %
We successfully recover all mock data injections and reproduce published results. %

\end{abstract}

%\maketitle

%\tableofcontents

\section{Introduction}
\input{intro}
\section{The isotropic stochastic analysis}
\input{methods}

\section{Individual modules}
\label{sec: modules}
What follows is a detailed step-by-step presentation of the stochastic analysis pipeline. % 
We follow the natural structure of the code for clarity as we introduce each module individually. %
To start, we present the {\tt preprocessing} module which pre-conditions the time-domain strain from \gls{gw} detectors for spectral analysis. %
In {\tt spectral}, we explain the power spectrum and cross-spectrum calculations, which produce the $P_{I, f}$ and $C_{IJ, f}$ spectra in Eqs.~\eqref{eq:Omega} and~\eqref{eq:Variance}. %
We then describe {\tt postprocessing}, which includes the averaging procedures employed over large datasets to obtain an optimal estimate of the signal amplitude starting from the quantities in Eqs.~\eqref{eq:Omega} and~\eqref{eq:Variance}, and knowledge of the expected spectral shape. %
In {\tt delta-sigma cut} and {\tt notch}, we present modules which focus on data quality checks, and the implementation of relevant time-domain and frequency-domain data cuts. % 
We then describe the built-in parameter estimation module {\tt pe}, based on {\tt Bilby}~\cite{Ashton:2018jfp}, a Python--based Bayesian inference library widely used in GW data analysis. %
Finally, we present the {\tt simulator} module, which includes different mock-data injection techniques for \gls{gwb} study and detection validation. %

A schematic of the {\tt pygwb} package is presented in Fig.~\ref{fig:flowchart}. %
This includes the manager objects {\tt Interferometer}, {\tt Baseline}, and {\tt Network}, presented in Sec.~\ref{sec: manager objects}.

\begin{figure}
    \centering
    \includegraphics[width = 0.65\textwidth]{pygwb_modules.pdf}
    \caption{Schematic overview of {\tt pygwb} analysis flow. In blue squares, we show the manager objects of the code that handle the analysis internally. These manager objects query (red arrows) different modules for specific objects, calculations, or quantities (rounded bubbles), imported (grey arrows) by either internal (i.e., within {\tt pygwb}) or external modules (i.e., outside of {\tt pygwb}). Internal modules are indicated in red, while external modules are indicated in green. }
    \label{fig:flowchart}
\end{figure}

%To be organised according to the pipeline worflow - yet good as standalone sections.

\subsection{\tt preprocessing}\label{sec:preproc}
\input{preprocessing}

\subsection{\tt spectral}\label{sec:spectral}
\input{spectral}

\subsection{\tt postprocessing}\label{sec:postproc}
\input{postproc}

\subsection{\tt delta-sigma cut}\label{Sec:DeltaSigma}
\input{delta_sigma_cut}

\subsection{\tt notch}\label{sec:notch}
\input{notch}

\subsection{\tt pe}\label{sec:pe}
\input{pe}

\subsection{\tt simulator}
\label{Sec:Simulator}
\input{simulator}

\section{Manager objects}
\label{sec: manager objects}
{\tt pygwb} counts three manager objects the user can interface with: {\tt Interferometer}, {\tt Baseline}, and {\tt Network}, which are defined in the {\tt detector}, {\tt baseline}, and {\tt network} modules, respectively. Each object is in charge of storing and saving relevant data, and handles data analysis internally. %
The manager objects are designed such that the user need never call a method from a module directly, but rather will invoke the manager which queries the relevant module to perform the calculation. %
For details on how to use these objects, see the complete set of tutorials in the {\tt pygwb} online documentation~\cite{docs}. %

%\air{guidline: it's `a' detector object, and `the' detector module.}

\subsection{\tt detector}\label{sec:detector}
\input{detector}

\subsection{\tt baseline}\label{sec:baseline}
\input{baseline}

\subsection{\tt network}\label{sec:network}
\input{network}

\section{Analysis pipeline}
\label{sec: pipeline}

The previous sections contain a detailed description of each of the modules of the {\tt pygwb} package. %
We now present an overview of the package analysis scripts,  which combine the various modules into a \gls{gwb} analysis pipeline. %
The pipeline has several default values which may be changed according to the user's requirements. %
However, we note that thanks to the flexibility of the {\tt pygwb} package, one can also easily construct an ad-hoc pipeline. %

\subsection{\tt pygwb\_pipe}
\input{pygwb_pipe}

\subsection{\tt statistical\_checks}\label{Sec:StatChecks}
\input{statistical_checks}

\section{Testing}

To comprehensively test the {\tt pygwb} analysis suite, we employ an efficient workflow to analyze datasets of increasing complexity. %
The datasets considered in this paper are:
\begin{enumerate}
    \item {\bf Continuous \gls{sgwb}:} A loud stationary and continuous stochastic signal generated with the {\tt simulator} module, injected in Advanced \gls{ligo} Hanford and \gls{ligo} Livingston assuming design A+ sensitivity~\cite{aplus_design_curve}. 
    \item {\bf Realistic \gls{cbc} \gls{gwb}:} A realistic background of merging \glspl{bbh} and \glspl{bns}, injected in Advanced \gls{ligo} Hanford and \gls{ligo} Livingston assuming design A+ sensitivity.
    \item {\bf O3 dataset:} The full Advanced \gls{ligo} Hanford and \gls{ligo} Livingston dataset from the third \gls{lvk} observing run~\cite{LIGO_O3}.
\end{enumerate}
The continuous \gls{sgwb} (dataset 1) is an idealized observing scenario, as our stochastic model matches the target signal perfectly by design, and as the signal is stationary and continuous our approach is optimal~\cite{Drasco-Flanagan:2003, Lawrence:2023buo}. %
The \gls{cbc} background (dataset 2) is a realistic scenario where the target signal is generated according to astrophysical models, informed by GW detections. %
In this case the signal is non-Gaussian, and we expect our approach to be un-biased~\cite{HLV-MDC-PhysRevD.92.063002, ET-first-MDC-PhysRevD.86.122001, ET-second-MDC-PhysRevD.89.084046} but sub-optimal~\cite{Drasco-Flanagan:2003, Lawrence:2023buo}, due to the intermittent nature of the signal which is not taken into account in the search method. %
For more details on the time-domain characteristics of these two types of signals and the detection challenges these present, see for example~\cite{Regimbau2022}. %
Finally, the O3 Advanced LIGO dataset (dataset 3) presents all the complexity of analyzing real GW detector data, which includes non-stationary noise, a large data volume, and expensive computational requirements. %

We handle large datasets by splitting the data into smaller {\tt pygwb$\_$pipe} jobs, assuming each job is independent; %
these are then combined using the {\tt pygwb$\_$combine} script (see Sec.~\ref{sec: pipeline} for details). %
We then employ a parameter estimation script, {\tt pygwb$\_$pe}, based on the {\tt pe} module described in Sec.~\ref{sec:pe}, to perform parameter estimation on specific models. %
For more details on how to run this sort of analysis, we refer users to the online documentation for the most up-to-date workflow instructions~\cite{docs}. %
In the following, we present the different datasets and summarize our analysis results.

\subsection{Mock data}
\label{sec: MDC}

\input{MDC}
\subsection{O3}
\label{Sec:O3Data}
\input{O3}

\section{Conclusions}
\input{conclusion}

\appendix
\section{Window functions and bias factors}\label{sec:app_window}
\input{window_appendix}

\section{Marginalizing over calibration uncertainty}\label{sec:app_calibration}
\input{calibration.tex}
\bibliographystyle{aasjournal}
\bibliography{pygwb_bib}

\end{document}
