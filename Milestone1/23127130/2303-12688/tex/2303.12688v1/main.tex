\documentclass[10pt,twocolumn,letterpaper]{article}

\usepackage{iccv}
\usepackage{times}
\usepackage{epsfig}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{overpic}
\usepackage{soul}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage[toc,page]{appendix}
\usepackage[numbers,sort,compress]{natbib}
% Include other packages here, before hyperref.

% If you comment hyperref and then uncomment it, you should delete
% egpaper.aux before re-running latex.  (Or just hit 'q' on the first latex
% run, let it finish, and you should be clear).
\usepackage[pagebackref=true,breaklinks=true,letterpaper=true,colorlinks,bookmarks=false]{hyperref}

\usepackage[capitalize]{cleveref}
\iccvfinalcopy % *** Uncomment this line for the final submission

\def\iccvPaperID{****} % *** Enter the ICCV Paper ID here
\def\httilde{\mbox{\tt\raisebox{-.5ex}{\symbol{126}}}}

% Pages are numbered in submission mode, and unnumbered in camera-ready
\ificcvfinal\pagestyle{empty}\fi

\newcommand{\duygu}[1]{\hl{#1}}
\newcommand{\chunhao}[1]{\hl{#1}}
\newcommand{\methodname}{\mbox{Pix2Video}\xspace}
\newcommand{\totaluser}{37\xspace}
\newcommand{\eachuser}{11\xspace}


\begin{document}

%%%%%%%%% TITLE
\title{Pix2Video: Video Editing using Image Diffusion}

\author{Duygu Ceylan\textsuperscript{1*}\quad 
        Chun-Hao P. Huang\textsuperscript{1*}\quad 
        Niloy J. Mitra\textsuperscript{1,2}\\ 
\textsuperscript{1}Adobe Research \quad \textsuperscript{2}University College London \\ 
{\normalsize \url{https://duyguceylan.github.io/pix2video.github.io/}}%
%\vspace{-.25cm}
}

\maketitle
% Remove page # from the first page of camera-ready.
\ificcvfinal\thispagestyle{empty}\fi
\def\thefootnote{*}\footnotetext{These authors contributed equally to this work}

\input{sections/abstract.tex}

\input{sections/teaser.tex}

\input{sections/intro.tex}

\input{sections/related-work.tex}

\input{sections/method.tex}

\input{sections/results.tex}

\input{sections/conclusion.tex}

\input{sections/acknowledgment.tex}

{\small
\bibliographystyle{ieee_fullname}
% \typeout{} 
\bibliography{main}
}

\clearpage
\begin{appendices} 
\label{appendices}
In this document, we provide details of the perceptual study, the comparison setup, and provide more ablations. We refer the reader to the accompanying webpage for video based results.

\section{Comparison Details.}
We provide more details about the comparisons we run. When comparing to Text2Live~\cite{bar2022text2live}, we use the neural atlases provided by the authors for the \textit{swan}, \textit{dog}, and \textit{car} examples. For other examples, we first compute a mask that is required for neural atlas computation. For computing the masks, we either use MaskRCNN~\cite{He_2017_ICCV} for categories detected by it or perform per-frame foreground object selection\footnote{Photoshop Select Subject}. When comparing to Tune-a-Video~\cite{wu2022tuneavideo}, we use the implementation provided by the authors and finetune on each example for 500 iterations using the default settings.

\input{sections/supp_userstudy}

\section{Ablation Study}
\subsection{Effect of layer choice in feature injection.}
The Unet of the Stable Diffusion v2 model consists of 16 layers where each layer has a resnet, self-attention, and cross attention modules. 6 of these blocks are part of the encoder, 9 are part of the decoder, and 1 consists of the bottleneck. In Figure~\ref{fig:feature}, we show the effect of applying feature injection into different self attention layers. We observe that injection features into deeper layers of the decoder (i.e., layers 13-16) already results in significant structural and appearance consistency. Injecting features in other decoder layers results in improvements especially in terms of preserving high frequency details. We do not observe further improvements as we inject features into the bottleneck layer. In Table~\ref{tab:quanti_feature}, we compare quantitatively the case where we perform feature injection only in the decoder vs all layers. We observe that while injecting features at all layers results in on-par CLIP-Image and slightly better Pixel-MSE errors, it tends to generate slightly more blurry output. This is also reflected in the slightly worse CLIP-Text errors. Hence, we choose to apply feature injection only for the decoder which strikes a good balance.

\begin{table}
\centering
 \caption{
 We quantitatively compare cased where we perform feature injection at all layers of the UNet vs only the decoder.}
\footnotesize
\begin{tabular}{lrrr}
\toprule
 & CLIP-Text $\uparrow$ & CLIP-Image $\uparrow$ & Pixel-MSE $\downarrow$ \\
\midrule  \midrule
all layers   & 0.2877 & 0.9766 &  200.70\\
decoder    & 0.2891 & 0.9767 &  228.62\\
 \bottomrule
 \end{tabular}
 \label{tab:quanti_feature}
\end{table}

\begin{figure}
\centering
    \includegraphics[width=\columnwidth]{figures/additionalComparisons.pdf}
    \caption{
     We compare our method to additional image based editing methods, Null-inversion~\cite{mokady2022null} and Prompt-to-Prompt~\cite{hertz2022prompt}. When such methods are applied naively in a per-frame manner, they yield inconsistent appearance across frames.
        }
    \label{fig:comp}
\end{figure}

\begin{figure*}[t!]
\centering
    \includegraphics[width=\textwidth]{figures/ablationLayerLow.pdf}
    \vspace*{-.2in}
    \caption{
     We show the effect of feature injection in different layers of the UNet. Injecting features into the decoder (layers 8-16) help to improve the consistency. We do not observe significant improvements when feature injection is performed for the bottleneck as well (layer 7).
        }
    \label{fig:feature}
\end{figure*}

\section{More Results and Discussion}
We compare our method to additional image-based editing methods that are applied per-frame. Specifically, we run the Stable Diffusion depth-to-image pipeline in conjuction with Null-inversion~\cite{mokady2022null} as well as the Prompt-to-Prompt~\cite{hertz2022prompt} editing pipeline as shown in Figure~\ref{fig:comp} and the supplementary webpage. In both cases the per-frame methods result in inconsistent results as expected. While Prompt2Prompt can ensure more localized edits, it cannot guarantee consistency across images.

% Since our method does not require finetuning, it can be adopted with other base generation models. In order to demonstrate this, we implement our method along with Prompt-to-Prompt as shown in Figure~\ref{}. While our method performs feature injection in the self attention layers and a guided latent update, Prompt2Prompt is used for altering the cross attention layers based on the editing prompt. This combination can perform localized edits effectively while ensuring consistency across the images.

Our method uses depth as a structural cue which helps to preserve the structure of the input video. Hence, it can be used in conjunction with style propagation methods as a post processing to further improve the results. Specifically, we provide the every 3rd frame generated by our method as a keyframe to the method of Jamriska et al.~\cite{Jamriska19-SIG} and propagate the style of these keyframes to the inbetween frames. We show that this results in better temporal stability while not suffering from the artifacts that are due to visibility changes when using only a single keyframe (please see the supplementary webpage). We note that, such a postprocessing cannot be applied to Tune-a-video~\cite{wu2022tuneavideo} since the edits do not preserve the original structure and hence using the optical flow obtained from the original video introduces artifacts.



\end{appendices}

\end{document}