\begin{algorithm}[h!t]
\caption{Height-based 2D to 3D projector}
\label{alg:algorithm}
\textbf{Parameters Definition}: \\
   $O$ and $X,Y,Z$: coordinate system, where $O_{virt.}$ has the same origin as $O_{cam}$ with Y-axis prependicular to the ground.  \\
%   $O_{cam}XYZ$:  camera coordinate system.\\
%   $O_{virt.}XYZ$: virtual coordinate system, its origin coincides with that of the camera coordinate system, and its Y-axis is perpendicular to the ground.\\
%   $O_{ego}XYZ$: ego coordinate system of the roadside unit.\\
%   ref plane: the reference plane parallel to the image plane, the distance from the image plane is 1.\\
    $T_{A}^{B}$: transformation matrix from coordinate A to B. \\
    % $T_{cam}^{virt.}$: the transformation matrix from the camera's coordinate system to the virtual coordinate system.\\
    % $T_{cam}^{ego}$: the transformation matrix from the virtual coordinate system to the ego coordinate system.\\
    $K$: the camera's intrinsic matrix. \\
    $H$: the distance from the origin of the virtual coordinate system to the ground.\\
    $h_i$: the height from the ground of i-th height bin.\\
    $P_{ref}^{B}$: the pixel $(u,v)$ projected from reference plane A in coordinate B \\
    % $P_{ref}^{cam}$: the pixel $(u, v)$ projection point on the reference plane in the camera coordinate.\\
    % $P_{ref}^{virt.}$: the pixel $(u, v)$ projection point on the reference plane in the virtual coordinate system.\\
    $P_i^{A}$: the pixel $(u, v)$ projection point on i-th height bin in the coordinate system A.\\
    % $P_i^{virt.}$: the pixel $(u, v)$ projection point on i-th height bin in the virtual coordinate system.\\
    % $P_i^{ego}$: the pixel $(u, v)$ projection point on i-th height bin in the ego coordinate system.\\
    % $B_{ref}^{virt.}$: the projection point of $P_{ref}^{virt.}$ on the Y-axis of the virtual coordinate system.\\
    % $C_{ref}^{virt.}$: the projection point of $P_i^{virt.}$ on the Y-axis of the virtual coordinate system.\\
\vspace{-0.2cm}
\hrule
\vspace{0.1cm}
\textbf{Input}: \\
   $F^{fused} = \left\{f_1^{fused}, ...,f_{\frac{H}{16} \times \frac{W}{16}}^{fused}\right\}$, $f_m^{fused} \in R^{C_H \times C_c}$\\
   $H$; $K$; $T_{cam}^{virt.}$; $T_{cam}^{ego}$\\
\textbf{Output}: \\
    $F_{wedge}$ is the 3D wedge-shaped volume features.\\
% \vspace{-0.2cm}
% \hline
% \vspace{0.1cm}
\textbf{Begin:}
\begin{algorithmic}[1] %[1] enables line numbers
\STATE $F_{wedge} = \left\{\right\}$
\FOR {$f_m^{fused}$ in $F^{fused}$}
 \STATE $u, v \gets m$
 \STATE $P_{ref}^{cam}=K^{-1} [u,v,1]^T$\\
 \STATE $P_{ref}^{virt.}= \left\{x_{ref}^{virt.},y_{ref}^{virt.},z_{ref}^{virt.}\right\} = T_{cam}^{virt.} P_{ref}^{cam}$
 \FOR {$i\gets 0$ to $C_H$}
    %  \STATE $P_i^{virt.}=\frac{H-h_i}{y_{ref}^{virt.}}P_{ref}^{cam}$\\
    \STATE $P_i^{virt.}=\frac{H-h_i}{y_{ref}^{virt.}}P_{ref}^{virt.}$\\
     \STATE $P_i^{ego}= T_{virt.}^{ego}P_i^{virt.}$\\
     \STATE $F_{wedge} \gets F_{wedge} \cup associate(P_i^{ego}, f_m^{fused}[i])$\\
  \ENDFOR
\ENDFOR
\STATE \textbf{return} $F_{wedge}$\\
\end{algorithmic}
\textbf{End}
\end{algorithm}

