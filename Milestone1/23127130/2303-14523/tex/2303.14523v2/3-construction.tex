\section{OpenSCV Construction Process}
\label{sec:mechanisms}

This section describes the process followed to build the OpenSCV taxonomy. Overall, it was an iterative and incremental process during which we kept general taxonomy quality properties (e.g., the ones discussed in Section \ref{sec:SectionII}) in perspective, while going through all the construction phases. As mentioned in Section \ref{sec:intro}, we use the general term \textit{vulnerability} to refer to vulnerabilities and also to software defects considered in the literature to be associated with high-security risks. Figure \ref{fig:taxonomyconstruction} overviews the process, which consists of the following phases:

\begin{enumerate}[i)]
    \item Vulnerability information collection;
    \item Vulnerability relationship with other classifications;
    \item Vulnerability characterization (defect type, qualifier, and code clip example);
    \item Structural and nomenclature consolidation;
    \item Dataset construction.
\end{enumerate}

Regarding the first phase (\textbf{vulnerability information collection}), visible on the top of Figure \ref{fig:taxonomyconstruction}), the main goal was to gather an up-to-date, heterogeneous, and non-curated list of vulnerabilities that affect smart contracts. This list allowed us to understand the naming and classification heterogeneity, which is essential to build an integrated vision and ultimately reach a meaningful taxonomy. Thus, we began by using Google Scholar to try to identify research work on \textit{smart contract vulnerability classification} (e.g., taxonomies and defect classification schemes). We then proceeded to search for research targeting \textit{smart contract vulnerability detection}, which resulted in the identification of 49 research papers, which are mostly materialized in tools and that we summarize in Table \ref{tab:tools}. The identified works refer to research carried out from October 2016 to January 2023 and resulted in the collection of 357 vulnerability definitions. It is worthwhile mentioning that the identified research also led us to the identification of community-oriented initiatives, namely SWC \cite{swc} and DASP \cite{DASP}, 
%SIGP \cite{SIGP2018}, SMARTDEC \cite{SmartDec2018}, of which
%SWC and DASP recurrently 
which recurrently appear in the literature. There are other initiatives, such as SIGP \cite{SIGP2018} or  SMARTDEC \cite{SmartDec2018}, which seem to have less expression.

\input{tables/table-tools.tex}
 
\begin{figure}[ht!]
    \centering
    \includegraphics[scale=0.8]{img/figure1Construction.pdf}
    \caption{Taxonomy construction process.}
    \label{fig:taxonomyconstruction}
\end{figure}

In the second phase, we analyzed the \textbf{vulnerability relationship with other classifications} by going through each of the identified vulnerabilities and mapping them to popular smart contract  vulnerability classification schemes, namely SWC \cite{swc} and DASP \cite{nccgroup_decentralized_2021}. We also selected, from the state of the art in vulnerability classification, what is, to the best of our knowledge, the currently largest and most recent vulnerability classification scheme proposed by \cite{Rameder2022}. Then we resorted to a broader security-related classification, namely the Common Weakness Enumeration (CWE) \cite{CWECommunity2009}, which provides us with a non-domain-specific view of each defect. Although the action consists of simply mapping vulnerabilities, it actually contributes to the characterization of each vulnerability. This may be useful for later taxonomy consolidation purposes (e.g., by merging defects that are the same but are represented with different names). Obviously, mapping the identified vulnerabilities to existing classifications also allow us to understand the exact coverage of existing classifications or disparities against the current state of the art or practice. 

The third phase – \textbf{vulnerability characterization (defect type, qualifier, and code clip example)} – has the direct goal of detailing the vulnerability according to its nature and also by example, which allows for clarity of the explanation and may help in cases where the vulnerability description and remaining attributes are inadvertently left unclear. Regarding (\textit{vulnerability nature}), we resort to the Orthogonal Defect Classification, namely to the 'defect type' attribute, which generally characterizes the type of defect and can correspond to Assignment/Initialization, Checking, Algorithm/Method, Function/Class/Object, Interface/O-O Messages, Timing/Serialization, Relationship \cite{ODC}. We also make use of the 'defect qualifier' attribute, which characterizes the state of the implementation before a correction, namely if the defect refers to missing, wrong, extraneous code. We also use the ODC extensions, as proposed in \cite{odcExtension}, for defects that relate with other aspects (e.g.,defect types related with the process followed during compilation, or management of libraries). For each identified defect, we also extracted a code excerpt (when made available by the authors) that could represent the issue, as a way to reduce or eliminate any possible ambiguities that could still be present. For the cases where no defect was made available and the description allowed to build one, we created a Solidity code example as a way of further illustrating the defect. Thus, all of the identified vulnerabilities in OpenSCV are associated with a code example.

The fourth phase \textbf{naming and structural consolidation}, consists of two steps: the attribution of names to the vulnerabilities, and; ii) their organization in a tree structure. In the first step, we merged defects that referred to the same issue (despite being named differently by different authors. This required going through the names and descriptions of the different defects and, whenever provided by the authors, also analyzing the corresponding vulnerable code to understand if it referred to the same defect or not. The additional characterization (e.g., ODC) helped in such grouping. Obviously, during this step several adjustments to the characterization of the defects were made, as well as corrections to the defects' relationships with other classifications. Figure \ref{fig:code-example} shows an example of the same vulnerability named differently by different authors. In \cite{Brent2018} named it  \textit{Unsecured Balance} (Figure \ref{fig:code-example}.a)) and it basically consists of a misnamed constructor while \cite{zhang_soliditycheck_2019} named it \textit{Missing constructor} (Figure \ref{fig:code-example}.b)), where we observe that it is actually a wrong name used during the definition of the constructor.  So, besides the names we actually see that the definitions provided may not be really accurate sometimes. In this particular case, and as an example, we named this defect as "Wrong Constructor Name". Thus, during this step, we defined an initial name for each of the defects, based on the name given by the authors of the respective paper, on the names presented in the corresponding related classifications (i.e., DASP, SWC, CWE), and on the ODC classification.

%[frame=lines,numbers=left,label=a),framesep=3mm,commandchars=\\\{\}]

\begin{figure*}
\centering
\vspace{0.5cm}
\begin{minipage}{0.5\linewidth}
\textbf{a)}
\begin{verbatim}
contract TaxMan \{
   address private owner;
   ...
   function TaxOffice() {
       owner = msg.sender;
    }
    function collectTaxes() public {
        require(msg.sender == owner);
        owner.send(tax);}
}
\end{verbatim}
\end{minipage}\hfill
\begin{minipage}{0.5\linewidth}
\textbf{b)}
\begin{verbatim}
contract Foo 
{
   address public owner;
   ...
   function foo() public
   {
      owner = msg.sender;
      ...
   }
}
\end{verbatim}
\end{minipage}
\caption{The same vulnerability named and also described differently in: a) \cite{Brent2018}; b)  \cite{zhang_soliditycheck_2019} }
\label{fig:code-example}
\end{figure*}

In the second step of the fourth phase (i.e., structural consolidation), we defined a hierarchical structure for the taxonomy based on the merged vulnerabilities and preliminary naming. During this step, names were further adjusted for clarity and also to better fit in the categories being created. The final result is visible in Figure \ref{fig:taxonomytree1} and Figure \ref{fig:taxonomytree2}. As we can see in both Figures, OpenSCV consists of three levels. The first one (at the left-hand side of both Figure \ref{fig:taxonomytree1} and Figure \ref{fig:taxonomytree2}) contains the higher level categories, the intermediate one is hybrid and contains groups (i.e., subcategories) of vulnerabilities as well as a few isolated vulnerabilities. All items at the last level (at the right-hand side of Figure \ref{fig:taxonomytree1} and Figure \ref{fig:taxonomytree2}) represent vulnerabilities. Each vulnerability identified in the tree is labeled with several symbols that characterize it in terms of ODC defect type and ODC qualifier.


\begin{figure*}[h!]
    \centering
    \includegraphics[scale=0.5]{img/figure3a.pdf}
    \caption{Taxonomy of Smart Contract Vulnerabilities (Part 1 of 2)}
    \label{fig:taxonomytree1}
\end{figure*}


\begin{figure*}[h!]
    \centering
    \includegraphics[scale=0.5]{img/figure3b.pdf}
    \caption{Taxonomy of Smart Contracts' Vulnerabilities (Part 2 of 2)}
    \label{fig:taxonomytree2}
\end{figure*}

To build the taxonomy structure, we followed a bottom-up process and began by grouping the defects of similar nature, which allowed us to create a set of categories, such as \textit{reentrancy}, \textit{useless code}, or \textit{improper type usage}, for example. Certain defects could not really be grouped, such as \textit{Use of Malicious Libraries} or \textit{Inadequate Data Representation}, although at the same time many of them sounded like higher-level defects (i.e., siblings were expected). Thus, for the time being, we opted not to keep these vulnerabilities at the bottom layer (e.g., by creating a subcategory with a single vulnerability). After this, the same procedure was applied at this current intermediate level to reach the definition of the higher-level categories.

The whole taxonomy construction process was iterative and required the involvement of 2 Experienced Researchers and 1 Early Stage Researcher. During the process, several adjustments to names were performed for further clarity and consistency across all axis of the taxonomy.
Obviously, this is a continuous effort, which is now open to the community participation via our github repository \cite{openscvGithub}, and the current shape of the taxonomy may evolve to incorporate further vulnerabilities. It is worthwhile mentioning that, during this process, we observed that the integration of new works on vulnerability detection was a major contributor to the definition of the taxonomy, and this is the reason why we intend to be continuously integrating new works on vulnerability detection and mapping their information into new versions of our taxonomy, possibly making naming and structural adjustments as a consequence of such integration. Currently, our taxonomy lists 76 vulnerabilities and is available at \cite{openscvSite}, where all the mapped works are identified, as well as the vulnerability names used by those works. We allow for easy integration of new works, and the infrastructure is not only ready to support naming and structural changes, as well as corrections to possible errors.

The fifth phase refers to the \textbf{dataset constrution}, where we aimed at obtaining multiple real examples of smart contracts that match the defects present in our taxonomy. At the time of writing, the goal is simply to have a preliminary version of the dataset by gathering multiple real examples of contracts (i.e., a vulnerable contract and the corresponding correction) per each of the different defects present in the taxonomy. Indeed, each defect may be present in different forms (i.e., different implementations), and vulnerability detection tools may be able to detect just some of the forms. For this collection process, we directly used examples from the collected papers themselves (whenever complete contracts were made available). In some cases, SWC had usable examples also. All collected contracts present in our dataset pass through the compilation phase. Our intention is to provide an initial basis for researchers to use and, at the same time, provide the possibility of further examples (ideally, different forms of the same vulnerability) being added to the dataset.



 

