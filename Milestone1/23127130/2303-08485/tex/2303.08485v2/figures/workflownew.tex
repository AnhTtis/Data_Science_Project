\definecolor{dblue}{RGB}{55,126,184}
\definecolor{dorange}{RGB}{255,176,0}

\begin{figure}[ht]
    \centering
\tikzset{%
  >={Latex[width=2mm,length=2mm]},
  % Specifications for style of nodes:
    base/.style = {rectangle, draw=black,
                   minimum width=2.5cm, minimum height=1cm,
                   text centered, solid},
    process/.style = {base, rounded corners, minimum width=2.5cm, solid},
    choice/.style = {base,  minimum width=2.3cm, fill=dblue!45, minimum height=1.2cm}
}
\resizebox{\textwidth}{!}{
\begin{tikzpicture}[node distance=4cm, ->, line width=0.8, dotted, auto,
    every node/.style={fill=white, font=\sffamily}, align=center]

  % MAIN PROCESS
  % nodes
  \node (problem)   [process] {1. Problem \\ understanding};      
  \node (data)      [process, right of = problem, xshift=-0.15cm] {2. Data understanding \\ and preparation};
  \node (model)     [process, right of = data, xshift=0.95cm] {3. Modeling};
  \node (eval)      [process, right of = model, xshift=0.3cm] {4. Evaluation};
  \node (deploy)    [process, right of = eval, xshift=-0.7cm] {5. Deployment};
  % connections
  \draw[<->]             (problem) -- (data);
  \draw[<->]             (data) -- (model);
  \draw[<->]             (model) -- (eval);
  \draw[<->]             (eval) -- (deploy);

  % SYSTEM CONFIGURATION
  \node (config) [above of = model, xshift=0cm, yshift=-2.0cm] {
    \textbf{System Configuration} \\
    search space \& strategy, \\
    optimization formulation, \\
    evaluation protocol
    };
  \draw[thick,dashed] ($(config.north west)+(-0.2,0.1)$)  rectangle ($(config.south east)+(0.2,-0.1)$);


  % USER INTERACTION
  % user
  \node (user) [circle, draw=black, solid, below of = model, yshift=1.75cm] {user};
  % user input
  \draw[->, solid] (user) -| ($(user)+(-0.8,0)$) -- ($(model.south)+(-0.8,0)$);
  \node (input) [left of = user, xshift=2.4cm, yshift =0.6cm ] {
    data, \\
    metrics \\
  };
  % user output
  \draw[<-, solid] (user) -| ($(user)+(0.8,0)$) -- ($(model.south)+(0.8,0)$);
  \node (output) [right of = user, xshift=-2.4cm, yshift=0.9cm ] {model};
  % user interaction
  \node (interact) [below of = user, xshift=0cm, yshift=3.1cm] {\textbf{User Input \& Interaction}};
  \draw[thick,dashed] ($(interact.north west)+(-0.1,2.1)$) rectangle ($(interact.south east)+(0.1,-0.1)$);

  % AUTOML SCOPE
  \node (scope) [above of = model, xshift=0cm, yshift=-0.3cm] {\textbf{AutoML Scope}};
  \draw[thick,dashed] ($(scope.north west)+(-1.2,0.1)$) rectangle ($(scope.south east)+(1.2,-7.05)$);
  
  \node (review)    [choice, below of = problem, yshift=-1cm] {Ethical Review \& \\ System (Re)design};
  \node (ident)     [choice, below of = data, yshift=-1cm] {Bias Identification \& \\ Mitigation};
  \node (mitig)     [choice, below of = model, yshift=-1cm] {Fairness-aware\\ Machine Learning};
  \node (assess)  [choice, below of = eval, yshift=-1cm, xshift=1.8cm] {Continuous \\ Fairness Assessment};
  \draw[solid,->]             (review) -- (problem);
  \draw[solid,->]             (ident) -- (data);
  \draw[solid,->]             (mitig) -- ($(model)-(0,3.7)$);
  \draw[solid,->]             (assess) -- (eval);
  \draw[solid,->]             (assess) -- (deploy);
  \node (stake) [choice, below of = model, xshift=0cm, yshift = -3cm] {Stakeholder Involvement};
  \draw[solid,->]             (stake) -| (review);
  \draw[solid,->]             (stake) -| (ident);
  \draw[solid,->]             (stake) -| (assess);
  \draw[solid,->]             (stake.north) -| (mitig);
  
  %\draw[-]             (problem.north) -- +(0,4);
  %\draw[-]             (data.north) -- +(0,4);
  \draw[-]             (eval.north) -- +(0,4);
  \draw[-]             (deploy.north) -- +(0,4);
  \draw[->]             (deploy.north) +(0,4) -| (problem.north);
  %\draw[-]             (model.north) +(0,3.6) -- +(0,4);
 %\draw[-latex, ->]  (eval.north) to[bend right=75] (problem.north);
  \end{tikzpicture}
 }
    \caption{Example of an ML workflow adapted from the CRISP-DM~\protect\shortcite{shearer-jdw00a} process. % model for data mining projects.
     Developing ML systems is an iterative process (dotted arrows) that can require frequently revisiting decisions made in previous stages. Most existing fairness-aware AutoML methods and systems address fairness analogous to fairness-aware ML techniques: the problem is formulated as an optimization task under a fairness objective or constraint. However, many important design choices are made outside of the \textit{modeling} stage which is typically the part of the workflow that is tackled by AutoML systems. Taking fairness into account adds additional considerations (in blue) to every step of the ML workflow. }
    \label{fig:pipeline}
\end{figure}