\subsection{Reentrancy in the wild}

\begin{table}[t]
	\centering
	\caption{Real Reentrancy attacks on Ethereum}
	\resizebox{1.0\linewidth}{!}{
	\begin{tabular}{p{10pt}<{\centering}|p{25pt} <{\centering}|p{20pt}<{\centering}|p{35pt}<{\centering}|p{120pt}}
		\hline
		\textbf{No.} & \textbf{Time} & \textbf{Lost} & \textbf{Attacked Projects} & \textbf{Description} \\
		\hline
		1 & 2020/04 & \$3.5M& Uniswap &  A vulnerability when adopting ERC777 tokens\\
		\hline
		2 & 2020/04 & \$25M& Lendf.Me & A vulnerability when adopting ERC777 tokens \\
		\hline
		3 & 2020/11 & \$2M& Akropolis & A combination of reentrancy attack and flash loan attack to exploit the saving pools  \\
		\hline
		4 & 2020/11 & \$8M& OUSD & A combination of reentrancy attack and flash loan attack by utilizing mint logic flaw in its contracts\\
		\hline
		5 & 2021/07 & \$0.1M& DeFiPie & A combination of reentrancy attack and flash loan attack to withdraw almost all available liquidity from the protocol \\
		\hline
		6 & 2021/08 & \$18M& Cream Finance & A combination of reentrancy attack and flash loan attack to exploit a vulnerability in AMP token contract\\
		\hline
		7 & 2022/03 & \$1M& Bacon Protocol & A logic error in its lend() routine to allow hacker to get more lending credits\\
		\hline
		8 & 2022/03 & \$0.1M& Revest Finance & Bad design in the minting-related functions â€” do not strictly follow the check-validation-interaction model when transferring the ERC1155 token.
		
		  \\
		\hline
	\end{tabular}}
	\label{fig:real_reentrancy}
\end{table}

With the development of the smart contract ecosystem, reentrancy vulnerability has become much rarer in recent years. First, dozens of tools are developed to detect reentrancy. For example, the Ethereum's official IDE (Remix) warns of risk when the check-effects-interaction pattern is detected in a smart contract. In addition, as one of the most famous attacks on Ethereum, the DAO attack (the first smart contract reentrancy attack) has been widely introduced in smart contract tutorials, e.g., books, blogs, and videos. Thus, developers are well educated in avoiding reentrancy caused by \textit{call.value().}

Unfortunately, most academic works still focus on reentrancy caused by \textit{call.value()}, which might be the wrong direction based on today's Ethereum ecosystem. Based on the SlowMist hacked repository\footnote{https://hacked.slowmist.io/en/}, only eight real reentrancy attacks happened in Ethereum from Apr, 2020 to Apr, 2022, as shown in Table~\ref{fig:real_reentrancy}. It is not difficult to find that these real reentrancy attacks are much more complicated compared with the traditional \textit{call.value()} related reentrancy issues detected by most tools. These eight attacks could be classified into three groups. First, the No. 1, 2, and 8 reentrancy attacks are caused by bad designs when using ERC tokens~\cite{norvill2019standardising}, e.g., ERC777 and ERC1155. The bad design provides opportunities for hackers to transfer the tokens in these contracts. Second, the No. 3-6 reentrancy attacks should be combined with a flash loan\footnote{Flash loans allow users to borrow and settle loans instantaneously in a single transaction without providing any collateral.}, as this kind of reentrancy attack usually needs a large amount of capital to affect some key values of smart contracts. For example, buying almost all the tokens in a liquidity pool might lead to a logic error in contracts. Third, the No. 7 reentrancy attack was led by a logic error in the contract. In this case, attackers could obtain more lending credits than they paid.

The aforementioned reentrancy attacks are very complicated. Detecting them needs a high level of professional skill and a deep understanding of reentrancy attacks, rather than using a simple detection pattern. Evidence can be found in the case of the Akropolis smart contract (No. 3 attack), which was audited by two professional smart contract audit teams. However, neither of them found the reentrancy issues. This shows that some real reentrancy attacks are much more complicated and need more advanced methods to be detected. 

\subsection{IDE Warning of Reentrancy}
With the development of the smart contract language, the Ethereum's official IDE, i.e., Remix, has an integrated static analyzer to check for vulnerabilities, bad development practices, etc. The analyzer provides warnings for potential reentrancy vulnerability if the check-effects-interaction pattern is detected in the smart contract. A natural question is whether the detected true positive contracts could be warned when developing them with Remix. We test all of the 34 true positives using Remix, and find that 20 (i.e., 58.8\%)  of them are warned to have a potential reentrancy vulnerability. 





