\section{Methodology}
\label{sec:method}
 Our methodology is illustrated in Figure~\ref{fig:methodology}. In keeping with the routine of daily life, blockchain {transaction} networks are frequently examined on a 24-hour  basis~\citep{casale2021networks,chen2020understanding}. We divide a blockchain {transaction} network into daily intervals, using a reference time zone to create a set of snapshot graphs. In a snapshot graph of a blockchain {transaction} network, a node represents a {participant (traders, exchanges, liquidity pools, etc.)}, whereas a {directed} edge denotes a financial transaction {involving the transfer of assets from one participant to the other}. Next, we define {\textsf InnerCore}, {\textsf InnerCore} expansion, and {\textsf InnerCore} decay on the snapshot graphs. {\textsf InnerCore} helps us eliminate unimportant edges and nodes (e.g.,  addresses trading small amounts).  We then compute daily temporal {\textsf InnerCore} expansion and decay measures to identify significant days and trends for further investigation (\S\ref{sec:methdecayexpansion}, \S\ref{sec:methpatterns}). Subsequently, centered-motif analysis and {\textsf NF-IAF} score percentile ranking is employed to capture anomalous addresses of market manipulator traders (\S\ref{sec:methmotif}). 
%
\begin{figure}
    \centering \includegraphics[width=1\linewidth]{figs/methodology.png}
    \vspace{-5mm}
    \caption{\small Flowchart of our methodology for identification of significant days and subsequent anomalous addresses.
    }
    \label{fig:methodology}
    % \vspace{-4mm}
\end{figure}
%

%
\subsection{InnerCore of a Graph}
\label{sec:methinnercore}
{Consider the weighted, directed multi-graph defined in Section~\ref{sec:prob}.} We define data depth of a node $v \in \V_t$ as the degree of ``outlyingness" of the node properties in relation to the origin $\mathbf{0}$.  We use In-Degree, Out-Degree, In-Strength, and Out-Strength as node properties (defined in Table \ref{tab:node_property_functions}) to compute the {\textsf InnerCore} of a snapshot graph (\S\ref{sec:methinnercore}), as these node features can be defined easily for a weighted, directed, multi-graph.  

We define the {\textsf InnerCore} of $G$ as the set of nodes $\V^{inner}$ whose data depth, relative to themselves, is less than an $\epsilon$ value. We set $\epsilon$ to a small value, and iteratively recompute the depth of each node as we remove nodes whose data depth is greater than $\epsilon$ in each iteration. This process continues until no more nodes can be removed. The resulting set of nodes is the {\textsf InnerCore}. %of the graph. 
% The {\textsf InnerCore} computation is detailed in Algorithm~\ref{alg:innercore} in the Appendix.%

\SetKwInput{KwInput}{Input}
\SetKwInput{KwOutput}{Output}
\SetKwRepeat{Do}{do}{while}

\begin{algorithm}[tb!]
\footnotesize
\KwInput{Directed, weighted, multigraph $G(V,E,w)$,\\
Set of node property functions $p_1, ..., p_n \in P$,\\%,
Data depth threshold $\epsilon$}
\KwOutput{InnerCore $V^{inner}$}
\tcp{Compute feature matrix}
$F = [f_1, ..., f_n] = \forall p_i \in P: f_i = p_i(v, G), \forall v \in V$\label{alg:line1}\; %\tcp{initial feature matrix}\label{alg:line1}
$\Sigma_F^{-1}$ = cov$(F)^{-1}$; \tcp{compute only once}\label{alg:line2}
\tcp{Compute initial depth values}
$z = [z_1, ..., z_n] = \forall v_i \in V: z_i = [1+(F_{i,*})'\Sigma^{-1}_F(F_{i,*})]^{-1}$\label{alg:line3}\;
 \Do{$\exists z_i: (z_i \geq \epsilon) \wedge (v_i \in V)$}{
   \ForEach{$z_i \geq \epsilon$}{
   $\V = \V \setminus \{v_i\}$\label{alg:line14}\;
   }
   \tcp{recompute node properties}
   $F = \forall p_i \in P: p_i(v, G), \forall v \in V$\label{alg:line16}\;
   \tcp{recompute depth}
   $z_i = [1+(F_{i,*})'\Sigma^{-1}_F(F_{i,*})]^{-1}, \forall v_i \in V$\label{alg:line17}\;
 }
\KwRet{$\V$ \tcp{as InnerCore $V^{inner}$}}\label{alg:line21}
\caption{\small{\textsf InnerCore} Discovery}
\label{alg:innercore}
\end{algorithm}



Algorithm~\ref{alg:innercore} computes a feature matrix $F$ based on each node property function in line~\ref{alg:line1}. {
In particular, edge weight is used for computing Strength, In-Strength, and Out-Strength node property functions, where the numerical values of all incident edges to a node irrespective of direction, inbound to a node, and outbound from a node, respectively, are aggregated. For example, if we have a network $A \xrightarrow[]{\text{10}} B \xleftarrow[]{\text{5}} C$  , the In-Strength node property function will return 15 for node B. 
%Each selected node property function sums its corresponding node attribute and generates a separate column in the matrix with the summation results for each node. For instance, from Table~\ref{tab:node_property_functions}, Strength, In-Strength, and Out-Strength node property functions sums the weights of all incident edges to a node irrespective of direction, inbound to an node, and outbound from a node, respectively.
} The feature matrix $F$ is used to compute the inverse covariance matrix $\Sigma_F$ in line~\ref{alg:line2}, which will be utilized for future data depth calculations. The initial depth of each node is determined using the Mahalanobis depth with respect to the origin at line~\ref{alg:line3}. Nodes with a depth greater than or equal to input $\epsilon$ are removed from the node-set $\V$ at line~\ref{alg:line14}. Once one batch of node removals has been performed, the feature matrix and depth values are re-evaluated in lines~\ref{alg:line16}--\ref{alg:line17}. If any remaining nodes still have a depth greater than or equal to $\epsilon$, the next batch is initiated at the same $\epsilon$ level. When there are no nodes left with a depth larger than $\epsilon$, the algorithm is considered complete, and the remaining nodes in $\V$ are returned as the {\textsf InnerCore}.

% \begin{table}
% \fontsize{9}{12}\selectfont
% %\vspace{-1mm}
% %\centering
% \footnotesize
% \caption{\small Example node property functions.}
% \label{tab:node_property_functions}
% \vspace{3mm}
% \begin{tabular}{ll}
% %\toprule
% Function & Definition\\
% \midrule
% $N(v)$ & neighbors of $v$ \\
% $N_{out}(v)$ & neighbors reachable with outgoing edges from $v$ \\
% $N_{in}(v)$ & neighbors reachable with incoming edges to $v$ \\
% $deg(v)$ & edges to/from $v$ (Degree) \\
% $deg_{out}(v)$ & outgoing edges from $v$ (Out-Degree) \\
% $deg_{in}(v)$ & incoming edges to $v$ (In-Degree) \\
% $S(v)$ & sum of edge weights incident to a node (Strength)\\
% $S_{out}(v)$ & sum of outgoing edge weights (Out-Strength)\\
% $S_{in}(v)$ & sum of incoming edge weights (In-Strength)\\
% % $\bigcirc(u, l)$ & undirected cycles of length $l$ that $u$ is part of \\
% % $\circlearrowright(u, l)$ & directed cycles of length $l$ that $u$ is part of \\
% % $t(u, l)$ & length $l$ timeframes that $u$ has edges in \\
% %\bottomrule
% \end{tabular}
% % \vspace{-3mm}
% \end{table}

\begin{table}
\fontsize{8}{10}\selectfont
\caption{\small Example node property functions.}
\label{tab:node_property_functions}
\begin{tabular}{ll}
\toprule
Function & Definition \\
\midrule
$N(v)$ & neighbors of $v$ \\
$N_{out}(v)$ & neighbors reachable with outgoing edges from $v$ \\
$N_{in}(v)$ & neighbors reachable with incoming edges to $v$ \\
$deg(v)$ & edges to/from $v$ (Degree) \\
$deg_{out}(v)$ & outgoing edges from $v$ (Out-Degree) \\
$deg_{in}(v)$ & incoming edges to $v$ (In-Degree) \\
$S(v)$ & sum of edge weights incident to a node (Strength)\\
$S_{out}(v)$ & sum of outgoing edge weights (Out-Strength)\\
$S_{in}(v)$ & sum of incoming edge weights (In-Strength)\\
\bottomrule
\end{tabular}
\end{table}



\medskip\noindent\textbf{InnerCore vs. Alphacore.} {\textsf InnerCore} discovery of a graph $G$ does not require a complete decomposition of all graph cores by varying $\epsilon$, as it is done in {\textsf AlphaCore}~\citep{victor2021alphacore}. Instead, we set an $\epsilon$ value (e.g., $\epsilon=0.1$) just once, and then use the value to iteratively prune nodes until all remaining nodes, relative to themselves, satisfy a data depth less than $\epsilon$. The  {\textsf InnerCore} approach is also different from graph-$k$-core decomposition~\citep{BatageljZ11}, where the outer cores are computed first before the higher $k$-core can be determined. As a result, {\textsf InnerCore} discovery is quite scalable and can be applied to very large graphs. Our experiments in \S\ref{sec:exp} reveal that {\textsf InnerCore} discovery has a running time that is only one-tenth of that required for {\textsf AlphaCore} decomposition.

\medskip\noindent\textbf{Scalability}. Computing the {\textsf InnerCore} requires performing Cholesky decomposition on the covariance matrix at line~\ref{alg:line2} once, which has time complexity $O(d^3)$ for $d$ features. Node features need to be recomputed at each iteration of the while loop with a cost of $O(|\V|\times deg)$, where $deg$ is the average degree in the graph. There are at most $|\V|$ iterations (number of nodes). In the worst case, the total time complexity is $O(d^3 + |\V|\times deg \times |\V|)$. However, since the neighborhood of a node can be sparse, the value of $deg$ is small. Moreover, since multiple nodes are removed in batches, the number of iterations is much smaller than $|\V|$. For example, in a network with approximately 480,000 nodes and 1 million edges (\S\ref{sec:datasets}), only 4 iterations on average are needed for an $\epsilon$ = 0.1.

\subsection{InnerCore Expansion and Decay}
\label{sec:methdecayexpansion}

By analyzing how a temporal graph expands and shrinks in relation to %the 
entry and exit of nodes on a daily basis, we %can 
gain valuable insights into market sentiment. %Specifically, 
We define the influential nodes of a graph as its {\textsf InnerCore} nodes (i.e., $\V_t^{inner}$). %Next, we investigate how the {\textsf InnerCore} of a network expands and decays on a given day compared to previous days. 
We propose two measures to quantify the activity of influential nodes in the network: expansion and decay. {\em Expansion} counts the number of new influential nodes on day $t$ that were not influential in the preceding $i$ days, while {\em decay} quantifies the number of influential nodes from the previous $i$ days that are not present in the influential nodes of day $t$. {The goals of measuring {\textsf InnerCore} expansion and decay are two-fold: {\bf (1)} Correctly accentuate anomalous days to motivate further analysis using motifs and {\textsf NF-IAF} scores ranking; and {\bf (2)} accurately depict trends in the market to provide a sentiment indicator and explain mood. {\textsf InnerCore}, based on its output, isolates the key participants in the daily transaction network snapshot, whereas the expansion and decay measures provide a unique perspective on market trends and sentiment from the activity of key participants. As prefaced in \S\ref{sec:prob}, our {\textsf InnerCore} methodology focuses on detection rather than prediction, acknowledging the inherent unpredictability of malicious transactions originating from the external world.}

To this end, we first discover $\V_t^{inner}$ as the set of nodes in the {\textsf InnerCore} of the snapshot graph at timestamp $t$, and define $\V_{\cup(t-i)}^{inner}=\bigcup_i\V_{t-i}^{inner}$ as the union set of nodes in the {\textsf InnerCore} of snapshot graphs from timestamps $\{t-1,t-2,\ldots, t-i\}$ for $i\geq 1$. Next, we define the expansion and decay measures at timestamp $t$. %as follows:
%
 \begin{definition}[Expansion]
$\mathbb{E}_t=\left|\V^{inner}_t \setminus \V^{inner}_{\cup(t-i)}\right|.$
 \end{definition}

The expansion values have a range $[0,\infty)$, where a value $\geq$ 1 indicates the addition of new influential nodes in the {\textsf InnerCore}. 
\begin{definition}[Decay]
$\mathbb{D}_t=\left|\V^{inner}_{\cup(t-i)} \setminus \V^{inner}_{t}\right|.$
\end{definition}
The decay values have a range $[0,\infty)$; a value of 0 indicates that all {\textsf InnerCore} members from $\{t-1,t-2,\ldots, t-i\}$ are present in $t$. 

\begin{exam} [Expansion and Decay]
Suppose we have a temporal graph that produces two daily snapshot graphs at days $t$ and $t+1$. On day $t$, the InnerCore is composed of five nodes: $\V^{inner}_t=\{v_1, v_2, v_3, v_4, v_5\}$. On day $t+1$, the InnerCore has expanded to include eight nodes: $\V^{inner}_{t+1}=\{v_3, v_4, v_5, v_6, v_7, v_8, v_9, v_{10}\}$.

If we set $i=1$, we can calculate the expansion and decay measures for the day $t+1$ based on the previous day. In this case, the union of the InnerCores is $\V^{inner}_{\cup(t-i)}=\{v_1, v_2, v_3, v_4, v_5\}$. Therefore, we have:

The expansion measure $\mathbb{E}_{t+1}$ is equal to $\left|\{v_6, v_7, v_8, v_9, v_{10}\}\right|=5$. %which yields a value of 5.  
The decay measure $\mathbb{D}_{t+1}$ is equal to $\left|\{v_1,v_2\}\right|=2$. %which yields a value of 2.
\end{exam}

A substantial expansion measure observed on a particular day often indicates the presence of excessive buy or sell behavior from new traders entering the daily {\textsf InnerCore}.  Such behavior may arise either from a large group of traders acting in unison or from a selected group of traders whose significant transactions prompt other traders to follow a similar pattern. Consequently, heavy-buy or heavy-sell behaviors coincide on days characterized by considerable influxes of new traders entering the daily {\textsf InnerCore}. On the other hand, a substantial decay measure observed on a particular day often is reactionary in response to a significant change in the state of a currency caused by the transactions of key traders in the preceding days. Therefore, we suggest that days with significant expansion measures, followed by days with significant decay measures, as anomalies and prime candidates for detecting market manipulator addresses.
%
%
\begin{figure}
    \centering \includegraphics[width=1\linewidth]{figs/behavior.png}
    \vspace{-5mm}
    \caption{\small In a temporal graph (e.g., transaction network), changes in decay and expansion
    reflect varying levels of hope, despair, uncertainty, and faith in the asset being represented.
    }
    \label{fig:behavior}
\end{figure}
%

\spara{Parameters in Experimental Setup.}
In the context of {\textsf InnerCore} expansion and decay,
a greater $i$ (i.e., the history parameter from \S3.2) produces an averaging effect, coupled with the tendency to lower expansion and inflate decay.  Setting a specific $i$ value depends on the application. %in general, higher $i$ reduces fluctuations between expansion and decay of each day.  
%In our experiments, 
We use $i$ = 1 to improve the accentuation of expansion and decay in the {\textsf InnerCore} to better depict the shift in market sentiment during the days of significant events. %in our case studies.}  

In {\textsf InnerCore} decomposition, depth values range between $(0, 1]$; nodes with high property values (e.g., many transactions, higher transacted amounts) tend to have low depth, while nodes with low property values tend to have high depth~\citep{victor2021alphacore}. With data depth threshold $\epsilon=1$, all nodes will be returned as {\textsf InnerCore}  members; while for $\epsilon=0$, the empty set will be returned.  
Setting an appropriate $\epsilon$ depends on the desired size of the {\textsf InnerCore} returned specific to an application.  In our experiments, we set $\epsilon=0.1$ to ensure that the average number of nodes in each daily {\textsf InnerCore} is above 150.


\subsection{Behavioral Patterns in Temporal Networks}
\label{sec:methpatterns}
%
Temporal networks, including blockchain networks, exhibit continuous evolution and can experience notable shifts in user sentiment and node activity triggered by technological advancements and significant events, sometimes occurring within fewer days.

By utilizing expansion and decay, we have identified four behavioral patterns that {provide sentiment indication} and capture node activity. These patterns serve as the foundation for network analysis in our experiments detailed in \S\ref{sec:exp}. Figure~\ref{fig:behavior} illustrates the expansion and decay values for each pattern. To gain a better understanding of these patterns, particularly when examining the temporal graph of a financial network such as the Ethereum transaction network, it is helpful to consider the network's underlying transaction semantics.
%
\begin{itemize}[leftmargin=.1in]
    \item The {\em Despair} pattern is characterized by a reduction in expansion and an increase in decay, implying that previously influential nodes are leaving the network, while the {\textsf InnerCore} is shrinking due to a decrease in the number of new influential nodes.
    \item The {\em Uncertainty} pattern is distinguished by an increase in both expansion and decay. This is primarily due to the influx of many new traders into the network who do not remain active for a significant period of time.
    \item The {\em Hope} pattern is characterized by a reduction in decay and an increase in expansion, indicating the presence of many newcomers to the network who remain active within the network.
    \item The {\em Faith} pattern is identified by a decrease in both decay and expansion, which initially suggests a state of confusion. On the positive side, nodes, such as traders, may have faith in the network's ability to withstand a catastrophic event, as demonstrated in the LunaTerra case in our experimental results. On the negative side, it may indicate a sense of hopelessness as traders may hold onto their assets without engaging in transactions or exiting the system altogether.
\end{itemize}
%
\subsection{Motif Analysis in InnerCore}
\label{sec:methmotif}
% 
Our rationale behind using motif analysis in conjunction with {\textsf InnerCore} is to accurately discover larger and potentially influential players in the daily network, referred to as market manipulators.  The structure of a motif defines a behavior of interest and its existence in a network indicates the presence of such behavior.  
%
\begin{figure}
    \centering \includegraphics[width=1\linewidth]{figs/all_motifs.png}
    \vspace{-3mm}
    \caption{\small Five 3-node motifs exhibiting buy and sell behaviors.  Nodes labeled C denote the center where a center with an in-degree = 2 indicates buy behavior and an out-degree = 2 indicates sell behavior. Out of the 16 connected 3-node motifs (see Figure 1B in \citet{milo2002network}), only the five given above (motifs 1, 4, 5, 6, and 11) contain a center node. 
    \label{fig:motifs}}
    % \vspace{-5.5mm}
\end{figure}

Motif analysis has been a popular tool to identify subgraph patterns and the addresses involved in them \citep{LeeKGOL20,bailey2009meme,zhang2012extracting,paranjape2017motifs,milo2002network}. We have decided to use three-node motifs since they can be identified more quickly than higher-order motifs, while still capturing the direct buying or selling behavior between addresses.  Our decision is consistent with previous research on temporal motifs~\citep{paranjape2017motifs}.  

\medskip
\noindent\textbf{Scalability}. The fastest triangular motif discovery algorithm has time complexity $O(|\V^{inner}|^\omega)$, where $\omega < 2.376$ is the fast matrix product exponent~\citep{latapy2008main,coppersmith1987matrix}. The number of nodes in the {\textsf InnerCore} is denoted by $|\V^{inner}|$. We demonstrate in \S\ref{sec:exp} that triangular motif discovery on {\textsf InnerCore}s has low time costs because of the relatively small size of daily networks' {\textsf InnerCore}s.
In particular, we consider a simpler implementation of triangular motif discovery,
where for each node we explore its local neighborhood. For every triple consisting of the current node and its two neighbors, we verify if a motif can be formed.  
The time complexity of our approach is 
$O\left(|\V^{inner}| \times {nbr \choose 2}\right)$,
where $nbr$ denotes the maximum number of neighbors per node. The daily temporal {\textsf InnerCore} networks from our Ethereum stablecoin dataset have, on average, 180 nodes, with each node having 11 neighbors on average (max. number of neighbors of a node = 134).
In contrast, the entire daily temporal Ethereum stablecoin networks have, on average, 89,500 nodes and though each node has only 3 neighbors on average, the maximum number of neighbors per node is 69,381. This explains why our triangular motif discovery method is quite efficient on the {\textsf InnerCore} networks as opposed to on entire daily temporal graphs. 

%Innercore max N: 134    InnerCore average |V| = 179.31
%Whole network max N: 69381    whole network average |V| = 89464.21

We define the center of each 3-node motif as a node that either receives incoming edges from the two other nodes (buy behavior) or delivers outgoing edges to two other nodes (sell behavior). This definition ensures that motif centers 
exhibit only buy or sell behavior, 
and they do not act as intermediary nodes between the other two nodes in a motif.

Out of the 16 connected three-node motifs (see Figure 1B in \citet{milo2002network}), only five of them contain a center node (Figure~\ref{fig:motifs}).
We identify all instances of these five motifs and their centers from our daily networks' {\textsf InnerCore}s. 
Finally, we utilize the well-known {\textsf TF-IDF} measure from information retrieval~\citep{salton1988term} to rank the discovered center nodes. 
{\textsf TF-IDF} is a statistical measure to reflect the relevance of a word in a collection of documents. In our setting, we treat each discovered center address as a word and daily instances of each motif as a collection of documents to propose a novel node relevance score for temporal graphs: {\textsf NF-IAF}.   

Formally, let $M={m_1,m_4,m_{5},m_{6},m_{11}}$ be the set of five motifs of interest, and let $T={t_1,t_2,\dots,t_n}$ be the set of $n$ days under consideration. 
For each $m_i \in M$ and $t_j \in T$, let ${c(v,m_i,t_j)}$ denote the number of occurrences of node $v\in \V^{inner}$ in all instances of motif $m_i$ on day $t_j$.
For all $v\in \V^{inner}$, $m_i\in M$, and $t_j\in T$, we define the node frequency ({\textsf NF}) and inverse-appearance frequency ({\textsf IAF}) as follows:
%
\begin{definition}[Node Frequency]
We define the node frequency of node $v$ for motif $m_i$ on day $t_j$  as 
$$NF(v,m_i,t_j)=  \frac{c(v,m_i,t_j)}{\sum\limits_{v \in \V_j^{inner}}{c(v,m_i,t_j)}}.$$ % 
\end{definition}
%
The {\textsf NF} measures how frequently a particular node occurs in a specific motif on a specific day relative to the total number of occurrences of all nodes in that motif on that day. 
%
\begin{definition}[Inverse Appearance Frequency]
We define the inverse appearance frequency of node $v$ for motif $m_i$  as 
$$IAF(v,m_i) = \log\frac{|T|}{df(v,m_i)}$$
where $|T|$ is the total number of days in the dataset, and $df(v,m_i)$ is defined as the number of days $t_j\in T$ where $c(v,m_i,t_j)>0$.
\end{definition}
%
The {\textsf IAF} measures the importance of a node by how frequently it appears across all days for a motif.  If a node appears in many days for a motif, its {\textsf IAF} will be low, indicating that it is not very informative. On the other hand, if a node appears in only a few days for a motif, its {\textsf IAF} will be high, indicating that it is a rare and potentially important node.
%
\begin{definition}[NF-IAF Score]
The {\textsf NF-IAF} score of node $v$ for motif $m_i$ on day $t_j$ is given as 
$$NF{\text-}IAF(v,m_i,t_t) = NF(v,m_i,t_j) \times IAF(v,m_i).$$
\end{definition}
%
A greater {\textsf NF-IAF} score of a center node on a particular day  
indicates greater relevance between that node and the behavior associated with the motif type.  Therefore, a node corresponding to a motif center on a particular day with a high {\textsf NF-IAF} score has an increased likelihood that it has more influence on the network on that day, while a lower {\textsf NF-IAF} score indicates the opposite.  

\input{sections/052_tfidf_example.tex}
 
  

 