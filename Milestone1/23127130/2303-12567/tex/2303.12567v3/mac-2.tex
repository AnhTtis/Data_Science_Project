%% Time-stamp: <2023-05-12 10:20:21 sglass>
\catcode`@=11
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Macros for bibliography 
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtoks\bibm@rk
\newdimen\bibindent%
\newdimen\bibnoskip%

%% the following parameters can be changed before bibliography is printed
\newskip\bibskip%
\bibnoskip=5pt%
\bibskip=0pt%
\bibindent=32pt%
\bibskip=4pt plus 1pt minus 1pt
\def\aut#1{{\rm #1.}}
\def\btitle#1{{\it  #1\/}.}
\def\jtitle#1{{\rm #1.}}
\def\anno#1{({\rm #1}).}
\def\book#1{{\rm #1}}
\def\journal#1 #2 #3{{\it #1\/}~{\bf #2} #3}
\def\journalnt#1 #2 #3{{\it #1\/} {\bf #2} {#3}}
\def\autt#1{{\rm{#1}}}
\def\jjtitle#1{{\rm #1}}




\newcount\@bnumb \newcount\@btot
\@bnumb=0
\@btot=0

\newwrite\@btag
\gdef\ReadWriteBib#1{\openin\@btag \jobname.btag \ifeof\@btag
\relax\else\closein\@btag\relax\input\jobname.btag\fi
\openout\@btag=\jobname.btag\relax\ignorespaces
\global\bibnoskip=#1pt\relax\ignorespaces
\ifnum\the\@btot>0{\setbox0=\hbox{{\the\@btot}.}\global\bibindent=\wd0}\ignorespaces
\global\advance\bibindent by \bibnoskip\else\relax\fi}

\gdef\citeshape#1#2{[\hyperlink{#1}{#2}]}
\gdef\citeshaped#1#2{\hyperlink{#1}{{#2}}}


\gdef\bclust#1#2{\@ifundefined{#1@*@}{\relax}{\ignorespaces
\message{Check cit. [#1]! }\relax}\ignorespaces
\expandafter\gdef\csname \noexpand#1@*@\endcsname{#2}\ignorespaces}

\gdef\cite#1{\@ifundefined{#1@*@}{[#1]\ignorespaces\message{Don't know cit. [#1]!}\ignorespaces
\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\citeshape{#1}{\csname#1@*@\endcsname}\relax}\ignorespaces\relax}


\gdef\cited#1{\@ifundefined{#1@*@}{{#1}\ignorespaces\message{Don't know cit. [#1]!}\ignorespaces
\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\citeshaped{#1}{\csname#1@*@\endcsname}\relax}\ignorespaces\relax}


\gdef\citel#1{\@ifundefined{#1@*@}{[#1]\ignorespaces\message{Don't know cit. [#1]!}\ignorespaces
\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\citeshape{#1}{\csname#1@*@\endcsname}\relax}\ignorespaces\relax}


\gdef\nocite#1#2{\@ifundefined{#1@*@}{[#1]\ignorespaces\message{Don't know cit. [#1]!}\ignorespaces
\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\citeshaped{#1}{#2}\relax}\ignorespaces\relax}


\gdef\nonocite#1{\@ifundefined{#1@*@}{\ignorespaces\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\relax}\ignorespaces\relax}


\gdef\include#1{\@ifundefined{#1@*@}{\ignorespaces\expandafter\gdef\csname#1@*@\endcsname{#1}\relax}{\relax}\ignorespaces\relax}


%% classic appearance
\iffalse
\gdef\bibshape#1#2{\vskip\bibskip\par\hangindent\bibindent\hangafter1\noindent\ignorespaces
\hbox to\bibindent{\hfill}\ignorespaces
\llap{\relax\hypertarget{#1}{[\bibmark]}\hbox to \bibnoskip{\hfill}}\ignorespaces#2\ignorespaces}

\gdef\bibshapenh#1#2{\vskip\bibskip\par\hangindent\bibindent\hangafter1\noindent\ignorespaces
\hbox to\bibindent{\hfill}\ignorespaces
\llap{[#1]\hbox to \bibnoskip{\hfill}}\ignorespaces#2\ignorespaces}
\fi
%%%%%%%%%%%%%%


\gdef\bibshape#1#2{\vskip\bibskip\par\hangindent\bibindent\hangafter1\noindent\ignorespaces
\hbox to\bibindent{\hfill}\ignorespaces
\llap{\relax\hypertarget{#1}{\bibmark.}\hbox to \bibnoskip{\hfill}}\ignorespaces#2\ignorespaces}

\gdef\bibshapenh#1#2{\vskip\bibskip\par\hangindent\bibindent\hangafter1\noindent\ignorespaces
\hbox to\bibindent{\hfill}\ignorespaces
\llap{{#1.}\hbox to \bibnoskip{\hfill}}\ignorespaces#2\ignorespaces}


\gdef\bibmemo#1{\ignorespaces
\edef\next{\write\@btag{\string\bclust{#1}{\the\bibm@rk}}}\next\ignorespaces}

\gdef\WriteRefTot{\ignorespaces
\edef\next{\write\@btag{\string\SetTotalRefs{\the\@bnumb}}}\next\relax\ignorespaces}

\gdef\SetTotalRefs#1{\global\@btot=#1}

\def\brefitem[#1 (#2)]#3#4\par{\@ifundefined{#3@*@}{\relax}{\global\advance\@bnumb by 1\edef\next{\bibm@rk={\the\@bnumb}}\next\relax\bibmemo{#3}\relax\gdef\bibmark{\csname#3@*@\endcsname}\ignorespaces\bibshape{#3}{#4}}\ignorespaces}

\def\@all@bib[#1 (#2)]#3#4\par{\global\advance\@bnumb by 1\edef\next{\bibm@rk={\the\@bnumb}}\next\relax\@ifundefined{#3@*@}{\bibshapenh{\the\bibm@rk}{#4}}{\bibmemo{#3}\relax\gdef\bibmark{\csname#3@*@\endcsname}\ignorespaces\bibshape{#3}{#4}}\ignorespaces}


\gdef\includeallbref{\let\brefitem\@all@bib\relax}

\catcode`@=12
