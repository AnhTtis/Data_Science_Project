\clearpage
\setcounter{page}{1}


\section{Appendix}
\label{sec: appendix experiments}
\textbf{Datasets.\quad}(1) The MVTec~\cite{bergmann2019mvtec} dataset is widely used to evaluate and test anomaly detection algorithms and industrial defect detection, consisting of 4,096 normal and 1,258 abnormal images. It contains samples of many different types of surface defects, such as scratches, cracks, holes, and depressions. 
(2) VisA~\cite{zou2022spd} is a novel and challenging dataset consisting of 10,821 images (9,621 normal and 1,200 abnormal images) in total, which is $2 \times$ larger than MVTec. 
Visa contains 12 subsets, which can be divided into three broad categories based on the properties of the objects. The first category consists of four printed circuit boards (PCBS) with complex structures. The second type is a dataset with multiple instances in one view and consists of Capsules, Candles, Macaroni1, and Marcaroni2. The third type is single instances with roughly aligned objects: Cashew, Chewing gum, Fryum, and Pipe fryum. 
Anomalous images in VisA contain a variety of imperfections, including surface defects such as scratches, dents, colored spots, or cracks, and structural defects such as misplacement or missing parts.
(3) DAGM~\cite{wieler2007dagm} consists of ten texture classes with 15,000 normal images and 2,100 abnormal images. Various defects that are visually close to the background, such as scratches and specks, constitute anomalous samples. 
(4) MPDD~\cite{jezek2021mpdd} contains 1064 normal images and 282 abnormal images. It focuses on metal fabrication and reflects real-world situations encountered on manually operated production lines.

\vspace{0.05in}
\noindent\textbf{More quantitative results on four datasets.\quad}
We extensively evaluate the performance of DiffusionAD on subclasses of four datasets, comparing it with previous state-of-the-art (SOTA) methods based on feature embedding and generative models. 
\cref{tab: visa pixel auroc and pixel ap} presents a comparison of anomaly localization performance on the VisA~\cite{zou2022spd} dataset, including both pixel pro and pixel ap metrics. DiffusionAD outperforms the previous generative model-based SOTA by 4.8\% on average pixel AP.
\cref{tab: mvtec image auroc and pixel auroc} and \cref{tab: mvtec pixel pro and pixel ap} show the comparison of anomaly detection and localization performance on the MVTec~\cite{bergmann2019mvtec} dataset, indicating that DiffusionAD significantly surpasses previous generative model-based SOTA in anomaly localization, especially with improvements of 3.6\% and 7.7\% on pixel PRO and AP, respectively. \cref{tab: DAGM image auroc and pixel ap} provides a detailed description of the comparison on the DAGM~\cite{wieler2007dagm} dataset, where it outperforms previous methods in 9 out of 10 categories, achieving the highest overall image AUROC of 99.6\%. This performance approaches full-recall anomaly detection.
In \cref{tab: MPDD image auroc and pixel pro}, DiffusionAD demonstrates outstanding anomaly detection and localization performance on the MPDD~\cite{jezek2021mpdd} dataset, surpassing previous generative model-based methods by a large margin. These experimental results thoroughly demonstrate the effectiveness and generality of the proposed pipeline.

\begin{table*}[h]
\centering
\scalebox{0.8}{
\begin{tabular}{@{}lcccccccc@{}}
\toprule
                           & \multicolumn{4}{c}{Feature embedding-based} & \multicolumn{4}{c}{Generative model-based}                      \\ \cmidrule(l){2-5}  \cmidrule(l){6-9}
\multirow{-2}{*}{Category} & PatchCore~\cite{roth2022patchcore}   & RD4AD~\cite{deng2022rd4ad}      & RD++~\cite{tien2023rd++}       & SimpleNet~\cite{liu2023simplenet}  & DMAD~\cite{liu2023dmad}  & DRAEM~\cite{zavrtanik2021draem}     & FastFlow~\cite{yu2021fastflow}  & \textbf{Ours}      \\ \midrule
candle      & \textbf{99.5}/17.6 & 97.9/19.0   & 98.6/16.3 & 97.7/12.8 & 98.1/18.9 & 97.3/32.7 & 94.9/4.9  & 99.2/\textbf{49.7} \\
capsules    & 99.5/\textbf{68.7} & 89.5/12.3 & 99.4/57.1 & 99.0/57.9   & 99.2/50.5 & 99.1/47.9 & 75.3/1.4  & \textbf{99.5}/51.8 \\
cashew      & 98.9/58.5 & 95.8/28.2 & 95.8/53.9 & 98.8/58.6 & 95.3/57.3 & 88.2/28.5 & 91.4/9.2  & \textbf{98.9/61.4} \\
chewinggum  & 99.1/42.8 & 99.0/58.9   & \textbf{99.4/65.8} & 98.3/17.7 & 97.9/56.1 & 97.1/39.0   & 98.6/43.6 & 99.3/50.0   \\
fryum       & 93.8/37.2 & 94.3/54.3 & 96.5/49.7 & 91.1/38.0   & 97.0/49.2   & 92.7/41.1 & 97.3/35.3 & \textbf{98.2/51.5} \\
macaroni1   & \textbf{99.8}/7.6  & 97.7/43.8 & 99.7/21.1 & 99.6/6.7  & 99.7/16.3 & 99.7/\textbf{45.8} & 97.3/27.8 & 99.2/41.3 \\
macaroni2   & 99.1/3.2  & 87.7/35.2 & 99.7/11.1 & 98.9/4.4  & 99.7/9.8  & 99.9/41.0   & 89.2/29.8 & \textbf{99.9/44.1} \\
pcb1        & \textbf{99.9/91.7} & 75.0/0.5  & 99.7/82.6 & 99.6/88.6 & 99.8/82.8 & 90.5/28.1 & 75.2/0.2  & 97.8/25.6 \\
pcb2        & 99.0/14.3 & 64.8/0.6  & 99.0/14.8   & 98.3/12.5 & \textbf{99.0/14.7}   & 90.5/4.9  & 67.3/0.1  & 98.6/15.0   \\
pcb3        & 99.2/38.9 & 95.5/59.1 & 99.2/20.1 & 99.2/44.3 & 99.3/29.6 & 98.6/20.3 & 94.8/23.7 & \textbf{99.4/50.6} \\
pcb4        & 98.6/42.4 & 92.8/10.6 & 98.6/42.6 & 93.9/34.0   & \textbf{98.8/46.8} & 88.0/20.6   & 89.9/5.4  & 97.6/43.1 \\
pipe\_fryum & 99.1/58.5 & 92.0/10.4   & 99.1/54.9 & 98.9/60.5 & \textbf{99.3}/60.2 & 90.9/16.5 & 87.3/5.4  & 99.0/\textbf{64.9}   \\ \midrule
Average     & 98.8/40.1 & 90.1/27.7 & 98.7/40.8 & 97.8/36.3 & 98.6/41.0   & 94.4/30.5 & 88.2/15.6 & \textbf{98.9/45.8} \\ \bottomrule
\end{tabular}}
\caption{Anomaly Localization on VisA~\cite{bergmann2019mvtec}. The best results of Pixel AUROC / Pixel AP are highlighted in bold.}
\label{tab: visa pixel auroc and pixel ap}
\end{table*}

\begin{table*}[h]
\centering
\scalebox{0.8}{
\begin{tabular}{@{}lcccccccc@{}}
\toprule
                           & \multicolumn{4}{c}{Feature embedding-based} & \multicolumn{4}{c}{Generative model-based}                      \\ \cmidrule(l){2-5}  \cmidrule(l){6-9}
\multirow{-2}{*}{Category} & PatchCore~\cite{roth2022patchcore}   & RD4AD~\cite{deng2022rd4ad}      & RD++~\cite{tien2023rd++}       & SimpleNet~\cite{liu2023simplenet}  & DMAD~\cite{liu2023dmad}  & DRAEM~\cite{zavrtanik2021draem}     & FastFlow~\cite{yu2021fastflow}  & \textbf{Ours}      \\ \midrule
Carpet     & 98.7/99.0   & 98.9/98.8 & \textbf{100/99.2}  & 99.0/98.4   & 100/99.1  & 97.0/95.5   & 87.5/98.0   & 99.3/99.0   \\
Grid       & 98.2/98.7 & 100/97.0    & 100/99.3  & 97.8/98.9 & 100/99.2  & 99.9/99.7 & 88.1/93.5 & \textbf{100/99.7}  \\
Leather    & 100/99.3  & 100/98.6  & 100/99.4  & 99.3/98.0   & 100/99.5  & 100/98.6  & 96.1/93.0   & \textbf{100/99.8}  \\
Tile       & 98.7/95.6 & 99.3/98.9 & 99.7/96.6 & 99.7/96.6 & \textbf{100}/96.0    & 99.6/99.2 & 63.2/96.1 & 99.9/\textbf{99.7} \\
Wood       & 99.2/95.0   & 99.2/\textbf{99.3} & 99.3/95.8 & 99.9/93.2 & \textbf{100}/95.5  & 99.1/96.4 & 90.8/95.9 & 99.9/96.7 \\
Bottle     & \textbf{100}/98.6  & 100/99.0    & 100/98.8  & 100/94.0    & 100/98.9  & 99.2/99.1 & 100/92.7  & 99.7/\textbf{99.1} \\
Cable      & 99.5/98.4 & 95.0/\textbf{99.4}   & 99.2/98.4 & \textbf{99.9}/98.7 & 99.1/98.1 & 91.8/94.7 & 91.2/97.5 & 99.6/98.1 \\
Capsule    & 98.1/98.8 & 96.3/97.3 & 99.0/\textbf{98.8}   & \textbf{100}/97.4  & 98.9/98.3 & 98.5/94.3 & 99.2/97.4 & 98.9/98.3  \\
Hazelnut   & 100/98.7  & 99.9/98.2 & 100/99.2  & 100/98.6  & 100/99.1  & 100/99.7  & 98.8/98.9 & \textbf{100/99.7} \\
Metal nut  & 100/98.4  & 100/99.6  & 100/98.1  & 100/97.0    & 100/97.7  & 98.7/99.5 & 90.8/98.1 & \textbf{100/99.7}  \\
Pill       & 96.6/97.4 & 99.6/95.7 & 98.4/98.3 & \textbf{100}/98.8  & 97.3/98.7 & 98.9/97.6 & 98.0/92.3   & 99.0/\textbf{99.3}   \\
Screw      & 98.1/99.4 & 97.0/99.1   & 98.9/\textbf{99.7} & \textbf{100}/98.0    & 100/99.6  & 93.9/97.6 & 97.8/99.4 & 99.4/99.0   \\
Toothbrush & 100/98.7  & 99.5/93.0   & 100/99.1  & 98.1/99.2 & 100/\textbf{99.4}  & 100/98.1  & 100/92.7  & \textbf{100}/98.8  \\
Transistor & 100/96.3  & 96.7/95.4 & 98.5/94.3 & \textbf{100/97.8}  & 98.7/95.4 & 93.1/90.9 & 88.1/94.3 & 99.8/92.9 \\
Zipper     & 99.4/98.8 & 98.5/98.2 & 98.6/98.8 & 100/99.2  & 99.6/98.3 & 100/98.8  & 67.5/93.4 & \textbf{100/99.2}  \\ \midrule
Average    & 99.1/98.1 & 98.5/97.8 & 99.4/98.3 & 99.6/97.6 & 99.6/98.2 & 98.0/97.3   & 90.5/95.5 & \textbf{99.7/98.7} \\ \bottomrule
\end{tabular}}
\caption{Anomaly Detection and Localization on MVTec~\cite{bergmann2019mvtec}. The best results of Image AUROC / Pixel AUROC are highlighted in bold.}
\label{tab: mvtec image auroc and pixel auroc}
\end{table*}

\begin{table*}[h]
\centering
\scalebox{0.8}{
\begin{tabular}{@{}lcccccccc@{}}
\toprule
                           & \multicolumn{4}{c}{Feature embedding-based} & \multicolumn{4}{c}{Generative model-based}                      \\ \cmidrule(l){2-5}  \cmidrule(l){6-9}
\multirow{-2}{*}{Category} & PatchCore~\cite{roth2022patchcore}   & RD4AD~\cite{deng2022rd4ad}      & RD++~\cite{tien2023rd++}       & SimpleNet~\cite{liu2023simplenet}  & DMAD~\cite{liu2023dmad}  & DRAEM~\cite{zavrtanik2021draem}     & FastFlow~\cite{yu2021fastflow}  & \textbf{Ours}      \\ \midrule
Carpet     & 96.6/76.8 & 97.0/78.7   & \textbf{97.7}/63.6 & 93.2/\textbf{79.8} & 86.1/44.6 & 92.0/53.5   & 84.2/68.8 & 95.0/77.2   \\
Grid       & 95.9/65.3 & 97.6/52.7 & 97.7/48.5 & 92.8/42.1 & 72.4/7.4  & 97.8/65.7 & 83.8/27.6 & \textbf{98.9/68.8} \\
Leather    & 98.9/44.2 & 99.1/45.1 & \textbf{99.2}/50.1 & 87.4/43.3 & 97.7/41.3 & 96.8/75.3 & 91.0/41.8   & 98.9/\textbf{69.2} \\
Tile       & 87.4/62.7 & 90.6/57.4 & 92.4/53.4 & 87.4/28.8 & 82.7/54.3 & 97.4/92.3 & 81.8/20.5 & \textbf{98.3/97.1} \\
Wood       & 89.6/32.5 & 90.9/49.2 & \textbf{93.3}/52.0   & 86.2/59.8 & 86.3/44.4 & 92.8/\textbf{77.7} & 85.1/53.9 & 90.3/77.4 \\
Bottle     & 96.1/53.7 & 96.6/62.1 & \textbf{97.0}/79.9   & 82.2/45.2 & 96.0/78.9   & 96.4/86.5 & 91.9/45.5 & 96.8/\textbf{89.7} \\
Cable      & 92.6/45.6 & 91.0/48.2   & 93.9/62.5 & 94.7/63.7 & 95.1/58.3 & 75.4/52.4 & 80.8/35.1 & \textbf{95.5/72.5} \\
Capsule    & 95.5/\textbf{87.0}   & \textbf{95.8}/79.1 & 96.4/48.1 & 92.0/66.6   & 89.7/41.4 & 90.4/49.4 & 76.7/27.6 & 93.3/59.2 \\
Hazelnut   & 93.9/77.7 & 95.5/78.4 & 96.3/65.4 & 91.9/40.4 & 96.4/60.2 & 97.5/92.9 & 89.0/63.3   & \textbf{97.5/92.6} \\
Metal nut  & 91.3/35.4 & 92.3/53.6 & 93.0/82.3   & 93.1/68.1 & 94.6/83.5 & 93.2/96.3 & 86.6/31.1 & \textbf{97.8/97.1} \\
Pill       & 94.1/54.6 & 96.4/53.2 & 97.0/78.1   & 86.4/92.0   & 95.0/77.6   & 88.1/48.5 & 94.6/25.9 & \textbf{98.7/86.9} \\
Screw      & 97.9/37.2 & 98.2/51.8 & \textbf{98.6}/54.4 & 89.9/\textbf{70.2} & 94.3/48.2 & 97.0/58.2   & 91.5/52.5 & 91.6/59.4 \\
Toothbrush & 91.4/61.0   & 94.5/54.9 & 94.2/53.8 & 95.4/33.6 & 92.5/52.5 & 89.9/44.7 & \textbf{98.0}/60.9   & 93.7/\textbf{61.1} \\
Transistor & 83.5/47.7 & 78.0/48.2   & 81.8/58.6 & 81.2/46.5 & 86.9/\textbf{60.7} & 81.0/50.7   & 73.1/37.8 & \textbf{91.7}/58.2 \\
Zipper     & \textbf{97.1}/59.5 & 95.4/57.1 & 96.3/60.9 & 96.6/42.6 & 92.9/49.6 & 95.4/\textbf{81.5} & 75.6/4.5  & 96.5/74.2 \\\midrule
Average    & 93.5/56.1 & 93.9/58.0   & 95.0/60.8   & 90.0/54.8   & 90.6/53.5 & 92.1/68.4 & 85.6/39.8 & \textbf{95.7/76.1} \\ \bottomrule
\end{tabular}}
\caption{Anomaly Localization on MVTec~\cite{bergmann2019mvtec}. The best results of Pixel PRO / Pixel AP are highlighted in bold.}
\label{tab: mvtec pixel pro and pixel ap}
\end{table*}



\begin{table*}[h]
\centering
\scalebox{0.8}{
\begin{tabular}{@{}lcccccccc@{}}
\toprule
                           & \multicolumn{4}{c}{Feature embedding-based} & \multicolumn{4}{c}{Generative model-based}                      \\ \cmidrule(l){2-5}  \cmidrule(l){6-9}
\multirow{-2}{*}{Category} & PatchCore~\cite{roth2022patchcore}   & RD4AD~\cite{deng2022rd4ad}      & RD++~\cite{tien2023rd++}       & SimpleNet~\cite{liu2023simplenet}  & DMAD~\cite{liu2023dmad}  & DRAEM~\cite{zavrtanik2021draem}     & FastFlow~\cite{yu2021fastflow}  & \textbf{Ours}      \\ \midrule
Class1  & 80.8/5.9  & 99.4/53.3 & 99.5/58.5 & 98.6/54.5 & 98.6/50.1 & 91.6/16.6 & 94.9/30.3 & \textbf{99.9/65.8} \\
Class2  & 100/55.7  & 100/60.4  & 100/\textbf{64.0}    & 100/42.4  & 99.8/61.6 & 90.0/15.0     & 96.2/43.1 & \textbf{100}/60.6  \\
Class3  & 92.2/45.6 & 92.6/47.6 & 98.6/61.4 & 95.2/42.3 & 83.6/34.7 & 95.5/20.8 & 83.0/17.6   & \textbf{100/62.0}    \\
Class4  & 100/\textbf{89.8}  & 100/70.5  & 100/81.7  & 100/83.4  & 100/78.0    & 100/65.3  & 98.8/70.0   & \textbf{100}/74.7  \\
Class5  & 97.7/64.7 & 93.1/53.4 & 99.6/\textbf{70.7} & 93.0/37.6   & 82.0/35.3   & 100/39.1  & 77.0/28.7   & \textbf{100}/60.4  \\
Class6  & 99.9/74.4 & 100/66.2  & 99.8/65.5 & 100/65.9  & 95.6/42.6 & 100/53.4  & 98.7/46.5 & \textbf{100/92.1}  \\
Class7  & 100/73.7  & 100/75.8  & 100/81.6  & 100/\textbf{83.0}    & 99.9/78.2 & 98.1/35.0   & 79.7/8.8  & \textbf{100}/60.5  \\
Class8  & 65.7/6.8  & 73.6/15.3 & 87.6/42.9 & 65.9/9.9  & 51.5/0.2  & 99.4/34.7 & 52.8/0.2  & \textbf{100/51.1}  \\
Class9  & 99.4/50.0   & 99.1/41.8 & 99.5/56.0   & \textbf{99.9}/20.4 & 80.4/25.8 & 47.0/0.1    & 98.9/\textbf{65.2} & 96.1/52.6 \\
Class10 & 100/50.4  & 99.9/49.5 & 100/60.4  & 100/41.5  & 99.3/53.4 & 86.6/26.2 & 93.9/31.8 & \textbf{100/71.4}  \\\midrule
Average & 93.6/51.7 & 95.8/53.4 & 98.5/64.3 & 95.3/48.1 & 89.1/46.0   & 90.8/30.6 & 87.4/34.2 & \textbf{99.6/65.1} \\ \bottomrule
\end{tabular}}
\caption{Anomaly Detection and Localization on DAGM~\cite{wieler2007dagm}. The best results of Image AUROC / Pixel AP are highlighted in bold.}
\label{tab: DAGM image auroc and pixel ap}
\end{table*}


\begin{table*}[h]
\centering
\scalebox{0.8}{
\begin{tabular}{@{}lcccccccc@{}}
\toprule
                           & \multicolumn{4}{c}{Feature embedding-based} & \multicolumn{4}{c}{Generative model-based}                      \\ \cmidrule(l){2-5}  \cmidrule(l){6-9}
\multirow{-2}{*}{Category} & PatchCore~\cite{roth2022patchcore}   & RD4AD~\cite{deng2022rd4ad}      & RD++~\cite{tien2023rd++}       & SimpleNet~\cite{liu2023simplenet}  & DMAD~\cite{liu2023dmad}  & DRAEM~\cite{zavrtanik2021draem}     & FastFlow~\cite{yu2021fastflow}  & \textbf{Ours}      \\ \midrule
Bracket\_black & 88.4/94.2 & 86.0/94.6   & 84.0/93.0  & 92.0/95.5   & 80.5/91.1 & 86.8/93.5 & 94.8/45.9 &\textbf{97.5/98.3} \\
Bracket\_brown & 96.1/93.6 & 91.9/\textbf{95.6} & 95.7/92.2 & \textbf{96.4}/81.1  & 94.5/81.6 & 92.8/45.3 & 96.4/17.9 & 93.8/93.1 \\
Bracket\_white & 93.4/91.9 & 82.0/93.5   & 87.0/95.2   & \textbf{92.8}/86.3   & 82.9/93.2 & 88.0/73.5   & 96.4/52.2 & 88.7/\textbf{93.5} \\
Connector      & \textbf{100}/97.5  & 100/97.5  & 99.3/\textbf{97.7} & 100/98.1  & 99.0/97.7   & 100/82.5  & 87.4/53.3 & 97.4/94.5 \\
Metal\_plate   & 100/91.9  & 100/95.1  & 100/\textbf{96.3}  & 100/88.1  & 100/95.6  & 100/90.7  & 93.7/70.8 & \textbf{100}/94.7  \\
Tubes          & 90.7/94.1 & 96.3/95.9 & 91.3/95.2 & 95.5/97.8 & 93.4/96.5 & 97.0/83.4   & 63.3/58.6 & \textbf{99.7/97.8} \\ \midrule
Average        & 94.8/93.9 & 92.7/\textbf{95.3} & 92.9/94.9   & 96.1/91.2 & 91.7/92.6 & 94.1/78.1 & 88.7/49.8 & \textbf{96.2/95.3} \\ \bottomrule
\end{tabular}}
\caption{Anomaly Detection and Localization on MPDD~\cite{jezek2021mpdd}. The best results of Image AUROC / Pixel PRO are highlighted in bold.}
\label{tab: MPDD image auroc and pixel pro}
\end{table*}




\vspace{0.05in}
\noindent\textbf{More qualitative results on four datasets.\quad}
We qualitatively evaluate the anomaly detection and localization performance of DiffusionAD on four datasets, and the concrete results are shown in \cref{fig: supplemental mvtec more visualization}, \cref{fig: supplemental visa more visualization}, and \cref{fig: supplemental dagm and mpdd more visualization}. The first and second columns display the anomalous samples and their ground truth, where the anomalous regions vary in shape, size, and number. The third and fourth columns illustrate the anomaly-free reconstruction and anomaly localization results of our proposed pipeline, respectively.
It can be observed that DiffusionAD achieves the desired anomaly-free reconstruction across different datasets and types of anomalies through the norm-guided one-step denoising paradigm. Subsequently, the segmentation network accurately predicts pixel-level anomaly scores by exploiting the inconsistencies and commonalities between the input and its reconstruction.



\begin{figure*}
  \centering
  \includegraphics[width=0.9\linewidth]{figs/mvtec_more_visualization.pdf}
  \caption{More qualitative examples on MVTec~\cite{bergmann2019mvtec}.}
  \label{fig: supplemental mvtec more visualization} 
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[width=0.9\linewidth]{figs/visa_more_visualization.pdf}
  \caption{More qualitative examples on VisA~\cite{zou2022spd}.}
  \label{fig: supplemental visa more visualization} 
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[width=0.9\linewidth]{figs/dagm_mpdd_more_visualization.pdf}
  \caption{Qualitative examples on DAGM~\cite{wieler2007dagm} and MPDD~\cite{jezek2021mpdd}.}
  \label{fig: supplemental dagm and mpdd more visualization} 
\end{figure*}