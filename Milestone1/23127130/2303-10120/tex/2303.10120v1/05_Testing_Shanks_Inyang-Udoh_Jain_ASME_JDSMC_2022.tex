\section{Testing and Validation}\label{sec:testing}

The objective of the following case studies is to validate the SDRE filter by demonstrating that the errors in the estimated temperatures and state of charge converge near zero and remain bounded.  As it is not possible to validate the SOC estimate experimentally with only five thermocouples embedded in PCM layer of the TES module, we first test the estimator using the high-fidelity simulation model validated in \cite{gohil_reduced-order_2020} and \cite{shanks_design_2022}. However, in order to enable a comparison with the experimental validation and draw conclusions about those estimation errors that are due to modeling error, we use experimental data as inputs to the simulation model, as discussed in Section \ref{sec:exp_data}. The simulation-based case study in Section \ref{sec:sim_testing} is followed by validation of the estimator's convergence and boundedness on the experimental testbed as discussed in Section \ref{sec:exp_testing}. In Section \ref{sec:sample_rate}, we investigate the effect of increased and reduced sample rates by comparing 80 samples per second (S/s), 10 S/s, 1 S/s, and 0.2 S/s.  Although the SDRE filter is capable of real-time estimation on the testbed, we perform experimental validation offline so that multiple filter configurations can be tested using the same dataset.

\subsection{Experimental Data Collection}\label{sec:exp_data}

We first collect a dataset containing temperature measurements from the seven thermocouples and a measurement of the mass flow rate on the experimental testbed at the maximum sample rate of 80 S/s.  The experimentally-measured mass flow rate and fluid inlet temperature are used as inputs for the simulation-based testing described in Section \ref{sec:sim_testing}, whereas the entire experimental dataset is used for experimental validation of the estimator in Section \ref{sec:exp_testing}. The dataset is downsampled when testing the SDRE filter with slower sample rates.  The mass flow rate through the TES is controlled by manually opening and closing the flow control valves through the LabVIEW VI. Fig.\ \ref{fig:mass_flow_rate} shows the measured mass flow rate through the TES.  Fig.\ \ref{fig:fluid_in_out} shows the temperatures of the fluid entering and leaving the TES measured by TC0 and TC1, respectively. Note that periods of zero flow rate were intentionally introduced as it would be reasonable for the TES to only be charged or discharged intermittently.  Conductive heat transfer still occurs inside the TES even when the mass flow rate is zero, so the state estimator must still work during these periods to track the changing temperature distribution.  In the subsequent figures, blue shading denotes periods of zero mass flow rate when this information is relevant to the result presented in the figure.
\begin{figure}[tpb]
    %\centering
    \includegraphics[width=3.1in]{Figures/Exp Results/mass_flow_rate.pdf}
    \caption{Measured mass flow rate through the TES. Blue shading in this figure and subsequent figures highlights periods of zero mass flow rate.}
    \label{fig:mass_flow_rate}
\end{figure}
\begin{figure}[tpb]
    %\centering
    \includegraphics[width=3.1in]{Figures/Exp Results/fluid_in_out.pdf}
    \caption{Inlet and outlet fluid temperature measurements.}
    \label{fig:fluid_in_out}
\end{figure}

In Section \ref{sec:sample_rate}, we investigate the effect of sample rate on the accuracy of the estimator. To make an unbiased comparison between different sample rates, the prediction equations given in Eqn.\ \eqref{eq:prop} are executed with the time step $\Delta t_k = 0.0125$~s so that the state estimator model is identical for all sample rates.  The update step given in Eqns.\ \eqref{eq:kalman_gain} and \eqref{eq:update} is performed once every 1, 8, 80, or 400 time steps depending on whether the sample rate is 80 S/s, 10 S/s, 1 S/s or 0.2 S/s, respectively.  Note that the filters receiving measurements at 10 S/s, 1 S/s, and 0.2 S/s are continuous-discrete filters, but the filter receiving measurements at 80~S/s is a discrete filter since the prediction and update steps are executed at the same rate. 

\subsection{Simulation-Based Testing}\label{sec:sim_testing}

Using the experimentally-measured mass flow rate and fluid inlet temperature (TC0) as inputs, we simulate the high-fidelity simulation model \cite{gohil_reduced-order_2020,shanks_design_2022} to generate a \emph{simulated} dataset containing the SOC and temperatures of all control volumes. Note that this model has the same finite volume structure as the model used by the estimator albeit with a finer spatial discretization of $n_x = 21$ and $n_y = 22$;\revres{ the finer discretization was chosen so that the simulation model is an accurate representation of the experimental system.  In other words, differences in accuracy between the simulation and the model used for state estimation are representative of the differences between the experimental TES and the model used for state estimation.  In the model used for state estimation, low computation time is prioritized over model accuracy}. The simulation is executed in MATLAB using the \texttt{ode23} solver \cite{shampine_matlab_1997}. The simulation calculates the temperature distribution inside the TES, converts the high-fidelity temperature distribution to a set of temperatures corresponding to the state estimator model's control volumes, and generates ``thermocouple measurements'' with a sample rate of 10 S/s by adding Gaussian noise to the temperatures of those control volumes that map to the measurement locations on the experimental TES module at discrete time steps. These simulated thermocouple measurements comprise the measurement vector $y_k$ for the state estimator; the thermocouple locations and the labels of the corresponding control volumes are given in Fig.\ \ref{fig:TC_CV_labels}.  We then test the state estimator on the simulated dataset, using simulated values of the thermocouple measurements, to establish convergence of the SOC estimate. 

First, we verify that the temperature estimates of unmeasured control volumes converge toward the temperatures calculated by the simulation, and that the estimation errors remain bounded.  In this case study, the state estimator receives the full measurement output vector at a rate of 10 S/s.  Fig.\ \ref{fig:TCall_sim_a} compares the estimated temperatures of the control volumes labeled CV5 and CV6 (see Fig.\ \ref{fig:TC_CV_labels} for the locations of these control volumes) to the corresponding simulated temperatures.  The gray shading represents the range of temperatures over which the latent heat of fusion is approximated by a large increase in specific heat. Since it is difficult to distinguish the estimates from the simulated values in Fig.\ \ref{fig:TCall_sim_a}, we show the estimation errors in Fig.\ \ref{fig:TCall_sim_b}.  Note that all estimation errors are calculated as $e(t_k)=\hat{x}(t_k)-x_{sim}(t_k)$ where $x_{sim}$ is a state variable calculated by the simulation. 
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TCall_sim.pdf}
        \caption{}
        \label{fig:TCall_sim_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TCall_sim_err.pdf}
        \caption{}
        \label{fig:TCall_sim_b}
    \end{subfigure}
    \caption{(a) Estimated temperatures (red) and simulated temperatures (black) at CV5 and CV6. Gray shading denotes the range of temperatures corresponding to the latent region, and the black line is the melting point of the PCM. (b) Estimation errors for CV5 and CV6.}
    \label{fig:TCall_sim}
\end{figure}

Even though the temperatures of CV5 and CV6 are not included in the output vector $y_k$, the SDRE filter is able to track these temperatures with an estimation error magnitude less than 0.6 K. During periods when the temperatures are changing slowly, the estimation error magnitude is less than 0.05 K, which is less than one standard deviation of the measurement noise ($\sqrt{0.0035\textup{ K}^2} = 0.059\textup{ K}$).  In fact, the largest estimation errors only occur during periods of phase change; the larger negative transient estimation errors correspond to periods when the PCM is melting, suggesting that the SDRE filter introduces a small phase lag between the estimates and the true values.  This claim is supported by the observation that the estimation error has a larger negative value when the temperatures change rapidly, such as at $t = 1050$ seconds. In turn, a faster change in temperature results in more phase lag, which increases the transient estimation error.  There are fewer periods of large positive error because the PCM only fully solidifies at the start ($t=50$ seconds) and end ($t=1650$ seconds) of the dataset; this means that the largest transient errors are expected when the experimental TES completes a phase change and begins to experience sensible heating while the state estimates lag behind in the latent temperature range.

\revres{ The primary motivation for using the SDRE as compared to other nonlinear filters is its suitability for the application at hand, namely, SOC estimation for latent TES systems with graph-based models.  Nevertheless, comparison between the SDRE filter, the extended Kalman filter (EKF), and the unscented Kalman filter (UKF) suggests that the SDRE filter achieves the lowest estimation error, as shown in Fig.\ \ref{fig:CV5_comp}, which compares the estimation errors at CV5 for the three state estimators.  Additionally, the two Kalman filters have large estimation errors during the same periods when the SDRE filter has a large estimation error, so we can conclude that these errors result from limitations in the model used for state estimation and not from the choice of state estimator. 
%Although evaluation of the SDRE filter compared to other types of state estimators is not the main purpose of the paper, comparison between the SDRE filter, the extended Kalman filter (EKF), and the unscented Kalman filter (UKF) suggests that the SDRE filter achieves the lowest estimation error, as shown in Fig.\ \ref{fig:CV5_comp}, which compares the estimation errors at CV5 for the three state estimators.  Additionally, the two Kalman filters have large estimation errors during the same periods when the SDRE filter has a large estimation error, so we can conclude that these errors result from limitations in the model used for state estimation and not from the choice of state estimator. However, a rigorous comparison has not been done, and we cannot guarantee the SDRE filter will perform the best in all scenarios.  For the remainder of this paper, we will focus on validation of the SDRE filter only.
}
\begin{figure}[tb]
    \centering
    \includegraphics[width=3.1in]{Figures/Exp Results/CV5_comp_err.pdf}
    \caption{\revres{Comparison of estimation error at CV5 for the EKF, the UKF, and the SDRE filter.}}
    \label{fig:CV5_comp}
\end{figure}

Next, we quantify the temperature estimation error when the simulated measurement from (i) TC1 or (ii) TC3 is withheld from the state estimator. Note that when testing the state estimator on experimental data (see Section \ref{sec:exp_testing}), these thermocouples are withheld to be used for validation.  Fig.\ \ref{fig:TC1_sim_a} shows the temperatures at CV1, calculated by the simulation and estimated by the SDRE filter, when TC1 is withheld, and Fig.\ \ref{fig:TC1_sim_b} shows the corresponding estimation error.  As expected, the estimation error is more substantial when an output is removed; the error magnitude tends to be less than 0.5 K when the control volume temperature is changing slowly, but it increases to nearly 2 K when the temperature changes suddenly, as it does at $t=1050$ seconds or $t=1200$ seconds.  The steady-state estimation errors from $t=850$ to $t=1000$ seconds and $t=1350$ to $t=1550$ seconds are due to the zero mass flow rate through the TES.  Since advection is the dominant form of heat transfer in the fluid channel, when advection is removed, heat transfer in the fluid control volumes is greatly reduced.  This causes the temperature estimate to converge more slowly. 
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_sim.pdf}
        \caption{}
        \label{fig:TC1_sim_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_sim_err.pdf}
        \caption{}
        \label{fig:TC1_sim_b}
    \end{subfigure}
    \caption{(a) Simulated temperature at CV1 and the estimated temperature for CV1. (b) Estimation error.}
    \label{fig:TC1_sim}
\end{figure}

Fig.\ \ref{fig:TC3_sim_a} shows that the estimated temperature for control volume CV3 still tracks the simulated temperature for this control volume closely when TC3 is withheld from the estimator; Fig.\ \ref{fig:TC3_sim_b} shows that the error tends to be largest near the melting point and during periods of zero mass flow rate.  The estimation error magnitude stays within 1 K, but it only converges to zero outside the latent temperature range.  Fig.\ \ref{fig:RMSE_sim} shows the root-mean-square error (RMSE) averaged over all $n$ control volumes at time step $t_k$, given in Eqn.\ \eqref{eq:RMSE}.  In this figure, the RMSE is shown for the state estimator with full access to all measurements, the state estimator with access to all measurements except TC1, and the state estimator with access to all measurements except TC3.  The RMS errors of the estimator with all measurements and the estimator without TC1 remain below 0.4 K (except at $t=0$ seconds, when the state estimates are initialized) and are nearly indistinguishable; this indicates that the measurement from TC1 has a negligible effect on the estimates of the other control volumes in the model.  Removing TC3 slightly increases the RMSE during phase changes and periods of zero mass flow rate.  Given that this sensitivity to TC3 is not a result of the system model itself, we verify that it occurs when testing the estimator on the experimental dataset in Section \ref{sec:exp_testing}.
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_sim.pdf}
        \caption{}
        \label{fig:TC3_sim_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        %\centering
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_sim_err.pdf}
        \caption{}
        \label{fig:TC3_sim_b}
    \end{subfigure}
    \caption{(a) Simulated temperature at CV3 and the estimated temperature for CV3. (b) Estimation error.}
    \label{fig:TC3_sim}
\end{figure}
\begin{equation}
    e_{rms}(t_k)=\left[\sum_{i=1}^{n}\frac{\left(\hat{x}_i(t_k)-x_i(t_k)\right)^2}{n}\right]^\frac{1}{2}\label{eq:RMSE}
\end{equation}
\begin{figure}[tb]
    %\centering
    \includegraphics[width=3.1in]{Figures/Exp Results/RMSE_sim.pdf}
    \caption{RMS errors of all control volumes for the state estimator with all available measurements, all measurements except TC1, and all measurements except TC3. }
    \label{fig:RMSE_sim}
\end{figure}

Although it is important to analyze the error of individual temperature estimates, the overarching goal of the proposed estimator is to estimate the SOC of the TES for online control decision-making. Fig.\ \ref{fig:SOC_sim_a} compares the simulated and estimated SOC values calculated from the temperature estimates of the SDRE filter with access to all outputs. The shading in Fig.\ \ref{fig:SOC_sim_a} represents the range of SOC in which all or part of the PCM is undergoing a phase change.  Fig.\ \ref{fig:SOC_sim_a} shows simulated PCM temperatures for three control volumes over the duration of the simulation; refer to Fig.\ \ref{fig:TC_CV_labels} for the location of these control volumes.  Comparing Fig.\ \ref{fig:SOC_sim_a} to Fig.\ \ref{fig:OLS_temp} shows that the SOC is near 1 when the PCM temperatures are low and near 0 when the PCM temperatures are high. In Fig.\ \ref{fig:OLS_temp}, the black line is the melting point of the PCM near which small changes in temperature result in large changes in SOC.

This sensitivity near the melting point is also evident in Fig.\ \ref{fig:SOC_sim_b}, which shows the SOC estimation error.  The error is maximized when the PCM temperatures are near the melting point and the SOC is within the latent heat range.  Despite the nonlinear relationship between SOC and temperature, the estimated SOC tracks the simulation well, and the estimate error remains within $\pm$0.02.  Outside the latent range when the system dynamics are approximately linear (between $t=50$ and $t=380$ seconds, for example), the SOC error converges to zero (although there is some noise with amplitude less than 0.001).  The SOC error tends to be positive when the SOC is decreasing and negative when the SOC is increasing, which indicates that there is a small phase lag between the SOC estimate and the true SOC.  Additionally, the error does not converge to zero when the mass flow rate through the TES is zero and the PCM temperatures are within the latent range (for example, between $t=850$ and $t=1000$ seconds).  This is again because heat transfer along the length of the module is dominated by advection. When the mass flow rate is zero, it takes longer for the PCM to reach an equilibrium temperature, which means it takes longer for temperature estimation errors to converge to zero.  Small temperature errors near the phase change temperature result in large errors in SOC.  Outside the latent temperature range, the SOC error converges to zero when the mass flow rate is zero---see the period between $t=1050$ and $t=1200$ seconds for an example.
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/SOC_sim.pdf}
        %\centering
        \caption{}
        \label{fig:SOC_sim_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/SOC_sim_err.pdf}
        %\centering
        \caption{}
        \label{fig:SOC_sim_b}
    \end{subfigure}
    \caption{(a) Simulated and estimated SOC; gray shading represents the latent SOC region where errors are expected to be large. (b) SOC estimation error; blue shading represents periods when the mass flow rate through the TES is zero. }
    \label{fig:SOC_sim}
\end{figure}
\begin{figure}[tb]
    %\centering
    \includegraphics[width=3.1in]{Figures/Exp Results/sim_PCM_T.pdf}
    \caption{Simulated temperature values from select PCM control volumes.}%  Shading denotes the range of temperatures corresponding to the latent region, and the black line is the melting point of the PCM.}
    \label{fig:OLS_temp}
\end{figure}

%  To analyze convergence of the temperature estimates experimentally, select thermocouple measurements are withheld from the state estimator to be used for validation.  However, we expect that using fewer thermocouples will degrade the accuracy of the estimates, so we first use the simulation dataset to quantify the estimation error when selected thermocouple measurements are withheld.  We expect the error between the state estimates and the simulated dataset to be comparable to the error between the state estimates and the experimental measurements.  Any additional error in the experimental results would therefore be due to modeling inaccuracies.

\subsection{Experimental Validation}\label{sec:exp_testing}
In this case study, we test the SDRE filter on experimental data.  First, we investigate convergence of the SDRE filter estimates when (i) thermocouple TC1 is withheld for validation and (ii) thermocouple TC3 is withheld for validation.  We also investigate how the SDRE filter performs with different sample rates.  All estimation errors are calculated as $e(t_k) = \hat{x}(t_k)- y_{k,j}$ where $y_{k,j}$ is a measurement from an excluded thermocouple.

When TC1, the fluid outlet thermocouple measurement, is excluded from the measurement set, the state estimator tracks the fluid outlet temperature closely over long time periods, as shown in Fig.\ \ref{fig:TC1_exp_a}. However, the estimation error increases when the temperature changes rapidly, as shown in Fig.\ \ref{fig:TC1_exp_b} at $t=1000$ seconds, $t=1200$ seconds, and $t=1550$ seconds. For most of the duration of the experiment, the magnitude of the estimation error at CV1 is less than 1 K.  This error behavior is similar to that of the simulated results shown in Fig.\ \ref{fig:TC1_sim_b}, but the larger magnitude of the error when implementing the estimator on the experimental testbed is due to modeling errors. These include inaccuracies in the reduced-order finite volume model due to spatial discretization \cite{gohil_reduced-order_2020, shanks_design_2022}, simplifications of the phase-change dynamics such as neglecting undercooling and hysteresis \cite{sgreva_thermo-physical_2022, barz_paraffins_2021}, and exogenous disturbances in the physical system like heat transfer with the surroundings.
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_exp.pdf}
        \caption{}
        \label{fig:TC1_exp_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_exp_error.pdf}
        \caption{}
        \label{fig:TC1_exp_b}
    \end{subfigure}
    \caption{(a) Estimated temperature of CV1 compared to the fluid outlet temperature measurement TC1. (b) Estimate error for CV1.}
    \label{fig:TC1_exp}
\end{figure}

Excluding TC3 from the measurement set results in degradation of the estimator's performance, as expected based on the simulated results. The estimate of CV3 still tracks TC3 closely over long time periods, as Fig.\ \ref{fig:TC3_exp_a} shows.  When the TES is experiencing rapid changes in temperature, Fig.\ \ref{fig:TC3_exp_b} shows that the magnitude of the error tends to increase; the convergence rate of the estimate error of CV3 is slower than the transient dynamics, resulting in larger errors up to 6 K at $t=1050$ seconds and 3 K at $t=1550$ seconds.  During the period between $t=450$ and $t=900$ seconds and the period between $t=1200$ and $t=1400$ seconds, the PCM undergoes partial phase change.  Estimation errors during these periods of time are due to the phase change hysteresis and undercooling effects which delay solidification when the PCM is cooled rapidly \cite{barz_paraffins_2021}.  The system model does not account for these effects, so the estimator incorrectly predicts that CV3 (and other unmeasured control volumes) begins to solidify at 293.5 K (the top boundary of the gray shaded region in Fig.\ \ref{fig:TC3_exp_a}) whereas the PCM in the experimental TES begins to solidify at a lower temperature.  Over sufficiently long time periods during which the PCM temperatures reach equilibrium, such as $t=750$ to $t=1000$ seconds, errors caused by hysteresis and undercooling are corrected and the estimate error returns to zero.
\begin{figure}
    \centering
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_exp.pdf}
        \caption{}
        \label{fig:TC3_exp_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_exp_err.pdf}
        \caption{}
        \label{fig:TC3_exp_b}
    \end{subfigure}
    \caption{(a) Estimated temperature of CV3 compared to the measurement of TC3. (b) Estimate error for CV3.}
    \label{fig:TC3_exp}
\end{figure}

\subsection{Effect of Sample Rate}\label{sec:sample_rate}
In this section, we investigate how the SDRE filter performs when measurements are provided at four different rates: 80 samples per second (S/s), 10 S/s, 1 S/s, and 0.2 S/s.  All previous experimental and simulation results used a sample rate of 10 S/s.  The continuous-discrete SDRE filter formulation allows for more flexibility with respect to sample rates because the state estimates and the estimate covariance matrix are propagated with the state transition matrix of the continuous-time system; estimation errors introduced by discretizing the nonlinear system are mitigated by propagating the state estimates and error covariance with a time step smaller than the interval between samples. 

Fig.\ \ref{fig:TC1_exp_SR} shows (a) the estimated temperatures at CV1 and (b) the estimation errors when TC1 is excluded from the measurement set during a validation test with the experimental dataset.  As discussed in the previous section, the state estimator can track the temperature at CV1 well; this is also the case at the faster and slower sample rates.  In Fig.\ \ref{fig:TC1_exp_SR_b}, 80 S/s, 10 S/s, and 1 S/s all appear to have similar estimation errors, but 0.2 S/s produces larger error during periods of transient temperature changes.  To more easily compare the performance of the four sample rates, we calculate the root-mean-square errors for the temperature at CV1 averaged over all time steps using Eqn.\ \eqref{eq:RMSE_t} where $N_s$ is the total number of time steps in the dataset for the given sample rate. Results for the four sample rates are included in Table \ref{tab:RMSE_TC1}.  Note that this RMSE definition represents an average over all time steps, but the previous RMSE definition in Eqn.\ \eqref{eq:RMSE} averages over all control volumes.  As expected, the 80 S/s rate results in the smallest estimation error, but only by a small margin; 10 S/s results in a similar RMSE.  The slowest sample rate, 0.2~S/s, results in almost twice the RMSE of the next slowest sample rate, 1 S/s.  In the fluid channel, the control volume temperatures can change rapidly due to the high advective heat transfer rates.  The larger error in the 0.2~S/s sample rate is due to the fast dynamics of control volume CV1; the estimation error can increase quickly when update steps are not performed fast enough.
\begin{equation}\label{eq:RMSE_t}
    e_{rms,j}=\left[\sum_{k=1}^{N_{s}}\frac{\left(\hat{x}_{j}(t_k)-y_{k,j}\right)^2}{N_{s}}\right]^\frac{1}{2}
\end{equation}
\begin{table}[htbp]
\centering
\caption{RMS errors at CV1 for four sample rates}
\label{tab:RMSE_TC1}
\begin{tabular}{r|l}
Sample Rate  & $e_{rms,CV1}$ (K) \\ \hline
80 S/s         & 0.2436     \\
10 S/s         & 0.2617     \\
1 S/s          & 0.3811    \\
0.2 S/s         & 0.7526    
\end{tabular}
\end{table}

Fig.\ \ref{fig:SOC_exp_TC1_SR} shows the estimated SOC for the four sample rates.  All four estimates are similar with almost no difference outside the latent range. During the periods of partial phase change, a noticeable difference in the peak of the SOC estimate can be seen at $t=500$ seconds, $t=650$ seconds, and $t=1250$ seconds. The faster sample rates reach a sharper and higher peak SOC, suggesting that the use of a faster sample rate results in a faster response time to transient changes.
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_exp_SR.pdf}
        \caption{}
        \label{fig:TC1_exp_SR_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC1_exp_err_SR.pdf}
        \caption{}
        \label{fig:TC1_exp_SR_b}
    \end{subfigure}
    \caption{(a) Estimated temperatures of CV1 compared to the fluid outlet temperature measurement TC1. (b) Estimation errors for CV1.}
    \label{fig:TC1_exp_SR}
\end{figure}
\begin{figure}[tb]
    %\centering
    \includegraphics[width=3.1in]{Figures/Exp Results/SOC_exp_TC1.pdf}
    \caption{Estimated SOC for the four sample rates when TC1 is withheld.}
    \label{fig:SOC_exp_TC1_SR}
\end{figure}

Finally, we compare the performance of the four sample rates when TC3 is excluded from the measurement set.  Fig.\ \ref{fig:TC3_exp_SR} shows (a) the estimated temperatures at CV3 and (b) the estimation errors.  In Fig.\ \ref{fig:TC3_exp_SR_b}, it is clear that the state estimator receiving 80 S/s has a slightly smaller error most of the time.  This is noticeable at $t=500$ seconds, $t=1100$ seconds, and $t=1600$ seconds.  The RMSE of the estimate at CV3 averaged over all time steps is given in Table \ref{tab:RMSE_TC3}. The state estimator with a sample rate of 80 S/s again performs the best, but by a small margin; this time, there is only a small difference in RMSE between the fastest and slowest sample rates.  Since the thermocouple TC3 is embedded in the PCM layer, the dynamics of control volume CV3 are slower than the dynamics of CV1, which explains why sample rate has a lesser effect on RMSE at CV3 compared to the RMSE at CV1 in Table \ref{tab:RMSE_TC1}.  Note that the RMS errors in Table \ref{tab:RMSE_TC3} are larger than those in Table \ref{tab:RMSE_TC1}; this indicates that the measurement from TC3 is more critical to estimate the SOC accurately than that of TC1.  This makes sense given that TC3 is located near the center of the TES; without the measurement from TC3, only measurements of the temperatures at the periphery of the PCM layer are available. Estimation errors in CV3 and the control volumes above CV3 can be large for long time periods (greater than 2 K for more than 20 seconds, according to Fig.\ \ref{fig:TC3_exp_SR_b}) before the state estimator compensates for the errors.
\begin{figure}[tb]
    \centering
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_exp_SR.pdf}
        \caption{}
        \label{fig:TC3_exp_SR_a}
    \end{subfigure}
    \begin{subfigure}[b]{\columnwidth}
        \includegraphics[width=3.1in]{Figures/Exp Results/TC3_exp_err_SR.pdf}
        \caption{}
        \label{fig:TC3_exp_SR_b}
    \end{subfigure}
    \caption{(a) Estimated temperature of CV3 compared to the measurement of TC3. (b) Estimation errors for CV3.}
    \label{fig:TC3_exp_SR}
\end{figure}
\begin{table}[htbp]
\centering
\caption{RMS errors at CV3 for four sample rates}
\label{tab:RMSE_TC3}
\begin{tabular}{r|l}
Sample Rate & $e_{rms,CV3}$ (K) \\ \hline
80 S/s         & 1.0022     \\
10 S/s         & 1.1046     \\
1 S/s          & 1.2048     \\
0.2 S/s         & 1.3270
\end{tabular}
\end{table}

Fig.\ \ref{fig:SOC_exp_TC3_SR} shows the estimated SOC for the four sample rates when the measurement from TC3 is excluded.  The results shown in this figure are almost identical to those in Fig.\ \ref{fig:SOC_exp_TC1_SR}, except there is less difference between the 80 S/s results and the 10 S/s results.  These results demonstrate an important advantage of the continuous-discrete SDRE filter over other discrete-time state estimators.  Since the state estimates are propagated with a small time step, accuracy of the prediction step is not degraded as the time interval between update steps is increased.  Errors due to disturbances or model inaccuracies still affect the accuracy of the estimate, so update steps must be performed sufficiently often to avoid large errors during transient events.
\begin{figure}[tb]
    \centering
    \includegraphics[width=3.1in]{Figures/Exp Results/SOC_exp_TC3.pdf}
    \caption{Estimated SOC for the three sample rates when TC3 is withheld.}
    \label{fig:SOC_exp_TC3_SR}
\end{figure}