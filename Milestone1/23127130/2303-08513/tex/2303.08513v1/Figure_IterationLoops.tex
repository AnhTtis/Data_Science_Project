

\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,738); %set diagram left start at 0, and has height of 738

%Straight Lines [id:da8081118349493732] 
\draw [line width=1.5]    (310,128) -- (310,68) -- (800,68) -- (800,124) ;
\draw [shift={(800,128)}, rotate = 270] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da7387815673606071] 
\draw [line width=1.5]    (801,443) -- (801,503) -- (675,503) ;
\draw [shift={(671,503)}, rotate = 360] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da5031191250715479] 
\draw [line width=1.5]    (310,480) -- (310,444) ;
\draw [shift={(310,440)}, rotate = 90] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da8910192304057465] 
\draw [line width=1.5]    (560,523) -- (560,559) ;
\draw [shift={(560,563)}, rotate = 270] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Shape: Rectangle [id:dp24507094746482783] 
\draw  [dash pattern={on 1.69pt off 2.76pt}][line width=1.5]  (281,480) -- (341,480) -- (341,523) -- (281,523) -- cycle ;
%Straight Lines [id:da14827497852618077] 
\draw [line width=1.5]    (450,502) -- (344,502) ;
\draw [shift={(340,502)}, rotate = 360] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;


%  ------------------------------------------------------------------------------

% Text Node
\draw  [line width=1.5]   (118,128) -- (502,128) -- (502,442) -- (118,442) -- cycle  ;
\draw (310,285) node   [align=left] {\begin{minipage}[lt]{258.4pt}\setlength\topsep{0pt}
\large 
\setstretch{1.15}
\begin{center}
\textbf{Flow solver}
\end{center}
\vspace{0.1cm}
$\text{converged}^f=false$ \tabto{5cm} \textcolor{gray}{// initialization}\\
\textbf{do} $\displaystyle i=1,...,n_{max}^{f}$     \tabto{5cm} \textcolor{gray}{// subproblem iteration}\\
% \vspace{0.1cm}
\tabto{0.5cm} $\displaystyle \mathbf{A}^{i-1} = \mathbf{A}\left(\mathbf{u}^{i-1}\right)$  \tabto{5cm} \textcolor{gray}{// assemble system}\\	
\tabto{0.5cm} $\displaystyle \resFlow^{i-1} \,\,=\mathbf{b} -\mathbf{A}^{i-1} \ \mathbf{u}^{i-1}$ \tabto{5cm} \textcolor{gray}{// evaluate residual}\\	
\tabto{0.5cm} $\displaystyle \mathbf{u}^i \,= \mathbf{A}^{i-1} \, \backslash \, \mathbf{b}$ \tabto{5cm} \textcolor{gray}{// update solution}\\	
\tabto{0.5cm} \textbf{if} $\displaystyle \norm{\resFlow^{i-1}} < \varepsilon ^{f}$ \textbf{then} \tabto{5cm} \textcolor{gray}{// check convergence}\\
\tabto{1.0cm} \textbf{if} $i == 1$ \textbf{then} \tabto{5cm} \textcolor{gray}{// check if 1st residual} \\  	
\tabto{1.5cm} $\text{converged}^f = true$  \tabto{5cm} \textcolor{gray}{// set convergence flag}\\  
\tabto{1.0cm} \textbf{end if}       \\
\tabto{1.0cm} break                      \tabto{5cm}  \textcolor{gray}{// leave iteration loop}\\
\tabto{0.5cm} \textbf{end if}\\
\textbf{end do}\\                       
% $\text{iter}^f = i$             \tabto{5cm} \textcolor{gray}{// save iteration count}  \\
$\displaystyle \uv^{0} =\uv^{i}$    \tabto{5cm} \textcolor{gray}{// prepare next call}
\end{minipage}};
% 
% \large 
% \setstretch{1.1}
% \begin{center}
% \textbf{Flow Solver}
% \end{center}
% \vspace{0.2cm}
% $\text{converged}^f=false$ \tabto{5cm} \textcolor{gray}{// initialization}\\
% \textbf{do} $\displaystyle i=1,...,n_{max}^{f}$     \tabto{5cm} \textcolor{gray}{// subproblem iteration}\\
% % \vspace{0.1cm}
% \tabto{0.5cm} $\displaystyle \mathbf{A}^i = \mathbf{A}\left(\mathbf{u}^{i-1}\right)$  \tabto{5cm} \textcolor{gray}{// assemble system}\\	
% \tabto{0.5cm} $\displaystyle \mathbf{r}^{i} \,\,=\mathbf{b} -\mathbf{A}^i \ \mathbf{u}^{i-1}$ \tabto{5cm} \textcolor{gray}{// evaluate residual}\\	
% \tabto{0.5cm} $\displaystyle \mathbf{u}^i \,= \mathbf{A} \, \backslash \, \mathbf{b}$ \tabto{5cm} \textcolor{gray}{// solve linear system}\\	
% \tabto{0.5cm} \textbf{if} $\displaystyle r^{i} < \varepsilon ^{f}$ \textbf{then} \tabto{5cm} \textcolor{gray}{// check convergence}\\
% \tabto{1.0cm} $\text{converged}^f = true$  \tabto{5cm} \textcolor{gray}{// set convergence flag}\\  
% \tabto{1.0cm} exit                      \tabto{5cm}  \textcolor{gray}{// leave iteration loop}\\	
% \tabto{0.5cm} \textbf{end if}\\
% \textbf{end do}\\                       
% $\text{iter}^f = i$             \tabto{5cm} \textcolor{gray}{// save iteration count}  \\
% $\displaystyle u^{0} =u^{i}$    \tabto{5cm} \textcolor{gray}{// prepare next call}
% \end{minipage}};
% 
% %%%%%
% \ \\
% \textbf{subproblem iteration:} \tabto{5cm} do $\displaystyle i=1,...,n_{max}^{f}$\\
% \vspace{0.1cm}
% \tabto{0.5cm} Assemble matrix:		\tabto{5.5cm} $\displaystyle \mathbf{A} = \mathbf{A}\left(\mathbf{u}^{i-1}\right)$\\	
% \tabto{0.5cm} Evaluate residual: 	\tabto{5.5cm} $\displaystyle \mathbf{r}^{i} =\mathbf{b} -\mathbf{A}\left(\mathbf{u}^{i-1}\right) \ \mathbf{u}^{i-1}$\\	\tabto{0.5cm} Solve linear system:		\tabto{5cm} $\displaystyle \mathbf{A} \, \mathbf{u}^i = \mathbf{b}$ \\	
% \tabto{0.5cm} Check convergence:  \tabto{5.5cm} if $\displaystyle r^{i} < \varepsilon ^{f}$:\\		
% \tabto{1.0cm} Set convergence flag  \tabto{5.5cm} $\text{converged}^f = true$\\		
% \tabto{1.0cm} fluidIter = i\\		
% \tabto{1.0cm} exit\\	
% \tabto{0.5cm} end if\\
% end do\\
% $\displaystyle u^{0} =u^{i}$
% \end{minipage}};



% Text Node
\draw  [line width=1.5]   (608,128) -- (992,128) -- (992,442) -- (608,442) -- cycle  ;
\draw (800,285) node   [align=left] {\begin{minipage}[lt]{258.4pt}\setlength\topsep{0pt}
\large 
\setstretch{1.15}
\begin{center}
\textbf{Solid solver}
\end{center}
\vspace{0.1cm}
$\text{converged}^s=false$ \tabto{5cm} \textcolor{gray}{// initialization}\\
\textbf{do} $\displaystyle i=1,...,n_{max}^{s}$     \tabto{5cm} \textcolor{gray}{// subproblem iteration}\\
% \vspace{0.1cm}
\tabto{0.5cm} $\displaystyle \mathbf{A}^{i-1} = \mathbf{A}\left(\mathbf{u}^{i-1}\right)$  \tabto{5cm} \textcolor{gray}{// assemble system}\\	
\tabto{0.5cm} $\displaystyle \resSolid^{i-1} \,\,=\mathbf{b} -\mathbf{A}^{i-1} \ \mathbf{u}^{i-1}$ \tabto{5cm} \textcolor{gray}{// evaluate residual}\\	
\tabto{0.5cm} $\displaystyle \mathbf{u}^i \,= \mathbf{A}^{i-1} \, \backslash \, \mathbf{b}$ \tabto{5cm} \textcolor{gray}{// update solution}\\	
\tabto{0.5cm} \textbf{if} $\displaystyle \norm{\resSolid^{i-1}} < \varepsilon ^{s}$ \textbf{then} \tabto{5cm} \textcolor{gray}{// check convergence}\\
\tabto{1.0cm} \textbf{if} $i == 1$ \textbf{then} \tabto{5cm} \textcolor{gray}{// check if 1st residual} \\  	
\tabto{1.5cm} $\text{converged}^s = true$  \tabto{5cm} \textcolor{gray}{// set convergence flag}\\  
\tabto{1.0cm} \textbf{end if}       \\
\tabto{1.0cm} break                      \tabto{5cm}  \textcolor{gray}{// leave iteration loop}\\
\tabto{0.5cm} \textbf{end if}\\
\textbf{end do}\\                       
% $\text{iter}^f = i$             \tabto{5cm} \textcolor{gray}{// save iteration count}  \\
$\displaystyle \uv^{0} =\uv^{i}$    \tabto{5cm} \textcolor{gray}{// prepare next call}
\end{minipage}};


% Text Node
\draw (509,48) node [anchor=north west][inner sep=0.75pt]   [align=left] {\large {Coupling loop}};

% Text Node
\draw  [dash pattern={on 1.69pt off 2.76pt}][line width=1.5]   (448,480) -- (672,480) -- (672,524) -- (448,524) -- cycle  ;
\draw (560,502) node   [align=left] {\begin{minipage}[lt]{149.6pt}\setlength\topsep{0pt}
\large
\begin{center}
\textbf{if}
$\text{converged}^f \textbf{ and } \text{converged}^s$ 
\end{center}

\end{minipage}};
% Text Node
%\draw (519,568) node [anchor=north west][inner sep=0.75pt]   [align=center] {\large{Next Time Step}};
\draw (509,568) node [anchor=north west][inner sep=0.75pt]   
[align=left] {\large{Next time step}};
% Text Node
\draw (570,530) node [anchor=north west][inner sep=0.75pt]   [align=left] {\textbf{then}};
% Text Node
\draw (415,483) node [anchor=north west][inner sep=0.75pt]   [align=left] {\textbf{else}};

% Text Node
\draw (297,494) node [anchor=north west][inner sep=0.75pt]   [align=left] {\large{IQN}};



\end{tikzpicture}
