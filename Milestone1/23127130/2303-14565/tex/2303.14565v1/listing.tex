\usepackage{listings}

\usepackage{color}
\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{darkblue}{rgb}{0.0,0.0,0.8}
\definecolor{cyan}{rgb}{0.0,0.6,0.6}
\definecolor{orange}{rgb}{0.8,0.4,0.0}
\definecolor{lightgreen}{rgb}{0.0,0.8,0.3}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.3,0,0.52}
\definecolor{codepink}{rgb}{0.8, 0.35, 0.7}
\definecolor{lightblue}{rgb}{0.0,0.3,0.7}

% define XML
\lstset{
  basicstyle=\small\ttfamily\color{black},
  columns=fullflexible,
  showstringspaces=false,
  commentstyle=\color{gray}\upshape,
  frame=single,
  captionpos=b
}
\lstdefinelanguage{XML}{
    moredelim=[s][\color{cyan}]{\ }{=},
    moredelim=[s][\color{black}]{>}{<},
    morestring=[b]",
    morecomment=[s]{?}{?},
    morecomment=[s]{!--}{--},
    stringstyle=\color{orange},
    identifierstyle=\color{darkblue},
    keywordstyle=\color{cyan},
    morekeywords={xmlns,version,type}
}

% \lstdefinestyle{xml-style}{language=XML, extendedchars=true,  belowcaptionskip=5pt, xleftmargin=1.8em, xrightmargin=0.5em, numbers=left, numberstyle=\small\ttfamily\bf, frame=single, breaklines=true, breakatwhitespace=true, breakindent=0pt, emph={}, emphstyle=\color{red}, basicstyle=\small\ttfamily, columns=fullflexible, showstringspaces=false, commentstyle=\color{gray}\upshape,
%     morestring=[b]",
%     morecomment=[s]{<?}{?>},
%     morecomment=[s]{<!--}{-->},
%     stringstyle=\color{orange},
%     identifierstyle=\color{darkblue},
%     keywordstyle=\color{cyan},
%     morekeywords={xmlns,version,type}
% }


% define json
\newcommand{\jsonkey}{\small\color{darkblue}}
\newcommand{\jsonvalue}{\small\color{orange}}
\newcommand{\jsonnumber}{\small\color{cyan}}
\newcommand{\jsonbool}{\small\color{codegreen}}

% switch used as state variable
\makeatletter
\newif\ifisvalue@json
\newif\ifisarray@jsonArray

\lstdefinelanguage{json}{
    tabsize             = 4,
    showstringspaces    = false,
    keywords            = {false,true},
    alsoletter          = 0123456789.,
    morestring          = [s]{"}{"},
    stringstyle         = \jsonkey\ifisvalue@json\jsonvalue\fi\ifisarray@jsonArray\jsonvalue\fi,
    keywordstyle        = \jsonbool,
    MoreSelectCharTable = \lst@DefSaveDef{`:}\colon@json{\enterMode@json},
    MoreSelectCharTable = \lst@DefSaveDef{`,}\comma@json{\exitMode@json{\comma@json}} \ifisarray@jsonArray\array@json{\enterMode@json}\fi,
    MoreSelectCharTable = \lst@DefSaveDef{`\{}\bracket@json{\exitMode@json{\bracket@json}},
    MoreSelectCharTable = \lst@DefSaveDef{`\{}\bracket@jsonArray{\exitMode@jsonArray{\bracket@jsonArray}},
    MoreSelectCharTable = \lst@DefSaveDef{`[}\lb@jsonArray{\enterMode@jsonArray{\lb@jsonArray}},
    MoreSelectCharTable = \lst@DefSaveDef{`]}\rb@jsonArray{\exitMode@jsonArray{\rb@jsonArray}},
    basicstyle          = \small\ttfamily
}

% enter "value" mode after encountering a colon
\newcommand\enterMode@json{%
    \colon@json%
    \ifnum\lst@mode=\lst@Pmode%
        \global\isvalue@jsontrue%
    \fi
}

% leave "value" mode: either we hit a comma, or the value is a nested object
\newcommand\exitMode@json[1]{#1\global\isvalue@jsonfalse}

\lst@AddToHook{Output}{%
    \ifisvalue@json%
        \ifnum\lst@mode=\lst@Pmode%
            \def\lst@thestyle{\jsonnumber}%
        \fi
    \fi
    %override by keyword style if a keyword is detected!
    \lsthk@DetectKeywords% 
}

% enter "value" mode after encountering a colon
\newcommand\enterMode@jsonArray{%
    \lb@jsonArray%
    \ifnum\lst@mode=\lst@Pmode%
        \global\isarray@jsonArraytrue%
    \fi
}

% leave "value" mode: either we hit a comma, or the value is a nested object
\newcommand\exitMode@jsonArray[1]{#1\global\isarray@jsonArrayfalse}

\lst@AddToHook{Output}{%
    \ifisarray@jsonArray%
        \ifnum\lst@mode=\lst@Pmode%
            \def\lst@thestyle{\jsonnumber}%
        \fi
    \fi
    %override by keyword style if a keyword is detected!
    \lsthk@DetectKeywords% 
}



% define python
\newcommand{\lstsetblack}{
    \exitMode@json{}
    \exitMode@jsonArray{}
}
\lstdefinestyle{pythonstyling}{
language=Python,
keywords={from,import},
basicstyle=\small\ttfamily\color{black},
morekeywords={self},              % Add keywords here
keywordstyle=\color{codepink},
identifierstyle=\color{lightblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\color{darkblue},    % Custom highlighting style
stringstyle=\color{orange},
commentstyle=\color{codegreen},
frame=single,                         % Any extra options here
showstringspaces=false
}
