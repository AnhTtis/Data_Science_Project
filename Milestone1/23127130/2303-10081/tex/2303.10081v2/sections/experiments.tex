%!TEX root = ../main.tex


\section{Applications and Experiments}
\label{sec:experiments}

In this section, we apply our verification and synthesis method to the controlled Van der Pol oscillator. We first consider a Van der Pol oscillator without uncertainty (Section~\ref{sec:cleanvanderpol}) and show that our algorithm readily reproduces the circular CBF in~\cite{clark22arxiv-cbf}. With uncertainty (Section~\ref{sec:uncertainvanderpol}), we show how to synthesize elliptical robust CBFs with a strictly positive value function.

\subsection{A Gentle Start: Clean Van der Pol Oscillator}
\label{sec:cleanvanderpol}
Consider a clean controlled Van der Pol Oscillator~\cite{clark22arxiv-cbf}
\bea \label{eq:cleanvdpodynamics}
\dx = \bmat{c}
\dx_1 \\
\dx_2 \emat 
\!=\! \bmat{c}
x_2 \\
\frac{1}{2} (1-x_2^2) x_2  -x_1
\emat + \bmat{c}
0 \\
x_1 
\emat u.
\eea
Let 
\begin{equation}\label{eq:cleanvdpou}
        \bbU = \{u \in \Real{} \mid u^2 - u_\max^2 \leq 0 \}. 
\end{equation}

{\bf Circular CBF}. Consider a circular CBF candidate
\bea \label{eq:cleanvdpocbf}
b(x,\theta) = \theta - \norm{x}^2, \quad \theta \in \Theta := [0,\theta_\max].
\eea
\kscedit{Clearly, }Assumption~\ref{assume:archimedeanness} holds and Appendix~\ref{app:bound:y:cleanvdp} computes the bound for $y$ in POP~\eqref{eq:verifypop}.

{\bf Verification}. 
We choose $u_\max = 5, \theta_\max = 2$, and solve the $\kappa=4$ SDP relaxation of the verification POP~\eqref{eq:standardpop}.\footnote{We use the SDP relaxation implementation provided in \url{https://github.com/MIT-SPARK/CertifiablyRobustPerception}, and solve the SDP using MOSEK.} Fig.~\ref{fig:vanderpol_clean}(a) blue dotted line plots the values of the SDP relaxation at samples $\theta = 0,0.1,0.2,\dots,2.0$. In all cases, the SDP relaxation is tight and can recover the global optimizers of the verification POP~\eqref{eq:standardpop}. For example, when $\theta = 0.1$, $x^\star = [0;\pm 0.3162]$ attains the global minimum $V(\theta) = -0.09$; when $\theta = 1.1$, $x^\star = [\pm 1.0488;0]$ attains the global minimum $V(\theta) = 0$. From Fig.~\ref{fig:vanderpol_clean}(a) blue dotted line, we observe that $b(x,\theta)$ is a valid CBF for $\theta=0$ and $\theta \geq 1$, which agrees with the result from~\cite{clark22arxiv-cbf}. However, our verification algorithm can do better than that of~\cite{clark22arxiv-cbf}: when $b(x,\theta)$ is not valid for $\theta \in (0,1)$, our algorithm recovers the $x^\star$ that attains a negative $V(\theta)$, while the SOS-based method~\cite{clark22arxiv-cbf} becomes infeasible without producing a witness. 

\input{sections/fig-vanderpol_clean.tex}

{\bf Synthesis}.
We solve the SOS program~\eqref{eq:soslowerbound} at $\nu = 3,4,5,6$ to find polynomial lower bounds for $V(\theta)$. Appendix~\ref{sec:app:computemoments} describes how to compute the moments $\gamma_\beta$ in~\eqref{eq:computemoments}. Fig.~\ref{fig:vanderpol_clean}(a) solid lines plot the computed $V_\nu(\theta)$ for $\nu = 3,4,5,6$. The polynomial lower bounds approximate the unknown $V(\theta)$ very well (except near $\theta=1$ where $V(\theta)$ is nonsmooth). 

We then seek to maximize each $V_\nu(\theta)$ via Lasserre's hierarchy with $\kappa = \nu + 2$. At $\nu=3$, we obtain $\theta_\nu^\star = \{ 1.3997;1.8806 \}$ with $V_\nu^\star = \{1.2\times 10^{-8},3.2 \times 10^{-8} \}$. At $\nu=4$, we obtain $\theta_\nu^\star = \{ 1.3275 \}$ with $V_\nu^\star = \{-3.9\times 10^{-6} \}$. At $\nu=5$, we obtain $\theta_\nu^\star = \{ 1.2638, 1.6770, 1.9359 \}$ with $V_\nu^\star = \{-2.2\times 10^{-6}, -1.8\times 10^{-6}, 8.8 \times 10^{-6} \}$. At $\nu=6$, we obtain $\theta_\nu^\star = \{ 0,1.2280 \}$ with $V_\nu^\star = \{-7.8\times 10^{-6}, -7.4\times 10^{-8}\}$. These solutions are plotted as red stars in Fig.~\ref{fig:vanderpol_clean}(a).

{\bf Refined synthesis}. Since now we know the unknown $V(\theta)$ is nonsmooth at $\theta=1$, we can refine our synthesis by computing lower bound polynomials separately in $\Theta_1 = [0,1]$ and $\Theta_2 = [1,\theta_\max]$. Fig.~\ref{fig:vanderpol_clean}(b) shows the synthesized polynomial lower bounds $V_\nu (\theta)$ (we connect the curves in $\Theta_1$ and $\Theta_2$). Observe these lower bounds are perfectly tight!

Verification and synthesis of the one-dimensional $V(\theta)$ illustrates how our algorithm works. With these insights, we are ready to study the uncertain Van der Pol oscillator. 


\subsection{Uncertain Van der Pol Oscillator}
\label{sec:uncertainvanderpol}
Consider system~\eqref{eq:cleanvdpodynamics} with uncertainty
\bea \label{eq:vdpodynamics}
\dx 
\!=\! \bmat{c}
x_2 \\
\frac{1}{2} (1-x_2^2) x_2  -x_1
\emat + \bmat{c}
0 \\
x_1 
\emat u + \bmat{c} 0 \\ 1 \emat \epsilon,
\eea 
with the same $\bbU$ as~\eqref{eq:cleanvdpou}. 

We can consider the same circular CBF candidate as in~\eqref{eq:cleanvdpocbf} and perform verification and synthesis. However, as we have seen in Section~\ref{sec:cleanvanderpol}, the maximum possible $\dot{b}(x,\theta)$ on the boundary $\partial \calC$ is zero, \ie $V^\star = 0$ for the synthesis problem~\eqref{eq:cbfsynthesis}. This is also true for the uncertain system.

\begin{proposition}\label{prop:wrongvdpocbf}
    $V(\theta) \leq 0, \forall \theta \geq 0$ for system~\eqref{eq:vdpodynamics} with the circular CBF candidate~\eqref{eq:cleanvdpocbf}.
\end{proposition}
\begin{proof}
    See Appendix~\ref{app:proofwrongvdpocbf}. \hfill \qedsymbol
\end{proof}

Can we find a robust CBF with strictly positive $V(\theta)$?

{\bf Elliptical robust CBF}.
Let us consider the following elliptical robust CBF candidate
\bea \label{eq:ellipsoidalcbf}
b(x,\theta)\! =\! 1\! -\! x\tran \underbrace{\bmat{cc}
\theta_1 & \theta_3 \\
\theta_3 & \theta_2 
\emat}_{:=A} x\!
\eea 
with parameter space
\bea \label{eq:ellipsoidalparam}
\Theta := \cbrace{\theta \in \Real{3} \mid \theta_1, \theta_2  \in [\thetalb,\thetaub]^2, \theta_3^2 \leq \xi^2 \theta_1 \theta_2},
\eea 
where $0 < \thetalb < \thetaub$ and $ 0 < \xi <1$. Clearly, $A \succ 0$ for all $(\theta_1,\theta_2,\theta_3) \in \Theta$ and $b(x,\theta)$ defines the boundary of an ellipse. Moreover, Assumption~\ref{assume:archimedeanness} holds and Appendix~\ref{app:bound:y:uncertainvdp} computes the bound for $y$ in POP~\eqref{eq:verifypop}. We will obtain $V(\theta) > 0 $ with this CBF candidate.


{\bf Synthesis}. Unlike Section~\ref{sec:cleanvanderpol} where it is easy to generate a few $\theta$ to evenly cover the parameter space $\Theta = [0,\theta_\max]$, the parameter space~\eqref{eq:ellipsoidalparam} would need a lot of samples to be covered. Therefore, we directly synthesize polynomial lower bounds $V_\nu(\theta)$ with $u_\max=5, M_\epsilon=0.1,\thetalb=0.25,\thetaub=0.75,\xi = 0.6$. (i) At $\nu = 3$, Fig.~\ref{fig:vanderpol_uncertain}(a) densely scatters samples of $\theta$ with $V_{\nu}(\theta)\geq 0$. The colormap shows that many samples (\eg the yellow points) have $V_{\nu}(\theta)$ being strictly positive. Particularly, the global maximum of $V_\nu(\theta)$ over $\Theta$ is attained at $\theta^\star_\nu = [0.2500;0.2757;0.1323]$ with value $V^\star_\nu = 0.2376$. (ii) Fig.~\ref{fig:vanderpol_uncertain}(b) shows the same scatter plot for $\nu = 4$. We see the set of elliptical robust CBFs that can be verified becomes much larger. The global maximum of $V_\nu(\theta)$ is attained at $\theta^\star_\nu = [0.3278;0.2500;0.1718]$ with value $V^\star_\nu = 1.0606$.

{\bf Smallest and largest ellipse}. What if we want to find the robust CBF that leads to the smallest ellipse? We can solve
\bea  
\max_{\theta \in \Theta} \{ \det{A} = \theta_1 \theta_2 - \theta_3^2  \mid V_\nu(\theta) \geq 0\}.
\eea 
Optimizing this for $V_3(\theta)$ via Lasserre's hierarchy at $\kappa=4$, we recover the best parameter $\theta_1=0.4714,\theta_2=0.5236,\theta_3 = 0.0893$. Similarly, $\theta_1=0.25,\theta_2=0.25,\theta_3 = 0.15$ minimizes $\det{A}$ and gives the largest ellipse.

\input{sections/fig-vanderpol_uncertain.tex}


