% !TEX root = main.tex
\section{Proofs from \refsect{vsc} (The Value Substitution Calculus)}
\label{app:app-vsc}
In this Appendix, we give the definition of \cbn and \cbv inscrutable terms, prove that \cbv inscrutable terms coincide with \cbv $\Omega$ terms, to then connect with the diverging characterization of \cbv inscrutable terms due to with \cbv $\Omega$-terms.

\paragraph{Definition of \cbn and \cbv Inscrutable Terms}
\begin{definition}[Testing contexts and \cbn/\cbv (in)scrutability]
\label{def:cbn-scrutability}
Testing context are defined by:
\begin{center}
\textsc{Testing contexts}  \ \ \ $\tctx \grameq \ctxhole \mid \tctx \tm \mid (\la\var\tctx)\tm$
\end{center}
A $\l$-term $\tm$ is \emph{\cbn scrutable} if there is a testing context $\tctx$ and a value $\val$ such that $\tctxp\tm \tob^* \val$, that is, a variable or an abstraction, otherwise $\tm$ is \emph{\cbn inscrutable}.

A $\l$-term $\tm$ is \emph{\cbv scrutable} if there is a testing context $\tctx$ and a value $\val$ such that $\tctxp\tm \tobv^* \val$, otherwise $\tm$ is \emph{\cbv inscrutable}.
\end{definition}

 
\paragraph{\cbv Inscrutable Terms Coincide with \cbv $\Omega$-terms} It is obtained via the following proposition, based on an auxiliary lemma.

\begin{lemma}
\label{l:Omega-testing-diverging}
Let $\tctx$ be a testing context. Then $\tctxp\Omega$ is $\tovsc$-diverging.
\end{lemma}

\begin{proof}
By induction on $\tctx$. Cases:
\begin{itemize}
\item \emph{Empty}, that is $\tctx = \ctxhole$. Trivial.
\item \emph{Application}, that is $\tctx = \tctxtwo \tm$. It follows by the \ih and the fact that $\ctxhole\tm$ is an evaluation context.
\item \emph{Applied abstraction}, that is $\tctx = (\la\var\tctxtwo) \tm$. Then $\tctxp\Omega = (\la\var\tctxtwop\Omega) \tm \tom \tctxtwop\Omega\esub\var\tm$. By \ih, $\tctxtwop\Omega$ is $\tovsc$-diverging and $\ctxhole\esub\var\tm$ is an evaluation context, thus  $\tctxtwop\Omega\esub\var\tm$, and so $\tctxp\Omega$, is $\tovsc$-diverging.\qedhere
\end{itemize}
\end{proof}

\begin{proposition}[\cbv inscrutable terms = \cbv $\Omega$-terms]
\label{prop:cbv-inscr-equal-cbv-omega}
A term $\tm$ is \cbv inscrutable if and only if it is a \cbv $\Omega$-term.
\end{proposition}

\begin{proof}
\hfill
\begin{itemize}
\item \emph{Direction $\Rightarrow$.}
In \cite{DBLP:journals/pacmpl/AccattoliG22}, it is proved that all \cbv inscrutable terms are \cbv contextually equivalent (therein it is Proposition 6.3 and Corollary 6.4, page 17). 

\item \emph{Direction $\Leftarrow$.} In \cite{DBLP:journals/pacmpl/AccattoliG22}, it is proved that \cbv scrutability in Plotkin's calculus and in the VSC coincide (therein it is Theorem 5.5, page 14), that is one can replace $\tobv$ with $\tovsc$ in \refdef{cbn-scrutability} without changing the definition. Moreover, Plotkin's calculus and the VSC have also the same contextual equivalence. Thus, we here use the VSC.

Suppose by contradiction that $\tm$ is not \cbv inscrutable, that is, that there is a testing context $\tctx$ such that $\tctxp\tm \tovsc^*\val$. By \reflemma{Omega-testing-diverging}, $\tctxp\Omega$ is $\tovsc$-diverging. Since $\tm$ and $\Omega$ are contextually equivalent (and contextual equivalence is defined using closing contexts), $\tctxp\tm$ has to be an open term. Let $\fv{\tctxp\tm} =\set{\var_1, \ldots, \var_n}$ and consider the closed testing context $\tctxtwo \defeq \la{\var_n}(\ldots(\la{\var_1}\tctx)\Id\ldots)\Id$. By stability of $\tovsc$ reduction under substitution of values (\refprop{substitutivity_vsce}), we have:
\begin{center}$
\tctxtwop\tm = \la{\var_n}(\ldots(\la{\var_1}\tctxp\tm)\Id\ldots)\Id \tovsc^* \tctxp\tm\isub{\var_1}\Id\ldots \isub{\var_n}\Id \tovsc^* \val\isub{\var_1}\Id\ldots \isub{\var_n}\Id
$\end{center}
which is a closed value, while $\tctxtwop\Omega$ diverges, again by \reflemma{Omega-testing-diverging}. Thus, $\tm$ and $\Omega$ are not contextually equivalent, absurd.\qedhere
\end{itemize}
\end{proof}

\paragraph{Diverging Characterization of $\Omega$-Terms} We first recall the diverging characterization of \cbv inscrutable terms due to \cite{accattoli+paolini-vsc}.

\begin{theorem}[VSC diverging characterization of \cbv inscrutability, \cite{accattoli+paolini-vsc}]
	\label{thm:cbv-scrutability-characterization-bis}
A term $\tm$ is \cbv inscrutable if and only if $\tm$ is $\tovsc$ diverging.
\end{theorem}

\gettoappendix{thm:cbv-scrutability-characterization}
\begin{proof}
It follows from \refthm{cbv-scrutability-characterization-bis} and \refprop{cbv-inscr-equal-cbv-omega}.
\end{proof}
