% !TEX root = main.tex
\section{Proofs from \refsect{enf} (Lassen's eager normal form simulation)}
In this sections, we give the proof of \refprop{enf-validation-of-equivalences} concerning shuffling equivalences, detailing the $\equivsone$ case. The case for $\equivsthree$, the restricted left-to-right version of $\equivexsthree$, is similar.


\begin{lemma}
	\label{l:equivsone-is-included-in-enf}
	$\tm \equivsone \tmp$ then $\tm \enfbisim \tmp$.
\end{lemma}
\begin{proof}
	We prove that $\relsym = Id \cup \{(\tm,\tmp) \mid \tm \equivsone \tmp \}$ is an \enf bisimulation. First note that $Id \subseteq \openfp{Id}$ and $sym(Id) \subseteq \openfp{sym(Id)}$. We show that $\{(\tm,\tmp) \mid \tm \equivsone \tmp \} \subseteq \relenf$ (and the same reasoning shows that $sym(\relsym)$ is also an enf simulation).
	
	Let $(\tmrone,\tmrtwo)=(((\la\var\tm)\tmtwo)\tmthree,(\la\var\tm\tmthree)\tmtwo) \in\relsym$.
	\begin{itemize}
		\item If $\tmtwo \bswleftdiv$, then $\tmrone$ and $\tmrtwo$ diverge, hence $(\tmrone,\tmrtwo) \in \relenf$ by case (enf 1).
		\item If $\tmtwo \bswleft k \val$, then $\tmrone \tolw^{k+1} \tm\isub\var\val\tmthree$  and $\tmrtwo \tolw^{k+1} (\tm\tmthree)\isub\var\val$. We conclude $(\tmrone,\tmrtwo) \in \relenf$ because they both reduce to $\tm\isub\var\val\tmthree = (\tm\tmthree)\isub\var\val$ -- indeed $\var\not\in\fv\tmthree$) hence have the same normal form ($Id$ part of the relation $\relsym$).
		\item If $\tmtwo \bswleft k \levctxp {\vartwo\val}$, then $\tmrone \bswleft k ((\la\var\tm)\levctxp {\vartwo\val})\tmthree$ and $\tmrtwo \bswleft k (\la\var\tm\tmthree)\levctxp {\vartwo\val}$. By case (enf 4), $(\tmrone,\tmrtwo) \in \relenf$ since $\val \rel \val$ and $((\la\var\tm)\levctxp {\varthree})\tmthree \rel (\la\var\tm\tmthree)\levctxp {\varthree}$ (because $\{(\tm,\tmp) \mid \tm \equivsone \tmp \} \subseteq \relsym$).
	\end{itemize}	
	Hence the result by coinduction.
\end{proof}

%\begin{lemma}
%	$\tm \rtosthree \tmp$ then $\tm \enfbisim \tmp$.
%\end{lemma}
%
%\begin{proof}
%	Same reasoning that for $\sigma_1$.
%\end{proof}


\gettoappendix{prop:enf-validation-of-equivalences}

\begin{proof} Moggi's equivalences proofs are straightforward, and already included in Lassen's original paper \cite{LassenEnf}. 
	
	We deduce the result for the shuffling equivalences by an easy coinductive argument described in \reflemma{equivsone-is-included-in-enf} for $\equivsone$. For $\equivsthree$, the argument is similar.
	
	Counterexamples for the other equivalences are easy to come up with.
\end{proof}



