% !TEX root = main.tex

\section{Proof of Compatibility for \nafex and \net Similarity}
\label{chapter:proof-compatibility-nafex}
The proof follows the same structure as in the case of \naf simulations. We prove the general statement for $\equivx$ a mirror.


\subsection{Lemmas concerning $\equivx$}


\begin{proposition}[$\opnafex\cdot\equivx\subseteq\opnafex$]
	\label{prop:relnafex-equivx-subseteq-relnafex}
	Let $\relsym$ be a relation on terms.
	If $\tm \relnafex \tmtwo$ and there exists $\tmtwop$ such that $\tmtwo \equivx \tmtwop$, then $\tm \relnafex \tmtwop$.
\end{proposition}

\begin{proof}
	By case analysis on $\tm \mlasrelnafex \tmtwo$.
\end{proof}


\begin{proposition}[$\equivx$ is a strong commutation wrto $\tovsc$]
	\label{prop:equivx-is-a-strong-bisimulation}
	If $\tm\equivx\tmtwo$ and $\tm \tovsc \tmp$ then $\tmtwo \tovsc \tmtwop$ and $\tmp\equivx\tmtwop$.
\end{proposition}


\begin{proposition}[$\equivx$ preserves normal forms]
	\label{prop:equivx-preserves-normal-forms}
	$\forall \tm,\tmtwo,~ \tm\equivx\tmtwo$ and $\tm$ is a normal form implies $\tmtwo$ is a normal form.
\end{proposition}

\begin{proof}
	This is derived from the fact that $\equivx$ is a strong commutation wrto $\tovsc$.
\end{proof}


\begin{proposition}[$\equivx$ is substitutive]
	\label{prop:equivx-is-substitutive}
	$\forall \tm,\tmtwo,\val,~ \tm\equivx\tmtwo$ implies $\tm\isub\var\val\equivx\tmtwo\isub\var\val$
\end{proposition}
\subsection{Compatibility proof}

A useful tool in the proof is substitutivity, with respect to small-step and big-step semantics, that is Proposition \ref{prop:substitutivity_vsce}.



\begin{proposition}[Substitutivity of $\tovsc$]
	\label{l:stability_vsce}
	$\tm\tovsc\tmp \Rightarrow \tm\isubst\val\var \tovsc \tmp\isubst\val\var$
\end{proposition}

\begin{proof}
	By induction on $\tm\tovsc\tmp$ (induction on contexts), using the fact that a value where a variable is substituted by a value is still a value.
\end{proof}

\begin{lemma}[Substitutivity of $\bsvscts$]
	\label{l:splitting_vsce}
	Forall $\tm,\val$,
	
	$\tm\isubst\val\var \bsvsct k \ntm \implies 
	\exists k',\ntmtwo$ s.t. $ \tm \bsvsct {k'} \ntmtwo$ and $\ntmtwo\isubst\val\var\bsvsct {k-k'} \ntm$
	
	
\end{lemma}

\begin{proof}
	Suppose $\tm\isubst\val\var \bsvsct k \ntm$, then $ \tm \bsvscts \ntmtwo$ because if it diverges then the first diverges as well by the stability of reduction by substitution {(\reflemma{stability_vsce})}.
	Let $k', \tm \bsvsct {k'} \ntmtwo$
	then $ \tm\isubst\val\var \tovsc^{k'}\equivsone \ntmtwo\isubst\val\var$ hence $\ntmtwo\isubst\val\var\bsvsct {k-k'} \ntm$ because the reduction $\tovsc$ is diamond (hence all reduction sequences have the same length).
\end{proof}


\subsection{Equivalence of $\mlasrelnafex$ and $\mlasrel$ on normal forms.}
As in toy's proof of compatibility, we need to show the main proof first on normal forms, then we will generalize to any term.

\begin{lemma}
	\label{l:lasrelnafex-normal-forms-lasrel-left-to-right}
	If $\fire\mlasrelnafex\firetwo$ then $\fire\mlasrel\firetwo$.
\end{lemma}
\begin{proof}
	By case analysis on $\fire =\valt \mid \var\fire\mid\itmapp\fire \mid \fire\esub\var\itm$ and using the ($\scequivx$) rule.
\end{proof}

%\begin{lemma}
%	\label{l:relnafex-to-lasrelnafex-on-normal}
%	If $\ntm\relnafex\ntmtwo$ then $\ntm\mlasrelnafex\ntmtwo$. 
%\end{lemma}
%
%\begin{proof}
%	Cases of $\ntm$.
%	\begin{itemize}
	%		\item \emph{Variable}, that is, $\ntm = \var$. Then $\ntmtwo = \var$ and $\var\mlasrelnafex\var$ by case (nafex-X 2). 
	%		\item \emph{Abstraction}, that is, $\ntm = \la\var\tm$. Then $\ntmtwo = \la\var\tmp$ with $\tm\rel \tmp$. Then $\tm\mlasrel \tmp$ by rule $(\sclift)$. Then $\la\var \tm \mlasrelnafex \la\var\tmp$ by case (nafex-X 3). 
	%		\item \emph{Applied normal form}, that is, $\ntm = \ntmONE\ntmTWO$. Then $\ntmtwo \equivx \ntmONEtwo\ntmTWOtwo$ with $\ntmONE \rel \ntmONEtwo$ and $\ntmTWO \rel \ntmTWOtwo$. By rule $(\sclift)$, $\ntmONE \mlasrel \ntmONEtwo$ and $\ntmTWO \mlasrel \ntmTWOtwo$. Then $\ntm =\ntmONE\ntmTWO \mlasrelnafex \ntmtwo$ by case (nafex 5) since $\ntmONEtwo\ntmTWOtwo \equivx \ntmtwo$.
	%		\item \emph{Substituted inert}, that is, $\ntm = \ntmONE\esub\var\itm$. Then $\ntmtwo \equivx \ntmONEtwo\esub\var\itmtwo$ with $\itm \rel \itmtwo$ and $\ntmONE \rel \ntmONEtwo$. By rule $(\sclift)$, $\itm \mlasrel \itmtwo$  and $\ntmONE \mlasrel \ntmONEtwo$. Then $\ntm = \ntmONE\esub\var\itm \mlasrelnafex \ntmtwo$ by case (nafex 6) since $ \ntmONEtwo\esub\var\itmtwo \equivx \ntmtwo$. 
	%	\end{itemize}
%\end{proof}
%
%\begin{lemma}
%	\label{l:relnafex-to-lasrel-on-normal}
%	If $\ntm\relnafex\ntmtwo$ then $\ntm\mlasrel\ntmtwo $.
%\end{lemma}
%
%\begin{proof} apply same reasoning as \ref{l:relnafex-to-lasrelnafex-on-normal}.
%	Cases of $\ntm$.
%	\begin{itemize}
	%		\item \emph{Variable}, that is, $\ntm = \var$. Then $\ntmtwo = \var$ and $\var\mlasrel\var$ by rule ($\scvar$).
	%		\item \emph{Abstraction}, that is, $\ntm = \la\var\tm$. Then $\ntmtwo = \la\var\tmp$ with $\tm\rel \tmp$. Then $\tm\mlasrel \tmp$ by rule $(\sclift)$. Then $\la\var \tm \mlasrel \la\var\tmp$ by rule ($\scabs$).
	%		\item \emph{Applied variable}, that is, $\ntm = \var\ntmONE$. Then $\ntmtwo = \var\ntmONEtwo$ with$\ntmONE \rel \ntmONEtwo$. By rule $(\sclift)$, $\ntmONE \mlasrel \ntmONEtwo$. Then $\ntm =\var\ntmONE \mlasrel \var\ntmONEtwo = \ntmtwo$ by rule ($\scapp$).
	%		\item \emph{Applied inert}, that is, $\ntm = \itm\ntmONE$. Then $\ntmtwo = \itmtwo\ntmONEtwo$ with $\itm \rel \itmtwo$ and $\ntmONE \rel \ntmONEtwo$. By rule $(\sclift)$, $\itm \mlasrel \itmtwo$  and $\ntmONE \mlasrel \ntmONEtwo$. Then $\ntm =\itm\ntmONE \mlasrel \itmtwo\ntmONEtwo = \ntmtwo$ by rule ($\scapp$).
	%		\item \emph{Substituted inert}, that is, $\ntm = \ntmONE\esub\var\itm$. Then $\ntmtwo = \ntmONEtwo\esub\var\itmtwo$ with $\itm \rel \itmtwo$ and $\ntmONE \rel \ntmONEtwo$. By rule $(\sclift)$, $\itm \mlasrel \itmtwo$  and $\ntmONE \mlasrel \ntmONEtwo$. Then $\ntm = \ntmONE\esub\var\itm \mlasrel \ntmONEtwo\esub\var\itmtwo = \ntmtwo$ by rule ($\scesub$).
	%	\end{itemize}
%\end{proof}

\begin{lemma}[Constrained Substitutivity of $\mlasrelnafex$ on normal forms]
	\label{l:lasrelnafex-normal-forms-substitutive}
	If $\ntmONE \mlasrelnafex \ntmTWO$, $\valof\tmrthree \mlasrelnafex \valof\tmrfour$ and $\ntmONE\isub\var{\valof\tmrthree}$ and $\ntmTWO\isub\var{\valof\tmrfour}$ are $\tovsce$-normal then $\ntmONE\isub\var{\valof\tmrthree} \mlasrelnafex \ntmTWO\isub\var{\valof\tmrfour}$.
\end{lemma}


\begin{proof}
	By case analysis on $\ntmONE$. Cases:
	\begin{itemize}
		\item $\ntmONE = \var$ and $\ntmTWO = \var$ then $\ntmONE\isub\var{\valof\tmrthree} = \valof\tmrthree \mlasrelnafex \valof\tmrfour = \ntmTWO\isub\var{\valof\tmrfour}$.
		
		\item $\ntmONE = \vartwo$ and $\ntmTWO = \vartwo$ then $\ntmONE\isub\var{\valof\tmrthree} =  \vartwo \mlasrelnafex \vartwo = \ntmTWO\isub\var{\valof\tmrfour}$.
		
		\item $\ntmONE = \la\vartwo\tm$ and $\ntmTWO = \la\vartwo\tmp$ with $\tm \mlasrel \tmp$
		we have \[\infer{\tm\isub\var{\valof\tmrthree} \mlasrel \tmp\isub\var{\valof\tmrfour}}{\tm \mlasrel \tmp & \valof\tmthree \mlasrel \valof\tmfour}\]
		hence by case (\nafex 3) $\ntmONE\isub\var{\valof\tmrthree} = \la\vartwo{\tm\isub\var{\valof\tmrthree}} \mlasrelnafex  \la\vartwo{\tmp\isub\var{\valof\tmrfour}} = \ntmTWO\isub\var{\valof\tmrfour}$.
		
		
		
		\item $\ntmONE = \ntmONEtwo\ntmONEthree$ and $\ntmTWO \equivx \ntmTWOtwo\ntmTWOthree$ with $\ntmONEtwo \mlasrel \ntmTWOtwo$ and $\ntmONEthree \mlasrel \ntmTWOthree$. 
		From $\ntmTWO \equivx \ntmTWOtwo\ntmTWOthree$, we deduct by substitutivity of $\equivx$ (\refprop{equivx-is-substitutive}) that $\ntmTWOtwo\isub\var{\valof\tmrfour}\ntmTWOthree\isub\var{\valof\tmrfour} \equivx \ntmTWO\isub\var{\valof\tmrfour}$.
		
		Since $\ntmONE\isub\var{\valof\tmrthree}$ and $\ntmTWO\isub\var{\valof\tmrfour}$ are $\tovsce$-normal, then by \refprop{equivx-preserves-normal-forms}, $\ntmONEtwo\isub\var{\valof\tmrthree}$, $\ntmTWOtwo\isub\var{\valof\tmrfour}$, $\ntmONEthree\isub\var{\valof\tmrthree}$ and $\ntmTWOthree\isub\var{\valof\tmrfour}$ all are $\tovsce$-normal as well and $\ntmONEtwo\isub\var{\valof\tmrthree}$, $\ntmTWOtwo\isub\var{\valof\tmrfour}$ are not almost-abstractions (\ie  $\not =\isctxp{\la\vartwo\tm}$ for any $\isctx$).
		
		To conclude that $\ntmONE\isub\var\val \mlasrelnafex \ntmTWO\isub\var\val$, what is only remaining is that\\ $\ntmONEtwo\isub\var\val \mlasrel \ntmTWOtwo\isub\var\valtwo$ and  $\ntmONEthree\isub\var\val \mlasrel \ntmTWOthree\isub\var\valtwo$.
		
		We derive easily these facts: ($\val\mlasrelnafex\valtwo$ implies $\val\mlasrel\valtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-left-to-right})
		\[ \infer[\scsub]{\ntmONEtwo\isub\var\val \mlasrel \ntmTWOtwo\isub\var\valtwo}{\ntmONEtwo \mlasrel \ntmTWOtwo & \val \mlasrel \valtwo} ~\text{and}~ \infer[\scsub]{\ntmONEthree\isub\var\val \mlasrel \ntmTWOthree\isub\var\valtwo}{\ntmONEthree \mlasrel \ntmTWOthree & \val \mlasrel \valtwo}\]
		
		
		
		\item $\ntmONE = \ntmONEtwo\esub\vartwo\itmONEtwo$ and $\ntmTWO {\equivx} \ntmTWOtwo\esub\vartwo\itmTWOtwo$ with $\itmONEtwo \mlasrel \itmTWOtwo$ and $\ntmONEtwo \mlasrel \ntmTWOtwo$. 
		
		The hypothesis that $\ntmONE\isub\var\val$ is normal is equivalent to $\itmONEtwo\isub\var\val$ is an inert and $\ntmONEtwo\isub\var\val$ is normal.
		
		From $\ntmTWO \equivx \ntmTWOtwo\esub\vartwo\itmTWOtwo$, we deduct {by substitutivity of $\equivx$} (\refprop{equivx-is-substitutive}) that $\ntmTWO\isub\var\valtwo \equivx (\ntmTWOtwo\isub\var\valtwo)\esub\vartwo{\itmTWOtwo\isub\var\valtwo}$.
		Since {$\equivx$ preserves normal forms}  (\refprop{equivx-preserves-normal-forms}), the hypothesis that $\ntmTWO\isub\var\valtwo$ is normal is equivalent to $\itmTWOtwo\isub\var\valtwo$ is an inert and $\ntmTWOtwo\isub\var\valtwo$ is normal.
		
		
		To conclude that $\ntmONE\isub\var\val \mlasrelnafex \ntmTWO\isub\var\val$, what is only remaining is that\\ $\itmONEtwo\isub\var\val \mlasrel \itmTWOtwo\isub\var\valtwo$ and  $\ntmONEtwo\isub\var\val \mlasrel \ntmTWOtwo\isub\var\valtwo$.
		
		We derive easily these facts: ($\val\mlasrelnafex\valtwo$ implies $\val\mlasrel\valtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-left-to-right})
		\[ \infer[\scsub]{\itmONEtwo\isub\var\val \mlasrel \itmTWOtwo\isub\var\valtwo}{\itmONEtwo \mlasrel \itmTWOtwo & \val \mlasrel \valtwo} ~\text{and}~ \infer[\scsub]{\ntmONEtwo\isub\var\val \mlasrel \ntmTWOtwo\isub\var\valtwo}{\ntmONEtwo \mlasrel \ntmTWOtwo & \val \mlasrel \valtwo}\]
		
	\end{itemize}
\end{proof}

\begin{lemma}
	\label{l:lasrelnafex-normal-forms-lasrel-right-to-left}
	If $\relsym$ is a \nafex simulation.
	If $\ntm\mlasrel\ntmtwo$ then $\ntm\mlasrelnafex\ntmtwo$.
\end{lemma}

\begin{proof}
	By induction on the derivation $\ntm \mlasrel \ntmtwo$. Cases of the last rule in the derivation of $\ntm\mlasrel\ntmtwo$:
	\begin{itemize}
		\item \emph {$\scvar$}\[ \infer[\scvar]{\var \mlasrel \var}{} \]
		then $\var \mlasrelnafex \var$ by case (\nafex 2).
		\item \emph {$\scabs$} \[ \infer[\scabs]{\ntm = \la\var\tm \mlasrel \la\var\tmp = \ntmtwo}{\tm \mlasrel \tmp} \]
		then $\ntm \mlasrelnafex \ntmtwo$ by case (\nafex 3) with $\tm \mlasrel \tmp$.
		\item \emph {$\sclift$} \[ \infer[\scabs]{\ntm \mlasrel \ntmtwo}{\ntm \rel \ntmtwo} \]
		then $\ntm \relnafex \ntmtwo$ since $\relsym$ is a \nafex simulation.
		By monotonicity of $\opnafex$, $\ntm \mlasrelnafex \ntmtwo$.
		
		\item \emph {$\scapp$} 
		\[ \infer[\scapp]{\ntm = \ntmONE\ntmTWO \mlasrel \ntmONEtwo\ntmTWOtwo = \ntmtwo}{\ntmONE \mlasrel \ntmONEtwo & \ntmTWO \mlasrel \ntmTWOtwo} \]
		
		
		then $\ntm \mlasrelnafex \ntmtwo$ by case (\nafex 4) with $\ntmONE \mlasrel \ntmONEtwo$ and $\ntmTWO \mlasrel \ntmTWOtwo$.
		
		
		
		\item \emph {$\scesub$} \[ \infer[\scesub]{\ntm = \ntmONE\esub\var\itmONE \mlasrel \ntmTWO\esub\var\itmTWO = \ntmtwo}{\ntmONE \mlasrel \ntmTWO & \itmONE \mlasrel \itmTWO} \] then $\ntm \mlasrelnafex \ntmtwo$
		by case (\nafex 5) with $\itmONE \mlasrel \itmTWO$ and $\ntmONE \mlasrel \ntmTWO$.
		\item \emph {$\scsub$} \[ \infer[\scsub]{\ntm = \ntmONE\isub\var\val \mlasrel \ntmTWO\isub\var\valtwo = \ntmtwo}{\ntmONE \mlasrel \ntmTWO & \val \mlasrel \valtwo} \]
		by \ih we have $\ntmONE \mlasrelnafex \ntmTWO$ and $\valof\tmrthree \mlasrelnafex \valof\tmrfour$. By \reflemma{lasrelnafex-normal-forms-substitutive}, $\ntmONE\isub\var{\valof\tmrthree} \mlasrelnafex \ntmTWO\isub\var{\valof\tmrfour}$.
		
		\item \emph {$\scequivx$} \[\infer[\scequivx]{\ntm \mlasrel \ntmtwo}{\ntm \mlasrel \ntmONE & \ntmONE \equivx \ntmtwo}\]
		
		By \ih, $\ntm \mlasrelnafex \ntmONE$ which means by \refprop{relnafex-equivx-subseteq-relnafex} $\ntm \mlasrelnafex \ntmtwo$ since $\ntmtwo \equivx \ntmONE$.\qedhere
	\end{itemize}
\end{proof}


\subsection{Bottom-up lemmas for a top-down defined simulation}



\begin{lemma}
	\label{l:lasrelnafex-inert-style-lists-induction}
	If $\isctxp\var \mlasrelnafex \isctxtwop\var$ (or $\isctxp\val \mlasrelnafex \isctxtwop\valtwo$) then either $\isctx,\isctxtwo =\ctxhole,\ctxhole$ or  (for $\tm = \var$ or $ \val$ and $\tmp=\var$ or $\val$) $\isctxp\tm = \isctxONEp\tm\esub\vartwo\itm$ and $\isctxtwop\tmp \equivx\isctxONEtwop\tmp\esub\vartwo\itmtwo$ with $\isctxONEp\var \mlasrelnafex \isctxONEtwop\var$ (or $\isctxONEp\val \mlasrelnafex \isctxONEtwop\valtwo$) and $\itm \mlasrelnafex \itmtwo$.
\end{lemma}

\begin{proof}
	By contradiction and case exhaustion, these are the only possibilities for\\ $\isctxp\var \mlasrelnafex \isctxtwop\var$ (or $\isctxp\val \mlasrelnafex \isctxtwop\valtwo$).
	\begin{itemize}
		\item If only one of the lists is empty: $\var \mlasrelnafex \itm\esub\vartwo\itmtwo$ (or $\var \mlasrelnafex \ntm\esub\vartwo\itmtwo$) is not possible given the definition of nafex. 
		\item If $\isctx= \isctxONE\esub\vartwo\itm$ and $\isctxtwo \equivx\isctxONEtwo\esub\varthree\itmtwo$, we again have $\neg (\ntm\esub\vartwo\itm \mlasrelnafex \ntmtwo\esub\varthree\itmtwo)$.\qedhere
	\end{itemize}
\end{proof}

%
%\begin{lemma}\adr{this lemma is false for now, we will do what we need}
%	\label{l:lasrelnafex-inert-app-lists-induction}
%	If $\isctxp\itmapp \mlasrelnafex \isctxtwop\itmapptwo$ then either $\isctx,\isctxtwo =\ctxhole,\ctxhole$ or  $\isctxp\itmapp = \isctxONEp\itmapp\esub\vartwo\itm$ and $\isctxtwop\itmapptwo \equivx\isctxONEtwop\itmapptwo\esub\vartwo\itmtwo$ with $\isctxONEp\itmapp \mlasrelnafex \isctxONEtwop\itmapptwo$ and $\itm \mlasrelnafex \itmtwo$.
%\end{lemma}
%
%\begin{proof}
%	By contradiction and case exhaustion, these are the only possibilities for $\isctxp\var \mlasrelnafex \isctxtwop\var$ (or $\isctxp\val \mlasrelnafex \isctxtwop\valtwo$).
%	\begin{itemize}
	%		\item If only one of the lists is empty: $\var \mlasrelnafex \itm\esub\vartwo\itmtwo$ (or $\var \mlasrelnafex \ntm\esub\vartwo\itmtwo$) is not possible given the definition of nafex. 
	%		\item If $\isctx,\isctxtwo = \isctxONE\esub\vartwo\itm,\isctxONEtwo\esub\varthree\itmtwo$, we again have $\neg (\ntm\esub\vartwo\itm \mlasrelnafex \ntmtwo\esub\varthree\itmtwo)$.
	%	\end{itemize}
%\end{proof}



This \reflemma{lasrelnafex-inert-style-lists-induction} gives us an "induction principle" on $\isctx,\isctxtwo$ when $\isctxp\var \mlasrelnafex \isctxtwop\var$ (or $\isctxp\val \mlasrelnafex \isctxtwop\valtwo$.
% \adr{or $\isctxp\itmapp \mlasrelnafex \isctxtwop\itmapptwo$}). \adr{blue version only needed in the demonstration of 3.13 ie the following lemma}


%\begin{lemma}
%	$\ntm,\ntmtwo, \ntmONE, \ntmONEtwo$ normal forms for $\to$ (not $\equivsone$).
%	Suppose $\ntm \to_{\sigma_1} \ntmONE$ and $\ntmtwo \to_{\sigma_1}  \ntmONEtwo$, then
%	$\ntm \mlasrel \ntmtwo \iff \ntmONE \mlasrel \ntmONEtwo$.
%\end{lemma}
%
%\begin{lemma}
%	\label{l:lasrel-inerts-separating-applicative-inerts-from-substitutions}
%	Suppose $\ntm = \isctxp{\itmapp}$ and $\ntmtwo = \isctxtwop{\itmapptwo}$. Then $\ntm \mlasrel \ntmtwo \iff \itmapp \mlasrel \itmapptwo$ and $\isctxp{\var} \mlasrel \isctxtwop{\var}$ ($\var$ is fresh).
%\end{lemma}
%
%\begin{proof}
%	By induction on $\isctx,\isctxtwo$.
%	\begin{itemize}
	%		\item \emph {$\isctx,\isctxtwo = \ctxhole,\ctxhole$}, then the result is obvious ($\var\mlasrel\var$ forall choice of $\var$).
	%		\item \emph {$\isctx,\isctxtwo = \isctxONE\esub\vartwo{\itm},\isctxONEtwo\esub\vartwo{\itmtwo}$}
	%		By \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left} and \ref{l:lasrelnafex-normal-forms-lasrel-left-to-right}, $\ntm = \isctxONEp{\itmapp}\esub\vartwo\itmONE \mlasrel \isctxONEtwop{\itmapptwo}\esub\vartwo\itmONEtwo = \ntmtwo \iff \ntm \mlasrelnafex \ntmtwo$. The latter can only be satisfied by case (nafex 6) hence $\ntm \mlasrelnafex \ntmtwo \iff \itm \mlasrel \itmtwo$ and $\isctxONEp{\itmapp} \mlasrel \isctxONEtwop{\itmapptwo}$.
	%		By \ih, $ \isctxONEp{\itmapp} \mlasrel \isctxONEtwop{\itmapptwo} \iff \itmapp \mlasrel \itmapptwo$ and $\isctxONEp{\var} \mlasrel \isctxONEtwop{\var}$.
	%		
	%		Moreover, By \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left} and \ref{l:lasrelnafex-normal-forms-lasrel-left-to-right}, $\isctxONEp{\var}\esub\vartwo\itm \mlasrel \isctxONEtwop{\var}\esub\vartwo\itmtwo \iff \isctxONEp{\var}\esub\vartwo\itm \mlasrelnafex \isctxONEtwop{\var}\esub\vartwo\itmtwo$ \ie by case (nafex 6), $\iff \isctxONEp{\var} \mlasrel \isctxONEtwop{\var}$ and $\itm \mlasrel \itmtwo$.
	%		
	%	\end{itemize}
%\end{proof}



\begin{lemma}
	\label{l:lasrelnafex-values-isctx-decomposition}
	$\isctxp\val \mlasrelnafex \isctxtwop\valtwo \iff \val \mlasrelnafex \valtwo$ and $\isctxp\var \mlasrelnafex \isctxtwop\var$ ($\var$ is fresh)
\end{lemma}

\begin{proof}
	By "induction" on lists $\isctx, \isctxtwo$. (They are of the same size because of how \nafex is defined - see \reflemma{lasrelnafex-inert-style-lists-induction})
	\begin{itemize}
		\item $\isctx,\isctxtwo =\ctxhole,\ctxhole$ then $\val \mlasrelnafex \valtwo \iff \val \mlasrelnafex \valtwo$ and $\var\mlasrelnafex\var$ is always true by case (\nafex 2).
		\item $\isctxp\val = \isctxONEp\val\esub\vartwo\itm$ and $\isctxtwop\valtwo \equivx\isctxONEtwop\valtwo\esub\vartwo\itmtwo$ with $\isctxONEp\valtwo \mlasrelnafex \isctxONEtwop\valtwo$ and $\itm \mlasrelnafex \itmtwo$, then
		
		%by case (\nafex 6), $\isctxp\val \mlasrelnafex \isctxtwop\valtwo \iff \isctxONEp\val \mlasrel \isctxONEtwop\valtwo$ and $\itm \mlasrel \itmtwo$ 
		
		%by \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left}, $\iff \isctxONEp\val \mlasrelnafex \isctxONEtwop\valtwo$ and $\itm \mlasrel \itmtwo$
		
		by \ih, $\isctxONEp\valtwo \mlasrelnafex \isctxONEtwop\valtwo\iff \isctxONEp\var \mlasrelnafex \isctxONEtwop\var$ and $\val \mlasrelnafex \valtwo$
		
		by \reflemma{lasrelnafex-normal-forms-lasrel-left-to-right}, $\isctxONEp\valtwo \mlasrelnafex \isctxONEtwop\valtwo\iff \isctxONEp\var \mlasrel \isctxONEtwop\var$, $\val \mlasrelnafex \valtwo$ and $\itm \mlasrel \itmtwo$
		
		and finally by case (nafex 5)\\ $\isctxp\val \mlasrelnafex \isctxtwop\valtwo\iff \isctxp\var=\isctxONEp\var\esub\vartwo\itm \mlasrelnafex \isctxONEtwop\var\esub\vartwo\itmtwo\equivx \isctxtwop\var$, $\val \mlasrelnafex \valtwo$.
	\end{itemize}
\end{proof}

\begin{lemma}
	\label{l:values-fireballs-stable-lasrelnafex}
	If $\fire \mlasrelnafex \firep$ then ($\fire =\isctxp\valt$ $\iff$ $\firep = \isctxtwop\valttwo$)
\end{lemma}

\begin{proof}
	Proof by induction on $\isctx$ using \ref{l:lasrelnafex-normal-forms-lasrel-left-to-right} and \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}.
\end{proof}

\begin{corollary}
	\label{l:inerts-fireballs-stable-lasrelnafex}
	If $\fire \mlasrelnafex \firep$ then ($\fire =\itm$ $\iff$ $\firep = \itmtwo$)
\end{corollary}

\begin{lemma}
	\label{l:lasrelnafex-normal-forms-isctx-decomposition}
	Let $\ntm$ and $\ntmtwo$ be normal forms and $\isctx$ and $\isctxtwo$ inert substitution contexts which may capture free variables of $\ntm$ and $\ntmtwo$. $\ntm \mlasrelnafex \ntmtwo$ and $ \isctxp\var \mlasrelnafex \isctxtwop\var$ ($\var$ is fresh) $\Rightarrow \isctxp\ntm \mlasrelnafex \isctxtwop\ntmtwo$
\end{lemma}
\begin{proof}
	By induction on $\isctx,\isctxtwo$.
\end{proof}

\begin{lemma}
	\label{l:lasrelnafex-normal-forms-isctx-decomposition-2}
	$\ntm \mlasrelnafex \ntmtwo$ and $ \isctxp\var \mlasrelnafex \isctxtwop\var$ $\Rightarrow \isctxp{\var\ntm} \mlasrelnafex \isctxtwop{\var\ntmtwo}$
\end{lemma}
\begin{proof}
	By induction on $\isctx,\isctxtwo$.
\end{proof}

%unnecessary lemma if we don't do normal forms modulo sigma_1
\begin{lemma}
	\label{l:lasrelnafex-normal-forms-isctx-decomposition-applied-inerts}
	$\ntm \mlasrelnafex \ntmtwo$ and $ \isctxp\itmapp \mlasrelnafex \isctxtwop\itmapptwo$ $\Rightarrow \isctxp{\itmapp\ntm} \mlasrelnafex \isctxtwop{\itmapptwo\ntmtwo}$
\end{lemma}
\begin{proof}
	By induction on $\isctx$.
	
	Since $ \isctxp\itmapp \mlasrelnafex \isctxtwop\itmapptwo$, two cases:
	\begin{itemize}
		\item $\isctx=\ctxhole$ and we fall into case (\nafex 4), that is $\isctxtwop\itmapptwo \equivx \itmapptwo_1$ and $\itmapp \mlasrel \itmapptwo_1$. Hence $\itmapp \ntm \mlasrelnafex \itmapptwo_1\ntmtwo \equivx \isctxtwop{\itmapptwo\ntmtwo}$ follows.
		
		\item  $\isctx=\isctxONE\esub\vartwo\itm$ and we fall into case (\nafex 5), that is $\isctxtwop\itmapptwo \equivx \isctxONEtwop{\itmapptwo_1 }\esub\var\itmtwo$ (we cannot move from inerts to answers and we choose the normal form modulo $\equivsone$) where $\isctxONEp\itmapp \mlasrel \isctxONEtwop{\itmapptwo_1 }$ and $\itm \mlasrel \itmtwo$. Apply \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left} and obtain by \ih that $\isctxONEp{\itmapp\ntm} \mlasrelnafex \isctxONEtwop{\itmapptwo_1\ntmtwo}$. By \reflemma{lasrelnafex-normal-forms-lasrel-left-to-right} and definition of \nafex, we can conclude.\qedhere
	\end{itemize}
\end{proof}

\subsection{Normal substituted terms characterization}
The following two lemmas characterize normal terms that are still normal when a variable is substituted by a value -- this characterization does not depend on $\equivx$ (by strong commutation and preservation of normal forms).
\begin{lemma}
	$\ntm\isub\var\val$ is normal iff $\ntm \not = \evctxp{\var\fire}$. (and $\val \not = \vartwo$)
\end{lemma}

\begin{lemma}
	\label{l:normal-subst-inert-are-inert}
	$\itm\isub\var\val$ is inert iff ($\itm$ is inert,) $\itm\isub\var\val$ is normal.
\end{lemma}

\subsection{Coherence of the \nafex simulation, evaluation and substitution}
We split the Coherence Proposition of the \nafex simulation into two lemmas to prove, knowing that part of the first statement has already been proven in \reflemma{lasrelnafex-normal-forms-substitutive}.

\begin{lemma}
	\label{l:lasrelnafex-on-normal-subs_vsce}
	Let $\rel$ be an \nafex simulation, $\ntm \mlasrelnafex \ntmtwo$, and $\val\mlasrelnafex\valtwo$. If $\ntm\isub\var\val$ is $\tovsce$-normal then $\ntmtwo\isub\var\valtwo$ is $\tovsce$-normal.
	% \adr{(and $\ntm\isub\var\val \mlasrelnafex \ntmtwo\isub\var\valtwo$ is deduced with \ref{l:lasrelnafex-normal-forms-substitutive})}.
\end{lemma}

\begin{proof}
	By induction on normal forms $\ntm$ for which $\ntm\isub\var\val$ is $\tovsce$-normal:
	\begin{itemize}
		\item \emph{Variable}. Two sub-cases:
		\begin{itemize}
			\item $\ntm= \var$ and so $\ntm\isub\var\val = \val$. Then $\ntmtwo = \var$ by case (\nafex 2) and $\ntmtwo\isub\var\valtwo = \valtwo$, which is $\tovsce$-normal. 
			
			
			\item $\ntm= \vartwo$ and so $\ntm\isub\var\val = \vartwo$. Then $\ntmtwo = \vartwo$ by case (\nafex 2) and $\ntmtwo\isub\var\valtwo = \vartwo$, which is $\tovsce$-normal. 
		\end{itemize}
		
		\item \emph{Abstraction}, that is, $\ntm = \la\vartwo\tm$ and so $\ntm\isub\var\val = \la\vartwo\tm\isub\var\val$. Then $\ntmtwo= \la\vartwo\tmp$ with $\tm \mlasrel \tmp$. We have that $\ntmtwo\isub\var\valtwo = \la\vartwo\tmp\isub\var\valtwo$, which is $\tovsce$-normal.
		
		\item \emph{Substituted Inert}, that is, $\ntm = \ntmONE\esub\vartwo\itmONE$ and so $\ntm\isub\var\val = \ntmONE\isub\var\val\esub\vartwo{\itmONE\isub\var\val}$.
		$\ntm\isub\var\val$ is normal is equivalent to $\itmONE\isub\var\val$ and $\ntmONE\isub\var\val$ are normal.
		Then $\ntmtwo \equivx \ntmONEtwo\esub\vartwo\itmONEtwo$ with $\itmONE \mlasrel \itmONEtwo$ and $\ntmONE \mlasrel \ntmONEtwo$, which implies $\itmONE \mlasrelnafex \itmONEtwo$ and $\ntmONE \mlasrelnafex \ntmONEtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left}.
		By \ih we then have $\itmONEtwo\isub\var\valtwo$ is $\tovsce$-normal and $\ntmONEtwo\isub\var\valtwo$ is $\tovsce$-normal : which is equivalent to  $\ntmtwo\isub\var\valtwo$ is $\tovsce$-normal by \refprop{equivx-preserves-normal-forms}.
		
		
		
		\item \emph{Applied Normal forms}, that is, $\ntm = \ntmONE\ntmTWO$. Then we have three sub-cases:
		\begin{itemize}
			\item $\ntm = \var\ntmTWO$ and $\val$ is not an abstraction,
			Then $\ntmtwo \equivx \var\ntmTWOtwo$ with $\ntmTWO \mlasrel \ntmTWOtwo$, which implies $\ntmTWO \mlasrelnafex \ntmTWOtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left}.
			By \ih we then have $\ntmTWOtwo\isub\var\valtwo$ is $\tovsce$-normal: which is equivalent to $\ntmtwo\isub\var\valtwo$ is $\tovsce$-normal by \refprop{equivx-preserves-normal-forms}.
			\item $\ntm = \vartwo\ntmTWO$,
			Then $\ntmtwo \equivx \vartwo\ntmTWOtwo$ with $\ntmTWO \mlasrel \ntmTWOtwo$, which implies $\ntmTWO \mlasrelnafex \ntmTWOtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left}.
			By \ih we then have $\ntmTWOtwo\isub\var\valtwo$ is $\tovsce$-normal: which is equivalent to $\ntmtwo\isub\var\valtwo$ is $\tovsce$-normal by \refprop{equivx-preserves-normal-forms}.
			\item $\ntm = \itmapp\ntmTWO$, and $\itmapp\isub\var\val$ is an applied inert,
			Then $\ntmtwo \equivx \itmapptwo\ntmTWOtwo$ with $\itmapp \mlasrel \itmapptwo$ and $\ntmTWO \mlasrel \ntmTWOtwo$, which implies $\itmapp \mlasrelnafex \itmapptwo$ and $\ntmTWO \mlasrelnafex \ntmTWOtwo$ by \reflemma{lasrelnafex-normal-forms-lasrel-right-to-left}.
			
			By \ih we then have $\itmapptwo\isub\var\valtwo$ is $\tovsce$-normal, $\ntmTWOtwo\isub\var\valtwo$ is $\tovsce$-normal : which is equivalent to $\ntmtwo\isub\var\valtwo$ is $\tovsce$-normal by \refprop{equivx-preserves-normal-forms} and by \reflemma{normal-subst-inert-are-inert}.\qedhere
		\end{itemize}
		
		
	\end{itemize}
\end{proof}

\begin{lemma} 
	\label{l:lasrelnafex-not-normal-subs}
	If $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$, $\val \mlasrel \valtwo$
	and $\ntm_\tmrone\isub\var{\val} \to \tmronep$
	then $\ntm_\tmrtwo\isub\var{\valtwo}  \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$
\end{lemma}

\begin{proof}
	(We write $\val=\la\vartwo\tmfour$ and $\valtwo = \la\vartwo\tmfourp$ with $\tmfour \mlasrel \tmfourp$ - using the fact that ($\val \mlasrel \valtwo \Rightarrow \val \mlasrelnafex \valtwo$) by \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}.)
	
	If $\ntm_\tmrone\isub\var{\val} \to \tmronep$ then $\ntm_\tmrone = \evctxp{\var\fire}$ ($\evctx$ is the context where the reduction has been done).
	Show (by induction on $\evctx$) that $\tmronep \mlasrel \tmrtwop$.
	\begin{itemize}
		\item $\evctx = \ctxhole$
		then $\ntm_\tmrone = {\var\fire}$ , 
		by $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$ we have $\ntm_\tmrtwo \equivx {\var\firetwo}$ with $\fire \mlasrel \firetwo$. 
		
		
		By substitutivity of $\equivx$ (\refprop{equivx-is-substitutive}), $\ntm_\tmrtwo\isub\var\valtwo \equivx {\valtwo\firetwo\isub\var\valtwo}\to {\tmfourp\esub\vartwo{\firetwo\isub\var\valtwo}}$
		
		By \refprop{equivx-is-a-strong-bisimulation}, there exists $\tmrtwop$ such that ${\tmfourp\esub\vartwo{\firetwo\isub\var\valtwo}} \equivx \tmrtwop$ and $\ntm_\tmrtwo\isub\var\valtwo \tovsct\tmrtwop$.
		
		We also have $\ntm_\tmrone\isub\var\val \to {\tmfour\esub\vartwo{\fire\isub\var\val}} = \tmronep$ and we can build the following derivation:
		\[ \infer[\scequivx]{\tmronep\mlasrel\tmrtwop}{\infer[\scesub]{ \tmfour\esub\vartwo{\fire\isub\var\val} \mlasrel \tmfourp\esub\vartwo{\firetwo\isub\var\valtwo}}{\tmfour \mlasrel \tmfourp & \infer{\fire\isub\var\val \mlasrel \firetwo\isub\var\valtwo}{\fire \mlasrel \firetwo & \val \mlasrel \valtwo}} & {\tmfourp\esub\vartwo{\firetwo\isub\var\valtwo}} \equivx \tmrtwop} \]
		
		hence the result $\ntm_\tmrone\isub\var\val \to \tmronep$, $\ntm_\tmrtwo\isub\var\valtwo \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$.
		
		
		
		\item $\evctx = \tmtwo\evctxONE$ ($\tmtwo = \itm$ because $\ntm_\tmrone$ is normal) 	then $\ntm_\tmrone = \itm\evctxONEp\tmthree$ (where $\tmthree = \var\firetwo$).
		Then by $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$, $\ntm_\tmrtwo \equivx \itmtwo\ntmONE$ with $\itm \mlasrel \itmtwo$ and $\evctxONEp\tmthree \mlasrel \ntmONE$.
		$\evctxONEp\tmthree\isub\var\val \to \tm$ by hypothesis ($\ntm_\tmrone\isub\var\val \to \tmronep$ is in this case $\itm\isub\var\val\evctxONEp\tmthree\isub\var\val \to \itm\isub\var\val\tm$) and $\evctxONEp\tmthree \mlasrelnafex \ntmONE$ (normal forms, apply lemma \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}), hence by \ih $\ntmONE\isub\var\valtwo \to \tmp$ with $\tm \mlasrel \tmp$.
		
		By substitutivity and strong commutation of $\equivx$,
		$\ntm_\tmrtwo\isub\var\valtwo \equivx \itmtwo\isub\var\valtwo\ntmONE\isub\var\valtwo\to \itmtwo\isub\var\valtwo\tmp$ implies $\ntm_\tmrtwo\isub\var\valtwo\tovsct\tmrtwop$ with 
		$\itmtwo\isub\var\valtwo\tmp \equivx \tmrtwop$.
		\[\infer{\tmronep\mlasrel\tmrtwop}{\infer{\itm\isub\var\val\tm \mlasrel \itmtwo\isub\var\valtwo\tmp }{ \infer{\itm\isub\var\val \mlasrel \itmtwo\isub\var\valtwo}{\itm \mlasrel \itmtwo & \val \mlasrel \valtwo} & \tm \mlasrel \tmp} & \itmtwo\isub\var\valtwo\tmp \equivx \tmrtwop}\]
		
		hence $\ntm_\tmrone\isub\var\val \to \tmronep$, $\ntm_\tmrtwo\isub\var\valtwo \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$.
		
		
		\item The rest of the induction cases ($\evctx = \evctxONE\tmtwo$, $\evctx = \tmtwo\esub\varthree\evctxONE$ or $\evctx = \evctxONE\esub\varthree\tmtwo$) follow from very similar arguments.\qedhere
		%		
		%		\item $\evctx = \evctxONE\tmtwo$ ($\tmtwo = \fire$ because $\ntm_\tmrone$ is normal) then $\ntm_\tmrone = \evctxONEp\tmthree\fire$ (where $\tmthree = \var\firetwo$).
		%		Then by $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$, $\ntm_\tmrtwo = \ntmONE\firep$ with $\fire \mlasrel \firep$ and $\evctxONEp\tmthree \mlasrel \ntmONE$.
		%		$\evctxONEp\tmthree\isub\var\val \to \tm$ by hypothesis ($\ntm_\tmrone\isub\var\val \to \tmronep$ is in this case $\evctxONEp\tmthree\isub\var\val\fire\isub\var\val \to \tm\fire\isub\var\val$) and $\evctxONEp\tmthree \mlasrelnafex \ntmONE$ (normal forms, apply lemma \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}), hence by \ih $\ntmONE\isub\var\valtwo \to \tmp$ with $\tm \mlasrel \tmp$
		%		\[\infer{\tmronep=\tm\fire\isub\var\val \mlasrel \tmp\firep\isub\var\valtwo = \tmrtwop}{\tm \mlasrel \tmp & \infer{\fire\isub\var\val \mlasrel \firep\isub\var\valtwo}{\fire \mlasrel \firep & \val \mlasrel \valtwo}}\]
		%		
		%		hence $\ntm_\tmrone\isub\var\val \to \tmronep$, $\ntm_\tmrtwo\isub\var\valtwo \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$.
		%		
		%		
		%		\item $\evctx = \tmtwo\esub\varthree\evctxONE$ ($\tmtwo = \fire$ because $\ntm_\tmrone$ is normal) then $\ntm_\tmrone = \fire\esub\varthree{\evctxONEp\tmthree}$ (where $\tmthree = \var\firetwo$).
		%		Then by $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$, $\ntm_\tmrtwo = \firep\esub\varthree\ntmONE$ with $\fire \mlasrel \firep$ and $\evctxONEp\tmthree \mlasrel \ntmONE$.
		%		$\evctxONEp\tmthree\isub\var\val \to \tm$ by hypothesis ($\ntm_\tmrone\isub\var\val \to \tmronep$ is in this case $\fire\isub\var\val\esub\varthree{\evctxONEp\tmthree\isub\var\val} \to \fire\isub\var\val\esub\varthree{\tm}$) and $\evctxONEp\tmthree \mlasrelnafex \ntmONE$ (normal forms, apply lemma \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}), hence by \ih $\ntmONE\isub\var\valtwo \to \tmp$ with $\tm \mlasrel \tmp$
		%		\[\infer{\tmronep=\fire\isub\var\val\esub\varthree\tm \mlasrel \firep\isub\var\valtwo\esub\varthree\tmp = \tmrtwop}{ \infer{\fire\isub\var\val \mlasrel \firep\isub\var\valtwo}{\fire \mlasrel \firep & \val \mlasrel \valtwo} & \tm \mlasrel \tmp}\]
		%		
		%		hence $\ntm_\tmrone\isub\var\val \to \tmronep$, $\ntm_\tmrtwo\isub\var\valtwo \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$.
		%		
		%		\item $\evctx = \evctxONE\esub\varthree\tmtwo$ ($\tmtwo = \itm$ because $\ntm_\tmrone$ is normal) then $\ntm_\tmrone = \evctxONEp\tmthree\esub\varthree{\itm}$ (where $\tmthree = \var\firetwo$).
		%		Then by $\ntm_\tmrone \mlasrelnafex \ntm_\tmrtwo$, $\ntm_\tmrtwo = \ntmONE\esub\varthree\itmtwo$ with $\itm \mlasrel \itmtwo$ and $\evctxONEp\tmthree \mlasrel \ntmONE$.
		%		$\evctxONEp\tmthree\isub\var\val \to \tm$ by hypothesis ($\ntm_\tmrone\isub\var\val \to \tmronep$ is in this case ${\evctxONEp\tmthree\isub\var\val}\esub\varthree{\itm\isub\var\val} \to \tm\esub\varthree{\itm\isub\var\val}$) and $\evctxONEp\tmthree \mlasrelnafex \ntmONE$ (normal forms, apply lemma \ref{l:lasrelnafex-normal-forms-lasrel-right-to-left}), hence by \ih $\ntmONE\isub\var\valtwo \to \tmp$ with $\tm \mlasrel \tmp$
		%		\[\infer{\tmronep=\tm\esub\varthree{\itm\isub\var\val}\mlasrel \tmp\esub\varthree{\itmtwo\isub\var\valtwo} = \tmrtwop}{ \tm \mlasrel \tmp &  \infer{\itm\isub\var\val \mlasrel \itmtwo\isub\var\valtwo}{\itm \mlasrel \itmtwo & \val \mlasrel \valtwo}}\]
		%		
		%		hence $\ntm_\tmrone\isub\var\val \to \tmronep$, $\ntm_\tmrtwo\isub\var\valtwo \to \tmrtwop$ and $\tmronep \mlasrel \tmrtwop$.
	\end{itemize}
\end{proof}


\subsection{Mirrored Lassen's Closure preserves \nafex simulations}
After all these preliminaries, we can finally prove \nafex compatibility, with a very similar proof than in the case of \naf.


\begin{proposition}
	\label{prop:main-lemma_vsce}
	Let $\relsym$ be a \nafex simulation.
	\begin{enumerate}
		\item \emph{Technical auxiliary statement}: if $\tmrone\mlasrel\tmrtwo$ and $\tmrone \bsvscp k \ntm$ then $\tmrtwo\bsvscps \ntmtwo$ and $\ntm \mlasrelnafex \ntmtwo$.		
		\item \emph{Mirrored Lassen's closure preserves \nafex simulations}:  $\mlassenop\relsym$ is a \nafex simulation.
	\end{enumerate}
\end{proposition}

\begin{proof}%[Proof of \reflemma{main-lemma-bis_vsce}]
	\begin{enumerate}
		\item 
	By induction on $(k,d)$ where $d$ is the size of the derivation of $\tmrone \mlasrel \tmrtwo$.
	\input{proofs/proof-compatibility-naf-extended-modular}
	\item Reformulation of the first point.\qedhere
\end{enumerate}
\end{proof}

\begin{proposition}[\nafex similarity is adequate]
	\label{prop:adequacy-nafex}
	Suppose $\equivx$ is a mirror for $\tovsc$. If $\tm \leqnafex \tmtwo$ then $\tm \bsvscs$ implies $\tmtwo\bsvscs$
\end{proposition}

\begin{proof}
	Without using equivalences in the definition this fact was obvious. With equivalences, we need the fact that $\equivx$ preserves normal forms to conclude (Proposition \ref{prop:equivx-preserves-normal-forms}).
\end{proof}


\gettoappendix{thm:nafex-included-leqc}

\begin{proof}
	\begin{enumerate}
		\item By Proposition \ref{prop:main-lemma_vsce} and coinductive definition of $\leqvscx$.
		\item Compatibility comes from the first point of the theorem and the fact that the mirrored Lassen's closure is compatible. Inclusion in contextual preorder by compatibility and adequacy (\refprop{adequacy-nafex}).
		\item Similar argument, here we rely on the fact that $\streq$ is substitutive and a strong commutation for the VSC. \qedhere
	\end{enumerate}
\end{proof}