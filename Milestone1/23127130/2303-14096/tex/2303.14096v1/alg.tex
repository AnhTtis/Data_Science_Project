\begin{algorithm}[h]
\caption{Autoencoder-based nuisance-extended information bottleneck ({\method})}
\label{alg:training}
\begin{algorithmic}[1]
\REQUIRE encoder $f$, decoder $g$, discriminators $d$, prior $p_0(\rvz)$, $\alpha, \beta > 0$.
\vspace{0.05in}
\hrule
\vspace{0.05in}
\FOR{\# training iterations}
    \STATE Sample $(x_i, y_i)_{i=1}^{m} \sim p_d(\rvx, \rvy)$
    \STATE $\rvz^{(i)}, \rvz^{(i)}_n \leftarrow f(x_i)$, and sample $z^{(i)}, z^{(i)}_n \sim \rvz^{(i)}, \rvz^{(i)}_n$
    \STATE $\hat{x}_i \leftarrow g(z^{(i)}, z^{(i)}_n)$
    \STATE \textcolor{Blue9}{\textsc{// Update discriminators}}
    \STATE $L_{\tt ind} \leftarrow \mathbb{E}_{\rvz, \rvz_n \sim \mathcal{N}(0, I)} [\log d_\rvz(\rvz, \rvz_n)] + \frac{1}{m} \sum_{i} \log( 1 - d_{\rvz}(z, z_n))$
    \STATE $L_{\tt nuis}^D \leftarrow \frac{1}{m} \sum_{i} \mathbb{CE}(q_n(\rvy | z_n^{(i)}), y_i)$
    \STATE $L_D \leftarrow L_{\tt nuis}^D - L_{\tt ind}$
    \STATE $d_{\rvz}, q_n \leftarrow$ Update $d_{\rvz}, q_n$ to minimize $L_D$
    \STATE \textcolor{Blue9}{\textsc{// Update encoder and decoder}}
    \STATE $L_{\tt VIB}^{\beta} \leftarrow \frac{1}{m} \sum_{i} \left[-\log q(y_i|z_i) + \beta \mathrm{KL}(p(\rvz|x_i)\|p_0(\rvz))\right]$
    \STATE $L_{\tt recon} \leftarrow \frac{1}{m} \sum_{i} \frac{1}{\|x_i\|^2}\|x_i - \hat{x}_i\|_2^2$
    \STATE $L_{\tt nuis} \leftarrow \frac{1}{m} \sum_{i} \mathbb{CE}(q^*_n(\rvy | z_n^{(i)}), \frac{1}{|\mathcal{Y}|})$
    \STATE $L_{\tt {\method}} \leftarrow L_{\tt VIB}^{\beta} + \alpha L_{\tt recon} + L_{\tt nuis} + L_{\tt ind}$
    \STATE $f,g,\Pi_f \leftarrow$ Update $f, g, \Pi_f$ to minimize $L_{\tt {\method}}$
\ENDFOR
\end{algorithmic}
\end{algorithm}