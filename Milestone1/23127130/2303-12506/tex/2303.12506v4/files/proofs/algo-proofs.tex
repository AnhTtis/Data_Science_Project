\section{Proofs Omitted From Section \ref{sec:algo-short}}\label{sec:algo-sec-proofs}

\input{files/proofs/algo-proof-not-main}

\subsection{Proof of Theorem \ref{th:main}}
\label{sub:th:main}
This section is dedicated to proving Theorem \ref{th:main}:
let $\multApprox\in (0,1]$, $\additiveApprox \geq 0$, and \textsf{OP} be an $(\multApprox,\additiveApprox)$-approximation procedure to \eqref{eq:sums-OP} or \eqref{eq:vsums-OP}. Then Algorithm \ref{alg:basic-ordered-Outcomes} outputs an $\left(\frac{\multApprox^2}{1-\multApprox + \multApprox^2}, \frac{\additiveApprox}{1-\multApprox +\multApprox^2}\right)$-leximin-approximation. 

Based on Lemma \ref{lem:equivalence-of-all-three}, it is sufficient to prove the theorem for \eqref{eq:compact-OP}.

We start by observing that the value of the variable $z_t$ is completely determined by the variable $x$. This is because $z_t$ only appears in the last constraint, which is equivalent to 
$z_t \leq \sum_{i=1}^{t} \valBy{i}{x} - \sum_{i=1}^{t-1} z_i$. 
Therefore, for every $x$ that satisfies the first two constraints, 
it is possible to satisfy the last constraint by setting $z_t$ to any value which is at most
$\sum_{i=1}^{t} \valBy{i}{x} - \sum_{i=1}^{t-1} z_i$.
Moreover, as the program aims to maximize $z_t$, it will necessarily 
set $z_t$ to be equal to that expression, since $z_t$ is maximized when the constraint holds with equality. This is summarized in the observation below:

% For any constants $z_1,\ldots, z_{t-1}$,
% any vector $x \in S$ that satisfies constraint $(\Tilde{2})$ of \eqref{eq:compact-OP} 
% is feasible to this problem.
% This is because any solution $x \in S$ can satisfy constraint $(\Tilde{3})$ with a small enough assignment to the variable $z_t$. \eden{I'm not sure how to explain it....}
\begin{observation}
\label{obs:feasi-and-constraint2}
For any $t\geq 1$ and any constants $z_1,\ldots, z_{t-1}$,
every vector $x$ that satisfies constraints (\progCompact.1)  and (\progCompact.2)
is a part of a feasible solution $(x,z_t)$ for $z_t = \sum_{i=1}^{t} \valBy{i}{x} - \sum_{i=1}^{t-1} z_i$.
Moreover, 
\label{obs:obj-value}
the objective value  obtained by a feasible solution $x$ to the problem \eqref{eq:compact-OP} solved in iteration $t$ is $z_t = \sum_{i=1}^{t} \valBy{i}{x} - \sum_{i=1}^{t-1}  z_i$.
\end{observation}

% Now, consider the problem \eqref{eq:compact-OP} that was solved in iteration $t$.
% Here, $z_t$ is a \emph{variable} and $z_1, \ldots z_{t-1}$ are constants.
% The objective of this problem is $\max z_t$, and the only constraint that includes the variable $z_t$ is  (\progCompact.3).
% Therefore, rearranging it to $\sum_{i=1}^{t} \valBy{i}{x} - \sum_{i=1}^{t-1}  z_i\geq z_t$, allows us to conclude that the objective value is determined by the left side of this inequality (as $z_t$ is maximized when the inequality turns to equality).

Based on Observation \ref{obs:obj-value}, we can now slightly abuse the terminology and say that a solution $x$ is ``feasible`` in iteration $t$ if it satisfies constraints (\progCompact.1)  and (\progCompact.2) of the program solved in iteration $t$.


We denote $\retSol := x_n$ = the solution $x$ attained at the last iteration ($t=n$) of the algorithm. 
Since $\retSol$ is a feasible solution of \eqref{eq:compact-OP} in iteration $n$, and as each
iteration only adds new constraints to (\progCompact.2), it follows that $\retSol$ is also a feasible solution of \eqref{eq:compact-OP} in any iteration $1 \leq t\leq n$. 
\begin{observation}\label{obs:retSol-solves-any-t}
$\retSol$ is a feasible solution of \eqref{eq:compact-OP} in any iteration $1 \leq t\leq n$.
\end{observation}


Lastly, as the value obtained as $(\multApprox, \additiveApprox)$-approximation for this problem is the \emph{constant} $z_t$, the optimal value is at most $\frac{1}{\multApprox} (z_t+\additiveError)$. 
Consequently, the objective value of any feasible solution is at most this value.
Since $\retSol$ is feasible for any iteration $t$ (Observation \ref{obs:retSol-solves-any-t}) and since the objective value corresponding to $\retSol$ is $\sum_{i=1}^t \valBy{i}{\retSol} - \sum_{i=1}^{t-1} z_i$ (Observation \ref{obs:obj-value}), we can conclude:

\begin{observation}\label{obs:obj-xt-to-zt}
    The objective value obtained by $\retSol$ to the problem \eqref{eq:compact-OP} that was solved in iteration $t$ is at most $\frac{1}{\multApprox} (z_t+\additiveError)$. That is:
    \begin{align*}
        \sum_{i=1}^t \valBy{i}{\retSol} - \sum_{i=1}^{t-1} z_i \leq \frac{1}{\multApprox} \left(z_t+\additiveError \right).
    \end{align*}
\end{observation}

% This conclusion also implies that for any $1 \leq t \leq n$, the solution $(x_t, z_t)$ that that was outputted for \eqref{eq:compact-OP} in iteration $t$, satisfies constraint $(\Tilde{3})$ as equality. That is:
% \begin{observation}\label{obs:equality-xt-zt}
% For any $1 \leq t \leq n$,  $\sum_{i=1}^{t} \valBy{i}{x_t} = \sum_{i=1}^{t}  z_i$.
% \end{observation}



%%%
% OVERALL EXPLANATION 
We start with Lemmas \ref{lemma:beta-vk}-\ref{lemma:fk-to-all}, which establish a relationship between the $k$-th least objective value obtained by $\retSol$ 
% ($\valBy{k}{\retSol}$) 
and the difference between the sum of the $(k-1)$ least objective values obtained by $\retSol$ and the sum of the $(k-1)$ first $z_i$ values.
% ($\sum_{i=1}^{k-1}\valBy{k}{\retSol} - \sum_{i=1}^{k-1}z_i$). 
Theorem \ref{th:main} then uses this relation to prove that the existence of another solution that would be $\left(\frac{\multApprox^2}{1-\multApprox + \multApprox^2}, \frac{\additiveApprox}{1-\multApprox +\multApprox^2}\right)$-leximin-preferred over $\retSol$ would lead to a contradiction.

For clarity, throughout the proofs, we denote the multiplicative \emph{error} factor by $\multError = 1-\multApprox$.

% LEMMAS.
% BLAH BLAH.

\begin{lemma}\label{lemma:beta-vk}
    For any $1 \leq k\leq n$, 
    \begin{align*}
        &\multError \sum_{i=1}^{k} \valBy{i}{\retSol} - \multError \sum_{i=1}^{k-1} z_i \geq \sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^k z_i - \additiveError
        % \\
        % &\multError \valBy{k}{\retSol} \geq \left(\sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^k z_i\right) -\multError \left(\sum_{i=1}^{k-1} \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i\right) -\additiveError
    \end{align*}
\end{lemma}

\begin{proof}
By Observation \ref{obs:obj-xt-to-zt},
    \begin{align*}
         &\sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i \leq \frac{1}{\multApprox} \left(z_k + \additiveError \right) = \frac{1}{1-\multError} \left(z_k + \additiveError \right)\\
         &\Rightarrow (1-\multError) \left(\sum_{i=1}^{k} \valBy{i}{\retSol} - \sum_{i=1}^{k-1}  z_i\right) \leq z_k +\additiveError\\
         &\Rightarrow \sum_{i=1}^{k} \valBy{i}{\retSol} - \sum_{i=1}^{k-1}  z_i - \multError \sum_{i=1}^{k} \valBy{i}{\retSol} + \multError \sum_{i=1}^{k-1}  z_i \leq z_k +\additiveError\\
         &\Rightarrow \sum_{i=1}^{k} \valBy{i}{\retSol} - \sum_{i=1}^{k}  z_i - \additiveError \leq \multError \sum_{i=1}^{k} \valBy{i}{\retSol} - \multError \sum_{i=1}^{k-1}  z_i. 
    \end{align*}
        \qedhere
\end{proof}


\begin{lemma}\label{lemma:beta-sums-to-diff}
    For any $1 \leq k \leq n$, 
    \begin{align*}
        \sum_{i=1}^k \multError^{i} \valBy{k-i+1}{\retSol} \geq \sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^{k} z_i -\frac{1}{1 - \multError}\additiveError
    \end{align*}
\end{lemma}

\begin{proof}
    The proof is by induction on $k$.
    For $k=1$ the claim follows directly from Lemma \ref{lemma:beta-vk} as $\frac{1}{1-\multError} \geq 1$ for any $\multError \in [0,1)$.
    Assuming the claim is true for $1,\ldots k-1$, we show it is true for $k$:
    \begin{align*}
        &\sum_{i=1}^k \multError^{i} \valBy{k-i+1}{\retSol} = \multError \valBy{k}{\retSol} + \sum_{i=2}^k \multError^{i} \valBy{k-i+1}{\retSol}\\
        &= \multError \valBy{k}{\retSol} + \sum_{i=1}^{k-1} \multError^{i+1} \valBy{k-(i+1)+1}{\retSol} \\
        &= \multError \valBy{k}{\retSol} + \multError \sum_{i=1}^{k-1} \multError^{i} \valBy{(k-1) -i+1}{\retSol}\\
    & \equWithExp{\text{By induction assumption}}{\geq \multError \valBy{k}{\retSol} + \multError \left(\sum_{i=1}^{k-1} \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i -\frac{1}{1-\multError} \additiveError\right)}\\
        &= \multError \sum_{i=1}^{k} \valBy{i}{\retSol} - \multError\sum_{i=1}^{k-1} z_i -\frac{\multError}{1 - \multError}  \additiveError\\
    & \equWithExp{\text{By Lemma \ref{lemma:beta-vk}}}{\geq \sum_{i=1}^{k} \valBy{i}{\retSol} -  \sum_{i=1}^{k} z_i - \additiveError -\frac{\multError}{1 - \multError}  \additiveError}\\
         &=\sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^{k} z_i -\frac{1}{1 - \multError}\additiveError
    \end{align*}
        \qedhere
\end{proof}


\begin{lemma}\label{lemma:fk-to-all}
    For all $1<k \leq n$, 
    \begin{align*}
        \frac{\multError}{1-\multError} \valBy{k}{\retSol} \geq \sum_{i=1}^{k-1}\valBy{i}{\retSol} - \sum_{i=1}^{k-1}z_i - \frac{1}{1 - \multError}\additiveError
    \end{align*}
\end{lemma}

\begin{proof}
    First, notice that since $k \geq (k-1)-i+1$ for any $1\leq i \leq k$ and as the function $\valBy{i}$ represents the $i$-th smallest objective value, also:
    \begin{align}\label{eq:increase-by-obj-size}
        \forall 1\leq i \leq k \colon \Hquad \valBy{k}{\retSol} \geq \valBy{(k-1)-i+1}{\retSol}
    \end{align}
    In addition, consider the geometric series with a first element $1$, a ratio $\multError$, and a length $(k-1)$. 
    As $\multError < 1$, its sum can be bounded in the following way:
    \begin{align}\label{eq:geometric-series-beta}
        \sum_{i=1}^{k-1} \multError^{i-1} = \frac{1-\multError^{k-1}}{1-\multError} < \lim_{k \to \infty}\frac{1-\multError^{k-1}}{1-\multError} = \frac{1}{1-\multError}
    \end{align}
    
    Now, the claim can be concluded as follows:
    \begin{align*}
        & \frac{\multError}{1-\multError}\valBy{k}{\retSol} = \multError \left(\frac{1}{1-\multError} \valBy{k}{\retSol} \right)\\
        & \equWithExp{\text{By Equation \eqref{eq:geometric-series-beta}}}{ > \multError \left(\sum_{i=1}^{k-1} \multError^{i-1} \valBy{k}{\retSol} \right)}\\
        & \equWithExp{\text{By Equation \eqref{eq:increase-by-obj-size}}}{\geq  \multError \left(\sum_{i=1}^{k-1} \multError^{i-1} \valBy{(k-1)-i+1}{\retSol} \right)}\\
        &= \sum_{i=1}^{k-1} \multError^{i} \valBy{(k-1)-i+1}{\retSol} \\ % in ecai it was on the previous line
        & \equWithExp{\text{By Lemma \ref{lemma:beta-sums-to-diff} for $(k-1)\geq 1$}}{\geq \sum_{i=1}^{k-1}\valBy{i}{\retSol} - \sum_{i=1}^{k-1}z_i -\frac{1}{1 - \multError} \additiveError}
\end{align*}
\end{proof}



%------
% thm.

We are now ready to prove the Theorem \ref{th:main}.
\begin{proof}[Proof of Theorem \ref{th:main}]
    % \eden{I'm not sure if we should write again about the claim with $\multApprox$}
    Recall that the claim is that $\retSol$ is a $\left(\frac{\multApprox^2}{1-\multApprox + \multApprox^2}, \frac{\additiveApprox}{1-\multApprox +\multApprox^2}\right)$-leximin-approximation.
    
    For brevity, we define the following constant:
    \begin{align*}
        \Delta(\multApprox) = \frac{1}{1-\multApprox + \multApprox^2}
    \end{align*}
    Accordingly, we need to prove that $\retSol$ is a $\left(\multApprox^2\cdot\Delta(\multApprox), \additiveApprox \cdot\Delta(\multApprox)\right)$-approximation.
    
   As $\multApprox = 1 - \multError$, it is easy to verify that:
   \begin{align}\label{eq:delta-alpha-with-beta}
       \Delta(\multApprox) = \frac{1}{1-\multError + \multError^2}
   \end{align}
    % Which implies that:
    % \begin{align}\label{equ:mu}
    % \frac{\multApprox^2}{\Delta(\multApprox)} = \frac{(1-\multError)^2}{1-\multError +\multError^2}
    % \end{align}
    % And also that:
    % \begin{align}\label{eq:additive-error}
    %     \frac{\Delta^{add}}{ \multApprox\cdot\Delta^{mult}}  = \emark{\frac{1}{(1-\multError)^2}}.
    % \end{align}
    % Both of these equations will be helpful later.

    Now, suppose by contradiction that $\retSol$ is \emph{not} $\left(\multApprox^2\cdot\Delta(\multApprox), \additiveApprox \cdot\Delta(\multApprox)\right)$-approximately leximin-optimal.
    By definition, this means there exists a solution $y \in S$  that is $\left(\multApprox^2\cdot\Delta(\multApprox), \additiveApprox \cdot\Delta(\multApprox)\right)$-leximin-preferred over it.
    That is, there exists an integer $1 \leq k \leq n$ such that:
    \begin{align*}
        \forall j < k \colon &\valBy{j}{y} \geq \valBy{j}{\retSol};\\
        & \valBy{k}{y} > \frac{1}{\multApprox^2\cdot\Delta(\multApprox)} \left(\valBy{k}{\retSol} + \additiveApprox \cdot\Delta(\multApprox) \right).
    \end{align*}

    Since $\retSol$ was obtained in \eqref{eq:compact-OP} that was solved in the last iteration $n$, it is clear that $\sum_{i=1}^k \valBy{i}{\retSol} \geq \sum_{i=1}^{k} z_i$ (by constraint (\progCompact.2) if $k<n$ and (\progCompact.3) otherwise).
    Which implies:
    \begin{align}\label{eq:fk-to-zk}
        \sum_{i=1}^k \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i \geq z_k
    \end{align}

    Now, consider \eqref{eq:compact-OP} that was solved in iteration $k$.
    By Observation \ref{obs:retSol-solves-any-t}, $\retSol$ is feasible to this problem.
    As the $(k-1)$ smallest objective values of $y$ are at least as high as those of $\retSol$, it is easy to conclude that $y$ also satisfies constraints (\progCompact.2) of this problem; since, for any $\ell < k$:
    \begin{align*}
        \sum_{i=1}^{\ell} \valBy{i}{y} \geq\sum_{i=1}^{\ell} \valBy{i}{\retSol} \geq \sum_{i=1}^{\ell} z_i
    \end{align*}
    Therefore, by Observation \ref{obs:feasi-and-constraint2}, $y$ is also feasible to this problem. 

    The value obtained during the algorithm run as an approximation for this problem is $z_k$.
    This means that the optimal value is at most $\frac{1}{\multApprox}\left(z_k + \additiveError \right)$.
    As $y$ is feasible in this problem, and since the objective value obtained by $y$ in this problem is $\sum_{i=1}^k \valBy{i}{y} - \sum_{i=1}^{k-1} z_i$ (by Observation \ref{obs:obj-value}), this implies the following:
    \begin{align}\label{eq:y-upper bound} 
        \sum_{i=1}^k \valBy{i}{y} - \sum_{i=1}^{k-1} z_i \leq \frac{1}{(1-\multError)}\left(z_k+\additiveError\right)
    \end{align}

    If $k=1$, we get that the objective value obtained by $y$ is $\valBy{1}{y}$.
    In addition, $\valBy{1}{\retSol} \geq z_1$ by Equation \eqref{eq:fk-to-zk}. 
    However, as $0<\multApprox \leq 1$, then $\Delta(\multApprox) \geq 1$ but $\multApprox \cdot\Delta(\multApprox) \leq 1$.
    It follows that:
    \begin{align*}
        \valBy{1}{y}> \frac{1}{\multApprox^2 \cdot \Delta(\multApprox)} \left(\valBy{1}{\retSol} + \additiveError \cdot \Delta(\multApprox) \right)\geq \frac{1}{\multApprox} \left(z_1 + \additiveError \right)
    \end{align*}
    In contradiction to Equation \eqref{eq:y-upper bound}.

    
    Therefore, $k>1$.  
    We start by showing that the following holds:
    \begin{align}\label{eq:yk-to-sum}
        \valBy{k}{y} > \frac{1}{1-\multError} \left( \valBy{k}{\retSol} + \multError\sum_{i=1}^{k-1}\valBy{i}{\retSol} - \multError \sum_{i=1}^{k-1}z_i  +\additiveError \right)
    \end{align}
    Consider $\valBy{k}{y}$, by the definition of $y$ for $k$ we get that:
    \begin{align*}
        &\valBy{k}{y} > \frac{1}{ \multApprox^2 \cdot \Delta(\multApprox)} \left(\valBy{k}{\retSol} +  \additiveError \cdot \Delta(\multApprox) \right)\\
        &\equWithExp{\text{\displayComsoc{By Equ. \eqref{eq:delta-alpha-with-beta} and $\multError$'s def.}\displayEcai{Since $\multApprox = 1 - \multError$ and by Equation \eqref{eq:delta-alpha-with-beta}, this equals to}}}{= \frac{1}{\multApprox}\left(\frac{1-\multError +\multError^2}{1-\multError} \valBy{k}{\retSol}+ \frac{1}{\multApprox}\additiveError\right)}\\
        &= \frac{1}{\multApprox}\left(\valBy{k}{\retSol} + \frac{\multError^2}{1-\multError} \valBy{k}{\retSol}+ \frac{1}{\multApprox}\additiveError\right)\\
        &\equWithExp{\text{By Lemma \ref{lemma:fk-to-all}\displayEcai{ we can conclude that}}}{
         % and as $-\frac{\multError}{1-\multError} + \frac{1}{1-\multError} = 1$
        \geq \frac{1}{\multApprox}\left(\valBy{k}{\retSol} + \multError\Bigr[\sum_{i=1}^{k-1}\valBy{i}{\retSol} - \sum_{i=1}^{k-1}z_i -\frac{1}{1-\multError}\additiveError\Bigr]+ \frac{1}{\multApprox}\additiveError\right)}\\
        & \equWithExp{\text{\displayComsoc{By $\multError$'s def.}\displayEcai{As $\multApprox = 1-\multError$}}}{\frac{1}{1-\multError}\left(\valBy{k}{\retSol} + \multError\sum_{i=1}^{k-1}\valBy{i}{\retSol} -\multError \sum_{i=1}^{k-1}z_i +\additiveError\right)}
    \end{align*}    

    But, we shall now prove that this means, once again, that the objective value of $y$, which is $\sum_{i=1}^k \valBy{i}{y} - \sum_{i=1}^{k-1} z_i$, is higher than $\frac{1}{1-\multError} \left(z_k +\additiveError\right)$, in contradiction to Equation \eqref{eq:y-upper bound}:
    \begin{align*}
        &\displayComsoc{\quad}\sum_{i=1}^k \valBy{i}{y} - \sum_{i=1}^{k-1} z_i=\sum_{i=1}^{k-1} \valBy{i}{y} - \sum_{i=1}^{k-1} z_i + \valBy{k}{y}\\
        &\text{By the definition of $y$ for $i<k$:}\\
        &\displayComsoc{\quad}\geq \sum_{i=1}^{k-1} \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i + \valBy{k}{y}\\
        &\text{By Equation \eqref{eq:yk-to-sum}:}\\
        &\displayComsoc{\quad}> \sum_{i=1}^{k-1} \valBy{i}{\retSol} - \sum_{i=1}^{k-1} z_i + \frac{1}{1-\multError} \valBy{k}{\retSol} \displayEcai{ \\
        & \quad\quad\quad} + \frac{\multError}{1-\multError}\sum_{i=1}^{k-1}\valBy{i}{\retSol} - \frac{\multError}{1-\multError}\sum_{i=1}^{k-1}z_i +\frac{1}{1-\multError}\cdot\additiveError\\
        &\text{Since  $1+\frac{\multError}{1-\multError} = \frac{1}{1-\multError}$, this equals to:}\\
        &\displayComsoc{\quad} = \frac{1}{1-\multError}\sum_{i=1}^{k-1} \valBy{i}{\retSol} - \frac{1}{1-\multError}\sum_{i=1}^{k-1} z_i + \frac{1}{1-\multError} \valBy{k}{\retSol} + \frac{1}{1-\multError} \additiveError\\
        & \displayComsoc{\quad}= \frac{1}{1-\multError} \left(\sum_{i=1}^k \valBy{k}{\retSol} - \sum_{i=1}^{k-1}z_i + \additiveError\right)\\
        &\text{By Equation \eqref{eq:fk-to-zk}:}\\
        &\displayComsoc{\quad}\geq \frac{1}{1-\multError} \left(z_k +\additiveError\right).
    \end{align*}
    This is a contradiction, so Theorem \ref{th:main} is proved.
\end{proof}
