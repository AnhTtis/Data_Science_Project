\resizebox{\linewidth}{!}{%
    \begin{tikzpicture}[->,>=stealth',auto,
      thick,
      data node/.style={rectangle,draw,font=\sffamily\LARGE\bfseries, minimum width=1.7cm, minimum height=1.7cm},
      func node/.style={circle,draw,font=\sffamily\LARGE\bfseries, minimum width=2cm, minimum height=1cm},
      ] 
        \LARGE
        \pgfdeclarelayer{background}
        \pgfsetlayers{background, main}
        
        \node[data node, draw=aabbcc!80, fill=aabbcc!10] (x) {$\mathbf{x}_{T}$};
        \node[func node, above=0.7cm of x, draw=aabbee!80, fill=aabbee!10] (unet){$\boldsymbol\epsilon_\theta$};
        \draw[->] (x) -- (unet);
        \node[func node, right=0.7cm of x] (ddim) {$\mathrm{DDIM}$};
        \node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim |- unet) (n) {$\boldsymbol\epsilon_{T}$};
        \draw[->] (unet) -- (n);
        \draw[->] (n) -- (ddim);
        \draw[->] (x) -- (ddim);
        % \draw[->] (ddim-t) -- +(0:2);
        % \draw[<-] (x-t) -- +(180:2);
        \node[data node, above=0.7cm of unet, draw=aaddee!80, fill=aaddee!10] (c) {$\mathbf{c}$};
        \draw[->] (c) -- (unet);
        
        \begin{pgfonlayer}{background}
        \node [fit=(x)(unet)(n)(ddim)(c), label={above:Step $T$}, fill=aaddff!10] {}; 
        \end{pgfonlayer}

        \node[data node, right=0.7cm of ddim, draw=aaccff!80, fill=aaccff!10] (x-t-1) {$\mathbf{x}_{T-1}$};
        \node[func node, above=0.7cm of x-t-1, draw=aabbee!80, fill=aabbee!10] (unet-t-1){$\boldsymbol\epsilon_\theta$};
        \draw[->] (x-t-1) -- (unet-t-1);
        \node[func node, right=0.7cm of x-t-1] (ddim-t-1) {$\mathrm{DDIM}$};
        \node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t-1 |- unet-t-1) (n-t-1) {$\boldsymbol\epsilon_{T-1}$};
        \draw[->] (unet-t-1) -- (n-t-1);
        \draw[->] (n-t-1) -- (ddim-t-1);
        \draw[->] (x-t-1) -- (ddim-t-1);
        % \draw[->] (ddim-t) -- +(0:2);
        % \draw[<-] (x-t) -- +(180:2);
        \node[data node, above=0.7cm of unet-t-1, draw=aaddee!80, fill=aaddee!10] (c-t-1) {$\mathbf{c}$};
        \draw[->] (c-t-1) -- (unet-t-1);
        

        \begin{pgfonlayer}{background}
        \node [fit=(x-t-1)(unet-t-1)(n-t-1)(ddim-t-1)(c-t-1), label={above:Step $T-1$}, fill=aaddff!10] {}; 
        \end{pgfonlayer}
        
        \draw[->] (ddim) -- (x-t-1);

        \node[right=0.7cm of ddim-t-1] (dots) {$\dots$};
        \draw[->] (ddim-t-1) -- (dots);
        
        \node[data node, right=0.7cm of dots, draw=aaccff!80, fill=aaccff!10] (x-t) {$\mathbf{x}_{t}$};
        \node[func node, above=0.7cm of x-t, draw=aabbee!80, fill=aabbee!10] (unet-t){$\boldsymbol\epsilon_\theta$};
        \draw[->] (x-t) -- (unet-t);
        \node[func node, right=0.7cm of x-t] (ddim-t) {$\mathrm{DDIM}$};
        \node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t |- unet-t) (n-t) {$\boldsymbol\epsilon_{t}$};
        \draw[->] (unet-t) -- (n-t);
        \draw[->] (n-t) -- (ddim-t);
        \draw[->] (x-t) -- (ddim-t);
        % \draw[->] (ddim-t) -- +(0:2);
        % \draw[<-] (x-t) -- +(180:2);
        \node[data node, above=0.7cm of unet-t, draw=aaddee!80, fill=aaddee!10] (c-t) {$\mathbf{c}$};
        \draw[->] (c-t) -- (unet-t);
        

        \begin{pgfonlayer}{background}
        \node [fit=(x-t)(unet-t)(n-t)(ddim-t)(c-t), label={above:Step $t$}, fill=aaddff!10] {}; 
        \end{pgfonlayer}

        \draw[->] (dots) -- (x-t);

        \node[right=0.7cm of ddim-t] (dots2) {$\dots$};
        \draw[->] (ddim-t) -- (dots2);

        \node[data node, right=0.7cm of dots2, draw=aaccff!80, fill=aaccff!10] (x-1) {$\mathbf{x}_{1}$};
        \node[func node, above=0.7cm of x-1, draw=aabbee!80, fill=aabbee!10] (unet-1){$\boldsymbol\epsilon_\theta$};
        \draw[->] (x-1) -- (unet-1);
        \node[func node, right=0.7cm of x-1] (ddim-1) {$\mathrm{DDIM}$};
        \node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-1 |- unet-1) (n-1) {$\boldsymbol\epsilon_{1}$};
        \draw[->] (unet-1) -- (n-1);
        \draw[->] (n-1) -- (ddim-1);
        \draw[->] (x-1) -- (ddim-1);
        % \draw[->] (ddim-t) -- +(0:2);
        % \draw[<-] (x-t) -- +(180:2);
        \node[data node, above=0.7cm of unet-1, draw=aaddee!80, fill=aaddee!10] (c-1) {$\mathbf{c}$};
        \draw[->] (c-1) -- (unet-1);

        \begin{pgfonlayer}{background}
        \node [fit=(x-1)(unet-1)(n-1)(ddim-1)(c-1), label={above:Step $1$}, fill=aaddff!10] {}; 
        \end{pgfonlayer}
        
        \draw[->] (dots2) -- (x-1);
        
        \node[data node, right=0.7cm of ddim-1] (x-0) {$\mathbf{x}_{0}$};

        \draw[->] (ddim-1) -- (x-0);
    \end{tikzpicture}
}