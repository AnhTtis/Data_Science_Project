\resizebox{\linewidth}{!}{%
\begin{tikzpicture}[
->,>=stealth',auto,
      % thick,
      data node/.style={rectangle,draw,font=\sffamily\LARGE, minimum width=1.2cm, minimum height=1.2cm},
      func node/.style={circle,draw,font=\sffamily\LARGE, minimum width=1.5cm, minimum height=0.4cm},
]
\LARGE
\pgfdeclarelayer{background}
\pgfdeclarelayer{bbackground}
\pgfsetlayers{bbackground, background, main}
        
\node[data node, draw=aabbcc!80, fill=aabbcc!10, label={[name=x-name]below: $\mathbf{x}_{T}\phantom{^{(A)}}$}] (x) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xa/50.jpg}
};

\node[func node, right=0.4cm of x] (ddim) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x] (unet) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim |- unet) (n) {$\textcolor{A}{\boldsymbol\epsilon_{T}^{(A)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet] (c) {$\textcolor{A}{\mathbf{c}^{(A)}}$};

\draw[->] (x) -- (ddim);
\draw[->] (unet) -- (n);
\draw[->] (x) -- (unet);
\draw[->] (n) -- (ddim);
\draw[->] (c) -- (unet);

\begin{pgfonlayer}{background}
\node [fit=(x)(unet)(n)(ddim)(c), label={above:Step $T$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\node[right=0.4cm of ddim] (dots3) {$\dots$};
\draw[->] (ddim) -- (dots3);

\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots3, label={below: $\textcolor{A}{\mathbf{x}_{t_{\text{max}}}^{(A)}}$}] (x-t-1) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xa/30.jpg}
};

\node[func node, right=0.4cm of x-t-1] (ddim-t-1) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t-1] (unet-t-1) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t-1 |- unet-t-1) (n-t-1) {$\textcolor{A}{\boldsymbol\epsilon_{t_{\text{max}}}^{(A)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t-1] (c-t-1) {$\textcolor{A}{\mathbf{c}^{(A)}}$};

\draw[->] (x-t-1) -- (ddim-t-1);
\draw[->] (unet-t-1) -- (n-t-1);
\draw[->] (x-t-1) -- (unet-t-1);
\draw[->] (n-t-1) -- (ddim-t-1);
\draw[->] (c-t-1) -- (unet-t-1);

\begin{pgfonlayer}{background}
\node [fit=(x-t-1)(unet-t-1)(n-t-1)(ddim-t-1)(c-t-1), label={above:Step $t_{\text{max}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

% \draw[->] (ddim) -- (x-t-1);
\draw[->] (dots3) -- (x-t-1);



\node[right=0.4cm of ddim-t-1] (dots) {$\dots$};
\draw[->] (ddim-t-1) -- (dots);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots, label={below: $\textcolor{A}{\mathbf{x}_{t_{\text{min}}}^{(A)}}$}] (x-t) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xa/20.jpg}
};

\node[func node, right=0.4cm of x-t] (ddim-t) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t] (unet-t) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t |- unet-t) (n-t) {$\textcolor{A}{\boldsymbol\epsilon_{t_{\text{min}}}^{(A)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t] (c-t) {$\textcolor{A}{\mathbf{c}^{(A)}}$};

\draw[->] (x-t) -- (ddim-t);
\draw[->] (unet-t) -- (n-t);
\draw[->] (x-t) -- (unet-t);
\draw[->] (n-t) -- (ddim-t);
\draw[->] (c-t) -- (unet-t);

\begin{pgfonlayer}{background}
\node [fit=(x-t)(unet-t)(n-t)(ddim-t)(c-t), label={above:Step $t_{\text{min}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots) -- (x-t);


\node[right=0.4cm of ddim-t] (dots2) {$\dots$};
\draw[->] (ddim-t) -- (dots2);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots2, label={below: $\textcolor{A}{\mathbf{x}_{1}^{(A)}}$}] (x-1) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xa/10.jpg}
};

\node[func node, right=0.4cm of x-1] (ddim-1) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-1] (unet-1) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-1 |- unet-1) (n-1) {$\textcolor{A}{\boldsymbol\epsilon_{1}^{(A)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-1] (c-1) {$\textcolor{A}{\mathbf{c}^{(A)}}$};

\draw[->] (x-1) -- (ddim-1);
\draw[->] (unet-1) -- (n-1);
\draw[->] (x-1) -- (unet-1);
\draw[->] (n-1) -- (ddim-1);
\draw[->] (c-1) -- (unet-1);

\begin{pgfonlayer}{background}
\node [fit=(x-1)(unet-1)(n-1)(ddim-1)(c-1), label={[name=step-name]above:Step $1$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots2) -- (x-1);

\node[data node, draw, right=0.4cm of ddim-1, label={below: $\textcolor{A}{\mathbf{x}_{0}^{(A)}}$}] (x-0) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xa/1.jpg}
};

\draw[->] (ddim-1) -- (x-0);

\begin{pgfonlayer}{bbackground}
\node [fit=(x)(unet)(n)(ddim)(c)(x-0)(x-name)(step-name), fill=aaddgg!10, label={right: \rotatebox{-90}{%Generated given condition 
$\textcolor{A}{\mathbf{c}^{(A)}}$}}] {}; 
\end{pgfonlayer}

%%%%%
\node[data node, draw=aabbcc!80, fill=aabbcc!10, label={[name=x-name]below: $\mathbf{x}_{T}\phantom{^{(B)}}$}, below=7cm of x] (x) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/50.jpg}
};

\node[func node, right=0.4cm of x] (ddim) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x] (unet) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim |- unet) (n) {$\textcolor{B}{\boldsymbol\epsilon_{T}^{(B)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet] (c) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x) -- (ddim);
\draw[->] (unet) -- (n);
\draw[->] (x) -- (unet);
\draw[->] (n) -- (ddim);
\draw[->] (c) -- (unet);


\begin{pgfonlayer}{background}
\node [fit=(x)(unet)(n)(ddim)(c), label={above:Step $T$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\node[right=0.4cm of ddim] (dots3) {$\dots$};
\draw[->] (ddim) -- (dots3);

\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots3, label={below: $\textcolor{B}{\mathbf{x}_{t_{\text{max}}}^{(B)}}$}] (x-t-1) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/epsilon/30.jpg}
};

\node[func node, right=0.4cm of x-t-1] (ddim-t-1) {DDIM};

\phantom{\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t-1] (unet-t-1) {$\boldsymbol\epsilon_\theta$};}

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t-1 |- unet-t-1) (n-t-1-copy) {$\textcolor{A}{\boldsymbol\epsilon_{t_{\text{max}}}^{(A)}}$};

\phantom{\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t-1] (c-t-1) {$\textcolor{B}{\mathbf{c}^{(B)}}$};}

\draw[->] (x-t-1) -- (ddim-t-1);
% \draw[->] (unet-t-1) -- (n-t-1);
% \draw[->] (x-t-1) -- (unet-t-1);
\draw[->] (n-t-1-copy) -- (ddim-t-1);
% \draw[->] (c-t-1) -- (unet-t-1);


\draw[dashed, ->] ([yshift=0pt]n-t-1.south east) to[bend left] node[above, midway, sloped] {Copy} ([yshift=0pt]n-t-1-copy.north east) ;

\begin{pgfonlayer}{background}
\node [fit=(x-t-1)(unet-t-1)(n-t-1-copy)(ddim-t-1)(c-t-1), label={above:Step $t_{\text{max}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

% \draw[->] (ddim) -- (x-t-1);
\draw[->] (dots3) -- (x-t-1);


\node[right=0.4cm of ddim-t-1] (dots) {$\dots$};
\draw[->] (ddim-t-1) -- (dots);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots, label={below: $\textcolor{star}{\mathbf{x}_{t_{\text{min}}}^{(\star)}}$}] (x-t) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/epsilon/20.jpg}
};

\node[func node, right=0.4cm of x-t] (ddim-t) {DDIM};

\phantom{\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t] (unet-t) {$\boldsymbol\epsilon_\theta$};}

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t |- unet-t) (n-t-copy) {$\textcolor{A}{\boldsymbol\epsilon_{t_{\text{min}}}^{(A)}}$};

\phantom{\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t] (c-t) {$\textcolor{B}{\mathbf{c}^{(B)}}$};}

\draw[->] (x-t) -- (ddim-t);
% \draw[->] (unet-t) -- (n-t);
% \draw[->] (x-t) -- (unet-t);
\draw[->] (n-t-copy) -- (ddim-t);
% \draw[->] (c-t) -- (unet-t);

\draw[dashed, ->] ([yshift=0pt]n-t.south east) to[bend left] node[above, midway, sloped] {Copy} ([yshift=0pt]n-t-copy.north east) ;

\begin{pgfonlayer}{background}
\node [fit=(x-t)(unet-t)(n-t-copy)(ddim-t)(c-t), label={above:Step $t_{\text{min}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots) -- (x-t);


\node[right=0.4cm of ddim-t] (dots2) {$\dots$};
\draw[->] (ddim-t) -- (dots2);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots2, label={below: $\textcolor{star}{\mathbf{x}_{1}^{(\star)}}$}] (x-1) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/epsilon/10.jpg}
};

\node[func node, right=0.4cm of x-1] (ddim-1) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-1] (unet-1) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-1 |- unet-1) (n-1) {$\textcolor{star}{\boldsymbol\epsilon_{1}^{(\star)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-1] (c-1) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x-1) -- (ddim-1);
\draw[->] (unet-1) -- (n-1);
\draw[->] (x-1) -- (unet-1);
\draw[->] (n-1) -- (ddim-1);
\draw[->] (c-1) -- (unet-1);

\begin{pgfonlayer}{background}
\node [fit=(x-1)(unet-1)(n-1)(ddim-1)(c-1), label={[name=step-name]above:Step $1$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots2) -- (x-1);

\node[data node, draw, right=0.4cm of ddim-1, label={below: $\textcolor{star}{\mathbf{x}_{0}^{(\star)}}$}] (x-0) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/epsilon/1.jpg}
};

\draw[->] (ddim-1) -- (x-0);

\begin{pgfonlayer}{bbackground}
\node [fit=(x)(unet)(n)(ddim)(c)(x-0)(x-name)(step-name), fill=aaddgg!10, label={right: \rotatebox{-90}{Edited}}] {}; 
\end{pgfonlayer}


%%%%%
\node[data node, draw=aabbcc!80, fill=aabbcc!10, label={[name=x-name]below: $\mathbf{x}_{T}\phantom{^{(A)}}$}, below=7cm of x] (x-copy) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/50.jpg}
};

% \draw[dashed, <-] ([yshift=0pt]x.south west) to[bend right] node[above, midway, sloped] {Copy} ([yshift=0pt]x-copy.north west);

\node[func node, right=0.4cm of x-copy] (ddim) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-copy] (unet) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim |- unet) (n) {$\textcolor{B}{\boldsymbol\epsilon_{T}^{(B)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet] (c) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x-copy) -- (ddim);
\draw[->] (unet) -- (n);
\draw[->] (x-copy) -- (unet);
\draw[->] (n) -- (ddim);
\draw[->] (c) -- (unet);

\begin{pgfonlayer}{background}
\node [fit=(x-copy)(unet)(n)(ddim)(c), label={above:Step $T$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\node[right=0.4cm of ddim] (dots3) {$\dots$};
\draw[->] (ddim) -- (dots3);

\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots3, label={below: $\textcolor{B}{\mathbf{x}_{t_{\text{max}}}^{(B)}}$}] (x-t-1-copy) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/30.jpg}
};

% \draw[dashed, <-] ([yshift=0pt]x-t-1.south west) to[bend right] node[above, midway, sloped] {Copy} ([yshift=0pt]x-t-1-copy.north west);

\node[func node, right=0.4cm of x-t-1-copy] (ddim-t-1) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t-1-copy] (unet-t-1) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t-1 |- unet-t-1) (n-t-1) {$\textcolor{B}{\boldsymbol\epsilon_{t_{\text{max}}}^{(B)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t-1] (c-t-1) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x-t-1-copy) -- (ddim-t-1);
\draw[->] (unet-t-1) -- (n-t-1);
\draw[->] (x-t-1-copy) -- (unet-t-1);
\draw[->] (n-t-1) -- (ddim-t-1);
\draw[->] (c-t-1) -- (unet-t-1);

% \draw[dashed, ->] ([yshift=0pt]n-t-1.south east) to[bend left] node[above, midway, sloped] {Copy} ([yshift=0pt]n-t-1-copy.north east) ;

\begin{pgfonlayer}{background}
\node [fit=(x-t-1-copy)(unet-t-1)(n-t-1)(ddim-t-1)(c-t-1), label={above:Step $t_{\text{max}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

% \draw[->] (ddim) -- (x-t-1);
\draw[->] (dots3) -- (x-t-1-copy);


\node[right=0.4cm of ddim-t-1] (dots) {$\dots$};
\draw[->] (ddim-t-1) -- (dots);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots, label={below: $\textcolor{B}{\mathbf{x}_{t_{\text{min}}}^{(B)}}$}] (x-t) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/20.jpg}
};

\node[func node, right=0.4cm of x-t] (ddim-t) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-t] (unet-t) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-t |- unet-t) (n-t) {$\textcolor{B}{\boldsymbol\epsilon_{t_{\text{min}}}^{(B)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-t] (c-t) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x-t) -- (ddim-t);
\draw[->] (unet-t) -- (n-t);
\draw[->] (x-t) -- (unet-t);
\draw[->] (n-t) -- (ddim-t);
\draw[->] (c-t) -- (unet-t);

% \draw[dashed, ->] ([yshift=0pt]n-t.south east) to[bend left] node[above, midway, sloped] {Copy} ([yshift=0pt]n-t-copy.north east) ;

\begin{pgfonlayer}{background}
\node [fit=(x-t)(unet-t)(n-t)(ddim-t)(c-t), label={above:Step $t_{\text{min}}$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots) -- (x-t);


\node[right=0.4cm of ddim-t] (dots2) {$\dots$};
\draw[->] (ddim-t) -- (dots2);
        
\node[data node, draw=aaccff!80, fill=aaccff!10, right=0.4cm of dots2, label={below: $\textcolor{B}{\mathbf{x}_{1}^{(B)}}$}] (x-1) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/10.jpg}
};

\node[func node, right=0.4cm of x-1] (ddim-1) {DDIM};

\node[func node, draw=aabbee!80, fill=aabbee!10, above=0.4cm of x-1] (unet-1) {$\boldsymbol\epsilon_\theta$};

\node[data node, draw=aabbff!80, fill=aabbff!10] at (ddim-1 |- unet-1) (n-1) {$\textcolor{B}{\boldsymbol\epsilon_{1}^{(B)}}$};

\node[data node, draw=aaddee!80, fill=aaddee!10, above=0.4cm of unet-1] (c-1) {$\textcolor{B}{\mathbf{c}^{(B)}}$};

\draw[->] (x-1) -- (ddim-1);
\draw[->] (unet-1) -- (n-1);
\draw[->] (x-1) -- (unet-1);
\draw[->] (n-1) -- (ddim-1);
\draw[->] (c-1) -- (unet-1);

\begin{pgfonlayer}{background}
\node [fit=(x-1)(unet-1)(n-1)(ddim-1)(c-1), label={[name=step-name]above:Step $1$}, fill=aaddff!10] {}; 
\end{pgfonlayer}

\draw[->] (dots2) -- (x-1);

\node[data node, draw, right=0.4cm of ddim-1, label={below: $\textcolor{B}{\mathbf{x}_{0}^{(B)}}$}] (x-0) {
\includegraphics[scale=0.15]{figures/tex/pipeline_jpg/xb/1.jpg}
};

\draw[->] (ddim-1) -- (x-0);

\begin{pgfonlayer}{bbackground}
\node [fit=(x-copy)(unet)(n)(ddim)(c)(x-0)(x-name)(step-name), fill=aaddgg!10, label={right: \rotatebox{-90}{%Generated given condition 
$\textcolor{B}{\mathbf{c}^{(B)}}$}}] {}; 
\end{pgfonlayer}
\end{tikzpicture}
}