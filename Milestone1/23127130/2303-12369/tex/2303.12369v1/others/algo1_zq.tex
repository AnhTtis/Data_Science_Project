\renewcommand{\algorithmicforall}{\textbf{for each}}
\begin{algorithm}[!t]
    \caption{UMIL Training (1 epoch)}
    \label{alg:1}
    \begin{algorithmic}[1]
        \STATE {\bfseries Input:} $N+M$ video snippets, backbone parameterized by $\theta$, classifier $f$ and cluster head $g$, batch size $b$.
        \STATE {\bfseries Output:} $\theta,f,g$ trained for 1 epoch.
        
        \STATE Compute $\{\mathbf{x}_i\}_{i=1}^{N+M}$ (features extracted by $\theta$)
        \STATE Update prediction history $\mathcal{H}\leftarrow \mathcal{H} \cup \{f(\mathbf{x}_i)\}_{i=1}^{N+M}$
        \STATE Construct $\mathcal{C}=\{f(\mathbf{x}_i),y_i\}_{i=1}^N, \mathcal{A}=\{\mathbf{x}_i\}_{i=1}^M$ from $\mathcal{H}$
        % % \STATE Pre-process features in $T$ with UMAP
        % \STATE Train $\phi$ using the backbone features
        \REPEAT
            \STATE Sample a batch $\{f(\mathbf{x}_i),y_i\}_{i=1}^b$ from $\mathcal{C}$
            \STATE Compute $\textrm{BCE}(\mathcal{C})$ for the batch with Eq.~\eqref{eq:1}
            \STATE Sample a batch $\{\mathbf{x}_i\}_{i=1}^b$ from $\mathcal{A}$
            \STATE Assign $y_i\leftarrow\mathrm{argmax}\,g(\mathbf{x}_i)$ for $i\in\{1,\ldots,b\}$
            \STATE Construct $\mathcal{A}_g,\mathcal{A}_f$ with Eq.~\eqref{eq:2},~\eqref{eq:3} for the batch
            \STATE Compute $\textrm{BCE}(\mathcal{A}_g),\textrm{BCE}(\mathcal{A}_f)$
            \STATE Optimize $\theta,f,g$ with Eq.~\eqref{eq:4}
        \UNTIL{end of epoch}
    \end{algorithmic}
\end{algorithm}
