\documentclass[acmjacm]{acmsmall}

\usepackage{latexsym,xspace,calc,amsthm}
\usepackage{amsmath,amssymb} 

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{3}

%to number lines
%\usepackage[displaymath, mathlines]{lineno}
%\linenumbers

%\usepackage{mathsastext}
%FONTS
% allow fonts at arbitrary sizes
\usepackage{lmodern}
% improve typsetting
\usepackage{microtype}
%\usepackage{tgadventor}
%TeX Gyre Adventor is based on the URW Gothic L family of fonts (which is derived from ITC Avant Garde Gothic, designed by Herb Lubalin and Tom Carnase).
%TeX Gyre Bonum is based on the URW Bookman L family (from Bookman Old Style, designed by Alexander Phemister).
%TeX Gyre Chorus is based on URW Chancery L Medium Italic (from ITC Zapf Chancery, designed by Hermann Zapf in 1979).
%TeX-Gyre Cursor is based on URW Nimbus Mono L (based on Courier, designed by Howard G. Kettler in 1955, for IBM).
%\usepackage{tgheros}
%TeX Gyre Heros is based on URW Nimbus Sans L (from Helvetica, prepared by Max Miedinger, with Eduard Hoffmann in 1957).
%\usepackage{tgpagella}
%TeX Gyre Pagella is based on URW Palladio L (from Palatino, designed by Hermann Zapf in the 1940s).
%TeX Gyre Schola is based on the URW Century Schoolbook L family (which was designed by Morris Fuller Benton for the American Type Founders).
\usepackage{tgtermes}
%TeX Gyre Termes is based on the URW Nimbus Roman No9 L family of fonts (whose original, Times, was designed by Stanley Morison together with Starling Burgess and Victor Lardent and first offered by Monotype).
\usepackage{fix-cm}

\usepackage{cancel}
\usepackage{subcaption}

%fix amsalpha acmsmall bibtex numbering issue, solution taken from
%http://tex.aspcode.net/view/635399273629833626282438/forcing-numbered-bibliography
\makeatletter
\def\@biblabel#1{[#1]} % restore basic form of \@biblabel macro
\def\thebibliography#1{%
    \footnotesize
    \refsection*{{\refname}
        \@mkboth{\uppercase{\refname}}{\uppercase{\refname}}%
    }
    \list{\@biblabel{\@arabic\c@enumiv}}% %the default form of first arg is {}
       {\settowidth\labelwidth{\@biblabel{#1}}%
        \leftmargin\labelwidth
        \advance\leftmargin\bibindent
        \itemindent-\bibindent
        \itemsep2pt
        \parsep \z@
        \usecounter{enumiv}% % default is to use enumi
        \let\p@enumiv\@empty
        \renewcommand\theenumiv{\@arabic\c@enumiv}%
    }%
    \let\newblock\@empty
    \sloppy
    \sfcode`\.=1000\relax
}
\makeatother

%Compact bibliography, due to Axel Reichert.
\let\odlthebibliography=\thebibliography
 \let\endodlthebibliography=\endthebibliography
 \renewenvironment{thebibliography}[1]{%
   \begin{odlthebibliography}{#1}%
     \setlength{\parskip}{0ex}%
     \setlength{\itemsep}{3pt}%
     \fontsize{9.5}{9.5} %Change these numbers to
                         %change font size
     \selectfont
}%
 {%
   \end{odlthebibliography}%
 }


\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{cd,decorations.markings}
\tikzset{
    dharrow/.style={
        <->,
        postaction={decorate,-},
        }
}
\tikzset{
    dhdashedarrow/.style={
        <->,
        dashed,
        postaction={decorate,-},
        }
    }
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{snakes,automata,chains}
\usetikzlibrary{graphs}

\usepackage{binarytree}

\usepackage{amssymb,stmaryrd,amsmath}
\usepackage{mdwlist} % compact lists
\usepackage{float}   % figure placement
\usepackage{centernot} % for centernot comment
%\usepackage{navigator}


\usepackage[colorlinks]{hyperref}
\usepackage{breakurl}  % for line breaks in \burl links
%To stop URL links from appearing in colour, which appear as gray in printed text
%\hypersetup{urlcolor=black,colorlinks}
%\hypersetup{allcolors=black}

%%for llncs, set up environments
%\spnewtheorem{thrm}{Theorem}[subsection]{\sc }{} %{\itshape}
%\spnewtheorem{lemm}[thrm]{Lemma}{\sc }{} %{\itshape}
%\spnewtheorem{prop}[thrm]{Proposition}{\sc }{} %{\itshape}
%\spnewtheorem{corr}[thrm]{Corollary}{\sc }{} %{\itshape}
%
%\spnewtheorem{nttn}[thrm]{Notation}{\sc }{}
%\spnewtheorem{defn}[thrm]{Definition}{\sc }{}
%\spnewtheorem{xmpl}[thrm]{Example}{\sc }{}
%\spnewtheorem{rmrk}[thrm]{Remark}{\sc }{}

%for amsthm
\newtheoremstyle{jamiestyle}% name of the style to be used
  {4pt}% measure of space to leave above the theorem. E.g.: 3pt
  {0pt}% measure of space to leave below the theorem. E.g.: 3pt
  {\it}% name of font to use in the body of the theorem
  {0pt}% measure of space to indent
  {\sc}% name of head font
  {.}% punctuation between head and body
  { }% space after theorem head; " " = normal interword space
  {}% Manually specify head
\theoremstyle{jamiestyle}
\newtheorem{thrm}{Theorem}[subsection]
\newtheorem{prop}[thrm]{Proposition}
\newtheorem{lemm}[thrm]{Lemma}
\newtheorem{corr}[thrm]{Corollary}
\newtheoremstyle{jamienfstyle}% name of the style to be used
  {4pt}% measure of space to leave above the theorem. E.g.: 3pt
  {0pt}% measure of space to leave below the theorem. E.g.: 3pt
  {\normalfont}% name of font to use in the body of the theorem
  {0pt}% measure of space to indent
  {\sc}% name of head font
  {.}% punctuation between head and body
  { }% space after theorem head; " " = normal interword space
  {}% Manually specify head
\theoremstyle{jamienfstyle}
\newtheorem{nttn}[thrm]{Notation}
\newtheorem{defn}[thrm]{Definition}
\newtheorem{xmpl}[thrm]{Example}
\newtheorem{rmrk}[thrm]{Remark}


%colours and listings
\usepackage{color}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\usepackage{listings}
 
\definecolor{gray}{RGB}{128, 128, 128}
\definecolor{lightgray}{RGB}{200, 200, 200}
\definecolor{cyan}{RGB}{0, 255, 255}
\definecolor{blue}{RGB}{0, 0, 255}
\definecolor{red}{RGB}{255, 0, 0}
\definecolor{pink}{RGB}{255, 128, 128}
\definecolor{green}{RGB}{0, 128, 0}
\definecolor{lightyellow}{RGB}{255, 255, 200}
\definecolor{purple}{RGB}{128, 0, 128}

\lstdefinestyle{all}
    {basicstyle=\ttfamily\scriptsize,
     keywordstyle=\color{blue}\ttfamily\scriptsize,
     commentstyle=\color{green}\ttfamily\scriptsize,
     stringstyle=\color{red}\ttfamily\scriptsize}

\lstdefinelanguage{hask}{%
    frame=none,
    xleftmargin=2pt,
    belowcaptionskip=\bigskipamount,
    captionpos=b,
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{gray},
    emphstyle={\bf},
	morecomment=[s][\color{green}]{\{-}{-\}},
    stringstyle=\mdseries\rmfamily,
    commentstyle=\color{green},
    keywords={},
    keywords=[1]{case, of, data, if, then, else, where, let, in, do},
    keywords=[2]{Chip, Config, CurrencySymbol, TokenName, PubKeyHash, Integer, Value, State, Action, Text, Maybe, Void, TxConstraints,  Contract},
    keywords=[3]{HasNative},
    keywords=[4]{=>},
    keywords=[5]{Just, Nothing, MkChip, MkConfig, SetPrice, Buy},
    keywordstyle=[1]\mdseries\sffamily\color{red},
    keywordstyle=[2]\mdseries\sffamily\color{blue},
    keywordstyle=[3]\mdseries\sffamily\color{green},
    keywordstyle=[4]\mdseries\sffamily,
    keywordstyle=[5]\mdseries\sffamily\color{purple},
    columns=flexible,
    basicstyle=\small\sffamily,
    showstringspaces=false,
    breaklines=false,
    showspaces=false,
    escapeinside={--}{\^^M},escapebegin={\color{green}--},escapeend={},
    literate= {+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 {=}{{$=$}}1
              {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
              {\\\\}{{\char`\\\char`\\}}1
              {->}{{$\rightarrow$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
              {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2
              {\ .}{{$\circ$}}2 {\ .\ }{{$\circ$}}2
              {>>}{{>>}}2 {>>=}{{>>=}}2
              {|}{{$\mid$}}1
              {\_}{{\underline{\hspace{2mm}}}}2
}

\lstdefinelanguage{solidity}{%
    frame=none,
    xleftmargin=2pt,
    belowcaptionskip=\bigskipamount,
    captionpos=b,
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{gray},
    emphstyle={\bf},
	morecomment=[s][\color{green}]{\{-}{-\}},
    stringstyle=\mdseries\rmfamily,
    commentstyle=\color{green},
    keywords={},
    keywords=[1]{pragma, solidity, contract, event, constructor, require, function, return, emit},
    keywords=[2]{address, uint, mapping},
    keywords=[3]{public, payable, external, view, returns},
    keywords=[4]{=>, +=, -=, =, <=, ==},
    keywords=[5]{msg, sender, transfer, value},
    keywordstyle=[1]\mdseries\sffamily\color{red},
    keywordstyle=[2]\mdseries\sffamily\color{blue},
    keywordstyle=[3]\mdseries\sffamily\color{green},
    keywordstyle=[4]\mdseries\sffamily,
    keywordstyle=[5]\mdseries\sffamily\color{purple},
    columns=flexible,
    basicstyle=\small\sffamily,
    showstringspaces=false,
    breaklines=false,
    showspaces=false,
    escapeinside={--}{\^^M},escapebegin={\color{green}--},escapeend={},
    literate= {+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 {=}{{$=$}}1
              {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
              {\\\\}{{\char`\\\char`\\}}1
              {->}{{$\rightarrow$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
              {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2
              {\ .}{{$\circ$}}2 {\ .\ }{{$\circ$}}2
              {>>}{{>>}}2 {>>=}{{>>=}}2
              {|}{{$\mid$}}1
              {\_}{{\underline{\hspace{2mm}}}}2
}


%%Put "DRAFT" in the background.  Due to Filox
%\usepackage{graphics} %or \usepackage{graphicx}
%\usepackage{type1cm}
%\usepackage{eso-pic}
%\makeatletter
%\AddToShipoutPicture{ %
%            \setlength{\@tempdimb}{.5\paperwidth}%
%            \setlength{\@tempdimc}{.5\paperheight}%
%            \setlength{\unitlength}{1pt}%
%            \put(\strip@pt\@tempdimb,\strip@pt\@tempdimc){ %
%        \makebox(0,0){\rotatebox{55}{\textcolor[gray]{0.96} %
%        {\fontsize{5cm}{5cm}\selectfont{DRAFT}}}}%
%           % Adjust 7cm to desired font size as necessary
%            } %
%}
%\makeatother

\newcommand\atopen{T}
\newcommand\rulefont[1]{\ensuremath{{\mathrm{\bf (#1)}}}}
\newcommand\leftopeninterval[1]{(#1]}
\newcommand\rightopeninterval[1]{[#1)}
\newcommand\opens{\tf{Open}}
\newcommand\topens{\tf{Topen}}
\newcommand\closed{\tf{Closed}}
\newcommand\thenext[0]{\f{ad}}
%\newcommand\thenext[1]{#1^\plus}
\newcommand\eventually[0]{\f{dep}^\omega}
\newcommand\closure[1]{|#1|}
%\newcommand{\sbt}{{\tikz \draw (0,0) circle (1pt);}}
%\newcommand{\sbt}{{\begin{picture}(-1,1)(-1,-3)\circle*{2}\end{picture}}}
\newcommand\dotclosure[1]{\closure{#1}^{\bigcdot}}
\newcommand{\dotarrow}{% to be used in math mode...
   \mathrel{\ooalign{\hss\raise.85ex\hbox{\scalebox{1.25}{\normalfont .}}%
   \kern0.35ex\hss\cr$\rightarrow$}}}
\newcommand{\dotleftarrow}{\mathrel{\reflectbox{$\dotarrow$}}}

% https://tex.stackexchange.com/questions/474455/how-to-manually-adjust-symbol-positioning-in-underset
\newcommand{\upperset}[2]{
  \underset{
            \text{\raisebox{0.9ex}{\smash{\scalebox{0.8}{$#1$}}\ \ }}%
           }
           {
            \text{\raisebox{0ex}{\smash{$#2$}}}
           }
                       }
\newcommand{\convergesto}[1]{\mathrel{\upperset{#1}{\dotarrow}}}
%\newcommand\betwixt{\rotatebox[origin=c]{-90}{$\between$}}
\newcommand\betwixt{\asymp}
%\newcommand\betwixt{\asymp}
\newcommand\notbetween{\mathbin{\cancel{\between}}}
\newcommand\notintertwinedwith{\mathrel{\notbetween}}
\newcommand\intersectswith{\between}
\newcommand\intertwined[1]{#1_{\between}}
\newcommand\intertwinedwith{\mathrel{\between}}
\newcommand\leqk{\leq_{\hspace{-.7pt}\intertwinedwith}}
\newcommand\geqk{\geq_{\hspace{-.7pt}\intertwinedwith}}
\newcommand\cw{\leftrightarrow}  % cw = connects with
\newcommand\interior[0]{\f{interior}}
\newcommand\kiss[0]{\f{kiss}}
\newcommand\community[0]{\f{K}}
\newcommand\kernel[0]{\f{ker}}
\newcommand\Kernel[0]{\f{Ker}}
\newcommand\witness[0]{\f{W}}
%other commands
\newcommand\mbot{\mathsf{e}}
\newcommand\mtop{\mathsf{f}}
\newcommand\isdef[2]{#1\bullet #2}
\newcommand\deffont[1]{{\bfseries #1}}
\newcommand\powerset{\f{pow}}
\newcommand\comppowerset{\f{pow}_{\hspace{-2pt}c}}
\newcommand\finpow{\f{fin}}
\newcommand\finto{\stackrel{\f{fin}}{\rightharpoonup}}
\newcommand\f[1]{\mathit{#1}}
\newcommand\tf[1]{\mathsf{#1}}
\newcommand\ns[1]{\mathsf{#1}}
\newcommand\finsubseteq{\mathbin{\subseteq_{\text{\it fin}}}}
\newcommand\at{\text{@}}
\newcommand\tx{\f{tx}}
\newcommand\ty{\f{ty}}
\newcommand\ctx{\f{ctx}}
%\newcommand\txs{\f{T\hspace{-2.1pt}xs}}
\newcommand\txs{\f{txs}}
\newcommand\utxi{\f{utxi}}
\newcommand\utxo{\f{utxo}}
\newcommand\stx{\f{stx}}
\newcommand\utxio{\f{utxio}}
\newcommand\UTxIO{\f{UTxIO}}
\newcommand\inlinehask[1]{\lstinline[language=hask]{#1}}
\newcommand\inlinesolidity[1]{\lstinline[language=solidity]{#1}}
%\newcommand\utxo{\f{UTxO}}
\newcommand\valid{\f{valid}}
\newcommand\liff{\Longleftrightarrow}
\newcommand\limp{\Longrightarrow}
\newcommand\aeq{\mathrel{=_{\alpha}}}
\newcommand\ssm{{{:}\text{=}}}
\DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}
\newcommand\minus{{\shortminus}}
%\newcommand\minus{{-}}
\newcommand\plus{{+}}
\newcommand\Forall[1]{\forall #1.}
\newcommand\Exists[1]{\exists #1.}
\newcommand\sm{\mapsto}
\newcommand\rewritesto{\longrightarrow}
\newcommand\cent{\vdash}
\newcommand\ncent{\not\vdash}
\newcommand\ment{\vDash}
\newcommand\supp{\f{supp}}
\newcommand\boundary{\f{boundary}}
\newcommand\lmodel{[\hspace{-0.2em}[}
\newcommand\rmodel{]\hspace{-0.2em}]}
\newcommand\model[1]{{\lmodel #1 \rmodel}}
\newcommand\synmodel[1]{{\langle #1 \rangle}}
\newcommand\mone{{\text{-}1}}

%\newcommand\barcent{\mathrel{\stackrel{\vspace{-1em}{\_}}{\cent}}}
% https://tex.stackexchange.com/questions/349834/stackrel-but-lower
\makeatletter
\DeclareRobustCommand{\barcent}{\mathbin{\mathpalette\barcent@@\relax}}
\newcommand{\barcent@@}[2]{%
  \vbox{\offinterlineskip
    \sbox\z@{$\m@th#1\cent$}%
    \ialign{%
      \hfil##\hfil\cr
      $\m@th#1{}_{\minus}\kern-\scriptspace$\cr
      \noalign{\kern-.3\ht\z@}
      \box\z@\cr
    }%
  }%
}
\makeatother

\newcommand\compressthis[1]{\pmb{\hspace{.8pt}\raisebox{.5pt}{\scalebox{.85}{$#1$}}\hspace{.2pt}}}
\newcommand\tempty{\compressthis{\varnothing}}
\newcommand\tcap{{\compressthis{\cap}}}
\newcommand\tcup{{\compressthis{\cup}}}
\newcommand\tsubseteq{{\compressthis\subseteq}}
\newcommand\tneg{{\pmb\neg}}
\newcommand\tnegnf{{\pmb{\sim}}}
\newcommand\ttop{{\pmb\top}}
\newcommand\tbot{{\pmb\bot}}
\newcommand\teq{{\pmb{\text{=}}}}
\newcommand\tand{{\pmb\wedge}}
\newcommand\tor{{\pmb\vee}}
\newcommand\timp{{\pmb\Rightarrow}}
\newcommand\tiff{\compressthis{\Leftrightarrow}} %{\pmb\Leftrightarrow}}
\newcommand\tlam{{\pmb\lambda}}
\newcommand\tsim{\compressthis{{\approx}}}
\newcommand\tin{{\pmb{\in}}}
\newcommand\ntin{{\pmb{\not\in}}}


% https://tex.stackexchange.com/questions/235118/making-a-thicker-cdot-for-dot-product-that-is-thinner-than-bullet
\makeatletter
\newcommand*\bigcdot{\mathpalette\bigcdot@{.5}}
\newcommand*\bigcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}
\makeatother

\newcommand\act{{\cdot}}
\newcommand\pact{{\cdot}}
\newcommand\mact{\mathbin{\bigcdot}}

\usepackage{datetime}
\yyyymmdddate

\begin{document}
\title{Semitopology: a new topological model of heterogeneous consensus}  
\newcommand\titlerunning{\emph{Semitopology \& heterogeneous consensus}}
\newcommand\authorrunning{\emph{Murdoch J. Gabbay and Giuliano Losa}}
\author{Murdoch J. Gabbay and Giuliano Losa}
\begin{abstract}
A distributed system is \emph{permissionless} when participants can join and leave the network without permission from a central authority.  Many modern distributed systems are naturally permissionless, in the sense that a central permissioning authority would defeat their design purpose: this includes blockchains, filesharing protocols, some voting systems, and more.  By their permissionless nature, such systems are heterogeneous: participants may only have a partial view of the system, and they may also have different goals and beliefs.  Thus, the traditional notion of consensus --- i.e.\ system-wide agreement --- may not be adequate, and we may need to generalise it. 

This is a challenge: how should we understand what heterogeneous consensus is; what mathematical framework might this require; and how can we use this to build understanding and mathematical models of robust, effective, and secure permissionless systems in practice?

In this paper we offer a new definition of heterogeneous consensus, using \emph{semitopology} as a framework.
This is like topology, but without the restriction that intersections of opens be open.

Semitopologies have a rich theory which is related to topology, but with its own distinct character and mathematics.
We introduce novel well-behavedness conditions, including an anti-Hausdorff property and a new notion of `topen set', and we show how these structures relate to consensus.
We give a restriction of semitopologies to \emph{witness semitopologies}, which are an algorithmically tractable subclass corresponding to Horn clause theories, having particularly good mathematical properties.
We introduce and study several other basic notions that are specific and novel to semitopologies, and study how known quantities in topology, such as dense subsets and closures, display interesting and useful new behaviour in this new semitopological context. 

We conclude with a detailed discussion of related work.
\keywords{Topology, Semitopology, Permissionless Network, Heterogeneous consensus, Horn clause programming}
\end{abstract}
\maketitle
\thispagestyle{empty}

\tableofcontents

\section{Introduction}
\label{sect.intro}



\emph{Consensus} is what makes it possible for a distributed system to act as one.
The consensus problem as presented in a classic paper~\cite{lamport:byzgp} from 1982 considers a fixed number of communicating processes which must agree on an action.
This was reasonable for the 1980s and it remains relevant --- but now systems exist that are radically more distributed, driven by an exponential democratisation of computation and networks and a corresponding imperative to maximise reliability and performance whilst minimising coordination. 

In particular, we now care about \emph{permissionless} systems; meaning that participants may join and leave the network, without their access being coordinated by a central authority.
Bitcoin (a blockchain) and Napster (a peer-to-peer file-sharing protocol) are two permissionless distributed systems that have entered our collective social conscience.
Outside the realm of computer systems, \emph{social consensus} is also permissionless: people in the real world may leave and join society (e.g. through births and deaths), and may form opinions based on the opinions of their sets of friends and family and trusted media sources; and these sets can and do differ from one person to the next.


This last example also makes clear that we cannot assume that participants in a permissionless system have a preexisting agreement on whom to trust, nor that they all have the same goals and beliefs.
Thus, we cannot define `attaining consensus' to necessarily mean that all participants agree; we need a notion of consensus that is meaningful but which may be \emph{heterogeneous}.\footnote{For an example of how the social and technical aspects of consensus are intertwined in complex ways, consider how Twitter (which has a central server model) is, at time of writing, losing market share to Mastodon (which follows a more distributed model).} 
We see this in the real world, where people tend to partition into communities that are in consensus internally, but not necessarily with other communities.
Thus the traditional notion of consensus as familiar from~\cite{lamport:byzgp} and in the literature on distributed computing that followed it, is a special case of --- but not the full story for! --- an appropriate notion of consensus for permissionless systems.


We will use ideas from topology to give a new definition and theory of permissionless, and thus heterogeneous, consensus. 
We identify a permissionless system with a new notion of \emph{semitopology} (Definition~\ref{defn.semitopology})
--- in brief: topology minus the axiom that intersections of open sets be open --- and we identify consensus with topological continuity (Lemma~\ref{lemm.open.lc}).

The open sets of a semitopology correspond to the quorums~\cite{lamport_part-time_1998} used in consensus algorithms.
The intersections of two opens need not be open, because the intersection of two quorums is usually not a quorum.

Semitopology generalises topology, as we just remove an axiom.
Note that:
\begin{itemize*}
\item
There is no requirement that opens be necessarily uniformly generated.
\item
There is no requirement that opens necessarily intersect, nor that intersections of open sets necessarily be open.
\end{itemize*} 
This reflects how participants in a permissionless system may have different ideas about who is trustworthy, and that the intersection of two quorums need not itself be a quorum. 

Topological continuity implies intuitively that values of a function should vary `smoothly'.
Correspondingly there is no requirement that a system in consensus, as we define it in this paper, be in agreement amongst \emph{all} participants; Lemma~\ref{lemm.open.lc} identifies continuity with participants being in agreement when they are close to one another. 


What it means to be `close together' turns out to be very interesting in a semitopological context.
Topology often studies spaces with strong separability properties between points (like Hausdorff separability); in a semitopological space it seems interesting to study clusters of points that cannot be separated.
We state and discuss a novel `anti-Hausdorff' anti-separation property which we call \emph{being intertwined} (see Definition~\ref{defn.intertwined.points} and Remark~\ref{rmrk.not.hausdorff}).
Within an intertwined set, continuity implies agreement in a particularly strong sense (see Corollary~\ref{corr.intertwined.correlated}).
And, as we build up the mathematics further and understand more deeply what is going on, we will discover deeper and more canonical mathematical reasons why this notion arises (having to do with theories of dense subsets and continuous extensions of functions; see Section~\ref{sect.dense} and the high-level discussion in Remark~\ref{rmrk.cont.uniq}).
 
We will prove that a semitopological space partitions itself naturally into a collection of disjoint sets which we call (maximal) \emph{topens} (for \emph{transitive open set}; Definition~\ref{defn.transitive} and Remark~\ref{rmrk.partition}).
In retrospect using the definitions of this paper, we see that several foundational distributed algorithms (e.g.\ Bracha Broadcast~\cite{bracha_asynchronous_1987} and Grade-Cast~\cite{feldman_optimal_1988}) achieve agreement on topens (see Proposition~\ref{prop.open.strong-consensus} and Remark~\ref{rmrk.gradecast}), and the traditional notion of consensus as being `all participants agree' which we mentioned above, corresponds roughly speaking to the special case of our notion of consensus as applied to a single topen component of a semitopological space (or if the reader prefers; as applied to a space that \emph{is} a single topen). 


\subsection{Map of the paper}

\begin{enumerate}
\item
Section~\ref{sect.intro} is the Introduction.  You Are Here.
\item
In Section~\ref{sect.semitopology} we define semitopologies and show how continuity corresponds to local consensus (Definition~\ref{defn.semitopology} and Lemma~\ref{lemm.open.lc}).
\item
In Section~\ref{sect.transitive.sets} we introduce \emph{transitive sets}, \emph{topens}, and \emph{intertwined points}.
These are all different views on the anti-separation properties that will play such a central role in this paper.
Most of Section~\ref{sect.transitive.sets} is concerned with showing how these different views relate and in what senses they are equivalent (e.g. Theorem~\ref{thrm.cc.char}).
Transitive sets are guaranteed to be in consenus (in a sense made precise in Theorem~\ref{thrm.correlated} and Corollary~\ref{corr.correlated.intersect}), and we take a first step to understanding the fine structure of semitopologies by proving that every semitopology partitions into topen sets (Theorem~\ref{thrm.topen.partition}), plus other kinds of points which we classify in the next Section.
\item
In Section~\ref{sect.regular.points} we start to classify points in more detail, introducing notions of \emph{regular}, \emph{weakly regular}, and \emph{quasiregular} points (Definition~\ref{defn.tn}).\footnote{The other main classification is \emph{conflicted} points, in Definition~\ref{defn.conflicted}.  These properties are connected by an equation: regular = weakly regular + conflicted; see Theorem~\ref{thrm.r=wr+uc}.}
 
Regular points are those contained in some topen set, and they display particularly good consensus behaviour.
Regularity will be very important to us and we will characterise it in multiple ways: see Remark~\ref{rmrk.how.regularity}.
(A survey of characterisations of weak regularity requires more machinery and appears in Remark~\ref{rmrk.how.weakly.regular}.)
\item
In Section~\ref{sect.closed.sets} we study closed sets, and in particular the interaction between intertwined points, topens, and closures.
Typical results are Proposition~\ref{prop.intertwined.as.closure} and Theorem~\ref{thrm.up.down.char} which characterise sets of intertwined points as minimal closures.
The significance to consensus is discussed in Remarks~\ref{rmrk.fundamental.consensus} and~\ref{rmrk.why.top.closure}.
\item
In Section~\ref{sect.unconflicted.point} we study conflicted points.
Intuitively, a point is conflicted when it is intertwined with two distinct topens.
This, along with the notions of regularity already developed, is enough for us to fully classify points, with results like Proposition~\ref{prop.boundary.points.not.regular}.
\item
In Section~\ref{sect.product} we consider product semitopologies.
These are defined just as for topologies (Definition~\ref{defn.product.semitopology}) but we study how the semitopological properties we have considered above --- like being intertwined, topen, regular, conflicted, and so forth --- interact with taking products.
This is particularly useful for building large complex counterexamples out of smaller simpler ones.
See for example Theorem~\ref{thrm.nitpicked}.
\item
In Section~\ref{sect.witness} we construct a novel theory of computationally tractable semitopologies, based on \emph{witness functions} (Definition~\ref{defn.witnessed.set}(\ref{witness.function})).
We call semitoplogies generated by witness functions \emph{witness semitopolgies}.
These display excellent algorithmic behaviour (Remarks~\ref{rmrk.computing.open.sets} and~\ref{rmrk.computing.closed.sets}) and we note deep reasons why this is so by showing that witness functions correspond to Horn clause theories, and that open and closed sets in the witness semitopology are related to answer sets to those theories; see Subsection~\ref{subsect.declarative.witness}.
\item
In Section~\ref{sect.cc.cb} we introduce \emph{chain-complete} and \emph{chain-bounded} semitopologies.
We argue in Remark~\ref{rmrk.plausible.abstraction} that these have properties making them a suitable abstraction of finite semitopologies --- finite semitopologies are of particular interest because these are the ones that we can build.
We study their properties and prove a key result that witness semitopologies are chain-complete (Theorem~\ref{thrm.lim.O.open}), even if they are infinite.\footnote{We discuss why infinite semitopologies matter, even in a world of finite implementations, in Remark~\ref{rmrk.infinite}.  Note also that in a real system there may be hostile participants who report an unbounded space of `phantom' points, either for denial-of-service or to create `extra voters'.  So even a system that is physically finite may present itself as infinite.}
\item
A key property in a chain-bounded semitopology is that the poset of open sets is \emph{atomic}, i.e. minimal nonempty sets always exist. 
In Section~\ref{sect.kernels} we study the \emph{kernel} of a point $p$ --- unions of atomic transitive open sets --- especially in chain-bounded semitopologies where atoms are guaranteed to exist. 
As we see later, the kernel is a kind if `dictator set' for consensus at $p$.
\item
In Section~\ref{sect.dense} we study the notion of `dense subset of' from topology and see that this splits into two notions: \emph{weakly dense in} and \emph{strongly dense in} (Definition~\ref{defn.dense}).
Transitivity turns out to be closely related to denseness (Proposition~\ref{prop.most.general}).
We prove a continuous extension result and show that this leads naturally back to the notion of regular point and topen set which we developed to begin with (Remark~\ref{rmrk.top.ce}).

This closes the arc of the mathematics: from initial definitions to a high-level explanation of why these were so useful.
\item
In Section~\ref{sect.conclusions} we conclude and discuss related and future work.
We discuss connections with related work in Subsection~\ref{subsect.related.work} (notably: semilattice theory, consensus tasks, algebraic topology, and fail-prone systems and quorum systems).
\end{enumerate}

 
\begin{rmrk}
Note that algebraic topology has been applied to the solvability of distributed-computing tasks in computational models (e.g. the impossibility of $k$-set consensus and the Asynchronous Computability Theorem~\cite{herlihy_asynchronous_1993,borowsky_generalized_1993,saks_wait-free_1993}; see~\cite{herlihy_distributed_2013} for a survey).

This paper is not that: we use semitopologies to study the notion of consensus itself, rather than the solvability of consensus and other tasks in computation models.
If we discuss specific distributed consensus algorithms, this is by way of providing a motivating example or illustrating applicability.

Our innovation is to use topological ideas to obtain a new mathematical theory of consensus --- with the perhaps surprising observation that consensus, our generalisation of topology, and declarative programming, are related in new and unexpected ways, when ostensibly they might have appeared to be quite unrelated.
\end{rmrk}


\section{Semitopology}
\label{sect.semitopology}

\subsection{The definition, some examples, and some basic remarks}

\begin{rmrk}
\label{rmrk.why.no.intersection}
We motivate the definition of semitopologies in Definition~\ref{defn.semitopology}.

Roughly speaking, consensus requires a set of participants to agree on a common output starting from possibly conflicting individual inputs.
Algorithms to attain consensus often use a notion of \emph{quorum}~\cite{lamport_part-time_1998}; a set of participants whose unanimous adoption of a value guarantees that other (typically all other) participants will eventually also adopt this value.
Social choice theorists have a similar notion called a \emph{winning coalition} \cite[Item~5, page~40]{riker:thepc}.

Consensus algorithms usually admit multiple quorums: a typical example is to let quorums be sets of participants whose cardinality exceeds a certain threshold, e.g.\ two-thirds of the total system size.
But in a permissionless system there is no total system size, because it is permissionless!
Instead, permissionless systems may allow participants to have different `local' notions of quorum.\footnote{
The XRP Ledger~\cite{schwartz_ripple_2014} and Stellar network~\cite{lokhafa:fassgp} work like this.
More on this in the discussion of \emph{fail-prone systems and quorum systems} in Subsection~\ref{subsect.related.work}.
}

In a nutshell, our starting point is to use topology to get a mathematical handle on local quorums, by identifying them with open sets.
However, the intersection of two quorums need not be a quorum, so this leads us to \emph{semitopology}, which is like topology but intersections of opens need not be open.
\end{rmrk}

\begin{nttn}
\label{nttn.powerset}
Suppose $\ns P$ is a set.
Write $\powerset(\ns P)$ for the powerset of $\ns P$ (the set of subsets of $\ns P$); there will be more on this in Notation~\ref{nttn.finpow}.
\end{nttn}

\begin{defn}
\label{defn.semitopology}
A \deffont{semitopological space}, or \deffont{semitopology} for short, consists of a pair $(\ns P, \opens(\ns P))$ of 
\begin{itemize*}
\item
a nonempty set $\ns P$ of \deffont{points}, and 
\item
a set $\opens(\ns P)\subseteq\powerset(\ns P)$ of \deffont{open sets}, 
\end{itemize*}
such that:
\begin{enumerate*}
\item\label{semitopology.empty.and.universe}
$\varnothing\in\opens(\ns P)$ and $\ns P\in\opens(\ns P)$.
\item\label{semitopology.unions}
If $X\subseteq\opens(\ns P)$ then $\bigcup X\in\opens(\ns P)$.\footnote{There is a little overlap between this clause and the first one: if $X=\varnothing$ then by convention $\bigcup X=\varnothing$.  Thus, $\varnothing\in\opens(\ns P)$ follows from both clause~1 and clause~2.  If desired, the reader can just remove the condition $\varnothing\in\opens(\ns P)$ from clause~1, and no harm would come of it.} 
\end{enumerate*}
We may write $\opens(\ns P)$ just as $\opens$, if $\ns P$ is irrelevant or understood.
\end{defn}

\begin{rmrk}
\label{rmrk.two.ways.to.think}
\leavevmode
\begin{enumerate*}
\item
As a sets structure, a semitopology on $\ns P$ is like a \emph{topology} on $\ns P$, but without the condition that the intersection of two open sets be an open set.
\item
As a lattice structure, a semitopology is a %nonempty set $\ns P$ along with a 
bounded complete join-subsemilattice of $\powerset(\ns P)$.\footnote{\emph{Bounded} means closed under empty intersections and unions, i.e. containing the empty and the full set of points.  \emph{Complete} means closed under arbitrary (possibly empty, possibly infinite) sets unions.

The reader may know that a complete lattice is also co-complete: if we have all joins, then we also have all meets.  The reader should just note that there is no reason for the meets in $\opens$ to coincide with the meets in $\powerset(\ns P)$, i.e. for them to be sets intersections.  %Thus, while we note out that a semitopology has lattice structure, this is in part so that we can emphasise that we are interested in it as a sets structure.
}
\end{enumerate*}
\end{rmrk}


As standard, we can make any set $\tf{Val}$ into a semitopology (indeed, it is also a topology) just by letting open sets be the powerset: 
\begin{defn}
\label{defn.value.assignment}
\leavevmode
\begin{enumerate*}
\item\label{item.discrete.semitopology}
Call $(\ns P,\powerset(\ns P))$ the \deffont{discrete semitopology} on $\ns P$.
 
We may call a set with the discrete semitopology a \deffont{semitopology of values}, and when we do we will usually call it $\tf{Val}$.
We may identify $\tf{Val}$-the-set and $\tf{Val}$-the-discrete-semitopology; meaning will always be clear.
\item\label{item.value.assignment}
When $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values, we may call a function $f:\ns P\to\tf{Val}$ a \deffont{value assignment}.
\end{enumerate*} 
\end{defn}


\begin{xmpl}
\label{xmpl.semitopologies}
We consider some more examples of semitopologies:
\begin{enumerate}
\item\label{item.boolean.discrete}
An important discrete semitopological space is 
$$
\mathbb B=\{\bot,\top\}
\quad\text{with the discrete semitopology}\quad
\opens(\mathbb B)=\{\varnothing, \{\bot\},\{\top\},\{\bot,\top\}\}.
$$
We may silently treat $\mathbb B$ as a (discrete) semitopological space henceforth.
\item
Take $\ns P$ to be any nonempty set.
Let the \deffont{trivial} semitopology on $\ns P$ have 
$$
\opens =\{\varnothing, \ns P\}.
$$
So (as usual) there are only two open sets: the one containing nothing, and the one containing every point.
\item\label{item.supermajority}
Take $\ns P=\{0,1,\dots,41\}$. 
Let the \deffont{supermajority} semitopology have 
$$
\opens =\{\varnothing\}\cup\{O\subseteq\ns P \mid \f{cardinality}(O)\geq 28\}.
$$
Since $\ns P$ has 42 elements, $O$ is open when it contains at least two-thirds of the points (2/3 participation is a typical threshold used for making progress in consensus algorithms).

The supermajority semitopology is not a topology, since it is not closed under intersections: that $O$ and $O'$ each contain at least two-thirds of the points in $\ns P$ does not mean that their intersection $O\cap O'$ does.
\item
Take $\ns P$ to be any nonempty set.
Let the \deffont{plenty of} semitopology have
$$
\opens = \{\varnothing\}\cup\{O\subseteq\ns P \mid \f{cardinality}(O)=\f{cardinality}(\ns P)\} .
$$
For example, if $\ns P=\mathbb N$ then open sets include $\f{evens}=\{2*n \mid n\in\mathbb N\}$ and $\f{odds}=\{2*n\plus 1 \mid n\in\mathbb N\}$.

This semitopology is not a topology.
\item\label{item.counterexample.X-x}
Take $\ns P$ to be any nonempty set.
Let the \deffont{all-but-one} semitopology have
$$
\opens = \{\varnothing,\ \ns P\}\cup\{\ns P\setminus \{p\}\mid p\in\ns P\} .
$$
This semitopology is not a topology.
See also Lemma~\ref{lemm.all-but-one}.
\item\label{item.counterexample.more-than-one}
Take $\ns P$ to be any nonempty set.
Let the \deffont{more-than-one} semitopology have
$$
\opens = \{\varnothing\}\cup\{X\subseteq\ns P \mid \Exists{p,p'{\in}\ns P}(p{\neq}p'\land \{p,p'\}{\subseteq} X)\} .
$$
This semitopology is not a topology.
See also Lemma~\ref{lemm.more-than-one}.
\item
Take $\ns P=\mathbb R$ (the set of real numbers) and set $O\subseteq\mathbb R$ to be open when it has the form $\rightopeninterval{0,r}$ or $\leftopeninterval{-r,0}$ for any strictly positive real number $r>0$.

This semitopology is not a topology, since (for example) $\leftopeninterval{1,0}$ and $\rightopeninterval{0,1}$ are open, but their intersection $\{0\}$ is not open.
\item\label{item.compute.lists}
Consider any $L$-labelled automaton $A$ (by which here we mean: a rooted directed graph with labels from $L$), and let open sets consist of all possible finite traces of labels as we explore $A$: so choose a (possibly infinite) path through $A$ and take as an open set the set of initial segments from that path.

To make this concrete, we can take $A$ to have just one node and two edges labelled $0$ and $1$ respectively.
Then an open set consists of a set of initial segments of any stream of $0$s and $1$s.
For example: this open set is obtained from the alternating stream $[0,1,0,1,\dots]$:
$$
\{[],\ [0],\ [0,1],\ [0,1,0],\ [0,1,0,1],\ \dots\} .
$$
\end{enumerate}
\end{xmpl}

\begin{rmrk}
When we give a name `semitopologies' to things that are like topologies but without intersections, this is a riff on the name `semilattices' for things that are like lattices with joins but without meets (or vice-versa), and on the name `semigroups' for things that are like groups but without inverses.
In fact this is more than an analogy, because semitopologies \emph{are} semilattices \emph{are} semigroups, in standard ways as follows: 
\begin{itemize*}
\item
A semitopology $(\ns P,\opens)$ is a bounded join subsemilattice of the powerset $\powerset(\ns P)$, by taking the join $\tor$ to be sets union $\cup$ and the bounds $\bot$ and $\top$ to be $\varnothing$ and $\ns P$ respectively. 
\item
A semilattice is an idempotent commutative monoid, which is an idempotent commutative semigroup with an identity, by taking the multiplication $\circ$ to be $\tor$ and the identity element to be $\bot$ ($\top$ becomes what is called a \emph{zero} or \emph{absorbing} element, such that $\top\circ x=\top$ always).
\end{itemize*} 
\end{rmrk}

\begin{rmrk}
We can make a general prediction about what the mathematical theory of semitopologies is likely to look like, just from general mathematical principles and setting aside (just for this Remark) specific applications. 

Fewer axioms means more models, finer discrimination between definitions, and more counterexamples.
So we can expect a theory that may look and feel quite a bit like topology, but has more models, finer distinctions, and new theorems and counterexamples --- and this indeed will be the case.
 
Note that fewer axioms does not necessarily mean fewer interesting definitions and theorems.
On the contrary, if we can make finer distinctions, there may also be more interesting things to prove; and furthermore any assumptions we make can become \emph{more} impactful in a weaker system, because there may be more models for them to exclude than would have been the case if we had assumed more powerful axioms.\footnote{To take this to an extreme, consider the \emph{terminal} theory, which has just one first-order axiom: $\Exists{x}\Forall{y}x=y$.  Note that this theory `subsumes' groups, lattices, graphs, and much besides, in the sense that every model of the terminal theory \emph{is} a group, a lattice, and a graph, in a natural way.  But the theory is so strong, and the class of its models is so restricted --- just the singleton model with one element --- that there is not much left for us to say; in particular, additional assumptions we may make on elements add literally nothing of value, because there was only one element to begin with!  Thus with theories, as with much else in life, it's not about what you've got: it's about what you can do with it.}
\end{rmrk}

\subsection{Continuity, and interpretation of continuity as consensus}
\label{subsect.continuity}

The definitions and results in this Subsection are standard, and this is the point: we can import the topological notions discussed, and they work fine in semitopologies, and the fact that there are no surprises here is a feature. 
In Remark~\ref{rmrk.continuity=consensus} we explain how these notions matter to us: 


\begin{defn}
\label{defn.continuity}
We import standard topological notions of inverse image and continuity:
\begin{enumerate}
\item
Suppose $\ns P$ and $\ns P'$ are any sets and $f:\ns P\to\ns P'$ is a function.
Suppose $O'\subseteq\ns P'$.
Then write $f^\mone(O')$ for the \deffont{inverse image} or \deffont{preimage} of $O'$, defined by
$$
f^\mone(O')=\{p{\in}\ns P \mid f(p)\in O'\} . 
$$
\item\label{item.continuous.function}
Suppose $(\ns P,\opens)$ and $(\ns P',\opens')$ are semitopological spaces (Definition~\ref{defn.semitopology}).
Call a function $f:\ns P\to\ns P'$ \deffont{continuous} when the inverse image of an open set is open.
In symbols:
$$
\Forall{O'{\in}\opens'} f^\mone(O')\in\opens .
$$
\item\label{item.continous.function.at.p}
Call a function $f:\ns P\to\ns P'$ \deffont{continuous at $p\in\ns P$} when
$$
\Forall{O'{\in}\opens'}f(p)\in O'\limp \Exists{O_{p,O'}{\in}\opens}O_{p,O'}\subseteq f^\mone(O') .
$$
In words: $f$ is continuous at $p$ when the inverse image of every open neighbourhood of $f(p)$ contains an open neighbourhood of $p$.
\item
Call a function $f:\ns P\to\ns P'$ \deffont{continuous on $P\subseteq\ns P$} when $f$ is continuous at every $p\in P$.

(It is routine to check that $f$ is continous on $\ns P$ precisely when it continuous in the sense of part~\ref{item.continuous.function} of this Definition.) 
\end{enumerate}
\end{defn}


\begin{lemm}
\label{lemm.alternative.cont}
Suppose $(\ns P,\opens)$ and $(\ns P',\opens')$ are semitopological spaces (Definition~\ref{defn.semitopology}) and suppose $f:\ns P\to\ns P'$ is a function.
Then the following are equivalent:
\begin{enumerate*}
\item
$f$ is continuous (Definition~\ref{defn.continuity}(2)).
\item
$f$ is continuous at every $p\in\ns P$ (Definition~\ref{defn.continuity}(3)).
\end{enumerate*}
\end{lemm}
\begin{proof}
The top-down implication is immediate, taking $O=f^\mone(O')$.

For the bottom-up implication, given $p$ and an open neighbourhood $O'\ni f(p)$, we write
$$
O=\bigcup\{O_{p,O'}\in\opens \mid p\in\ns P,\ f(p)\in O'\}.
$$
Above, $O_{p,O'}$ is the open neighbourhood of $p$ in the preimage of $O'$, which we know exists by Definition~\ref{defn.continuity}(3).

It is routine to check that $O= f^\mone(O')$, and since this is a union of open sets, it is open. 
\end{proof}


\begin{defn}
\label{defn.locally.constant}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology and 
\item
$\tf{Val}$ is a semitopology of values (Definition~\ref{defn.value.assignment}(\ref{item.discrete.semitopology})) and 
\item
$f:\ns P\to \tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment}(\ref{item.value.assignment}); an assignment of a value to each element in $\ns P$).
\end{itemize*}
Then:
\begin{enumerate*}
\item
Call $f$ \deffont{locally constant} at $p\in\ns P$ when there exists $p\in O_p\in\opens$ such that $\Forall{p'{\in}O_p}f(p)=f(p')$.

So $f$ is locally constant at $p$ when it is constant on some open neighbourhood $O_p$ of $p$.
\item
Call $f$ \deffont{locally constant} when it is locally constant at every $p\in\ns P$.
\end{enumerate*} 
\end{defn}


\begin{lemm}
\label{lemm.open.lc}
Suppose $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values and $f:\ns P\to\tf{Val}$ is a value assignment.
Then the following are equivalent:
\begin{itemize*}
\item
$f$ is locally constant / locally constant at $p\in\ns P$ (Definition~\ref{defn.locally.constant}).
\item
$f$ is continuous / continuous at $p\in\ns P$ (Definition~\ref{defn.continuity}). 
\end{itemize*}
\end{lemm}
\begin{proof}
This is just by pushing around definitions, but we spell it out:
\begin{itemize}
\item
Suppose $f$ is continuous, consider $p\in\ns P$, and write $v=f(p)$.
By our assumptions we know that $f^\mone(v)$ is open, and $p\in f^\mone(v)$.
This is an open neighbourhood $O_p$ on which $f$ is constant, so we are done.
\item
Suppose $f$ is locally constant, consider $p\in\ns P$, and write $v=f(p)$.
By assumption we can find $p\in O_p\in\opens$ on which $f$ is constant, so that $O_p\subseteq f^\mone(v)$.
\qedhere\end{itemize}
\end{proof}


\begin{rmrk}[Continuity = consensus]
\label{rmrk.continuity=consensus}
Lemma~\ref{lemm.open.lc} tells us that
\begin{itemize*}
\item
we can identify having consensus with having a continuous value assignment, and
\item
we can view attaining consensus as computing a continuous value assignment.
\end{itemize*}
To see why, consider a semitopology $(\ns P, \opens)$: view points $p\in \ns P$ as \emph{participants}; and view open neighbourhoods $p\in O\in\opens$ as \deffont{quorums} of $p$.
Then to say ``$f$ is a value assignment that is continuous at $p$'' is to say that:
\begin{itemize*}
\item
$f$ assigns a value or belief to $p\in\ns P$, and
\item
$p$ is contained in a (by Lemma~\ref{lemm.open.lc} continuity) \emph{quorum} of peers that $p$ trusts enough to justify its value.
\end{itemize*}
Conceptually and mathematically this reduces the general question 
\begin{quote}
\emph{How can we model permissionless consensus?} 
\end{quote}
(which, to be fair, has more than one possible answer) to a more specific research question
\begin{quote}
\emph{Understand continuous value assignments on semitopologies}.
\end{quote}
The rest of this paper is devoted to elaborating (some of) a body of mathematics that we can pull out of this idea.
\end{rmrk}


\begin{xmpl}
We continue the list of examples in Example~\ref{xmpl.semitopologies} with some specifically `consensus-flavoured' examples: 
\begin{enumerate}
\item
Let $\ns P$ be a set of \emph{moviegoers}.
Let $O\in\opens$ be the semitopology generated by all groups of friends willing to coordinate to go see a movie together.
Then $\opens$ describes the possible sets of people that can be found inside a movie theatre.
\item
Let $\ns P$ be a set of \emph{voters}.
Let $O\in\opens$ be the semitopology generated by partitioning two disjoint sets, $T$ and $B$: one of which watches a TV channel called Fax News, and the other reads a newspaper called the New Yank Times.
Because $T\cap B=\varnothing$, locally constant functions will have the same value within each of $T$ and $B$, but the values of each partition may differ.
\item
Let $\ns P$ be a set of \emph{senators}, and let $(\ns P, \opens)$ be the supermajority semitopology from Example~\ref{xmpl.semitopologies}(\ref{item.supermajority}) below (generated by all sets containing at least two-thirds of the senate).

A function is locally constant at a senator $p\in\ns P$ when $p$ votes with the two-thirds majority. 
This is arguably a model of a system where actions are determined by a two-thirds majority vote. 
\end{enumerate}
\end{xmpl}


%%%%%%%%%%%%%%%%%%%%%
\subsection{Neighbourhoods of a point}

Definition~\ref{defn.open.neighbourhood} is a standard notion from topology, and Lemma~\ref{lemm.open.is.open} is a (standard) characterisation of openness, which will be useful later: 

\begin{defn}
\label{defn.open.neighbourhood}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $O\in\opens$.
Then call $O$ an \deffont{open neighbourhood} of $p$ when $p\in O$.

In other words: an open set is (by definition) an \emph{open neighbourhood} precisely for the points that it contains.
\end{defn}


\begin{lemm}
\label{lemm.open.is.open}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P\subseteq\ns P$ is any set of points.
Then the following are equivalent:
\begin{itemize*}
\item
$P\in\opens$.
\item
Every point $p$ in $P$ has an open neighbourhood in $P$. 
\end{itemize*}
In symbols we can write:
$$
\Forall{p{\in}P}\Exists{O{\in}\opens}(p\in O\land O\subseteq P)
\quad\text{if and only if}\quad
P\in\opens
$$
\end{lemm}
\begin{proof}
If $P$ is open then $P$ itself is an open neighbourhood for every point that it contains. 

Conversely, if every $p\in P$ contains some open neighbourhood $p\in O_p \subseteq P$ then $P=\bigcup\{O_p\mid p\in P\}$ and this is open by condition~\ref{semitopology.unions} of Definition~\ref{defn.semitopology}.
\end{proof}

\begin{rmrk}
An initial inspiration for modelling heterogeneous consensus using semitopologies, came from noting that the standard topological property described above in Lemma~\ref{lemm.open.is.open}, corresponds to the \emph{quorum sharing} property in \cite[Property~1]{losa:stecbi}; the connection to topological ideas had not been noticed in~\cite{losa:stecbi}.
\end{rmrk}

%%%%%%%%%%%%%%%%%%%%%
\section{Transitive sets and topens}
\label{sect.transitive.sets}

\subsection{Some background on sets intersection}

Some notation will be convenient:
\begin{nttn}
\label{nttn.between}
Suppose $X$, $Y$, and $Z$ are sets.
\begin{enumerate*}
\item
Write 
$$
X\between Y
\quad\text{when}\quad 
X\cap Y\neq\varnothing.
$$
When $X\between Y$ holds then we say (as standard) that $X$ and $Y$ \deffont{intersect}.
\item
We may chain the $\between$ notation, writing for example 
$$
X\between Y\between Z
\quad\text{for}\quad
X\between Y\ \land \  Y\between Z
$$
\item
We may write $X\notbetween Y$ for $\neg(X\between Y)$, thus $X\notbetween Y$ when $X\cap Y=\varnothing$.
\end{enumerate*}
\end{nttn}

We list some elementary properties of $\between$:
\begin{lemm}
\label{lemm.between.elementary}
\leavevmode
\begin{enumerate*}
\item
$X\between X$ if and only if $X\neq\varnothing$.
\item
$X\between Y$ if and only if $Y\between X$.
\item\label{between.elementary.either.or}
$X\between (Y\cup Z)$ if and only if $(X\between Y) \lor (X\between Z)$.
\item\label{between.subset}
If $X\subseteq X'$ and $X\neq\varnothing$ then $X\between X'$.
\item\label{between.monotone}
If $X\subseteq X'$ then $X\between Y$ implies $X'\between Y$. 
Similarly if $Y\subseteq Y'$ then $X\between Y$ implies $X\between Y'$. 
\end{enumerate*}
\end{lemm}
\begin{proof}
By facts of sets intersection.
\end{proof}


\subsection{Transitive open sets and value assignments}


\begin{defn}
\label{defn.transitive}
Suppose $(\ns P,\opens)$ is a semitopology.
Suppose $\atopen\subseteq\ns P$ is any set of points.
\begin{enumerate*}
\item\label{transitive.transitive}
Call $\atopen$ \deffont{transitive} when 
$$
\Forall{O,O'{\in}\opens} O\between \atopen \between O' \limp O\between O'. 
$$
\item\label{transitive.cc}
Call $\atopen$ \deffont{topen} when $\atopen$ is nonempty transitive and open.\footnote{The empty set is trivially transitive and open, so it would make sense to admit it as a (degenerate) topen.  However, it turns out that we mostly need the notion of `topen' to refer to certain kinds of neighbourhoods of points (we will call them \emph{communities}; see Definition~\ref{defn.tn}).  It is therefore convenient to exclude the empty set from being topen, because while it is the neighbourhood of every point that it contains, it is not a neighbourhood of any point.} 

We may write 
$$
\topens=\{ \atopen\in\opens \mid \atopen\text{ is topen}\} .
$$
\item\label{transitive.max.cc}
Call $S$ a \deffont{maximal topen} when $S$ is a topen that is not a subset of any strictly larger topen.
\end{enumerate*}
\end{defn}

\begin{rmrk}
For reference, notions of \emph{strong} transitivity and topen are in Definition~\ref{defn.strongly.transitive}.
\end{rmrk}

Transitive sets are of interest because values of continuous functions are strongly correlated on them.
This is Theorem~\ref{thrm.correlated}.

\begin{thrm}
\label{thrm.correlated}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\tf{Val}$ is a semitopology of values (a nonempty set with the discrete semitopology; see Definition~\ref{defn.value.assignment}(1)). 
\item
$f:\ns P\to\tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment}(\ref{item.value.assignment})). 
\item
$T\subseteq\ns P$ is a transitive set (Definition~\ref{defn.transitive}) --- in particular this will hold if $\atopen$ is topen --- and $p,p'\in T$.
\end{itemize*} 
Then:
\begin{enumerate*}
\item
If $f$ is continuous at $p$ and $p'$ then $f(p)=f(p')$.
\item 
As a corollary, if $f$ is continuous on $\atopen$, then $f$ is constant on $\atopen$.
\end{enumerate*}
In words we can say: 
\begin{quote}
Continuous value assignments are constant across transitive sets.
\end{quote}
\end{thrm}
\begin{proof}
Part~2 follows from part~1 since if $f(p)=f(p')$ for \emph{any} $p,p'\in T$, then by definition $f$ is constant on $\atopen$.
So we now just need to prove part~1 of this result.

Consider $p,p'\in T$.
By continuity on $\atopen$, there exist open neighbourhoods $p\in O\subseteq f^\mone(f(p))$ and $p'\in O'\subseteq f^\mone(f(p'))$.
By construction $O\between \atopen \between O'$ (because $p\in O\cap T$ and $p'\in T\cap O'$).
By transitivity of $\atopen$ it follows that $O\between O'$. 
Thus, there exists $p''\in O\cap O'$, and by construction $f(p) = f(p'') = f(p')$.
\end{proof}



A notation will be useful:
\begin{nttn}
\label{nttn.f.const}
Suppose $\ns X$ is a set and $f$ is some function on $\ns X$ and $X\subseteq\ns X$.
Suppose further that it is known that $f$ is constant on $X$.
In symbols:
$$
\Exists{c}\Forall{x{\in}X}f(x)=c.
$$
Then we may write $f(X)$ for the unique constant value that $f(x)$ takes as $x$ ranges over $X$.\footnote{We feel a bit guilty about this. 
A more principled approach might be to define $f(X)=\{f(x) \mid x\in X\}$, and then write $\{c\}$ for $f(X)$ where $f$ is known constant on $X$.  The reader is welcome to fill in the ``$\Exists{c}\Forall{x{\in}X}f(x)=c\land \dots$'' as appropriate.}
\end{nttn}


Corollary~\ref{corr.correlated.intersect} is an easy and useful consequence of Theorem~\ref{thrm.correlated}:
\begin{corr}
\label{corr.correlated.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology. 
\item
$f:\ns P\to \tf{Val}$ is a value assignment to some set of values $\tf{Val}$ (Definition~\ref{defn.value.assignment}). 
\item
$f$ is continuous on topen sets $\atopen, \atopen'\in\topens$.
\end{itemize*}
Then 
$$
\atopen\between \atopen'
\quad\text{implies}\quad 
f(\atopen)=f(\atopen').
$$
\end{corr}
\begin{proof}
By Theorem~\ref{thrm.correlated} $f$ is constant on $\atopen$ and $\atopen'$, so we can write $f(\atopen)$ and $f(\atopen')$ as per Notation~\ref{nttn.f.const}.
We assumed that $\atopen$ and $\atopen'$ intersect, and the result follows.
\end{proof}

A converse to Theorem~\ref{thrm.correlated} also holds:
\begin{prop}
\label{prop.correlated.converse}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\tf{Val}$ is a semitopology of values with at least two elements (to exclude a denegerate case that no functions exist, or they exist but there is only one because there is only one value to map to).
\item
$T\subseteq\ns P$ is any set. 
\end{itemize*} 
Then 
\begin{itemize*}
\item
\emph{if} for every $p,p'\in T$ and every value assignment $f:\ns P\to\tf{Val}$, $f$ continuous at $p$ and $p'$ implies $f(p)=f(p')$, 
\item
\emph{then} $\atopen$ is transitive.
\end{itemize*}
\end{prop}
\begin{proof}
We prove the contrapositive. 
Suppose $\atopen$ is not transitive, so there exist nonempty $O,O'\in\opens$ such that $O\between \atopen\between O'$ and yet $O\cap O'=\varnothing$.
We choose two distinct values $v\neq v'\in\tf{Val}$ and define $f$ to map any point in $O$ to $v$ and any point in $\ns P\setminus O$ to $v'$.
Choose some $p\in O$ and $p'\in O'$ (it does not matter which).
We note that $f(p)=v$ and $f(p')=v'$ and $f$ is continuous at $p\in O$ and $p'\in O'\subseteq\ns P\setminus O$, yet $f(p)\neq f(p')$.
\end{proof}

\begin{rmrk}
\label{rmrk.transitive.correlated}
Suppose $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values with at least two elements.
Say that a value assignment $f:\ns P\to\tf{Val}$ \deffont{splits} a set $T\subseteq\ns P$ when there exist $p,p'\in T$ such that $f(p)\neq f(p')$. 
Then Theorem~\ref{thrm.correlated} and Proposition~\ref{prop.correlated.converse} together say in words that: 
\begin{quote}
$T\subseteq\ns P$ is transitive if and only if it cannot be split by a value assignment. 
\end{quote}
Intuitively, transitive sets characterise areas of guaranteed consensus.
\end{rmrk}

\subsection{Examples and discussion of transitive sets and topens}

We may routinely order sets by subset inclusion; including open sets, topens, closed sets, and so on, and we may talk about maximal, minimal, greatest, and least elements.
We include the (standard) definition for reference: 
\begin{nttn}
\label{nttn.min.max}
Suppose $(\ns P,\leq)$ is a poset.
Then:
\begin{enumerate*}
\item
Call $p\in\ns P$ \deffont{maximal} when $\Forall{p'}p{\leq}p'\limp p'=p$ and \deffont{minimal} when $\Forall{p'}p'{\leq}p\limp p'=p$.
\item
Call $p\in\ns P$ \deffont{greatest} when $\Forall{p}p'\leq p$ and \deffont{least} when $\Forall{p'}p\leq p'$.
\end{enumerate*}
\end{nttn}



\begin{xmpl}[Examples of transitive sets]
\label{xmpl.singleton.transitive}
\leavevmode
\begin{enumerate*}
\item\label{item.singleton.transitive}
$\{p\}$ is transitive, for any single point $p\in\ns P$. 
\item
The empty set $\varnothing$ is (trivially) transitive, but not topen because we insist in Definition~\ref{defn.transitive}(\ref{transitive.cc}).
\item
Call a set $P\subseteq\ns P$ \emph{topologically indistinguishable} when (using Notation~\ref{nttn.between}) for every open set $O$, 
$$
P\between O\liff P\subseteq O .
$$ 
It is easy to check that if $P$ is topologically indistinguishable, then it is transitive.
\end{enumerate*} 
\end{xmpl}


\begin{xmpl}[Examples of topens]
\label{xmpl.cc}
\leavevmode
\begin{enumerate*}
\item\label{item.cc.two.regular}
Take $\ns P=\{0, 1, 2\}$, with open sets $\varnothing$, $\ns P$, $\{0\}$, $\{2\}$, and $\{0,1,2\}$. 
This has two maximal topens $\{0\}$ and $\{2\}$, and an isolated point $1$, as illustrated in Figure~\ref{fig.012} (left-hand diagram). 
\item\label{item.cc.two.regular.b}
Take $\ns P=\{0, 1, 2\}$, with open sets $\varnothing$, $\ns P$, $\{0\}$, $\{0, 1\}$, $\{2\}$, $\{1,2\}$, and $\{0,2\}$. 
This has two maximal topens $\{0\}$ and $\{2\}$, and an isolated point $1$, as illustrated in Figure~\ref{fig.012} (right-hand diagram). 
\item
Take $\ns P=\{0,1,2,3,4\}$, with open sets generated by $\{0, 1\}$, $\{ 1\}$, $\{3\}$, and $\{3,4\}$.
This has two maximal topens $\{0,1\}$ and $\{2,3\}$, and an isolated point $0$, as illustrated in Figure~\ref{fig.012} (lower diagram). 
\item
Take the all-but-one semitopology from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}): so $\ns P=\mathbb N$ with opens $\varnothing$, $\ns N$, and $\ns N\setminus \{x\}$ for every $x\in\mathbb N$.
This has a single maximal topen equal to $\mathbb N$ itself.
\end{enumerate*}
\end{xmpl}


\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.4\columnwidth,trim={50 20 50 20},clip]{diagrams/012a.pdf}
\includegraphics[width=0.4\columnwidth,trim={50 20 50 20},clip]{diagrams/012.pdf}
\includegraphics[width=0.33\columnwidth,trim={20 0 20 20},clip]{diagrams/simple_example.pdf}
\caption{Examples of topens (Example~\ref{xmpl.cc})}
\label{fig.012}
\end{figure}

\begin{rmrk}[Discussion]
We take a moment for a high-level discussion of where we are going.

The semiopologies in Example~\ref{xmpl.cc} invite us to ask what makes these examples different (especially parts~\ref{item.cc.two.regular} and~\ref{item.cc.two.regular.b}).
Clearly they are not equal, but that is a superficial answer in the sense that it is valid just in the world of sets, and it ignores semitopological structure.

For comparison: if we ask what makes $0$ and $1$ different in $\mathbb N$, we could just to say that $0\neq 1$, but this ignores what makes them different \emph{as numbers}.
For more insight, we could note that $0$ is the additive unit whereas $1$ is the multiplicative unit of $\mathbb N$ as a semiring; or that $0$ is a least element and $1$ is the unique atom of $\mathbb N$ as a well-founded poset; or that $1$ is the successor of $0$ of $\mathbb N$ as a well-founded inductive structure. 
Each of these answers gives us more understanding, not only into $0$ and $1$ but also into the structures that can be given to $\mathbb N$ itself. 

So we can ask:
\begin{quote}
Within our semitopological framework, what semitopological property or properties can identify the essential nature of the differences between the semitopologies in Example~\ref{xmpl.cc}?
\end{quote}
There is no single right answer to this question\footnote{There would be a germ of truth to saying that the rest of this paper is devoted to developing different answers to the question.} but the machinery to give one good answer will become available we define \emph{intertwined points} $\intertwined{p}$ in Definition~\ref{defn.intertwined.points}.
Using that machinery, Example~\ref{xmpl.how.different?} will note that $\intertwined{1}=\{0,1,2\}$ in Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}), whereas $\intertwined{1}=\{1\}$ in Example~\ref{xmpl.cc}(\ref{item.cc.two.regular.b}), and $\intertwined{x}=\mathbb N$ for every $x$ in Example~\ref{xmpl.cc}(3). 
\end{rmrk}




%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Closure properties of transitive sets}
\label{subsect.closure.properties.of.tt}

\begin{rmrk}
Transitive sets have some nice closure properties which we treat in this Subsection --- here we mean `closure' in the sense of ``the set of transitive sets is closed under various operations'', and not in the topological sense of `closed sets'.

Topens --- nonempty transitive \emph{open} sets --- will have even better closure properties, which emanate from the requirement in Lemma~\ref{lemm.transitive.transitive} that at least one of the transitive sets $\atopen$ or $\atopen'$ is open. 
We will explore the closure properties of topens in detail in Subsection~\ref{subsect.closure.properties.of.cc}, but for now we can just notice that the openness requirement hints at one view of and motivation for topens as being ``a subset of the transitive sets having particularly good closure properties''.
\end{rmrk}


\begin{lemm}
\label{lemm.transitive.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq \ns P$. 
Then:
\begin{enumerate*}
\item
If $\atopen$ is transitive and $\atopen'\subseteq \atopen$, then $\atopen'$ is transitive.
\item
If $\atopen$ is topen and $\varnothing\neq \atopen'\subseteq \atopen$ is nonempty and open, then $\atopen'$ is topen.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
By Definition~\ref{defn.transitive} it suffices to consider open sets $O$ and $O'$ such that $O\between \atopen'\between O'$, and prove that $O\between O'$.
But this is simple: by Lemma~\ref{lemm.between.elementary}(5) $O\between \atopen\between O'$, so $O\between O'$ follows by transitivity of $\atopen$. 
\item
Direct from part~1 of this result and Definition~\ref{defn.transitive}(\ref{transitive.cc}).
\qedhere\end{enumerate}
\end{proof}

Lemmas~\ref{lemm.cc.unions} and~\ref{lemm.cac.transitive} are required for, and extended by, Lemma~\ref{lemm.cc.unions}:
\begin{lemm}
\label{lemm.transitive.transitive}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\atopen,\atopen'\subseteq\ns P$ are transitive.
\item
At least one of $\atopen$ and $\atopen'$ is open.
\end{itemize*}
Then:
\begin{enumerate*}
\item 
$\Forall{O,O'\in\opens}O\between \atopen \between \atopen'\between O' \limp O\between O'$. 
\item
If $\atopen\between \atopen'$ then $\atopen\cup \atopen'$ is transitive.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We simplify using Definition~\ref{defn.transitive} and our assumption that one of $\atopen$ and $\atopen'$ is open.
We consider the case that $\atopen'$ is open: 
$$
\begin{array}{r@{\ }l@{\qquad}l}
O\between \atopen\between \atopen'\between O'
\limp&
O\between \atopen' \between O'
&\text{$\atopen$ transitive, $\atopen'$ open}
\\
\limp&
O\between O'
&\text{$\atopen'$ transitive}.
\end{array}
$$
The argument for when $\atopen$ is open, is precisely similar.
\item
Suppose $O\between \atopen\cup \atopen'\between O'$.
By Lemma~\ref{lemm.between.elementary}(\ref{between.elementary.either.or}) (at least) one of the following four possibilities must hold:
$$
O\between \atopen\land \atopen\between O',
\quad
O\between \atopen'\land \atopen\between O',
\quad
O\between \atopen\land \atopen'\between O',
\quad\text{or}\quad
O\between \atopen'\land \atopen'\between O' .
$$
If $O\between \atopen\ \land\ \atopen'\between O'$ then by part~1 of this result we have $O\between O'$ as required. 
The other possibilities are no harder.
\end{enumerate}
\end{proof}


\begin{defn}[Ascending/descending chain]\leavevmode
\label{defn.ascending.chains}
Suppose $\beta\geq 1$ is a nonzero ordinal.
\begin{enumerate*}
\item
An \deffont{ascending (respectively descending) chain} of sets $\mathcal X=(X_\alpha\mid \alpha<\beta)$ is a $\beta$-indexed collection of sets $X_\alpha$ such that for every $0\leq\alpha\leq\alpha'<\beta$ we have $X_\alpha\subseteq X_{\alpha'}$ (respectively $X_{\alpha'}\subseteq X_\alpha$).
\item\label{item.chain.length}
We call $\beta$ above the \deffont{length} of the chain.
\item
Call a chain \deffont{countable} when its length $\beta$ is countable.
\item\label{item.strict}
Call a chain \deffont{strictly ascending} (respectively \deffont{descending}) when its inclusions are strict.
That is: $X_\alpha\subsetneq X_{\alpha'}$ (respectively $X_{\alpha'}\subsetneq X_\alpha$). 
\end{enumerate*}
\end{defn}

\begin{lemm}
\label{lemm.cac.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\mathcal \atopen=(\atopen_\alpha \mid \alpha<\beta)$ is an an ascending chain of transitive sets.
Then $\bigcup\mathcal \atopen$ is a transitive set.
\end{lemm}
\begin{proof}
Suppose $O\between \bigcup\mathcal \atopen\between O'$.
It follows that there exist $\alpha,\alpha'<\beta$ such that $O\between \atopen_\alpha$ and $\atopen_{\alpha'}\between O'$.
Therefore for $\alpha''=\f{max}(\alpha,\alpha')$ we have that $O\between \atopen_{\alpha''}\between O'$, so $O\between O'$ by transitivity of $\atopen_{\alpha''}$. 
\end{proof} 

\begin{rmrk}[Note for experts]
\label{rmrk.infinite}
Why do we have the infinite ordinals in Definition~\ref{defn.ascending.chains}, given that implemented instances of semitopologies must be finite since implementations are finite?

We make two observations below; one general and one specific to this application.
These are not mathematical proofs but they do explain why we set the proofs up in a particular way: 
\begin{enumerate}
\item
\emph{Just because our physical world is finite does not mean the maths describing it should be, too.}


Consider also that Python (and many other programming languages) have a datatype for infinite precision integers.
Any given execution will only compute numbers in a finite subset this infinity, but since we may not be able to predict how large this subset is, it is natural to support the notion of an infinite datatype.
This holds for individual data as well as types of data: e.g. Python accommodates values for $\pi$, $e$, and $j$ even though these are not rational numbers, and for infinite streams and may other `infinite' objects.

Likewise, just because `real' semitopologies are finite does not \emph{in and of itself} mean we can or should ignore the infinite case in our theory.
We will argue in the next point that on the contrary, there are strong reasons to take the infinite case seriously.
\item 
\emph{We are concerned with permissionless blockchains.}

A \emph{permissionless blockchain} is by definition unbounded: participants can always join it. 
Thus, the natural cardinality of a semitopology, as observed from within the system, is at least countable --- as we explore the network, there might always be another participant.

Furthermore, the possibility for network delays means that participants may discover participants \emph{have joined} in the past (but the information that this happened just took a while to arrive), or a hostile participant may lie and report large numbers of fictional participants.
So we could make an even stronger argument that the natural cardinality for the mathematics of permissionless systems, as observed from inside the system, is \emph{uncountable} --- in the sense that `permissionless' implies that `participants are not enumerable from within the system'.\footnote{To phrase this slightly differently: ordinals are about order-types, and \emph{the natural order-type of an arbitrary permissionless sytem may be an uncountable ordinal}.
When viewed from the end of some concrete run we may look back from outside the system and note that the implementation only traversed a finite segment of this uncountable space, but this just corresponds to the fact that any descending chain of ordinals is finite.}
\end{enumerate}
\end{rmrk}




%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Closure properties of topens}
\label{subsect.closure.properties.of.cc}

Definition~\ref{defn.connected.set} will be useful in Lemma~\ref{lemm.cc.unions}(2): 
\begin{defn}
\label{defn.connected.set}
Suppose $(\ns P,\opens)$ is a semitopology.
Call a nonempty set of open sets $\mathcal O\subseteq\opens$ \deffont{connected} when its elements pairwise intersect.
In symbols: 
$$
\mathcal O\subseteq\opens\ \text{is connected}
\quad\text{when}\quad
\Forall{O,O'\in\mathcal O}O\between O'.
$$
Note that if $\mathcal O$ is connected then every $O\in\mathcal O$ is nonempty, since $\varnothing\between O$ is impossible (Notation~\ref{nttn.between}).
\end{defn}



\begin{lemm}
\label{lemm.cc.unions}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item\label{item.intersecting.pair.of.topens}
If $\atopen$ and $\atopen'$ are an intersecting pair of topens (i.e. $\atopen\between \atopen'$), then $\atopen\cup \atopen'$ is topen. 
\item
If $\mathcal \atopen$ is a connected set (Definition~\ref{defn.connected.set}) of topens, then $\bigcup\mathcal \atopen$ is topen. 
\item
If $\mathcal \atopen=(\atopen_\alpha\mid \alpha<\beta)$ is an ascending chain of topens then $\bigcup\mathcal \atopen$ is topen.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
$\atopen\cup \atopen'$ is open because by Definition~\ref{defn.semitopology}(\ref{semitopology.unions}) open sets are closed under arbitrary unions, and by Lemma~\ref{lemm.transitive.transitive}(2) $\atopen\cup \atopen'$ is transitive.
\item
$\bigcup\mathcal \atopen$ is open by Definition~\ref{defn.semitopology}(\ref{semitopology.unions}).
Also, if $O\between\bigcup\mathcal \atopen\between O'$ then there exist $\atopen,\atopen'\in\mathcal \atopen$ such that $O\between \atopen$ and $\atopen'\between O'$.
We assumed $\atopen\between \atopen'$, so by Lemma~\ref{lemm.transitive.transitive}(1) (since $\atopen$ and $\atopen'$ are open) we have $O\between O'$ as required. 
\item
An ascending chain is pairwise intersecting.  We use part~2 of this result.\footnote{We could also use Lemma~\ref{lemm.cac.transitive}.  The reader might now ask why Lemma~\ref{lemm.cac.transitive} was not derived directly from Lemma~\ref{lemm.transitive.transitive}(2); this is because (interestingly) Lemma~\ref{lemm.cac.transitive} does not require openness.}
\qedhere
\end{enumerate}
\end{proof}

\begin{corr}
\label{corr.max.cc}
Suppose $(\ns P,\opens)$ is a semitopology.
Then every topen $\atopen$ is contained in a unique maximal topen.
\end{corr}
\begin{proof}
Consider the following set:
$$
\mathcal \atopen = \{\atopen\cup \atopen' \mid \atopen'\text{ topen}\land \atopen\between \atopen'\} .
$$
By Lemma~\ref{lemm.cc.unions}(2) this is a set of topens.
By construction they all contain $\atopen$, and by our assumption that $\atopen\neq\varnothing$ they pairwise intersect (since they all contain $\atopen$, at least).
By Lemma~\ref{lemm.cc.unions}(3) therefore, $\bigcup\mathcal \atopen$ is a transitive open set.
It is easy to check that this is a unique maximal transitive open set that contains $\atopen$. 
\end{proof}


\begin{thrm}
\label{thrm.topen.partition}
Suppose $(\ns P,\opens)$ is a semitopology.
Then any $P\subseteq \ns P$, and in particular $\ns P$ itself, can be partitioned into:
\begin{itemize*}
\item
Some disjoint collection of maximal topens.
\item
A set of other points, which are not contained in any topen.
In Definition~\ref{defn.tn} we will call these points \emph{irregular}.
\end{itemize*}
\end{thrm}
\begin{proof}
Routine from Corollary~\ref{corr.max.cc}.
\end{proof}


\begin{rmrk}
\label{rmrk.forward}
\label{rmrk.partition}
It may be useful to put Theorem~\ref{thrm.topen.partition} in the context of the terminology, results, and examples that will follow below. 
We will have Definition~\ref{defn.tn}(\ref{item.regular.point}) and Theorem~\ref{thrm.max.cc.char}.
These will allow us to call a point $p$ contained in some maximal topen $\atopen$ \emph{regular}, and to call the maximal topen $\atopen$ of a regular point its \emph{community}.
Then Theorem~\ref{thrm.topen.partition} says that a semitopology $\ns P$ can be partitioned into:
\begin{itemize*}
\item
Regular points, which partition into disjoint communities --- each community is, in a sense made formal in Theorem~\ref{thrm.correlated}, a coalitions of strongly-correlated regular points acting together --- and
\item
a set of irregular points, which have no commmunity and so are not members of any such coalition.
\end{itemize*} 
We examples in Example~\ref{xmpl.cc} and Figure~\ref{fig.012}, and will see more elaborate examples below (see in particular the collection in Example~\ref{xmpl.two.topen.examples}). 

In the special case that the entire space consists of a single topen community, there are no irregular points and all participants are guaranteed to reach the \emph{same} consensus, if they reach consensus at all.
For the application of a single blockchain trying to arrive at consensus, this discussion tells us that we want it to consist, semitopologically, of a single topen.
\end{rmrk}






%%%%%%%%%%%%%%%%%%%%%
\subsection{Intertwined points: $\intertwined{p}$} 
\label{subsect.intertwined.points}


\subsubsection{The basic definition, and some lemmas}

\begin{defn}
\label{defn.intertwined.points}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
\begin{enumerate*}
\item
Call $p$ and $p'$ \deffont{intertwined} when $\{p,p'\}$ is transitive.
Unpacking Definition~\ref{defn.transitive} this means:
$$
\Forall{O,O'{\in}\opens} (p\in O\land p'\in O') \limp O\between O' .
$$ 
By a mild abuse of notation, write 
$$
p\intertwinedwith p' \quad \text{when}\quad \text{$p$ and $p'$ are intertwined}.
$$
\item\label{intertwined.defn}
Define $\intertwined{p}$ (read `$p$-intertwined') to be the set of points intertwined with $p$.
In symbols: 
$$
\intertwined{p}=\{p'\in\ns P \mid p\intertwinedwith p'\} .
$$
\end{enumerate*}
\end{defn}


\begin{xmpl}
\label{xmpl.how.different?}
We return to the examples in Example~\ref{xmpl.cc}.  
There we note that:
\begin{enumerate*}
\item
$\intertwined{1}=\{0,1,2\}$ and $\intertwined{0}=\{0\}$ and $\intertwined{2}=\{2\}$.
\item
$\intertwined{1}=\{1\}$ and $\intertwined{0}=\{0\}$ and $\intertwined{2}=\{2\}$.
\item
$\intertwined{x}=\ns P$ for every $x$. 
\end{enumerate*}
\end{xmpl}


It might be tempting to suppose that points being intertwined should be transitive.
Lemma~\ref{lemm.intertwined.not.transitive} shows that this is not necessarily the case:
\begin{lemm}
\label{lemm.intertwined.not.transitive}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the `is intertwined' relation $\between$ is not necessarily transitive.
That is: $p\intertwinedwith p'\intertwinedwith p''$ does not necessarily imply $p\intertwinedwith p''$.
\end{lemm}
\begin{proof}
It suffices to provide a counterexample.
The semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, left-hand diagram) will do.
Take 
$$
\ns P=\{0,1,2\}
\quad\text{and}\quad
\opens=\{\varnothing,\ns P,\{0\},\{2\}\}.
$$
Then 
$$
0\between 1
\ \ \text{and}\ \ 1\between 2,
\quad\text{but}\quad
\neg(0\between 2).
$$
\end{proof}
There is more to be said about Lemma~\ref{lemm.intertwined.not.transitive} but will need more machinery to express it; we will pick up this thread again in Definition~\ref{defn.conflicted}.




\subsubsection{Pointwise characterisation of transitive sets}

\begin{lemm}
\label{lemm.three.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$\atopen$ is transitive.
\item
$\{p,p'\}$ is transitive for every $p,p'\in \atopen$.
\item
$p\intertwinedwith p'$ for every $p,p'\in \atopen$.
\end{enumerate*}
\end{lemm}
\begin{proof}
The equivalence of parts~2 and~3 above just restates Definition~\ref{defn.intertwined.points}.
We now prove equivalence of parts~1 and~2.
\begin{itemize}
\item
\emph{Suppose $\atopen$ is transitive.}
\quad

By Lemma~\ref{lemm.transitive.subset}(1), $\{p,p'\}$ is transitive for every $p,p'\in \atopen$.
\item
\emph{Suppose $\{p,p'\}$ is transitive for every $p,p'\in \atopen$.}

Consider open sets $O$ and $O'$ such that $O\between \atopen\between O'$. 
Choose $p\in O\cap \atopen$ and $p'\in O\cap \atopen'$.
By construction $\{p,p'\}\subseteq \atopen$ so this is transitive.
It follows that $O\between O'$ as required.
\end{itemize}
\end{proof}



\begin{thrm}
\label{thrm.cc.char}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following assertions are equivalent:
$$
\text{$\atopen$ is topen}
\quad\text{if and only if}\quad
\varnothing{\neq}\atopen{\in}\opens \land \Forall{p,p'{\in}\atopen}p\intertwinedwith p'.
$$
In words we can say:
\begin{quote}
A topen is a nonempty open set of intertwined points.
\end{quote}
\end{thrm}
\begin{proof}
By Definition~\ref{defn.transitive}(\ref{transitive.cc}), $\atopen$ is topen when it is nonempty, transitive, and open. 
By Lemma~\ref{lemm.three.transitive} this last condition is equivalent to $p\intertwinedwith p'$ for every $p,p'\in \atopen$. 
\end{proof}

A value assignment is constant on a pair of intertwined points, where it is continuous:
\begin{corr}
\label{corr.intertwined.correlated}
Suppose $\tf{Val}$ is a semitopology of values and $f:\ns P\to\tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment})
and $p,p'\in\ns P$ and $p\between p'$.
Then if $f$ continuous at $p$ and $p'$ then $f(p)=f(p')$.
\end{corr}
\begin{proof}
$\{p,p'\}$ is transitive by Theorem~\ref{thrm.cc.char};
we use Theorem~\ref{thrm.correlated}.
\end{proof}


\begin{rmrk}[Intertwined as `non-Hausdorff', and the significance of this to consensus]
\label{rmrk.not.hausdorff}
\leavevmode
\\
\noindent Recall that we call a topological space $(\ns P,\opens)$ \deffont{Hausdorff} when any two points can be separated by pairwise disjoint open sets.
Using the $\between$ symbol from Notation~\ref{nttn.between}, we rephrase the Hausdorff condition as
$$
\Forall{p,p'}p\neq p'\limp \Exists{O,O'}(p\in O\land p'\in O'\land \neg (O\between O')) , 
$$
and we can then simplify to this:
$$
\neg\Exists{p,p'}p\neq p'\land p\intertwinedwith p' .
$$
Now note that the Hausdorff condition can be compactly written just as
\begin{equation}
\label{eq.hausdorff}
\Forall{p}\intertwined{p}=\{p\}.
\end{equation}
Note how distinct $p$ and $p'$ being intertwined is the \emph{opposite} of being Hausdorff: $p\intertwinedwith p'$ when $p'\in\intertwined{p}$, and they \emph{cannot} be separated by pairwise disjoint open sets.
Thus the assertion $p\intertwinedwith p'$ in Theorem~\ref{thrm.cc.char} is a negation to the Hausdorff property:
$$
\Exists{p}\intertwined{p}\neq\{p\} .
$$
This is useful because for semitopologies as applied to consensus, 
\begin{itemize*}
\item
being Hausdorff means that the space is separated (which is probably a bad thing, if we are looking for a system with lots of points in consensus), whereas 
\item
lots of \emph{`non-Hausdorff'} intertwined points means by Theorems~\ref{thrm.cc.char} and~\ref{thrm.topen.partition} that there are a relatively small number of relatively large topens --- ideally, everything is intertwined and there is just one topen --- such that by Theorem~\ref{thrm.correlated} the system will (where it reaches consensus) reach consensus on a single constant value assignment (which is a good thing).
\end{itemize*}
In the literature this might be called \emph{avoiding forking}.
\end{rmrk}

 

%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Strong topens: topens that are also subspaces}

\subsubsection{Definition and main result}

Let us take stock and recall that:
\begin{itemize*}
\item
$\atopen$ is \emph{topen} when it is a nonempty open transitive set (Definition~\ref{defn.transitive}).
\item
$\atopen$ is \emph{transitive} when $O\between \atopen \between O'$ implies $O\between O'$ for all $O,O'\in\tf{Opens}$ (Definition~\ref{defn.transitive}). 
\item
$O\between O'$ means that $O\cap O'\neq\varnothing$ (Notation~\ref{nttn.between}). 
\end{itemize*}
But, note above that if $\atopen$ is topen and $O\between \atopen\between O'$ then $O\cap O'$ need not intersect \emph{inside $\atopen$}.
It could be that $O$ and $O'$ intersect outside of $\atopen$ (an example is in the proof Lemma~\ref{lemm.cc.subspaces} below).

Definition~\ref{defn.subspace} spells out a standard topological construction in the language of semitopologies:
\begin{defn}[Subspaces]
\label{defn.subspace}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\atopen\subseteq\ns P$ is a set of points.
Write $(\atopen,\opens\cap \atopen)$ for the semitopology such that:
\begin{itemize*}
\item
The points are $\atopen$.
\item
The open sets have the form $O\cap \atopen$ for $O\in\opens$.
\end{itemize*}
We say that $(\atopen, \opens\cap \atopen)$ is $\atopen$ with the \deffont{semitopology inherited from $(\ns P,\opens)$}.

We may call $(\atopen,\opens\cap \atopen)$ a \deffont{subspace} of $(\ns P,\opens)$, and if the open sets are understood then we may omit mention of them and just write:
\begin{quote}
A subset $\atopen\subseteq\ns P$ is naturally a \deffont{(semitopological) subspace} of $\ns P$.
\end{quote}
\end{defn}




\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/not-strong-topen.pdf}
\vspace{-1em}
\caption{Example of a topen that is not strong}
\label{fig.not-strong-topen}
\end{figure}


\begin{lemm}
\label{lemm.cc.subspaces}
The property of being a (maximal) topen is not necessarily closed under taking subspaces.
\end{lemm}
\begin{proof}
It suffices to exhibit a semitopology $(\ns P,\opens)$ and a subset $S\subseteq\ns P$ such that $S$ is topen in $(\ns P,\opens)$ but $S$ is not topen in $(S,\opens\cap S)$.
We set:
$$
\ns P=\{0, 1, 2\}
\qquad
\opens=\{\varnothing,\ \ns P,\ \{0, 2\},\ \{1, 2\},\ \{0,1\}\}
\qquad
\atopen=\{0,1\}
$$
as illustrated in Figure~\ref{fig.not-strong-topen}.
Now:
\begin{itemize*}
\item
$\atopen$ is topen in $(\ns P,\opens)$, because every open neighbourhood of $0$ --- that is $\{0,2\}$, $\{0,1\}$, and $\ns P$ --- intersects with every open neighbourhood of $1$ --- that is $\{1,2\}$, $\{0,1\}$, and $\ns P$.
\item
$\atopen$ is not topen in $(\atopen,\opens\cap \atopen)$, because $\{0\}$ is an open neighbourhood of $0$ and $\{1\}$ is an open neighbourhood of $1$ and these do not intersect.
\qedhere\end{itemize*}
\end{proof}



Lemma~\ref{lemm.cc.subspaces} motivates the following definitions:
\begin{defn}
\label{defn.strongly.transitive}
Suppose $(\ns P, \opens)$ is a semitopology and recall from Definition~\ref{defn.transitive} the notions of \emph{transitive set} and \emph{topen}.
\begin{enumerate*}
\item\label{item.strongly.transitive}
Call $\atopen\subseteq\ns P$ \deffont{strongly transitive} when
$$
\Forall{O,O'{\in}\opens} O\between \atopen \between O' \limp O\cap \atopen\between O'\cap \atopen . 
$$
\item\label{strong.transitive.cc}
Call $\atopen$ a \deffont{strong topen} when $\atopen$ is nonempty open and strongly transitive, 
\end{enumerate*}
\end{defn}

We take a moment to spell out the obvious:
\begin{lemm}
\label{lemm.strong.is.stronger}
Suppose $(\ns P, \opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then if $\atopen$ is strongly transitive then it is transitive.
\end{lemm}
\begin{proof}
Just unfolding definitions and noting that $O\cap \atopen\between O'\cap \atopen$ implies $O\between O'$.
\end{proof}


\begin{prop}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\atopen\in\opens$.
Then the following are equivalent:
\begin{enumerate*}
\item
$\atopen$ is a strong topen. 
\item
$\atopen$ is a topen in $(\atopen,\opens\cap \atopen)$ (Definition~\ref{defn.subspace}).
\end{enumerate*} 
\end{prop}
\begin{proof}
Suppose $\atopen$ is a strong topen; thus $\atopen$ is nonempty, open, and strongly transitive in $(\ns P,\opens)$.
Then by construction $\atopen$ is open in $(\atopen,\opens\cap \atopen)$, and the strong transitivity property of Definition~\ref{defn.strongly.transitive} asserts precisely that $\atopen$ is transitive as a subset of $(\atopen,\opens\cap \atopen)$.

Now suppose $\atopen$ is a topen in $(\atopen,\opens\cap \atopen)$; thus $\atopen$ is nonempty, open, and transitive in $(\atopen,\opens\cap \atopen)$.
Then $\atopen$ is nonempty and by assumption above $\atopen\in\opens$.\footnote{It does not follow from $\atopen$ being open in $(\atopen,\opens\cap \atopen)$ that $\atopen$ is open in $(\ns P,\opens)$, but we carefully assumed this holds.}
Now suppose $O,O'\in\opens$ and $O\between \atopen\between O'$.
Then by elementary properties of sets $(O\cap \atopen)\between \atopen\between (O'\cap \atopen)$, so by transitivity of $\atopen$ in $(\atopen,\opens\cap \atopen)$ also $(O\cap \atopen)\between (O'\cap \atopen)$, and thus also $O\between O'$. 
\end{proof}


\subsubsection{Connection to lattice theory}

There is a notion from order-theory of a \emph{join-irreducible} element (see for example in \cite[Definition~2.42]{priestley:intlo}), and a dual notion of \emph{meet-irreducible} element:
\begin{defn}
Call an element $s$ in a lattice $\mathcal L$ 
\begin{itemize*}
\item
\deffont{join-irreducible} when $x\vee y=s$ implies $x=s$ or $y=x$, and 
\item
\deffont{meet-irreducible} when $x\wedge y=s$ implies $x=s$ or $y=s$. 
\end{itemize*}
\end{defn}



\begin{xmpl}
\label{xmpl.meet-irreducible}
\leavevmode
\begin{enumerate*}
\item
Consider the lattice of finite (possibly empty) subsets of $\mathbb N$, with $\mathbb N$ adjoined as a top element.
Then $\mathbb N$ is join-irreducible; if $x\cup y=\mathbb N$ then either $x=\mathbb N$ or $y=\mathbb N$.
\item\label{item.final.N}
Consider $\mathbb N$ with the \deffont{final segment} semitopology such that opens are either $\varnothing$ or sets $n_\geq = \{n'\in\mathbb N \mid n'\geq n\}$.

Then $\varnothing$ is meet-irreducible; if $x\cap y=\varnothing$ then either $x=\varnothing$ or $y=\varnothing$.
\item
Consider the natural numbers with the lattice structure in which meet is minimum and join is maximum.
Then every element is join- and meet-irreducible; if $x\vee y=z$ then $x=z$ or $y=z$, and similarly for $x\wedge y$. 
\end{enumerate*}
Thus we see that irreducibility captures a notion that an element cannot be approached by finitely many joins (or meets). 
\end{xmpl}


We spell out how this is relates to our notions of transitivity from Definitions~\ref{defn.transitive} and~\ref{defn.strongly.transitive}:
\begin{lemm}
\label{lemm.meet-irreducible}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then: 
\begin{enumerate*}
\item
$\atopen$ is strongly transitive if and only if $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$ (Definition~\ref{defn.subspace}). 
\item
$\atopen$ is transitive if $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$.
\item
If $\atopen$ is transitive it does not necessarily follow that $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We are abusing terminology talking about meet-irreducibility in the set of open sets $\{O\cap \atopen\mid O\in\opens\}$ of the subspace $(\atopen,\opens\cap \atopen)$, 
because this is not a lattice since $\opens$ is not closed under intersections in general.\footnote{Unless $(\ns P,\opens)$ happens to be a topology and not just a semitopology, of course.}
However, some meets may still exist and in particular it makes sense to ask whether two elements have a sets intersection that is equal to $\varnothing$, since $\varnothing$ is in $\{O\cap \atopen\mid O\in\opens\}$ --- if this reader does not approve, they can call the property `partial $\cap$-irreducibility' instead of `meet-irreducibility' and no harm will come of it.
We can now proceed to reason as follows: 
\begin{enumerate}
\item
$\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$ means that $(O\cap \atopen)\cap (O'\cap \atopen)=\varnothing$ implies $O\cap \atopen=\varnothing$ or $O\cap \atopen'=\varnothing$.

$\atopen$ is strongly transitive when (taking the contrapositive in Definition~\ref{defn.strongly.transitive}(1)) $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ implies $O\cap \atopen=\varnothing$ or $\atopen\cap O'=\varnothing$.

That these conditions are equivalent follows by straightforward sets manipulations. 
\item
We can use part~1 of this result and Lemma~\ref{lemm.strong.is.stronger}, or give a direct argument by sets calculations: if $O\cap O'=\varnothing$ then $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ and by meet-irreducibility $O\cap \atopen=\varnothing$ or $\atopen\cap O'=\varnothing$ as required.
\item
Figure~\ref{fig.not-strong-topen} provides a counterexample, taking $\atopen=\{0,1\}$ and $O=\{0,2\}$ and $O'=\{1,2\}$.
Then $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ but it is not the case that $O\cap \atopen=\varnothing$ or $O'\cap \atopen=\varnothing$.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
\label{rmrk.imperfect}
The proof of Lemma~\ref{lemm.meet-irreducible} not hard, but the result is interesting for what it says, and also for what it does not say:
\begin{enumerate}
\item
The notion of being a strong topen maps naturally to something in order theory; namely that $\varnothing$ is meet-irreducible in the induced poset $\{O\cap \atopen\mid O\in\opens\}$ which is the set of open sets of the subspace $(\atopen,\opens\cap \atopen)$ of $(\ns P,\opens)$.
\item
However, this mapping is imperfect: the poset is not a lattice, and it is also not a sub-poset of $\opens$ --- even if $\atopen$ is topen.
If $\opens$ were a topology and closed under intersections then we would have a lattice --- but it is precisely the point of difference between semitopologies vs. topologies that open sets need not be closed under intersections. 
\item
Being transitive does not correspond to meet-irreducibility; there is an implication in one direction, but certainly not in the other. 
\end{enumerate}
So, Lemma~\ref{lemm.meet-irreducible} says that (strong) transitivity has a flavour of meet-irreducibility, but in a way that also illustrates --- as did Proposition~\ref{prop.max.topen.min.closed}(2) --- how semitopologies are different, because they are not closed under intersections, and have their own behaviour.

See also the characterisation of strong transitivity in Lemma~\ref{lemm.strongly.dense.strongly.transitive} and the surrounding discussion.
\end{rmrk}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Open interiors, communities, and regular points}
\label{sect.regular.points}




%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Community of a (regular) point} 


Definition~\ref{defn.interior} is standard: 
\begin{defn}[Open interior]
\label{defn.interior}
Suppose $(\ns P,\opens)$ is a semitopology and $R\subseteq\ns P$.
Define $\interior(R)$ the \deffont{interior} of $R$ by
$$
\interior(R)=\bigcup\{ O\in\opens \mid O\subseteq R\} .
$$
\end{defn}

\begin{lemm}
\label{lemm.interior.open}
Continuing the notation of Definition~\ref{defn.interior}, $\interior(R)$ is the greatest open set contained in $R$.
\end{lemm}
\begin{proof}
Routine by the construction in Definition~\ref{defn.interior} and closure of open sets under unions (Definition~\ref{defn.semitopology}(\ref{semitopology.unions})).
\end{proof}





\begin{defn}[Community of a point, and regularity]
\label{defn.tn}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item\label{item.tn}
Define $\community(p)$ the \deffont{community} of $p$ by 
$$
\community(p)=\interior(\intertwined{p}) .
$$
The community of $p$ is always an open set by Lemma~\ref{lemm.interior.open}.\footnote{But note that:
\begin{itemize*}
\item
$\community(p)$ might be empty (see any $x\in\mathbb R$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R})).
\item
$\community(p)$ need not be topen (see point $1$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012})).
\item
$\community(p)$ need not contain $p$ (see point $0$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b})).
\end{itemize*}
}
\item\label{item.community.P}
Extend $\community$ to subsets $P\subseteq\ns P$ by taking a sets union:
$$
\community(P) = \bigcup\{\community(p) \mid p\in P\} .
$$
\item\label{item.regular.point}
Call $p$ \deffont{regular} when its community is a topen neighbourhood of $p$.
In symbols:
$$
p\text{ is regular}\quad\text{when}\quad p\in\community(p)\in\topens .
$$
\item\label{item.weakly.regular.point}
Call $p$ \deffont{weakly regular} when its community is an open (but not necessarily topen) neighbourhood of $p$.
In symbols:
$$
p\text{ is weakly regular}\quad\text{when}\quad p\in\community(p)\in\opens .
$$
\item\label{item.quasiregular.point}
Call $p$ \deffont{quasiregular} when its community is nonempty.
In symbols:
$$
p\text{ is quasiregular}\quad\text{when}\quad \varnothing\neq\community(p)\in\opens .
$$
\item
If $p$ is not regular then we may call it \deffont{irregular} or just \deffont{not regular}.
\item\label{item.regular.S}
If $P\subseteq\ns P$ and every $p\in P$ is regular/weakly regular/quasiregular/irregular then we may call $P$ \deffont{regular/weakly regular/quasiregular/irregular} respectively (see also Definition~\ref{defn.conflicted}(2)).
\qedhere\end{enumerate*}
\end{defn}

\begin{rmrk}
Our development will mostly be concerned with regular and weakly regular points.
The property of being quasiregular is also interesting and will also turn up, though less often.
There is plenty of structure here.
\end{rmrk}


\begin{lemm}
\label{lemm.wr.r}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ is regular, then $p$ is weakly regular.
\item
The converse implication need not hold (we sharpen this result in Theorem~\ref{thrm.r=wr+uc}).
\end{enumerate*}
\end{lemm}
\begin{proof}
If $p$ is regular then by Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)\in\topens$, so certainly $p\in\community(p)$ and by Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) $p$ is weakly regular.
To see that the converse implication need not hold, see the point $1$ in Example~\ref{xmpl.wr}(2) below, which is weakly regular but not regular.
\end{proof}



\begin{xmpl}
\label{xmpl.wr}
\leavevmode
\begin{enumerate*}
\item
In Figure~\ref{fig.not-strong-topen},\ $0$, $1$, and $2$ are three intertwined points and the entire space $\{0,1,2\}$ consists of a single topen set.
It follows that $0$, $1$, and $2$ are all regular and their community is $\{0,1,2\}$.
\item
In Figure~\ref{fig.012} (left-hand diagram),\ $0$ and $2$ are regular and $1$ is weakly regular but not regular ($1\in\community(1)=\{0,1,2\}$ but $\{0,1,2\}$ is not topen). 
\item
In Figure~\ref{fig.012} (right-hand diagram),\ $0$ and $2$ are regular and $1$ is neither regular nor weakly regular ($\community(1)=\varnothing$).
\item
In a semitopology of values $(\tf{Val},\powerset(\tf{Val}))$ (Definition~\ref{defn.value.assignment}) every value $v\in\tf{Val}$ is regular, weakly regular, and unconflicted.
\item
In $\mathbb R$ with its usual topology every point is unconflicted because the topology is Hausdorff and by Equation~\ref{eq.hausdorff} in Remark~\ref{rmrk.not.hausdorff} this means precisely that $\intertwined{p}=\{p\}$ so that is intertwined just with itself; and every point is not weakly regular because $\community(p)=\interior(\intertwined{p})=\varnothing$.
\end{enumerate*} 
\end{xmpl}

\begin{rmrk}
Definition~\ref{defn.tn} is a key definition and we pause to discuss it:
\begin{enumerate}
\item
We can ask:
\begin{itemize*}
\item
It it always the case that the community of $p$ exists? 
\emph{(Yes)}
\item
Is the community of $p$ always open?
\emph{(Yes)}
\item
Is it always topen?  
\emph{(No)}
\item
Is it always an open (or a topen) neighbourhood for $p$?
\emph{(No)}
\end{itemize*}
A wealth of behaviour is possible and is explored below, including in Lemma~\ref{lemm.two.intertwined} and in the examples in Subsection~\ref{subsect.irregular}.
\item
Why is it interesting to consider $p$ such that $p\in\community(p)$?
Clearly calling $p$ `regular' suggests that non-regular behaviour is `bad', and regular behaviour is `good'.
But what is this good behaviour that regularity implies? 

The immediate answer comes from Theorem~\ref{thrm.correlated} (continuous value assignments are constant on topens).
This tells us that a regular $p$ is surrounded by a topen neighbourhood of points $\community(p)=\interior(\intertwined{p})$ that must be in consensus with it under continuous value assignments.
Using our terminology \emph{community} and \emph{regular}, Theorem~\ref{thrm.correlated} can then be read as asserting that \emph{the community of a regular $p$ shares its values} --- if we are interested in consensus, this is clearly a useful observation.
\item
We can sum up the above intuitively as follows: 
\begin{itemize*}
\item
We care about transitivity because it implies agreement.
\item
We care about being open, because it implies a quorum and so consensus.
\item
Thus, a regular point is interesting because it is a participant in a maximal topen neighbourhood and therefore can a) come to agreement and b) make progress. 
\end{itemize*}
\item
A mathematical question then arises: how can the community of $p$ can be (semi)topologically characterised?
We will explore this theme, notably in Theorem~\ref{thrm.max.cc.char}, Proposition~\ref{prop.views.of.regularity}, and Theorem~\ref{thrm.up.down.char}; see also Remark~\ref{rmrk.arc}.
\end{enumerate}
\end{rmrk} 


Lemma~\ref{lemm.two.intertwined} notes that Definition~\ref{defn.tn}(\ref{item.regular.point}) is not a trivial condition:
\begin{lemm}
\label{lemm.two.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\community(p)$ is always open since it is an open interior by construction in Definition~\ref{defn.tn}(\ref{item.tn}).
\item
However, $\community(p)$ is not necessarily always topen; equivalently $\community(p)$ is not necessarily transitive.
(More on this later in Subsection~\ref{subsect.irregular}.)
\end{enumerate*}
\end{lemm}
\begin{proof}
It suffices to provide a counterexample.
We consider the semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, left-hand diagram). 
We calculate that $\community(1)=\{0,1,2\}$ so that $\community(1)$ is an open neighbourhood of $1$ --- but it is not transitive, and thus not topen, since $\{0\}\cap\{2\}=\varnothing$.

Further checking reveals that $\{0\}$ and $\{2\}$ are two maximal topens within $\community(1)$. 
\end{proof}


We start by characterising $\community(p)$ as the \emph{greatest} topen neighbourhood of $p$, if this exists:
\begin{lemm}
\label{lemm.intertwined.is.the.greatest}
\label{lemm.max.cc.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and recall that $p$ is regular when $\community(p)$ is a topen neighbourhood of $p$.
\begin{enumerate*}
\item
If $\community(p)$ is a topen neighbourhood of $p$ (i.e. if $p$ is regular) then $\community(p)$ is a maximal topen.
\item
If $p\in \atopen\in\topens$ is a maximal topen neighbourhood of $p$ then $\atopen=\community(p)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Since $p$ is regular, by definition, $\community(p)$ is topen and is a neighbourhood of $p$.
It remains to show that $\community(p)$ is a maximal topen.

Suppose $\atopen$ is a topen neighbourhood of $p$; we wish to prove $\atopen\subseteq \community(p)=\interior(\intertwined{p})$.
Since $\atopen$ is open it would suffice to show that $\atopen\subseteq\intertwined{p}$.
By Theorem~\ref{thrm.cc.char} $p\intertwinedwith p'$ for every $p'\in \atopen$, and it follows immediately that $\atopen\subseteq\intertwined{p}$.
\item
Suppose $\atopen$ is a maximal topen neighbourhood of $p$.

First, note that $\atopen$ is open, and by Theorem~\ref{thrm.cc.char} $\atopen\subseteq\intertwined{p}$, so $\atopen\subseteq\community(p)$.

Now consider any open $O\subseteq\intertwined{p}$.
Note that $\atopen\cup O$ is an open subset of $\intertwined{p}$, so by Theorem~\ref{thrm.cc.char} $\atopen\cup O$ is topen, and by maximality $\atopen\cup O\subseteq \atopen$ and thus $O\subseteq \atopen$.
It follows that $\community(p)\subseteq \atopen$.
\qedhere\end{enumerate}
\end{proof}




\begin{rmrk}
\label{rmrk.how.regularity}
We can use Lemma~\ref{lemm.max.cc.intertwined} to characterise regularity in five equivalent ways: see Theorem~\ref{thrm.max.cc.char} and Corollary~\ref{corr.regular.is.regular}.
Other characterisations will follow but will require additional machinery to state (the notion of \emph{closed neighbourhood}; see Definition~\ref{defn.cn}).
See Corollary~\ref{corr.corr.pKp} and Theorem~\ref{thrm.up.down.char} .
\end{rmrk}
 
\begin{thrm}
\label{thrm.max.cc.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in \ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item\label{char.p.regular}
$p$ is regular, or in full: $p\in\community(p)\in\tf{Topen}$.
\item\label{char.Kp.greatest.topen}
$\community(p)$ is a greatest topen neighbourhood of $p$.
\item\label{char.Kp.max.topen}
$\community(p)$ is a maximal topen neighbourhood of $p$.
\item\label{char.max.topen}
$p$ has a maximal topen neighbourhood. 
\item\label{char.some.topen}
$p$ has some topen neighbourhood.
\end{enumerate*}
\end{thrm}
\begin{proof}
We prove a cycle of implications:
\begin{enumerate}
\item
If $\community(p)$ is a topen neighbourhood of $p$ then it is maximal by Lemma~\ref{lemm.intertwined.is.the.greatest}(1).
Furthermore this maximal topen neighbourhood of $p$ is necessarily greatest, since if we have two maximal topen neighbourhoods of $p$ then their union is a larger topen neighbourhood of $p$ by Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) (union of intersecting topens is topen).
\item
If $\intertwined{p}$ is a greatest topen neighbourhood of $p$, then certainly it is a maximal topen neighbourhood of $p$.
\item
If $\intertwined{p}$ is a maximal topen neighbourhood of $p$, then certainly $p$ has a maximal topen neighbourhood.
\item
If $p$ has a maximal topen neighbourhood then certainly $p$ has a topen neighbourhood.
\item
Suppose $p$ has a topen neighbourhood $\atopen$.
By Corollary~\ref{corr.max.cc} we may assume without loss of generality that $\atopen$ is a maximal topen.
We use Lemma~\ref{lemm.max.cc.intertwined}(2).
\qedhere\end{enumerate}
\end{proof}



We note an easy corollary of Theorem~\ref{thrm.max.cc.char}:
\begin{corr}
\label{corr.when.singleton.topen}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $\{p\}\in\opens$.
Then $p$ is regular. 
\end{corr}
\begin{proof}
We noted in Example~\ref{xmpl.singleton.transitive}(\ref{item.singleton.transitive}) that a singleton $\{p\}$ is always transitive, so if $\{p\}$ is also open, then it is topen, so that $p$ has a topen neighbourhood and by Theorem~\ref{thrm.max.cc.char}(\ref{char.some.topen}) $p$ is topen.\footnote{%
It does not follow from $p\in\{p\}\in\topens$ that $\community(p)=\{p\}$: consider $\ns P=\{0,1\}$ and $\opens=\{\varnothing,\{0\},\{0,1\}\}$ and $p=0$; then $\{p\}\in\topens$ yet $\community(p)=\{0,1\}$.}
\end{proof}


\begin{corr}
\label{corr.regular.is.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$p$ is weakly regular and $\community(p)=\community(p')$ for every $p'\in\community(p)$.
\end{enumerate*} 
It might be useful to look at Example~\ref{xmpl.cc}(\ref{item.cc.two.regular.b}) and Figure~\ref{fig.012} (right-hand diagram).
In that example the point $1$ is \emph{not} regular, and its community $\{0,1,2\}$ is not a community for $0$ or $2$.
\end{corr}
\begin{proof}
Equivalence of parts~2 and~3 is immediate, noting from Definition~\ref{defn.tn}(\ref{item.tn}) that $\community(p)=\interior(\intertwined{p})$.

We prove two implications, repeatedly using Theorem~\ref{thrm.max.cc.char}:
\begin{itemize}
\item
Suppose $p$ is regular.
By Lemma~\ref{lemm.wr.r}(1) $p$ is weakly regular.
Now consider $p'\in\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is topen, so it is a topen neighbourhood of $p'$. 
By Theorem~\ref{thrm.max.cc.char} $\community(p')$ is a greatest topen neighbourhood of $p'$. 
But by Theorem~\ref{thrm.max.cc.char} $\community(p)$ is also a greatest topen neighbourhood of $p$, and $\community(p)\between\community(p')$ since they both contain $p'$.
By Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) and maximality, they are equal.
\item
Suppose $p$ is weakly regular and suppose $\community(p)=\community(p')$ for every $p'\in\community(p)$, and consider $p',p''\in\community(p)$.
Then $p'\intertwinedwith p''$ holds, since $p''\in\community(p')=\community(p)$.
By Theorem~\ref{thrm.cc.char} $\community(p)$ is topen, and by weak regularity $p\in\community(p)$, so by Theorem~\ref{thrm.max.cc.char} $p$ is regular as required. 
\qedhere\end{itemize}
\end{proof}

\begin{corr}
\label{corr.p.p'.regular.community}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
Then if $p$ is regular and $p'\in\community(p)$ then $p'$ is regular and has the same community.
\end{corr}
\begin{proof}
Suppose $p$ is regular --- so by Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)\in\topens$ --- and suppose $p'\in\community(p)$.
Then by Corollary~\ref{corr.regular.is.regular} $\community(p)=\community(p')$, so $p'\in\community(p')\in\topens$ and by Theorem~\ref{thrm.max.cc.char} $p'$ is regular. 
\end{proof}


Corollary~\ref{corr.topen.intersect.subset} will also be useful:
\begin{corr}
\label{corr.topen.intersect.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Suppose $O\in\topens$ is a topen.
Then 
$$
O\between\community(p)
\quad\text{if and only if}\quad
O\subseteq\community(p).
$$
\end{corr}
\begin{proof} 
The right-to-left implication is immediate, given that topens are nonempty by Definition~\ref{defn.transitive}(\ref{transitive.cc}).

For the left-to-right implication, suppose $O\between\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is a maximal topen, and by Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) $O\cup\community(p)$ is topen.
Then $O\subseteq\community(p)$ follows by maximality.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Examples of communities and (ir)regular points}
\label{subsect.irregular}


By Definition~\ref{defn.tn} a point $p$ is regular when its community is a topen neighbourhood.
Then a point is \emph{not} regular when its community is \emph{not} a topen neighbourhood of $p$. 
We saw one example of this in Lemma~\ref{lemm.two.intertwined}.
In this subsection we take a moment to investigate the possible behaviour in more detail. 


\begin{xmpl}
\label{xmpl.p.not.regular}
\leavevmode
\begin{enumerate}
\item\label{item.p.not.regular.R}
Take $\ns P$ to be $\mathbb R$ the real numbers, with its usual topology (which is also a semitopology).
Then
$\intertwined{x}=\{x\}$ and $\community(x)=\varnothing$ for every $x\in\mathbb R$.

In particular, no $x\in\mathbb R$ is regular.
\item\label{item.p.not.regular.012}
We continue the semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, left-hand diagram), as used in Lemma~\ref{lemm.two.intertwined}:
\begin{itemize*}
\item
$\ns P=\{0,1,2\}$.
\item
$\opens$ is generated by $\{0\}$ and $\{2\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1\}$ and $\community(0)=\interior(\intertwined{0})=\{0\}$. 
\item
$\intertwined{2}=\{1,2\}$ and $\community(2)=\interior(\intertwined{2})=\{2\}$. 
\item
$\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,1,2\}$. 
\end{itemize*}
\item\label{item.point.not.regular.but.community.is.topen}\label{item.p.not.regular.01234}
We take, as illustrated in Figure~\ref{fig.irregular} (left-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{1,2\}$ for $x\in\{0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\end{itemize*}
(We return to this example in Example~\ref{xmpl.p.not.regular.2}(\ref{item.p.not.regular.01234.2}), and we will also use it in the proof of Lemma~\ref{lemm.kernel.non-implications}.)
\item\label{item.p.not.regular.01234b}
We take, as illustrated in Figure~\ref{fig.irregular} (right-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1\}$, $\{2\}$, $\{3\}$, $\{4\}$, $\{0, 1, 2, 3\}$, and $\{0, 1, 2, 4\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1,2\}$ and $\community(0)=\{1,2\}$.
\item
$\community(0)$ is not transitive and consists of two distinct topens $\{1\}$ and $\{2\}$.
\item
$0\not\in\community(0)$. 
\end{itemize*}
See Remark~\ref{rmrk.indeed.two.closed.neighbourhoods} for further discussion of this example.
\item
The reader can also look ahead to Example~\ref{xmpl.two.topen.examples}.
In Example~\ref{xmpl.two.topen.examples}(1), every point $p$ is regular and $\community(p)=\mathbb Q^2$.
In Example~\ref{xmpl.two.topen.examples}(2), no point $p$ is regular and $\community(p)=\varnothing\subseteq\mathbb Q^2$.
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample.pdf}
\includegraphics[width=0.31\columnwidth]{diagrams/universal_example.pdf}
\vspace{-0em}
\caption{Illustration of Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}\&\ref{item.p.not.regular.01234b})}
\label{fig.irregular}
\end{figure}


\begin{lemm}
\label{lemm.p.not.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then precisely one of the following possibilities must hold, and each is possible: 
\begin{enumerate}
\item
$p$ is regular: $p\in\community(p)$ and $\community(p)$ is topen (nonempty, open, and transitive). 
\item
$\community(p)$ is topen, but $p\not\in\community(p)$. 
\item
$\community(p)=\varnothing$.
\item
$\community(p)$ is open but not transitive.
(Both $p\in\community(p)$ and $p\not\in\community(p)$ are possible.)
\end{enumerate}
\end{lemm}
\begin{proof} 
\leavevmode\begin{enumerate}
\item
To see that $p$ can be regular, consider $\ns P=\{0\}$ with the discrete topology.
Then $p\in\community(p)=\{0\}$.
\item
To see that it is possible for $\community(p)$ to be topen but $p$ is not in it, consider Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}).
There, $\ns P=\{0,1,2,3,4\}$ and $\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,2\}$.
Then $\community(1)$ is topen, but $1\not\in\community(1)$.
\item
To see that $\community(p)=\varnothing$ is possible, consider Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}) (the real numbers $\mathbb R$ with its usual topology).
Then by Remark~\ref{rmrk.not.hausdorff} $\intertwined{r}=\{r\}$ and so $\community(x)=\interior(\{r\})=\varnothing$.
(See also Example~\ref{xmpl.two.topen.examples}(2) for a more elaborate example.) 
\item
To see that it is possible for $\community(p)$ to be an open neighbourhood of $p$ but not transitive, see Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012}).
There, $\ns P=\{0,1,2\}$ and $1\in \intertwined{1}=\{0,1,2\}=\community(1)$, but $\{0,1,2\}$ is not transitive (it contains two disjoint topens: $\{0\}$ and $\{2\}$).

To see that it is possible for $\community(p)$ to be open and nonempty yet not contain $p$ and not be transitive, see Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b}) for $p=0$, and see also Remark~\ref{rmrk.indeed.two.closed.neighbourhoods} for a discussion of the connection with minimal closed neighbourhoods.
\end{enumerate}
The possibilities above are clearly mutually exclusive and exhaustive.
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Closed sets}
\label{sect.closed.sets}

\subsection{Closed sets}

\begin{rmrk}
\label{rmrk.computing.closures}
In this Subsection we check that some familiar properties of closures carry over from topologies to semitopologies.
There are no technical surprises in this subsection, but this needs checked. 
In the following Subsection we will build on this to study the close relation between closures and sets of intertwined points. 
First, we spare a few words on why closures are particularly interesting in semitopologies:

Topens, and in particular maximal topens (Definition~\ref{defn.transitive}) are key for semitopological consensus --- but \emph{computing} them is hard:
the definition involves quantifications over all open sets and there may be many of them.
Furthermore, for a participant it may be non-trivial to gain an overview of the full network and its open sets, if bandwidth and computational power are limited.
However, computing \emph{closures} is quite tractable in the right circumstances (see Section~\ref{sect.witness} and Remark~\ref{rmrk.computing.closed.sets}), so 
characterisations of equalities and subset inclusions in terms of closed sets is of practical interest.
See also the discussion in Remark~\ref{rmrk.fundamental.consensus}.
\end{rmrk}



\begin{defn}
\label{defn.closure}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ and $P\subseteq\ns P$.
Then:
\begin{enumerate*}
\item\label{item.closure}
Define $\closure{P}\subseteq\ns P$ the \deffont{closure} of $P$ to be the set of points $p$ such that every open neighbourhood of $p$ intersects $P$.
In symbols using Notation~\ref{nttn.between}: 
$$
\closure{P} = \{ p'\in\ns P \mid \Forall{O{\in}\opens} p'\in O \limp P\between O\} .
$$
\item\label{item.closure.p}
As is standard, we may write $\closure{p}$ for $\closure{\{p\}}$.
Unpacking definitions for reference:
$$
\closure{p} = \{ p'\in\ns P \mid \Forall{O{\in}\opens} p'\in O \limp p\in O\} .
$$
\end{enumerate*}
\end{defn}




\begin{lemm}
\label{lemm.closure.monotone}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P,P'\subseteq\ns P$.
Then taking the closure of a set is: 
\begin{enumerate*}
\item\label{closure.monotone}
\emph{Monotone:}\quad If $P\subseteq P'$ then $\closure{P}\subseteq\closure{P'}$.
\item\label{closure.increasing}
\emph{Increasing:}\quad $P\subseteq\closure{P}$.
\item\label{closure.idempotent}
\emph{Idempotent:}\quad $\closure{P}=\closure{\closure{P}}$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By routine calculations from Definition~\ref{defn.closure}.
\end{proof}

\begin{lemm}
\label{lemm.closure.open.char}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$ and $O\in\opens$.
Then 
$$
P\between O
\quad\text{if and only if}\quad 
\closure{P}\between O.
$$
\end{lemm}
\begin{proof}
Suppose $P\between O$.
Then $\closure{P}\between O$ using Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}).

Suppose $\closure{P}\between O$.
Pick $p\in \closure{P}\cap O$.
By construction of $\closure{P}$ in Definition~\ref{defn.closure} $p\in O\limp P\between O$.
It follows that $P\between O$ as required.
\end{proof}


\begin{defn}
\label{defn.closed}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $C\subseteq\ns P$.
\begin{enumerate*}
\item
Call $C$ \deffont{closed} when $C=\closure{C}$.
\item
Call $C$ \deffont{clopen} when $C$ is closed and open.
\end{enumerate*}
\end{defn}


\begin{xmpl}\leavevmode
\begin{enumerate}
\item
Take $\ns P=\{0,1\}$ and $\opens=\{\varnothing, \{0\}, \{0,1\}\}$.
Then the reader can verify that:
\begin{itemize*}
\item
$\{0\}$ is open.
\item
The closure of $\{1\}$ is $\{1\}$ and $\{1\}$ is closed.
\item
The closure of $\{0\}$ is $\{0,1\}$.
\item
$\varnothing$ and $\{0,1\}$ are the only clopen sets.
\end{itemize*}
\item
Now take $\ns P=\{0,1\}$ and $\opens=\{\varnothing, \{0\}, \{1\}, \{0,1\}\}$.\footnote{Following Definition~\ref{defn.value.assignment} and Example~\ref{xmpl.semitopologies}(\ref{item.boolean.discrete}), this is just $\{0,1\}$ with the \emph{discrete semitopology}.}
Then the reader can verify that:
\begin{itemize*}
\item
Every set is clopen.
\item
The closure of every set is itself.
\end{itemize*}
\end{enumerate}
\end{xmpl}

\begin{rmrk}
There are two standard definitions for when a set is closed: when it is equal to its closure (as per Definition~\ref{defn.closed}(1)), and when it is the complement of an open set.
In topology these are equivalent.
We do need to check that the same holds in semitopology, but as it turns out the proof is routine:
\end{rmrk}

\begin{lemm}
\label{lemm.closed.complement.open}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
Suppose $C\in\f{Closed}(\ns P)$ is closed (by Definition~\ref{defn.closed}: $C=\closure{C}$).
Then $\ns P\setminus C$ is open.
\item
Suppose $O\in\opens$ is open.
Then $\ns P\setminus O$ is closed (by Definition~\ref{defn.closed}: $\closure{\ns P\setminus O}=\ns P\setminus O$).
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $p\in \ns P\setminus C$.
Since $C=\closure{C}$, we have $p\in\ns P\setminus\closure{C}$.
Unpacking Definition~\ref{defn.closure}, this means precisely that there exists $O_p\in\opens$ with $p\in O_p \notbetween C$.
We use Lemma~\ref{lemm.open.is.open}. 
\item
Suppose $O\in\opens$.
Combining Lemma~\ref{lemm.open.is.open} with Definition~\ref{defn.closure} 
it follows that $O\notbetween \closure{\ns P\setminus O}$ so that $\closure{\ns P\setminus O}\subseteq\ns P\setminus O$.
Furthermore, by Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}) $\ns P\setminus O\subseteq\closure{\ns P\setminus O}$.
\qedhere\end{enumerate}
\end{proof}


\begin{corr}
\label{corr.closed.complement.union}
If $C\in\f{Closed}(\ns P)$ then $\ns P\setminus C=\bigcup_{O\in\opens} O\notbetween C$.
\end{corr}
\begin{proof}
By Lemma~\ref{lemm.closed.complement.open}(1) $\ns P\setminus C\subseteq\bigcup_{O\in\opens} O\notbetween C$.
Conversely, if $O\notbetween C$ then $O\subseteq\ns P\setminus C$ by Definition~\ref{defn.closure}(\ref{item.closure}). 
\end{proof}


\begin{corr}
\label{corr.closure.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $R\subseteq\ns P$ and $\mathcal C\subseteq\powerset(\ns P)$.
Then:
\begin{enumerate*}
\item
$\varnothing$ and $\ns P$ are closed.
\item\label{closure.closure.cap}
If every $R\in\mathcal C$ is closed, then $\bigcap\mathcal C$ is closed.
Or succinctly in symbols:
$$
\mathcal C\subseteq\closed \limp \bigcap\mathcal C\in\closed .
$$
\item\label{item.closure.as.intersection}
$\closure{R}$ is equal to the intersection of all the closed sets that contain it.
In symbols:
$$
\closure{R}=\bigcap\{C\in\closed \mid R\subseteq C\}. 
$$
\end{enumerate*}
\end{corr}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Immediate from Lemma~\ref{lemm.closed.complement.open}(2).
\item
From Lemma~\ref{lemm.closed.complement.open} and Definition~\ref{defn.semitopology}(1\&2).
\item
By part~2 of this result $\bigcap\{C\in\closed \mid R\subseteq C\}$ is closed and contains $R$.
By construction, it is the least such.
\qedhere\end{enumerate}
\end{proof}

The usual duality between forming closures and interiors, remains valid in semitopologies:
\begin{lemm}
\label{lemm.closure.interior}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If $O\in\opens$ is open then $O\subseteq\interior(\closure{O})$.  The inclusion may be strict.
\item
If $C\in\closed$ is closed then $\closure{\interior(C)}\subseteq C$.  The inclusion may be strict.
\end{enumerate*}
\end{lemm}
\begin{proof}
By routine calculations, as for topologies.
To see examples of the strict inclusion, consider $\mathbb R$ with the usual topology and:
\begin{enumerate*}
\item
$O=(0,1)\cup(1,2)$ is open and $O\subsetneq\interior(\closure{O})=(0,2)$.
\item
$C=\{0\}$ is closed and $\closure{\interior(C)}=\varnothing\subsetneq C$.
\qedhere\end{enumerate*}
\end{proof}




\subsection{Transitivity and closure}


We explore how the topological closure operation interacts with taking transitive sets.
\begin{lemm}
\label{lemm.open.consensus}
Suppose $(\ns P,\opens)$ is a semitopology and $T\subseteq\ns P$ is transitive and $O\in\opens$.
Then 
$$
\atopen\between O
\quad\text{implies}\quad
\closure{T}\subseteq\closure{O}.
$$
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.closure}
we have:
$$
\begin{array}{r@{\ }l}
p'\in\closure{T}\liff&\Forall{O'{\in}\opens}p'\in O'\limp O'\between \atopen 
\qquad\text{and}
\\
p'\in\closure{O}\liff&\Forall{O'{\in}\opens}p'\in O'\limp O'\between O
.
\end{array}
$$
It would suffice to prove $O'\between \atopen\limp O'\between O$ for any $O'\in\opens$.

So suppose $O'\between \atopen$.
By assumption $\atopen\between O$ and by transitivity of $\atopen$ (Definition~\ref{defn.transitive}) $O'\between O$.
\end{proof}


\begin{prop}
\label{prop.open.consensus}
\label{prop.open.strong-consensus}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\in\topens$ and $O\in\opens$.
Then the following are equivalent:
$$
\atopen\between O
\quad\text{if and only if}\quad
T\subseteq\closure{T}\subseteq \closure{O}
.
$$
\end{prop}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
Suppose $\atopen\between O$.
By Lemma~\ref{lemm.open.consensus} $\closure{T}\subseteq\closure{O}$.
By Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}) (as standard) $T\subseteq\closure{T}$. 
\item
Suppose $T\subseteq\closure{T}\subseteq\closure{O}$.
Then $\atopen\between\closure{O}$ and by Lemma~\ref{lemm.closure.open.char} (since $\atopen$ is nonempty (and transitive) and open) also $\atopen\between O$.
\qedhere\end{itemize}
\end{proof}


\begin{rmrk}
\label{rmrk.gradecast}
In retrospect we can see the imprint of topens (Definition~\ref{defn.transitive}) in previous work, if we look at things in a certain way.
Many consensus algorithms have the property that once consensus is established in a quorum $O$, it propagates to $\closure{O}$.

This is apparent (for example) in the Grade-Cast algorithm~\cite{feldman_optimal_1988}, in which participants assign a confidence grade of 0, 1 or 2 to their output and must ensure that if any participant outputs $v$ with grade 2 then all must output $v$ with grade at least 1.
In this algorithm, if a participant finds that all its quorums intersect some set $S$ that unanimously supports value $v$, then the participant assigns grade at least 1 to $v$.
From the view of our paper, this is just taking a closure in the style we discussed in Remark~\ref{rmrk.computing.closures}.
If $T$ unanimously supports $v$ and participants communicate enough, then eventually every member of $\closure{T}$ assigns grade at least 1 to $v$.
Thus, Proposition~\ref{prop.open.strong-consensus} suggests to that, to convince a topen to agree on a value, we can first convince an open neighbourhood that intersects the topen, and then use Grade-Cast to convince the whole topen. 
\end{rmrk}


\begin{rmrk}
Later on we will revisit these ideas and fit them into a nice general framework having to do with dense subsets.
See Lemma~\ref{lemm.strongly.dense.for.closure} and Proposition~\ref{prop.most.general}. 
\end{rmrk}

\subsection{Closed neighbourhoods and intertwined points}
\label{subsect.closed.neighbourhoods}

\begin{defn}
\label{defn.cn}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate*}
\item
Call $C\subseteq\ns P$ a \deffont{closed neighbourhood of $p\in\ns P$} when $C$ is closed and $p\in\interior(C)$.
\item
Call $C\subseteq\ns P$ a \deffont{closed neighbourhood} when $C$ is closed and $\interior(C)\neq\varnothing$.

In words: a closed neighbourhood is a closed set with a nonempty open interior.
\end{enumerate*} 
\end{defn}

\begin{rmrk}
\leavevmode
\begin{enumerate}
\item
If $C$ is a closed neighbourhood of $p$ in the sense of Definition~\ref{defn.cn}(1) then $C$ is a closed neighbourhood in the sense of Definition~\ref{defn.cn}(2), just because if $p\in\interior(C)$ then $\interior(C)\neq\varnothing$. 
\item
For $C$ to be a closed neighbourhood of $p$ it is not enough for $p\in C$.
We require $p\in\interior(C)$, which is a stronger condition.

For instance take the semitopology $\ns P=\{0,1,2\}$ and $\opens=\{\varnothing,\ns P,\{0\}, \{2\}\}$ from Figure~\ref{fig.012}, and consider $p=1$ and $C=\{0,1\}$.
Then $p\in C$ but $p\not\in\interior(C)=\{0\}$, so that $C$ is not a closed neighbourhood of $p$. 
\end{enumerate}
\end{rmrk}





Recall from Definition~\ref{defn.intertwined.points} the notions of $p\intertwinedwith p'$ and $\intertwined{p}$.
Proposition~\ref{prop.intertwined.as.closure} packages up our material for convenient use in later results. 
\begin{prop}
\label{prop.intertwined.as.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
Then:
\begin{enumerate*}
\item
We can characterise when $p'$ is intertwined with $p$ as follows: 
$$
p\intertwinedwith p' 
\quad\text{if and only if}\quad
\Forall{O{\in}\opens} p\in O\limp p'\in\closure{O} .
$$
\item\label{item.intertwined.as.intersection.of.closures}
As a corollary,
$$
\intertwined{p} = \bigcap\{\closure{O} \mid p\in O\in\opens\}.
$$
\item\label{intertwined.as.closure.closed}
Equivalently:
$$
\begin{array}{r@{\ }l@{\qquad}l}
\intertwined{p}
=& \bigcap\{C\in\closed \mid p\in \interior(C) \}
\\
=&
\bigcap\{C\in\tf{Closed} \mid C\text{ a closed neighbourhood of }p\}
&\text{Definition~\ref{defn.cn}}.
\end{array}
$$
Thus in particular, if $C$ is a closed neighbourhood of $p$ then $\intertwined{p}\subseteq C$.
\item\label{intertwined.p.closed}
$\intertwined{p}$ is closed and (by Lemma~\ref{lemm.closed.complement.open}(1)) $\ns P\setminus\intertwined{p}$ is open.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We just rearrange Definition~\ref{defn.intertwined.points}.
So
$$
\Forall{O,O'\in\opens}(p\in O\land p'\in O') \limp O\between O'
$$
rearranges to
$$
\Forall{O\in\opens}p\in O\limp \Forall{O'\in\opens} p'\in O' \limp O\between O' . 
$$
We now observe from Definition~\ref{defn.closure} that this is precisely
$$
\Forall{O\in\opens}p\in O\limp p'\in\closure{O} .
$$
\item
We just rephrase part~1 of this result.
\item
Using part~\ref{item.intertwined.as.intersection.of.closures} of this result it would suffice to prove
$$
\bigcap\{\closure{O}\mid p\in O\in\opens\} = \bigcap\{C\in\closed \mid p\in \interior(C) \} .
$$
We will do this by proving that for each $O$-component on the left there is a $C$ on the right with $C\subseteq\closure{O}$; and for each $C$-component on the right there is an $O$ on the left with $\closure{O}\subseteq C$:
\begin{itemize}
\item
Consider some $O\in\opens$ with $p\in O$.

We set $C=\closure{O}$, so that trivially $C\subseteq\closure{O}$.
By Lemma~\ref{lemm.closure.interior}(1) $O\subseteq\interior(\closure{O})$, so $p\in\interior(C)$.
\item
Consider some $C\in\closed$ such that $p\in\interior(C)$.

We set $O=\interior(C)$.
Then $p\in O$, and by Lemma~\ref{lemm.closure.interior}(2) $\closure{O}\subseteq C$.
\end{itemize}
\item
We combine part~\ref{item.intertwined.as.intersection.of.closures} of this result with Corollary~\ref{corr.closure.closure}(\ref{closure.closure.cap}).
\qedhere\end{enumerate}
\end{proof}




\begin{rmrk}
\label{rmrk.how.weakly.regular}
Recall that Theorem~\ref{thrm.max.cc.char} characterised regularity in multiple ways, including as the existence of a greatest topen neighbourhood. 
Proposition~\ref{prop.views.of.regularity} below does something similar, for weak regularity and the existence of closed neighbourhoods (Definition~\ref{defn.cn}).
We make a further connection in Theorem~\ref{thrm.up.down.char}.
\end{rmrk}

\begin{prop}
\label{prop.views.of.regularity}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is weakly regular, or in full: $p\in\community(p)$ (Definition~\ref{defn.tn}(3)).
\item
$\intertwined{p}$ is a closed neighbourhood of $p$ (Definition~\ref{defn.cn}(2)).
\item
The poset of closed neighbourhoods of $p$ ordered by subset inclusion, has a least element.
\item
$\intertwined{p}$ is least in the poset of closed neighbourhoods of $p$ ordered by subset inclusion.
\end{enumerate*}
\end{prop}
\begin{proof}
We prove a cycle of implications:
\begin{itemize}
\item
Suppose %If $p$ is regular then by Definition~\ref{defn.tn}(\ref{item.regular.point}) 
$p\in\interior(\intertwined{p})$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed, so this makes it a closed neighbourhood of $p$ as per Definition~\ref{defn.cn}.
\item
Suppose $\intertwined{p}$ is a closed neighbourhood of $p$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) 
$\intertwined{p}$ is the intersection of \emph{all} closed neighbourhoods of $p$, and it follows that this poset has $\intertwined{p}$ as a least element.
\item
Assume the poset of closed neighbourhoods of $p$ has a least element; write it $C$.
So $C=\bigcap\{C'\in\tf{Closed}\mid C'\text{ is a closed neighbourhood of }p\}$ and thus by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $C=\intertwined{p}$.
\item
If $\intertwined{p}$ is least in the poset of closed neighbourhoods of $p$ ordered by subset inclusion, then in particular $\intertwined{p}$ is a closed neighbourhood of $p$ and it follows from Definition~\ref{defn.cn} that $p\in\interior(\intertwined{p})$. 
\qedhere\end{itemize}
\end{proof}


Recall from Definition~\ref{defn.tn} that $\community(p)=\interior(\intertwined{p})$:
\begin{lemm}
\label{lemm.closure.community.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then $\closure{\community(p)}\subseteq\intertwined{p}$.
\end{lemm}
\begin{proof}
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed; we use Lemma~\ref{lemm.closure.interior}(2).
\end{proof}

\begin{thrm}
\label{thrm.pKp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ weakly regular then $\closure{\community(p)}=\intertwined{p}$.
In symbols:
$$
p\in\community(p)
\quad\text{implies}\quad \closure{\community(p)}=\intertwined{p}.
$$
\item
As an immediately corollary, if $p$ is regular then $\closure{\community(p)}=\intertwined{p}$.
\end{enumerate*}
\end{thrm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p\in\community(p)=\interior(\intertwined{p})$ then $\closure{\community(p)}$ is a closed neighbourhood of $p$, so by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{p}\subseteq\closure{\community(p)}$.
By Lemma~\ref{lemm.closure.community.subset} $\closure{\community(p)}\subseteq\intertwined{p}$.
\item
By Lemma~\ref{lemm.wr.r} if $p$ is regular then it is weakly regular.
We use part~1 of this result. 
\qedhere\end{enumerate}
\end{proof}



We can combine Theorem~\ref{thrm.pKp} with Corollary~\ref{corr.regular.is.regular}: 
\begin{corr}
\label{corr.corr.pKp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$p$ is weakly regular and $\intertwined{p}=\intertwined{p'}$ \ for every $p'\in\community(p)$.
\end{enumerate*} 
\end{corr}
\begin{proof}
Suppose $p$ is regular and $p'\in\community(p)$.
Then $p$ is weakly regular by Lemma~\ref{lemm.wr.r}(1), and $\community(p)=\community(p')$ by Corollary~\ref{corr.regular.is.regular}, and $\intertwined{p}=\intertwined{p'}$ by Theorem~\ref{thrm.pKp}.

Suppose $p$ is weakly regular and $\intertwined{p}=\intertwined{p'}$ for every $p'\in\community(p)$.
By Definition~\ref{defn.tn}(\ref{item.tn}) also $\community(p)=\interior(\intertwined{p})=\interior(\intertwined{p'})=\community(p')$ for every $p'\in\community(p)$, and by Corollary~\ref{corr.regular.is.regular} $p$ is regular.
\end{proof}

\begin{rmrk}
Note a subtlety to Corollary~\ref{corr.corr.pKp}: it is possible for $p$ to be regular, yet it is not the case that $\intertwined{p}=\intertwined{p'}$ for every $p'\in\intertwined{p}$ (rather than for every $p'\in\community(p)$).
For an example consider the top-left semitopology in Figure~\ref{fig.012}, taking $p=0$ and $p'=1$; then $1\in\intertwined{0}$ but $\intertwined{0}=\{0,1\}$ and $\intertwined{1}=\{0,1,2\}$.

To understand why this happens the interested reader can look ahead to Subsection~\ref{subsect.reg.tra.int}: in the terminology of that Subsection, $p'$ needs to be \emph{unconflicted} in Corollaries~\ref{corr.regular.is.regular} and~\ref{corr.corr.pKp}. 
\end{rmrk}

%%%%%%%%%%%%%%
\subsection{Intersections of communities with open sets}

We prove a pair of results that describe how communities intersect with open sets, then discuss in Remarks~\ref{rmrk.fundamental.consensus} and~\ref{rmrk.why.top.closure} why intersections of communities with open sets are interesting sets to consider: 
\begin{lemm}
\label{lemm.regular.between}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular (so $p\in\community(p)\in\topens$).
Suppose $O\in\opens$.
Then
$$
p\in O\between \community(p)
\quad\text{implies}\quad 
\community(p)\subseteq\intertwined{p}\subseteq\closure{O}.
$$
In word:
\begin{quote}
If an open set intersects the community of a regular point, then that community is included in the closure of the open set.
\end{quote}
\end{lemm}
\begin{proof}
Suppose $p$ is regular, so $p\in\community(p)\in\topens$, and suppose $p\in O\between\community(p)$.
By Proposition~\ref{prop.open.strong-consensus} $\community(p)\subseteq\closure{\community(p)}\subseteq\closure{O}$.
By Theorem~\ref{thrm.pKp} $\closure{\community(p)}=\intertwined{p}$, and putting this together we get 
$$
\community(p)\subseteq\intertwined{p}\subseteq\closure{O}
$$ 
as required.
\end{proof}



Proposition~\ref{prop.regular.closure} generalises Theorem~\ref{thrm.pKp}, and is proved using it.
We regain Theorem~\ref{thrm.pKp} as the special case where $O=\community(p)$: 
\begin{prop}
\label{prop.regular.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is weakly regular (so $p\in\community(p)\in\opens$).
Suppose $O\in\opens$.
Then:
\begin{enumerate*}
\item
$p\in O\subseteq\community(p)$ implies
$\intertwined{p}=\closure{O}$.
\item
As a corollary, $p\in O\subseteq\intertwined{p}$ implies
$\intertwined{p}=\closure{O}$.
\end{enumerate*}
\end{prop}
\begin{proof}
If $p\in O\subseteq\community(p)$ then $p\in\community(p)$ and using Theorem~\ref{thrm.pKp} $\closure{\community(p)}\subseteq\intertwined{p}$.
Since $O\subseteq\community(p)$ also $\closure{O}\subseteq\intertwined{p}$.
Also, by Proposition~\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures}) (since $p\in O\in\opens$) $\intertwined{p}\subseteq\closure{O}$.

For the corollary, we note that if $O$ is open then $O\subseteq\interior(\intertwined{p})=\community(p)$ if and only if $O\subseteq\intertwined{p}$.
\end{proof}


\begin{rmrk}
Note in Proposition~\ref{prop.regular.closure} that it really matters that $p\in O$ --- that is, that $O$ is an open neighbourhood \emph{of $p$} and not just an open set in $\intertwined{p}$.

To see why, consider the example in Lemma~\ref{lemm.two.intertwined} (illustrated in Figure~\ref{fig.012}, left-hand diagram): so $\ns P=\{0,1,2\}$ and $\opens=\{\varnothing,\ns P,\{0\},\{2\}\}$.
Note that:
\begin{itemize*}
\item
$\intertwined{1}=\{0,1,2\}$.
\item
If we set $O=\{0\}\subseteq\{0,1,2\}$ then this is open, but $\closure{O}=\{0,1\}\neq\{0,1,2\}$.
\item
If we set $O=\{0,1,2\}\subseteq\{0,1,2\}$ then $\closure{O}=\{0,1,2\}$.
\end{itemize*}
\end{rmrk}


\begin{rmrk}[An observation about consensus]
\label{rmrk.fundamental.consensus}
Proposition~\ref{prop.regular.closure} and Lemma~\ref{lemm.regular.between} tell us some interesting and useful things about distributed consensus from a semitopological perspective:
\begin{itemize*}
\item
Suppose a weakly regular $p$ wants to convince its community $\community(p)$ of some belief.
How might it proceed?

By Proposition~\ref{prop.regular.closure} it would suffice to seed one of the open neighbourhoods in its community with that belief, and then compute a topological closure of that open set --- we explain why topological closures matter in a moment.
\item
Suppose $p$ is regular, so it is a member of a transitive open neighbourhood, and $p$ wants to convince its community $\community(p)$ of some belief.

By Lemma~\ref{lemm.regular.between} $p$ need only convince \emph{some} open set that intersects its community (this open set need not even contain $p$), and then compute a topological closure as in the previous point.
\end{itemize*}
\end{rmrk}



\begin{rmrk}
\label{rmrk.why.top.closure}
Topological closures will matter because we will develop a theory of computable semitopologies which will (amongst other things) deliver a distributed algorithm to compute closures (see Remark~\ref{rmrk.computing.closed.sets}).

Thus, putting together the results above with the witness semitopology machinery to come in Definition~\ref{defn.trust.topology} onwards, we can say that from the point of view of a regular participant $p$, Proposition~\ref{prop.regular.closure} and Lemma~\ref{lemm.regular.between} reduce the problem of attaining distributed consensus to the simpler problem of finding an open set that intersects with the community of $p$ (and convincing that open set to agree with $p$ on some belief).
Once this is done, the distributed algorithm will propagate the belief across the network.

Note that no forking is possible above; all the action is in finding and convincing the $O\between \community(p)$, and then the rest is automatic.

More discussion of this when we develop the notion of a \emph{kernel} in Section~\ref{sect.kernels}.
\end{rmrk}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Regularity, maximal topens, and minimal closed neighbourhoods}

\begin{rmrk}
\label{rmrk.arc}
Recall we have seen an arc of results which 
\begin{itemize*}
\item
started with Theorem~\ref{thrm.max.cc.char} and Corollary~\ref{corr.regular.is.regular} --- characterisations of regularity $p\in\community(p)\in\topens$ in terms of maximal topens --- and 
\item
passed through Proposition~\ref{prop.views.of.regularity} --- characterisation of weak regularity $p\in\community(p)\in\opens$ in terms of minimal closed neighbourhoods.
\end{itemize*}
We are now ready to complete this arc by stating and proving Theorem~\ref{thrm.up.down.char}.
This establishes a pleasing --- and not-at-all-obvious --- duality between `has a maximal topen neighbourhood' and `has a minimal closed neighbourhood'.
\end{rmrk}

\begin{thrm}
\label{thrm.up.down.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$\community(p)$ is a maximal/greatest topen neighbourhood of $p$.
\item
$p$ is weakly regular and $\intertwined{p}$ is a minimal closed neighbourhood (Definition~\ref{defn.cn}).\footnote{We really do mean ``$\intertwined{p}$ is minimal amongst closed neighbourhoods'' and \emph{not} the weaker condition ``$\intertwined{p}$ is minimal amongst closed neighbourhoods of $p$''!  That weaker condition is treated in Proposition~\ref{prop.views.of.regularity}.  See Remark~\ref{rmrk.don't.misread}.}
\end{enumerate*}
\end{thrm}
\begin{proof}
Equivalence of parts~1 and~2 is just Theorem~\ref{thrm.max.cc.char}(2).

For equivalence of parts~2 and~3 we prove two implications:
\begin{itemize}
\item
Suppose $p$ is regular.
By Lemma~\ref{lemm.wr.r}(1) $p$ is weakly regular.
Now consider a closed neighbourhood $C'\subseteq \intertwined{p}$.
Note that $C'$ has a nonempty interior by Definition~\ref{defn.cn}(2), so pick any $p'$ such that
$$
p'\in\interior(C')\subseteq C'\subseteq\intertwined{p} .
$$
It follows that $p'\in\community(p)=\interior(\intertwined{p})$, and $p$ is regular, so by Corollary~\ref{corr.corr.pKp} $\intertwined{p'}=\intertwined{p}$, 
and then by Proposition~\ref{prop.views.of.regularity}(\ref{intertwined.as.closure.closed}) (since $p'\in C'$) $\intertwined{p'}\subseteq C'$.
Putting this all together we have
$$
\intertwined{p}=\intertwined{p'} \subseteq C' \subseteq\intertwined{p},
$$
so that $C'=\intertwined{p}$ as required.
\item
Suppose $p$ is weakly regular and suppose $\intertwined{p}$ is minimal in the poset of closed neighbourhoods ordered by subset inclusion.

Consider some $p'\in\community(p)$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{p'}\subseteq\intertwined{p}$, and by minimality it follows that $\intertwined{p'}=\intertwined{p}$.
Thus also $\community(p')=\community(p)$.

Now $p'\in\community(p)$ was arbitrary, so by Corollary~\ref{corr.regular.is.regular} $p$ is regular as required.  
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
\label{rmrk.indeed.two.closed.neighbourhoods}
Recall Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b}), as illustrated in Figure~\ref{fig.irregular} (right-hand diagram).
This has a point $0$ whose community $\community(0)=\{1,2\}$ is not a single topen (it contains two topens: $\{1\}$ and $\{2\}$).

A corollary of Theorem~\ref{thrm.up.down.char} is that $\intertwined{0}=\{0,1,2\}$ cannot be a minimal closed neighbourhood, because if it were then $0$ would be regular and $\community(0)$ would be a maximal topen neighbourhood of $0$.

We check, and see that indeed, $\intertwined{0}$ contains \emph{two} distinct minimal closed neighbourhoods: $\{0,1\}$ and $\{0,2\}$.
\end{rmrk}

\begin{rmrk}
\label{rmrk.don't.misread}
Theorem~\ref{thrm.up.down.char}(3) looks like Proposition~\ref{prop.views.of.regularity}(4), but
\begin{itemize*}
\item
Proposition~\ref{prop.views.of.regularity}(4) regards the \emph{poset of closed neighbourhoods of $p$} (closed sets with a nonempty open interior that contains $p$),
\item
Theorem~\ref{thrm.up.down.char}(3) regards the \emph{poset of all closed neighbourhoods} (closed sets with a nonempty open interior, not necessarily including $p$).
\end{itemize*}
So the condition used in Theorem~\ref{thrm.up.down.char}(3) is strictly stronger than the condition used in Proposition~\ref{prop.views.of.regularity}(4).
Correspondingly, the regularity condition in Theorem~\ref{thrm.up.down.char}(1) can be written as $p\in\community(p)\in\topens$, and (as noted in Lemma~\ref{lemm.wr.r} and Example~\ref{xmpl.wr}(2)) this is strictly stronger than the condition $p\in\community(p)$ used in Proposition~\ref{prop.views.of.regularity}(1). 
\end{rmrk}




Corollary~\ref{corr.anti-hausdorff} makes Remark~\ref{rmrk.not.hausdorff} (intertwined is the opposite of Hausdorff) a little more precise:
\begin{corr}
\label{corr.anti-hausdorff}
Suppose $(\ns P,\opens)$ is a Hausdorff semitopology (so every two points have a pair of disjoint neighbourhoods).
Then if $p\in\ns P$ is regular, then $\{p\}$ is clopen.
\end{corr}
\begin{proof}
Suppose $\ns P$ is Hausdorff and consider $p\in \ns P$.
By Remark~\ref{rmrk.not.hausdorff} $\intertwined{p}=\{p\}$. 
From Theorem~\ref{thrm.up.down.char}(3) $\{p\}$ is closed and has a nonempty open interior which must therefore also be equal to $\{p\}$.
By Corollary~\ref{corr.when.singleton.topen} (or from Theorem~\ref{thrm.up.down.char}(2)) this interior is transitive.
\end{proof}


\begin{prop}
\label{prop.max.topen.min.closed}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
Every maximal topen is equal to the interior of a minimal closed neighbourhood.
\item
The converse implication holds if $(\ns P,\opens)$ is a topology, but need not hold in the more general case that $(\ns P,\opens)$ is a semitopology: there may exist a minimal closed neighbourhood whose interior is not topen.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $\atopen$ is a maximal topen.
By Definition~\ref{defn.transitive}(\ref{transitive.cc}) $\atopen$ is nonempty, so choose $p\in \atopen$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed, and using Theorem~\ref{thrm.max.cc.char} 
$$
p\in \atopen=\community(p)=\interior(\intertwined{p})\subseteq\intertwined{p}.
$$
Thus $p$ is weakly regular and by Proposition~\ref{prop.views.of.regularity}(1\&4) $\intertwined{p}$ is a least closed neighbourhood of $p$.
\item
It suffices to provide a counterexample.
This is Example~\ref{xmpl.not.intertwined} below.
However, we also provide here a breaking `proof', which throws light on precisely what Example~\ref{xmpl.not.intertwined} is breaking, and illustrates what the difference between semitopology and topology can mean in practical proof.

Suppose $\atopen$ is the nonempty open interior of a minimal closed neighbourhood $C$: we will try (and fail) to show that this is transitive.
By Theorem~\ref{thrm.cc.char} it suffices to prove that $p\intertwinedwith p'$ for every $p,p'\in \atopen$.

So suppose $p\in O$ and $p'\in O'$ and $\neg(O\between O')$.
Since $p'\not\in\closure{O}$, we know that $\closure{O}\cap C\subseteq C$ is a strictly smaller closed set.
Also, $O\cap\f{closure}(C)$ is nonempty because it contains $p$.

If $(\ns P,\opens)$ is a topology then we are done, because $O\cap\interior(C)$ would be necessarily open, contradicting our assumption that $C$ is a minimal closed neighbourhood. 

However, if $(\ns P,\opens)$ is a semitopology then this does not necessarily follow: $O\cap\interior(C)$ need not be open, and we cannot proceed.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.4\columnwidth]{diagrams/square-diagram.pdf}
\vspace{-2em}
\caption{An unconflicted, irregular space (Proposition~\ref{prop.unconflicted.irregular}) in which every minimal closed set has a non-transitive open interior (Example~\ref{xmpl.not.intertwined})}
\label{fig.square.diagram}
\end{figure}


\begin{xmpl}
\label{xmpl.not.intertwined}
We give an example of a semitopology with a set that is minimal amongst closed sets with a nonempty interior, yet that interior is not topen.
Note the example semitopology in Figure~\ref{fig.square.diagram}:
\begin{itemize}
\item
$\ns P = \{0, 1, 2, 3\}$.
\item
$\opens$ is generated by $\{A,B,C,D\}$ where: 
$$
A=\{0, 2\}, 
\quad
B=\{0, 1\},
\quad
C=\{2, 3\},
\quad\text{and}\quad
D=\{1, 3\}.
$$
\end{itemize}
We now note that:
\begin{itemize*}
\item
$A$, $B$, $C$, and $D$ are clopen, because $D$ is the complement of $A$ and $C$ is the complement of $B$, so they are their own interior.
\item
$A$ is a minimal closed neighbourhood (which is also open, being $A$ itself), because 
\begin{itemize*}
\item
$A=\{0, 2\}$ is closed because it is the complement of $D$, and it is its own interior, and 
\item
its two nonempty subsets $\{0\}$ and $\{2\}$ are closed (being the complement of $C\cup D$ and $B\cup D$ respectively) but they have empty open interior because $\{0\}$ and $\{2\}$ are not open.
\end{itemize*} 
\item
$A$ is not transitive because $0$ and $2$ are not intertwined: $0\in B$ and $2\in C$ and $B\cap C=\varnothing$.
\item
Similarly $B$, $C$, and $D$ are minimal closed neighbourhoods, which are also open, and they are not transitive.
\end{itemize*}
We further note that:
\begin{itemize*}
\item
$\closure{0}=\{0\}$, because its complement is equal to $C\cup D$ (Definition~\ref{defn.closure}; Lemma~\ref{lemm.closed.complement.open}).
\item
$\intertwined{0}=\{0\}$, because $A$ and $B$ are not transitive (Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn})).
\item
$\community(0)=\interior(\intertwined{0})=\varnothing$, so $0$ is not regular (Definition~\ref{defn.tn}(\ref{item.tn})).
\item
$0$ has \emph{two} minimal closed neighbourhoods: $A$ and $B$.
\end{itemize*}
This illustrates that $\intertwined{p}\subsetneq C$ is possible, where $C$ is a minimal closed neighbourhood of $p$.
\end{xmpl}



\begin{rmrk}
The results and discussions above tell us something interesting above and beyond the specific mathematical facts which they express.

They demonstrate that points being intertwined (the $p\intertwinedwith p'$ from Definition~\ref{defn.intertwined.points}) is a distinct \emph{semitopological} notion. 
A reader familiar with topology might be tempted to identify maximal topens with interiors of minimal closed neighbourhood (so that in view of Theorem~\ref{thrm.cc.char}, being intertwined would be topologically characterised just as two points being in the interior of the same minimal closed neighbourhood).

This works in topologies, but we see from Example~\ref{xmpl.not.intertwined} that in semitopologies being intertwined has its own distinct identity.
\end{rmrk}

We conclude with one more example:
\begin{xmpl}
\label{xmpl.two.topen.examples}
\leavevmode
\begin{enumerate*}
\item
$\mathbb Q^2$ with open sets generated by any covering collection of pairwise non-parallel \deffont{rational lines} --- meaning a set of solutions to a linear equation $a.x\plus b.y=c$ for $a$, $b$, and $c$ integers --- is a semitopology.

This consists of a single (maximal) topen: lines are pairwise non-parallel, so any two lines intersect and (looking to Theorem~\ref{thrm.cc.char}) all points are intertwined.
There is only one closed set with a nonempty open interior, which is the whole space.
\item
$\mathbb Q^2$ with open sets generated by all (possibly parallel) rational lines, is a semitopology.
It has no topen sets and (looking to Theorem~\ref{thrm.cc.char}) no two distinct points are intertwined.

For any line $l$, its complement $\mathbb Q^2\setminus l$ is a closed set, given by the union of all the lines parallel to $l$.
Thus every closed set is also an open set, and vice versa, and every line $l$ is an example of a minimal closed neighbourhood (itself), whose interior is not a topen. 
\end{enumerate*}
\end{xmpl}



%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{How are $\intertwined{p}$ and $\closure{p}$ related?}

\begin{rmrk}
\label{rmrk.re-read.closure}
Recall the definitions of $\intertwined{p}$ and $\closure{p}$:
\begin{itemize*}
\item
The set $\closure{p}$ is the \emph{closure} of $p$.

By Definition~\ref{defn.closure} this is the set of $p'$ such that every open neighbourhood $p'\in O'$ intersects with $\{p\}$.
By Definition~\ref{defn.closed} $\closure{p}$ is closed.
\item
The set $\intertwined{p}$ is the set of points \emph{intertwined} with $p$.

By Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}) this is the set of $p'$ such that every open neighbourhood $O'\ni p'$ intersects with every open neighbourhood $O \ni p$. 
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed.
\end{itemize*}
This invites a question: 
\begin{quote}
How are $\intertwined{p}$ and $\closure{p}$ related?
\end{quote}
In this section we develop answers. 
\end{rmrk}

We start with an easy lemma which rephrases Remark~\ref{rmrk.re-read.closure} more precisely by looking at it through sets complements:
\begin{lemm}
\label{lemm.char.not.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\ns P\setminus\closure{p} = \bigcup \{O\in\opens \mid p\not\in O\}\in\opens$.

In words: $\ns P\setminus\closure{p}$ is the union of the {\bf open} sets that avoid $p$.
\item
$\ns P\setminus\intertwined{p} = \bigcup\{C\in\closed \mid p\not\in C\}\in\opens$.

In words: $\ns P\setminus\intertwined{p}$ is the union of the {\bf closed} sets that avoid $p$.
\end{enumerate*}
\end{lemm} 
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Immediate from Definition~\ref{defn.closure}.\footnote{A longer proof via Corollary~\ref{corr.closure.closure}(3) and Lemma~\ref{lemm.closed.complement.open} is also possible.}
Openness is from Definition~\ref{defn.semitopology}(\ref{semitopology.unions}).
\item
We reason as follows using Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}):
$$
\ns P\setminus\intertwined{p} = \bigcup \{\ns P\setminus \closure{O} \mid p\in O\} = \bigcup\{C\in\closed \mid p\not\in C\}.
$$
Openness is % follows from %since $\intertwined{p}$ is closed by 
Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}).
\qedhere\end{enumerate}
\end{proof}

\begin{prop}
\label{prop.closure.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\closure{p}\subseteq \intertwined{p}$.
\item
The subset inclusion may be strict; that is, $\closure{p}\subsetneq\intertwined{p}$ is possible --- even if $p$ is regular (Definition~\ref{defn.tn}(\ref{item.regular.point})).
\item
If $\interior(\closure{p})\neq\varnothing$ (so $\closure{p}$ has a nonempty interior)
then 
$\closure{p}=\intertwined{p}$.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We reason as follows:
$$
\begin{array}{r@{\ }l@{\quad}l}
\closure{p}=&
\closure{\{p\}}
&\text{Definition~\ref{defn.closure}(\ref{item.closure.p})}
\\
=&
\bigcap\{C\in\closed \mid p\in C\}
&\text{Corollary~\ref{corr.closure.closure}(\ref{item.closure.as.intersection})}
\\
\subseteq&
\bigcap\{C\in\closed \mid p\in\interior(C)\}
&\text{Fact of intersections}
\\
=&
\intertwined{p} 
&\text{Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed})}
\end{array}
$$
\item
Example~\ref{xmpl.closure.101} below shows that $\closure{p}\subsetneq\intertwined{p}$ is possible for $p$ regular. 
\item
Write $O=\interior(\closure{p})$.
By standard topological reasoning, $\closure{p}$ is the complement of the union of the open sets that do not contain $p$, and $O=\interior(\closure{p})$ is the greatest open set such that $\Forall{O'{\in}\opens}O\between O'\limp p\in O'$.  
We assumed that $O$ is nonempty, so $O\between O$, thus $p\in O$.

Then by part~1 of this result $p\in O\subseteq\closure{p}\subseteq\intertwined{p}$, and by Proposition~\ref{prop.regular.closure}(2) $\intertwined{p}=\closure{O}$.
Using more standard topological reasoning (since $O\neq\varnothing$) $\closure{O}=\closure{p}$, and the result follows.
\qedhere\end{enumerate}
\end{proof}


\begin{xmpl}
\label{xmpl.closure.101}
Take $\ns P=\{0,1\}$ and $\opens=\{\varnothing,\{0\},\{0,1\}\}$.
Then:
\begin{itemize*}
\item
$\closure{1}=\{1\}$ (because $\{0\}$ is open), but
\item
$\intertwined{1}=\{0,1\}$ (because every open neighbourhood of $1$ intersects with every open neighbourhood of $0$). 
\end{itemize*}
Thus we see that $\closure{1}=\{1\}\subsetneq\{0,1\}=\intertwined{1}$, and $1$ is regular since $1\in\interior(\intertwined{1})=\{0,1\}\in\topens$.
\end{xmpl}

\begin{rmrk}
We have one loose end left.
We know from Theorem~\ref{thrm.up.down.char}(3) that $\intertwined{p}$ is a minimal closed neighbourhood (closed set with nonempty open interior) when $p$ is regular. 
We also know from Proposition~\ref{prop.closure.intertwined} that $\closure{p}\subsetneq\intertwined{p}$ is possible, even if $p$ is regular.

So a closed \emph{neighbourhood} in between $\closure{p}$ and $\intertwined{p}$ is impossible by minimality, but can there be any closed sets (not necessarily having a nonempty open interior) in between $\closure{p}$ and $\intertwined{p}$?

Somewhat counterintuitively perhaps, this is possible: 
\end{rmrk}

\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then it is possible for there to exist a closed set $C\subseteq\ns P$ with $\closure{p}\subsetneq C\subsetneq\intertwined{p}$, even if $p$ is regular.
\end{lemm}
\begin{proof}
It suffices to provide an example.
Consider $\mathbb N$ with the semitopology whose open sets are generated by 
\begin{itemize*}
\item
final segments $n_\geq=\{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$ (cf. Example~\ref{xmpl.meet-irreducible}(\ref{item.final.N})), and 
\item
$\{0,1,2,3,4,5,6,7,8,9\}$.
\end{itemize*} 
The reader can check that $\closure{0}=\{0\}$ and $\intertwined{0}=\{0,1,2,3,4,5,6,7,8,9\}$.
However, there are also eight closed sets $\{0,1\}$, $\{0,1,2\}$, \dots, $\{0,1,2,3,\dots,8\}$ in between $\closure{0}$ and $\intertwined{0}$. 
\end{proof}

We will study $\intertwined{p}$ further but to make more progress we need the notion of a(n un)conflicted point.
This is an important idea in its own right and gets its own Section:


\section{(Un)conflicted points: transitivity of $\intertwinedwith$}
\label{sect.unconflicted.point}

\subsection{The basic definition} 
\label{subsect.reg.tra.int}

In Lemma~\ref{lemm.intertwined.not.transitive} we asked whether the `is intertwined with' relation $\intertwinedwith$ from Definition~\ref{defn.intertwined.points}(1) is transitive --- answer: not necessarily.

Transitivity of $\intertwinedwith$ is a natural condition.
We now have enough machinery to study it in more detail, and this will help us gain a deeper understanding of the properties of not-necessarily-regular points. 

\begin{defn}
\label{defn.conflicted}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate*}
\item
Call a point $p$ \deffont{conflicted} when there exist $p'$ and $p''$ such that $p'\intertwinedwith p$ and $p\intertwinedwith p''$ yet $\neg(p'\intertwinedwith p'')$.
\item\label{item.unconflicted}
If $p'\intertwinedwith p\intertwinedwith p''$ implies $p'\intertwinedwith p''$ always, then call $p$ \deffont{unconflicted}.
\item
Continuing Definition~\ref{defn.tn}(\ref{item.regular.S}), if $P\subseteq\ns P$ and every $p\in P$ is conflicted/unconflicted, then we may call $P$ \deffont{conflicted/unconflicted} respectively. 
\end{enumerate*}
\end{defn}

\begin{xmpl}
We consider some examples:
\begin{enumerate*}
\item
In Figure~\ref{fig.012} top-left diagram, $0$ and $2$ are unconflicted and intertwined with themselves, and $1$ is conflicted (being intertwined with $0$, $1$, and $2$).

If the reader wants to know what a conflicted point looks like: it looks like $1$. 
\item 
In Figure~\ref{fig.012} top-right diagram, $0$ and $2$ are unconflicted and intertwined with themselves, and $1$ is conflicted (being intertwined with $0$, $1$, and $2$).
\item
In Figure~\ref{fig.012} lower diagram, $0$ and $1$ are unconflicted and intertwined with themselves, and $3$ and $4$ are unconflicted and intertwined with themselves, and $2$ is conflicted (being intertwined with $0$, $1$, $2$, $3$, and $4$).
\item
In Figure~\ref{fig.square.diagram}, all points are unconflicted and intertwined only with themselves.
\end{enumerate*}
\end{xmpl}

So $p$ is conflicted when it witnesses a counterexample to $\intertwinedwith$ being transitive.
We start with a key lemma:
\begin{lemm}
\label{lemm.unconflicted.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is unconflicted.
\item\label{item.unconflicted.p.in.q}
If $q\in\ns P$ and $p\in\intertwined{q}$ then $\intertwined{p}\subseteq\intertwined{q}$. 
\item\label{item.p'.in.unconflicted.p}
$\intertwined{p}\subseteq\intertwined{p'}$ for every $p'\in\intertwined{p}$.
\item\label{item.unconflicted.as.least}
$\intertwined{p}$ is least in the set $\{\intertwined{p'}\mid p\intertwinedwith p'\}$ ordered by subset inclusion.
\end{enumerate*}
\end{lemm}
\begin{proof}
The proof is just by pushing definitions around in a cycle of implications.
\begin{itemize}
\item
\emph{Part~1 implies part~\ref{item.unconflicted.p.in.q}.}

Suppose $p$ is unconflicted.
Consider $q\in\ns P$ such that $p\in\intertwined{q}$, and consider any $p'\in\intertwined{p}$.
Unpacking definitions we have that $p'\intertwinedwith p\intertwinedwith q$ and so $p'\intertwinedwith q$, thus $p'\in\intertwined{q}$ as required.
\item
\emph{Part~\ref{item.unconflicted.p.in.q} implies part~\ref{item.p'.in.unconflicted.p}.}

From the fact that $p'\in\intertwined{p}$ if and only if $p'\intertwinedwith p$ if and only if $p\in\intertwined{p'}$.
\item
\emph{Part~\ref{item.p'.in.unconflicted.p} implies part~\ref{item.unconflicted.as.least}.}

Part~4 just rephrases part~3.
\item
\emph{Part~\ref{item.unconflicted.as.least} implies part~1.}

Suppose $\intertwined{p}$ is $\subseteq$-least in $\{\intertwined{p'}\mid p\intertwinedwith p'\}$ and suppose $p''\intertwinedwith p\intertwinedwith p'$.
Then $p''\in\intertwined{p}\subseteq\intertwined{p'}$, so $p''\intertwinedwith p'$ as required.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
Lemma~\ref{lemm.unconflicted.char} is just an exercise in reformulating definitions, but part~\ref{item.unconflicted.as.least} of the result helps us to contrast the property of being unconflicted, with structurally similar %but mathematically more sophisticated (and less obvious) 
characterisations of \emph{weak regularity} and of \emph{regularity} in Proposition~\ref{prop.views.of.regularity} and Theorem~\ref{thrm.up.down.char} respectively.
For the reader's convenience we collect them here --- all sets below are ordered by subset inclusion:
\begin{enumerate}
\item
$p$ is unconflicted when \emph{$\intertwined{p}$ is least in $\{\intertwined{p'}\mid p\intertwinedwith p'\}$}. 
\item
$p$ is weakly regular when \emph{$\intertwined{p}$ is least amongst closed neighbourhoods of $p$}.

See Proposition~\ref{prop.views.of.regularity} and recall from Definition~\ref{defn.cn} that a closed neighbourhood of $p$ is a closed set $C$ such that $p\in\interior(C)$.
\item 
$p$ is regular when \emph{$\intertwined{p}$ is a closed neighbourhood of $p$ and minimal amongst all closed neighbourhoods}.

See Theorem~\ref{thrm.up.down.char} and recall that a closed neighbourhood is any closed set with a nonempty interior (not necessarily containing $p$).
\end{enumerate}
We know from Lemma~\ref{lemm.wr.r} that regular implies weakly regular. 
We now consider how these properties relate to being unconflicted.
\end{rmrk}

\begin{prop}
\label{prop.unconflicted.irregular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item\label{item.reg.implies.unconflicted}
If $p$ is regular then it is unconflicted.

Equivalently by the contrapositive: if $p$ is conflicted then it is not regular.
\item
$p$ may be unconflicted and neither weakly regular nor regular.
\item
There exists a semitopological space such that 
\begin{itemize*}
\item
every point is unconflicted --- so $\intertwinedwith$ is a transitive relation --- yet 
\item
every point is irregular and not weakly regular (so there are no regular points and no weakly regular points).\footnote{See also Proposition~\ref{prop.conflicted.weakly.regular}.}
\end{itemize*}
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
So consider $q\intertwinedwith p \intertwinedwith q'$.
We must show that $q\intertwinedwith q'$, so consider open neighbourhoods $Q\ni q$ and $Q'\ni q'$.
By assumption $p$ is regular, so unpacking Definition~\ref{defn.tn}(\ref{item.regular.point}) $\community(p)$ is a topen (transitive and open) neighbourhood of $p$.
By assumption $Q\between \community(p)\between Q'$, and by transitivity of $\community(p)$ (Definition~\ref{defn.transitive}(\ref{transitive.transitive})) we have $Q\between Q'$ as required.
\item
Consider the semitopology illustrated in Figure~\ref{fig.square.diagram}.
Note that the point $0$ is not conflicted (because it is not intertwined with any other point), but it is also neither weakly regular nor regular, because its community is the empty set. 
See also Example~\ref{xmpl.boundary.examples}. 
\item
As for the previous part, noting that the same holds of points $1$, $2$, and $3$ in Figure~\ref{fig.square.diagram}.
\qedhere\end{enumerate}
\end{proof}

We can combine Proposition~\ref{prop.unconflicted.irregular} with a previous result Lemma~\ref{lemm.wr.r} to get a precise and attractive relation between being 
\begin{itemize*}
\item
regular (Definition~\ref{defn.tn}(\ref{item.regular.point})), 
\item
weakly regular (Definition~\ref{defn.tn}(\ref{item.weakly.regular.point})), and 
\item
unconflicted (Definition~\ref{defn.conflicted}), 
\end{itemize*}
as follows:
\begin{thrm}
\label{thrm.r=wr+uc}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$p$ is regular.
\item
$p$ is weakly regular and unconflicted.
\end{itemize*}
More succinctly we can write: \emph{regular = weakly regular + unconflicted}.
\end{thrm}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
If $p$ is regular then it is weakly regular by Lemma~\ref{lemm.wr.r} and unconflicted by Proposition~\ref{prop.unconflicted.irregular}(1). 
\item
Suppose $p$ is weakly regular and unconflicted.
By Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) $p\in\community(p)$ and by Lemma~\ref{lemm.three.transitive}(3) it would suffice to show that $q\intertwinedwith q'$ for any $q,q'\in\community(p)$.

So consider $q,q'\in\community(p)$.
Now by Definition~\ref{defn.tn}(\ref{item.tn}) $\community(p)=\interior(\intertwined{p})$ so in particular $q,q'\in\intertwined{p}$.
Thus $q\intertwinedwith p\intertwinedwith q'$, and since $p$ is unconflicted $q\intertwinedwith q'$ as required.
\qedhere\end{itemize}
\end{proof}


We can use Theorem~\ref{thrm.r=wr+uc} to derive simple global well-behavedness conditions on spaces, as follows: 
\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If the $\intertwinedwith$ relation is transitive (i.e. if every point is unconflicted) then a point is regular if and only if it is weakly regular.
\item
If every point is weakly regular (i.e. if $p\in\community(p)$ always) then a point is regular if and only if it is unconflicted.
\end{enumerate*} 
\end{corr}
\begin{proof}
Immediate from Theorem~\ref{thrm.r=wr+uc}. 
\end{proof}




\subsection{The boundary of $\intertwined{p}$}
\label{subsect.boundary.intertwined}

In this short Subsection we ask what points on the topological boundary of $\intertwined{p}$ can look like:
\begin{nttn}
\label{nttn.boundary}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
\begin{enumerate*}
\item
As standard, we define 
$$
\f{boundary}(P) = P\setminus\interior(P)
$$ 
and we call this the \deffont{boundary} of $P$.
\item
In the case that $P=\intertwined{p}$ for $p\in\ns P$ then 
$$
\f{boundary}(\intertwined{p})=\intertwined{p}\setminus\interior(\intertwined{p})=\intertwined{p}\setminus\community(p).
$$
\end{enumerate*}
\end{nttn}


Points in the boundary of $\intertwined{p}$ are \emph{not} regular points:
\begin{prop}
\label{prop.boundary.points.not.regular}
\label{prop.char.boundary}
Suppose $(\ns P,\opens)$ is a semitopology and $p,q\in\ns P$ and $q\in\intertwined{p}$.
Then:
\begin{enumerate*}
\item
If $q$ is regular then $q\in\community(p)=\interior(\intertwined{p})$.
\item
If $q$ is regular then $q\not\in\boundary(\intertwined{p})$.
\item
If $q\in\boundary(\intertwined{p})$ then $q$ is either conflicted or not weakly regular (or both).
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $q$ is regular.
By Theorem~\ref{thrm.r=wr+uc} $q$ is unconflicted, so that by Lemma~\ref{lemm.unconflicted.char}(\ref{item.p'.in.unconflicted.p}) $\intertwined{q}\subseteq\intertwined{p}$; and also $q$ is weakly regular, so that $q\in\community(q)\in\opens$ and $\community(q)\subseteq\intertwined{q}\subseteq\intertwined{p}$.
Thus $\community(q)$ is an open neighbourhood of $q$ that is contained in $\intertwined{p}$ and thus $q\in\interior(\intertwined{p})$ as required.
\item
This just repeats part~2 of this result, bearing in mind from Notation~\ref{nttn.boundary} that $q\in\boundary(\intertwined{p})$ if and only if $q\not\in\interior(\intertwined{p})$.
\item
This is just the contrapositive of part~2, combined with Theorem~\ref{thrm.r=wr+uc}.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/counterexample-1.pdf}
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/012a.pdf}
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/conflicted-and-not-wr-2.pdf}
\caption{Examples of boundary points (Example~\ref{xmpl.boundary.examples}).}
\label{fig.boundaries}
\end{figure}


\begin{xmpl}
\label{xmpl.boundary.examples}
Proposition~\ref{prop.char.boundary}(3) tells us that points on the topological boundary of $\intertwined{p}$ are either conflicted, or not weakly regular, or perhaps both.
It remains to show that all options are possible.
It suffices to provide examples: 
\begin{enumerate*}
\item
In Figure~\ref{fig.boundaries} (left-hand diagram) the point $\ast$ is on the boundary of $\intertwined{1}=\{\ast,1\}$.
It is unconflicted (being intertwined just with itself and $1$), and not weakly regular (since $\ast\not\in\community(\ast)=\{1\}$). 
\item
In Figure~\ref{fig.boundaries} (middle diagram) the point $1$ is on the boundary of $\intertwined{0}=\{0,1\}$.
It is conflicted (since $0\intertwinedwith 1\intertwinedwith 2$ yet $0\notintertwinedwith 2$) and it is weakly regular (since $1\in\community(1)=\{0,1,2\}$).\footnote{This semitopology is also in Figure~\ref{fig.012}.  We reproduce it here for the reader's convenience so that the examples are side-by-side.}
\item
In Figure~\ref{fig.boundaries} (right-hand diagram) the point $\ast$ is on the boundary of $\intertwined{3}=\{\ast,3\}$.
It is conflicted (since $2\intertwinedwith \ast\intertwinedwith 3$ yet $2\notintertwinedwith 3$) and it is not weakly regular (since $\intertwined{\ast}=\{\ast,2,3\}$ and $\ast\not\in\community(\ast)=\{3\}$).\footnote{If we remove $\{1\}$ then $\intertwined{\ast}=\{\ast,1,2,3\}$ and $\ast$ becomes weakly regular.  Similarly for $\{4\}$.}
\end{enumerate*} 
Example~3 above illustrates a boundary point that does two things --- be conflicted \emph{and} be non-weakly-regular --- even though examples~1 and~2 already provide examples of boundary points that each do one of these (but not the other).
Some readers, including these authors, might prefer to build an example that does two things by composing two smaller examples that do one thing each (e.g. by suitably composing examples~1 and~2 above).
We cannot do this now but we will we able to do so later (see Corollary~\ref{corr.conflicted.and.not.wr}) thus giving a more compositional motivation for the existence of the right-hand diagram in Figure~\ref{fig.boundaries}. 
\end{xmpl}



We consider the special case of \emph{regular} spaces (we will pick this thread up again in Subsection~\ref{subsect.boundaries.of.closed.sets} after we have built more machinery):
\begin{corr}
\label{corr.bgp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then:
\begin{enumerate*}
\item
If the set $\intertwined{p}$ is regular, then $\boundary(p)=\varnothing$ and $\intertwined{p}$ is clopen (closed and open) and transitive.
\item
If $\ns P$ is a regular space (so every point in it is regular) then $\ns P$ partitions into clopen transitive components given by $\{\intertwined{p} \mid p\in\ns P\}$.
\end{enumerate*}
\end{corr}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
By Proposition~\ref{prop.char.boundary} $\intertwined{p}=\interior(\intertwined{p})$, so by Lemma~\ref{lemm.interior.open} $\intertwined{p}$ is open.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed.
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)=\interior(\intertwined{p})\in\topens$.
It follows that $\intertwined{p}$ is (topen and therefore) transitive.
\item
By part~1 of this result each $\intertwined{p}$ is a clopen transitive set.
Using Theorem~\ref{thrm.r=wr+uc} every point is unconflicted and it follows that if $\intertwined{p}\between\intertwined{p'}$ then $\intertwined{p}=\intertwined{p'}$. 
\qedhere\end{enumerate}
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%% 
\subsection{The intertwined preorder}

\subsubsection{Definition and properties}

\begin{rmrk}
Recall the \emph{specialisation preorder} on points from topology, defined by 
$$
p\leq p'
\quad\text{when}\quad
\closure{p}\subseteq\closure{p'}.
$$
In words: we order points $p$ by subset inclusion on their closure $\closure{p}$.

This can also be defined on semitopologies of course, but we will also find a similar preorder interesting, which is defined using $\intertwined{p}$ instead of $\closure{p}$ (Definition~\ref{defn.intertwined.preorder}).
Recall that:
\begin{itemize*}
\item
$\closure{p}$ is a closed set and is equal to the intersection of all the closed sets containing $p$, and 
\item
$\intertwined{p}$ is also a closed set (Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}))
and it is the intersection of all the closed neighbourhoods of $p$ (closed sets with an interior that contains $p$; see Definition~\ref{defn.cn} and Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed})).
\end{itemize*}
\end{rmrk}

\begin{defn}
\label{defn.intertwined.preorder}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate}
\item
Define the \deffont{intertwined preorder} on points $p,p'\in\ns P$ by:
$$
p\leqk p'
\quad\text{when}\quad
\intertwined{p}\subseteq\intertwined{p'}.
$$
As standard, we may write $p'\geqk p$ when $p\leqk p'$ (pronounced `$p'$ is intertwined-less/intertwined-greater than $p$').

Calling this the `intertwined preorder' does not refer to the ordering being intertwined in any sense; it just means that we order on $\intertwined{p}$ (which is read `intertwined-$p$').
\item
Call $(\ns P,\opens)$ \deffont{intertwined-complete} when every descending chain $p_1\geqk p_2\geq \dots$ has a lower bound.
\end{enumerate}
\end{defn}

\begin{rmrk}
There is also the \deffont{community preorder} defined such that $p\leq_K p'$ when $\community(p)\subseteq\community(p')$, which is related to $p\leq p'$ via the fact that by definition $\community(p)=\interior(\intertwined{p})$, so that $\leq_K$ is a coarser relation (meaning: it relates more points).
There is an argument that this would sit more nicely with the condition $q\in\community(p)$ in Lemma~\ref{lemm.weakly.regular.community}, but ordering on $\community(p)$ would relate all points with empty community, e.g all of the points in Figure~\ref{fig.square.diagram}, and would slightly obfuscate the parallel with the specialisation preorder. 
This strikes us as uninutitive, so we prefer to preorder on $\intertwined{p}$. 
\end{rmrk}

\begin{lemm}
\label{lemm.weakly.regular.community}
Suppose $(\ns P,\opens)$ is a semitopology and $p,q\in\ns P$. 
Then
$$
q\in\community(p)
\quad\text{implies}\quad
q\leqk p.
$$
\end{lemm}
\begin{proof}
Suppose $q\in\community(p)$ and recall from Definition~\ref{defn.tn}(\ref{item.tn}) that $\community(p)\in\opens$, which means that $\closure{\community(p)}$ is a closed neighbourhood of $q$.
We use Proposition~\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures}) and Lemma~\ref{lemm.closure.community.subset}:\footnote{If the reader prefers a proof by concrete calculations, it runs as follows:
Suppose $p'\in\community(p)$, so that in particular $p'\intertwinedwith p$.
We wish to prove that $\intertwined{p'}\subseteq\intertwined{p}$.
So consider $p''\intertwinedwith p'$; we will show that $p''\intertwinedwith p$, i.e. that every pair of open neighbourhoods of $p''$ and $p$ must intersect.
Consider a pair of open neighbourhoods $p''\in O''\in\opens$ and $p\in O\in\opens$.
We note that $O''\between \community(p)$, because $p'\in\community(p)\in\opens$ and $p''\intertwinedwith p'$.
Choose $q\in\community(p)\cap O''$. 
Now $q\intertwinedwith p$ and $q\in O''$ and $p\in O$, and we conclude that $O''\between O$ as required.
}
$$
\intertwined{q} 
\stackrel{P\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures})}{\subseteq} 
\closure{\community(p)} 
\stackrel{L\ref{lemm.closure.community.subset}}{\subseteq} 
\intertwined{p}.
$$
\end{proof}


In the rest of this Subsection we develop corollaries of Lemma~\ref{lemm.weakly.regular.community}:
\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology and $q,q'\in\ns P$.
Then:
\begin{enumerate*}
\item
If $\community(q)\between\community(q')$ then $q\intertwinedwith q'$.
\item
If $q$ and $q'$ are weakly regular (so that $q\in\community(q)$ and $q'\in\community(q')$) then
if $q\intertwinedwith q'$ then $\community(q)\between\community(q')$.
\end{enumerate*}
\end{corr}
\begin{proof} 
We consider each part in turn:
\begin{enumerate}
\item
Suppose $r\in\community(q)\cap\community(q')$.
Then $\intertwined{r}\subseteq\intertwined{q}\cap\intertwined{q'}$ by Lemma~\ref{lemm.weakly.regular.community}.
But $q\in\intertwined{r}$, so $q\in\intertwined{q'}$, and thus $q\intertwinedwith q'$.
\item
If $q$ and $q'$ are weakly regular and $q\intertwinedwith q'$ then $\community(q)\between\community(q')$ follows from Definition~\ref{defn.intertwined.points}(1).
\qedhere\end{enumerate}
\end{proof}


Theorem~\ref{thrm.K-regular} is somewhat reminiscent of the \emph{hairy ball theorem}:\footnote{This famous result states that every tangent vector field on a sphere of even dimension --- this being the surface of a ball of odd dimension --- must vanish at at least one point.  Intuitively, if we consider a `hairy ball' in three-dimensional space and we try to comb its hairs so they all lie smoothly flat (with no discontinuities in direction), then at least one of the hairs is pointing straight up (i.e. its projection onto the ball is zero).  A nice combinatorial proof is in \cite{doi:10.1080/00029890.2004.11920120}.} 
\begin{thrm}
\label{thrm.K-regular}
Suppose $(\ns P,\opens)$ is a chain-bounded quasiregular semitopology (Definition~\ref{defn.tn}(\ref{item.quasiregular.point}): a semitopology that is chain-bounded and whose every point has a nonempty community).
Then:
\begin{enumerate*}
\item
$(\ns P,\opens)$ is $\intertwinedwith$-complete.
\item
For every $p\in\ns P$ there exists some regular $q\in\community(p)$.
\item
$\ns P$ contains a regular point.
\end{enumerate*}
\end{thrm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Since $\ns P$ is quasiregular, $\varnothing\neq\community(p_i)\in\opens$ for every $i$.
Write $I=\bigcap_i \community(p_i)$.
Since $\ns P$ is chain-bounded, $\varnothing\neq I\in\opens$.
Choose some $p\in I$.

It follows from Lemma~\ref{lemm.weakly.regular.community} that $p\leqk p_i$ for every $i$, thus $p$ is a $\leqk$-lower bound for the chain.
\item
Consider the subset $\{p'\in\ns P \mid p'\leqk p\}\subseteq\ns P$ ordered by $\leqk $.
Using Zorn's lemma (on $\geqk$), this contains a $\leqk$-minimal element $q'$.
By assumption of quasiregularity $\community(q')\neq\varnothing$, so choose $q\in\community(q')$.
By Lemma~\ref{lemm.weakly.regular.community} $\intertwined{q}\subseteq\intertwined{q'}$ and by $\leqk$-minimality $\intertwined{q}=\intertwined{q'}$ and it follows that $q\in\community(q)$.
Thus $q$ is weakly regular.
Applying similar reasoning to $p'\in\community(q)$ we deduce that $\intertwined{p'}=\intertwined{q}$, and thus $\community(p')=\community(q)$, for every $p'\in\community(q)$, and so by Corollary~\ref{corr.corr.pKp} $q$ is regular.
\item
Choose any $p\in\ns P$, and use part~2 of this result.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
We care about the existence of regular points as these are the ones that are well-behaved with respect to our semitopological model of heterogeneous consensus. 
A semitopology with a regular point is one that --- at least in the idealised mathematical sense that we use in this paper --- is capable of reaching a local consensus.

So Theorem~\ref{thrm.K-regular} can be read as a guarantee that, provided the semitopology is chain-bounded and quasiregular, there exists somebody, somewhere, who can make sense of their local network and reach consensus.
This a mathematical guarantee and not an engineering one, much as is the hairy ball theorem of which the result reminds us. 
\end{rmrk} 

%%%%%%%%%%%%%%%%%%%%
\subsubsection{Application to weakly regular conflicted spaces}


In Proposition~\ref{prop.unconflicted.irregular}(3) we saw an example of an unconflicted irregular space (illustrated in Figure~\ref{fig.square.diagram}): this is a space in which every point is unconflicted but not weakly regular.
In this subsection we consider the dual case, of a conflicted weakly regular space: a space in which every point is conflicted yet weakly regular.

One question is: does such a creature even exist?
The answer is: 
\begin{itemize*}
\item
no, in the finite case (Corollary~\ref{corr.no.finite.wr.c}); and 
\item
yes, in the infinite case (Proposition~\ref{prop.conflicted.weakly.regular}).
\end{itemize*}



\begin{prop}
\label{prop.weakly.regular.to.regular}
Suppose $(\ns P,\opens)$ is a finite quasiregular semitopology (so $\ns P$ is finite and every $p\in\ns P$ is quasiregular) --- in particular this holds if the semitopology is weakly regular.
Then:
\begin{enumerate*}
\item
For every $p\in\ns P$ there exist some regular $q\in\community(p)$. 
\item
$\ns P$ contains a regular point.
\end{enumerate*}
In words we can say: every finite quasiregular semitopology contains a regular point.
\end{prop}
\begin{proof}
From Theorem~\ref{thrm.K-regular}, since `is finite' implies `is chain-bounded'.%
\footnote{The proof of Theorem~\ref{thrm.K-regular} uses Zorn's lemma.  A longer, direct proof of Proposition~\ref{prop.weakly.regular.to.regular} is also possible, by explicit induction on size of sets.}
\end{proof}




\begin{corr}
\label{corr.no.finite.wr.c}
There exists no finite quasiregular conflicted semitopology (i.e. a semitopology with finitely many points, each of which is quasiregular but conflicted).
\end{corr}
\begin{proof}
Suppose $(\ns P,\opens)$ is finite and quasiregular.
By Proposition~\ref{prop.weakly.regular.to.regular} it contains a regular $q\in\ns P$ and by Proposition~\ref{prop.unconflicted.irregular}(1) $q$ is unconflicted. 
\end{proof}


\begin{figure}
\centering
\includegraphics[width=0.6\columnwidth]{diagrams/binary-tree.pdf}
\caption{A weakly regular, conflicted space (Proposition~\ref{prop.conflicted.weakly.regular}); the opens are the down-closed sets}
\label{fig.weakly-regular.conflicted}
\end{figure}

Corollary~\ref{corr.no.finite.wr.c} applies to finite semitopologies because these are necessarily chain-bounded.
The infinite case is different, as we shall now observe:
\begin{prop}
\label{prop.conflicted.weakly.regular}
There exists an infinite quasiregular --- indeed it is also weakly regular --- conflicted semitopology $(\ns P,\opens)$.

In more detail:
\begin{itemize*}
\item
every $p\in\ns P$ is weakly regular (so $p\in\community(p)\in\opens$; see Definition~\ref{defn.tn}(\ref{item.weakly.regular.point})) yet 
\item
every $p\in\ns P$ is conflicted (so $\intertwinedwith$ is not transitive at $p$; Definition~\ref{defn.conflicted}(1)).
\end{itemize*}
Furthermore: $\ns P$ is a topology.\footnote{Forward reference: it is also witness semitopology.  See Lemma~\ref{lemm.w.cwr}.}
\end{prop}
\begin{proof}
Take $\ns P=[01]^*$ to be the set of words (possibly empty finite lists) from $0$ and $1$.
For $w,w'\in\ns P$ write $w\leq w'$ when $w$ is an initial segment of $w'$ and define 
$$
w_\geq = \{w' \mid w\leq w'\}
\quad\text{and}\quad
w_\leq = \{w' \mid w'\leq w\}.
$$
Let open sets be generated as (possibly empty) unions of the $w_\geq$.
This space is illustrated in Figure~\ref{fig.weakly-regular.conflicted}; open sets are down-closed subsets. 

The reader can check that $\neg(w0\intertwinedwith w1)$, because $w0_\geq\cap w1_\geq=\varnothing$, and that $w\intertwinedwith w'$ when $w\leq w'$ or $w'\leq w$.
It follows from the above that 
$$
\intertwined{w}=w_\geq\cup w_\leq
\quad\text{and}\quad 
\community(w)=\interior(\intertwined{w})=w_\geq,
$$
and since $w\in w_\geq$ every $w$ is weakly regular. 
Yet every $w$ is also conflicted, because $w0\intertwinedwith w \intertwinedwith w1$ yet $\neg(w0\intertwinedwith w1)$. 

This example is a topology, because an intersection of down-closed sets is still down-closed.
It escapes the constraints of Theorem~\ref{thrm.K-regular} by not being chain-bounded.
\end{proof}




\subsubsection{(Un)conflicted points and boundaries of closed sets}
\label{subsect.boundaries.of.closed.sets}

Recall from Definition~\ref{defn.cn} that a closed neighbourhood is a closed set with a nonempty interior, and recall that $\intertwined{p}$ --- the set of points intertwined with $p$ from Definition~\ref{defn.intertwined.points} --- is characterised using closed neighbourhoods in Proposition~\ref{prop.closure.intertwined}, as the intersection of all closed neighbourhoods that have $p$ in their interior.

This leads to the question of whether the theory of $\intertwined{p}$ might \emph{be} a theory of closed neighbourhoods.
The answer seems to be no: $\intertwined{p}$ has its own distinct character, as the results and counterexamples below will briefly illustrate. 

For instance: in view of Proposition~\ref{prop.closure.intertwined} characterising $\intertwined{p}$ as an intersection of closed neighbourhoods of $p$, might it be the case that for $C$ a closed neighbourhood, $C=\bigcup\{\intertwined{p} \mid p\in\interior(C)\}$.
In words: is a closed neighbourhood $C$ the union of the points intertwined with its interior? 
This turns out to be only half true:
\begin{lemm}
\label{lemm.ab12}
Suppose $(\ns P,\opens)$ is a semitopology and $C\in\closed$ is a closed neighbourhood.
Then: 
\begin{enumerate*}
\item
$\bigcup\{\intertwined{p} \mid p\in\interior(C)\}\subseteq C$.
\item
This subset inclusion may be strict: it is possible for $p\in\ns P$ to be on the boundary of a closed neighbourhood $C$, but not intertwined with any point in that neighbourhood's interior.
This is true even if $\ns P$ is a regular space.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p\in\interior(C)$ then $\intertwined{p}\subseteq C$ by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}).
\item
We provide a counterexample, as illustrated in Figure~\ref{fig.Ast12}: 
\begin{itemize*}
\item
$\ns P=\{\ast, 1, 2\}$.
\item
Open sets are generated by $\{1\}$, $\{2\}$, and $\{\ast,2\}$.
\item
We set $p=\ast$ and $C=\{1,\ast\}$.
\end{itemize*}
Then the reader can check that $\interior(C)=\{2\}$ $\intertwined{\ast}=\{\ast,2\}$ and $\ast\notintertwinedwith 2$ and every point in $\ns P$ is regular.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-2em}
\centering
\subcaptionbox{Regular boundary point of closed neighbourhood that is not intertwined with its interior (Lemma~\ref{lemm.ab12}(2))}{\includegraphics[width=0.4\columnwidth,trim={50 20 50 20},clip]{diagrams/Ast12.pdf}}
\qquad
\subcaptionbox{Regular point in kissing set of closed neighbourhoods, not intertwined with interiors (Lemma~\ref{corr.ab123}(2))}{\includegraphics[width=0.4\columnwidth,trim={50 20 50 20},clip]{diagrams/Ast12b.pdf}}
\caption{Two counterexamples}
\label{fig.Ast12}
\end{figure}


\begin{defn}
Suppose $(\ns P,\opens)$ is a semitopology and $P,P'\subseteq\ns P$.
Then
define 
$$
\f{kiss}(P,P')=\boundary(P)\cap \boundary(P')
$$ 
and call this the \deffont{kissing set} of $P$ and $P'$.
\end{defn}

\begin{lemm}
\label{lemm.kissing.conflict}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the following are equivalent:
\begin{itemize*}
\item
$p$ is conflicted.
\item
There exist $q,q'\in\ns P$ such that $q\notintertwinedwith q'$ and $p\in\kiss(\intertwined{q},\intertwined{q'})$.
\item
There exist $q,q'\in\ns P$ such that $q\notintertwinedwith q'$ and $p\in\intertwined{q}\cap\intertwined{q'}$.
\end{itemize*}
\end{lemm}
\begin{proof}
We prove a cycle of implications:
\begin{itemize}
\item
\emph{Suppose $p$ is conflicted.}\quad

Then there exist $q,q'\in\ns P$ such that $q\intertwinedwith p\intertwinedwith q'$ yet $q\notintertwinedwith q'$.
Rephrasing this, we obtain that $p\in\intertwined{q}\cap\intertwined{q'}$.

We need to check that $p\not\in\community(q)$ and $p\not\in\community(q')$.
We prove $p\not\in\community(q)$ by contradiction ($p\not\in\community(q')$ follows by identical reasoning).
Suppose $p\in\community(q)$.
Then by Lemma~\ref{lemm.weakly.regular.community} $\intertwined{p}\subseteq\intertwined{q}$.
But $q'\in\intertwined{p}$, so $q'\in\intertwined{q}$, so $q'\intertwinedwith q$, contradicting our assumption.

\item
\emph{Suppose $q\notintertwinedwith q'$ and $p\in\boundary(\intertwined{q})\cap\boundary(\intertwined{q'})$.}

Then certainly $p\in\intertwined{q}\cap\intertwined{q'}$.
\item
\emph{Suppose $q\notintertwinedwith q'$ and $p\in\intertwined{q}\cap\intertwined{q'}$.}

Then $q\intertwinedwith p\intertwinedwith q'$ and $q\notintertwinedwith q'$, which is precisely what it means to be conflicted.
\qedhere\end{itemize}
\end{proof}

We can look at Definition~\ref{defn.conflicted} and Lemma~\ref{lemm.kissing.conflict} and conjecture that a point $p$ is conflicted if and only if it is in the kissing set of a pair of distinct closed sets.
Again, this is half true:
\begin{corr}
\label{corr.ab123}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ is conflicted then there exist a pair of closed sets such that $p\in\kiss(C,C')$.
\item
The reverse implication need not hold: it is possible for $p$ to be in the kissing set of a pair of closed sets $C$ and $C'$, yet $p$ is unconflicted.
This is even possible if the space is regular (meaning that every point in the space is regular, including $p$), and that $C$ and $C'$ are closed neighbourhoods.
\end{enumerate*}
\end{corr}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p$ is conflicted then we use Lemma~\ref{lemm.kissing.conflict} and Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}).
\item
It suffices to provide a counterexample.
We define:
\begin{itemize*}
\item
$\ns P=\{\ast, 1, 2, 3\}$.
\item
Open sets are generated by $\{1\}$, $\{2\}$, $\{3\}$, and $\{\ast, 2\}$. 
\item
We set $p=\ast$ and $C=\{\ast,1\}$ and $C'=\{\ast, 3\}$.
\end{itemize*}
Note that $\ast$ is regular (being intertwined with itself and $2$), and $C$ and $C'$ are closed neighbourhoods that kiss at $\ast$, and $1$, $2$, and $3$ are also regular. 
\qedhere\end{enumerate}
\end{proof}






%%%%%%%%%%%%%%%%%%
\section{The product semitopology} 
\label{sect.product}

Products of semitopologies can be defined just as for topologies.
We do this in Definition~\ref{defn.product.semitopology}, then study how semitopological properties --- like being a (maximal) topen or being a regular point --- interact with products.

\subsection{Basic definitions and results (shared with topologies)} 

\begin{defn}
\label{defn.squares}
Suppose $\ns P_1$ and $\ns P_2$ are sets and suppose $P_1\subseteq\ns P_1$ and $P_2\subseteq\ns P_2$.
Then:
\begin{enumerate}
\item
Call the set 
$$
P_1{\times}P_2=\{(p_1,p_2)\mid p_1\in P_1,\ p_2\in P_2\}
$$ 
a \deffont{square}, and 
\item
call $P_1$ and $P_2$ the \deffont{sides} of the square. 
\end{enumerate}
\end{defn}

\begin{defn}[Product semitopology]
\label{defn.product.semitopology}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
\begin{enumerate}
\item
As for topologies, define the \deffont{product semitopology} $\ns P_1\times\ns P_2$ such that:
\begin{itemize*}
\item
The set of points is the cartesian product $\ns P_1\times\ns P_2$.
\item
Open sets are (possibly empty, possibly infinite) unions of squares $O_1{\times} O_2$ for $O_1\in\opens_1$ and $O_2\in\opens_2$.
By abuse of notation we may write this set $\opens_1\times\opens_2$.
\end{itemize*}
\item
Define the \deffont{first-} and \deffont{second projections} $\pi_1:\ns P_1\times\ns P_2\to \ns P_1$ and $\pi_2:\ns P_1\times\ns P_2\to\ns P_2$ as usual such that $\pi_1(p_1,p_2)=p_1$ and $\pi_2(p_1,p_2)=p_2$.
\item
For this Subsection, if $X$ is a set and $f$ is a function on $X$ then we write $f(X)$ for the \deffont{pointwise application} defined by
$$
f(X) =\{f(x)\mid x\in X\}.
$$
In particular we will use this notation for pointwise application of $\pi_1$ and $\pi_2$ to subsets $P\subseteq\ns P_1\times\ns P_2$.
\end{enumerate}
\end{defn}

\begin{lemm}
\label{lemm.proj.cont}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
Then the first and second projections $\pi_1$ and $\pi_2$ from Definition~\ref{defn.product.semitopology}(2) are
\begin{itemize*}
\item
continuous (inverse image of open set is open / inverse image of closed set is closed), and
\item
open (pointwise image of open set is open).
\end{itemize*}
\end{lemm}
\begin{proof}
By routine calculations, as for topologies; see for example~\cite{engelking:gent}, page~79, just before Example~2.3.10.
\end{proof}


Lemma~\ref{lemm.point.closure.square} below is a special case of a general result from topology~\cite[Lemma~2.3.3, page~78]{engelking:gent} that (in our terminology from Definition~\ref{defn.squares}) the closure of a square is the square of the closure of its sides.
We do need to check that this still works for semitopologies, and it does:
\begin{lemm}
\label{lemm.point.closure.square}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then
$$
\closure{(p_1,p_2)}=\closure{p_1}{\times}\closure{p_2}.
$$
\end{lemm}
\begin{proof}
The closure of a set is the complement of the largest open set disjoint from it.\footnote{That is: the complement of the interior of the complement.} 
By construction in Definition~\ref{defn.product.semitopology}, open sets in the product topology are unions of squares of opens, and the result now just follows noting that for $O_1\in\opens_1$ and $O_2\in\opens_2$, $(p_1,p_2)\in O_1{\times}O_2$ if and only if $p_1\in O_1$ and $p_2\in O_2$. 
\end{proof}


\subsection{Componentwise composition of semitopological properties}
\label{subsect.componentwise.composition}

We prove a sequence of results checking how properties such as being intertwined, regular, weakly, regular, and conflicted relate between a product space and the component spaces.
Most notably perhaps, we show that `being intertwined', `being regular', `being weakly regular', and `being conflicted' hold componentwise --- the overall schema of the result is ``$(\ns P_1,\ns P_2)$ has $\phi$ if and only if $\ns P_1$ and $\ns P_2$ have $\phi$''.

We will then use this to generate examples with complex behaviour that is obtained by composing the behaviour of their (simpler) components: see in particular Corollary~\ref{corr.conflicted.and.not.wr} and Theorem~\ref{thrm.nitpicked}.

 

\begin{lemm}[Intersecting squares is componentwise]
\label{lemm.intersecting.squares}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and suppose $O,O'\in\opens_1\times\opens_2$ are squares. 
Then
$$
O\between O'
\quad\text{if and only if}\quad
\pi_1(O)\between\pi_1(O') \ \land\ \pi_2(O)\between\pi_2(O') .
$$
\end{lemm}
\begin{proof}
By routine sets calculations, noting that since $O$ and $O'$ are squares by definition $O=\pi_1(O)\times\pi_2(O)$ and $O'=\pi_1(O')\times\pi_2(O')$.
\end{proof}


\begin{prop}[Being intertwined is componentwise]
\label{prop.product.intertwined}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
Then:
\begin{enumerate*}
\item 
$(p_1,p_2)\between (p_1',p_2')$ if and only if $p_1\between p_1' \ \land\  p_2\between p_2'$.
\item
As an immediate corollary, $\intertwined{(p_1,p_2)} = \intertwined{{p_1}}\times\intertwined{{p_2}}$.
\end{enumerate*}
\end{prop}
\begin{proof}
For part~1 of this result we prove two implications:
\begin{itemize}
\item
\emph{Suppose $p_1\between p_1'$ and $p_2\between p_2'$.}\quad

Consider two open neighbourhoods $O\ni (p_1,p_2)$ and $O'\ni (p_1',p_2')$.
We wish to show that $O\between O'$.

Without loss of generality we may assume that $O$ and $O'$ are squares, since: opens are unions of squares so we just choose squares in $O$ and $O'$ that contain $(p_1,p_2)$ and $(p_1',p_2')$ respectively.
Thus, $O=O_1{\times} O_2$ and $O'=O_1'{\times} O_2'$.

Now $p_1\in O_1$ and $p_1'\in O_1'$ and $p_1\between p_1'$, thus $O_1\between O_1'$.
Similarly for $p_2$ and $p_2'$.
We use Lemma~\ref{lemm.intersecting.squares}.
\item
\emph{Suppose $(p_1,p_2)\between (p_1',p_2')$.}\quad

Then in particular all square open neighbourhoods intersect, and by Lemma~\ref{lemm.intersecting.squares} so must their sides.
\end{itemize}
Part~2 just rephrases part~1 of this result using Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}).
\end{proof}


\begin{corr}[(Maximal) topen is componentwise]
\label{corr.topens.are.squares}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $\atopen\in\opens_1{\times}\opens_2$ is a square.
Then for each of `a topen' / `a maximal topen' below, the following are equivalent:
\begin{itemize*}
\item
$\atopen\in\opens_1{\times}\opens_2$ is a topen / a maximal topen in $\ns P_1\times\ns P_2$.
\item
The sides $\pi_1(\atopen)$ and $\pi_2(\atopen)$ of $\atopen$ are topens / maximal topens in $\ns P_1\times\ns P_2$.
\end{itemize*}
\end{corr}
\begin{proof}
First, we consider the versions without `maximal':
\begin{enumerate}
\item
\emph{Suppose $\atopen\in\opens_1{\times}\opens_2$ is a topen in $\ns P_1\times\ns P_2$.}

By Lemma~\ref{lemm.proj.cont}(2) its sides $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are open.
Now consider $p_1,p_1'\in\pi_1(\atopen)$ and choose any $p_2\in\pi_2(\atopen)$.
We know $(p_1,p_2)\between(p_1',p_2)$ must hold, because both points are in $\atopen$ and by Theorem~\ref{thrm.cc.char} all points in $\atopen$ are intertwined.
By Proposition~\ref{prop.product.intertwined}(1) it follows that $p_1\between p_1'$.
Since $p_1$ and $p_1'$ were arbitrary in $\pi_1(\atopen)$ it follows using Theorem~\ref{thrm.cc.char} again that $\pi_1(\atopen)$ is topen. 

The reasoning for $\pi_2(\atopen)$ is precisely similar.
\item
\emph{Suppose $T_1\in\opens_1$ and $T_2\in\opens_2$ are topen in $\ns P_1\times\ns P_2$.}

By construction in Definition~\ref{defn.product.semitopology} the square $T_1{\times}T_2$ is open, and it follows using Proposition~\ref{prop.product.intertwined}(1) and Theorem~\ref{thrm.cc.char} that $T_1{\times}T_2$ is topen.
\end{enumerate}
We now consider maximality:
\begin{enumerate}
\item
\emph{Suppose $\atopen\in\opens_1{\times}\opens_2$ is a maximal topen in $\ns P_1\times\ns P_2$.}

By our reasoning above its sides are topens, but if those sides were not maximal topens --- so at least one of them is included in a strictly larger topen --- then, again using our reasoning above, we could use obtain a larger topen square in $\opens_1{\times}\opens_2$, contradicting maximality of $\atopen$.
\item 
\emph{Suppose $T_1\in\opens_1$ and $T_2\in\opens_2$ are maximal topens in $\ns P_1$ and $\ns P_2$.}

By our reasoning above the square $T_1{\times}T_2$ is a topen.
If it were not a maximal topen --- so it is included in some strictly larger topen $\atopen$ --- then by our reasoning above $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are also topens and one of them would have to be larger than $T_1$ or $T_2$, contradicting their maximality.
\qedhere\end{enumerate}
\end{proof}

\begin{corr}[Regular is componentwise]
\label{corr.regular.pair}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then the following are equivalent:
\begin{itemize*}
\item
$(p_1,p_2)$ is regular in $\ns P_1\times\ns P_2$. 
\item
$p_1$ is regular in $\ns P_1$ and $p_2$ is regular in $\ns P_2$.
\end{itemize*}
\end{corr}
\begin{proof}
Suppose $(p_1,p_2)$ is regular.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.p.regular}\&\ref{char.some.topen}) it has a topen neighbourhood $\atopen$.
Using Corollary~\ref{corr.topens.are.squares} $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are topen neighbourhoods of $p_1$ and $p_2$ respectively.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.p.regular}\&\ref{char.some.topen}) $p_1$ and $p_2$ are regular.

If conversely $p_1$ and $p_2$ are regular then we just reverse the reasoning of the previous paragraph. 
\end{proof}



Proposition~\ref{prop.wr.pair} does for `is conflicted' and `is weakly regular' what Corollary~\ref{corr.regular.pair} does for `is regular'.
With the machinery we now have, the argument is straightforward:
\begin{prop}[Unconflicted \& weakly regular is componentwise]
\label{prop.wr.pair}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and suppose $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then:
\begin{enumerate*}
\item
$(p_1,p_2)$ is unconflicted in $\ns P_1\times\ns P_2$ if and only if $p_1$ is unconflicted in $\ns P_1$ and $p_2$ is unconflicted in $\ns P_2$.
\item
$(p_1,p_2)$ is weakly regular in $\ns P_1\times\ns P_2$ if and only if $p_1$ is weakly regular in $\ns P_1$ and $p_2$ is weakly regular in $\ns P_2$.
\end{enumerate*}
\end{prop}
\begin{proof}
For part~1 we prove two implications:
\begin{itemize}
\item
\emph{Suppose $(p_1,p_2)$ is unconflicted.}
We will show that $p_1$ is unconflicted (the case of $p_2$ is precisely similar).

Consider $p',p''\in \ns P_1$ and suppose $p'\intertwinedwith p_1\intertwinedwith p''$.
Using Proposition~\ref{prop.product.intertwined}(1) $(p',p_2)\intertwinedwith (p_1,p_2)\intertwinedwith (p'',p_2)$, by transitivity (since we assumed $(p_1,p_2)$ is unconflicted) $(p',p_2)\intertwinedwith (p'',p_2)$, and using Proposition~\ref{prop.product.intertwined}(1) we conclude that $p'\intertwinedwith p''$ as required.

\emph{Suppose $p_1$ and $p_2$ are unconflicted.}
We will assume $(p_1',p_2')\intertwinedwith (p_1,p_2)\intertwinedwith (p_1'',p_2'')$ and prove $(p_1',p_2')\intertwinedwith(p_1'',p_2'')$.

Using Proposition~\ref{prop.product.intertwined}(1) $p_1'\intertwinedwith p_1\intertwinedwith p_1''$ and by transitivity (since we assumed $p_1$ is unconflicted) we have $p_1'\intertwinedwith p_1''$.
Similarly $p_2'\intertwinedwith p_2''$, and using Proposition~\ref{prop.product.intertwined}(1) $(p_1',p_2')\intertwinedwith (p_1'',p_2'')$ as required. 
\end{itemize}
Part~2 follows by routine reasoning just combining part~1 of this result and Corollary~\ref{corr.regular.pair} with Theorem~\ref{thrm.r=wr+uc}.  
\end{proof}


We now have the machinery that we need to make good on a promise made at the end of Example~\ref{xmpl.boundary.examples}:
\begin{corr}
\label{corr.conflicted.and.not.wr}
There exists a semitopology $(\ns P,\opens)$ and points $p,q\in\ns P$ such that $q$ is on the boundary of $\intertwined{p}$ and is conflicted and not weakly regular.
\end{corr}
\begin{proof}
We already know this from Example~\ref{xmpl.boundary.examples}(3), as illustrated in the right-hand diagram in Figure~\ref{fig.boundaries},
but now we can give a more principled construction:
we let $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ be the first and second examples from Example~\ref{xmpl.boundary.examples}, as illustrated in Figure~\ref{fig.boundaries} (left-hand and middle figure).

The point $\ast\in\ns P_1$ is on the boundary of $\intertwined{1}$ and it is 
unconflicted and not weakly regular.
The point $1\in\ns P_2$ is on the boundary of $\intertwined{0}$ and it is 
conflicted and weakly regular.
It follows from Proposition~\ref{prop.wr.pair} that $(\ast,1)$ is conflicted and not weakly regular.

By Proposition~\ref{prop.product.intertwined}(2) $\intertwined{(1,0)}=\intertwined{1}\times\intertwined{0}$, and by some routine topological calculation we see that $(\ast,1)$ is on the boundary of this set.
\end{proof}
 





%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Minimal closed neighbourhoods, with an application to a counterexample}

We continue the development of Subsection~\ref{subsect.componentwise.composition} and the example in Corollary~\ref{corr.conflicted.and.not.wr} with some slightly more technical results, leading up to another example. 

\begin{lemm}
\label{lemm.minimal.squares}
Suppose that:
\begin{itemize*}
\item
$(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies. 
\item
$C$ is a square (Definition~\ref{defn.squares}) in $\ns P_1\times\ns P_2$. 
\end{itemize*}
Then 
\begin{itemize*}
\item
if $C$ is a minimal closed neighbourhood in $\ns P_1\times\ns P_2$, 
\item
then the sides of $C$, $C_1=\pi_1(C)$ and $C_2=\pi_2(C)$, are minimal closed neighbourhoods in $\ns P_1$ and $\ns P_2$ respectively.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $C$ is a square minimal closed neighbourhood, and consider $C_1'\subseteq C_1$ a closed neighbourhood in $\ns P_1$.
We will show that $C_1'=C_1$ (the argument for $\ns P_2$ is no different).
Using Lemma~\ref{lemm.proj.cont}, $C_1'{\times}C_2$ is a closed neighbourhood in $\ns P_1\times\ns P_2$.
By routine sets calculations and minimality we have that $C_1'{\times}C_2 = C_1{\times}C_2$, and it follows that $C_1'=C_1$.
\end{proof}



\begin{corr}
\label{corr.neighbourhood.up}
Suppose that:
\begin{itemize*}
\item
$(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
\item
$p_2\in\ns P_2$.
\item
$\intertwined{{p_2}}$ is not a minimal closed neighbourhood of $p_2$.
\end{itemize*}
Then for every $p_1\in\ns P_1$ and for every $C$ a minimal closed neighbourhood of $(p_1,p_2)$, we have that $\intertwined{(p_1,p_2)}\subsetneq C$. 
\end{corr}
\begin{proof}
By Proposition~\ref{prop.product.intertwined}(2) $\intertwined{(p_1,p_2)}=\intertwined{{p_1}}{\times}\intertwined{{p_2}}$ and by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{(p_1,p_2)}\subseteq C$.

If $C=\intertwined{(p_1,p_2)}=\intertwined{{p_1}}{\times}\intertwined{{p_2}}$ then by 
Lemma~\ref{lemm.minimal.squares} its side $\intertwined{{p_2}}$ is a minimal closed neighbourhood of $p_2$, but we assumed this is not the case.
Thus, $\intertwined{(p_1,p_2)}\subsetneq C$ as required.
\end{proof}



\begin{rmrk}
Recall that Proposition~\ref{prop.closure.intertwined}(1) shows that $\closure{p}\subseteq\intertwined{p}$, and Example~\ref{xmpl.closure.101} shows that this inclusion may be strict by giving a semitopology in which $\closure{p}\subsetneq\intertwined{p}$.
Recall also that it follows from Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) that $\intertwined{p}\subseteq C$ for any $C$ a (minimal) closed neighbourhood of $p$, and Example~\ref{xmpl.not.intertwined} shows that this inclusion may be strict by giving a semitopology in which $\intertwined{p}\subsetneq C$ for $C$ a minimal closed neighbourhood of $p$.
What we have not done so far is show that both inclusions may be strict \emph{for a single $p$}: we can now apply what we have shown about the product semitopology in this Subsection, to `glue' our examples together: 
\end{rmrk}

\begin{thrm}
\label{thrm.nitpicked}
There exists a semitopology $(\ns P,\opens)$ and a $p\in\ns P$ and a minimal closed neighbourhood $C$ of $p$ such that the inclusions below are strict: 
$$
\closure{p} \subsetneq \intertwined{p} \subsetneq C .
$$ 
\end{thrm}
\begin{proof}
Let $(\ns P_1,\opens_1)$ be the semitopology from Example~\ref{xmpl.closure.101}, and $(\ns P_2,\opens_2)$ be that from Example~\ref{xmpl.not.intertwined}.
We set:
\begin{itemize*}
\item
$(\ns P,\opens)=(\ns P_1,\opens_1)\times(\ns P_2,\opens_2)$, the product semitopology.
\item
$p_1=1\in\ns P_1$, for which $\closure{1}\subsetneq\intertwined{1}=\{0,1\}$, and 
\item
$p_2=(0,0)$, which has a minimal closed neighbourhood $A=\{(0,0),(1,0)\}$ which is not equal to $\intertwined{{p_2}}=\intertwined{(0,0)}=\{(0,0)\}$, and
\item
$C=\{0,1\}{\times}\{(0,0), (1,0)\}$.
\end{itemize*}
We show that $\closure{(p_1,p_2)}\subsetneq\intertwined{(p_1,p_2)}$, as follows:
$$
\begin{array}{r@{\ }l@{\qquad}l}
\closure{(p_1,p_2)}
=&
\closure{p_1}{\times}\closure{p_2}
&\text{Lemma~\ref{lemm.point.closure.square}}
\\
\subsetneq&
\intertwined{{p_1}}{\times}\closure{p_2}
&\closure{1}\subsetneq \intertwined{1}
\\
\subseteq&
\intertwined{{p_1}}{\times}\intertwined{{p_2}}
&\text{Proposition~\ref{prop.closure.intertwined}(1)} .
\end{array}
$$
Furthermore, by Corollary~\ref{corr.neighbourhood.up} $\intertwined{(p_1,p_2)}\subsetneq C$, because $\intertwined{{p_2}}\subsetneq A$.
\qedhere
\end{proof}



\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.4\columnwidth]{diagrams/counterexample-1.pdf}
\vspace{-2em}
\caption{Example where $\closure{\ast}\subsetneq\intertwined{\ast}\subsetneq \{0,1,\ast\}$}
\label{fig.nitpick}
\end{figure}

\begin{xmpl}
\label{xmpl.nitpick}
We now give a succinct example of the property in Theorem~\ref{thrm.nitpicked}.
Set 
\begin{itemize*}
\item
$\ns P=\{0,1,2,\ast\}$ and 
\item
let $\opens$ be generated by $\{0\}$, $\{1\}$, $\{2\}$ (so $\{0,1,2\}$ has the discrete semitopology) and by $\{0,1,\ast\}$, and $\{1,2,\ast\}$,
\end{itemize*}
as illustrated in Figure~\ref{fig.nitpick} (we used this same example in Figure~\ref{fig.boundaries}, left-hand diagram).
Then we note that:
\begin{itemize*}
\item
$\closure{\ast}=\{\ast\}$, because $\{0,1,2\}$ is open.
\item
$\intertwined{\ast}=\{1,\ast\}$, since $\{1,2,\ast\}$ is disjoint from $\{0\}$ and $\{0,1,\ast\}$ is disjoint from $\{2\}$.
\item
$\{0,1,\ast\}$ and $\{1,2,\ast\}$ are distinct minimal closed neighbourhoods of $\ast$, with open interiors $\{0,1\}$ and $\{1,2\}$ respectively.
\end{itemize*}
\end{xmpl}


%%%%%%%%%%%%%%%%%%%%%
\section{Computing semitopologies: witnessed sets and the witness semitopology}
\label{sect.witness}


\subsection{Discussion}

\begin{rmrk}
\label{rmrk.local}
In this Section, we turn to the problem of computing with semitopologies.
We want two things from our maths: 
\begin{itemize*}
\item
that it will deliver algorithms; and also 
\item
that these algorithms should be \deffont{local}, by which we mean \emph{executable by points knowing only information near (local) to them, by communicating with local peers}.
\end{itemize*}
In particular, a local algorithm should not assume that points can globally synchronise or agree.\footnote{Indeed, to do this would be to assume a solution to the problem that semitopologies were created to study.}

We now note that our notion of `open neighbourhood of a point' from semitopologies is not \emph{a priori} particularly local.
The simplest illustration is perhaps to note that $(\ns P,\opens)=(\mathbb N,\{\varnothing,\mathbb N\})$ expresses that points coordinate on whether they all agree, but the lack of locality shows up in the mathematics in other, perhaps unexpected ways, because we can encode nontrivial information in the structure of open sets.
Consider the following example of a semitopology with (by design) poor algorithmic behaviour:
\end{rmrk}

\begin{xmpl}
\label{xmpl.uncomputable.semitopology}
Let the \deffont{uncomputable semitopology} have 
\begin{itemize*}
\item
$\ns P=\mathbb N$ and 
\item
open sets generated as unions of \emph{uncomputable subsets} of $\mathbb N$.
\end{itemize*}
This is a semitopology (not a topology, since the intersection of two uncomputable subsets need not be uncomputable) and by construction there is no algorithm to compute its open sets.
\end{xmpl}



\begin{rmrk}
\label{rmrk.computational.content}
Example~\ref{xmpl.uncomputable.semitopology} just comes from the fact that the definition of semitopologies involves a subset of a powerset of a possibly infinite set of points.

This is not unusual: similar uncomputable elements exist in the powerset $\powerset(\mathbb N)$ and the function space $\mathbb N^{\mathbb N}$.
What we should now do is define and study computationally tractable subsets of the power- or function space --- much as we can define and study \emph{recursively enumerable} subsets of $\mathbb N$ and \emph{recursive functions} in $\mathbb N^{\mathbb N}$, respectively.

So: what definitions could we give for semitopologies?
 
In this Section will identify a subclass of algorithmically tractable semitopologies, and furthermore this in the strong sense that the definition is clean, makes a novel connection to declarative programming, and from it we extract distributed and local algorithms in the sense discussed above.
To do this, we will define witnessed sets (Definition~\ref{defn.witnessed.set}) and show that they determine computationally tractable semitopologies in a sense made formal by results including 
\begin{itemize*}
\item
Propositions~\ref{prop.open.limit} and~\ref{prop.lim.is.closure} (which show that algorithms exist to compute open and closed sets) and 
\item
the remarkable Theorem~\ref{thrm.lim.O.open} (which shows intuitively that witness semitopologies behave locally like finite sets, even if they are globally infinite). 
\end{itemize*}
\end{rmrk}

The impatient reader can jump to Remarks~\ref{rmrk.computing.open.sets} and~\ref{rmrk.computing.closed.sets}, where we describe these algorithms.
They are described at a high level, but what matters is that they exist, and
what is nice about them is that they correspond to natural (semi)topological operations.


%%%%%%%%%%%%%%%%%%%%%
\subsection{The witness function and semitopology}

\begin{nttn}
\label{nttn.finpow}
We extend Notation~\ref{nttn.powerset}.
Suppose $\ns P$ is a set.
\begin{itemize*}
\item
Write $\powerset_{\neq\varnothing}(\ns P)$ for the nonempty powerset of $\ns P$ (the set of nonempty subsets of $\ns P$).
\item
Write $\finpow(\ns P)$ for the finite powerset of $\ns P$ (the set of finite subsets of $\ns P$).
\item
Write $\finpow_{\neq\varnothing}(\ns P)$ for the finite powerset of $\ns P$ (the set of finite subsets of $\ns P$).
\end{itemize*}
\end{nttn}



\begin{defn}
\label{defn.witnessed.set}
Suppose $\ns P$ is a set. 
Then:
\begin{enumerate*}
\item\label{witness.function}
A \deffont{witness function} on $\ns P$ is a function
$$
\witness:\ns P\to\finpow_{\neq\varnothing}(\powerset_{\neq\varnothing}(\ns P)) . 
$$
Call a pair $(\ns P,\witness)$ of a set and a witness function on that set, a \deffont{witnessed set}.
\item\label{witness.witness}
If $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ then call $w\in\witness(p)$ a \deffont{witness} for $p$ and say that $w$ \deffont{witnesses} $p$.
\end{enumerate*}
In words: a witnessed set is a set along with a witness function that assigns to each element of that set a finite and nonempty set of nonempty \emph{witnesses}.
\end{defn}

\begin{rmrk}\leavevmode
\begin{enumerate}
\item
A witness function $\witness$ gives rise to a relation in $\ns P\times\powerset_{\neq\varnothing}(\ns P)$ by taking 
$$
p\mathrel{\witness}w \quad\text{when}\quad
w\in\witness(p).
$$
\item
If we read the relation from right-to-left then for each $w\in\witness(p)$ we can read $w$ as an abstract notion of `potential witness for the beliefs of $p$'. 
\item
The nonemptiness conditions implies that every $p$ is witnessed by some nonempty $\varnothing\neq w\in\witness(p)$ --- even if $w$ is just equal to $\{p\}$. 
\end{enumerate} 
\end{rmrk}


\begin{defn}
\label{defn.trust.topology}
Suppose $(\ns P,\witness)$ is a witnessed set (Definition~\ref{defn.witnessed.set}).
\begin{enumerate*}
\item
Call $O\subseteq\ns P$ \deffont{$\witness$-witnessed} --- or just \deffont{witnessed} for short if meaning is clear --- when
$$
\Forall{p\in O} \Exists{w{\in}\witness(p)}w\subseteq O .
$$
In words, $O$ is witnessed when every $p\in O$ is accompanied in $O$ by some witness $w\in\witness(p)$. 
\item\label{item.witness.semitopology}
Let the \deffont{witness semitopology} $\opens(\witness)$ on $\ns P$ be the set of $\witness$-witnessed sets.
In symbols:
$$
\opens(\witness) = \{O\subseteq\ns P \mid \text{$O$ is $\witness$-witnessed} \} =  
\{ O\subseteq \ns P \mid \Forall{p\in O} \Exists{w{\in}\witness(p)}w\subseteq O \}.
$$ 
\end{enumerate*}
\end{defn}

\begin{lemm}
Suppose $(\ns P,\witness)$ is a witnessed set.
Then $\opens(\witness)$ from Definition~\ref{defn.trust.topology} is indeed a semitopology in the sense of Definition~\ref{defn.semitopology}.
\end{lemm}
\begin{proof}
Routine from the definitions.
\end{proof}


\begin{rmrk}
There is design freedom, whether we want to include (or exclude) $p\in w\in\witness(p)$: Definition~\ref{defn.trust.topology}(2) makes no commitment either way.

Lemma~\ref{lemm.might.as.well} is an easy observation that expresses a precise mathematical sense in which it does not really matter, so we can choose whatever is most convenient for a particular case.
We will make concrete use of this later, to prove Lemma~\ref{lemm.more-than-one}.
\end{rmrk}

\begin{lemm}
\label{lemm.might.as.well}
Suppose $(\ns P,\witness)$ is a witnessed set.
Let $\witness'$ and $\witness''$ be defined by\footnote{The case-split in $\witness''$ is required just because witness function in Definition~\ref{defn.witnessed.set}(\ref{witness.function}) must return a finite set of \emph{nonempty} sets.}
$$
\begin{array}{r@{\ }l}
\witness'(p)=&\{w\cup\{p\} \mid w\in\witness(p)\} 
\\
\witness''(p)=&\{w\setminus\{p\} \mid w\in\witness(p)\land w\neq\{p\}\}\cup\{w \mid w\in\witness(p)\land w=\{p\}\} 
\end{array}
$$
Then $(\ns P,\witness')$ and $(\ns P,\witness'')$ are also witnessed sets, and they generate the same witness semitopology as does $(\ns P,\witness)$.
\end{lemm}
\begin{proof}
By a routine calculation.
\end{proof}


\begin{rmrk}
Intuitively, $O\subseteq\ns P$ is open when every $p\in O$ is witnessed by some witness $w\in\witness(p)$ such that $w\subseteq O$. 

Note that $O$ need not contain \emph{every} witness of $p$: the condition in Definition~\ref{defn.trust.topology} is existential ($\Exists{w{\in}\witness(p)}w\subseteq O$), not universal.

We will use declarative programming to give an interpretation of witness functions as Horn clause theories in Subsection~\ref{subsect.declarative.witness}.
But first, we give examples and develop the motivating theory.
\end{rmrk} 






%%%%%%%%%%%%%%%%%%%
\subsection{Examples} 

\begin{rmrk}
\leavevmode
\begin{itemize*}
\item
Sometimes, proving the existence of a witness function $\witness$ to generate a given semitopology $(\ns P,\opens)$ as a witness semitopology (Definition~\ref{defn.trust.topology}) is fairly straightforward.
Lemma~\ref{lemm.finite.witness} gives a natural example of this.
\item
Sometimes, the existence of a witness function is less evident.
Lemma~\ref{lemm.all-but-one} illustrates one example of a non-obvious witness function for a semitopology, and Lemma~\ref{lemm.more-than-one} conversely illustrates an apparently not dissimilar semitopology, but for which no witness function exists.
\end{itemize*}
\end{rmrk}

\begin{lemm}
\label{lemm.finite.witness}
Suppose $(\ns P,\opens)$ is a semitoplogy and $\ns P$ is finite (so that $\opens$ is also finite).
Then $(\ns P,\opens)$ can be generated as the witness semitopology of $(\ns P,\witness)$ where
$$
\witness(p)=\{O\in\opens \mid p\in O\}.
$$
\end{lemm}
\begin{proof}
It is a fact that $\witness$ satisfies the conditions --- and in particular the finiteness conditions --- on a witness function in Definition~\ref{defn.witnessed.set}.
If $X\subseteq\ns P$ is a $\witness$-witnessed set then by Definition~\ref{defn.trust.topology}(1) $X$ is a union of open sets, and so it is open.
Conversely, if $O\in\opens$ then by construction it is $\witness$-witnessed, since each $p\in O$ is witnessed by $O$, so we are done. 
\end{proof}


\begin{lemm}
\label{lemm.all-but-one}
Consider the \emph{all-but-one semitopology} on $\mathbb Z$ from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}): so $X=\mathbb Z$ and opens have the form $\varnothing$ or $\mathbb Z$ or $\mathbb Z\setminus\{i\}$.
Then a witness function for this semitopology is: 
$$
\witness(i)=\{ \{i\minus 1, i\plus 1\},\ \mathbb Z\setminus\{i\plus 1\} \} 
$$
\end{lemm}
\begin{proof}
If $O$ is equal to $\varnothing$ or $\mathbb Z$ %or $\mathbb N\setminus\{0\}$ 
then there is nothing to prove.
So consider any $O\subseteq\mathbb Z$ and assume that:
\begin{enumerate*}
\item
$O$ is not equal to $\varnothing$ or $\mathbb Z$, and
\item
$O$ is an open in the witness semitopology for $\witness$.
\end{enumerate*}
By our first assumption above, there exists an $i\in\mathbb Z$ such that 
$$
i\in O \quad\text{and}\quad i\minus 1\not\in O.
$$
By our second assumption above, one of the following must hold:
\begin{itemize*}
\item
$\{i\minus 1,i\plus 1\}\subseteq O$ --- but this is impossible because we assumed $i\minus 1\not\in O$ --- and so
\item
it must be that $\mathbb Z\setminus\{i\plus 1\}\subseteq O$.
\end{itemize*} 
Thus $O=\mathbb Z\setminus\{i\plus 1\}$ and we are done.
\end{proof}

\begin{lemm}
\label{lemm.w.cwr}
A witness function for the semitopology used in Proposition~\ref{prop.conflicted.weakly.regular}, as illustrated in Figure~\ref{fig.weakly-regular.conflicted}, is
$$
\witness(w)=\{\{w0,w1\}\}.
$$
\end{lemm}
\begin{proof}
Setting $\witness(w)=\{\{w0,w1\}\}$ just expresses that if $w\in O$ then $w0,w_1\in O$, i.e. that $O$ is down-closed --- for `down' as illustrated in Figure~\ref{fig.weakly-regular.conflicted}.
\end{proof}

Lemma~\ref{lemm.more-than-one} will provide a key counterexample later in Lemma~\ref{lemm.elaborating}:
\begin{lemm}
\label{lemm.more-than-one}
Consider the \emph{more-than-one semitopology} on $\mathbb N$ from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.more-than-one}): so $X=\mathbb N$ and opens have the form $\varnothing$ or any set of cardinality more than one (i.e. containing at least two elements).
There is no witness function for this semitopology.
\end{lemm}
\begin{proof}
Suppose some such witness function $\witness$ exists.
Using Lemma~\ref{lemm.might.as.well} we may assume without loss of generality that $n\in w$ for every $w\in\witness(n)$ for every $n\in\mathbb N$.
Furthermore because no singletons are open, we know that $\{n\}\not\in\witness(n)$ for every $n\in\mathbb N$.

Now consider two distinct $n\neq n'\in\mathbb N$
We know that $\{n,n'\}$ is open, so it follows that one of the following must hold: 
\begin{enumerate*}
\item
\emph{Suppose $\{n,n'\}\in\witness(n)$ and $\{n,n'\}\not\in\witness(n')$.}\quad

This is impossible because $\{n'\}\not\in\witness(n')$ and $\witness(n')$ is not empty, so $\{n,n'\}$ could not be open. 
\item
\emph{Suppose $\{n,n'\}\in\witness(n')$ and $\{n,n'\}\not\in\witness(n)$.}\quad

This is also impossible because $\{n\}\not\in\witness(n)$ and $\witness(n)$ is not empty, so $\{n,n'\}$ could not be open. 
\item
It follows that $\{n,n'\}\in\witness(n)$ and $\{n,n'\}\in\witness(n')$.
\end{enumerate*}
It follows that $\{n,n'\}\in\witness(n)$ for \emph{every} $n'$ other than $n$.
But this contradicts finiteness of $\witness(n)$.
\end{proof}



%%%%%%%%%%%%%%%%
\subsection{Computing open and closed sets in witness semitopologies}


%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Computing open sets: $X$ is open when $X\preceq X$}

\begin{defn}
\label{defn.prec}
Suppose that $(\ns P,\witness)$ is a witnessed set (Definition~\ref{defn.witnessed.set}) and $X,X'\subseteq\ns P$.
Define the \deffont{witness (partial) ordering} by 
$$
X\preceq X'
\quad\text{when}\quad
X\subseteq X' 
\ \land\  
\Forall{p{\in}X}\Exists{w{\in}\witness(p)}w\subseteq X' .
$$ 
If $X\preceq X$ then call $X$ a \deffont{$\preceq$-fixedpoint}. 
\end{defn}

\begin{rmrk}
Intuitively, $X\preceq X'$ when $X'$ extends $X$ with (at least) one witnesses for every element $p\in X$.
\end{rmrk} 

\begin{lemm}
Suppose $(\ns P,\witness)$ is a witnessed set, and recall the witness ordering $\preceq$ from Definition~\ref{defn.prec}.
Then:
\begin{enumerate*}
\item
$\preceq$ is indeed a partial order (a transitive possibly irreflexive relation) on $\powerset(\ns P)$. 
\item
If $X\preceq X'$ then $X\subseteq X'$, or in symbols: ${\preceq}\subseteq{\subseteq}$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By routine calculations from Definition~\ref{defn.prec}.
\end{proof}

\begin{lemm}
\label{lemm.char.prec.open}
\label{lemm.obvious.open}
Suppose $(\ns P,\witness)$ is a witnessed set. 
Then the following are equivalent:
\begin{itemize*}
\item
$O$ is open in the witness semitopology (Definition~\ref{defn.trust.topology}).
\item
$O$ is a $\preceq$-fixedpoint (Definition~\ref{defn.prec}).
\end{itemize*}
In symbols:
$$
\opens(\witness) = \{ X\subseteq\ns P \mid X\preceq X\} .
$$
\end{lemm}
\begin{proof}
Being a $\preceq$-fixedpoint in Definition~\ref{defn.prec} --- every point in $O$ is witnessed by a subset of $O$ --- simply reformulates the openness condition from Definition~\ref{defn.trust.topology}.
\end{proof}


\begin{prop}
\label{prop.open.limit}
\label{prop.prec.upchain}
Suppose $(\ns P,\witness)$ is a witnessed set and suppose $\mathcal X=(X_0\preceq X_1\preceq\dots)$ is a countably ascending $\preceq$-chain.
Write $\bigcup \mathcal X$ for the union $\bigcup_i X_i$ of the elements in $\mathcal X$.
Then:
\begin{enumerate*}
\item
$\bigcup\mathcal X$ is a $\preceq$-limit for $\mathcal X$.
In symbols: $\Forall{i}X_i\preceq\bigcup\mathcal X$.
\item
$\bigcup\mathcal X$ is a $\preceq$-fixedpoint and so (by Lemma~\ref{lemm.char.prec.open}) is open.
In symbols: $\bigcup\mathcal X\preceq\bigcup\mathcal X\in\opens$.
\end{enumerate*} 
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We must show that if $p\in X_i$ then $w\subseteq\bigcup\mathcal X$ for some $w\in\witness(p)$.
But this is automatic from the fact that $X_i\preceq X_{i\plus 1}\subseteq\bigcup\mathcal X$.
\item
From part~1 noting that if $p\in\bigcup\mathcal X$ then $p\in X_i$ for some $i$.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}[Computing open sets]
\label{rmrk.computing.open.sets}
Proposition~\ref{prop.open.limit} and Lemma~\ref{lemm.obvious.open} above are not complicated\footnote{This is a feature and did not happen by accident: it required design effort.} 
and they say something important: in the \emph{witness} semitopology, open sets can be computed with a simple loop that accumulates a set of points; and for each point in the set so far, add some choice of witness of that point to the set (if one is not already present); repeat until we reach a fixed point; then return the result.

In more detail: to compute an open set in the witness semitopology, pick some $p\in\ns P$ and set $R_0=\{p\}$.
Once $R_i$ is defined, for each $p'\in R_i$ nondeterministically pick some witness $w(p')\in\witness(p')$ and set $R_{i\plus 1}=R_i\cup\bigcup_{p'\in R_i}w(p')$.
Terminate with a result when we reach a fixedpoint.

This algorithm is nondeterministic and could run forever if $\ns P$ is infinite, but it is an algorithm and it is local in the sense of Remark~\ref{rmrk.local}.
We continue this thread in Remarks~\ref{rmrk.computing.closed.sets} and~\ref{rmrk.algorithms}. 
\end{rmrk}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Computing closed sets using limit points: $\closure{R}=\f{lim}(R)$}


\begin{defn}
\label{defn.O.between.R}
Suppose $R$ is a set and $\mathcal W$ is a set (or a sequence) of sets.
Define $R\between \mathcal W$ by
$$
R\between\mathcal W
\quad\text{when}\quad
\Forall{W{\in}\mathcal W}R\between W .
$$
In words: $R\between \mathcal W$ when $R$ intersects with every $W\in\mathcal W$.
\end{defn}


\begin{defn}
\label{defn.admires}
Suppose $(\ns P,\witness)$ is a witnessed set and $R\subseteq\ns P$.
Define $\f{lim}_w(R)$ by
$$
\f{lim}_w(R) = R \cup \{p\in\ns P \mid R\between\witness(p) \} .
$$ 
In words: $\f{lim}_w(R)$ is the set of points $p$ whose every witness contains an $R$-element.

We iterate this:
$$
\begin{array}{r@{\ }l@{\quad}l}
\f{lim}_0(R) =& R
\\
\f{lim}_{i\plus 1}(R)=&\f{lim}_w(\f{lim}_i(R))
\\
\f{lim}(R)=&\bigcup_{n\geq 0}\f{lim}_n(R)
\end{array}
$$
We call $\f{lim}(R)$ the set of \deffont{limit points} of $R$.
\end{defn}

\begin{rmrk}
In Definition~\ref{defn.witnessed.set}(\ref{witness.function}) we insisted that $\witness(p)$ is nonempty for every point $p$.
This avoids a degenerate situation in the definition of $\f{lim}_w(R)$ in Definition~\ref{defn.admires} above in which the condition $R\between \witness(p)$ is vacuously satisfied by a $p$ with empty $\witness(p)$ (i.e. by a $p$ with no witnesses).
Definition~\ref{defn.witnessed.set}(\ref{witness.function}) excludes this by insisting that $p$ has to have at least one witness, even if it is just $\witness(p)=\{\{p\}\}$.
\end{rmrk}

\begin{lemm}
\label{lemm.R.subset.lim.R}
Suppose $(\ns P,\witness)$ is a witnessed set and $R\subseteq\ns P$.
Then 
$$
R\subseteq\f{lim}(R).
$$
\end{lemm}
\begin{proof}
It is a fact of Definition~\ref{defn.admires} that $R=\f{lim}_0(R)\subseteq\f{lim}_1(R)\subseteq\f{lim}(R)$. 
\end{proof}

\begin{lemm}
\label{lemm.limit.is.open}
Suppose $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ and $R\subseteq\ns P$.
Then:
\begin{enumerate*}
\item
If $\f{lim}(R)\between\witness(p)$  (Definition~\ref{defn.O.between.R}) then $p\in \f{lim}(R)$.
\item
By the contrapositive and expanding Definition~\ref{defn.O.between.R},
$$
p\in \ns P\setminus\f{lim}(R)
\quad\text{implies}\quad
\Exists{w{\in}\witness(p)}w\cap \f{lim}(R)=\varnothing. 
$$
\end{enumerate*}
\end{lemm}
\begin{proof}
Suppose $\f{lim}(R)\between\witness(p)$.
Unpacking Definitions~\ref{defn.O.between.R} and~\ref{defn.admires} it follows that for every $w{\in}\witness(p)$ there exists $n_w\geq 0$ such that $\f{lim}_{n_w}(R)\between w$.
Now by Definition~\ref{defn.witnessed.set}(\ref{witness.function}) $\witness(p)$ is finite, and 
it follows that for some/any $n$ greater than the maximum of all the $n_w$, we have $\f{lim}_n(R)\between\witness(p)$.
Thus $p\in\f{lim}_w(\f{lim}_n(R))\subseteq\f{lim}(R)$ as required.
\end{proof}

\begin{lemm}
\label{lemm.O.between.lim.R}
Suppose $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ and $R\subseteq\ns P$ and $O\in\opens$.
Then:
\begin{enumerate*}
\item
If $O\between \f{lim}_w(R)$ then $O\between R$.
\item
If $O\between \f{lim}(R)$ then $O\between R$.
\item
As a corollary, if $O\cap R=\varnothing$ then $O\cap\f{lim}(R)=\varnothing$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Consider $p\in\ns P$ such that $p\in O$ and $p\in\f{lim}_w(R)$.
By assumption there exists $w\in\witness(p)$ such that $w\subseteq O$.
Also by assumption $w\between R$.
It follows that $O\between R$ as required.
\item
If $O\between\f{lim}(R)$ then $O\between\f{lim}_n(R)$ for some finite $n\geq 0$.
By a routine induction using part~1 of this result, it follows that $O\between R$ as required.
\item
This is just the contrapositive of part~2 of this result, noting that $O\between R$ when $O\cap R=\varnothing$ by Notation~\ref{nttn.between}, and similarly for $O\between\f{lim}(R)$.
\qedhere\end{enumerate}
\end{proof}

\begin{prop}
\label{prop.lim.is.closure}
Suppose $(\ns P,\witness)$ is a witnessed set and suppose $R\subseteq\ns P$.
Then:
$$
\f{lim}(R) = \closure{R} .
$$
In words: the set of limit points of $R$ from Definition~\ref{defn.admires} is equal to the topological closure of $R$ from Definition~\ref{defn.closure}.
\end{prop}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
\emph{Suppose $p\not\in\closure{R}$.}\quad

Then there exists some $p\in O\in\opens$ such that $O\cap R=\varnothing$.
Thus by Lemma~\ref{lemm.O.between.lim.R}(3) also $O\cap\f{lim}(R)=\varnothing$. 
\item
\emph{Suppose $p\not\in \f{lim}(R)$.}\quad

By Definition~\ref{defn.closure} we need to exhibit an $p\in O\in\opens$ that is disjoint from $R$, and since $R\subseteq\f{lim}(R)$ by Lemma~\ref{lemm.R.subset.lim.R}, 
it would suffice to exhibit $p\in O\in\opens$ that is disjoint from $\f{lim}(R)$.
We set %take as our $O$ the sets complement of $\f{lim}(R)$ itself:
$$
O=\ns P\setminus \f{lim}(R).
$$
Lemma~\ref{lemm.limit.is.open}(2) expresses precisely that this is an open set in the witness semitopology, and by construction it is disjoint from $\f{lim}(R)$.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}[Computing closed sets]
\label{rmrk.computing.closed.sets}
As in Remark~\ref{rmrk.computing.open.sets} we see that in the \emph{witness} semitopology, closed sets can be computed with a simple loop that accumulates a set of points so far: and for each point in the space, if all of its witnesses intersect with the set of points so far, add that point to the set so far; repeat until we reach a fixed point; return the result. 

In more detail: to compute a closed set in the witness semitopology, pick some $p\in\ns P$ and set $R_0=\{p\}$.
Once $R_i$ is defined, for every $p\in \ns P$ check if $w\between R_i$ for \emph{every} witness $w\in\witness(p)$ and collect these $p$ into a set $B_i$.  Set $R_{i\plus 1}=R_i\cup B_i$.
Terminate with a result when we reach a fixedpoint.

This algorithm could run forever if $\ns P$ is infinite, but it is an algorithm and it is local in the sense of Remark~\ref{rmrk.local}.\footnote{The quantification over every point is local in the sense we intend: participants would listen for queries from peers on the channel ``I am trying to compute an open set; here is my $R_i$; do you want to join it?''.} 
\end{rmrk}




\begin{rmrk}[Summing up]
\label{rmrk.distributed.witnesses}
From a distributed-computing perspective, it might at first appear that working with semitopologies would require some form of prior coordination: e.g.\ for participants to at least have common knowledge of their shared, minimal open neighbourhoods.

For, consider a new participant $p$ joining a permissionless system based on semitopology: how is $p$ supposed to know which are the open sets?

However, and suprisingly, we have seen that \emph{witness semitopologies can be built without any coordination}.
Each participant just unilateraly choses a set of witness sets.
As discussed in Remarks~\ref{rmrk.computing.open.sets} and \ref{rmrk.computing.closed.sets}, and even in an infinite semitopology, Lemma~\ref{lemm.obvious.open} indicates that a participant can discover its open neighbourhoods by exploring witness sets breadth-first, and Proposition~\ref{prop.lim.is.closure} suggests a distributed algorithm to compute closures.

We make no claims to efficiency (we have not even set up machinery in this paper to measure what that would mean) but what matters is that for witness semitopologies such procedures exist, in contrast e.g.\,to the uncomputable semitopology from Example~\ref{xmpl.uncomputable.semitopology}.

In the next subsection we offer an interpretation of witness functions that in some sense explains why this should be so,
and gives a new intuition of why witness semitopologies are amenable to a distributed, local, uncoordinated computation in the style that we require.
\end{rmrk}


\subsection{Declarative content of witness semitopologies: witness function = Horn clause theory}
\label{subsect.declarative.witness}

\begin{rmrk} 
\label{rmrk.algorithms}
Recall that a \emph{sequential space} is one in which the sets closed under convergent sequences, are precisely the closed sets.
Proposition~\ref{prop.lim.is.closure} ($\f{lim}(R) = \closure{R}$) looks, just a bit, like a sequential space closure result.
Looking more closely, we see that the similarity comes from the fact that the definition uses an $\omega$-iteration that is, just a little, reminiscent of a converging $\omega$-sequence of points. 
Perhaps surprisingly, we can make this resemblance into something much more precise, as follows: 
\end{rmrk}




\begin{defn}
\label{defn.logic}
Suppose $(\ns P,\witness)$ is a finite witnessed set (so $\ns P$ is a finite set).
\begin{enumerate}
\item
Let the \deffont{derived logic} $\tf{Prop}(\ns P,\witness)$ be a propositional syntax with connectives $\tbot$, $\ttop$, $\tor$, $\tand$, and $\timp$ over a set of \deffont{atomic predicate symbols} $\bar{\ns P}=\{\bar p\mid p\in\ns P\}$.

Note that $\bar p$ is just a symbol in our formal syntax; there is one such for each point $p\in\ns P$.
\item
For each $p\in\ns P$ define an \deffont{axiom} 
$$
\bar\witness(p) = \bigl( \tand_{w\in\witness(p)} \tor_{q\in w} \bar q\bigr) \timp \bar p 
$$
and collect these axioms into a set
$$
\tf{Ax}(\ns P,\witness) = \{\bar\witness(p)\mid p\in\ns P\}.
$$
\item
A \deffont{sequent} $\Phi\barcent\Psi$ is a pair of finite sets of propositions in the syntax of $\tf{Prop}(\ns P,\witness)$.
\item
Call $\Phi\barcent\Psi$ \deffont{derivable} when $\Phi,\tf{Ax}(\ns P,\witness)\cent\Psi$ is derivable in first-order logic.
\item\label{item.S.deductively.closed}
If $S\subseteq\ns P$ write $\bar S=\{\bar p\mid p\in S\}$.
Call $\bar S$ a \deffont{model} or \deffont{answer set} for $\tf{Ax}(\ns P,\witness)$ when 
$$
\Forall{p{\in}\ns P}(\bar S\barcent \bar p \limp \bar p\in\bar S).
$$
\end{enumerate}
\end{defn}


\begin{prop}[Declarative interpretation]
Suppose $(\ns P,\witness)$ is a finite witnessed set and $S\subseteq\ns P$.
Then the following are equivalent: 
\begin{itemize*}
\item
$S$ is closed in the witness semitopology (Definition~\ref{defn.trust.topology}).
\item
$\bar S$ is a model (Definition~\ref{defn.logic}(\ref{item.S.deductively.closed})).
\end{itemize*}
\end{prop}
\begin{proof}
The condition for $T\subseteq\ns P$ to be an open set (Definition~\ref{defn.trust.topology}) can be written as 
$$
p\in T \limp \Exists{w{\in}\witness(p)}\Forall{q{\in}w} q\in T .
$$
Taking the contrapositive we derive 
$$
\bigl(\Forall{w{\in}\witness(p)}\Exists{q{\in}w} q\not\in T \bigr) \limp p\not\in T . 
$$
If we write $S=\ns P\setminus T$ and $q{\in}S$ as $\bar q$ and $p{\in}S$ as $\bar p$, then we recover the axiom $\bar\witness(p)$ from Definition~\ref{defn.logic}.

It follows by routine reasoning that $S$ is a model for $\tf{Ax}(\ns P,\witness)$ if and only if $S$ is the complement of an open set; and by Lemma~\ref{lemm.closed.complement.open} this is precisely when $S$ is closed. 
\end{proof}

\begin{rmrk}
\label{rmrk.horn}
An axiom $\bar\witness(p)$ consists of a propositional goal implied by a conjunction of disjunctions of (unnegated) propositional goals.  
This fits the Horn clause syntax from Section~3 of~\cite{miller:unipfl}, and it can be translated into a more restricted Prolog-like syntax if required, just by expanding the disjuncts into multiple clauses using the \rulefont{\tor L} rule.\footnote{An example makes the point: $((\bar q\tor\bar q')\tand\bar q'') \timp\bar p$ is equivalent to two simpler clauses $(\bar q\tand \bar q'')\timp\bar p$ and $(\bar q'\tand\bar q'')\timp \bar p$; for more details see~\cite{miller:unipfl}.} 

Thus closed sets --- and so also open sets, which are their complements --- can be computed from the axioms $\tf{Ax}(\ns P,\witness)$ by asking a suitable propositional solver to compute \emph{models}. 
Answer Set Programming (ASP) tool is one such tool~\cite{lifshitz:whaasp,lifshitz:anssp}.\footnote{We derived a concrete, if inefficient, algorithm for computing closed sets in Remark~\ref{rmrk.computing.closed.sets}.  So what we have now done is put this in a broader context and observed that what we were doing all along was program an ASP task.}

Investigating how such tools might be brought to bear on consensus problems is future work.
We can just give a hint on how this would be done: it is a fact (which we will prove in a journal version of this paper) that maximal topens can also be characterised as open interiors of minimal closed sets with a nonempty open interior; so the ASP task to find all maximal topens is to find all minimal closed sets (i.e. minimal models of the axioms above), and then select those that contain a nonempty open set.
\end{rmrk}


\begin{rmrk}
Just because closed sets of finite witness semitopologies can be presented as answer sets (models) does not make (witness) semitopologies into a branch of answer set programming, because:
\begin{enumerate*}
\item
The queries of interest (like \emph{``Find a maximal topen set''} or \emph{``Find all the points intertwined with $p$''}) are second-order, involving quantification over models to check e.g. that they intersect.
See e.g. the quantification over $O$ and $O'$ in Definition~\ref{defn.intertwined.points}(1).
\item
Semitopologies can be infinite in general.
\item
We care about distributed algorithms that can be evaluated with the best possible efficiency across a distributed network.
\end{enumerate*}
\end{rmrk}


\section{Chain-complete and chain-bounded semitopologies}
\label{sect.cc.cb}

\subsection{Definition and discussion}


\begin{rmrk}
Just as for topologies, in semitopologies it is not true in general that the intersection of a descending chain of open sets is open.

Consider $\mathbb N$ with the semitopology generated by $O\subseteq\mathbb N$ such that $\{0\}\subsetneq O$.
Then $(\{0\}\cup i_\geq\mid i\geq 1)$ where $i_\geq=\{i'\mid i'\geq i\}$ is a descending chain of open sets, but its intersection $\{0\}$ is not open.

For the special case of \emph{witness} semitopologies, we can say something considerably stronger, as we shall see in Definition~\ref{defn.chain-complete} and Theorem~\ref{thrm.lim.O.open}.
\end{rmrk} 



\begin{defn}
\label{defn.chain-complete}
\leavevmode
\begin{enumerate*}
\item\label{item.chain-complete}
Call a semitopology \deffont{chain-complete} when for every nonempty descending $\alpha$-chain of open sets $\mathcal O\subseteq\opens$ (Definition~\ref{defn.ascending.chains}), its intersection $\bigcap\mathcal O$ is open.
\item\label{item.chain-bounded}
Call a semitopology \deffont{chain-bounded} when for every nonempty descending $\alpha$-chain of open and nonempty sets $\mathcal O\subseteq\opens$, its intersection $\bigcap\mathcal O$ is open and nonempty.
\end{enumerate*}
\end{defn}

\begin{rmrk}
The main mathematical/technical properties that come out of a semitopology being chain-complete/chain-bounded are:
\begin{itemize*}
\item
Lemma~\ref{lemm.zorn.for.open.covers} and Corollary~\ref{corr.cover.exists} (existence of open covers), and 
\item
Lemma~\ref{lemm.zorn.for.atoms} and Corollary~\ref{corr.atom.exists} (existence of open atoms) respectively.
\end{itemize*}
However, before we come to that, we will set up some machinery and check some motivating properties.
For a summary, see the discussion in Remark~\ref{rmrk.plausible.abstraction}.
\end{rmrk}
 


\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology.
Then if $\ns P$ is chain-bounded, then it is chain-complete.
\end{lemm}
\begin{proof}
Consider a descending chain of open sets $\mathcal O$.
If one of the elements in $\mathcal O$ is empty then $\bigcap\mathcal O=\varnothing$ and $\varnothing\in\opens$ so we are done.
If all of the elements in $\mathcal O$ are nonempty then by chain-boundedness $\bigcap\mathcal O$ is nonempty and open, and thus in particular it is open.
\end{proof} 


\begin{xmpl}
\leavevmode
\begin{enumerate}
\item
The \emph{all-but-one} and \emph{more-than-one} semitopologies (see Examples~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}\&\ref{item.counterexample.more-than-one})) are chain-bounded (and chain-complete).
\item
The closed interval $[\minus 1,1]$ with its usual topology is not chain-complete (and not chain-bounded): e.g. $\{(\minus 1/i, 1/i) \mid i\geq 1\}$ is a descending chain of open sets but its intersection $\{0\}$ is not open.
Similarly for the two semitopologies on $\mathbb Q^2$ in Example~\ref{xmpl.two.topen.examples}.

(Looking ahead just for a moment to Theorem~\ref{thrm.lim.O.open}, this tells us that these semitopologies cannot be generated by witness functions.)
\item  
Recall $\mathbb N$ with the final segment semitopology from Example~\ref{xmpl.meet-irreducible}(\ref{item.final.N}) (so opens are either $\varnothing$ or sets $n_\geq = \{n'\in\mathbb N \mid n'\geq n\}$).
This is chain-complete, but not chain-bounded: for instance $(n_\geq \mid n\geq 0)$ is a descending chain of open sets, and its intersection is equal to $\varnothing$, which is open, but is not nonempty.
\end{enumerate}
\end{xmpl}


\begin{lemm}
\leavevmode
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
$\ns P$ is chain-complete if and only if the union of any ascending chain of closed sets, is closed.
\item
$\ns P$ is chain-bounded if and only if the union of any ascending chain of closed sets that are not equal to $\ns P$, is closed and not equal to $\ns P$. 
\end{enumerate*}
\end{lemm}
\begin{proof}
Direct from Definition~\ref{defn.chain-complete} using Lemma~\ref{lemm.closed.complement.open}, which notes that closed sets are the complements of open sets (just as for topologies).
\end{proof}



\subsection{Witness semitopologies are chain-complete}


\begin{thrm}
\label{thrm.lim.O.open}
Suppose that
$(\ns P,\witness)$ is a witnessed set.
Then the witness semitopology from Definition~\ref{defn.trust.topology} is chain-complete.

Unpacking this we can say:
\begin{quote}
In a witness semitopology, intersections of descending chains of open sets are open, and unions of ascending chains of closed sets are closed.
\end{quote}
\end{thrm}
\begin{proof}
Consider a descending $\alpha$-chain of open sets $\mathcal O=(O_{\beta} \mid \beta<\alpha) \subseteq\opens$ for $\alpha\geq 1$.
There are three cases:
\begin{itemize}
\item
\emph{Suppose $\bigcap\mathcal O=\varnothing$.}\quad

Then we note that $\varnothing\in\opens$ (Definition~\ref{defn.semitopology}(\ref{semitopology.empty.and.universe})) and we are done.
\item
\emph{Suppose $\alpha=\alpha'\plus 1$, so that $\alpha$ is a successor ordinal.}\quad

Then the sequence $\mathcal O$ has a final element $O_\alpha$ and by facts of sets $\bigcap\mathcal O=O_\alpha\in\opens$ and again we are done.
\item
\emph{Suppose $\alpha$ is a nonzero limit ordinal and $\bigcap\mathcal O\neq\varnothing$.}

Consider some $p\in\bigcap\mathcal O$.
By construction of the witness semitopology (Definition~\ref{defn.trust.topology}) for each $O_i$ there exists a witness $w_i\in\witness(p)$ such that $w_i\subseteq O_i$.
Now by Definition~\ref{defn.witnessed.set}(\ref{witness.function}) $\witness(p)$ is finite, so by the pigeonhole principle, there exists some $w\in\witness(p)$ such that $w=w_i$ for infinitely many $w_i\in\witness(p)\land w_i\subseteq O_i$.
It follows from the fact that $\mathcal O$ is a descending chain that $w\subseteq\bigcap\mathcal O$. 

Now $p$ in the previous paragraph was arbitrary, so we have shown that if $p\in\bigcap\mathcal O$ then also there exists $w\in\witness(p)$ such that $w\subseteq\bigcap\mathcal O$. 
It follows by construction of the witness semitopology in Definition~\ref{defn.trust.topology} that $\bigcap\mathcal O$ is open as required.
\qedhere\end{itemize}
\end{proof}


\begin{lemm}
\label{lemm.elaborating}
The reverse implication in Theorem~\ref{thrm.lim.O.open} does not hold: there exists a chain-complete semitopology that is not generated as the witness semitopology of a witnessed set.
\end{lemm}
\begin{proof}
It is a fact that the more-than-one semitopology on $\mathbb N$ (having open sets generated by distinct pairs $\{i,i'\}\subseteq\ns P$; see Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.more-than-one})) is chain-complete, but by Lemma~\ref{lemm.more-than-one} is is not generated by a witness function.
\end{proof}


\begin{rmrk}
Elaborating further on Lemma~\ref{lemm.elaborating}, suppose $(\ns P,\opens)$ is a chain-complete semitopology.
Then to every $p$ we can assign a nonempty set $\mathcal O_p$ of \emph{covers} (minimal open sets containing $p$; see Definition~\ref{defn.open.covers}).

Can we obtain a witness function just by setting $\witness(p)=\mathcal O_p$?
No: because $p$ need not have finitely many covers, and Definition~\ref{defn.witnessed.set} insists on a \emph{finite} set of (possibly infinite) nonempty witness sets.\footnote{See Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}) for an example of a semitopology containing points with infinitely many covers, though interestingly, this \emph{can} be generated by a witness function, as noted in Lemma~\ref{lemm.all-but-one}.}  

We could allow an infinite set of witnesses in Definition~\ref{defn.witnessed.set}, but at a price:
\begin{itemize*}
\item
The proof of Theorem~\ref{thrm.lim.O.open} depends on the pigeonhole principle, which uses finiteness of the witness set.
\item
The proof of Lemma~\ref{lemm.limit.is.open} depends on witness sets being finite, and this is required for Proposition~\ref{prop.lim.is.closure}.
\end{itemize*}
\end{rmrk}



\begin{rmrk}
\label{rmrk.characterise.witness.semitopologies}
Theorem~\ref{thrm.lim.O.open} shows that witness semitopologies are chain-complete, but Lemma~\ref{lemm.elaborating} demonstrates that this cannot precisely characterise witness semitopologies.
Might there be another way?

We might look at Corollary~\ref{corr.cover.exists} (open covers exist), cross-reference with Definition~\ref{defn.witnessed.set}(\ref{witness.function}) (every $p$ has only finitely many witnesses), and ask if we might characterise witness semitopologies as those topologies that are chain-complete \emph{and} every $p$ has finitely many open covers (Definition~\ref{defn.open.covers}(\ref{item.open.cover})).

No: by Lemma~\ref{lemm.all-but-one}, the all-but-one semitopology from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}) is a witness semitopology, and if the underlying set of points is infinite then every point has infinitely many covers.
See also Remark~\ref{rmrk.two.open.problems}(1).
\end{rmrk}

 
\begin{prop}
\label{prop.finite.chain-bounded}
\leavevmode
\begin{enumerate*}
\item
Not every witness semitoplogy (Definition~\ref{defn.trust.topology}) is chain-bounded (Definition~\ref{defn.chain-complete}(\ref{item.chain-bounded})).
\item
Part~1 holds even if we restrict the witness function 
$\witness:\ns P\to\finpow_{\neq\varnothing}(\powerset_{\neq\varnothing}(\ns P))$ in Definition~\ref{defn.witnessed.set}(\ref{witness.function}) to return a finite set of finite witnesses, so that 
$\witness:\ns P\to\finpow_{\neq\varnothing}(\finpow_{\neq\varnothing}(\ns P))$.
\item
Every \emph{finite} semitopology (this includes every finite witness semitopology) is chain-complete and chain-bounded.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
It suffices to provide a counterexample.
Consider $\mathbb N$ with witness function $\witness(i)=\{\{i\plus 1\}\}$.
This generates a semitopology with open sets generated by $i_\geq=\{i'\in\mathbb N\mid i'\geq i\}$.
Then $(i_\geq\mid i\in\mathbb N)$ is a descending chain of open sets with an open, but empty, intersection.
\item
We just use the counterexample in part~1.
\item
If the semitopology is finite then every descending chain of open sets is eventually stationary; so we just take the final element in the chain. 
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
\label{rmrk.plausible.abstraction}
We are particularly interested in the concrete example of finite witnessed semitopologies, since these are the ones that we can actually implement.
But we can ask what it is about this class of examples that makes them mathematically well-behaved; what essential algebraic features might we identify here?
Proposition~\ref{prop.finite.chain-bounded} suggests that \emph{chain-boundedness} may be a suitable mathematical abstraction: 
\begin{itemize*}
\item
by Proposition~\ref{prop.finite.chain-bounded}(3) the abstraction is sound (every finite witness semitopology is indeed chain-bounded), and 
\item
Theorem~\ref{thrm.lim.O.open} asserts that for a (possibly infinite) $(\ns P,\opens)$, any convergence using a descending sequence of open sets has a flavour of being `locally finite' in the sense of being guaranteed to have a nonempty open intersection.\footnote{There is also a computational interpretation to (chain-boundedness/)chain-completeness: think of a descending chain of open sets as a computation that computes to narrow down possibilities to smaller and smaller nonempty open sets, then this possibly infinite computation does deliver a final answer that is a (nonempty) open set.} 
\end{itemize*}
So chain-bounded semitopologies are a plausible abstraction of finite witness semitopologies.\footnote{There may be more than one such abstraction; identifying one candidate does not mean there may not be others.  For example, both \emph{rings} and \emph{models of first-order arithmetic} are valid abstractions of the notion of `number'.  Which of these mathematical structures we work with, depends on which aspects of the concrete thing we are interested in studying.}
The test is now to explore the theory of chain-bounded semitopologies and see if they preserve enough structure, and enough of the right kind of structure, to model how finite witness semitopologies are applied to heterogeneous consensus. 

Key results in this direction are Corollaries~\ref{corr.cover.exists} and~\ref{corr.atom.exists}, which ensure that in a chain-bounded semitopology, open covers and atoms always exist, and we will build from there.
\end{rmrk}



\subsection{Minimal sets: open covers and atoms}

\subsubsection{Open covers (minimal open neighbourhoods)}

First, some useful notation:
\begin{nttn}
\label{nttn.gtrdot}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Write 
$$
O\gtrdot P \quad\text{and synonymously}\quad P\lessdot O
$$
when $O$ is a minimal nonempty open set containing $P$.
In symbols:
$$
O\gtrdot P
\quad\text{when}\quad
O\neq\varnothing\land P\subseteq O\land \Forall{O'{\in}\opens}(P\subseteq O'\subseteq O \limp O'=O).
$$
We may combine $\gtrdot$ with other relations for compactness.
For example:
\begin{itemize*}
\item
$p\in O\gtrdot P$ is shorthand for $p\in O \land O\gtrdot P$; and 
\item
$P\supseteq O\gtrdot Q$ is shorthand for $O\subseteq P\land O\gtrdot Q$.
\end{itemize*}
\end{nttn}


Definition~\ref{defn.open.covers} collects some (standard) terminology.
\begin{defn}
\label{defn.open.covers}
\leavevmode
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
\begin{enumerate}
\item
Call $O\in\opens$ an \deffont{(open) neighbourhood} of $p$ when $p\in O$.
\item\label{item.open.cover}
Call $O\in\opens$ an \deffont{(open) cover} of $p$, write 
$$
O\gtrdot p
\quad\text{and/or}\quad 
p\lessdot O, 
$$
and say that $O$ \deffont{covers} $p$, when $O\gtrdot\{p\}$ (Notation~\ref{nttn.gtrdot}).

In words using the terminology of part~1: $O\gtrdot p$ when $O$ is a minimal open neighbourhood of $p$.
\item
Write $\f{Covers}(p)$ for the set of open covers of $p$.
In symbols:
$$
\f{Covers}(p)=\{O\in\opens \mid p\lessdot O\} .
$$
\end{enumerate}
\end{defn}




\begin{lemm}
\label{lemm.zorn.for.open.covers}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and suppose $\varnothing\neq\mathcal O\subseteq\opens$ is a nonempty set of nonempty open sets that is $\subseteq$-down-closed (meaning that if $\varnothing\neq O'\subseteq O\in\mathcal O$ then $O'\in\mathcal O$).

Then $\mathcal O$ contains a $\subseteq$-minimal element. 
\end{lemm}
\begin{proof}
A straightforward application of Zorn's Lemma~\cite{jech:axic,campbell:orizl}:
By chain-boundedness, $\mathcal O$ ordered by the \emph{superset} relation (the reverse of the subset inclusion relation), contains limits, and so upper bounds, of ascending chains.
By Zorn's Lemma, $\mathcal O$ contains a $\supseteq$-maximal element.
This is the required $\subseteq$-minimal element.
\end{proof}


\begin{corr}[Existence of open covers]
\label{corr.cover.exists}
Suppose $(\ns P,\opens)$ is a chain-complete semitopology and $p\in\ns P$.
Then $p$ has at least one open cover.
In symbols:
$$
\Exists{O\in\opens} p\lessdot O
\quad\text{and equivalently}\quad
\f{Covers}(p) \neq\varnothing.  
$$
Furthermore, if $p\in O'\in\opens$ then $O'$ contains an open cover of $p$.
In symbols: 
$$
\Exists{O\in\opens} p\lessdot O\subseteq O' .
$$
\end{corr}
\begin{proof}
Direct from Lemma~\ref{lemm.zorn.for.open.covers}, considering 
$\{O\in\opens \mid p\in O\}$ (nonempty because it contains $\ns P$) and $\{O\in\opens \mid p\in O\subseteq O'\}$ (nonempty because it contains $O'$).
\end{proof}

\begin{rmrk}
\label{rmrk.uncomputable.semitopology}
Recall that our semitopological analysis of consensus is all about continuity and value assignments being locally constant --- as per Definitions~\ref{defn.continuity}(\ref{item.continous.function.at.p}) and~\ref{defn.value.assignment} and results like Lemma~\ref{lemm.open.lc} --- and these discussions are about the open neighbourhoods of $p$.
Thus, to understand consensus at $p$ we need to understand its open neighbourhoods.

Corollary~\ref{corr.cover.exists} tells us that in a witness semitopology, 
we can simplify and just consider the open covers of $p$.
This is because if a continuous function $f:\ns P\to\ns P'$ such that $f(p)=p'\in O'$ is continuous at $p\in\ns P$, then using continuity and Corollary~\ref{corr.cover.exists} there exists some open cover $p\lessdot P\subseteq f^\mone(O')$.

Turning this around, if we want to \emph{create} consensus around $p$ --- perhaps as part of a consensus algorithm --- it suffices to find some open cover of $p$, and convince that cover.
This fact is all the more powerful because Corollary~\ref{corr.cover.exists} does not assume that $\ns P$ is finite: it is a fact of witness semitopologies of any cardinality.
\end{rmrk}


\subsubsection{Atoms (minimal nonempty open sets)}


\begin{defn}
\label{defn.atomic.open.set}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate}
\item\label{item.atom}
Call $A\in\opens$ an \deffont{(open) atom} when $A$ is a minimal nonempty open set.\footnote{An open atom covers every point that it contains, but an open cover for a point $p$ need not be an atom, since it may contain a smaller open set --- just not one that contains $p$.  See Example~\ref{xmpl.p.not.in.O}(\ref{item.atom.need.not.contain.p}).} 
In symbols using Notation~\ref{nttn.gtrdot} this is: 
$$
A\gtrdot\varnothing \quad\text{and synonymously}\quad \varnothing\lessdot A.
$$
\item\label{item.atoms.of.P}
If $P\subseteq\ns P$ then write $\f{Atoms}(P)$ for the atoms that are subsets of $P$. 
In symbols:
$$
\f{Atoms}(P) = \{A\in\opens \mid \varnothing\lessdot A \subseteq P\} .
$$
\end{enumerate}
\end{defn}


\begin{lemm}
\label{lemm.zorn.for.atoms}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and suppose $\varnothing\neq\mathcal O\subseteq\opens$ is a nonempty set of nonempty open sets that is $\subseteq$-down-closed (meaning that if $\varnothing\neq O'\subseteq O\in\mathcal O$ then $O'\in\mathcal O$).

Then $\mathcal O$ contains an atom.
\end{lemm}
\begin{proof}
By chain-boundedness, $\mathcal O$ ordered by the \emph{superset} relation (the reverse of the subset inclusion relation), contains limits, and so upper bounds, of ascending chains.
By Zorn's Lemma, $\mathcal O$ contains a $\supseteq$-maximal element.
This is a $\subseteq$-minimal element and is the required atom.
\end{proof}


\begin{corr}[Existence of atoms]
\label{corr.atom.exists}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and $\varnothing\neq O\in\opens$ is a nonempty open set.
Then $O$ contains an atom.
In symbols:
$$
\f{Atoms}(O)\neq\varnothing .
$$
\end{corr}
\begin{proof}
From Lemma~\ref{lemm.zorn.for.atoms}, considering $\{O'\in\opens \mid \varnothing\neq O'\subseteq O\}$ (which is nonempty because it contains $O$).
\end{proof}

\begin{rmrk}
\label{rmrk.topology.crush}
A simple observation is that if $(\ns P,\opens)$ is a chain-bounded topology --- thus, a chain-bounded semitopology whose opens are closed under finite intersections --- then the atom that exists by Corollary~\ref{corr.atom.exists} is unique, simply because if we have atoms $A$ and $A'$ then $A\cap A'$ is less than both and so by minimality must be equal to both.
See also Lemma~\ref{lemm.kernel.crush}.
\end{rmrk}


\subsubsection{Discussion}

\begin{rmrk}[Origin of terminology]
\label{rmrk.why.cover}
\leavevmode
\begin{enumerate*}
\item
The terminology ``$O$ covers $p$'' in Definition~\ref{defn.open.covers}(\ref{item.open.cover})
is adapted from order theory (see e.g.~\cite[\S 1.14]{priestley:intlo}), where we say that $y$ covers $x$ when $y>x$ and there exists no $z$ such that $y>z>x$.
\item
The terminology ``$A$ is an atom'' in Definition~\ref{defn.atomic.open.set}(1)
is also adapted from order theory (see e.g.~\cite[\S 5.2]{priestley:intlo}), where we call $x$ an atom when it is a least element not equal to $\bot$ (i.e. when $x$ covers $\bot$).
\end{enumerate*}
\end{rmrk}

\begin{xmpl}[(Counter)examples of atoms and open covers]
\label{xmpl.p.not.in.O}
\leavevmode
\begin{enumerate}
\item
\emph{$p$ can be in multiple distinct atoms (minimal nonempty open sets), and/or open covers (minimal open sets that contain $p$).}

For instance, consider $\mathbb N$ with the semitopology generated by $1_\leq=\{0,1\}$ and $1_\geq = \{1,2,3,\dots\}$.
Then $1\in 1_\leq$ and $1\in 1_\geq$, and $1_\leq$ and $1_\geq$ are distinct minimal open sets (and also open covers of $1$).

A topology would compress this example down to nothing: if $\{0,1\}$ is open and $\{1,2,3,\dots\}$ is open then their intersection $\{1\}$ would be open, and this would be the unique least open set containing $1$.
Because open sets in semitopologies are not necessarily closed under intersection, semitopologies permit richer structure.
\item
\emph{An open cover $O$ of $p$ is a minimal open set that contains $p$ --- but $O$ need not be an atom (a minimal nonempty open set).} 

Consider $\mathbb N$ with the semitopology generated by $i_\geq = \{i'\in\mathbb N \mid i'\geq i\}$.
Then $\f{Covers}(i)=\{i_\geq\}$ but (with this semitopology) $\f{Atoms}(\ns P)=\varnothing$; there are no least nonempty open sets.
\item\label{item.atom.need.not.contain.p}
\emph{An atom $A\in\f{atoms}(p)$ is a minimal nonempty open set that is a subset of a minimal open set that contains $p$ --- but $A$ need not contain $p$.}

For instance, consider $\mathbb N$ with the semitopology generated by $i_\leq = \{i'\in\mathbb N \mid i'\leq i\}$.
Then $\f{atoms}(i)=\{\{0\}\}$ for every $i$, because with this semitopology $\f{Atoms}(\mathbb N)=\{\{0\}\}$ and each $i$ is covered by $i_\leq$, and $\{0\}\subseteq i_\leq$.
However, we only have $i\in\{0\}$ when $i=0$.
\end{enumerate}
\end{xmpl}


\begin{rmrk}[Two open problems]
\label{rmrk.two.open.problems}
\leavevmode
\begin{enumerate}
\item
\emph{Topological characterisation of witness semitopologies.}

Following on from Remark~\ref{rmrk.characterise.witness.semitopologies}, we have seen that witness semitopologies are chain-complete, but that this does not precisely characterise witness semitopologies.
A topological characterisation of witness semitopologies, or a proof that such a characterisation is impossible, remains an open problem. 
To this end, the material in Subsection~\ref{subsect.declarative.witness} may be relevant, which relates witness semitopologies to a Turing-complete model of computation.
\item
\emph{Conditions on witness functions to guaranteee (quasi)regularity.}

It remains an open problem to investigate conditions on witness functions to guarantee that every point is quasiregular.
In view of Proposition~\ref{prop.weakly.regular.to.regular} and Corollary~\ref{corr.no.finite.wr.c}, such conditions would suffice to guarantee the existence of a regular point in the finite case.
Regular points are well-behaved from the point of view of consensus, so a system with at least one regular point is a system that in, in some sense, `sensible somewhere'. 
\end{enumerate}
\end{rmrk} 


\section{Kernels: the atoms in a community}
\label{sect.kernels}

\subsection{Definition and examples}


We have studied $\community(p)$ the community of a point and have seen that is has a rich mathematics. 
We also know from results (like Theorem~\ref{thrm.correlated}) and discussions (like Remark~\ref{rmrk.fundamental.consensus}) that to understand consensus in a semitopology, we have to understand its communities. 

It is now interesting to look at the atoms in a community (Definition~\ref{defn.atomic.open.set}; minimal nonempty open sets).
As we shall see, the atoms in a community dominate its behaviour, so that understanding $\community(p)$ is, in a sense we will make formal, much the same thing as understanding the atoms in $\community(p)$.

The maths that follows will develop this intuition.

 

\begin{defn}
\label{defn.kernel}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
\begin{enumerate*}
\item\label{item.kernel}
Define $\kernel(p)$ the \deffont{kernel} of $p$ to be the union of the atoms in its community.
We give equivalent formulations which we may use as convenient:
$$
\begin{array}{r@{\ }l}
\kernel(p) 
=& \bigcup\{A\in\f{Atoms}(\ns P) \mid A\subseteq \intertwined{p} \}  
\\
=& \bigcup\{A\in\f{Atoms}(\ns P) \mid A\subseteq \community(p)\}  
\\
=& \bigcup\{A\in\opens \mid \varnothing\lessdot A\subseteq \community(p)\}  .
\end{array}
$$
Above, $\varnothing\lessdot A$ is just another way of saying that $A$ is an atom (minimal nonempty open set; see Definition~\ref{defn.atomic.open.set}), and $A\subseteq\intertwined{p}$ if and only if $A\subseteq\community(p)$ because $A$ is open and $\community(p)$ is just the open interior of $\intertwined{p}$ (Definition~\ref{defn.tn}(1)).
\item\label{item.kernel.atom}
If $A$ is an atom that is a subset of $\kernel(p)$ (in symbols: $\varnothing\lessdot A\subseteq\kernel(p)$) then we might call $A$ a \deffont{kernel atom of $p$}.
\item\label{item.kernel.P}
Extend $\kernel$ to subsets $P\subseteq\ns P$ by taking a sets union:
$$
\kernel(P) = \bigcup\{\kernel(p) \mid p\in P\} .
$$
\end{enumerate*}
\end{defn}




We return to and extend Example~\ref{xmpl.p.not.regular}, and we include details of the kernels:
\begin{xmpl}
\label{xmpl.p.not.regular.2}
\leavevmode
\begin{enumerate}
\item\label{item.p.not.regular.R.2}
Take $\ns P$ to be $\mathbb R$ the real numbers, with its usual topology (which is also a semitopology), as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}).
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{x\}$ and $\community(x)=\varnothing$ for every $x\in\mathbb R$.
\item
$\kernel(x)=\varnothing$ for every $x\in\mathbb R$.
\item
$\kernel(\mathbb R)=\varnothing$.
\end{itemize*}
\item\label{item.p.not.regular.012.2}
We take, as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012}) and as illustrated in Figure~\ref{fig.012}, left-hand diagram:
\begin{itemize*}
\item
$\ns P=\{0,1,2\}$.
\item
$\opens$ is generated by $\{0\}$ and $\{2\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1\}$ and $\community(0)=\interior(\intertwined{0})=\{0\}=\kernel(0)$. 
\item
$\intertwined{2}=\{1,2\}$ and $\community(2)=\interior(\intertwined{2})=\{2\}=\kernel(2)$. 
\item
$\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,1,2\}$ and $\kernel(1)=\{0,2\}$. 
\item
$\kernel(\ns P)=\{0,2\}$.
\end{itemize*}
\item\label{item.p.not.regular.01234.2}
We take, as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}), as illustrated in Figure~\ref{fig.irregular}, and as reproduced for convenience here in Figure~\ref{fig.irregular.2} (left-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{1,2\}$ for $x\in\{0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\item
$\kernel(x)=\{1,2\}$ for $x\in\{0,1,2\}$. 
\item
$\kernel(x)=\{x\}$ for $x\in\{3,4\}$. 
\item
$\kernel(\ns P)=\{1,2,3,4\}$.
\item
By construction $\kernel(\ns P)\subseteq\bigcup\f{Atoms}(\ns P)$, but but we see here that the inclusion may be strict, since e.g. $\{0,1,3\}$ is an atom in this example but $0\not\in\kernel(\ns P)$.
\end{itemize*}
\item\label{item.p.not.regular.01234.2b}
We add one point to part~\ref{item.p.not.regular.01234.2} of this example, $\minus 1$, which is intertwined with $0$, $1$, and $2$ but is not in a minimal nonempty open set, as illustrated in Figure~\ref{fig.irregular.2} (right-hand diagram):
\begin{itemize*}
\item
$\ns P=\{\minus 1,0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{\minus 1,1,2\}$, $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{\minus 1,0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{\minus 1,1,2\}$ for $x\in\{\minus 1,0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\item
$\kernel(x)=\{1,2\}$ for $x\in\{\minus 1,0,1,2\}$. 
\item
$\kernel(x)=\{x\}$ for $x\in\{3,4\}$. 
\item
$\kernel(\ns P)=\{1,2,3,4\}$.
\item
By construction $\kernel(p)\subseteq\community(p)\subseteq\intertwined{p}$, but the inclusions may be strict.
For instance:
$$
\kernel(0)=\kernel(\minus 1)=\{1,2\}\subsetneq \community(0)=\community(\minus 1)=\{\minus 1,1,2\}\subsetneq\intertwined{0}=\intertwined{\minus 1}=\{\minus 1,0,1,2\}.
$$
\end{itemize*}
\item\label{item.nonempty.community.empty.kernel}
We take $\ns P=\mathbb N$, with the semitopology (also a topology) generated by final subsets $n_\geq = \{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$.
Then $\intertwined{n}=\mathbb N=\community(n)$ for every $n\in\mathbb N$, and $\kernel(n)=\varnothing$ (because there is no minimal nonempty open set). 
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample.pdf}
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample-1.pdf}
\vspace{-0em}
\caption{Illustration of Example~\ref{xmpl.p.not.regular.2}(3\&4)}
\label{fig.irregular.2}
\end{figure}




We warm up with a couple of simple lemmas:
\begin{lemm}
\label{lemm.kernel.atoms.intersect}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is a regular point.

Then all kernel atoms of $p$ intersect, or in symbols:
$$
\varnothing\lessdot A,A'\subseteq\kernel(p) \quad\text{implies}\quad A\between A'.
$$
\end{lemm}
\begin{proof}
By construction in Definition~\ref{defn.kernel}(\ref{item.kernel}) $A,A'\subseteq\kernel(p)\subseteq\community(p)$.
By regularity (Definition~\ref{defn.tn}(\ref{item.regular.point})) $\community(p)$ is transitive.
Then $A\between \community(p)\between A'$ and by transitivity (Definition~\ref{defn.transitive}) it follows that $A\between A'$. 
\end{proof}


\begin{lemm}
\label{lemm.kernel.crush}
Suppose $(\ns P,\opens)$ is a \emph{topology} --- thus: a semitopology whose open sets are closed under intersections --- and $p\in\ns P$ is regular.
Then one of the following holds:
\begin{itemize*}
\item
$\kernel(p)=\varnothing$.
\item
$\kernel(p)=A$ for some atom $\varnothing\lessdot A$.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $\kernel(p)\neq\varnothing$, and suppose there exist two atoms $A,A'\subseteq\kernel(p)$.
Then (just as already noted in Remark~\ref{rmrk.topology.crush}) $A\cap A'$ is an open set.
It is not empty because $A\between A'$ by Lemma~\ref{lemm.kernel.atoms.intersect}.
By minimality, $A=A\cap A'=A'$.
Thus, being a topology crushes Definition~\ref{defn.kernel} down to be at most a single atom.
\end{proof}

\subsection{Characterisations of the kernel}


We open with a non-implication:
\begin{lemm}
\label{lemm.reg.ker.0}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular (so $p\in\community(p)\in\topens$).
Then it is not necessarily the case that $\kernel(p)\neq\varnothing$.
\end{lemm}
\begin{proof}
A counterexample is Example~\ref{xmpl.p.not.regular.2}(\ref{item.nonempty.community.empty.kernel}).
In full: we consider $\mathbb N$ with the semitopology generated by $n_\geq = \{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$.
Then $\intertwined{n}=\mathbb N=\community(n)$ for every $n\in\mathbb N$, but $\kernel(n)=\varnothing$ because there is no minimal nonempty open set.
\end{proof}

We can exclude the case noted in the proof of Lemma~\ref{lemm.reg.ker.0} by restricting to chain-bounded semitopologies. 
\begin{lemm}
\label{lemm.nonempty.community}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology --- in particular, this holds if $\ns P$ is finite by Proposition~\ref{prop.finite.chain-bounded} --- and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\community(p)=\varnothing$ if and only if $\kernel(p)=\varnothing$, and equivalently $\community(p)\neq\varnothing$ if and only if $\kernel(p)\neq\varnothing$.

In words: $p$ has a nonempty community if and only if it has a nonempty kernel.
\item\label{nonempty.community.topen}
If $p$ is regular then $\kernel(p)$ is a topen subset of $\community(p)$ (nonempty transitive and open, see Definition~\ref{defn.transitive}(\ref{transitive.cc})).

(See also Lemma~\ref{lemm.topen.max.min}, which proves a stronger version of this property for the kernel atoms of a regular $p$.)
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $\varnothing\neq\community(p)=\interior(\intertwined{p})$.
Then by Corollary~\ref{corr.atom.exists} (since $\ns P$ is chain-bounded) $\community(p)$ contains at least one atom $A$, which is a subset of $\community(p)$ by construction, and so $A\in\kernel(p)$.

Conversely, if there exists an atom $A\in\kernel(p)$ then (since an atom is by assumption a nonempty set) we have $\varnothing\neq A\subseteq\community(p)$. 
\item
Suppose $p$ is regular.
Unpacking Definition~\ref{defn.tn}(\ref{item.regular.point}) this means that $p\in\community(p)$.
Thus in particular $\community(p)\neq\varnothing$, and by part~1 of this result $\kernel(p)\neq\varnothing$. 

So $\kernel(p)$ is a nonempty subset of $\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is a (maximal) topen, and by Lemma~\ref{lemm.transitive.subset}(2) $\varnothing\neq\kernel(p)\subseteq\community(p)$ is topen as required.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}
\label{rmrk.kernel.not.neighbourhood.of.p}
Note in Lemma~\ref{lemm.nonempty.community}(\ref{nonempty.community.topen}) that $\kernel(p)$ need not be a topen neighbourhood of $p$, simply because $p$ (even if it is regular) might generate a topen community $\community(p)$ but need not necessarily be in an atom in that community. See Example~\ref{xmpl.p.not.regular.2}(\ref{item.p.not.regular.01234.2b}) taking $p=0$ or $p=\minus 1$, or Lemma~\ref{lemm.kernel.non-implications}(3).
\end{rmrk}

We complement Lemma~\ref{lemm.nonempty.community} with some non-implications:
\begin{lemm}
\label{lemm.kernel.non-implications}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
$\kernel(p)\neq\varnothing$ does not imply that $p$ is regular.
\item
$\kernel(p)$ topen does not imply that $p$ is regular. 
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
See Example~\ref{xmpl.p.not.regular}(2):
then $\kernel(1)=\{0,2\}\neq\varnothing$ but (as noted in Lemma~\ref{lemm.p.not.regular}) $1$ is not regular. 
\item
See Example~\ref{xmpl.p.not.regular}(\ref{item.point.not.regular.but.community.is.topen}): so $\ns P=\{0,1,2,3,4\}$ and $\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$ and $\kernel(0)=\community(0)=\{1,2\}$, and this is (nonempty and) topen, but $0$ is not regular since $0\not\in\community(0)=\{1,2\}$.
\item
Take $\ns P=\{0,1\}$ and set $\opens=\{\varnothing,\{0\},\{0,1\}\}$.
Then $1$ is regular but $1\not\in\kernel(p)=\{0\}$.
\qedhere\end{enumerate}
\end{proof}



\begin{lemm}
\label{lemm.topen.max.min}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is a regular point and $A\subseteq\community(p)$.
Then the following are equivalent:
\begin{enumerate*}
\item
$A$ is a kernel atom of $p$ ($\varnothing\lessdot A\subseteq\community(p)$).
\item
$A$ is a minimal topen in $\community(p)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
Suppose $A$ is a kernel atom of $p$.
By assumption in Definition~\ref{defn.kernel}(\ref{item.kernel.atom}) it is an atom (a minimal nonempty open set) in $\community(p)$, and by Lemma~\ref{lemm.transitive.subset}(2) it is topen; so it is necessarily a minimal topen.
\item
Suppose $A$ is a minimal topen in $\community(p)$ and suppose $A'\subseteq A$ is any nonempty open set.
By Lemma~\ref{lemm.transitive.subset}(2) $A'$ is topen, so by minimality $A=A'$.
Thus, $A$ is an atom in $\community(p)$, and so is a kernel atom of $p$.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
The proof of Lemma~\ref{lemm.topen.max.min} above is elementary given our results so far, but it makes a useful observation. 
Recall from Theorem~\ref{thrm.max.cc.char} that if $p$ is regular (so $p\in\community(p)\in\topens$) then $\community(p)$ is a maximal topen, and recall from Definition~\ref{defn.kernel} that a kernel atom is an atom (i.e. a minimal nonempty open set) in $\community(p)$.
So we can read Lemma~\ref{lemm.topen.max.min} as follows: 
\begin{quote}
A kernel atom is a minimal topen inside a maximal topen.
\end{quote}
Thus for regular $p$, $\kernel(p)$ and $\community(p)$ are in some sense dual: the community of $p$ is the maximal topen containing $p$, and the kernel of $p$ is the union of the minimal topens inside that maximal topen.
\end{rmrk}


So Lemma~\ref{lemm.topen.max.min} tells us that for regular $p$, the kernel atoms of $p$ are the minimal topens that are subsets of the community of $p$.
Proposition~\ref{prop.kernel.atoms.subset.intersect} strengthens this to show that in fact, the kernel atoms of regular $p$ are also the minimal topens that even \emph{intersect} with the community of $p$ (the significance of this to distributed consensus is discussed in Remark~\ref{rmrk.fundamental.consensus}):
\begin{prop}
\label{prop.kernel.atoms.subset.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.\footnote{We do not seem to need $\ns P$ to be chain-bounded here.  This is simply because we normally use chain-boundedness to ensure that atoms and open covers exist, but in this result this is assumed.}
\item
$A\in\f{Atoms}(\ns P)$ is an atom.
\item
$p\in\ns P$ is a regular point (so by Definition~\ref{defn.tn}(\ref{item.tn}) $p\in\community(p)\in\topens$).
\item
$O\in\topens$ and $O\between\community(p)$, so $O$ is any topen set that intersects the community of $p$ (at least one such exists, by regularity, namely $\community(p)$ itself).\footnote{By Corollary~\ref{corr.topen.intersect.subset}, this is equivalent to $O\subseteq\community(p)$.  We use $O\between\community(p)$ because it yields a stronger form of the result.}
\end{itemize*}
Then the following are all equivalent:
\begin{enumerate*}
\item
$A\subseteq\kernel(p)$.

In words: $A$ is a kernel atom of $p$.
\item
$A\subseteq\community(p)$.

In words: $A$ is an atom in the community of $p$.
\item
$A$ is topen and $A\between O$.

In words: $A$ is topen and intersects $O$.
\end{enumerate*}
In particular, if $A$ is a topen atom\footnote{An atom is a minimal nonempty open set, and a topen is a nonempty open transitive set; so saying `topen atom' is just the same as saying `transitive atom'.} then we have:
$$
A\subseteq \kernel(p) 
\quad\liff\quad
A\subseteq \community(p) 
\quad\liff\quad
A\between O
\quad\liff\quad
A\between\kernel(p) 
\quad\liff\quad
A\between\community(p) . 
$$
\end{prop}
\begin{proof}
We consider a cycle of implications:
\begin{itemize}
\item
Suppose $A\subseteq\kernel(p)$.
By construction in Definition~\ref{defn.kernel}(\ref{item.kernel}) $\kernel(p)\subseteq\community(p)$, so $A\subseteq\community(p)$.
\item
Suppose $A\subseteq\community(p)$.
By Definition~\ref{defn.atomic.open.set}(1) (since $A$ is an atom) $A$ is nonempty.
Then $A\between\community(p)\between O$.
By regularity $\community(p)$ is topen, so by transitivity (Definition~\ref{defn.transitive}) $A\between O$ as required.
\item
Suppose $A$ is topen and $A\between O$.
By assumption $A\between O\between\community(p)$ so by transitivity $A\between\community(p)$.
By Corollary~\ref{corr.topen.intersect.subset} $A\subseteq\community(p)$ and it follows from Definition~\ref{defn.kernel}(\ref{item.kernel.atom}) that $A\subseteq\kernel(p)$ as required.
\end{itemize}
The equivalence 
$$
A\between O\liff A\between\kernel(p) \iff A\between\community(p)
$$
then follows routinely from the above, noting the equivalence $A\between O\liff A\subseteq\community(p)$ and choosing $O=\kernel(p)$ or $O=\community(p)$.
\end{proof}


\begin{corr}
\label{corr.kernel.as.topen.atoms.intersecting.O}
Suppose $(\ns P,\opens)$ is a %chain-bounded 
semitopology and $p\in\ns P$ and $O\in\topens$ and $p\in O$ (so $p$ is regular and $O$ is some topen neighbourhood of $p$).
Then 
$$
\kernel(p) = \bigcup\{A{\in}\topens(\ns P) \mid \varnothing\lessdot A\between O\}.
$$
In words: for any topen neighbourhood $O$ of $p$, $\kernel(p)$ is equal to the union of the topen atoms that intersect that neighbourhood. 
\end{corr}
\begin{proof}
Unpacking Definition~\ref{defn.kernel}(\ref{item.kernel}), $\kernel(p)$ is the union of atoms $A\subseteq\community(p)$.
We use Proposition~\ref{prop.kernel.atoms.subset.intersect}. 
\end{proof}

Lemma~\ref{lemm.atom.is.kernel.atom} explicitly characterises the union of all kernels as the union of all transitive atoms, which (given the results above) is what one might expect:
\begin{lemm}
\label{lemm.atom.is.kernel.atom}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If $A\subseteq\ns P$ is a transitive atom then $A\subseteq\kernel(p)$ for every $p\in A$.

In words we can say: a transitive atom is a kernel atom for any points that it contains.
\item
$\kernel(\ns P)$ is the union of the transitive atoms in $\ns P$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
If $p\in A\in\topens$ then $A$ is a topen neighbourhood for $p$. 
By Theorem~\ref{thrm.max.cc.char} $p\in A\subseteq \community(p)$.
But then by construction $A$ is an atom in $\community(p)$ so by Definition~\ref{defn.kernel}(\ref{item.kernel}) $A\subseteq\kernel(p)$.
\item
It follows from Lemma~\ref{lemm.topen.max.min} and Definition~\ref{defn.kernel}(\ref{item.kernel.P}) that every atom in $\kernel(\ns P)$ is (topen and so) transitive.
Conversely by part~1 of this result every transitive atom is in the kernel of the community of its points. 
\qedhere\end{enumerate}
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%
\subsection{Further properties of kernels}

%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Intersections between the kernel of $p$ and its open neighbourhoods}

Lemma~\ref{lemm.ker.intersect} is quite easy to prove by following definitions and applying transitivity properties, but it makes a useful point:
\begin{lemm}
\label{lemm.ker.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$p\in\ns P$ is a regular point.
\item
$A$ is a kernel atom for $p$.  In symbols: $\varnothing\lessdot A\subseteq\kernel(p)$.
\end{itemize*} 
Then 
$$
\Forall{O{\in}\opens} p\in O \limp A\between O .
$$
In words: 
\begin{quote}
If $p$ is regular then every open neighbourhood of $p$ intersects every kernel atom of $p$.\footnote{This property is a bit subtle, because it is not necessarily the case that $p\in\kernel(p)$ (cf. Remark~\ref{rmrk.kernel.not.neighbourhood.of.p}).  So a kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ is is not itself necessarily a neighbourhood of $p$, but it still has a property of `oversight' over $p$ in the sense that it intersects with every quorum (open neighbourhood) that $p$ has.}
\end{quote} 
\end{lemm}
\begin{proof}
By our assumption that $p$ is regular we have $p\in\community(p)\in\topens$ (Definition~\ref{defn.tn}(\ref{item.regular.point})), and we assumed $p\in O$, so $O\between\community(p)$.

Also by assumption $A\between\community(p)$, since $A\subseteq\kernel(p)\subseteq\community(p)$ by Definition~\ref{defn.kernel}(\ref{item.kernel.atom}\&\ref{item.kernel}).
Thus $O\between\community(p)\between A$.
Now $\community(p)$ is topen, thus it is transitive (Definition~\ref{defn.transitive}(\ref{transitive.transitive})) and so $O\between A$ as required. 
\end{proof}


\begin{prop}
\label{prop.kernel.O}
$(\ns P,\opens)$ is a semitopology and $p$ is regular and $p\in O\in\opens$.
Then:
\begin{enumerate*}
\item 
The kernel of $p$ is a subset of the union of the atoms intersecting $O$.
In symbols:
$$
\kernel(p) \subseteq \bigcup\{A{\in}\opens \mid \varnothing\lessdot A\between O\} = \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between O\}.
$$
\item
The inclusion may be strict, even if $O$ is an open cover of $p$ (in symbols: $O\gtrdot p$).
%(In words: the inclusion may be strict, even if $O$ is an open cover of $p$; i.e. a minimal open neighbourhood of $p$.)
\item
The inclusion may be strict, even if $O\gtrdot p$ is a topen (transitive open) cover of $p$.
\item
If $O$ is a topen cover of $p$, then the kernel of $p$ is precisely equal to the union of the transitive atoms intersecting $O$.
In symbols: 
$$
\kernel(p) = \bigcup\{A{\in}\topens(\ns P) \mid \varnothing\lessdot A\between O\}.
$$
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
For the inclusion we just combine Lemma~\ref{lemm.ker.intersect} with Definition~\ref{defn.kernel}(\ref{item.kernel}).
\item
To see how the inclusion may be strict, see Example~\ref{xmpl.strict.kernel.O}(1).
\item
To see how the inclusion may be strict, even for transitive $O$, see Example~\ref{xmpl.strict.kernel.O}(2).
\item
This just repeats Corollary~\ref{corr.kernel.as.topen.atoms.intersecting.O}.
\qedhere
\end{enumerate}
\end{proof}

\begin{xmpl}
\label{xmpl.strict.kernel.O}
\leavevmode
\begin{enumerate}
\item
Take $\ns P=\{0,1,2\}$ and let opens be generated by $\{0,1\}$ and $\{0,2\}$ and $\{1,2\}$ and $\{2\}$, as illustrated in Figure~\ref{fig.ovals} (left-hand diagram).

Set $p=1$ and $O=\{1,2\}$.
Then we can calculate that:
\begin{itemize*}
\item
$0$, $1$, and $2$ are all regular.
\item
The community and kernel of $1$ and $0$ are equal to $\{0,1\}$ --- $2$ is not intertwined with $0$ or $1$ because $\{2\}\cap\{0,1\}=\varnothing$.
\item
The community and kernel of $2$ are equal to $\{2\}$. 
\item
$\{1,2\}$ is an open cover of $1$.
\item
The union of the atoms that intersect with $\{1,2\}$ is the whole space $\{0,1,2\}$.
\end{itemize*}
Thus $\kernel(1) =\{0,1\}\subsetneq \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between \{1,2\}\}=\{0,1\}\cup\{2\}=\{0,1,2\}$.
\item
Take $\ns P=\{0,1,2,3\}$ and let opens be generated by $\{0,1\}$ and $\{1,2\}$ and $\{2,3\}$, as illustrated in Figure~\ref{fig.ovals} (right-hand diagram). 

Set $p=1$ and $O=\{0,1\}$.
Then we can calculate that:
\begin{itemize*}
\item
$\ns P$ splits into two disjoint topen sets: $\{0,1\}$ and $\{2,3\}$.
So $O$ is topen.
\item
The community and kernel of $0$ and $1$ are equal to $\{0,1\}$ --- $2$ is not intertwined with $0$ or $1$ because $\{2,3\}\cap\{0,1\}=\varnothing$.
So $\{1,2\}$ is an atom, but it is not transitive.
\item
The community and kernel of $2$ and $3$ are equal to $\{2,3\}$. 
\item
$\{0,1\}$ is an open cover of $1$.
\end{itemize*}
Thus $\kernel(1) =\{0,1\}\subsetneq \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between \{0,1\}\}=\{0,1\}\cup\{1,2\}=\{0,1,2\}$.
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/ovals.pdf}
\hspace{-2em}
\includegraphics[width=0.35\columnwidth]{diagrams/strict-kernel-inclusion-transitive.pdf}
\vspace{-1em}
\caption{The semitopologies in Example~\ref{xmpl.strict.kernel.O}}
\label{fig.ovals}
\end{figure}





\begin{rmrk}
Proposition~\ref{prop.kernel.O} has practical relevance, that it reduces the problem of computing kernels to the problem of identifying transitive sets.
Once we have this, an algorithm for computing $\kernel(p)$ for regular $p$ follows:
\begin{itemize*}
\item
Compute a transitive open neighbourhood $O$ of $p$ --- for example using the algorithm outlined in 
Remark~\ref{rmrk.computing.open.sets} to compute open neighbourhoods of $p$, and testing until we find one that is transitive.
At least one transitive cover of $p$ exists, by our assumption that $p$ is regular.
\item
For each $p'\in O$, compute all the atoms that contain $p'$ --- for example by computing the open neighbourhoods of $p'$ and checking which are atoms, and are transitive.
\end{itemize*}
By Proposition~\ref{prop.kernel.O}(4), this collection of transitive atoms that intersect with $O$, will return the kernel atoms of $p$. 
\end{rmrk}


We conclude by noting a non-result:
\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Recall from Theorem~\ref{thrm.up.down.char} that $\community(p)$ the community of $p$ is the greatest transitive open neighbourhood of $p$, so that any \emph{transitive} open neighbourhood of $p$ is contained in the community of $p$.

However, there may still exist a non-transitive open cover of $p$ that is not contained in the community of $p$.
\end{lemm}
\begin{proof}
It suffices to provide a counterexample, and as it happens we have just considered one.
Consider Example~\ref{xmpl.strict.kernel.O}(2), as illustrated in Figure~\ref{fig.ovals} (right-hand diagram).
Then $\intertwined{1}=\community(1)=\{0,1\}$ and $\{1,2\}$ is an open cover of $1$ and $\{1,2\}\not\subseteq\{0,1\}$. 
\end{proof}


\subsubsection{Idempotence properties of the kernel and community}


\begin{rmrk}
In Definitions~\ref{defn.tn}(\ref{item.community.P}) and~\ref{defn.kernel}(\ref{item.kernel.P}) we extend the notions of community and kernel of a set of points, using sets union.
This allows us to take the community of a community $\community(\community(p))$, then kernel of a kernel $\kernel(\kernel(p))$, and so forth.
Does doing this add any information?
One would hope not --- but this needs checked.

In this Subsection we take check this for regular points, and see that they display good behaviour (e.g.: the community of the community is just the community, and so forth).
The proofs also illuminate how regularity condition ensures good behaviour.
\end{rmrk}


\begin{lemm}
\label{lemm.double.community}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then
$$
\community(\community(p))=\community(p).
$$
\end{lemm}
\begin{proof}
We prove two subset inclusions:
\begin{itemize}
\item
Suppose $q\in\community(\community(p))$, so unpacking Definition~\ref{defn.tn}(\ref{item.community.P}) there exists $p'\in\community(p)$ such that $q\in\community(p')$.
By Corollary~\ref{corr.regular.is.regular} (since $p$ is regular) $\community(p')=\community(p)$, so $q\in\community(p)$.

$q$ was arbitrary, and it follows that $\community(\community(p))\subseteq\community(p)$.
\item
Suppose $q\in\community(p)$.
Then by Corollary~\ref{corr.regular.is.regular} (since $p$ is regular) $\community(q)=\community(p)\in\topens$, so in particular $q\in\community(q)$.

$q$ was arbitrary, and it follows that $\community(p)\subseteq\community(\community(p))$. 
\qedhere\end{itemize}
\end{proof}

\begin{corr}
\label{corr.community.kernel.p}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Suppose further that $\kernel(p)\neq\varnothing$ (if $\ns P$ is chain-bounded or finite then by Lemma~\ref{lemm.nonempty.community}(\ref{nonempty.community.topen}) and Proposition~\ref{prop.finite.chain-bounded} $\kernel(p)\neq\varnothing$ is guaranteed).
Then
$$
\community(p)=\community(\kernel(p)).
$$
\end{corr}
\begin{proof}
Suppose $q\in\community(p)$ and pick any $k\in\kernel(p)\subseteq\community(p)$.
Then $k\in\community(p)$ so by Corollary~\ref{corr.regular.is.regular} $\community(p)=\community(k)$ so $q\in\community(k)$.
Thus $\community(p)\subseteq\community(\kernel(p))$.

Furthermore $\community(\kernel(p))\subseteq\community(\community(p))$ is a structural fact of Definition~\ref{defn.tn}(\ref{item.community.P}) and the fact, noted above, that $\kernel(p)\subseteq\community(p)$.

We finish with Lemma~\ref{lemm.double.community}:
$$
\community(p)\subseteq\community(\kernel(p))\subseteq\community(\community(p)) \stackrel{L\ref{lemm.double.community}}= \community(p) .
\qedhere$$ 
\end{proof}



\begin{lemm}
\label{lemm.kernel.community}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then 
$$
\kernel(\community(p))=\kernel(p).
$$
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.kernel}, $\kernel(\community(p))=\bigcup\{\kernel(p')\mid p'\in\community(p)\}$ and for each $p'\in\community(p)$ we have $\kernel(p')=\bigcup\{A\subseteq\ns P \mid \varnothing\lessdot A\subseteq \community(p')\}$. 
By Corollary~\ref{corr.regular.is.regular}, $\community(p)=\community(p')$ for every $p'\in\community(p)$, and threading this equality through the definitions above, we obtain the result.
\end{proof}


\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then
$$
\kernel(p)=\kernel(\kernel(p)).
$$
\end{lemm}
\begin{proof}
If $\kernel(p)=\varnothing$ then the result is immediate.
So suppose $\kernel(p)\neq\varnothing$.
We show two subset inclusions.
\begin{itemize}
\item
To prove $\kernel(p)\subseteq\kernel(\kernel(p))$ we can reason as follows:
$$
\begin{array}{r@{\ }l@{\quad}l}
\kernel(\kernel(p))\subseteq&\kernel(\community(p))
&\kernel(p){\subseteq}\community(p), \text{Def.~\ref{defn.kernel}(\ref{item.kernel.P})}
\\
=&\kernel(p) &\text{Lemma~\ref{lemm.kernel.community}}
\end{array}
$$
\item 
To prove $\kernel(\kernel(p))\subseteq\kernel(p)$ we note that a kernel is a union of atoms in Definition~\ref{defn.kernel}(\ref{item.kernel}), and we reason as follows, for an atom $\varnothing\lessdot A$ (which exists because $\kernel(p)$ is a union of atoms and we assumed $\kernel(p)\neq\varnothing$):
$$
\begin{array}{r@{\ }l@{\quad}l}
A\subseteq\kernel(p) 
\liff& A\subseteq\community(p) 
&\text{Definition~\ref{defn.kernel}(\ref{item.kernel})}
\\
\liff& A\subseteq\community(\kernel(p)) 
&\community(p)=\community(\kernel(p))=\community(\community(p))
\\
\liff& A\subseteq\kernel(\kernel(p))
&\text{Definition~\ref{defn.kernel}(\ref{item.kernel})} .
\end{array}
$$
Above, $\community(p)=\community(\kernel(p))=\community(\community(p))$ follows from Lemma~\ref{lemm.double.community} and Corollary~\ref{corr.community.kernel.p} (since we assumed $\kernel(p)\neq\varnothing$).
\qedhere\end{itemize}
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%
\section{Dense subsets and continuous extensions}
\label{sect.dense}

\subsection{Definition and basic properties}

\begin{rmrk}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
The following four standard definitions of what it means for $D$ to be \emph{dense} in $P$ are equivalent in topology: 
\begin{enumerate*}
\item
Every nonempty open subset of $P$ intersects $D$.
\item
The interior of $P\setminus D$ is empty.
\item
Every open subset that intersects $P$, intersects $D$.
\item
$\closure{D}=\closure{P}$.
\end{enumerate*}
We shall see that in semitopologies, these definitions split into two groups.
\end{rmrk}


\begin{defn}
\label{defn.dense}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item\label{item.dense}
Call $D$ \deffont{weakly dense} in $P$ when 
$$
\Forall{O\in\opens} \varnothing\neq O\subseteq P \limp D\between O . 
$$
In words: 
\begin{quote}
$D$ is weakly dense in $P$ when every nonempty open subset of $P$ intersects $D$.
\end{quote}
\item\label{item.strongly.dense}
Call $D$ \deffont{strongly dense in} $P$ when 
$$
\Forall{O\in\opens} P\between O \limp D\between O . 
$$
In words: 
\begin{quote}
$D$ is (strongly) dense in $P$ when every open subset that intersects $P$, intersects $D$.\footnote{We do not need to explicitly state that $O$ is nonempty because if $O$ is empty then $O\between P$ is false.}
\end{quote}
\item\label{item.dense.neighbourhood}
If $D$ is strongly dense in $P$ and $\interior(D)\neq\varnothing$ then we may call $D$ a strongly dense \deffont{neighbourhood} in $P$. 
\end{enumerate*}
\end{defn}


In a topology, the two notions of being \emph{dense} described in Definition~\ref{defn.dense} above are equivalent.
A semitopology permits richer structure (because we do not insist that intersections of open sets be open) and thus it discriminates more finely between the defintions:
\begin{lemm}
\label{lemm.sd.implies.wd}
Suppose $(\ns P,\opens)$ is a semitopology and $\varnothing\neq D\subseteq P\in\opens$.
Then:
\begin{enumerate*}
\item
If $D$ is strongly dense in $P$ then $D$ is weakly dense in $P$.
\item
In a topology, the reverse implication holds; but 
\item
in a semitopology the reverse implication need not hold: it may be that $D$ is weakly dense but not strongly dense in $P$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If a nonempty open set is a subset of $P$ then it intersects with $P$.
It follows that if $D$ intersects every nonempty open set that intersects $P$, then it certainly intersects every nonempty open set that is a subset of $P$. 
\item
Suppose $(\ns P,\opens)$ is a topology and suppose $D$ is weakly dense in $P$ and $O\between P$.
Then $\varnothing\neq O\cap P\between P$, and because (this being a topology) $O\cap P\in\opens$ we have that $O\cap P\between D$ and so $O\between D$ as required.
\item
It suffices to provide a counterexample.
Consider the top-right semitopology in Figure~\ref{fig.012} and take $D=\{0\}$ and $P=\{0,1\}$.
Then $D$ is weakly dense in $P$ (because $D$ intersects $\{0\}$ and $\{0,1\}$) but $D$ is not strongly dense in $P$ (because $D$ does not intersect $\{1,2\}$).
\qedhere\end{enumerate}
\end{proof} 



We can rearrange the definitions to obtain more abstract characterisations of weakly and strongly dense:
\begin{prop}
\label{prop.wd.sd.iff}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item
$D$ is weakly dense in $P$ if and only if $\interior(P\setminus D)=\varnothing$.
\item
$D$ is strongly dense in $P$ if and only if $\closure{D}=\closure{P}$.
\end{enumerate*}
\end{prop}
\begin{proof}
For each part we prove two implications:
\begin{enumerate}
\item
$\interior(P\setminus D)=\varnothing$ means precisely that there is no nonempty open subset of $P\setminus D$, i.e. that every nonempty subset of $P$ intersects $D$.
But this is just the definition of $D$ being weakly dense in $P$ from Definition~\ref{defn.dense}(\ref{item.dense}).
\item
Since $D\subseteq P$, also $\closure{D}\subseteq\closure{P}$.

To prove $\closure{P}\subseteq\closure{D}$ it suffices to prove $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$.
By Corollary~\ref{corr.closed.complement.union}
$\ns P\setminus \closure{D}$ is the union of the open sets that do not intersect $D$, and $\ns P\setminus\closure{P}$ is the union of the open sets that do not intersect $P$.
So $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$ when for every open set $O\in\opens$, if $O$ does not intersect $D$ then $O$ does not intersect $P$.
This is just the contrapositive of the property of $D$ being strongly dense in $P$ from Definition~\ref{defn.dense}(\ref{item.strongly.dense}).
\qedhere\end{enumerate}
\end{proof}


\begin{corr}
\label{corr.wd.meets.atoms}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item
$D$ is weakly dense in $P$ if and only if $D$ intersects every atom $\varnothing\lessdot A\subseteq P$ in $P$.

In symbols using Definitions~\ref{defn.atomic.open.set} and~\ref{defn.O.between.R}: 
$$
\text{$D$ weakly dense in $P$} 
\quad\liff\quad
D\between\f{Atoms}(P).
$$
\item
$D$ is not weakly dense in $P$ if and only if $D$ is disjoint from some atom $\varnothing\lessdot A\subseteq P$ in $P$.
\end{enumerate*}
\end{corr}
\begin{proof}
Part~2 is just the contrapositive of part~1.
For part~1 we prove two implications:
\begin{itemize}
\item
Suppose $D$ is weakly dense in $P$.
By Definition~\ref{defn.dense}(\ref{item.dense}) this means that $D$ intersects every open $O\subseteq P$.
In particular, $D$ intersects every atom $\varnothing\lessdot A\subseteq P$.
\item
Conversely, suppose $D$ intersects every atom $\varnothing\lessdot A\subseteq P$ and suppose $O\subseteq P$ is open.
By Corollary~\ref{corr.atom.exists} (since $\ns P$ is chain-bounded) there exists an atom $\varnothing\lessdot A\subseteq O$ and by assumption $D\between A$, thus also $D\between O$ as required.
\qedhere\end{itemize}
\end{proof}


\subsection{Dense subsets of topen sets}


\begin{lemm}
\label{lemm.open.O.dense.in.topen} 
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P\in\topens$ and $O\in\opens$ and $\varnothing\neq O\subseteq P$. 
Then $O$ is strongly dense in $P$.

In words: any nonempty open subset of a topen set is strongly dense.
\end{lemm}
\begin{proof}
Suppose $P\between O'\in\opens$.
Thus $O\between P\between O'$ and by transitivity of $P$ (since $P$ is topen; see Definition~\ref{defn.transitive}) we have $O\between O'$ as required.
\end{proof}


\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\topens$.
Then \emph{precisely one} of the following holds:
\begin{itemize*}
\item
$D$ is weakly dense in $P$.
\item
$P\setminus D$ is a strongly dense neighbourhood in $P$.
\end{itemize*}
Equivalently, \emph{precisely one} of the following holds:
\begin{itemize*}
\item
$D$ is a strongly dense neighbourhood in $P$.
\item
$P\setminus D$ is weakly dense in $P$.
\end{itemize*}
\end{corr}
\begin{proof}
If $D$ is weakly dense in $P$ then by Proposition~\ref{prop.wd.sd.iff}(1) $\interior(P\setminus D)=\varnothing$, so following Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}) $P\setminus D$ is not a strongly dense neighbourhood.

If $D$ is not weakly dense in $P$ then by Proposition~\ref{prop.wd.sd.iff}(1) $\interior(P\setminus D)\neq\varnothing$.
By Lemma~\ref{lemm.open.O.dense.in.topen} (since $P$ is topen)
$\interior(P\setminus D)$ is strongly dense in $P$, thus so is $P\setminus D$.
It follows from Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}) that $P\setminus D$ is a strongly dense neighbourhood in $P$, as required.
\end{proof}


\begin{corr}
\label{corr.sd.char}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and suppose $\varnothing\neq D\subseteq P\in\topens$. 
Then the following are equivalent:
\begin{itemize*}
\item
$D$ is a strongly dense neighbourhood in $P$.
\item
$\interior(D)\neq\varnothing$.
\item
$D$ contains an atom, or in symbols: $\varnothing\lessdot A\subseteq D$.
\end{itemize*}
\end{corr} 
\begin{proof}
We prove a cycle of implications:
\begin{itemize*}
\item
If $D$ is a strongly dense neighbourhood in $P$ then $\interior(D)\neq\varnothing$ direct from Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}).
\item
If $\interior(D)\neq\varnothing$ then there exists an atom $\varnothing\lessdot A\subseteq \interior(D)\subseteq D$ by Corollary~\ref{corr.atom.exists} (since $P$ is chain-bounded).
\item
If $\varnothing\lessdot A\subseteq D$ then using Lemma~\ref{lemm.open.O.dense.in.topen} (since $P$ is topen) $D$ is dense in $P$.
\qedhere\end{itemize*}
\end{proof}



\subsection{Explaining kernels}

\begin{nttn}
Suppose $(\ns P,\opens)$ is a semitopology and $\varnothing\neq D\subseteq P\subseteq\ns P$.
Then:
\begin{enumerate}
\item
Call $D$ \deffont{minimally weakly dense} in $P$ when:
\begin{itemize*}
\item
$D$ is weakly dense in $P$, and 
\item
if $\varnothing\neq D'\subseteq D$ and $D'$ is weakly dense in $P$, then $D'=D$.
\end{itemize*}
\item
Call $D$ a \deffont{minimally strongly dense open subset} of $P$ when:
\begin{itemize*}
\item
$D\in\opens$,
\item
$D$ is a strongly dense subset of $P$, and 
\item
if $\varnothing\neq D'\subseteq D$ and $D'$ is a strongly dense open subset of $P$, then $D'=D$.
\end{itemize*}
\end{enumerate}
\end{nttn}


Recall from Definition~\ref{defn.atomic.open.set}(\ref{item.atoms.of.P}) that $\f{Atoms}(P)=\{A\in\opens \mid \varnothing\lessdot A\subseteq P\}$.
\begin{prop}
\label{prop.kernel.weakly.strongly.dense}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and $P\in\opens$.
Then:
\begin{enumerate*}
\item
$\bigcup\f{Atoms}(P)$ is equal to the sets union of the minimal weakly dense subsets of $P$.
\item
If furthermore $P$ is transitive (so that $P\in\topens$) then $\bigcup\f{Atoms}(P)$ is equal to sets the union of the minimal strongly dense open subsets of $P$. 
\item
If $p\in\ns P$ is regular then $\kernel(p)$ is equal to the union of the minimal weakly dense subsets of $\community(p)$ and also to the union of the minimal strongly dense subsets of $\community(p)$.
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $D$ is weakly dense in $P$ then by Corollary~\ref{corr.wd.meets.atoms}(1) (since $\ns P$ is chain-bounded) $D\between A$ for every atom in $P$.
Thus the union of the minimal weakly dense subsets of $P$ contains $\bigcup\f{Atoms}(P)$.

We also see from Corollary~\ref{corr.wd.meets.atoms}(1) 
that if $D$ is weakly dense then so is $D\cap\bigcup\f{Atoms}(P)$.
Thus the union of the minimal weakly dense subsets of $P$ is contained in $\bigcup\f{Atoms}(P)$.
\item 
If $D$ is strongly dense in $P\in\topens$ then by Corollary~\ref{corr.sd.char} (since $\ns P$ is chain-bounded) $D$ contains an atom.
Thus the union of the minimal strongly dense subsets of $P$ contains $\bigcup\f{Atoms}(P)$.

We also see from Corollary~\ref{corr.sd.char} that if $D$ is minimal strongly dense then $D$ must be \emph{equal} to an atom.
Thus the union of the minimal strongly dense subsets of $P$ is contained in $\bigcup\f{Atoms}(P)$.
\item
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $\community(p)$ is transitive, and 
by Definition~\ref{defn.kernel}(\ref{item.kernel}) $\kernel(p)=\bigcup\f{Atoms}(\community(p))$.
The result now follows by parts~1 and~2 of this result.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
From the point of view of consensus, Proposition~\ref{prop.kernel.weakly.strongly.dense}(3) gives some independent explanation for why $\kernel(p)$ --- the atoms in the community of $p$, as studied in Section~\ref{sect.kernels} --- is interesting.
$\kernel(p)$ identifies where the minimal weakly dense and strongly dense subsets of $\community(p)$ are located.
\end{rmrk}


\subsection{Unifying is-transitive and is-strongly-dense-in}
\label{subsect.unifying.trans.dense}


It turns out that transitivity and denseness are closely related:
in this Subsection we explore their relationship.


\begin{rmrk}
Consider the following three notions:
\begin{enumerate*}
\item
\emph{$D$ is strongly dense in $P$} from Definition~\ref{defn.dense}(\ref{item.strongly.dense}).
\item
\emph{$P$ is transitive} from Definition~\ref{defn.transitive}(\ref{transitive.transitive}).
\item
\emph{$P$ is strongly transitive} from Definition~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}).
\end{enumerate*}
Notice that while the definitions are different, they share a `family resemblance'. 
Can we identify a common ancestor for them; some definition that naturally subsumes them into a most general principle?

Yes: it is easy to see that item~1 and~3 above are very closely related --- see Lemma~\ref{lemm.strongly.dense.strongly.transitive} --- and then we will prove that all three definitions listed above are special instances of a general definition --- see Definition~\ref{defn.transitive.wrt} and Proposition~\ref{prop.most.general}.
\end{rmrk}

\begin{lemm}
\label{lemm.strongly.dense.strongly.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Then the following are equivalent:\footnote{Cf. also Lemma~\ref{lemm.meet-irreducible}.}
\begin{itemize*}
\item
$P$ is strongly transitive.
\item
$O\cap P$ is strongly dense in $P$, for every $O{\in}\opens$ such that $O\between P$ (meaning that $O\cap P\neq\varnothing$).
\end{itemize*}
In words we can say:
\begin{quote}
$P$ is strongly transitive when every nontrivial open intersection with $P$ is strongly dense. % in $P$.
\end{quote}
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}), $P$ is strongly transitive when $O\between P\between O'$ implies $O\cap P\between O'\cap P$.
Unpacking Definition~\ref{defn.dense}(\ref{item.strongly.dense}), $O\cap P$ is strongly dense in $P$ when $P\between O'$ implies $O\cap P\between O'$ --- and this is clearly equivalent to $O\cap P\between O'\cap P$.
The result now follows by routine reasoning.
\end{proof}


We can generalise the notion of strongly dense from Definition~\ref{defn.dense}(\ref{item.strongly.dense}) from $D\subseteq P$ to \emph{any} $D$.
\begin{defn}
\label{defn.transitive.wrt}
Suppose $(\ns P,\opens)$ is a semitopology and $D,P\subseteq\ns P$.

Call $D$ \deffont{strongly dense for} $P$ when
$$
\Forall{O{\in}\opens}P\between O\limp D\between O.
$$
\end{defn}

We state the obvious:
\begin{lemm}
$\varnothing\neq D\subseteq P$ is strongly dense \emph{in} $P$ in the sense of Definition~\ref{defn.dense}(\ref{item.strongly.dense}) if and only if it is strongly dense \emph{for} $P$ in the sense of Definition~\ref{defn.transitive.wrt}.
\end{lemm}
\begin{proof}
The definitions are identical where they overlap.
The only difference is that Definition~\ref{defn.dense}(\ref{item.strongly.dense}) assumes a nonempty subset of $P$, whereas Definition~\ref{defn.transitive.wrt} assumes a nonempty set that intersects (but is not necessarily a subset of) $P$. 
\end{proof}

\begin{lemm}
\label{lemm.strongly.dense.for.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $D,P\subseteq\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$D$ is strongly dense for $P$.
\item
$\closure{P}\subseteq\closure{D}$.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $D$ is strongly dense for $P$.
Then $O\in\opens$ does not intersect with $P$ if and only if $O$ does not intersect with $D$, and it follows (just as in the proof of Proposition~\ref{prop.wd.sd.iff}(2)) that $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$, and so that $\closure{P}\subseteq\closure{D}$.

Conversely, if $\closure{P}\subseteq\closure{D}$ then $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$ and it follows that if $O\in\opens$ does not intersect with $P$ then $O$ does not intersect with $D$, and thus that $D$ is strongly dense for $P$.
\end{proof}



\begin{prop}
\label{prop.most.general}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$\atopen$ is transitive.
\item
$O$ is strongly dense for $\atopen$, for every $O\in\opens$ such that $O\between \atopen$.\footnote{Compare with Lemma~\ref{lemm.strongly.dense.strongly.transitive}, of course.}
\end{itemize*}
\end{prop}
\begin{proof}
We unpack Definition~\ref{defn.transitive.wrt} and see that a condition that $\atopen$ is transitive with respect to every $\atopen\between O\in\opens$ is precisely what Definition~\ref{defn.transitive}(\ref{transitive.transitive}) asserts, namely: for every $O\in\opens$ such that $O\between \atopen$,
$$
\Forall{O'{\in}\opens} \atopen\between O' \limp O\between O'.
\qedhere
$$
\end{proof}


\begin{rmrk}
In topology it makes less sense to talk about $D$ being dense in $P$ for $D\not\subseteq P$, since we can just consider $D\cap P$ --- and if $D$ and $P$ are open then so is $D\cap P$.
In semitopology the following happens: 
\begin{itemize*}
\item
The notion of \emph{dense in} splits into two distinct concepts (\emph{weakly dense in} and \emph{strongly dense in}), as we saw in Definition~\ref{defn.dense} and the subsequent discussion.
\item
The notion of \emph{strongly dense in} generalises to a notion that we call \emph{strongly dense for}, which has the same definition but just weakens a precondition that $D\subseteq P$.
\end{itemize*}
Given the above, we then see from Lemma~\ref{lemm.strongly.dense.strongly.transitive} and Proposition~\ref{prop.most.general}
that the notions of \emph{transitive} and \emph{strongly transitive} from Definitions~\ref{defn.transitive}(\ref{transitive.transitive}) and~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}) lend themselves to being naturally expressed in terms of strongly-dense-for.
\end{rmrk}


\subsection{Towards a continuous extension result} 
\label{subsect.towards.ce}





\begin{rmrk}
\label{rmrk.top.ce}
Topology has a family of results on \emph{continuous extensions} of functions: a nice historical survey is in~\cite{gutev:simecu}. 
Here is an example, adapted from~\cite[Theorem~24.1.15]{erdman:protac}:\footnote{Available online (\href{https://web.archive.org/web/20221128144749/https://web.pdx.edu/~erdman/PTAC/problemtext_pdf.pdf}{permalink}).}
\begin{quote}
Suppose $f:B\to\mathbb R$ is uniformly continuous and suppose $B$ is a dense subset of $A$.
Then $f$ has a unique extension to a continuous function $g:A\to\mathbb R$.
\end{quote}
This is true in the world of topologies: but what might correspond to this in the semitopological world?

A direct translation to semitopologies seems unlikely.\footnote{Except trivially that we can restrict to those semitopologies that are also topologies (i.e. for which intersections of open sets are open).} 
This is because we have seen from Definition~\ref{defn.dense} and Lemma~\ref{lemm.sd.implies.wd} and the subsequent discussion and results how the notion of `is dense in' behaves differently for semitopologies in general, so that the very premise of the topological result above is now up for interpretation.\footnote{There are other differences.  For instance we care a lot in this paper about value assignments --- maps to discrete semitopologies --- rather than maps to $\mathbb R$.
Of course we could try to generalise from value assignments to more general examples, but as we shall see, even this `simple' case of value assignments is more than rich enough to raise some canonical questions.} 

The issue is now whether we can find definitions and well-behavedness conditions on semitopological spaces in general, reflecting the spirit of the corresponding topological results but without assuming that intersections of open sets are open.

We shall see that this is possible and we propose a suitable result below in Definition~\ref{defn.continuous.extension}.
However, before we come to that, we will sketch a design space of \emph{failing} definitions and counterexamples --- and so put our working definition in its proper design context.

We map to semitopologies of values, so (the spirit of) uniform continuity is automatic, and we concentrate (to begin with) on being strongly dense in rather than weakly dense in, since by Lemma~\ref{lemm.sd.implies.wd}(1) the former implies the latter:
\begin{enumerate}
\item
\deffont{Candidate definition 1}.
\begin{quote}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $f:\ns P\to\tf{Val}$ is a value assignment that is continuous on $D\subseteq\ns P$, and suppose $D$ is a strongly dense subset of $\ns P$.
Then $f$ has a unique extension to a continuous function $g:\ns P\to\tf{Val}$.
\end{quote}
This does not work: 
\begin{itemize*}
\item
Take $(\ns P,\opens)$ to be the top-left example in Figure~\ref{fig.012} and 
\item
$\tf{Val}=\{0,1\}$ with the discrete semitopology.
\item
Define $f:\ns P\to\tf{Val}$ such that $f(0)=0$ and $f(1)=1$ and $f(2)=1$ and 
\item
set $D=\{0,2\}$ and $P=\ns P$.
\end{itemize*}
Note that $D$ is a strongly dense open subset of $\ns P$, and $f$ is continuous on $D$.

However, $f$ cannot be continuously extended to a $g$ that is continuous at $1$.
We note that $1$ is conflicted and intertwined with two distinct topens, $\{0\}$ and $\{1\}$.
Looking at this example we see that Candidate definition~1 is unreasonable: \emph{of course} we cannot extend $f$ continuously to $1$, because $1$ is intertwined with two distinct topen sets on which $f$ takes distinct values.
The natural solution is just to exclude conflicted points since they may be, as the terminology suggests, conflicted:
\item
\deffont{Candidate definition 2.}\quad
\begin{quote}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $f:\ns P\to\tf{Val}$ is a value assignment that is continuous on $D\subseteq\ns P$, and suppose $D$ is a strongly dense subset of $\ns P$.
Then $f$ has a unique extension to a function $g:\ns P\to\tf{Val}$ that is continuous at all \emph{unconflicted} points.
\end{quote}
This does not work:
\begin{itemize*}
\item
Take $(\ns P,\opens)$ to be the semitopology in Figure~\ref{fig.nitpick} and 
\item
$\tf{Val}=\{0,1,2\}$ with the discrete semitopology. 
\item
Define $f:\ns P\to\tf{Val}$ such that $f(0)=0$ and $f(1)=1$ and $f(2)=2$ and $f(\ast)=0$ and 
\item
set $D=\{0,1,2\}$ and $P=\ns P$.
\end{itemize*}
Note that $D$ is a strongly dense open subset of $\ns P$ and $f$ is continuous on $D$.

Note that $\ast$ is unconflicted (because $\intertwined{\ast}=\{\ast, 1\}$). 
However, $f$ cannot be continuously extended to a $g$ that is continuous at $\ast$.
\item\label{item.semi-regular}
Candidate definition~2 is even more telling than it might appear.
Note that $\ast$ is unconflicted and quasiregular (Definition~\ref{defn.tn}(\ref{item.quasiregular.point})), because $\community(\ast)=1\neq\varnothing$.

Thus we could not even rescue Candidate definition~2 above by insisting that points be not only unconflicted but also quasiregular (i.e. unconflicted and having a nonempty community).
The next natural step up from this is to be unconflicted and weakly regular, which by Corollary~\ref{corr.corr.pKp} leads us to regular points.
\end{enumerate}
We can now state a definition and result that work:
\end{rmrk}

\begin{defn}
\label{defn.continuous.extension}
Suppose $f,g:(\ns P,\opens)\to\tf{Val}$ are value assignments (Definition~\ref{defn.value.assignment}(2)) and suppose $P\subseteq\ns P$.
\begin{enumerate}
\item
Say that $g$ \deffont{continuously extends} $f$ to regular points in $P$ when:
\begin{itemize*}
\item
If $f$ is continuous at $p\in P$ then $f(p)=g(p)$.
\item
$g$ is continuous on every regular $p\in P$ (Definition~\ref{defn.tn}(\ref{item.regular.point})).
\end{itemize*}
\item
Say that $g$ is a \deffont{unique} continuous extension of $f$ to regular points in $P$ when for any other continuous extension $g'$ 
of $f$ to $P$, we have $g(p)=g'(p)$ for every regular $p\in P$.
\end{enumerate}
\end{defn}


\begin{rmrk}
\label{rmrk.cont.uniq}
Note that `continuously extends' and `uniquely' in Definition~\ref{defn.continuous.extension} both apply to to \emph{regular} points in $P$ only.
By the examples in Remark~\ref{rmrk.top.ce} it would not be reasonable to expect unique continuous extensions on non-regular points.
This gives a retrospective justification for the theories of topens and regular points that we develop in this paper (see Definitions~\ref{defn.transitive} and~\ref{defn.tn}): regularity arises as a natural condition for a semitopological continuous extension result.\footnote{This is not an exclusive claim: other reasonable conditions might also exist.} 
\end{rmrk}


\begin{prop}
\label{prop.cet}
Suppose $f:(\ns P,\opens)\to\tf{Val}$ is a value assignment and suppose $D, P\subseteq\ns P$.
Then:
\begin{enumerate*}
\item
If $f$ is continuous on $D$ then $f$ can be continuously extended to all regular points in $P$.
\item
If furthermore $D$ is strongly dense for $P$ (Definition~\ref{defn.transitive.wrt}) then this extension is unique in the sense of Definition~\ref{defn.continuous.extension}(2).
\end{enumerate*}
\end{prop}
\begin{proof}
Choose some fixed but arbitrary \emph{default value} $v\in\tf{Val}$ and for this choice of $v$ define $g$ by cases as follows:
\begin{itemize}
\item
\emph{Suppose $f$ is continuous at $p$.}

We set $g(p)=f(p)$.
\item
\emph{Suppose $f$ is not continuous at $p$ and $\community(p)\between D$.}

Choose some $d\in\community(p)\cap D$ and set $g(p)=f(d)$.

If $p$ is intertwined with two points $d$ and $d'$ then (because $p$ is regular and so unconflicted by Theorem~\ref{thrm.r=wr+uc}) $d\intertwinedwith d'$ and their open neighbourhoods of continuity intersect, so that $f(d)=f(d')$.
\item
\emph{Suppose $f$ is not continuous at $p$ and $\community(p)\notbetween D$.}

If $D$ is strongly dense for $P$ then this case cannot happen because $P\between\community(p)$ so by the strong dense property $D\between\community(p)$ (see Definition~\ref{defn.dense}(\ref{item.strongly.dense})).

Otherwise, we set $g(p)=v$ (so $g(p)$ is the fixed but arbitrary default value). 
\end{itemize}
We now show that if $p\in P$ is regular, then $g$ is continuous at $p$.
The proof is again by cases:
\begin{itemize}
\item
If $f$ is continuous at $p$ then $g(p)=f(p)$ and so $g$ is continuous at $p$.
\item
If $f$ is not continous at $p$ and $d\in \community(p)\cap D$ then $g(p)=f(d)$.
Thus (since we assumed that $p$ is regular) $p\in \community(p)\subseteq g^\mone(g(p))$, so that $g$ is continuous at $p$.
\item
If $f$ is not continous at $p$ and $\community(p)\cap D=\varnothing$ then $g(p)=v$.
Thus (since we assumed that $p$ is regular) $p\in \community(p)\subseteq g^\mone(v)$, so that $g$ is continuous at $p$.
\end{itemize}
If $D$ is strongly dense for $P$ then uniqueness follows by routine reasoning from the above, using Theorem~\ref{thrm.correlated}.
\end{proof}


In view of Lemma~\ref{lemm.strongly.dense.for.closure} we can more succinctly rephrase Proposition~\ref{prop.cet} as follows:
\begin{corr}
\label{corr.cet.closed}
Suppose %$(\ns P,\opens)$ is a semitopology and 
$f:(\ns P,\opens)\to\tf{Val}$ is a value assignment. 
Then if $f$ is continuous on $D\subseteq \ns P$, then $f$ can be continuously extended to all regular points in $\closure{D}$.
\end{corr}
\begin{proof}
Direct from Proposition~\ref{prop.cet} taking $P=\closure{D}$ and using Lemma~\ref{lemm.strongly.dense.for.closure}. 
\end{proof}

\begin{rmrk}
\label{rmrk.wd.not.enough}
\leavevmode
\begin{enumerate}
\item
There are a few subtleties to Corollary~\ref{corr.cet.closed}.
The result actually tells us that there exists an open set $O\in\opens$ such that $D\subseteq\closure{D}\subseteq O$, and $f$ continuously extends to some $g:\ns P\to\tf{Val}$ that is continuous at $O$.
This is because if $g$ is continuous at $p\in\closure{D}$, then it is by definition continuous on some open neighbourhood of $p$.
\item
Similarly, the condition that $f$ be continuous on $D$ is equivalent to insisting that $f$ be continuous on an \emph{open} $D$.
\item
The condition of $D$ being strongly dense in $P$ is required for uniqueness in Proposition~\ref{prop.cet}(2).
Being weakly dense is not enough.
For, consider the semitopology illustrated in Figure~\ref{fig.wd-not-enough}, such that:
\begin{itemize*}
\item
$\ns P=\{0,1,2,3\}$.
\item
$\opens$ is generated by $D=\{0\}$, $\{0,1\}$, $P=\{0,1,2\}$, and $\{2,3\}$.
\end{itemize*} 
Then we have $D\subseteq P\subseteq\ns P$, and we even have that $D,P\in\opens$ and every point in the space is regular, making this is a particularly well-behaved example.
This semitopology is \emph{not} is a topology, because $P\cap\{2,3\}\not\in\opens$; we will exploit this fact in a moment. 
The reader can check that 
\begin{itemize*}
\item
$D$ is weakly dense in $P$ (because $D$ intersects every open wholly contained in $P$) but 
\item
$D$ is not strongly dense in $P$ (because $D$ does not intersect $\{2,3\}$), and 
\end{itemize*}
the value assignment $f:\ns P\to\mathbb B$ mapping $0$ to $\bot$ and every other point to $\top$ has two continuous extensions to all of $P$: $g$ mapping all points to $\bot$, and $g'$ mapping $0$ and $1$ to $\bot$ and $2$ and $3$ to $\top$.
\end{enumerate}
\end{rmrk}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth,trim={50 20 50 20},clip]{diagrams/wd-not-enough.pdf}
\vspace{-2em}
\caption{A weakly dense subset is not enough for uniqueness (Remark~\ref{rmrk.wd.not.enough}(2))}
\label{fig.wd-not-enough}
\end{figure}




\subsection{Kernels determine values of continuous extensions} 
\label{subsect.kerels.determine}

\begin{rmrk}
In Subsection~\ref{subsect.towards.ce} we considered continuous extensions in a semitopological context.
We concluded with Corollary~\ref{corr.cet.closed}, which showed how to extend a value assignment $f:\ns P\to\tf{Val}$ that is continuous on some $D$, to a $g$ that is continuous on $D$ and on the regular points in $\closure{D}$.

We also discussed why this result is designed as it is and why it seems likely to be optimal within a certain design space as outlined in Remark~\ref{rmrk.top.ce}.

However, our study of semitopologies is motivated by heterogeneous consensus, which is fundamentally about distributed systems.
This means that we also care about intermediate continuous extensions of $f$; i.e. about $g$ that continuously extend $f$ but not necessarily on all of $\closure{D}$. 

The mathematics in this subsection is in some moral sense a `pointwise' dual to the `setwise' mathematics in Subsection~\ref{subsect.towards.ce}.
Perhaps surprisingly, we shall see that when developed pointwise, the details are different: contrast Theorem~\ref{thrm.p.kernel.p} and Corollary~\ref{corr.boundary.kernel} with Proposition~\ref{prop.cet} and Corollary~\ref{corr.cet.closed}; they are similar, but they are not the same.
\end{rmrk} 

Recall that:
\begin{itemize*}
\item
A point $p$ is \emph{regular} when it is an element of its own community (which is the interior of its intertwined points); see Definition~\ref{defn.tn}(\ref{item.regular.point}).
\item
$\kernel(p)$ is the union of the kernel atoms of $p$ (minimal nonempty open sets in the community of $p$); see Definition~\ref{defn.kernel}(\ref{item.kernel}).
\item
A value assignment $f:\ns P\to\tf{Val}$ is a mapping from $\ns P$ to some set of values $\tf{Val}$ having the discrete semitopology; see Definition~\ref{defn.value.assignment}.
\end{itemize*}
We now consider how the value of $f$ on kernel atoms influences the value of $f$ at regular points.


\begin{defn}
\label{defn.regular.f}
Suppose $(\ns P,\opens)$ is a semitopology and $f,g:\ns P\to\tf{Val}$ are value assignments (Definition~\ref{defn.value.assignment}).\footnote{This definition makes sense for $f$ mapping $\ns P$ to any semitopology $\ns Q$, but (for now) we will only care about the case when $\ns Q$ is a discrete semitopology so that $f$ is a value assignment.} 
\begin{enumerate*}
\item
Call $f$ \deffont{confident} at $p\in\ns P$ when $f$ is continuous on some atom $\varnothing\lessdot A\subseteq\kernel(p)$.
\item
Call $f$ \deffont{unanimous} at $p\in\ns P$ when $f$ is continuous on all of $\community(p)$.
\item
We generalise Definition~\ref{defn.continuous.extension} and write $f\leq g$, and call $g$ a \deffont{(partial) continuous extension} of $f$, when for every $p\in\ns P$, if $f$ is continuous at $p$ then $g$ is continuous at $p$ and $f(p)=g(p)$.\footnote{Definition~\ref{defn.continuous.extension} is interested in a $g$ that continuously extends $f$ all at once from $D$ to $\closure{D}$, which is fine mathematically but less helpful computationally.  The definition here refines this concept and is interested in the space of all possible $g$ such that $f\leq g$, which more accurately reflects how $g$ might be computed, in stages, on a network.}

It is routine to check that $\leq$ is a partial order (transitive, reflexive, antisymmetric).
\end{enumerate*}
\end{defn}



\begin{rmrk}
Intuitively, $f$ is `confident' at $p$ when the value we obtain if we continuously extend $f$ to $p$, is already determined.
In the context of a distributed system, it may be that a result has been determined by some part of the system, but not yet fully propagated to the whole system.\footnote{For instance: $f$ may know the results of an election, but not yet have told point $p$; whereas some $g\geq f$ may represent a state in which this result has been correctly propagated to $p$.  Similarly, technology allows us to determine the weather tomorrow based on weather data that was collected this morning, but that is not the same thing as knowing what the weather will be: a supercomputer needs to run calculations, and the data needs to be broadcast, and put on a webpage and sent down a cable and rendered to a computer screen, and so on.}

We make this formal in Theorem~\ref{thrm.p.kernel.p}(\ref{item.fg.leq.cc}).
\end{rmrk}


We start with an easy lemma:
\begin{lemm}
\label{lemm.unanimous.implies.confident}
Suppose $(\ns P,\opens)$ is a chain-bounded semitopology and $f,g:\ns P\to\tf{Val}$ are value assignments.
Then:
\begin{enumerate*}
\item
If $f\leq g$ and $f$ is confident/unanimous at $p$ then $g$ is also confident/unanimous at $p$.
\item
If $f$ is unanimous at $p\in\ns P$ then it is confident at $p$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By simple arguments from the definitions:
\begin{enumerate}
\item
Just unpacking definitions: if $f$ is continuous on some $\varnothing\lessdot A\subseteq\kernel(p)$ then so is $g$; and if $f$ is continuous on $\community(p)$ then so is $g$.
\item
Suppose $f$ is unanimous at $p$, meaning that $f$ is continuous on $\community(p)$.
Then $f$ is also continuous on some kernel atom in $\community(p)$ --- at least one such kernel atom exists by Corollary~\ref{corr.atom.exists}, since $\ns P$ is chain-bounded.
It follows that $f$ is confident at $p$ as required.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}
\label{rmrk.machinery.together}
Suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Val}$ is a value assignment.
Then:
\begin{enumerate}
\item
Suppose $f$ is confident at $p\in\ns P$.

By Definition~\ref{defn.regular.f} $f$ is continuous on some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$.
By Lemma~\ref{lemm.topen.max.min} $A$ is transitive, so by Theorem~\ref{thrm.correlated} (since $f$ is continuous on $A$) $f$ is constant on $A$, and thus it makes sense to use Notation~\ref{nttn.f.const} and write $f(A)$ to denote the (unique) value of $f$ on $A$. 
\item
Likewise if $f$ is unanimous at $p$ then we can sensibly write %$f(\kernel(p))$ and 
$f(\community(p))$.
\item
Just for this paragraph call $f$ \emph{doubly confident} at $p$ when $f$ is continuous on two distinct kernel atoms $\varnothing\lessdot A\neq A'\subseteq\kernel(p)$ of $p$.
Suppose $f$ is doubly confident at $p$ and suppose $p$ is regular; so by the previous paragraph $f(A)$ and $f(A')$ are both well-defined.
Now $A\between A'$ by Lemma~\ref{lemm.kernel.atoms.intersect}, so $f(A)=f(A')$.

Thus being doubly confident at $p$ is the same as just being confident, provided that $p$ is regular so that all of its kernel atoms intersect.
\end{enumerate}
\end{rmrk}



Remark~\ref{rmrk.machinery.together} brings us to a notation:
\begin{defn}
\label{defn.fp.limit}
Suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Val}$ is a value assignment and $p\in\ns P$ is a regular point.
Then define $\lim_p f$ the \deffont{limit} of $f$ at $p$ by 
$$
\lim_p f = f(A) 
$$ 
where $\varnothing\lessdot A\subseteq\kernel(p)$ is some/any (by Remark~\ref{rmrk.machinery.together}(3) writing `some/any' makes sense) kernel atom of $p$ on which $f$ is continuous.
The justification for calling this value the \emph{limit} of $f$ at $p$ is below in Theorem~\ref{thrm.p.kernel.p}, culminating with part~\ref{item.fg.leq.cc} of that result. 
\end{defn}



Recall that Theorem~\ref{thrm.correlated} asserted that continuous value assignments are constant on transitive sets.
We can now prove a more general result along the same lines: 
\begin{thrm}
\label{thrm.p.kernel.p}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$p\in\ns P$ is regular. 
\item
$f,g:\ns P\to\tf{Val}$ are value assignments to some set of values $\tf{Val}$. 
\end{itemize*}
Then:
\begin{enumerate}
\item
If $f$ is confident at $p$ (Definition~\ref{defn.regular.f}(1)) then
$$
f\leq g
\quad\text{implies}\quad 
\lim_p f = \lim_p g .
$$
\item
If $f$ is confident at $p$ and also $f$ is continuous at $p$ (Definition~\ref{defn.continuity}) then
$$
f(p)=\lim_p f.
$$
\item\label{item.fg.leq.cc}
Combining parts~1 and~2 of this result, if $f$ is confident at $p$ and $g$ is continuous at $p$ then
$$
f\leq g 
\quad\text{implies}\quad 
g(p)=\lim_p f.
$$
In words: the limit value of an $f$ confident at $p$, is the value of any sufficiently continuous extension of $f$ --- where `sufficiently continuous' means `continuous at $p$'.
\item\label{item.gpf}
As a corollary using Lemma~\ref{lemm.unanimous.implies.confident}, if $f$ is unanimous at $p$ (Definition~\ref{defn.regular.f}(2)) and $g$ is continuous at $p$, then 
$$
f\leq g 
\quad\text{implies}\quad 
g(p) = \lim_p f = f(\community(p)).
$$
\end{enumerate}
\end{thrm}
\begin{proof}
We reason as follows:
\begin{enumerate}
\item
Since $f$ is confident at $p$, there exists some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ 
on which $f$ is continuous (by Remark~\ref{rmrk.machinery.together}(3) it does not matter which one).
Since $f\leq g$, $g$ is also continuous at $A$.
It follows from Definition~\ref{defn.fp.limit} that $\lim_p f = \lim_p g$.
\item
Since $f$ is confident at $p$, $f$ is continuous on some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$. 
Since $f$ is continuous at $p$, $f$ is continuous on some open neighbourhood $p\in O\in\opens$.
By Lemma~\ref{lemm.ker.intersect} $O\between A$, and using Corollary~\ref{corr.correlated.intersect} we have that $f(p) = f(O) = f(A) = \lim_p f$ as required. 
\item
Direct from parts~1 and~2 of this result, using Lemma~\ref{lemm.unanimous.implies.confident}(1) to note that $g$ is confident at $p$ because $f$ is and $f\leq g$.
\item
Suppose $f$ is unanimous at $p$.
Then by Lemma~\ref{lemm.unanimous.implies.confident} $f$ is confident at $p$, and we use part~\ref{item.fg.leq.cc} of this result.
\qedhere\end{enumerate}
\end{proof}



\begin{rmrk}
We can use Theorem~\ref{thrm.p.kernel.p} to obtain a result that seems to us similar in spirit to Arrow's theorem~\cite{fey:strpat} from social choice theory, in the sense that $\kernel(p)$ is identified as a `dictator' for $\community(p)$ (the technical details seem to be different):
\end{rmrk}


\begin{corr}
\label{corr.boundary.kernel}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a 
semitopology.
\item
$p\in\ns P$ is regular.
\item
$f,f':\ns P\to\tf{Val}$ are value assignments to some set of values $\tf{Val}$. 
\item
$f$ and $f'$ are continuous and confident at $p$. 
\end{itemize*}
Then
$$
f|_{\kernel(p)}=f'|_{\kernel(p)}
\quad\text{implies}\quad
f(p)=f'(p).
$$
In words we can say:
\begin{quote}
Confident continuous values at regular points are determined by their kernel.
\end{quote}
Note that we assume that $f$ and $f'$ are equal on $\kernel(p)$, but they do not need to be continuous on all of $\kernel(p)$; they only need to be continuous (and confident) at $p$.
\end{corr}
\begin{proof}
By confidence of $f$ and $f'$ 
there exist
\begin{itemize*}
\item
a kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ on which $f$ is continuous and so (as discussed in Remark~\ref{rmrk.machinery.together}) on which $f$ is constant with value $f(A)=\lim_p f$, and 
\item
a kernel atom $\varnothing\lessdot A'\subseteq\kernel(p)$ on which $f'$ is continuous and so constant with value $f'(A')=\lim_p f'$.
\end{itemize*}
We do not know that $A$ and $A'$ are equal, but by Lemma~\ref{lemm.kernel.atoms.intersect} they intersect --- in symbols: $A\between A'$ --- so that $\lim_p f= \lim_p f'$.\footnote{If we only had $f|_O=f'|_O$ for some open set $O$ that intersects then kernel (so $O\between\kernel(p)$), then the reasoning would break down at this point. 
We would still know that $A\between A'$ but we would not necessarily know that $O\between (A\cap A')$ so that $f(A)=f(A')$ and $\lim_p f=\lim_p f'$.  (Remember that we have not assumed continuity on all of $\kernel(p)$, so $f$ and $f'$ might not be constant on $\kernel(p)$.)}

We use Theorem~\ref{thrm.p.kernel.p}(1) and the above to reason as follows: 
$$
\begin{array}{r@{\ }l@{\qquad}l}
f(p) =& \lim_p f 
&\text{Theorem~\ref{thrm.p.kernel.p}(3)}
\\
=& \lim_p f' 
&\lim_p f {=} f(A),\ \lim_p f' {=} f'(A'),\ A\between A'
\\
=& f'(p) 
&\text{Theorem~\ref{thrm.p.kernel.p}(3).}
\end{array}
$$
\end{proof}



\section{Conclusions}
\label{sect.conclusions}


\subsection{Topology vs. semitopology}

We briefly compare and contrast topology and semitopology: 
\begin{enumerate}
\item
\emph{Topology:}\ 
We are typically interested in spaces with separation axioms.\footnote{The Wikipedia page on separation axioms (\href{https://web.archive.org/web/20221103233631/https://en.wikipedia.org/wiki/Separation_axiom}{permalink}) includes an excellent overview with over a dozen separation axioms.  No anti-separation axioms are discussed.} 

\emph{Semitopology:}\ 
For our intended application to consensus, we care most about spaces containing sets that satisfy a non-separation property of being intertwined (see Definition~\ref{defn.intertwined.points} and Remark~\ref{rmrk.not.hausdorff}).\footnote{An extra word on this:  Our theory of semitopologies admits spaces whose points partition into distinct communities, as discussed in Theorem~\ref{thrm.topen.partition} and Remark~\ref{rmrk.partition}.  Surely it \emph{must be bad} if not all points need be in consensus in a final state?  Not at all: for example, most blockchains have a \emph{mainnet} and several \emph{testnets} and it is understood that each should be coherent within itself, but different nets \emph{need not} be in consensus with one another --- indeed, if the mainnet had to agree with a testnet then this would likely be a bug, not a feature.  So the idea of a single space with multiple partitions of consensus is not a new idea; it is an old idea, which we frame in a new, fruitful, and more general way.}
\item
\emph{Topology:}\quad 
If a minimal open neighbourhood of a point exists then it is least, because we can intersect two minimal neighbourhoods to get a smaller one which by minimality is equal to both.

Yet, in topology the existence of a least open neighbourhood is not guaranteed (e.g. $0\in\mathbb R$ has no least open neighbourhood).

\emph{Semitopology:}\ 
A point may have multiple minimal open neighbourhoods --- examples are very easy to generate, see e.g. the top-right example in Figure~\ref{fig.012}.
Furthermore, in the useful special case of a chain-bounded semitopology, every open neighbourhood of $p$ contains a(t least one) minimal open neighbourhood of $p$ (Corollary~\ref{corr.cover.exists}) so that existence of minimal open neighbourhoods is assured. 
\item
\emph{Topology:}\quad 
We are typically interested in functions on topologies that are continuous (or mostly so, e.g. $f(x)=1/x$).
Thus for example, the definition of $\tf{Top}$ the category of topological spaces takes continuous functions as morphisms, essentially building in assumptions that continuous functions are of most interest and that finding them is enough of a solved problem that we can restrict to continuous functions in the definition.
 
\emph{Semitopology:}\quad 
For our intended application to consensus, 
we are explicitly interested in functions that may be discontinuous.
This models initial and intermediate states where local consensus has not yet been achieved, or final states on semitopologies that include disjoint topens and non-regular points (e.g. conflicted points), as well as adversarial or failing behaviour.
Thus, having continuity is neither a solved problem, nor even necessarily desirable.
\item
Furthermore: semitopological questions such as `are two points intertwined' or `is this point contained in a topen' appear to be novel.
Also in the background 
is that we are particularly interested in properties and algorithms that work well using local and possibly incomplete or even partially incorrect information.
Thus semitopologies have their own distinct character, because they are mathematically distinct but also because we are motivated to ask questions that have not necessarily been considered before.
\end{enumerate}

\subsection{Related work}
\label{subsect.related.work}

\paragraph*{Semilattices, union sets, and minimal structures}

A semitopology is just a complete subsemilattice of a powerset.
Topology has a similar relation to (complete and finitely co-complete) sublattices of powersets.
The reader may know of \emph{pointless topology}, which abstracts away the concrete powerset to a pointless (i.e. point-free) theory of \emph{locales}; an accessible and brief discussion is in~\cite{johnstone:poipt}.
Presumably there may be a corresponding field of pointless semitopology and it would be interesting to consider what this would look like, but the reader should understand that pointless semitopology is unlikely to be a full account of what interests us here, since we want to model and compute on spaces that have real points representing actual participants in a distributed system.

There is a thread of research into \emph{union-closed families} (subsets of a finite powerset closed under unions).
The motivation is to study the combinatorics of finite subsemilattices of a powerset.
Some progress has been made in this~\cite{poonen:unicf}; the canonical reference for the relevant combinatorial conjectures is the `problem session' on page~525 (conjectures 1.9, 1.9', and 1.9") of~\cite{rival:grao}.
There is no direct connection to this work, though the combinatorial properties considered may yet become useful for proving properties of concrete algorithms.

A \emph{minimal structure} on a set $X$ is a subset of $\powerset(X)$ that contains $\varnothing$ and $X$.
Thus a semitopology is a minimal structure that is also closed under arbitrary unions.
There is a thread of research into minimal structures, studying how notions familiar from topology (such as continuity) fare in weak (minimal) settings~\cite{noiri:defsgf} and how this changes as axioms (such as closure under unions) are added or removed.
An accessible discussion is in~\cite{szaz:minsgt}, and see the brief but comprehensive references in Remark~3.7 of that paper.
Of course our focus is on properties of semitopologies 
which are not considered in that literature; but we share an observation with minimal structures that it is useful to study topology-like constructs, in the absence of closure under intersections. 

\paragraph*{Gradecast converges on a topen}

Many consensus algorithms have the property that once consensus is established in a quorum $O$, it propagates to $\closure{O}$.
For example, in the Grade-Cast algorithm~\cite{feldman_optimal_1988}, participants assign a confidence grade of 0, 1 or 2 to their output and must ensure that if any participant outputs $v$ with grade 2 then all must output $v$ with grade at least 1.
If all the quorums of a participant intersect some set $S$ that unanimously supports value $v$, then the participant assigns grade at least 1 to $v$.

From the view of our paper, this is just taking a closure, which suggests that, to convince a topen to agree on a value, it would suffice to first convince an open neighbourhood that intersects the topen, and then use Grade-Cast to convince the whole topen.
More on this in Proposition~\ref{prop.open.strong-consensus} and Remark~\ref{rmrk.gradecast}. 


\paragraph*{The Consensus Task}

In the traditional Consensus Problem, every process in a distributed system proposes a value and every process must decide a value subject to three conditions: 
\begin{itemize*}
\item
\emph{(Agreement)} all processes that decide must decide the same value, and 
\item
\emph{(Non-Triviality)} every decided value must have been proposed by some process.
\item
\emph{(Termination)} every process eventually decides a value.
\end{itemize*}
The Consensus Problem can be identified as a task~\cite[Section~8.3.1]{herlihy_distributed_2013}, and in this context we can intuitively identify \emph{computing agreement} with computing a continuous function on a semitopology (possibly starting from some non-continuous starting state), and \emph{non-triviality} with a structural property implicit in Remark~\ref{rmrk.uncomputable.semitopology}, that (in the terminology of that Remark) 
if $p$ outputs $v$, then some process in a cover of $p$ (see Remark~\ref{rmrk.uncomputable.semitopology}) must have received the input $v$ (see also Proposition~\ref{prop.open.consensus}).
This suggests:
\begin{defn}
\label{defn.semitopological.consensus}
Suppose $(\ns P, \opens)$ is a finite semitopology and $\ns V$ is a set of values.
Then the \deffont{semitopological consensus task} is the triple $(\ns I, \ns O, \Delta)$ where:
\begin{itemize}
\item $\ns I$ is the (pure) simplicial complex with facets simplices $\{(p_0,v_0),...,(p_n,v_n)\}$ where $n=\#\ns P$, $p_i\in \ns P$ and $v_i\in \ns V$ for every $0\leq i\leq n$, and $p_i\neq p_j$ for every $i\neq j$.

\item $\ns O$ is the (pure) simplicial complex with facets simplices $o=\{(p_0,v_0),...,(p_n,v_n)\}$ where $n=\#\ns P$,  $p_i\in \ns P$ and $v_i \in \ns V$ for every $0\leq i\leq n$, $p_i\neq p_j$ for every $i\neq j$, and $o$, when seen as a function from $\ns P$ to $\ns V$, is a continuous function on the semitopology $(\ns P, \opens)$.

\item $\Delta$ maps $i\in \ns I$ to the (pure) simplicial complex $\Delta(i) \in 2^{\ns O}$ such that $\Delta(\{(p_0,v_0),...,(p_m,v_m)\})$, $0\leq m\leq\#\ns P$, is the simplicial complex with facets simplices $o=\{(p_0,w_0),...,(p_m,w_m)\}\in O$ where, for every $0\leq i\leq m$, there exists a \emph{cover} (minimal open set) $O\in\opens$ for $p_i$ and $0\leq j\leq m$ such that $p_j\in O$ and $w_i=v_j$.
\end{itemize}
\end{defn}

This definition can be extended to the case in which $\ns P$ is infinite when $(\ns P,\opens)$ is a witness semitopology from Definition~\ref{defn.trust.topology}; Corollary~\ref{corr.cover.exists} ensures that covers exist.


Unlike the classic consensus task, the semitopological consensus task is not \emph{colourless}~\cite[Section~4.1.4]{herlihy_distributed_2013} in general: e.g.\,if we have two disjoint topens, it matters which process is assigned which output value, because the two topens must agree within themselves but disagree between one another.

\paragraph*{Algebraic topology as applied to distributed computing tasks}

Continuing the discussion of tasks above, the reader may know that solvability results about distributed computing tasks have been obtained from algebraic topology, starting with the impossibility of $k$-set consensus and the Asynchronous Computability Theorem~\cite{herlihy_asynchronous_1993,borowsky_generalized_1993,saks_wait-free_1993} in 1993.
See~\cite{herlihy_distributed_2013} for numerous such results.
 
The basic observation is that states of a distributed algorithm form a simplicial complex, called its \emph{protocol complex}, and topological properties of this complex, like connectivity, are constrained by the underlying communication and fault model.
These topological properties in turn can determine what tasks are solvable. 
For example: every algorithm in the wait-free model with atomic read-write registers has a connected protocol complex, and because the consensus task's output complex is disconnected, consensus in this model is not solvable~\cite[Chapter~4]{herlihy_distributed_2013}.

This paper is also topological, but in a different way: we use (semi)topologies to study consensus in and of itself, rather than the solvability of consensus or other tasks in particular computation models.
Put another way: the papers cited above use topology to study the solvability of distributed tasks, but this paper shows how the very idea of `distribution' can be viewed as having a semitopological foundation.

Of course we can imagine that these might be combined --- that in future work we may find interesting and useful things to say about the topologies of distributed algorithms when viewed as algorithms \emph{on} and \emph{in} a semitopology. 




\paragraph*{Fail-prone systems and quorum systems}

Given a set of processes $\ns P$, a \emph{fail-prone} system~\cite{malkhi_byzantine_1998}  (or \emph{adversary structure}~\cite{hirt_player_2000}) is a set of \emph{fail-prone sets} $\mathcal{F}=\{F_1,...,F_n\}$ where, for every $1\leq i\leq n$, $F_i\subseteq \ns P$.
$\mathcal{F}$ denotes the assumptions that the set of processes that will fail (potentially maliciously) is a subset of one of the fail-prone sets.
A \emph{dissemination quorum system} for $\mathcal{F}$ is a set  $\{Q_1,..., Q_m\}$ of quorums where, for every $1\leq i\leq m$, $Q_i\subseteq \ns P$, and such that 
\begin{itemize*}
\item
for every two quorums $Q$ and $Q'$ and for every fail-prone set $F$, $\left(Q\cap Q'\right)\setminus F\neq\emptyset$ and 
\item
for every fail-prone set $F$, there exists a quorum disjoint from $F$.
\end{itemize*}
Several distributed algorithms, such as Bracha Broadcast~\cite{bracha_asynchronous_1987} and PBFT~\cite{castro_practical_2002}, rely on a quorum system for a fail-prone system $\mathcal{F}$ in order to solve problems such as reliable broadcast and consensus assuming (at least) that the assumptions denoted by $\mathcal{F}$ are satisfied.

Several recent works generalize the fail-prone system model to heterogeneous systems.
Under the failure assumptions of a traditional fail-prone system, Bezerra et al.~\cite{bezerra_relaxed_2022} study reliable broadcast when participants each have their own set of quorums.
Asymmetric Fail-Prone Systems~\cite{cachin_asymmetric_2019} generalize fail-prone systems to allow participants to make different failure assumption and have different quorums.
In Permissionless Fail-Prone Systems~\cite{cachin_quorum_2023}, participants not only make assumptions about failures, but also make assumptions about the assumptions of other processes;
the resulting structure seems closely related to witness semitopologies, but the exact relationship still needs to be elucidated.

In Federated Byzantine Agreement Systems~\cite{mazieres2015stellar}, participants declare quorum slices and quorums emerge out of the collective quorum slices of their members.
Quorum slices are a special case of the notion of witness in Definition~\ref{defn.witnessed.set}(\ref{witness.witness}).
Garca-Prez and Gotsman~\cite{garcia2018federated} rigorously prove the correctness of broadcast abstractions in Stellar's Federated Byzantine Agreement model and investigate the model's relationship to dissemination quorum systems.
The Personal Byzantine Quorum System model~\cite{losa:stecbi} is an abstraction of Stellar's Federated Byzantine Agreement System model and accounts for the existence of disjoint consensus clusters (in the terminology of the paper) which can each stay in agreement internally but may disagree between each other.
Consensus clusters are closely related to the notion of topen in Definition~\ref{defn.transitive}(\ref{transitive.cc}).

Sheff et al. study heterogeneous consensus in a model called Learner Graphs~\cite{sheff_heterogeneous_2021} and propose a consensus algorithm called Heterogeneous Paxos.

Cobalt, the Stellar Consensus Protocol, Heterogeneous Paxos, and the Ripple Consensus Algorithm~\cite{macbrough_cobalt_2018,mazieres2015stellar,sheff_heterogeneous_2021,schwartz_ripple_2014} are consensus algorithms that rely on heterogeneous quorums or variants thereof.
The Stellar network~\cite{lokhafa:fassgp} and the XRP Ledger~\cite{schwartz_ripple_2014} are two global payment networks that use heterogeneous quorums to achieve consensus among an open set of participants; the Stellar network is an instance of a witness semitopology.

The literature on fail-prone systems and quorum systems is most interested in synchronisation algorithms for distributed systems and has been less concerned with their deeper mathematical structure.
Some work by the second author and others~\cite{losa:stecbi} gets as far as proving an analogue to Lemma~\ref{lemm.cc.unions} (though we think it is fair to say that the presentation in this paper is much simpler and more clear), but it fails to notice the connection with topology and the subsequent results which we present in this paper.

\subsection{Future work} 

There is a great deal more to say than we have covered in this paper.\footnote{\dots for all its length, it's just a start.} 
We briefly outline the many ways in which this work can be extended and improved:
\begin{enumerate}
\item
In Definition~\ref{defn.value.assignment} we define a \emph{value assignment} $f:\ns P\to\tf{Val}$ to be a function from a semitopology to a codomain $\tf{Val}$ that is given the discrete semitopology.
This is a legitimate starting point, but of course we should consider more general codomains.
This could include an arbitrary semitopology on the right (for greatest generality), but even for our intended special case of consensus it would be interesting to try to endow $\tf{Val}$ with a semilattice structure (or something like it), at least, e.g. to model merging of distinct updates a ledger.
We can easily generate a (semi)topology from a semilattice by taking points to be elements of the lattice and open sets to be up-closed sets, and this would be a natural generalisation of the discrete semitopologies we have used so far.
\item
We have not considered morphisms of semitopologies and how to organise semitopologies into a category.
The `obvious' definition --- semitopologies and continuous functions between them --- is most likely not the best choice, since even for value assignments we are explicitly interested in functions that are \emph{not} necessarily continuous everywhere.

A more likely candidate seems to be semitopologies and open functions between them (mapping open sets to open sets), since for our intended application to consensus we may naturally expect a quorum to map to a quorum.
This is future work.
\item 
We have discussed dense subsets, but not (yet) considered notions of sequence or net convergence.
Nor have we considered what would correspond to the exponential (or \emph{Vietoris}) semitopology, or looked into appropriate representation theorems for semitopologies.

Semilattice representation results exist~\cite{bredhikin:repts}, but a design space exists here and we should look for representations well-suited to computationally verifying or refuting properties of witness semitopologies.
\item
It remains to consider Byzantine behaviour, by which we mean that some participants may misreport their view of the network in order to `invent' or sabotage quorums and so influence the outcome of consensus.

So for instance we can ask: ``What conditions can we put on a witness function to guarantee that changing the witness function at one point $p$ will not change $\kernel(p')$ for any $p'\neq p$?''.
Thus intuitively, given a semitopology $(\ns P,\opens)$ we are interested in asking how properties range over a `ball' of semitopologies that are near to it in the sense of being small perturbations --- as might be caused by various possible non-standard behaviours from a limited number of Byzantine points --- and in particular we are looking for criteria to guarantee that appropriately-chosen good properties be preserved under perturbation.
\item
This paper studies how consensus, once achieved on an open set $O$, propagates to its closure $\closure{O}$.
However, this is just half of the problem of consensus itself: it remains to understand (within our semitopological framework) what it is to attain consensus on some open set in the first place.
That is: suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Var}$ is a value assignment.
Then what does it mean, in maths and algorithms, to find a value assignment $f':\ns P\to\tf{Var}$ that is `close' to $f$ but is continuous on some open set $O$?
In this paper we have constructed a detailed theory of what it would then be to extend $f'$ to an $f''$ that continuously extends $f'$ to regular points; but we have not yet looked at how to build the $f'$. 
We speculate that unauthenticated Byzantine consensus algorithms (like Information-Theoretic HotStuff~\cite{abraham_information_2020}) can be made to work in our setting, because, contrary to authenticated algorithms, unauthenticated algorithms do not rely on one participant being able to prove to another, by exhibiting signed messages, that a quorum has acted in a certain way (this might require further generalisation of semitopologies to allow participants to have different notions of quorum).
\end{enumerate}

\subsection{Final comments} 
\label{subsect.future.work}

Centrally-managed systems have a single point of failure, can be easily censored, and may not be inclusive.
They require that users trust the central authority, they may have difficulty scaling, and they may suffer from bandwidth and/or latency issues.
As a result, many modern use are trying to be decentralised.

This leads to the kind of permissionless, heterogeneous, locally operating systems we created semitopologies to study.
Semitopologies are novel but they sit in a well-understood mathematical landscape and bring together fields that \emph{a priori} seem quite distinct; witness functions have good mathematical properties, give a pleasing connection to declarative programming, and go some way to explaining why permissionless heterogenous distributed systems are practical in the real world; and while our emphasis in this paper is theoretical, the maths points to nice algorithms of the right type to be useful. 
 




%\bibliographystyle{amsalpha}
%\bibliography{../JamieBIB}
\input{topoc.bbl}

\end{document}
