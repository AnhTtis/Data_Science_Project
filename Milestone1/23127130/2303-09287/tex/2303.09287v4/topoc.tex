\documentclass[acmjacm]{acmsmall}

 
\usepackage{latexsym,xspace,calc,amsthm}
\usepackage{amsmath,amssymb} %comment out for llncs ,amsthm}

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{3}

%to number lines
%\usepackage[displaymath, mathlines]{lineno}
%\linenumbers

%\usepackage{mathsastext}
%FONTS
% allow fonts at arbitrary sizes
\usepackage{lmodern}
% improve typsetting
\usepackage{microtype}
%\usepackage{tgadventor}
%TeX Gyre Adventor is based on the URW Gothic L family of fonts (which is derived from ITC Avant Garde Gothic, designed by Herb Lubalin and Tom Carnase).
%TeX Gyre Bonum is based on the URW Bookman L family (from Bookman Old Style, designed by Alexander Phemister).
%TeX Gyre Chorus is based on URW Chancery L Medium Italic (from ITC Zapf Chancery, designed by Hermann Zapf in 1979).
%TeX-Gyre Cursor is based on URW Nimbus Mono L (based on Courier, designed by Howard G. Kettler in 1955, for IBM).
%\usepackage{tgheros}
%TeX Gyre Heros is based on URW Nimbus Sans L (from Helvetica, prepared by Max Miedinger, with Eduard Hoffmann in 1957).
%\usepackage{tgpagella}
%TeX Gyre Pagella is based on URW Palladio L (from Palatino, designed by Hermann Zapf in the 1940s).
%TeX Gyre Schola is based on the URW Century Schoolbook L family (which was designed by Morris Fuller Benton for the American Type Founders).
\usepackage{tgtermes}
%TeX Gyre Termes is based on the URW Nimbus Roman No9 L family of fonts (whose original, Times, was designed by Stanley Morison together with Starling Burgess and Victor Lardent and first offered by Monotype).
\usepackage{fix-cm}

%https://tex.stackexchange.com/questions/340097/bold-sans-serif-math-font
\usepackage{bm} % for bold sans serif math font with \bm
%\usepackage{unicode-math} % for bold sans serif math font with \mathbfsfit and \mathbfsfup
%\usepackage{isomath} % for bold sans serif math font with \mathsfbfit
%\renewcommand\bm[1]{{\mathbfsfup #1}}

\usepackage{cancel}

%workaround to deal with command defined twice, as per https://texfaq.org/FAQ-alreadydef
\usepackage{savesym}
\savesymbol{subcaption}
\usepackage{subcaption}

\usepackage{graphbox} % align=c option in includegraphics https://tex.stackexchange.com/questions/7219/how-to-vertically-center-two-images-next-to-each-other
%\input{prooftree}

%fix amsalpha acmsmall bibtex numbering issue, solution taken from
%http://tex.aspcode.net/view/635399273629833626282438/forcing-numbered-bibliography
\makeatletter
\def\@biblabel#1{[#1]} % restore basic form of \@biblabel macro
\def\thebibliography#1{%
    \footnotesize
    \refsection*{{\refname}
        \@mkboth{\uppercase{\refname}}{\uppercase{\refname}}%
    }
    \list{\@biblabel{\@arabic\c@enumiv}}% %the default form of first arg is {}
       {\settowidth\labelwidth{\@biblabel{#1}}%
        \leftmargin\labelwidth
        \advance\leftmargin\bibindent
        \itemindent-\bibindent
        \itemsep2pt
        \parsep \z@
        \usecounter{enumiv}% % default is to use enumi
        \let\p@enumiv\@empty
        \renewcommand\theenumiv{\@arabic\c@enumiv}%
    }%
    \let\newblock\@empty
    \sloppy
    \sfcode`\.=1000\relax
}
\makeatother

%Compact bibliography, due to Axel Reichert.
\let\odlthebibliography=\thebibliography
 \let\endodlthebibliography=\endthebibliography
 \renewenvironment{thebibliography}[1]{%
   \begin{odlthebibliography}{#1}%
     \setlength{\parskip}{0ex}%
     \setlength{\itemsep}{3pt}%
     \fontsize{9.5}{9.5} %Change these numbers to
                         %change font size
     \selectfont
}%
 {%
   \end{odlthebibliography}%
 }


\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{cd,decorations.markings}
\tikzset{
    dharrow/.style={
        <->,
        postaction={decorate,-},
        }
}
\tikzset{
    dhdashedarrow/.style={
        <->,
        dashed,
        postaction={decorate,-},
        }
    }
\tikzset{
    lrharpoonarrow/.style={
        <[harpoon]->[harpoon],
        postaction={decorate,-},
        }
}
\tikzset{
    lrharpoondashedarrow/.style={
        <[harpoon]->[harpoon],
        dashed, %pattern=on 2pt off 4pt on,
        postaction={decorate,-},
        }
}
\usetikzlibrary{arrows}
\usetikzlibrary {arrows.meta} 
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{snakes,automata,chains}
\usetikzlibrary{graphs}

\usepackage{binarytree}

\usepackage{amssymb,stmaryrd,amsmath}
\usepackage{mdwlist} % compact lists
\usepackage{float}   % figure placement
\usepackage{centernot} % for centernot comment
%\usepackage{navigator}


\usepackage[colorlinks]{hyperref}
\usepackage{breakurl}  % for line breaks in \burl links
%To stop URL links from appearing in colour, which appear as gray in printed text
%\hypersetup{urlcolor=black,colorlinks}
%\hypersetup{allcolors=black}

%%for llncs, set up environments
%\spnewtheorem{thrm}{Theorem}[subsection]{\sc }{} %{\itshape}
%\spnewtheorem{lemm}[thrm]{Lemma}{\sc }{} %{\itshape}
%\spnewtheorem{prop}[thrm]{Proposition}{\sc }{} %{\itshape}
%\spnewtheorem{corr}[thrm]{Corollary}{\sc }{} %{\itshape}
%
%\spnewtheorem{nttn}[thrm]{Notation}{\sc }{}
%\spnewtheorem{defn}[thrm]{Definition}{\sc }{}
%\spnewtheorem{xmpl}[thrm]{Example}{\sc }{}
%\spnewtheorem{rmrk}[thrm]{Remark}{\sc }{}

%for amsthm
\newtheoremstyle{jamiestyle}% name of the style to be used
  {4pt}% measure of space to leave above the theorem. E.g.: 3pt
  {0pt}% measure of space to leave below the theorem. E.g.: 3pt
  {\it}% name of font to use in the body of the theorem
  {0pt}% measure of space to indent
  {\sc}% name of head font
  {.}% punctuation between head and body
  { }% space after theorem head; " " = normal interword space
  {}% Manually specify head
\theoremstyle{jamiestyle}
\newtheorem{thrm}{Theorem}[subsection]
\newtheorem{prop}[thrm]{Proposition}
\newtheorem{lemm}[thrm]{Lemma}
\newtheorem{corr}[thrm]{Corollary}
\newtheorem{conj}[thrm]{Conjecture}
\newtheoremstyle{jamienfstyle}% name of the style to be used
  {4pt}% measure of space to leave above the theorem. E.g.: 3pt
  {0pt}% measure of space to leave below the theorem. E.g.: 3pt
  {\normalfont}% name of font to use in the body of the theorem
  {0pt}% measure of space to indent
  {\sc}% name of head font
  {.}% punctuation between head and body
  { }% space after theorem head; " " = normal interword space
  {}% Manually specify head
\theoremstyle{jamienfstyle}
\newtheorem{nttn}[thrm]{Notation}
\newtheorem{defn}[thrm]{Definition}
\newtheorem{xmpl}[thrm]{Example}
\newtheorem{rmrk}[thrm]{Remark}


%colours and listings
\usepackage{color}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\usepackage{listings}
 
\definecolor{gray}{RGB}{128, 128, 128}
\definecolor{lightgray}{RGB}{200, 200, 200}
\definecolor{cyan}{RGB}{0, 255, 255}
\definecolor{blue}{RGB}{0, 0, 255}
\definecolor{red}{RGB}{255, 0, 0}
\definecolor{pink}{RGB}{255, 128, 128}
\definecolor{green}{RGB}{0, 128, 0}
\definecolor{lightyellow}{RGB}{255, 255, 200}
\definecolor{purple}{RGB}{128, 0, 128}

\lstdefinestyle{all}
    {basicstyle=\ttfamily\scriptsize,
     keywordstyle=\color{blue}\ttfamily\scriptsize,
     commentstyle=\color{green}\ttfamily\scriptsize,
     stringstyle=\color{red}\ttfamily\scriptsize}

\lstdefinelanguage{hask}{%
    frame=none,
    xleftmargin=2pt,
    belowcaptionskip=\bigskipamount,
    captionpos=b,
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{gray},
    emphstyle={\bf},
	morecomment=[s][\color{green}]{\{-}{-\}},
    stringstyle=\mdseries\rmfamily,
    commentstyle=\color{green},
    keywords={},
    keywords=[1]{case, of, data, if, then, else, where, let, in, do},
    keywords=[2]{Chip, Config, CurrencySymbol, TokenName, PubKeyHash, Integer, Value, State, Action, Text, Maybe, Void, TxConstraints,  Contract},
    keywords=[3]{HasNative},
    keywords=[4]{=>},
    keywords=[5]{Just, Nothing, MkChip, MkConfig, SetPrice, Buy},
    keywordstyle=[1]\mdseries\sffamily\color{red},
    keywordstyle=[2]\mdseries\sffamily\color{blue},
    keywordstyle=[3]\mdseries\sffamily\color{green},
    keywordstyle=[4]\mdseries\sffamily,
    keywordstyle=[5]\mdseries\sffamily\color{purple},
    columns=flexible,
    basicstyle=\small\sffamily,
    showstringspaces=false,
    breaklines=false,
    showspaces=false,
    escapeinside={--}{\^^M},escapebegin={\color{green}--},escapeend={},
    literate= {+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 {=}{{$=$}}1
              {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
              {\\\\}{{\char`\\\char`\\}}1
              {->}{{$\rightarrow$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
              {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2
              {\ .}{{$\circ$}}2 {\ .\ }{{$\circ$}}2
              {>>}{{>>}}2 {>>=}{{>>=}}2
              {|}{{$\mid$}}1
              {\_}{{\underline{\hspace{2mm}}}}2
}

\lstdefinelanguage{solidity}{%
    frame=none,
    xleftmargin=2pt,
    belowcaptionskip=\bigskipamount,
    captionpos=b,
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{gray},
    emphstyle={\bf},
	morecomment=[s][\color{green}]{\{-}{-\}},
    stringstyle=\mdseries\rmfamily,
    commentstyle=\color{green},
    keywords={},
    keywords=[1]{pragma, solidity, contract, event, constructor, require, function, return, emit},
    keywords=[2]{address, uint, mapping},
    keywords=[3]{public, payable, external, view, returns},
    keywords=[4]{=>, +=, -=, =, <=, ==},
    keywords=[5]{msg, sender, transfer, value},
    keywordstyle=[1]\mdseries\sffamily\color{red},
    keywordstyle=[2]\mdseries\sffamily\color{blue},
    keywordstyle=[3]\mdseries\sffamily\color{green},
    keywordstyle=[4]\mdseries\sffamily,
    keywordstyle=[5]\mdseries\sffamily\color{purple},
    columns=flexible,
    basicstyle=\small\sffamily,
    showstringspaces=false,
    breaklines=false,
    showspaces=false,
    escapeinside={--}{\^^M},escapebegin={\color{green}--},escapeend={},
    literate= {+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 {=}{{$=$}}1
              {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
              {\\\\}{{\char`\\\char`\\}}1
              {->}{{$\rightarrow$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
              {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2
              {\ .}{{$\circ$}}2 {\ .\ }{{$\circ$}}2
              {>>}{{>>}}2 {>>=}{{>>=}}2
              {|}{{$\mid$}}1
              {\_}{{\underline{\hspace{2mm}}}}2
}


%%Put "DRAFT" in the background.  Due to Filox
%\usepackage{graphics} %or \usepackage{graphicx}
%\usepackage{type1cm}
%\usepackage{eso-pic}
%\makeatletter
%\AddToShipoutPicture{ %
%            \setlength{\@tempdimb}{.5\paperwidth}%
%            \setlength{\@tempdimc}{.5\paperheight}%
%            \setlength{\unitlength}{1pt}%
%            \put(\strip@pt\@tempdimb,\strip@pt\@tempdimc){ %
%        \makebox(0,0){\rotatebox{55}{\textcolor[gray]{0.96} %
%        {\fontsize{5cm}{5cm}\selectfont{DRAFT}}}}%
%           % Adjust 7cm to desired font size as necessary
%            } %
%}
%\makeatother


%\usepackage{adjustbox}
%\newcommand\compressandraise[1]{\hspace{.2pt}\raisebox{.52pt}{\scalebox{.75}{$#1$}}\hspace{.2pt}}
%\newcommand\flanks{\compressandraise{\rlap{$\mathsf O$}\hspace{3.2pt}\mathsf C}}
%\newcommand\flanks{\triangleleft}
\newcommand\flanks{\ltimes}
%\newcommand\flanks{\rlap{$\bigcirc$}\hspace{4pt}\adjustbox{trim = 0pt 0pt 3pt 0pt, clip}{$\bigcirc$}}
%\newcommand\flanks{\mathbin{\reflectbox{$\multimap$}}}
%\newcommand\flanks{\mathbin{))}}

\newcommand\declaresoundness[2]{The case of \rulefont{#1} with $#2$.}
\newcommand\declaresoundnessshort[1]{The case of \rulefont{#1}.}

%\usepackage{mathtools}
%
%\newcommand{\xlrharpoon}[1]{
%  \mathrlap{\xleftharpoonup{\phantom{#1}}}%
%  \xrightharpoondown{#1}
%}
%\newcommand{\lrharpoon}{\xlrharpoon{}}

% https://tex.stackexchange.com/questions/454010/left-right-harpoon-arrow-with-text
\makeatletter
% adapted from https://tex.stackexchange.com/a/96555/4427
\newcommand\hpn[2][]{%
  \ext@arrow 9999{\hpnfill@}{#1}{#2}}
\newcommand\hpnfill@{%
  \arrowfill@\leftharpoonup\relbar\rightharpoondown}
\makeatother

%\newcommand{\lrharpoon}{\intersectswith} 
\newcommand{\lrharpoon}{\mathbin{\hpn{}}}
\newcommand{\nlrharpoon}{\mathbin{\not\hpn{}}}
\newcommand\id{\f{id}}

%paraconsistent logic
\newcommand\THREE{{\mathbf 3}}
\newcommand\binaryconnectives{\ensuremath{\{\tnotor,\tlatticeiff,\tand,\tor,\timp,\tiff,\tlesssim,\tapprox\}}} 
\newcommand\unaryconnectives{\ensuremath{\{\tneg,\Box,\Diamond,\both\}}}
\newcommand\FOUR{{\mathbf 4}}
\newcommand\tvT{{\mathbf t}}
\newcommand\tvF{{\mathbf f}}
\newcommand\tvB{{\mathbf b}}
\newcommand\tvN{{\mathbf n}}
\newcommand\tvsTB{{\mathit{tb}}}
\newcommand\tvsFB{{\mathit{fb}}}
\newcommand\tvsTT{{\mathit{tt}}}
\newcommand\tvsFF{{\mathit{ff}}}

\newcommand\xor{\mathbin{\mathsf{\small xor}}}
\newcommand\both{{\mathsf B}}
\newcommand\witno{\prec}
\newcommand\atopen{T}
\newcommand\afilter{F}
\newcommand\apoint{P}
\newcommand\avaluation{f} %{\varsigma}
\newcommand\indicator[1]{\delta_{#1}} 
\newcommand\charop[1]{\f{char}(#1)}
\newcommand\resilient{R}
\newcommand\rulefont[1]{\ensuremath{{\mathrm{\bf (#1)}}}}
\newcommand\leftopeninterval[1]{(#1]}
\newcommand\rightopeninterval[1]{[#1)}
\newcommand\openinterval[1]{(#1)}
\newcommand\closedinterval[1]{[#1]}
\newcommand\opens{\tf{Open}}
\newcommand\regularOpens{\tf{Open}_{\f{reg}}}
\newcommand\topens{\tf{Topen}}
\newcommand\closed{\tf{Closed}}
\newcommand\regularClosed{\tf{Closed}_{\f{reg}}}
\newcommand\thenext[0]{\f{ad}}
%\newcommand\thenext[1]{#1^\plus}
\newcommand\eventually[0]{\f{dep}^\omega}
\newcommand\closure[1]{|#1|}
%\newcommand{\sbt}{{\tikz \draw (0,0) circle (1pt);}}
%\newcommand{\sbt}{{\begin{picture}(-1,1)(-1,-3)\circle*{2}\end{picture}}}
\newcommand\dotclosure[1]{\closure{#1}^{\bigcdot}}
\newcommand{\dotarrow}{% to be used in math mode...
   \mathrel{\ooalign{\hss\raise.85ex\hbox{\scalebox{1.25}{\normalfont .}}%
   \kern0.35ex\hss\cr$\rightarrow$}}}
\newcommand{\dotleftarrow}{\mathrel{\reflectbox{$\dotarrow$}}}

% https://tex.stackexchange.com/questions/474455/how-to-manually-adjust-symbol-positioning-in-underset
\newcommand{\upperset}[2]{
  \underset{
            \text{\raisebox{0.9ex}{\smash{\scalebox{0.8}{$#1$}}\ \ }}%
           }
           {
            \text{\raisebox{0ex}{\smash{$#2$}}}
           }
                       }
\newcommand{\convergesto}[1]{\mathrel{\upperset{#1}{\dotarrow}}}
%\newcommand\betwixt{\rotatebox[origin=c]{-90}{$\between$}}
\newcommand\betwixt{\asymp}
%\newcommand\betwixt{\asymp}
\newcommand\notbetween{\mathbin{\cancel{\between}}}
\newcommand\notintertwinedwith{\mathrel{\notbetween}}
\newcommand\intersectswith{\between}
\newcommand\stronglybetween{\mathbin{\rlap{$\between$}\hspace{-1.5pt}\between}}
\newcommand\intertwined[1]{#1_{\between}}
\newcommand\intertwinedwith{\mathrel{\between}}
\newcommand\stronglyintertwinedwith{\mathrel{\stronglybetween}}
\newcommand\leqk{\leq_{\hspace{-.7pt}\intertwinedwith}}
\newcommand\geqk{\geq_{\hspace{-.7pt}\intertwinedwith}}
\newcommand\cw{\leftrightarrow}  % cw = connects with
\newcommand\ctr{\rightarrow}  % ct = connects to 
\newcommand\notctr{{\not\rightarrow}}  % ct = connects to 
\newcommand\ctl{\leftarrow}  % ct = connects to 
\newcommand\cti{\leq}  % ct = connects to 
%\newcommand\cti{{\hookrightarrow}}  % ct = connects to 
\newcommand\ctieq{{\stackrel{=}{\hookrightarrow}}}  % ct = connects to 
%\newcommand\ctieq{{\rlap{\hspace{2pt}=}{\hookrightarrow}}} 
\newcommand\notcti{{\not\hookrightarrow}}  % ct = connects to 
\newcommand\nbhd[0]{\f{nbhd}}
\newcommand\interior[0]{\f{interior}}
\newcommand\kiss[0]{\f{kiss}}
\newcommand\community[0]{\f{K}}
\newcommand\framecommunity[0]{\f{k}}
\newcommand\kernel[0]{\f{ker}}
\newcommand\Kernel[0]{\f{Ker}}
\newcommand\witness[0]{\f{W}}
\newcommand\Kmod[1]{\tf K_{\hspace{-2pt}#1}}
\newcommand\cast[1]{#1^{\ast c}}
\newcommand\cclo[1]{#1^c}
%other commands
\newcommand\mbot{\mathsf{e}}
\newcommand\mtop{\mathsf{f}}
\newcommand\isdef[2]{#1\bullet #2}
\newcommand\deffont[1]{{\bfseries #1}}
\newcommand\powerset{\f{pow}}
\newcommand\comppowerset{\f{pow}_{\hspace{-2pt}c}}
\newcommand\finpow{\f{fin}}
\newcommand\finto{\stackrel{\f{fin}}{\rightharpoonup}}
\newcommand\f[1]{\mathit{#1}}
\newcommand\tf[1]{\mathsf{#1}}
\newcommand\ns[1]{\bm{\mathsf{#1}}}
\newcommand\finsubseteq{\mathbin{\subseteq_{\text{\it fin}}}}
\newcommand\at{\text{@}}
\newcommand\tx{\f{tx}}
\newcommand\ty{\f{ty}}
\newcommand\ctx{\f{ctx}}
%\newcommand\txs{\f{T\hspace{-2.1pt}xs}}
\newcommand\txs{\f{txs}}
\newcommand\utxi{\f{utxi}}
\newcommand\utxo{\f{utxo}}
\newcommand\stx{\f{stx}}
\newcommand\utxio{\f{utxio}}
\newcommand\UTxIO{\f{UTxIO}}
\newcommand\inlinehask[1]{\lstinline[language=hask]{#1}}
\newcommand\inlinesolidity[1]{\lstinline[language=solidity]{#1}}
%\newcommand\utxo{\f{UTxO}}
\newcommand\valid{\f{valid}}
\newcommand\liff{\Longleftrightarrow}
\newcommand\limp{\Longrightarrow}
\newcommand\aeq{\mathrel{=_{\alpha}}}
\newcommand\ssm{{{:}\text{=}}}
\DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}
\newcommand\minus{{\shortminus}}
%\newcommand\minus{{-}}
\newcommand\plus{{+}}
\newcommand\Forall[1]{\forall #1.}
\newcommand\Exists[1]{\exists #1.}
\newcommand\sm{\mapsto}
\newcommand\rewritesto{\longrightarrow}
\newcommand\cent{\vdash}
\newcommand\ncent{\not\vdash}
\newcommand\ment{\vDash}
\newcommand\supp{\f{supp}}
\newcommand\boundary{\f{boundary}}
\newcommand\lmodel{[\hspace{-0.2em}[}
\newcommand\rmodel{]\hspace{-0.2em}]}
\newcommand\model[1]{{\lmodel #1 \rmodel}}
\newcommand\synmodel[1]{{\langle #1 \rangle}}
\newcommand\mone{{\text{-}1}}
\newcommand\fv{\f{fv}}

%\newcommand\barcent{\mathrel{\stackrel{\vspace{-1em}{\_}}{\cent}}}
% https://tex.stackexchange.com/questions/349834/stackrel-but-lower
\makeatletter
\DeclareRobustCommand{\barcent}{\mathbin{\mathpalette\barcent@@\relax}}
\newcommand{\barcent@@}[2]{%
  \vbox{\offinterlineskip
    \sbox\z@{$\m@th#1\cent$}%
    \ialign{%
      \hfil##\hfil\cr
      $\m@th#1{}_{\minus}\kern-\scriptspace$\cr
      \noalign{\kern-.3\ht\z@}
      \box\z@\cr
    }%
  }%
}
\makeatother

% https://tex.stackexchange.com/questions/266890/redefining-pmb-for-nicer-results
% improved pmb
\makeatletter
\def\pmb@#1#2{\setbox8\hbox{$\m@th#1{#2}$}%
  \setboxz@h{$\m@th#1\mkern-.1mu$}\pmbraise@\wdz@
  \binrel@{#2}%
  \dimen@-\wd8 %
  \binrel@@{%
    \mkern-.1mu\copy8 %
    \kern\dimen@\mkern-.2mu\copy8 %
    \kern\dimen@\mkern-.3mu\copy8 %
    \kern\dimen@\mkern-.4mu\copy8 %
    \kern\dimen@\mkern.1mu\copy8 %
    \kern\dimen@\mkern.2mu\copy8 %
    \kern\dimen@\mkern.3mu\copy8 %
    \kern\dimen@\mkern.0mu\raise\pmbraise@\copy8 %
    \kern\dimen@\mkern.4mu\box8 % 
           }%
}
\makeatother


\newcommand\compressthis[1]{\pmb{\hspace{.8pt}\raisebox{.5pt}{\scalebox{.85}{$#1$}}\hspace{.2pt}}}
\newcommand\tempty{\compressthis{\varnothing}}
\newcommand\tcap{{\compressthis{\cap}}}
\newcommand\tcup{{\compressthis{\cup}}}
\newcommand\tsubseteq{{\compressthis\subseteq}}
\newcommand\tneg{{\pmb\neg}}
\newcommand\tnegnf{{\pmb{\sim}}}
\newcommand\tnegneg{{\pmb{{\sim}{\sim}}}}
\newcommand\ttop{{\pmb\top}}
\newcommand\tbot{{\pmb\bot}}
\newcommand\teq{{\pmb{\text{=}}}}
\newcommand\tand{{\pmb\wedge}}
\newcommand\tlesssim{\compressthis{\lesssim}}
\newcommand\tapprox{\compressthis{\approx}}
\newcommand\tor{{\pmb\vee}}
\newcommand\timp{{\pmb\Rightarrow}}
\newcommand\ntimp{{\pmb\not\Rightarrow}}
\newcommand\tnotor{{\compressthis{\supset}}}
%\newcommand\tnotor{{\compressthis{\rightsquigarrow}}}
\newcommand\tlatticeiff{{\compressthis{\equiv}}}
%\newcommand\tlatticeiff{{\compressthis{\leftrightsquigarrow}}}
\newcommand\tiff{\compressthis{\Leftrightarrow}} %{\pmb\Leftrightarrow}}
\newcommand\tlam{{\pmb\lambda}}
\newcommand\tsim{\compressthis{{\approx}}}
\newcommand\tin{{\pmb{\in}}}
\newcommand\ntin{{\pmb{\not\in}}}
\newcommand\qall{{\compressthis{\mathsf Q}}}
\newcommand\tall{{\compressthis{\forall}}}
\newcommand\texi{{\compressthis{\exists}}}
%\newcommand\tlot{\mathsf{L}}
%\newcommand\tlot{\rlap{$\top$}\bot}
\newcommand\tlot{\textbf{?}}

\newcommand\oimplies{\mathbin{\rlap{$+$}\hspace{.7pt}{\supset}}}

%https://tex.stackexchange.com/questions/314645/arrow-with-circle-in-the-middle
\makeatletter
\newcommand{\circlearrow}{}% just in case
\DeclareRobustCommand{\circlearrow}{%
  \mathrel{\vphantom{\shortrightarrow}\mathpalette\circle@arrow\relax}%
}
\newcommand{\circle@arrow}[2]{%
  \m@th
  \ooalign{%
    \hidewidth$#1\circ\mkern1mu$\hidewidth\cr
    $#1\longrightarrow$\cr}%
}
\makeatother
\newcommand\minusoplus{{\pmb{\circlearrow}}} %{\mathbin{{}_-{\oplus}}}
%{\stackrel{-}{\oplus}}

% https://tex.stackexchange.com/questions/235118/making-a-thicker-cdot-for-dot-product-that-is-thinner-than-bullet
\makeatletter
\newcommand*\bigcdot{\mathpalette\bigcdot@{.5}}
\newcommand*\bigcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}
\makeatother

\newcommand\act{{\cdot}}
\newcommand\pact{{\cdot}}
\newcommand\mact{\mathbin{\bigcdot}}
%\newcommand{\mact}{\mathbin{\,\begin{picture}(-1,1)(-1,-3)\circle*{3}\end{picture}\ \,}}

\usepackage{datetime}
\yyyymmdddate

\begin{document}
\title{Semitopology: a survey of a topological approach to distributed collaborative action} 
\newcommand\titlerunning{\emph{Semitopology \& collaborative action}}
\newcommand\authorrunning{\emph{Murdoch J. Gabbay and Giuliano Losa}}
\author{Murdoch J. Gabbay \affil{Heriot-Watt University, UK}
Giuliano Losa \affil{Stellar Development Foundation, USA}}

\begin{abstract}
We introduce \emph{semitopologies}, a generalisation of point-set topology that removes the restriction that intersections of open sets need necessarily be open.

The intuition is that points are participants in some distributed system, and an open set is a collection of participants that can collaborate to update their local state by taking a distributed collaborative action; we call this an \emph{actionable coalition}.

What constitutes an actionable coalition depends on what actions we want to model.
Intuitive examples include `a group of people that is collectively strong enough to lift a rock', where the state update is very simply `holding rock low' to `holding rock high' and this update is common to all participants in the actionable coalition.
Or, consider `two people wishing to barter a can of juice for a bar of chocolate', in which case the coalition is any such pair and the state updates differ between participants to flip them between `has/has no juice' and `has/has no chocolate'.

A characteristic of these systems is that state updates are local to the coalition, voluntary, may vary between participants, and are not assumed subject to permission or synchronisation by a central authority. 
Peer-to-peer computer networks, including filesharing and blockchain systems, provide motivating examples from computing.

This paper presents an abstract mathematics that is inspired by these considerations. 
The maths is interesting in and of itself, much like point-set topology is; and it provides a conceptual framework within which to understand a useful class of distributed systems.
\keywords{Topology, Semitopology} 
\end{abstract}
\maketitle
\thispagestyle{empty}

\tableofcontents

\section{Introduction}
\label{sect.intro}

\subsection{What is a `distributed collaborative action', and what is a semitopology?}
\label{subsect.what.is}

Let $\ns P$ be the set of all people, which we may call points (as in point-set topology), and assume these come with a local state with just two values: `exists', or `will exist'.
Suppose that for two distinct existing people $\{p_{him},p_{her}\}\subseteq\ns P$ there is some set of $p_{child}$ people such that the former can (but are not obliged to) collaborate to act together to change the state of $p_{child}$ from `will exist' to `exists'.

Extensive literatures exist to reflect and advise on the implementational details of this scenario --- but this being a maths paper, we work with an idealised model.
Even for this simple model, we can make some observations:
\begin{enumerate*}
\item
A notion of collaboration is built in to the fact that no single point can act on its own.
Indeed, at least three distinct points --- a $p_{him}$, a $p_{her}$, and a suitable $p_{child}$ --- are required for the local state of the one point $p_{child}$ to get updated.
\item
No central authority exists to coordinate or authorise state updates.
\item
The state updates that do occur are local; a set $\{p_{him},p_{her},p_{child}\}$ can act to update the existence of $p_{child}$, but this update is local to the participants involved in the particular action.\footnote{In the real world, births are supposed to be registered; but this is a \emph{separate action}.  People were making babies by distributed collaborative action before central governments and a population census.}
\item
Actions may overlap, and (provided they are compatible) they need not be identical: e.g. $\{p_{him},p_{her},p_{child},p_{child}'\}$ could collaborate to update the states of two children.
Likewise for $\{p_{him},p_{her},p_{child},p_{him}',p_{child}'\}$ or $\{p_{him},p_{her},p_{child},p_{her}',p_{child}'\}$
\end{enumerate*}

There are many examples of similar distributed systems. 
A swarm of birds or drones, groups of pedestrians, and crowds of sports or music fans can and do communicate locally to make local updates to their speeds and directions.
Note that the updates need not be identical: e.g. if two pedestrians see that they are about to collide, then they had better \emph{not} both dodge in the same direction.

In computing, peer-to-peer filesharing systems locally exchange data (to be fair, this may be mediated by so-called \emph{tracker nodes}, but these are also usually distributed); the \emph{Fediverse} of the distributed social network Mastodon works is in a similar spirit; and so on, and so forth. 

Most modern blockchain systems also evolve their state by distributed collaborative action in a similar spirit.
The technical details vary, but a typical example is a proof-of-stake system that makes progress such that a group of participants can update their state if they held a majority of the stake at some time in the past (e.g. two weeks ago) --- the idea being that all participants have reached agreement on, and learned, the state of the network two weeks in the past, so this can be treated as immutable common knowledge without undermining the distributed nature of the system in the present~\cite[Subsection~3.2.1, final paragraph]{tezos:whitepaper}. 
In the XRP Ledger~\cite{schwartz_ripple_2014} and Stellar blockchain networks~\cite{lokhafa:fassgp} (which are not proof-of-stake or proof-of-work systems) a notion of `actionable coalition' is represented explicitly in the engineering architecture of the system.

Thus, the maths in this paper reflects and is motivated by simple and natural intuitive examples as above, and also by the practical realities of more complex systems that at time of writing are up and running and providing services to their users by doing real things.

So at a very high level, what do the examples above have in common?
\begin{enumerate*}
\item
There is a notion of what we can call an \emph{actionable coalition} --- soon, we will just call this an \emph{open set}.
This is a set $O\subseteq\ns P$ of participants with the capability, though not the obligation, to act collaboratively to advance (= update / transition) the local state of the elements in $O$, possibly but not necessarily in the same way for every $p\in O$ (it depends on the context; we will discuss this). 
\item
$\varnothing$ is trivially an actionable coalition.
Also we assume that $\ns P$ is actionable, since if it were not then literally nothing could ever get done.
\item
A sets union of actionable coalitions, is an actionable coalition.
\end{enumerate*}
This leads us to the definition of a semitopology.

\begin{nttn}
\label{nttn.powerset}
Suppose $\ns P$ is a set.
Write $\powerset(\ns P)$ for the powerset of $\ns P$ (the set of subsets of $\ns P$); there will be more on this in Notation~\ref{nttn.finpow}.
\end{nttn}

\begin{defn}
\label{defn.semitopology}
A \deffont{semitopological space}, or \deffont{semitopology} for short, consists of a pair $(\ns P, \opens(\ns P))$ of 
\begin{itemize*}
\item
a (possibly empty) set $\ns P$ of \deffont{points}, and 
\item
a set $\opens(\ns P)\subseteq\powerset(\ns P)$ of \deffont{open sets}, 
\end{itemize*}
such that:
\begin{enumerate*}
\item\label{semitopology.empty.and.universe}
$\varnothing\in\opens(\ns P)$ and $\ns P\in\opens(\ns P)$.
\item\label{semitopology.unions}
If $X\subseteq\opens(\ns P)$ then $\bigcup X\in\opens(\ns P)$.\footnote{There is a little overlap between this clause and the first one: if $X=\varnothing$ then by convention $\bigcup X=\varnothing$.  Thus, $\varnothing\in\opens(\ns P)$ follows from both clause~1 and clause~2.  If desired, the reader can just remove the condition $\varnothing\in\opens(\ns P)$ from clause~1, and no harm would come of it.} 
\end{enumerate*}
We may write $\opens(\ns P)$ just as $\opens$, if $\ns P$ is irrelevant or understood, and we may write $\opens_{\neq\varnothing}$ for the set of nonempty open sets.
\end{defn}

The reader will recognise a semitopology as being like a \emph{topology} on $\ns P$, but without the condition that the intersection of two open sets necessarily be an open set.
This reflects the fact that the intersection of two actionable coalitions need not itself be an actionable coalition.

Armed with this simple definition and bearing in mind its modern relevance as noted above, this paper introduces and surveys point-set semitopologies and their properties.
There is an emphasis (though not an exclusive one) on studying distributed collaborative actions, which (broadly speaking) amounts to studying antiseparation properties of points, and how this interacts with topological continuity of functions out of semitopologies. 
The details of what this means are unpacked below. 

\begin{rmrk}
Traditional notions of consensus and voting can be understood in a semitopological framework.
For instance, a committee may make a decision by two-thirds majority vote; the set of all 2/3 majorities of some $\ns P$ is a semitopology (note that it is not a topology).
Also, concrete algorithms to attain consensus often use a notion of \emph{quorum}~\cite{lamport_part-time_1998,lamport:byzgp}; a set of participants whose unanimous adoption of a value guarantees that other (typically all other) participants will eventually also adopt this value.
Social choice theorists have a similar notion called a \emph{winning coalition} \cite[Item~5, page~40]{riker:thepc}.
If the reader has a background in logic then they may be reminded of a whole field of \emph{generalised quantifiers} (a good survey is in~\cite{sep-generalized-quantifiers}).

The reader should just note that these examples have a synchronous, centralised flavour. 

For instance: a vote in the typical democratic sense is a synchronous, global operation (unless the result is disputed): votes are cast, collected, and then everyone gets together --- e.g. in a vote counting hall --- to count the votes and agree on who won and so certify the outcome.\footnote{The first author has seen this happen; votes being tallied up while under supervision by representatives of all parties on the ballot.  It is a moving sight.  But it is not distributed.}
This is certainly a collaborative action, but it is centralised, not distributed.

Our semitopological framework adds to the above by allowing us to study \emph{distributed} collaborative action, which can progress by local state updates on actionable coalitions (which certainly do not need to be simple majorities), and they can so act without \emph{necessarily} having to synchronise step-by-synchronous-step on global state updates.
\end{rmrk}

\subsection{Semitopology applied to distributed collaborative action}


In this short subsection we give a taste of how topological ideas can be applied to understand distributed collaborative action.
This is not an exhaustive overview (for that, see Subsection~\ref{subsect.map}).

Recall the Hausdorff separability condition that two points have disjoint open neighbourhoods, and invert it: call two points \emph{intertwined} when all of their open neighbourhoods intersect
(see Definition~\ref{defn.intertwined.points} and Remark~\ref{rmrk.not.hausdorff}).
Within a set of intertwined points, topological continuity implies agreement (see Lemma~\ref{lemm.open.lc} and Corollary~\ref{corr.intertwined.correlated}).
As we build up the mathematics further and understand more deeply what is going on, we will discover deeper and more canonical mathematical reasons why this notion arises (having to do with theories of dense subsets and continuous extensions of functions; see Section~\ref{sect.dense} and the high-level discussion in Remark~\ref{rmrk.cont.uniq}).
 
Call a set of pairwise intertwined points that is open, a \emph{topen set} (for \emph{transitive open set}; Definition~\ref{defn.transitive} and Remark~\ref{rmrk.partition}).
So this intuitively is an actionable coalition that is guaranteed to be in agreement, where algorithms succeed.
One of our main early results is to prove that a semitopological space partitions itself automatically into a collection of disjoint maximal topen sets (Theorem~\ref{thrm.topen.partition}).
Thus, an arbitrary semitopology naturally partitions itself into areas of local collaboration, reflecting the way that e.g. people tend to self-organise themselves into tribes or communities. 

We then identify a well-behavedness criterion of being a \emph{regular point} (Definition~\ref{defn.tn}(\ref{item.regular.point})) and relate this to other well-behavedness conditions in results discussed in Remark~\ref{rmrk.arc} and~\ref{rmrk.two.char.r}.
We go on to identify results which echo Arrow's theorem from social choice theory, which prove that any semitopology must contain certain \emph{kernel} subsets that dictate its behaviour.  See the discussion in Remark~\ref{rmrk.arrow}.

The interested reader might like to jump to one of these results, and read backwards or forwards from there.
 

This is a long paper, in part because our goal is to introduce a new field of research (even if it does consciously draw on classical techniques from point-set topology), and show what is possible within it.  
The reader is not obliged to read linearly and is free to look up what interests them, and proceed from there.

\subsection{Map of the paper}
\label{subsect.map}

\begin{enumerate}
\item
Section~\ref{sect.intro} is the Introduction.  You Are Here.
\item
In Section~\ref{sect.semitopology} we show how continuity corresponds to local agreement (Definition~\ref{defn.semitopology} and Lemma~\ref{lemm.open.lc}).
\item
In Section~\ref{sect.transitive.sets} we introduce \emph{transitive sets}, \emph{topens}, and \emph{intertwined points}.
These are all different views on the anti-separation well-behavedness properties that will interest us in this paper.
Most of Section~\ref{sect.transitive.sets} is concerned with showing how these different views relate and in what senses they are equivalent (e.g. Theorem~\ref{thrm.cc.char}).
Transitive sets are guaranteed to be in agreement (in a sense made precise in Theorem~\ref{thrm.correlated} and Corollary~\ref{corr.correlated.intersect}), and we take a first step to understanding the fine structure of semitopologies by proving that every semitopology partitions into topen sets (Theorem~\ref{thrm.topen.partition}), plus other kinds of points which we classify in the next Section.
\item
In Section~\ref{sect.regular.points} we start to classify points in more detail, introducing notions of \emph{regular}, \emph{weakly regular}, and \emph{quasiregular} points (Definition~\ref{defn.tn}).\footnote{The other main classification is \emph{conflicted} points, in Definition~\ref{defn.conflicted}.  These properties are connected by an equation: regular = weakly regular + unconflicted; see Theorem~\ref{thrm.r=wr+uc}.}
 
Regular points are those contained in some topen set, and they display particularly good behaviour.
Regularity will be very important to us and we will characterise it in multiple ways: see Remark~\ref{rmrk.how.regularity}.
(A survey of characterisations of weak regularity requires more machinery and appears in Remark~\ref{rmrk.how.weakly.regular}.)
\item
In Section~\ref{sect.closed.sets} we study closed sets, and in particular the interaction between intertwined points, topens, and closures.
Typical results are Proposition~\ref{prop.intertwined.as.closure} and Theorem~\ref{thrm.up.down.char} which characterise sets of intertwined points as minimal closures.
The significance to consensus is discussed in Remarks~\ref{rmrk.fundamental.consensus} and~\ref{rmrk.why.top.closure}.
\item
In Section~\ref{sect.unconflicted.point} we study unconflicted and hypertransitive points, leading to two useful characterisations of regularity in Theorems~\ref{thrm.r=wr+uc} and~\ref{thrm.regular=qr+sc}.
\item
In Section~\ref{sect.product} we consider product semitopologies.
These are defined just as for topologies (Definition~\ref{defn.product.semitopology}) but we study how the semitopological properties we have considered above --- like being intertwined, topen, regular, conflicted, and so forth --- interact with taking products.
This is also useful for building large complex counterexamples out of smaller simpler ones (examples in Corollary~\ref{corr.conflicted.and.not.wr} or Theorem~\ref{thrm.nitpicked}).
\item
In Section~\ref{sect.witness} we construct a novel theory of computationally tractable semitopologies, based on \emph{witness functions} (Definition~\ref{defn.witnessed.set}(\ref{witness.function})).
We call semitopologies generated by witness functions \emph{witness semitopolgies}.
These display excellent algorithmic behaviour (Remarks~\ref{rmrk.computing.open.sets} and~\ref{rmrk.computing.closed.sets}) and we note deep reasons why this is so by showing that witness functions correspond to Horn clause theories, and that open and closed sets in the witness semitopology are related to answer sets to those theories; see Subsection~\ref{subsect.declarative.witness}.
\item
In Section~\ref{sect.cc.cb} we introduce \emph{(strongly) chain-complete} semitopologies.
We argue in Remark~\ref{rmrk.plausible.abstraction} that these have properties making them a suitable abstraction of finite semitopologies --- finite semitopologies are of particular interest because these are the ones that we can build.
We study their properties and prove a key result that witness semitopologies are chain-complete (Theorem~\ref{thrm.lim.O.open}), even if they are infinite.\footnote{We discuss why infinite semitopologies matter, even in a world of finite implementations, in Remark~\ref{rmrk.infinite}.  Note also that in a real system there may be hostile participants who report an unbounded space of `phantom' points, either for denial-of-service or to create `extra voters'.  So even a system that is physically finite may present itself as infinite.}
\item
A key property in a strongly chain-complete semitopology is that the poset of open sets is \emph{atomic}, i.e. minimal nonempty open sets always exist.
In Section~\ref{sect.kernels} we study the \emph{kernel} of a point $p$ --- unions of atomic transitive open sets --- especially in strongly chain-complete semitopologies where atoms are guaranteed to exist. 
We will see that the kernel dictates behaviour at $p$, in a sense we make formal (see discussion in Remark~\ref{rmrk.arrow}).
\item
In Section~\ref{sect.dense} we study the notion of `dense subset of' from topology and see that this splits into two notions: \emph{weakly dense in} and \emph{strongly dense in} (Definition~\ref{defn.dense}).
Transitivity turns out to be closely related to denseness (Proposition~\ref{prop.most.general}).
We prove a continuous extension result and show that this leads naturally back to the notion of regular point and topen set which we developed to begin with (Remark~\ref{rmrk.top.ce}).

This closes the arc of the mathematics: from initial definitions to a high-level explanation of why these were so useful.
\item
In Section~\ref{sect.conclusions} we conclude and discuss related and future work.
We discuss connections with related work in Subsection~\ref{subsect.related.work} (notably: semiframe theory, semilattice theory, minimal structures, algebraic topology, and fail-prone systems and quorum systems).
\end{enumerate}

 
\begin{rmrk}
Algebraic topology has been applied to the solvability of distributed-computing tasks in various computational models (e.g. the impossibility of wait-free $k$-set consensus using read-write registers and the Asynchronous Computability Theorem~\cite{herlihy_asynchronous_1993,borowsky_generalized_1993,saks_wait-free_1993}; see~\cite{herlihy_distributed_2013} for a survey).
Semitopology is not topology, and this is not a paper about algebraic topology applied to the solvability of distributed-computing tasks!

This paper is about the mathematics of actionable coalitions, as made precise by point-set semitopologies; their antiseparation properties; and the implications to partially continuous functions on of them.
If we discuss distributed systems, it is by way of providing motivating examples or noting applicability.
\end{rmrk}


\section{Semitopology}
\label{sect.semitopology}

\subsection{Definitions, examples, and some discussion}

\subsubsection{Definitions}

Recall from Definition~\ref{defn.semitopology} the definition of a semitopology.


\begin{rmrk}
\leavevmode
\begin{enumerate*}
\item
As a sets structure, a semitopology on $\ns P$ is like a \emph{topology} on $\ns P$, but without the condition that the intersection of two open sets be an open set.
\item
As a lattice structure, a semitopology on $\ns P$ is a 
bounded complete join-subsemilattice of $\powerset(\ns P)$.\footnote{\emph{Bounded} means closed under empty intersections and unions, i.e. containing the empty and the full set of points.  \emph{Complete} means closed under arbitrary (possibly empty, possibly infinite) sets unions.

The reader may know that a complete lattice is also co-complete: if we have all joins, then we also have all meets.  The reader should just note that there is no reason for the meets in $\opens$ to coincide with the meets in $\powerset(\ns P)$, i.e. for them to be sets intersections.  
}
\item
Every semitopology $(\ns P,\opens)$ gives rise to a topology just by closing opens under intersections.
But, there is more to semitopologies than being subbases for a corresponding topology, because:
\begin{enumerate*}
\item
We are explicitly interested in situations where intersections of open sets need \emph{not} be open.
\item
Completing a semitopology to a topology by closing under intersections, loses information.
For example: the `many', `all-but-one', and `more-than-one' semitopologies in Example~\ref{xmpl.semitopologies} express three distinct notions of quorum, yet all three yield the discrete semitopology (Definition~\ref{defn.value.assignment}) if we close under intersections and $\ns P$ is infinite.
See also the overview in Subsection~\ref{subsect.vs}. 
\end{enumerate*}
\end{enumerate*}
\end{rmrk}



Semitopologies are not topologies.
We take a moment to spell out one concrete difference:
\begin{lemm}
\label{lemm.two.min}
In topologies, if a point $p$ has a minimal open neighbourhood then it is least.
In semitopologies, a point may have multiple distinct minimal open neighbourhoods.\footnote{We study minimal open neighbourhoods in detail, starting from Definition~\ref{defn.open.covers}.}
\end{lemm}
\begin{proof}
To see that in a topology every minimal open neighbourhood is least, just note that if $p\in A$ and $p\in B$ then $p\in A\cap B$.
So if $A$ and $B$ are two minimal open neighbourhoods then $A\cap B$ is contained in both and by minimality is equal to both.

To see that in a semitopology a minimal open neighbourhood need not be least, it suffices to provide an example.
Consider $(\ns P,\opens)$ defined as follows, as illustrated in Figure~\ref{fig.two.min}:
\begin{itemize*}
\item
$\ns P=\{0,1,2\}$
\item
$\opens = \bigl\{ \varnothing,\ \{0,1\},\ \{1,2\},\ \{0,1,2\} \bigr\}$
\end{itemize*}
Note that $1$ has two minimal open neighbourhoods: $\{0,1\}$ and $\{1,2\}$. 
\end{proof}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[align=c,width=0.4\columnwidth,trim={50 120 50 120},clip]{diagrams/two-min.pdf}
\vspace{-1em}
\caption{An example of a point with two minimal open neighbourhoods (Lemma~\ref{lemm.two.min})}
\label{fig.two.min}
\end{figure}



\subsubsection{Examples}

As standard, we can make any set $\tf{Val}$ into a semitopology (indeed, it is also a topology) just by letting open sets be the powerset: 
\begin{defn}
\label{defn.value.assignment}
\leavevmode
\begin{enumerate*}
\item\label{item.discrete.semitopology}
Call $(\ns P,\powerset(\ns P))$ the \deffont{discrete semitopology} on $\ns P$.
 
We may call a set with the discrete semitopology a \deffont{semitopology of values}, and when we do we will usually call it $\tf{Val}$.
We may identify $\tf{Val}$-the-set and $\tf{Val}$-the-discrete-semitopology; meaning will always be clear.
\item\label{item.value.assignment}
When $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values, we may call a function $f:\ns P\to\tf{Val}$ a \deffont{value assignment}.

Note that a value just assigns values to points, and in particular we do not assume \emph{a priori} that it is continuous, where continuity is defined just as for topologies (see Definition~\ref{defn.continuity}).
\end{enumerate*} 
\end{defn}


\begin{xmpl}
\label{xmpl.semitopologies}
We consider further examples of semitopologies:
\begin{enumerate}
\item
Every topology is also a semitopology; intersections of open sets are allowed to be open in a semitopology, they are just not constrained to be open.
In particular, the discrete topology is also a discrete semitopology (Definition~\ref{defn.value.assignment}(\ref{item.discrete.semitopology})).
\item
The \deffont{initial} semitopology $(\varnothing,\{\varnothing\})$ and the \deffont{final} semitopology $(\{\ast\},\{\varnothing,\{\ast\}\})$ are semitopologies. 
\item\label{item.boolean.discrete}
An important discrete semitopological space is 
$$
\mathbb B=\{\bot,\top\}
\quad\text{with the discrete semitopology}\quad
\opens(\mathbb B)=\{\varnothing, \{\bot\},\{\top\},\{\bot,\top\}\}.
$$
We may silently treat $\mathbb B$ as a (discrete) semitopological space henceforth.
\item
Take $\ns P$ to be any nonempty set.
Let the \deffont{trivial} semitopology on $\ns P$ have 
$$
\opens =\{\varnothing, \ns P\}.
$$
So (as usual) there are only two open sets: the one containing nothing, and the one containing every point.

The only nonempty open is $\ns P$ itself, reflecting a notion of actionable coalition that requires unanimous agreement. 
\item
Suppose $\ns P$ is a set and $\mathcal F\subseteq\powerset(\ns P)$ is nonempty and up-closed (so if $P\in\mathcal F$ and $P\subseteq P'\subseteq\ns P$ then $P'\in\mathcal F$, then $(\ns P,\mathcal F)$ is a semitopology.
This is not necessarily a topology, because we do not insist that $\mathcal F$ is a filter (i.e. is closed under intersections).

In particular:
\begin{enumerate}
\item\label{item.supermajority}
Take $\ns P=\{0,1,\dots,41\}$. 
Let the \deffont{supermajority} semitopology have 
$$
\opens =\{\varnothing\}\cup\{O\subseteq\ns P \mid \f{cardinality}(O)\geq 28\}.
$$
Since $\ns P$ has 42 elements, $O$ is open when it contains at least two-thirds of the points.

Two-thirds is a typical threshold used for making progress in consensus algorithms.
\item
Take $\ns P$ to be any nonempty set.
Let the \deffont{many} semitopology have
$$
\opens = \{\varnothing\}\cup\{O\subseteq\ns P \mid \f{cardinality}(O)=\f{cardinality}(\ns P)\} .
$$
For example, if $\ns P=\mathbb N$ then open sets include $\f{evens}=\{2*n \mid n\in\mathbb N\}$ and $\f{odds}=\{2*n\plus 1 \mid n\in\mathbb N\}$.

Its notion of open set captures an idea that an actionable coalition is a set that may not be all of $\ns P$, but does at least biject with it.
\item\label{item.counterexample.X-x}
Take $\ns P$ to be any nonempty set.
Let the \deffont{all-but-one} semitopology have
$$
\opens = \{\varnothing,\ \ns P\}\cup\{\ns P\setminus \{p\}\mid p\in\ns P\} .
$$
This semitopology is not a topology.
See also Lemma~\ref{lemm.all-but-one}.

The notion of actionable coalition here is that there may be at most one objector (but not two).
\item\label{item.counterexample.more-than-one}
Take $\ns P$ to be any set with cardinality at least $2$.
Let the \deffont{more-than-one} semitopology have
$$
\opens = \{\varnothing\}\cup\{O\subseteq\ns P \mid \f{cardinality}(O) \geq 2\} .
$$
This semitopology is not a topology.
See also Lemma~\ref{lemm.more-than-one}.

This notion of actionable coalition reflects a security principle in banking and accounting (and elsewhere) of \emph{separation of duties}, that functional responsibilities be separated such that at least two people are required to complete an action --- so that errors (or worse) cannot be made without being discovered by another person.
\end{enumerate}
\item
Take $\ns P=\mathbb R$ (the set of real numbers) and set $O\subseteq\mathbb R$ to be open when it has the form $\rightopeninterval{0,r}$ or $\leftopeninterval{-r,0}$ for any strictly positive real number $r>0$.

This semitopology is not a topology, since (for example) $\leftopeninterval{1,0}$ and $\rightopeninterval{0,1}$ are open, but their intersection $\{0\}$ is not open.
\item\label{item.quorum.system}
In~\cite{naor:loacaq} a notion of \emph{quorum system} is discussed, defined as any collection of pairwise intersecting sets.
Quorum systems are a field of study in their own right, especially in the theory of concrete consensus algorithms.

Every quorum system gives rise naturally to a semitopology, just by closing under arbitrary unions.
We obtain what in this paper we would call an \emph{intertwined space} (Notation~\ref{nttn.intertwined.space}; a semitopology all of whose nonempty open sets intersect).\footnote{A topologist would call this a \emph{hyperconnected space}, but be careful! There are multiple such notions in semitopologies, so intuitions need not transfer over.  See the discussion in Subsection~\ref{subsection.topens.in.topologies}.}

Going in the other direction is interesting for a different reason, that it is slightly less canonical: of course every intertwined space is already a quorum system; but (for the finite case) we can also map to the set of all open covers of all points (Definition~\ref{defn.open.covers}(\ref{item.open.cover}); in the notation of that Definition, we would write this as $\bigcup_{p\in\ns P}\{O\in\opens \mid O\gtrdot p\}$).

To give one specific example of a quorum system from~\cite{naor:loacaq}, consider $n\times n$ grid of cells with quorums being sets consisting of any full row and a full column; note that any two quorums must intersect in at least two points.
We obtain a semitopology just by closing under arbitrary unions.
\end{enumerate}
\end{xmpl}



\begin{rmrk}[Logical models of semitopologies]

\noindent One class of examples of semitopologies deserves its own discussion.
Consider an arbitrary logical system with predicates $\tf{Pred}$ and entailment relation $\cent$.\footnote{A validity relation $\ment$ would also work.}
Call $\Phi\subseteq\tf{Pred}$ \deffont{deductively closed} when $\Phi\cent\phi$ implies $\phi\in\Phi$.
Then take 
\begin{itemize*}
\item
$\ns P=\tf{Pred}$, and 
\item
let $O\in\opens$ be $\varnothing$ or the complement to a deductively closed set $\Phi$, so $O=\tf{Pred}\setminus\Phi$.
\end{itemize*}
Note that an arbitrary union of open sets is open (because an arbitrary intersection of deductively closed sets is deductively closed), but an intersection of open sets need not be open (because the union of deductively closed sets need not be deductively closed).
This is a semitopology.

This example will be important to us and we will return to it in Subsection~\ref{subsect.declarative.witness}. 

We can note further that:
\begin{enumerate}
\item
There is a traditional, simple model of propositional logic whereby we let propositions be denoted by open sets.
Intuitively, these points are `worlds' at which the proposition is `true'.
The example of semitopologies given above is \emph{not} this.
For a start, in the model above propositions are points, not sets of points.
\item
Variations on our model above are possible, all with a theme that associates closed sets with consistency and deductive closure, and open sets with inconsistency.
For example:
\begin{enumerate*}
\item
Call $\Phi\subseteq\tf{Pred}$ \deffont{inconsistent} when $\Phi\cent$. 

Then we can take $\ns P=\tf{Pred}$, and we can let $\opens$ be the set of inconsistent sets of predicates.
Note that an arbitrary union of inconsistent sets of predicates is inconsistent, but an intersection of inconsistent sets of predicates need not be inconsistent.
\item
We can take open sets to be arbitrary unions of \emph{minimal} inconsistent sets of predicates; then the previous notion of `open set' can be recovered as `has a nonempty open interior'.
\item
We can restrict $\ns P$ to \emph{atomic predicates} (ones not created by logical connectives or quantifiers, such as $\tand$, $\timp$, or $\tall$).\footnote{In a proposition logic these would be called \emph{propositional constants}, such as \texttt{it is raining}; in a predicate logic these might thake the form of predicate-formers applied to closed terms, such as \texttt{mortal(Socrates)} or perhaps \texttt{1+2=3}.} 
\end{enumerate*}
\end{enumerate}
\end{rmrk}


\subsubsection{Some discussion}

\begin{rmrk}[Why the name `semitopologies']
\label{rmrk.why.name.semitopologies}
When we give a name `semitopologies' to things that are like topologies but without intersections, this is a riff on 
\begin{itemize*}
\item
`semilattices', for things that are like lattices with joins but without meets (or vice-versa), and 
\item
`semigroups', for things that are like groups but without inverses.
\end{itemize*}
But, this terminology also reflects a real mathematical connection, because semitopologies \emph{are} semilattices \emph{are} semigroups, in standard ways which we take a moment to spell out: 
\begin{itemize*}
\item
A semitopology $(\ns P,\opens)$ is a bounded join subsemilattice of the powerset $\powerset(\ns P)$, by taking the join $\tor$ to be sets union $\cup$ and the bounds $\bot$ and $\top$ to be $\varnothing$ and $\ns P$ respectively. 
\item
A semilattice is an idempotent commutative monoid, which is an idempotent commutative semigroup with an identity, by taking the multiplication $\circ$ to be $\tor$ and the identity element to be $\bot$ ($\top$ becomes what is called a \emph{zero} or \emph{absorbing} element, such that $\top\circ x=\top$ always).
\end{itemize*} 
\end{rmrk}


\begin{figure}
\centering
\includegraphics[align=c,width=0.4\columnwidth,trim={50 0 50 0},clip]{diagrams/PtoP.pdf}
\caption{Two nonidentical semitopologies (Remark~\ref{rmrk.PtoP})}
\label{fig.PtoP}
\end{figure}


\begin{rmrk}[Semitopologies are not \emph{just} semilattices]
\label{rmrk.PtoP}
We noted in Remark~\ref{rmrk.why.name.semitopologies} that every semitopology is a semilattice.
This is true, but the reader should not read this statement as reductive: semitopologies are not \emph{just} semilattices. 

To see why, consider the following two simple semitopologies, as illustrated in Figure~\ref{fig.PtoP}:
\begin{enumerate*}
\item
$(\ns P,\opens)$ where $\ns P=\{0,1,2\}$ and $\opens=\bigl\{\varnothing,\{0,1\},\{1,2\},\{0,1,2\}\bigr\}$.
\item
$(\ns P',\opens')$ where $\ns P=\{0,2\}$ and $\opens'=\bigl\{\varnothing,\{0\},\{2\},\{0,2\}\bigr\}$.
\end{enumerate*}
Note that the semilattices of open sets $\opens$ and $\opens'$ are isomorphic --- so, when viewed as semilattices these two semitopologies are the same (up to isomorphism).

However, $(\ns P,\opens)$ is not the same semitopology as $(\ns P',\opens')$.
There is more than one way to see this, but perhaps the simplest indication is that there is no inverse pair of continuous injections $f:(\ns P,\opens)\to(\ns P',\opens')$ and $g:(\ns P',\opens')\to(\ns P,\opens)$ (we will define continuity in a moment in Definition~\ref{defn.continuity}(\ref{item.continuous.function}) but is just as for topologies, so we take the liberty of using it here).
There are a limited number of possibilities for $f$ and $g$, and we can just enumerate them and check:
\begin{itemize*}
\item
If $f(0)=0$ and $f(2)=2$ then there is no continuous inverse $g$:
if $g(1)=0$ then $g^\mone(\{2\})=\{2\}\not\in\opens$, and similarly if $g(1)=1$ then $g^\mone(\{0\})=\{0\}\not\in\opens$. 
\item
If $f(0)=0$ and $f(2)=1$ then there is still no continuous inverse $g$:
if $g(1)=0$ then $g^\mone(\{2\})=\{1\}\not\in\opens$, and similarly if $g(1)=2$ then $g^\mone(\{0\})=\{0\}\not\in\opens$. 
\item
Other possibilites are no harder.
\end{itemize*}
\end{rmrk}


\begin{rmrk}[`Stronger' does not necessarily equal `better']
We conclude with some easy predictions about the theory of semitopologies, made just from general mathematical principles.
Fewer axioms means: 
\begin{enumerate*}
\item
\emph{more} models, 
\item
\emph{finer discrimination} between definitions, and 
\item
(because there are more models) \emph{more counterexamples}.
\end{enumerate*}
So we can expect a theory with the look-and-feel of topology, but with new models, new distinctions between definitions that in topology may be equivalent, and some new definitions, theorems, and counterexamples --- and this indeed will be the case.
 
Note that fewer axioms does not necessarily mean fewer interesting things to say and prove.
On the contrary: if we can make finer distinctions, there may also be more interesting things to prove; and furthermore, assumptions we make can become \emph{more} impactful in a weaker system, because these assumptions may exclude more models than would have been the case with more powerful axioms.
We see this e.g. in the theory of semigroups, which has its own character that is quite distinct from the theory of groups.\footnote{To take this to an extreme, consider the \emph{terminal} theory, which has just one first-order axiom: $\Exists{x}\Forall{y}x=y$.  This theory `subsumes' groups, lattices, graphs, and much besides, in the sense that every model of the terminal theory \emph{is} a group, a lattice, and a graph, in a natural way.  

However, the theory is so strong, and the class of its models is so restricted --- just the singleton model with one element --- that there is not much left to say about it. 
Additional assumptions we may make on elements add literally nothing of value, because there was only one element to begin with!
So a `stronger' set of axioms is not necessarily `better', and conversely a `weaker' set of axioms is not necessarily `less useful'.  It depends on what we want to do, and on how the maths turns out.}
\end{rmrk}

\subsection{Continuity, and its interpretation}
\label{subsect.continuity}

We can import the topological notion of continuity and it works fine in semitopologies, and the fact that there are no surprises is a feature. 
In Remark~\ref{rmrk.continuity=consensus} we explain how these notions matter to us: 


\begin{defn}
\label{defn.continuity}
We import standard topological notions of inverse image and continuity:
\begin{enumerate}
\item
Suppose $\ns P$ and $\ns P'$ are any sets and $f:\ns P\to\ns P'$ is a function.
Suppose $O'\subseteq\ns P'$.
Then write $f^\mone(O')$ for the \deffont{inverse image} or \deffont{preimage} of $O'$, defined by
$$
f^\mone(O')=\{p{\in}\ns P \mid f(p)\in O'\} . 
$$
\item\label{item.continuous.function}
Suppose $(\ns P,\opens)$ and $(\ns P',\opens')$ are semitopological spaces (Definition~\ref{defn.semitopology}).
Call a function $f:\ns P\to\ns P'$ \deffont{continuous} when the inverse image of an open set is open.
In symbols:
$$
\Forall{O'{\in}\opens'} f^\mone(O')\in\opens .
$$
\item\label{item.continous.function.at.p}
Call a function $f:\ns P\to\ns P'$ \deffont{continuous at $p\in\ns P$} when
$$
\Forall{O'{\in}\opens'}f(p)\in O'\limp \Exists{O_{p,O'}{\in}\opens}p\in O_{p,O'}\land O_{p,O'}\subseteq f^\mone(O') .
$$
In words: $f$ is continuous at $p$ when the inverse image of every open neighbourhood of $f(p)$ contains an open neighbourhood of $p$.
\item
Call a function $f:\ns P\to\ns P'$ \deffont{continuous on $P\subseteq\ns P$} when $f$ is continuous at every $p\in P$.

(It is routine to check that $f$ is continous on $\ns P$ precisely when it is continuous in the sense of part~\ref{item.continuous.function} of this Definition.) 
\end{enumerate}
\end{defn}


\begin{lemm}
\label{lemm.alternative.cont}
Suppose $(\ns P,\opens)$ and $(\ns P',\opens')$ are semitopological spaces (Definition~\ref{defn.semitopology}) and suppose $f:\ns P\to\ns P'$ is a function.
Then the following are equivalent:
\begin{enumerate*}
\item
$f$ is continuous (Definition~\ref{defn.continuity}(2)).
\item
$f$ is continuous at every $p\in\ns P$ (Definition~\ref{defn.continuity}(3)).
\end{enumerate*}
\end{lemm}
\begin{proof}
The top-down implication is immediate, taking $O=f^\mone(O')$.

For the bottom-up implication, given $p$ and an open neighbourhood $O'\ni f(p)$, we write
$$
O=\bigcup\{O_{p,O'}\in\opens \mid p\in\ns P,\ f(p)\in O'\}.
$$
Above, $O_{p,O'}$ is the open neighbourhood of $p$ in the preimage of $O'$, which we know exists by Definition~\ref{defn.continuity}(3).

It is routine to check that $O= f^\mone(O')$, and since this is a union of open sets, it is open. 
\end{proof}


\begin{defn}
\label{defn.locally.constant}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology and 
\item
$\tf{Val}$ is a semitopology of values (Definition~\ref{defn.value.assignment}(\ref{item.discrete.semitopology})) and 
\item
$f:\ns P\to \tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment}(\ref{item.value.assignment}); an assignment of a value to each element in $\ns P$).
\end{itemize*}
Then:
\begin{enumerate*}
\item
Call $f$ \deffont{locally constant} at $p\in\ns P$ when there exists $p\in O_p\in\opens$ such that $\Forall{p'{\in}O_p}f(p)=f(p')$.

So $f$ is locally constant at $p$ when it is constant on some open neighbourhood $O_p$ of $p$.
\item
Call $f$ \deffont{locally constant} when it is locally constant at every $p\in\ns P$.
\end{enumerate*} 
\end{defn}


\begin{lemm}
\label{lemm.open.lc}
Suppose $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values and $f:\ns P\to\tf{Val}$ is a value assignment.
Then the following are equivalent:
\begin{itemize*}
\item
$f$ is locally constant / locally constant at $p\in\ns P$ (Definition~\ref{defn.locally.constant}).
\item
$f$ is continuous / continuous at $p\in\ns P$ (Definition~\ref{defn.continuity}). 
\end{itemize*}
\end{lemm}
\begin{proof}
This is just by pushing around definitions, but we spell it out:
\begin{itemize}
\item
Suppose $f$ is continuous, consider $p\in\ns P$, and write $v=f(p)$.
By our assumptions we know that $f^\mone(v)$ is open, and $p\in f^\mone(v)$.
This is an open neighbourhood $O_p$ on which $f$ is constant, so we are done.
\item
Suppose $f$ is locally constant, consider $p\in\ns P$, and write $v=f(p)$.
By assumption we can find $p\in O_p\in\opens$ on which $f$ is constant, so that $O_p\subseteq f^\mone(v)$.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}[Continuity = distributed agreement]
\label{rmrk.continuity=consensus}
Lemma~\ref{lemm.open.lc} tells us that
we can view the problem of attaining agreement across an actionable coalition (as discussed in Subsection~\ref{subsect.what.is}) as being the same thing as computing a value assignment that is continuous on that coalition (and possibly elsewhere).

To see why, consider a semitopology $(\ns P, \opens)$ and following the intuitions discussed in Subsection~\ref{subsect.what.is} view points $p\in \ns P$ as \emph{participants}; and view open neighbourhoods $p\in O\in\opens$ as \deffont{actionable coalitions} that include $p$.
Then to say ``$f$ is a value assignment that is continuous at $p$'' is to say that:
\begin{itemize*}
\item
$f$ assigns a value or belief to $p\in\ns P$, and
\item
$p$ is part of a (by Lemma~\ref{lemm.open.lc} continuity) set of peers that agrees with $p$ and (being open) can progress to act on this agreement.
\end{itemize*}
Conceptually and mathematically this reduces the general question 
\begin{quote}
\emph{How can we model distributed collaborative action?} 
\end{quote}
(which, to be fair, has more than one possible answer!) to a more specific research question
\begin{quote}
\emph{Understand continuous value assignments on semitopologies}.
\end{quote}
The rest of this paper is devoted to elaborating (some of) a body of mathematics that we can pull out of this idea.
\end{rmrk}




%%%%%%%%%%%%%%%%%%%%%
\subsection{Neighbourhoods of a point}

Definition~\ref{defn.open.neighbourhood} is a standard notion from topology, and Lemma~\ref{lemm.open.is.open} is a (standard) characterisation of openness, which will be useful later: 

\begin{defn}
\label{defn.open.neighbourhood}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $O\in\opens$.
Then call $O$ an \deffont{open neighbourhood} of $p$ when $p\in O$.

In other words: an open set is (by definition) an \emph{open neighbourhood} precisely for the points that it contains.
\end{defn}


\begin{lemm}
\label{lemm.open.is.open}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P\subseteq\ns P$ is any set of points.
Then the following are equivalent:
\begin{itemize*}
\item
$P\in\opens$.
\item
Every point $p$ in $P$ has an open neighbourhood in $P$. 
\end{itemize*}
In symbols we can write:
$$
\Forall{p{\in}P}\Exists{O{\in}\opens}(p\in O\land O\subseteq P)
\quad\text{if and only if}\quad
P\in\opens
$$
\end{lemm}
\begin{proof}
If $P$ is open then $P$ itself is an open neighbourhood for every point that it contains. 

Conversely, if every $p\in P$ contains some open neighbourhood $p\in O_p \subseteq P$ then $P=\bigcup\{O_p\mid p\in P\}$ and this is open by condition~\ref{semitopology.unions} of Definition~\ref{defn.semitopology}.
\end{proof}

\begin{rmrk}
An initial inspiration for modelling distributed collaborative action using semitopologies, came from noting that the standard topological property described above in Lemma~\ref{lemm.open.is.open}, corresponds to the \emph{quorum sharing} property in \cite[Property~1]{losa:stecbi}; the connection to topological ideas had not been noticed in~\cite{losa:stecbi}.
\end{rmrk}

%%%%%%%%%%%%%%%%%%%%%
\section{Transitive sets and topens}
\label{sect.transitive.sets}

\subsection{Some background on sets intersection}

Some notation will be convenient:
\begin{nttn}
\label{nttn.between}
Suppose $X$, $Y$, and $Z$ are sets.
\begin{enumerate*}
\item\label{item.between}
Write 
$$
X\between Y
\quad\text{when}\quad 
X\cap Y\neq\varnothing.
$$
When $X\between Y$ holds then we say (as standard) that $X$ and $Y$ \deffont{intersect}.
\item
We may chain the $\between$ notation, writing for example 
$$
X\between Y\between Z
\quad\text{for}\quad
X\between Y\ \land \  Y\between Z
$$
\item
We may write $X\notbetween Y$ for $\neg(X\between Y)$, thus $X\notbetween Y$ when $X\cap Y=\varnothing$.
\end{enumerate*}
\end{nttn}

\begin{rmrk}
\emph{Note on design in Notation~\ref{nttn.between}:}
It is uncontroversial that if $X\neq\varnothing$ and $Y\neq\varnothing$ then $X\between Y$ should hold precisely when $X\cap Y\neq\varnothing$. 

But there is an edge case! 
What truth-value should $X\between Y$ return when $X$ or $Y$ is empty?
\begin{enumerate*}
\item
It might be nice if $X\subseteq Y$ would imply $X\between Y$.
This argues for setting 
$$
(X=\varnothing\lor Y=\varnothing)\limp X\between Y .
$$
\item
It might be nice if $X\between Y$ were monotone on both arguments (i.e. if $X\between Y$ and $X\subseteq X'$ then $X'\between Y$).
This argues for setting 
$$
(X=\varnothing\lor Y=\varnothing)\limp X\notbetween Y .
$$
\item
It might be nice if $X\between X$ always --- after all, should a set \emph{not} intersect itself? --- and this argues for setting 
$$
\varnothing\between\varnothing ,
$$ 
even if we also set $\varnothing\notbetween Y$ for nonempty $Y$. 
\end{enumerate*}
All three choices are defensible, and they are consistent with the following nice property:
$$
X\between Y \limp (X\between X \lor Y\between Y) . 
$$
We choose the second --- if $X$ or $Y$ is empty then $X\notbetween Y$ --- because it gives the simplest definition that $X\between Y$ precisely when $X\cap Y\neq\varnothing$.
\end{rmrk}

We list some elementary properties of $\between$:
\begin{lemm}
\label{lemm.between.elementary}
\leavevmode
\begin{enumerate*}
\item
$X\between X$ if and only if $X\neq\varnothing$.
\item
$X\between Y$ if and only if $Y\between X$.
\item\label{between.elementary.either.or}
$X\between (Y\cup Z)$ if and only if $(X\between Y) \lor (X\between Z)$.
\item\label{between.subset}
If $X\subseteq X'$ and $X\neq\varnothing$ then $X\between X'$.
\item\label{between.monotone}
Suppose $X\between Y$.
Then $X\subseteq X'$ implies $X'\between Y$, and $Y\subseteq Y'$ implies $X\between Y'$. 
\item\label{between.nonempty}
If $X\between Y$ then $X\neq\varnothing$ and $Y\neq\varnothing$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By facts of sets intersection.
\end{proof}



\subsection{Transitive open sets and value assignments}


\begin{defn}
\label{defn.transitive}
Suppose $(\ns P,\opens)$ is a semitopology.
Suppose $\atopen\subseteq\ns P$ is any set of points.
\begin{enumerate*}
\item\label{transitive.transitive}
Call $\atopen$ \deffont{transitive} when 
$$
\Forall{O,O'{\in}\opens} O\between \atopen \between O' \limp O\between O'. 
$$
\item\label{transitive.cc}
Call $\atopen$ \deffont{topen} when $\atopen$ is nonempty transitive and open.\footnote{%
The empty set is trivially transitive and open, so it would make sense to admit it as a (degenerate) topen.  However, it turns out that we mostly need the notion of `topen' to refer to certain kinds of neighbourhoods of points (we will call them \emph{communities}; see Definition~\ref{defn.tn}).  It is therefore convenient to exclude the empty set from being topen, because while it is the neighbourhood of every point that it contains, it is not a neighbourhood of any point.} 

We may write 
$$
\topens=\{ \atopen\in\opens \mid \atopen\text{ is topen}\} .
$$
\item\label{transitive.max.cc}
Call $S$ a \deffont{maximal topen} when $S$ is a topen that is not a subset of any strictly larger topen.\footnote{`Transitive open' $\to$ `topen', like `closed and open' $\to$ `clopen'.}
\end{enumerate*}
\end{defn}


\begin{rmrk}
\leavevmode
\begin{enumerate*}
\item
Notions of \emph{strong} transitivity and topen are in Definition~\ref{defn.strongly.transitive}.
\item
Transitive sets are of interest because values of continuous functions are strongly correlated on them.
This is Theorem~\ref{thrm.correlated}.
\end{enumerate*}
\end{rmrk}


\begin{thrm}
\label{thrm.correlated}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\tf{Val}$ is a semitopology of values (a nonempty set with the discrete semitopology; see Definition~\ref{defn.value.assignment}(1)). 
\item
$f:\ns P\to\tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment}(\ref{item.value.assignment})). 
\item
$T\subseteq\ns P$ is a transitive set (Definition~\ref{defn.transitive}) --- in particular this will hold if $\atopen$ is topen --- and $p,p'\in T$.
\end{itemize*} 
Then:
\begin{enumerate*}
\item
If $f$ is continuous at $p$ and $p'$ then $f(p)=f(p')$.
\item 
As a corollary, if $f$ is continuous on $\atopen$, then $f$ is constant on $\atopen$.
\end{enumerate*}
In words we can say: 
\begin{quote}
Continuous value assignments are constant across transitive sets.
\end{quote}
\end{thrm}
\begin{proof}
Part~2 follows from part~1 since if $f(p)=f(p')$ for \emph{any} $p,p'\in T$, then by definition $f$ is constant on $\atopen$.
So we now just need to prove part~1 of this result.

Consider $p,p'\in T$.
By continuity on $\atopen$, there exist open neighbourhoods $p\in O\subseteq f^\mone(f(p))$ and $p'\in O'\subseteq f^\mone(f(p'))$.
By construction $O\between \atopen \between O'$ (because $p\in O\cap T$ and $p'\in T\cap O'$).
By transitivity of $\atopen$ it follows that $O\between O'$. 
Thus, there exists $p''\in O\cap O'$, and by construction $f(p) = f(p'') = f(p')$.
\end{proof}



A notation will be useful:
\begin{nttn}
\label{nttn.f.const}
Suppose $\ns X$ is a set and $f$ is some function on $\ns X$ and $X\subseteq\ns X$.
Suppose further that it is known that $f$ is constant on $X$.
In symbols:
$$
\Exists{c}\Forall{x{\in}X}f(x)=c.
$$
Then we may write $f(X)$ for the unique constant value that $f(x)$ takes as $x$ ranges over $X$.\footnote{We feel a bit guilty about this. 
A more principled approach might be to define $f(X)=\{f(x) \mid x\in X\}$, and then write $\{c\}$ for $f(X)$ where $f$ is known constant on $X$.  The reader is welcome to fill in the ``$\Exists{c}\Forall{x{\in}X}f(x)=c\land \dots$'' as appropriate.}
\end{nttn}


Corollary~\ref{corr.correlated.intersect} is an easy and useful consequence of Theorem~\ref{thrm.correlated}:
\begin{corr}
\label{corr.correlated.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology. 
\item
$f:\ns P\to \tf{Val}$ is a value assignment to some set of values $\tf{Val}$ (Definition~\ref{defn.value.assignment}). 
\item
$f$ is continuous on topen sets $\atopen, \atopen'\in\topens$.
\end{itemize*}
Then 
$$
\atopen\between \atopen'
\quad\text{implies}\quad 
f(\atopen)=f(\atopen').
$$
\end{corr}
\begin{proof}
By Theorem~\ref{thrm.correlated} $f$ is constant on $\atopen$ and $\atopen'$, so we can write $f(\atopen)$ and $f(\atopen')$ as per Notation~\ref{nttn.f.const}.
We assumed that $\atopen$ and $\atopen'$ intersect, and the result follows.
\end{proof}

A converse to Theorem~\ref{thrm.correlated} also holds:
\begin{prop}
\label{prop.correlated.converse}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\tf{Val}$ is a semitopology of values with at least two elements (to exclude a denegerate case that no functions exist, or they exist but there is only one because there is only one value to map to).
\item
$T\subseteq\ns P$ is any set. 
\end{itemize*} 
Then 
\begin{itemize*}
\item
\emph{if} for every $p,p'\in T$ and every value assignment $f:\ns P\to\tf{Val}$, $f$ continuous at $p$ and $p'$ implies $f(p)=f(p')$, 
\item
\emph{then} $\atopen$ is transitive.
\end{itemize*}
\end{prop}
\begin{proof}
We prove the contrapositive. 
Suppose $\atopen$ is not transitive, so there exist $O,O'\in\opens$ such that $O\between \atopen\between O'$ and yet $O\cap O'=\varnothing$.
We choose two distinct values $v\neq v'\in\tf{Val}$ and define $f$ to map any point in $O$ to $v$ and any point in $\ns P\setminus O$ to $v'$.

Choose some $p\in O$ and $p'\in O'$.
It does not matter which, and some such $p$ and $p'$ exist, because $O$ and $O'$ are nonempty by Lemma~\ref{lemm.between.elementary}(\ref{between.nonempty}), since $O\between\atopen$ and $O'\between\atopen$).

We note that $f(p)=v$ and $f(p')=v'$ and $f$ is continuous at $p\in O$ and $p'\in O'\subseteq\ns P\setminus O$, yet $f(p)\neq f(p')$.
\end{proof}

\begin{rmrk}
\label{rmrk.transitive.correlated}
Suppose $(\ns P,\opens)$ is a semitopology and $\tf{Val}$ is a semitopology of values with at least two elements.
Say that a value assignment $f:\ns P\to\tf{Val}$ \deffont{splits} a set $T\subseteq\ns P$ when there exist $p,p'\in T$ such that $f$ is continuous at $p$ and $p'$ and $f(p)\neq f(p')$. 
Then Theorem~\ref{thrm.correlated} and Proposition~\ref{prop.correlated.converse} together say in words that: 
\begin{quote}
$T\subseteq\ns P$ is transitive if and only if it cannot be split by a value assignment. 
\end{quote}
Intuitively, transitive sets characterise areas of guaranteed agreement.

This reminds us of a basic result in topology about \emph{connected spaces}~\cite[section~26, Chapter~8]{willard:gent}.
Call a topology $(\ns T,\opens)$ \deffont{disconnected} when there exist open sets $O,O'\in\opens$ such that $O\cap O'=\varnothing$ (in our notation: $O\notbetween O'$) and $O\cup O'=\ns T$; otherwise call $(\ns T,\opens)$ \deffont{connected}.
Then $(\ns T,\opens)$ is disconnected if and only if (in our terminology above) it can be split by a value assignment. 
Theorem~\ref{thrm.correlated} and Proposition~\ref{prop.correlated.converse} are not identical to that result, but they are in the same spirit. 
\end{rmrk}

\subsection{Examples and discussion of transitive sets and topens}

We may routinely order sets by subset inclusion; including open sets, topens, closed sets, and so on, and we may talk about maximal, minimal, greatest, and least elements.
We include the (standard) definition for reference: 
\begin{nttn}
\label{nttn.min.max}
Suppose $(\ns P,\leq)$ is a poset.
Then:
\begin{enumerate*}
\item
Call $p\in\ns P$ \deffont{maximal} when $\Forall{p'}p{\leq}p'\limp p'=p$ and \deffont{minimal} when $\Forall{p'}p'{\leq}p\limp p'=p$.
\item
Call $p\in\ns P$ \deffont{greatest} when $\Forall{p}p'\leq p$ and \deffont{least} when $\Forall{p'}p\leq p'$.
\end{enumerate*}
\end{nttn}



\begin{xmpl}[Examples of transitive sets]
\label{xmpl.singleton.transitive}
\leavevmode
\begin{enumerate*}
\item\label{item.singleton.transitive}
$\{p\}$ is transitive, for any single point $p\in\ns P$. 
\item
The empty set $\varnothing$ is (trivially) transitive, but not topen because we insist in Definition~\ref{defn.transitive}(\ref{transitive.cc}).
\item
Call a set $P\subseteq\ns P$ \emph{topologically indistinguishable} when (using Notation~\ref{nttn.between}) for every open set $O$, 
$$
P\between O\liff P\subseteq O .
$$ 
It is easy to check that if $P$ is topologically indistinguishable, then it is transitive.
\end{enumerate*} 
\end{xmpl}


\begin{xmpl}[Examples of topens]
\label{xmpl.cc}
\leavevmode
\begin{enumerate*}
\item\label{item.cc.two.regular}
Take $\ns P=\{0, 1, 2\}$, with open sets $\varnothing$, $\ns P$, $\{0\}$, $\{2\}$, and $\{0,1,2\}$. 
This has two maximal topens $\{0\}$ and $\{2\}$, and an isolated point $1$, as illustrated in Figure~\ref{fig.012} (top-left diagram). 
\item\label{item.cc.two.regular.b}
Take $\ns P=\{0, 1, 2\}$, with open sets $\varnothing$, $\ns P$, $\{0\}$, $\{0, 1\}$, $\{2\}$, $\{1,2\}$, and $\{0,2\}$. 
This has two maximal topens $\{0\}$ and $\{2\}$, and an isolated point $1$, as illustrated in Figure~\ref{fig.012} (top-right diagram). 
\item
Take $\ns P=\{0,1,2,3,4\}$, with open sets generated by $\{0, 1\}$, $\{1\}$, $\{3\}$, and $\{3,4\}$.
This has two maximal topens $\{0,1\}$ and $\{2,3\}$, and an isolated point $0$, as illustrated in Figure~\ref{fig.012} (lower-left diagram). 
\item
Take $\ns P=\{0,1,2,\ast\}$, with open sets generated by $\{0\}$, $\{1\}$, $\{2\}$, $\{0, 1,\ast\}$, and $\{1,2,\ast\}$.
This has three maximal topens $\{0\}$, $\{1\}$, and $\{2\}$, and an isolated point $\ast$, as illustrated in Figure~\ref{fig.012} (lower-right diagram). 
\item
Take the all-but-one semitopology from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}) on $\mathbb N$: so $\ns P=\mathbb N$ with opens $\varnothing$, $\mathbb N$, and $\mathbb N\setminus \{x\}$ for every $x\in\mathbb N$.
This has a single maximal topen equal to $\mathbb N$ itself.
\item
The semitopology in Figure~\ref{fig.square.diagram} has no topen sets at all ($\varnothing$ is transitive and open, but by definition in Definition~\ref{defn.transitive}(\ref{transitive.cc}) topens have to be nonempty).
\end{enumerate*}
\end{xmpl}


\begin{figure}
\vspace{-1em}
\centering
\includegraphics[align=c,width=0.4\columnwidth,trim={50 60 50 120},clip]{diagrams/012a.pdf}
\includegraphics[align=c,width=0.4\columnwidth,trim={50 60 50 120},clip]{diagrams/012.pdf}
\\
\includegraphics[align=c,width=0.35\columnwidth,trim={20 20 20 20},clip]{diagrams/simple_example.pdf}
\quad\  
\includegraphics[align=c,width=0.35\columnwidth,trim={50 20 50 20},clip]{diagrams/counterexample-1.pdf}
\caption{Examples of topens (Example~\ref{xmpl.cc})}
\label{fig.012}
\end{figure}

\begin{rmrk}[Discussion]
We take a moment for a high-level discussion of where we are going.

The semiopologies in Example~\ref{xmpl.cc} invite us to ask what makes these examples different (especially parts~\ref{item.cc.two.regular} and~\ref{item.cc.two.regular.b}).
Clearly they are not equal, but that is a superficial answer in the sense that it is valid just in the world of sets, and it ignores semitopological structure.

For comparison: if we ask what makes $0$ and $1$ different in $\mathbb N$, we could just to say that $0\neq 1$, but this ignores what makes them different \emph{as numbers}.
For more insight, we could note that $0$ is the additive unit whereas $1$ is the multiplicative unit of $\mathbb N$ as a semiring; or that $0$ is a least element and $1$ is the unique atom of $\mathbb N$ as a well-founded poset; or that $1$ is the successor of $0$ of $\mathbb N$ as a well-founded inductive structure. 
Each of these answers gives us more understanding, not only into $0$ and $1$ but also into the structures that can be given to $\mathbb N$ itself. 

So we can ask:
\begin{quote}
\emph{What semitopological property or properties on points can identify the essential nature of the differences between the semitopologies in Example~\ref{xmpl.cc}?}
\end{quote}
There would be some truth to saying that the rest of this paper is devoted to developing different answers to this question!
In particular, we will shortly define the set of \emph{intertwined points} $\intertwined{p}$ in Definition~\ref{defn.intertwined.points}.
Example~\ref{xmpl.how.different?} will note that $\intertwined{1}=\{0,1,2\}$ in Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}), whereas $\intertwined{1}=\{1\}$ in Example~\ref{xmpl.cc}(\ref{item.cc.two.regular.b}), and $\intertwined{x}=\mathbb N$ for every $x$ in Example~\ref{xmpl.cc}(3).
\end{rmrk}



%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Closure properties of transitive sets}
\label{subsect.closure.properties.of.tt}

\begin{rmrk}
Transitive sets have some nice closure properties which we treat in this Subsection --- here we mean `closure' in the sense of ``the set of transitive sets is closed under various operations'', and not in the topological sense of `closed sets'.

Topens --- nonempty transitive \emph{open} sets --- will have even better closure properties, which emanate from the requirement in Lemma~\ref{lemm.transitive.transitive} that at least one of the transitive sets $\atopen$ or $\atopen'$ is open. 
See Subsection~\ref{subsect.closure.properties.of.cc}.
\end{rmrk}


\begin{lemm}
\label{lemm.transitive.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq \ns P$. 
Then:
\begin{enumerate*}
\item
If $\atopen$ is transitive and $\atopen'\subseteq \atopen$, then $\atopen'$ is transitive.
\item
If $\atopen$ is topen and $\varnothing\neq \atopen'\subseteq \atopen$ is nonempty and open, then $\atopen'$ is topen.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
By Definition~\ref{defn.transitive} it suffices to consider open sets $O$ and $O'$ such that $O\between \atopen'\between O'$, and prove that $O\between O'$.
But this is simple: by Lemma~\ref{lemm.between.elementary}(5) $O\between \atopen\between O'$, so $O\between O'$ follows by transitivity of $\atopen$. 
\item
Direct from part~1 of this result and Definition~\ref{defn.transitive}(\ref{transitive.cc}).
\qedhere\end{enumerate}
\end{proof}

Lemmas~\ref{lemm.cc.unions} and~\ref{lemm.cac.transitive} are required for, and extended by, Lemma~\ref{lemm.cc.unions}:
\begin{lemm}
\label{lemm.transitive.transitive}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$\atopen,\atopen'\subseteq\ns P$ are transitive.
\item
At least one of $\atopen$ and $\atopen'$ is open.
\end{itemize*}
Then:
\begin{enumerate*}
\item 
$\Forall{O,O'\in\opens}O\between \atopen \between \atopen'\between O' \limp O\between O'$. 
\item
If $\atopen\between \atopen'$ then $\atopen\cup \atopen'$ is transitive.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We simplify using Definition~\ref{defn.transitive} and our assumption that one of $\atopen$ and $\atopen'$ is open.
We consider the case that $\atopen'$ is open: 
$$
\begin{array}{r@{\ }l@{\qquad}l}
O\between \atopen\between \atopen'\between O'
\limp&
O\between \atopen' \between O'
&\text{$\atopen$ transitive, $\atopen'$ open}
\\
\limp&
O\between O'
&\text{$\atopen'$ transitive}.
\end{array}
$$
The argument for when $\atopen$ is open, is precisely similar.
\item
Suppose $O\between \atopen\cup \atopen'\between O'$.
By Lemma~\ref{lemm.between.elementary}(\ref{between.elementary.either.or}) (at least) one of the following four possibilities must hold:
$$
O\between \atopen\land \atopen\between O',
\quad
O\between \atopen'\land \atopen\between O',
\quad
O\between \atopen\land \atopen'\between O',
\quad\text{or}\quad
O\between \atopen'\land \atopen'\between O' .
$$
If $O\between \atopen\ \land\ \atopen'\between O'$ then by part~1 of this result we have $O\between O'$ as required. 
The other possibilities are no harder.
\qedhere\end{enumerate}
\end{proof}


\begin{defn}[Ascending/descending chain]\leavevmode
\label{defn.ascending.chains}
A \deffont{chain} of sets $\mathcal X$ is a collection of sets that is totally ordered by subset inclusion $\subseteq$.\footnote{A total order is reflexive, transitive, antisymmetric, and total.}

We may call a chain \deffont{ascending} or \deffont{descending} if we want to emphasise that we are thinking of the sets as `going up' or `going down'.
\end{defn}

\begin{lemm}
\label{lemm.cac.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\mathcal \atopen$ is a chain of transitive sets.
Then $\bigcup\mathcal \atopen$ is a transitive set.
\end{lemm}
\begin{proof}
Suppose $O\between \bigcup\mathcal \atopen\between O'$.
Then there exist $\atopen,\atopen'\in\mathcal\atopen$ such that $O\between \atopen$ and $\atopen'\between O'$.
But $\mathcal\atopen$ is totally ordered, so either $\atopen\subseteq\atopen'$ or $\atopen\supseteq\atopen'$.
In the former case it follows that $O\between \atopen'\between O'$ so that $O\between O'$ by transitivity of $\atopen'$; the latter case is precisely similar. 
\end{proof} 




%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Closure properties of topens}
\label{subsect.closure.properties.of.cc}

Definition~\ref{defn.connected.set} will be useful in Lemma~\ref{lemm.cc.unions}(2): 
\begin{defn}
\label{defn.connected.set}
Suppose $(\ns P,\opens)$ is a semitopology.
Call a nonempty set of nonempty open sets $\mathcal O\subseteq\opens_{\neq\varnothing}$ a \deffont{clique} when its elements pairwise intersect.\footnote{%
We call this a \emph{clique}, because if we form the \emph{intersection graph} with nodes elements of $\mathcal O$ and with an (undirected) edge between $O$ and $O'$ when $O\between O'$, then $\mathcal O$ is a clique precisely when its intersection graph is indeed a clique.  We could also call $\mathcal O$ a \emph{connected} set of opens; this terminology would evoke a concept from topology, which we will in fact use later in Definition~\ref{defn.tangled}.} 
In symbols: 
$$
\mathcal O\subseteq\opens\ \text{is a clique}
\quad\text{when}\quad
\Forall{O,O'\in\mathcal O}O\between O'.
$$
Note that if $\mathcal O$ is a clique then every $O\in\mathcal O$ is nonempty, since $\varnothing\between O$ is impossible (Notation~\ref{nttn.between}).
\end{defn}



\begin{lemm}
\label{lemm.cc.unions}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item\label{item.intersecting.pair.of.topens}
If $\atopen$ and $\atopen'$ are an intersecting pair of topens (i.e. $\atopen\between \atopen'$), then $\atopen\cup \atopen'$ is topen. 
\item
If $\mathcal \atopen$ is a clique of topens (Definition~\ref{defn.connected.set}), then $\bigcup\mathcal \atopen$ is topen. 
\item
If $\mathcal \atopen$ is a chain of topens then $\bigcup\mathcal \atopen$ is topen.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
$\atopen\cup \atopen'$ is open because by Definition~\ref{defn.semitopology}(\ref{semitopology.unions}) open sets are closed under arbitrary unions, and by Lemma~\ref{lemm.transitive.transitive}(2) $\atopen\cup \atopen'$ is transitive.
\item
$\bigcup\mathcal \atopen$ is open by Definition~\ref{defn.semitopology}(\ref{semitopology.unions}).
Also, if $O\between\bigcup\mathcal \atopen\between O'$ then there exist $\atopen,\atopen'\in\mathcal \atopen$ such that $O\between \atopen$ and $\atopen'\between O'$.
We assumed $\atopen\between \atopen'$, so by Lemma~\ref{lemm.transitive.transitive}(1) (since $\atopen$ and $\atopen'$ are open) we have $O\between O'$ as required. 
\item
Any chain is pairwise intersecting.  We use part~2 of this result.\footnote{We could also use Lemma~\ref{lemm.cac.transitive}.  The reader might now ask why Lemma~\ref{lemm.cac.transitive} was not derived directly from Lemma~\ref{lemm.transitive.transitive}(2); this is because (interestingly) Lemma~\ref{lemm.cac.transitive} does not require openness.}
\qedhere
\end{enumerate}
\end{proof}

\begin{corr}
\label{corr.max.cc}
Suppose $(\ns P,\opens)$ is a semitopology.
Then every topen $\atopen$ is contained in a unique maximal topen.
\end{corr}
\begin{proof}
Consider $\mathcal \atopen$ defined by
$$
\mathcal \atopen = \{\atopen\cup \atopen' \mid \atopen'\text{ topen}\land \atopen\between \atopen'\} .
$$
By Lemma~\ref{lemm.cc.unions}(2) this is a set of topens.
By construction they all contain $\atopen$, and by our assumption that $\atopen\neq\varnothing$ they pairwise intersect (since they all contain $\atopen$, at least).
By Lemma~\ref{lemm.cc.unions}(3) therefore, $\bigcup\mathcal \atopen$ is a transitive open set.
It is easy to check that this is the unique maximal transitive open set that contains $\atopen$. 
\end{proof}


\begin{thrm}
\label{thrm.topen.partition}
Suppose $(\ns P,\opens)$ is a semitopology.
Then any $P\subseteq \ns P$, and in particular $\ns P$ itself, can be partitioned into:
\begin{itemize*}
\item
Some disjoint collection of maximal topens.
\item
A set of other points, which are not contained in any topen.
In Definition~\ref{defn.tn} we will call these points \emph{irregular}.
\end{itemize*}
See also Corollary~\ref{corr.topen.partition.char}.
\end{thrm}
\begin{proof}
Routine from Corollary~\ref{corr.max.cc}.
\end{proof}


\begin{rmrk}
\label{rmrk.forward}
\label{rmrk.partition}
It may be useful to put Theorem~\ref{thrm.topen.partition} in the context of the terminology, results, and examples that will follow below. 
We will have Definition~\ref{defn.tn}(\ref{item.regular.point}) and Theorem~\ref{thrm.max.cc.char}.
These will allow us to call a point $p$ contained in some maximal topen $\atopen$ \emph{regular}, and to call the maximal topen $\atopen$ of a regular point its \emph{community}.
Then Theorem~\ref{thrm.topen.partition} says that a semitopology $\ns P$ can be partitioned into:
\begin{itemize*}
\item
Regular points, which partition into disjoint communities --- each community is, in a sense made formal in Theorem~\ref{thrm.correlated}, a coalitions of strongly-correlated regular points acting together --- and
\item
a set of irregular points, which have no commmunity and so are not members of any such coalition.
\end{itemize*} 
We give examples in Example~\ref{xmpl.cc} and Figure~\ref{fig.012}, and we will see more elaborate examples below (see in particular the collection in Example~\ref{xmpl.two.topen.examples}). 

In the special case that the entire space consists of a single topen community, there are no irregular points and all participants are guaranteed to agree, where algorithms succeed.
For the application of a single blockchain trying to arrive at consensus, this discussion tells us that we want it to consist, semitopologically, of a single topen.
\end{rmrk}






%%%%%%%%%%%%%%%%%%%%%
\subsection{Intertwined points} 
\label{subsect.intertwined.points}


\subsubsection{The basic definition, and some lemmas}


\begin{defn}
\label{defn.intertwined.points}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
\begin{enumerate*}
\item\label{item.p.intertwinedwith.p'}
Call $p$ and $p'$ \deffont{intertwined} when $\{p,p'\}$ is transitive.
Unpacking Definition~\ref{defn.transitive} this means:
$$
\Forall{O,O'{\in}\opens} (p\in O\land p'\in O') \limp O\between O' .
$$ 
By a mild abuse of notation, write 
$$
p\intertwinedwith p' \quad \text{when}\quad \text{$p$ and $p'$ are intertwined}.
$$
\item\label{intertwined.defn}
Define $\intertwined{p}$ (read `intertwined of $p$') to be the set of points intertwined with $p$.
In symbols: 
$$
\intertwined{p}=\{p'\in\ns P \mid p\intertwinedwith p'\} .
$$
\end{enumerate*}
\end{defn}


\begin{xmpl}
\label{xmpl.how.different?}
We return to the examples in Example~\ref{xmpl.cc}.  
There we note that:
\begin{enumerate*}
\item
$\intertwined{1}=\{0,1,2\}$ and $\intertwined{0}=\{0\}$ and $\intertwined{2}=\{2\}$.
\item
$\intertwined{1}=\{1\}$ and $\intertwined{0}=\{0\}$ and $\intertwined{2}=\{2\}$.
\item
$\intertwined{x}=\ns P$ for every $x$. 
\end{enumerate*}
\end{xmpl}


It might be tempting to suppose that points being intertwined should be transitive.
Lemma~\ref{lemm.intertwined.not.transitive} shows that this is not necessarily the case:
\begin{lemm}
\label{lemm.intertwined.not.transitive}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the `is intertwined' relation $\between$ is not necessarily transitive.
That is: $p\intertwinedwith p'\intertwinedwith p''$ does not necessarily imply $p\intertwinedwith p''$.
\end{lemm}
\begin{proof}
It suffices to provide a counterexample.
The semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, top-left diagram) will do.
Take 
$$
\ns P=\{0,1,2\}
\quad\text{and}\quad
\opens=\{\varnothing,\ns P,\{0\},\{2\}\}.
$$
Then 
$$
0\between 1
\ \ \text{and}\ \ 1\between 2,
\quad\text{but}\quad
\neg(0\between 2).
$$
\end{proof}
There is more to be said about Lemma~\ref{lemm.intertwined.not.transitive} but will need more machinery to express it; we will pick up this thread again in Definition~\ref{defn.conflicted}.


We conclude with an easy observation:
\begin{nttn}
\label{nttn.intertwined.space}
Suppose $(\ns P,\opens)$ is a semitopology.
Call $\ns P$ \deffont{intertwined} when 
$$
\Forall{p,p'\in\ns P}p\intertwinedwith p'.
$$
In words: $\ns P$ is intertwined when all of its points are pairwise intertwined.
\end{nttn}

\begin{lemm}
\label{lemm.intertwined.space}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the following conditions are equivalent:
\begin{enumerate*}
\item
$\ns P$ is an intertwined space.
\item
$\ns P$ is a transitive set in the sense of Definition~\ref{defn.transitive}(\ref{transitive.transitive}).
\item
All nonempty open sets intersect.
\end{enumerate*}
\end{lemm}
\begin{proof}
Routine by unpacking the definitions.
\end{proof}

\begin{rmrk}
A topologist would call an intertwined space \emph{hyperconnected} (see Definition~\ref{defn.tangled} and the following discussion).
This is also --- modulo closing under arbitrary unions --- what an expert in the classical theory of consensus might call a \emph{quorum system}~\cite{naor:loacaq}.
\end{rmrk}


\subsubsection{Pointwise characterisation of transitive sets}

\begin{lemm}
\label{lemm.three.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$\atopen$ is transitive.
\item
$\{p,p'\}$ is transitive for every $p,p'\in \atopen$.
\item
$p\intertwinedwith p'$ for every $p,p'\in \atopen$.
\end{enumerate*}
\end{lemm}
\begin{proof}
The equivalence of parts~2 and~3 above just restates Definition~\ref{defn.intertwined.points}.
We now prove equivalence of parts~1 and~2.
\begin{itemize}
\item
\emph{Suppose $\atopen$ is transitive.}
\quad

By Lemma~\ref{lemm.transitive.subset}(1), $\{p,p'\}$ is transitive for every $p,p'\in \atopen$.
\item
\emph{Suppose $\{p,p'\}$ is transitive for every $p,p'\in \atopen$.}

Consider open sets $O$ and $O'$ such that $O\between \atopen\between O'$. 
Choose $p\in O\cap \atopen$ and $p'\in O\cap \atopen'$.
By construction $\{p,p'\}\subseteq \atopen$ so this is transitive.
It follows that $O\between O'$ as required.
\qedhere\end{itemize}
\end{proof}



\begin{thrm}
\label{thrm.cc.char}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$\atopen$ is topen.
\item
$\atopen\in\opens_{\neq\varnothing}$ and $\Forall{p,p'{\in}\atopen}p\intertwinedwith p'$.
\end{enumerate*}
In words we can say:
\begin{quote}
A topen is a nonempty open set of intertwined points.
\end{quote}
\end{thrm}
\begin{proof}
By Definition~\ref{defn.transitive}(\ref{transitive.cc}), $\atopen$ is topen when it is nonempty, open, and transitive. 
By Lemma~\ref{lemm.three.transitive} this last condition is equivalent to $p\intertwinedwith p'$ for every $p,p'\in \atopen$. 
\end{proof}

A value assignment is constant on a pair of intertwined points, where it is continuous:
\begin{corr}
\label{corr.intertwined.correlated}
Suppose $\tf{Val}$ is a semitopology of values and $f:\ns P\to\tf{Val}$ is a value assignment (Definition~\ref{defn.value.assignment})
and $p,p'\in\ns P$ and $p\between p'$.
Then if $f$ continuous at $p$ and $p'$ then $f(p)=f(p')$.
\end{corr}
\begin{proof}
$\{p,p'\}$ is transitive by Theorem~\ref{thrm.cc.char};
we use Theorem~\ref{thrm.correlated}.
\end{proof}


\begin{rmrk}[Intertwined as `non-Hausdorff']
\label{rmrk.not.hausdorff}
\leavevmode
\\
\noindent Recall that we call a topological space $(\ns P,\opens)$ \deffont{Hausdorff} (or \deffont{$\mathbf{T_2}$}) when any two points can be separated by pairwise disjoint open sets.
Using the $\between$ symbol from Notation~\ref{nttn.between}, we rephrase the Hausdorff condition as
$$
\Forall{p,p'}p\neq p'\limp \Exists{O,O'}(p\in O\land p'\in O'\land \neg (O\between O')) , 
$$
and we can then simplify to this:
$$
\neg\Exists{p,p'}p\neq p'\land p\intertwinedwith p' .
$$
Now note that the Hausdorff condition can be compactly written just as
\begin{equation}
\label{eq.hausdorff}
\Forall{p}\intertwined{p}=\{p\}.
\end{equation}
Note how distinct $p$ and $p'$ being intertwined is the \emph{opposite} of being Hausdorff: $p\intertwinedwith p'$ when $p'\in\intertwined{p}$, and they \emph{cannot} be separated by pairwise disjoint open sets.
Thus the assertion $p\intertwinedwith p'$ in Theorem~\ref{thrm.cc.char} is a negation to the Hausdorff property:
$$
\Exists{p}\intertwined{p}\neq\{p\} .
$$
This is useful because for semitopologies as applied to consensus, 
\begin{itemize*}
\item
being Hausdorff means that the space is separated (which is probably a bad thing, if we are looking for a system with lots of points in consensus), whereas 
\item
being full of intertwined points means 
by Theorem~\ref{thrm.correlated} that the system will (where algorithms succeed) be full of points whose value assignment agrees (which is a good thing).
\end{itemize*}
In the literature this might be called \emph{avoiding forking}.
\end{rmrk}

 

%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Strong topens: topens that are also subspaces}

\subsubsection{Definition and main result}

Let us take stock and recall that:
\begin{itemize*}
\item
$\atopen$ is \emph{topen} when it is a nonempty open transitive set (Definition~\ref{defn.transitive}).
\item
$\atopen$ is \emph{transitive} when $O\between \atopen \between O'$ implies $O\between O'$ for all $O,O'\in\tf{Opens}$ (Definition~\ref{defn.transitive}). 
\item
$O\between O'$ means that $O\cap O'\neq\varnothing$ (Notation~\ref{nttn.between}). 
\end{itemize*}
But, note above that if $\atopen$ is topen and $O\between \atopen\between O'$ then $O\cap O'$ need not intersect \emph{inside $\atopen$}.
It could be that $O$ and $O'$ intersect outside of $\atopen$ (an example is in the proof Lemma~\ref{lemm.cc.subspaces} below).

Definition~\ref{defn.subspace} spells out a standard topological construction in the language of semitopologies:
\begin{defn}[Subspaces]
\label{defn.subspace}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\atopen\subseteq\ns P$ is a set of points.
Write $(\atopen,\opens\cap \atopen)$ for the semitopology such that:
\begin{itemize*}
\item
The points are $\atopen$.
\item
The open sets have the form $O\cap \atopen$ for $O\in\opens$.
\end{itemize*}
We say that $(\atopen, \opens\cap \atopen)$ is $\atopen$ with the \deffont{semitopology inherited from $(\ns P,\opens)$}.

We may call $(\atopen,\opens\cap \atopen)$ a \deffont{subspace} of $(\ns P,\opens)$, and if the open sets are understood then we may omit mention of them and just write:
\begin{quote}
A subset $\atopen\subseteq\ns P$ is naturally a \deffont{(semitopological) subspace} of $\ns P$.
\end{quote}
\end{defn}




\begin{figure}
\vspace{-1em}
\centering
\subcaptionbox{A topen that is not strong (Lemma~\ref{lemm.cc.subspaces})}{\includegraphics[width=0.4\columnwidth,trim={50 0 50 20},clip]{diagrams/not-strong-topen.pdf}}
\qquad
\subcaptionbox{A transitive set that is not strongly transitive (Lemma~\ref{lemm.strong.is.stronger}(2))}{\includegraphics[width=0.5\columnwidth,trim={50 30 50 30},clip]{diagrams/not-strongly-transitive.pdf}}
\caption{Two counterexamples for (strong) transitivity}
\label{fig.not-strong-topen}
\end{figure}


\begin{lemm}
\label{lemm.cc.subspaces}
The property of being a (maximal) topen is not necessarily closed under taking subspaces.
\end{lemm}
\begin{proof}
It suffices to exhibit a semitopology $(\ns P,\opens)$ and a subset $S\subseteq\ns P$ such that $S$ is topen in $(\ns P,\opens)$ but $S$ is not topen in $(S,\opens\cap S)$.
We set:
$$
\ns P=\{0, 1, 2\}
\qquad
\opens=\{\varnothing,\ \ns P,\ \{0, 2\},\ \{1, 2\},\ \{0,1\}\}
\qquad
\atopen=\{0,1\}
$$
as illustrated in Figure~\ref{fig.not-strong-topen} (left-hand diagram).
Now:
\begin{itemize*}
\item
$\atopen$ is topen in $(\ns P,\opens)$, because every open neighbourhood of $0$ --- that is $\{0,2\}$, $\{0,1\}$, and $\ns P$ --- intersects with every open neighbourhood of $1$ --- that is $\{1,2\}$, $\{0,1\}$, and $\ns P$.
\item
$\atopen$ is not topen in $(\atopen,\opens\cap \atopen)$, because $\{0\}$ is an open neighbourhood of $0$ and $\{1\}$ is an open neighbourhood of $1$ and these do not intersect.
\qedhere\end{itemize*}
\end{proof}



Lemma~\ref{lemm.cc.subspaces} motivates the following definitions:

\begin{defn}
\label{defn.betweenY}
Suppose $X$, $Y$, and $Z$ are sets.
Write $X\between_Y Z$, and say that $X$ and $Z$ \deffont{meet} or \deffont{intersect in $Y$}, when $(X\cap Y)\between (Z\cap Y)$.
\end{defn}

\begin{lemm}
\label{lemm.betweenY.basic.sets}
Suppose $X$, $Y$, and $Z$ are sets.
Then:
\begin{enumerate*}
\item
The following are equivalent:
$$
X\cap Y\cap Z\neq\varnothing 
\quad\liff\quad
X\between_Y Z
\quad\liff\quad
Y\between_X Z
\quad\liff\quad
X\between_Z Y .
$$
\item
$X\between_Y Y$ if and only if $X \between Y$.
\item
If $X\between_Y Z$ then $X\between Z$.
\end{enumerate*}
\end{lemm}
\begin{proof}
From Definition~\ref{defn.betweenY}, by elementary sets calculations.
\end{proof}



\begin{defn}
\label{defn.strongly.transitive}
Suppose $(\ns P, \opens)$ is a semitopology and recall from Definition~\ref{defn.transitive} the notions of \emph{transitive set} and \emph{topen}.
\begin{enumerate*}
\item\label{item.strongly.transitive}
Call $\atopen\subseteq\ns P$ \deffont{strongly transitive} when
$$
\Forall{O,O'{\in}\opens} O\between \atopen \between O' \limp O\between_\atopen O' . 
$$
\item\label{strong.transitive.cc}
Call $\atopen$ a \deffont{strong topen} when $\atopen$ is nonempty open and strongly transitive, 
\end{enumerate*}
\end{defn}

\begin{lemm}
\label{lemm.strong.is.stronger}
Suppose $(\ns P, \opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then:
\begin{enumerate*}
\item
If $\atopen$ is strongly transitive then it is transitive.
\item
The reverse implication need not hold (even if $(\ns P,\opens)$ is a topology): it is possible for $\atopen$ to be transitive but not strongly transitive.
\end{enumerate*} 
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $\atopen$ is strongly transitive and suppose $O\between\atopen\between O'$.
By Lemma~\ref{lemm.betweenY.basic.sets}(2) $O\between_\atopen \atopen \between_\atopen O'$.
By strong transitivity $O\between_\atopen O'$.
By Lemma~\ref{lemm.betweenY.basic.sets}(3) $O\between O'$.
Thus $\atopen$ is transitive.
\item
It suffices to provide a counterexample.
This is illustrated in Figure~\ref{fig.not-strong-topen} (right-hand diagram).
We set:
\begin{itemize*}
\item
$\ns P = \{0,1,2\}$, and
\item
$\opens= \{\varnothing,\ \{1\},\ \{0,1\},\ \{1,2\},\ \{0,1,2\}\}$.
\item
We set $\atopen=\{0,2\}$.
\end{itemize*}
We note that $(\ns P,\opens)$ is a topology, and it is easy to check that $\atopen$ is transitive --- we just note that $\{0,1\}\between\atopen\between\{1,2\}$ and $\{0,1\}\between\{1,2\}$.
However, $\atopen$ is not strongly transitive, because $\{0,1\}\cap\{1,2\}=\{1\}\not\subseteq\atopen$.
\qedhere\end{enumerate}
\end{proof} 



\begin{prop}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\atopen\in\opens$.
Then the following are equivalent:
\begin{enumerate*}
\item
$\atopen$ is a strong topen.
\item
$\atopen$ is a topen in $(\atopen,\opens\cap \atopen)$ (Definition~\ref{defn.subspace}).
\end{enumerate*} 
\end{prop}
\begin{proof}
Suppose $\atopen$ is a strong topen; thus $\atopen$ is nonempty, open, and strongly transitive in $(\ns P,\opens)$.
Then by construction $\atopen$ is open in $(\atopen,\opens\cap \atopen)$, and the strong transitivity property of Definition~\ref{defn.strongly.transitive} asserts precisely that $\atopen$ is transitive as a subset of $(\atopen,\opens\cap \atopen)$.

Now suppose $\atopen$ is a topen in $(\atopen,\opens\cap \atopen)$; thus $\atopen$ is nonempty, open, and transitive in $(\atopen,\opens\cap \atopen)$.
Then $\atopen$ is nonempty and by assumption above $\atopen\in\opens$.\footnote{It does not follow from $\atopen$ being open in $(\atopen,\opens\cap \atopen)$ that $\atopen$ is open in $(\ns P,\opens)$, which is why we included an assumption that this holds in the statement of the result.}
Now suppose $O,O'\in\opens$ and $O\between \atopen\between O'$.
Then by Lemma~\ref{lemm.betweenY.basic.sets}(2) $O \between_\atopen \atopen\between_\atopen O'$, so by transitivity of $\atopen$ in $(\atopen,\opens\cap \atopen)$ also $O\between_\atopen O'$, and thus by Lemma~\ref{lemm.betweenY.basic.sets}(3) also $O\between O'$. 
\end{proof}


\subsubsection{Connection to lattice theory}

There is a notion from order-theory of a \emph{join-irreducible} element (see for example in \cite[Definition~2.42]{priestley:intlo}), and a dual notion of \emph{meet-irreducible} element:
\begin{defn}
Call an element $s$ in a lattice $\mathcal L$ 
\begin{itemize*}
\item
\deffont{join-irreducible} when $x\vee y=s$ implies $x=s$ or $y=x$, and 
\item
\deffont{meet-irreducible} when $x\wedge y=s$ implies $x=s$ or $y=s$. 
\end{itemize*}
\end{defn}



\begin{xmpl}
\label{xmpl.meet-irreducible}
\leavevmode
\begin{enumerate*}
\item
Consider the lattice of finite (possibly empty) subsets of $\mathbb N$, with $\mathbb N$ adjoined as a top element.
Then $\mathbb N$ is join-irreducible; if $x\cup y=\mathbb N$ then either $x=\mathbb N$ or $y=\mathbb N$.
\item\label{item.final.N}
Consider $\mathbb N$ with the \deffont{final segment} semitopology such that opens are either $\varnothing$ or sets $n_\geq = \{n'\in\mathbb N \mid n'\geq n\}$.

Then $\varnothing$ is meet-irreducible; if $x\cap y=\varnothing$ then either $x=\varnothing$ or $y=\varnothing$.
\item
Consider the natural numbers with the lattice structure in which meet is minimum and join is maximum.
Then every element is join- and meet-irreducible; if $x\vee y=z$ then $x=z$ or $y=z$, and similarly for $x\wedge y$. 
\end{enumerate*}
Thus we see that irreducibility captures a notion that an element cannot be approached by finitely many joins (or meets). 
\end{xmpl}


We spell out how this is relates to our notions of transitivity from Definitions~\ref{defn.transitive} and~\ref{defn.strongly.transitive}:
\begin{lemm}
\label{lemm.meet-irreducible}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then: 
\begin{enumerate*}
\item
$\atopen$ is strongly transitive if and only if $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$ (Definition~\ref{defn.subspace}). 
\item
$\atopen$ is transitive if $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$.
\item
If $\atopen$ is transitive it does not necessarily follow that $\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We are abusing terminology talking about meet-irreducibility in the set of open sets $\{O\cap \atopen\mid O\in\opens\}$ of the subspace $(\atopen,\opens\cap \atopen)$, 
because this is not a lattice since $\opens$ is not closed under intersections in general.\footnote{Unless $(\ns P,\opens)$ happens to be a topology and not just a semitopology, of course.}
However, some meets may still exist and in particular it makes sense to ask whether two elements have a sets intersection that is equal to $\varnothing$, since $\varnothing$ is in $\{O\cap \atopen\mid O\in\opens\}$ --- if this reader does not approve, they can call the property `partial $\cap$-irreducibility' instead of `meet-irreducibility' and no harm will come of it.
We can now proceed to reason as follows: 
\begin{enumerate}
\item
$\varnothing$ is meet-irreducible in $(\atopen,\opens\cap \atopen)$ means that $(O\cap \atopen)\cap (O'\cap \atopen)=\varnothing$ implies $O\cap \atopen=\varnothing$ or $O\cap \atopen'=\varnothing$.

$\atopen$ is strongly transitive when (taking the contrapositive in Definition~\ref{defn.strongly.transitive}(1)) $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ implies $O\cap \atopen=\varnothing$ or $\atopen\cap O'=\varnothing$.

That these conditions are equivalent follows by straightforward sets manipulations. 
\item
We can use part~1 of this result and Lemma~\ref{lemm.strong.is.stronger}(1), or give a direct argument by sets calculations: if $O\cap O'=\varnothing$ then $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ and by meet-irreducibility $O\cap \atopen=\varnothing$ or $\atopen\cap O'=\varnothing$ as required.
\item
Figure~\ref{fig.not-strong-topen} (left-hand diagram) provides a counterexample, taking $\atopen=\{0,1\}$ and $O=\{0,2\}$ and $O'=\{1,2\}$.
Then $(O\cap \atopen)\cap (\atopen\cap O')=\varnothing$ but it is not the case that $O\cap \atopen=\varnothing$ or $O'\cap \atopen=\varnothing$.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
\label{rmrk.imperfect}
The proof of Lemma~\ref{lemm.meet-irreducible} not hard, but the result is interesting for what it says, and also for what it does not say:
\begin{enumerate}
\item
The notion of being a strong topen maps naturally to something in order theory; namely that $\varnothing$ is meet-irreducible in the induced poset $\{O\cap \atopen\mid O\in\opens\}$ which is the set of open sets of the subspace $(\atopen,\opens\cap \atopen)$ of $(\ns P,\opens)$.
\item
However, this mapping is imperfect: the poset is not a lattice, and it is also not a sub-poset of $\opens$ --- even if $\atopen$ is topen.
If $\opens$ were a topology and closed under intersections then we would have a lattice --- but it is precisely the point of difference between semitopologies vs. topologies that open sets need not be closed under intersections. 
\item
Being transitive does not correspond to meet-irreducibility; there is an implication in one direction, but certainly not in the other. 
\end{enumerate}
So, Lemma~\ref{lemm.meet-irreducible} says that (strong) transitivity has a flavour of meet-irreducibility, but in a way that also illustrates --- as did Proposition~\ref{prop.max.topen.min.closed}(2) --- how semitopologies are different, because they are not closed under intersections, and have their own behaviour.

See also the characterisation of strong transitivity in Lemma~\ref{lemm.strongly.dense.strongly.transitive} and the surrounding discussion.
\end{rmrk}


\subsubsection{Topens in topologies}
\label{subsection.topens.in.topologies}

We conclude by briefly looking at what `being topen' means if our semitopology is actually a topology.
We recall a standard definition from topology:
\begin{defn}
\label{defn.tangled}
Suppose $(\ns P,\opens)$ is a semitopology.
Call $\atopen\subseteq\ns P$ \deffont{hyperconnected} when all nonempty open subsets of $\atopen$ intersect.\footnote{Calling this \emph{hyperconnected} is a slight abuse of terminology: in topology, `hyperconnected' is typically used to refer to an entire space rather than an open subset of it.  It would be more accurate to call $\atopen$ a \emph{hyperconnected open subspace}.} 
In symbols: 
$$
\Forall{O,O'\in\opens_{\neq\varnothing}} O,O'\subseteq\atopen \limp O\between O' .
$$
\end{defn}


\begin{lemm}
\label{lemm.tran.neosi}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$. 
Then:
\begin{enumerate*}
\item
If $\atopen$ is transitive then it is hyperconnected.
\item
The reverse implication need not hold; it is possible for $\atopen$ to be hyperconnected but not transitive, even if $(\ns P,\opens)$ is a topology (not just a semitopology).
\item
The reverse implication need not hold; it is possible for $\atopen$ to be hyperconnected but not transitive, even if $\atopen$ is an open set. 
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $\varnothing\neq O,O'\subseteq\atopen$.
Then $O\between\atopen\between O'$ and by transitivity $O\between O'$ as required.
\item
It suffices to provide a counterexample.
Consider the semitopology illustrated in the lower-left diagram in Figure~\ref{fig.012} (which is a topology), and set $\atopen=\{0,4\}$.
This has no nonempty open subsets so it is trivially hyperconnected.
However, $\atopen$ is not transitive because $\{0,1\}\between \atopen \between \{3,4\}$ yet $\{0,1\}\notbetween\{3,4\}$.
\item
It suffices to provide a counterexample.
Consider the semitopology illustrated in the top-right diagram in Figure~\ref{fig.012}, and set $\atopen=\{0,1\}$.
This has two nonempty open subsets, $\{0\}$ and $\{0,1\}$, so it is hyperconnected.
However, $\atopen$ is not transitive, because $\{0\}\between \atopen \between \{1,2\}$ yet $\{0\}\notbetween\{1,2\}$.
\qedhere\end{enumerate}
\end{proof}

We know from Lemma~\ref{lemm.strong.is.stronger}(2) that `transitive' does not imply `strongly transitive' for an arbitrary subset $\atopen\subseteq\ns P$, even in a topology.
When read together with Lemma~\ref{lemm.tran.neosi}, this invites the question of what happens when 
\begin{itemize*}
\item
$(\ns P,\opens)$ is a topology, and \emph{also} 
\item
$\atopen$ is an open set.
\end{itemize*}
In this natural special case, strong transitivity, transitivity, and being hyperconnected, all become equivalent: 
\begin{lemm}
\label{lemm.transitive.topology}
Suppose $(\ns P,\opens)$ is a topology and suppose $\atopen\in\opens$ is an open set.
Then the following are equivalent:
\begin{itemize*}
\item
$\atopen$ is a strong topen (Definition~\ref{defn.strongly.transitive}(\ref{strong.transitive.cc})).
\item
$\atopen$ is a topen.
\item
$\atopen$ is hyperconnected.
\end{itemize*}
\end{lemm}
\begin{proof}
We assumed $\atopen$ is open, so the equivalence above can also be thought of as 
\begin{quote}
strongly transitive $\liff$ transitive $\liff$ all nonempty open subsets intersect.
\end{quote}
We prove a chain of implications:
\begin{itemize}
\item
If $\atopen$ is a strong topen then it is a topen by Lemma~\ref{lemm.strong.is.stronger}(1).
\item
If $\atopen$ is a topen then we use Lemma~\ref{lemm.tran.neosi}(1).
\item
Suppose $\atopen$ is hyperconnected, so every pair of nonempty open subsets of $\atopen$ intersect; and 
suppose $O,O'\in\opens_{\neq\varnothing}$ and $O\between\atopen\between O'$.
Then also $(O\cap\atopen) \between \atopen \between (O'\cap\atopen)$.
Now $O\cap\atopen$ and $O'\cap\atopen$ are open: because $\atopen$ is open; and $\ns P$ is a topology (not just a semitopology), so intersections of open sets are open.
By transitivity of $\atopen$ we have $O\cap\atopen\between O'\cap\atopen$.
Since $O$ and $O'$ were arbitrary, $\atopen$ is strongly transitive.
\qedhere\end{itemize} 
\end{proof}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Open interiors, communities, and regular points}
\label{sect.regular.points}



%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Community of a (regular) point} 


Definition~\ref{defn.interior} is standard:
\begin{defn}[Open interior]
\label{defn.interior}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Define $\interior(P)$ the \deffont{interior} of $P$ by
$$
\interior(P)=\bigcup\{ O\in\opens \mid O\subseteq P\} .
$$
\end{defn}

\begin{lemm}
\label{lemm.interior.open}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Then $\interior(P)$ from Definition~\ref{defn.interior} is the greatest open subset of $P$.
\end{lemm}
\begin{proof}
Routine by the construction in Definition~\ref{defn.interior} and closure of open sets under unions (Definition~\ref{defn.semitopology}(\ref{semitopology.unions})).
\end{proof}

\begin{corr}
\label{corr.interior.monotone}
Suppose $(\ns P,\opens)$ is a semitopology and $P,P'\subseteq\ns P$.
Then if $P\subseteq P'$ then $\interior(P)\subseteq\interior(P')$.
\end{corr}
\begin{proof}
Routine using Lemma~\ref{lemm.interior.open}.
\end{proof}





\begin{defn}[Community of a point, and regularity]
\label{defn.tn}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item\label{item.tn}
Define $\community(p)$ the \deffont{community} of $p$ by 
$$
\community(p)=\interior(\intertwined{p}) .
$$
\item\label{item.community.P}
Extend $\community$ to subsets $P\subseteq\ns P$ by taking a sets union:
$$
\community(P) = \bigcup\{\community(p) \mid p\in P\} .
$$
\item\label{item.regular.point}
Call $p$ \deffont{regular} when its community is a topen neighbourhood of $p$.
In symbols:
$$
p\text{ is regular}\quad\text{when}\quad p\in\community(p)\in\topens .
$$
\item\label{item.weakly.regular.point}
Call $p$ \deffont{weakly regular} when its community is an open (but not necessarily topen) neighbourhood of $p$.
In symbols:
$$
p\text{ is weakly regular}\quad\text{when}\quad p\in\community(p)\in\opens .
$$
\item\label{item.quasiregular.point}
Call $p$ \deffont{quasiregular} when its community is nonempty.
In symbols:
$$
p\text{ is quasiregular}\quad\text{when}\quad \varnothing\neq\community(p)\in\opens .
$$
\item
If $p$ is not regular then we may call it \deffont{irregular} or just \deffont{not regular}.
\item\label{item.regular.S}
If $P\subseteq\ns P$ and every $p\in P$ is regular/weakly regular/quasiregular/irregular then we may call $P$ \deffont{regular/weakly regular/quasiregular/irregular} respectively (see also Definition~\ref{defn.conflicted}(2)).
\qedhere\end{enumerate*}
\end{defn}

\begin{rmrk}
Note of Definition~\ref{defn.tn}(\ref{item.tn}) that $\community(p)$ the community of $p$ is always an open set by Lemma~\ref{lemm.interior.open}, however:
\begin{itemize*}
\item
$\community(p)$ might be empty: see any $x\in\mathbb R$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}).
If the community is not empty, then $p$ is quasiregular.
\item
$\community(p)$ need not contain $p$: see point $0$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b}).
If the community does contain $p$ then $p$ is weakly regular.
\item
$\community(p)$ need not be topen: see point $1$ in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012}).
If the community is topen and it contains $p$, then $p$ is regular.
\end{itemize*}
\end{rmrk}


\begin{rmrk}
Our development will mostly be concerned with regular and weakly regular points.
The property of being quasiregular is also interesting and will also turn up, though less often.

Lemma~\ref{lemm.wr.r} gives an initial overview of the relationships between these properties.
A more detailed treatment follows, which repeats these main points and expands on them and puts them in a detailed context. 
\end{rmrk}



\begin{lemm}
\label{lemm.wr.r}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item\label{item.r.implies.wr}
If $p$ is regular, then $p$ is weakly regular.
\item\label{item.wr.implies.qr}
If $p$ is weakly regular, then $p$ is quasiregular.
\item\label{item.wr.r.no.converse}
The converse implications need not hold (we sharpen this result in Theorem~\ref{thrm.r=wr+uc}).
\item\label{item.wr.r.not.quasiregular}
Furthermore, it is possible for a point $p$ to not be quasiregular.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p$ is regular then by Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)\in\topens$, so certainly $p\in\community(p)$ and by Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) $p$ is weakly regular.
\item
If $p$ is weakly regular then by Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) $p\in\community(p)\in\opens$, so certainly $\community(p)\neq\varnothing$ and by Definition~\ref{defn.tn}(\ref{item.quasiregular.point}) $p$ is quasiregular.
\item
To see that the converse implications need not hold, note that:
\begin{itemize*}
\item
Point $1$ in Example~\ref{xmpl.wr}(\ref{item.wr.2}) (illustrated in Figure~\ref{fig.012}, top-left diagram) is weakly regular ($\community(1)=\{0,1,2\}$) but not regular ($\community(1)$ is open but not topen).
\item
Point $\ast$ in Example~\ref{xmpl.wr}(\ref{item.qr.2}) (illustrated in Figure~\ref{fig.012}, lower-right diagram) is quasiregular ($\community(\ast)=\{1\}$ is nonempty but does not contain $\ast$).
\end{itemize*}
\item
To see that $p$ may not even be quasiregular, take $\ns P=\mathbb R$ (real numbers), with its usual topology (which is also a semitopology).
Then $\intertwined{x}=\{x\}$ and $\community(x)=\varnothing$ for every $x\in\mathbb R$.
More on this in Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}) and the surrounding discussion.
\qedhere
\end{enumerate}
\end{proof}



\begin{xmpl}
\label{xmpl.wr}
\leavevmode
\begin{enumerate*}
\item
In Figure~\ref{fig.not-strong-topen} (left-hand diagram),\ $0$, $1$, and $2$ are three intertwined points and the entire space $\{0,1,2\}$ consists of a single topen set.
It follows that $0$, $1$, and $2$ are all regular and their community is $\{0,1,2\}$.
\item\label{item.wr.2}
In Figure~\ref{fig.012} (top-left diagram),\ $0$ and $2$ are regular and $1$ is weakly regular but not regular ($1\in\community(1)=\{0,1,2\}$ but $\{0,1,2\}$ is not topen). 
\item\label{item.qr.2}
In Figure~\ref{fig.012} (lower-right diagram),\ $0$, $1$, and $2$ are regular and $\ast$ is quasiregular ($\community(\ast)=\{1\}$).
\item
In Figure~\ref{fig.012} (top-right diagram),\ $0$ and $2$ are regular and $1$ is neither regular, weakly regular, nor quasiregular ($\community(1)=\varnothing$).
\item
In a semitopology of values $(\tf{Val},\powerset(\tf{Val}))$ (Definition~\ref{defn.value.assignment}) every value $v\in\tf{Val}$ is regular, weakly regular, and unconflicted.
\item
In $\mathbb R$ with its usual topology every point is unconflicted because the topology is Hausdorff and by Equation~\ref{eq.hausdorff} in Remark~\ref{rmrk.not.hausdorff} this means precisely that $\intertwined{p}=\{p\}$ so that is intertwined just with itself; and every point is not weakly regular because $\community(p)=\interior(\intertwined{p})=\varnothing$.
\end{enumerate*} 
\end{xmpl}

\begin{xmpl}
When we started looking at semitopologies we gave some examples in Example~\ref{xmpl.semitopologies}.
These may seem quite elementary now, but we run through them commenting on which spaces are regular, weakly regular, or quasiregular:
\begin{enumerate}
\item
The initial semitopology is regular: it has no topen neighbourhoods, but also no points.
The final semitopology is regular: it has one topen neighbourhood, containing one point.
\item
$\mathbb B$ with the discrete semitopology, is regular.
It has two topen neighbourhoods: $\{\tbot\}$ and $\{\ttop\}$.
\item
The trivial topology is regular; it has a single topen neighbourhood that is $\ns P$ itself. 
\item
The supermajority semitopology is regular.
It has one topen neighbourhood containing all of $\ns P$.
\item
The many semitopology is regular if $\ns P$ is finite (because it is equal to the trivial semitopology), and not even quasiregular if $\ns P$ is finite, because (for infinite $\ns P$) $\intertwined{p}=\varnothing$ for every point.
For example, if $\ns P=\mathbb N$ and $p$ is even and $p'$ is odd, then $\f{evens}=\{2*n \mid n\in\mathbb N\}$ and $\f{odds}=\{2*n\plus 1 \mid n\in\mathbb N\}$ are disjoint open neighbourhoods of $p$ and $p'$ respectively.
\item
The all-but-one semitopology is regular for $\ns P$ having cardinality of $3$ or more, since all points are intertwined so there is a single topen neighbourhood which is the whole space.
If $\ns P$ has cardinality $2$ or $1$ then we have a discrete semitopology (on two points or one point) and these too are regular, with two or one topen neighbourhoods. 
\item
The more-than-one semitopology is not even quasiregular for $\ns P$ having cardinality of $4$ or more.
If $\ns P$ has cardinality $3$ then we get the left-hand topology in Figure~\ref{fig.not-strong-topen}, which is regular.
If $\ns P$ has cardinality $2$ then we get the trivial semitopology, which is regular. 
\item
Take $\ns P=\mathbb R$ (the set of real numbers) and set $O\subseteq\mathbb R$ to be open when it has the form $\rightopeninterval{0,r}$ or $\leftopeninterval{-r,0}$ for any strictly positive real number $r>0$.
The reader can check that this semitopology is regular.
\item
For the automaton example we cannot comment, because it depends on the automaton.
\end{enumerate}
\end{xmpl}

\begin{rmrk}
Definition~\ref{defn.tn} is a key definition and we pause to discuss it:
\begin{enumerate}
\item
We can ask:
\begin{itemize*}
\item
It it always the case that the community of $p$ exists? 
\emph{(Yes)}
\item
Is the community of $p$ always open?
\emph{(Yes)}
\item
Is it always topen?  
\emph{(No)}
\item
Is it always an open (or a topen) neighbourhood for $p$?
\emph{(No)}
\item
Is it always nonempty?
\emph{(No)}
\end{itemize*}
A wealth of behaviour is possible and is explored below, including in Lemma~\ref{lemm.two.intertwined} and in the examples in Subsection~\ref{subsect.irregular}.
\item
Why is it interesting to consider $p$ such that $p\in\community(p)$?
Clearly calling $p$ `regular' suggests that non-regular behaviour is `bad', and regular behaviour is `good'.
But what is this good behaviour that regularity implies? 
Theorem~\ref{thrm.correlated} (continuous value assignments are constant on topens) tells us that a regular $p$ is surrounded by a topen neighbourhood of points $\community(p)=\interior(\intertwined{p})$ that must agree with it under continuous value assignments.
Using our terminology \emph{community} and \emph{regular}, we can says that \emph{the community of a regular $p$ shares its values}.
\item
We can sum up the above intuitively as follows: 
\begin{enumerate*}
\item
We care about transitivity because it implies agreement.
\item
We care about being open, because it implies actionability. 
\item
Thus, a regular point is interesting because it is a participant in a maximal topen neighbourhood and therefore can \emph{i)} come to agreement and \emph{ii)} take action on that agreement. 
\end{enumerate*}
\item
A mathematical question then arises: how can the community of $p$ can be (semi)topologically characterised?
We will explore this theme, notably in Theorem~\ref{thrm.max.cc.char}, Proposition~\ref{prop.views.of.regularity}, and Theorem~\ref{thrm.up.down.char}; see also Remark~\ref{rmrk.arc}.
\end{enumerate}
\end{rmrk} 

\subsection{Further exploration of (quasi-/weak) regularity and topen sets}

\begin{rmrk}
\label{rmrk.T0-T2}
Recall three common separation axioms from topology:
\begin{enumerate*}
\item
$T_0$: if $p_1\neq p_2$ then there exists some $O\in\opens$ such that $(p_1\in O)\xor (p_2\in O)$, where $\xor$ denotes \emph{exclusive or}.
\item
$T_1$: if $p_1\neq p_2$ then there exist $O_1,O_2\in\opens$ such that $p_i\in O_j \liff i=j$ for $i,j\in\{1,2\}$.
\item
$T_2$, or the \emph{Hausdorff condition}: if $p_1\neq p_2$ then there exist $O_1,O_2\in\opens$ such that $p_i\in O_j \liff i=j$ for $i,j\in\{1,2\}$, and $O_1\cap O_2=\varnothing$.
Cf. the discussion in Remark~\ref{rmrk.not.hausdorff}.
\end{enumerate*}
Even the weakest of the well-behavedness property for semitopologies that we consider in Definition~\ref{defn.tn} --- quasiregularity --- is in some sense strongly opposed to the space being Hausdorff/$T_2$ (though not to being $T_1$), as Lemma~\ref{lemm.quasiregular.hausdorff} makes formal.
\end{rmrk}


\begin{lemm}
\label{lemm.quasiregular.hausdorff}
\leavevmode
\begin{enumerate*}
\item
Every quasiregular Hausdorff semitopology is discrete.

In more detail: if $(\ns P,\opens)$ is a semitopology that is quasiregular (Definition~\ref{defn.tn}(\ref{item.quasiregular.point})) and Hausdorff (equation~\ref{eq.hausdorff} in Remark~\ref{rmrk.not.hausdorff}), then $\opens=\powerset(\ns P)$. 
\item
There exists a (quasi)regular $T_1$ semitopology that is not discrete.
\end{enumerate*} 
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
By the Hausdorff property, $\intertwined{p}=\{p\}$.
By the quasiregularity property, $\community(p)\neq\varnothing$.
It follows that $\community(p)=\{p\}$.
But by construction in Definition~\ref{defn.tn}(\ref{item.tn}), $\community(p)$ is an open interior.
Thus $\{p\}\in\opens$.
The result follows.
\item
It suffices to provide an example.
We use the left-hand semitopology in Figure~\ref{fig.not-strong-topen}.
Thus $\ns P=\{0,1,2\}$ and $\opens$ is generated by $\{0,1\}$, $\{1,2\}$, and $\{2,0\}$.
The reader can check that this is regular (since all three points are intertwined) and $T_1$. 
\qedhere\end{enumerate}
\end{proof}
 
Lemma~\ref{lemm.two.intertwined} confirms in a different way that regularity (Definition~\ref{defn.tn}(\ref{item.regular.point})) is non-trivially distinct from weak regularity and quasiregularity:
\begin{lemm}
\label{lemm.two.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\community(p)\in\opens$.
\item
$\community(p)$ is not necessarily topen; equivalently $\community(p)$ is not necessarily transitive.
(More on this later in Subsection~\ref{subsect.irregular}.)
\end{enumerate*}
\end{lemm}
\begin{proof}
$\community(p)$ is open by construction in Definition~\ref{defn.tn}(\ref{item.tn}), since it is an open interior.

For part~2, it suffices to provide a counterexample.
We consider the semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, top-left diagram). 
We calculate that $\community(1)=\{0,1,2\}$ so that $\community(1)$ is an open neighbourhood of $1$ --- but it is not transitive, and thus not topen, since $\{0\}\cap\{2\}=\varnothing$.

Further checking reveals that $\{0\}$ and $\{2\}$ are two maximal topens within $\community(1)$. 
\end{proof}


So what is $\community(p)$?
We start by characterising $\community(p)$ as the \emph{greatest} topen neighbourhood of $p$, if this exists:
\begin{lemm}
\label{lemm.intertwined.is.the.greatest}
\label{lemm.max.cc.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and recall from Definition~\ref{defn.tn}(\ref{item.regular.point}) that $p$ is regular when $\community(p)$ is a topen neighbourhood of $p$.
\begin{enumerate*}
\item
If $\community(p)$ is a topen neighbourhood of $p$ (i.e. if $p$ is regular) then $\community(p)$ is a maximal topen.
\item
If $p\in \atopen\in\topens$ is a maximal topen neighbourhood of $p$ then $\atopen=\community(p)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Since $p$ is regular, by definition, $\community(p)$ is topen and is a neighbourhood of $p$.
It remains to show that $\community(p)$ is a maximal topen.

Suppose $\atopen$ is a topen neighbourhood of $p$; we wish to prove $\atopen\subseteq \community(p)=\interior(\intertwined{p})$.
Since $\atopen$ is open it would suffice to show that $\atopen\subseteq\intertwined{p}$.
By Theorem~\ref{thrm.cc.char} $p\intertwinedwith p'$ for every $p'\in \atopen$, and it follows immediately that $\atopen\subseteq\intertwined{p}$.
\item
Suppose $\atopen$ is a maximal topen neighbourhood of $p$.

First, note that $\atopen$ is open, and by Theorem~\ref{thrm.cc.char} $\atopen\subseteq\intertwined{p}$, so $\atopen\subseteq\community(p)$.

Now consider any open $O\subseteq\intertwined{p}$.
Note that $\atopen\cup O$ is an open subset of $\intertwined{p}$, so by Theorem~\ref{thrm.cc.char} $\atopen\cup O$ is topen, and by maximality $\atopen\cup O\subseteq \atopen$ and thus $O\subseteq \atopen$.
It follows that $\community(p)\subseteq \atopen$.
\qedhere\end{enumerate}
\end{proof}




\begin{rmrk}
\label{rmrk.how.regularity}
We can use Lemma~\ref{lemm.max.cc.intertwined} to characterise regularity in five equivalent ways: see Theorem~\ref{thrm.max.cc.char} and Corollary~\ref{corr.regular.is.regular}.
Other characterisations will follow but will require additional machinery to state (the notion of \emph{closed neighbourhood}; see Definition~\ref{defn.cn}).
See Corollary~\ref{corr.corr.pKp} and Theorem~\ref{thrm.up.down.char} .
\end{rmrk}


\begin{thrm}
\label{thrm.max.cc.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in \ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item\label{char.p.regular}
$p$ is regular, or in full: $p\in\community(p)\in\tf{Topen}$.
\item\label{char.Kp.greatest.topen}
$\community(p)$ is a greatest topen neighbourhood of $p$.
\item\label{char.Kp.max.topen}
$\community(p)$ is a maximal topen neighbourhood of $p$.
\item\label{char.max.topen}
$p$ has a maximal topen neighbourhood. 
\item\label{char.some.topen}
$p$ has some topen neighbourhood.
\end{enumerate*}
\end{thrm}
\begin{proof}
We prove a cycle of implications:
\begin{enumerate}
\item
If $\community(p)$ is a topen neighbourhood of $p$ then it is maximal by Lemma~\ref{lemm.intertwined.is.the.greatest}(1).
Furthermore this maximal topen neighbourhood of $p$ is necessarily greatest, since if we have two maximal topen neighbourhoods of $p$ then their union is a larger topen neighbourhood of $p$ by Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) (union of intersecting topens is topen).
\item
If $\intertwined{p}$ is a greatest topen neighbourhood of $p$, then certainly it is a maximal topen neighbourhood of $p$.
\item
If $\intertwined{p}$ is a maximal topen neighbourhood of $p$, then certainly $p$ has a maximal topen neighbourhood.
\item
If $p$ has a maximal topen neighbourhood then certainly $p$ has a topen neighbourhood.
\item
Suppose $p$ has a topen neighbourhood $\atopen$.
By Corollary~\ref{corr.max.cc} we may assume without loss of generality that $\atopen$ is a maximal topen.
We use Lemma~\ref{lemm.max.cc.intertwined}(2).
\qedhere\end{enumerate}
\end{proof}



Theorem~\ref{thrm.max.cc.char} has numerous corollaries:
\begin{corr}
\label{corr.when.singleton.topen}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $\{p\}\in\opens$.
Then $p$ is regular. 
\end{corr}
\begin{proof}
We noted in Example~\ref{xmpl.singleton.transitive}(\ref{item.singleton.transitive}) that a singleton $\{p\}$ is always transitive, so if $\{p\}$ is also open, then it is topen, so that $p$ has a topen neighbourhood and by Theorem~\ref{thrm.max.cc.char}(\ref{char.some.topen}) $p$ is topen.\footnote{%
It does not follow from $p\in\{p\}\in\topens$ that $\community(p)=\{p\}$: consider $\ns P=\{0,1\}$ and $\opens=\{\varnothing,\{0\},\{0,1\}\}$ and $p=0$; then $\{p\}\in\topens$ yet $\community(p)=\{0,1\}$.}
\end{proof}


\begin{corr}
\label{corr.regular.is.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$p$ is weakly regular and $\community(p)=\community(p')$ for every $p'\in\community(p)$.
\end{enumerate*} 
It might be useful to look at Example~\ref{xmpl.cc}(\ref{item.cc.two.regular.b}) and Figure~\ref{fig.012} (top-right diagram).
In that example the point $1$ is \emph{not} regular, and its community $\{0,1,2\}$ is not a community for $0$ or $2$.
\end{corr}
\begin{proof}
We prove two implications, using Theorem~\ref{thrm.max.cc.char}:
\begin{itemize}
\item
Suppose $p$ is regular.
By Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}) $p$ is weakly regular.
Now consider $p'\in\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is topen, so it is a topen neighbourhood of $p'$. 
By Theorem~\ref{thrm.max.cc.char} $\community(p')$ is a greatest topen neighbourhood of $p'$. 
But by Theorem~\ref{thrm.max.cc.char} $\community(p)$ is also a greatest topen neighbourhood of $p$, and $\community(p)\between\community(p')$ since they both contain $p'$.
By Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) and maximality, they are equal.
\item
Suppose $p$ is weakly regular and suppose $\community(p)=\community(p')$ for every $p'\in\community(p)$, and consider $p',p''\in\community(p)$.
Then $p'\intertwinedwith p''$ holds, since $p''\in\community(p')=\community(p)$.
By Theorem~\ref{thrm.cc.char} $\community(p)$ is topen, and by weak regularity $p\in\community(p)$, so by Theorem~\ref{thrm.max.cc.char} $p$ is regular as required. 
\qedhere\end{itemize}
\end{proof}

\begin{corr}
\label{corr.p.p'.regular.community}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
Then if $p$ is regular and $p'\in\community(p)$ then $p'$ is regular and has the same community.
\end{corr}
\begin{proof}
Suppose $p$ is regular --- so by Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)\in\topens$ --- and suppose $p'\in\community(p)$.
Then by Corollary~\ref{corr.regular.is.regular} $\community(p)=\community(p')$, so $p'\in\community(p')\in\topens$ and by Theorem~\ref{thrm.max.cc.char} $p'$ is regular. 
\end{proof}



\begin{corr}
\label{corr.max.topen.char}
Suppose $(\ns P,\opens)$ is a semitopology. 
Then the following are equivalent for $\atopen\subseteq\ns P$:
\begin{itemize*}
\item
$\atopen$ is a maximal topen.
\item
$\atopen\neq\varnothing$ and $\atopen=\community(p)$ for every $p\in \atopen$.
\end{itemize*}
\end{corr}
\begin{proof}
If $\atopen$ is a maximal topen and $p\in\atopen$ then by Theorem~\ref{thrm.max.cc.char}(\ref{char.Kp.max.topen}) $\atopen=\community(p)$.

If $\atopen\neq\varnothing$ and $\atopen=\community(p)$ for every $p\in\atopen$,
then $\community(p)=\community(p')$ for every $p'\in\community(p)$ and by Corollary~\ref{corr.regular.is.regular} $p$ is regular, so that by
Definition~\ref{defn.tn}(\ref{item.regular.point}) $\atopen=\community(p)\in\topens$ as required. 
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Intersection and partition properties of regular spaces}
\label{subsect.topen.partitions}

Proposition~\ref{prop.topen.intersect.subset} is useful for consensus in practice.
Suppose we are a regular point $q$ and we have reached consensus with some topen neighbourhood $O\ni q$.
Suppose further that our topen neighbourhood $O$ intersects with the maximal topen neighbourhood $\community(p)$ of some other regular point $p$.
Then Proposition~\ref{prop.topen.intersect.subset} tells us that were inside $\community(p)$ all along.
See also Remark~\ref{rmrk.gradecast}.
\begin{prop}
\label{prop.topen.intersect.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Suppose $O\in\topens$ is a topen.
Then 
$$
O\between\community(p)
\quad\text{if and only if}\quad
O\subseteq\community(p).
$$
\end{prop}
\begin{proof} 
The right-to-left implication is immediate from Notation~\ref{nttn.between}(\ref{item.between}), given that 
topens are nonempty by Definition~\ref{defn.transitive}(\ref{transitive.cc}).

For the left-to-right implication, suppose $O\between\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is a maximal topen, and by Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) $O\cup\community(p)$ is topen.
Then $O\subseteq\community(p)$ follows by maximality.
\end{proof}

\begin{prop}
\label{prop.community.partition}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p,p'\in\ns P$ are regular.
Then
$$
\community(p)\between\community(p')
\quad\liff\quad
\community(p)=\community(p')
$$
(See also Corollary~\ref{corr.community.intersects.community}, which considers similar properties for $p$ and $p'$ that are not necessarily regular.)
\end{prop}
\begin{proof}
We prove two implications.
\begin{itemize}
\item
Suppose there exists $p''\in\community(p)\cap\community(p')$.
By Corollary~\ref{corr.p.p'.regular.community} ($p''$ is regular and) $\community(p)=\community(p'')=\community(p')$.
\item
Suppose $\community(p)=\community(p')$.
By assumption $p\in\community(p)$, so $p\in\community(p')$.
Thus $p\in\community(p)\cap\community(p')$.
\qedhere\end{itemize}
\end{proof}


We obtain a simple characterisation of regular semitopological spaces:
\begin{corr}
\label{corr.topen.partition.char}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the following are equivalent:
\begin{enumerate*}
\item
$(\ns P,\opens)$ is regular.
\item
$\ns P$ partitions into topen sets: there exists some set of topen sets $\mathcal T$ such that $\atopen\notbetween\atopen'$ for every $\atopen,\atopen'\in\mathcal T$ and $\ns P=\bigcup\mathcal T$.
\item
Every $X\subseteq\ns P$ has a cover of topen sets: there exists some set of topen sets $\mathcal T$ such that $X\subseteq\bigcup\mathcal T$.
\end{enumerate*}
\end{corr}
\begin{proof}
The proof is routine from the machinery that we already have.
We prove equivalence of parts~1 and~2:
\begin{enumerate}
\item
Suppose $(\ns P,\opens)$ is regular, meaning by Definition~\ref{defn.tn}(\ref{item.regular.S}\&\ref{item.regular.point}) that $p\in\community(p)\in\topens$ for every $p\in\ns P$.
We set $\mathcal T=\{\community(p) \mid p\in\ns P\}$.
By assumption this covers $\ns P$ in topens, and by Proposition~\ref{prop.community.partition} the cover is a partition. 
\item
Suppose $\mathcal T$ is a topen partition of $\ns P$.
By definition for every point $p$ there exists $T\in\mathcal T$ such that $p\in T$ and so $p$ has a topen neighbourhood.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.some.topen}\&\ref{char.p.regular}) $p$ is regular.
\end{enumerate}
We prove equivalence of parts~2 and~3:
\begin{enumerate}
\item
Suppose $\mathcal T$ is a topen partition of $\ns P$, and suppose $X\subseteq\mathcal P$.
Then trivially $X\subseteq\bigcup\mathcal T$.
\item
Suppose every $X\subseteq\ns P$ has a cover of topen sets.
Then $\ns P$ has a cover of topen sets; write it $\mathcal T$.
By Lemma~\ref{lemm.cc.unions}(\ref{item.intersecting.pair.of.topens}) we may assume without loss of generality that $\mathcal T$ is a partition, and we are done.
\qedhere\end{enumerate} 
\end{proof}


\begin{nttn}
Call a semitopology $(\ns P,\opens)$ \deffont{singular} when it contains a single maximal topen subset. 
\end{nttn}


\begin{rmrk}
\label{rmrk.the.moral}
The moral we take from the results and examples above (and those to follow) is that the world we are entering has rather different well-behavedness criteria than those familiar from the study of typical Hausdorff topologies like $\mathbb R$.
Put crudely: 
\begin{enumerate*}
\item
`Bad' spaces are spaces that are not regular.

$\mathbb R$ with its usual topology (which is also a semitopology) is an example of a `bad' semitopology; it is not even quasiregular.
\item
`Good' spaces are spaces that are regular.

The supermajority and all-but-one semitopologies from Example~\ref{xmpl.semitopologies}(\ref{item.supermajority}\&\ref{item.counterexample.X-x}) are typical examples of `good' semitopologies; both are singular regular spaces.
\item
Corollary~\ref{corr.topen.partition.char} shows that the `good' spaces are just the (disjoint, possibly infinite) unions of singular regular spaces.
\end{enumerate*}
So to sum this up: modulo disjoint unions, the study of successful distributed collaboration is the study of semitopological spaces that consist of a single topen set of points that are all intertwined with one another. 
\end{rmrk}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Examples of communities and (ir)regular points}
\label{subsect.irregular}


By Definition~\ref{defn.tn} a point $p$ is regular when its community is a topen neighbourhood.
Then a point is \emph{not} regular when its community is \emph{not} a topen neighbourhood of $p$. 
We saw one example of this in Lemma~\ref{lemm.two.intertwined}.
In this subsection we take a moment to investigate the possible behaviour in more detail. 


\begin{xmpl}
\label{xmpl.p.not.regular}
\leavevmode
\begin{enumerate}
\item\label{item.p.not.regular.R}
Take $\ns P$ to be $\mathbb R$ the real numbers, with its usual topology (which is also a semitopology).
Then
$\intertwined{x}=\{x\}$ and $\community(x)=\varnothing$ for every $x\in\mathbb R$.

In particular, no $x\in\mathbb R$ is regular.
\item\label{item.p.not.regular.012}
We continue the semitopology from Example~\ref{xmpl.cc}(\ref{item.cc.two.regular}) (illustrated in Figure~\ref{fig.012}, top-left diagram), as used in Lemma~\ref{lemm.two.intertwined}:
\begin{itemize*}
\item
$\ns P=\{0,1,2\}$.
\item
$\opens$ is generated by $\{0\}$ and $\{2\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1\}$ and $\community(0)=\interior(\intertwined{0})=\{0\}$. 
\item
$\intertwined{2}=\{1,2\}$ and $\community(2)=\interior(\intertwined{2})=\{2\}$. 
\item
$\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,1,2\}$. 
\end{itemize*}
\item\label{item.point.not.regular.but.community.is.topen}\label{item.p.not.regular.01234}
We take, as illustrated in Figure~\ref{fig.irregular} (left-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{1,2\}$ for $x\in\{0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\end{itemize*}
(We return to this example in Example~\ref{xmpl.p.not.regular.2}(\ref{item.p.not.regular.01234.2}), and we will also use it in the proof of Lemma~\ref{lemm.kernel.non-implications}.)
\item\label{item.p.not.regular.01234b}
We take, as illustrated in Figure~\ref{fig.irregular} (right-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1\}$, $\{2\}$, $\{3\}$, $\{4\}$, $\{0, 1, 2, 3\}$, and $\{0, 1, 2, 4\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1,2\}$ and $\community(0)=\{1,2\}$.
\item
$\community(0)$ is not transitive and consists of two distinct topens $\{1\}$ and $\{2\}$.
\item
$0\not\in\community(0)$. 
\end{itemize*}
See Remark~\ref{rmrk.indeed.two.closed.neighbourhoods} for further discussion of this example.
\item
The reader can also look ahead to Example~\ref{xmpl.two.topen.examples}.
In Example~\ref{xmpl.two.topen.examples}(1), every point $p$ is regular and $\community(p)=\mathbb Q^2$.
In Example~\ref{xmpl.two.topen.examples}(2), no point $p$ is regular and $\community(p)=\varnothing\subseteq\mathbb Q^2$.
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample.pdf}
\includegraphics[width=0.31\columnwidth]{diagrams/universal_example.pdf}
\vspace{-0em}
\caption{Illustration of Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}\&\ref{item.p.not.regular.01234b})}
\label{fig.irregular}
\end{figure}


\begin{lemm}
\label{lemm.p.not.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then precisely one of the following possibilities must hold, and each is possible: 
\begin{enumerate}
\item
$p$ is regular: $p\in\community(p)$ and $\community(p)$ is topen (nonempty, open, and transitive). 
\item
$\community(p)$ is topen, but $p\not\in\community(p)$. 
\item
$\community(p)=\varnothing$.
\item
$\community(p)$ is open but not transitive.
(Both $p\in\community(p)$ and $p\not\in\community(p)$ are possible.)
\end{enumerate}
\end{lemm}
\begin{proof} 
\leavevmode\begin{enumerate}
\item
To see that $p$ can be regular, consider $\ns P=\{0\}$ with the discrete topology.
Then $p\in\community(p)=\{0\}$.
\item
To see that it is possible for $\community(p)$ to be topen but $p$ is not in it, consider Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}).
There, $\ns P=\{0,1,2,3,4\}$ and $\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,2\}$.
Then $\community(1)$ is topen, but $1\not\in\community(1)$.
\item
To see that $\community(p)=\varnothing$ is possible, consider Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}) (the real numbers $\mathbb R$ with its usual topology).
Then by Remark~\ref{rmrk.not.hausdorff} $\intertwined{r}=\{r\}$ and so $\community(x)=\interior(\{r\})=\varnothing$.
(See also Example~\ref{xmpl.two.topen.examples}(2) for a more elaborate example.) 
\item
To see that it is possible for $\community(p)$ to be an open neighbourhood of $p$ but not transitive, see Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012}).
There, $\ns P=\{0,1,2\}$ and $1\in \intertwined{1}=\{0,1,2\}=\community(1)$, but $\{0,1,2\}$ is not transitive (it contains two disjoint topens: $\{0\}$ and $\{2\}$).

To see that it is possible for $\community(p)$ to be open and nonempty yet not contain $p$ and not be transitive, see Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b}) for $p=0$, and see also Remark~\ref{rmrk.indeed.two.closed.neighbourhoods} for a discussion of the connection with minimal closed neighbourhoods.
\end{enumerate}
The possibilities above are clearly mutually exclusive and exhaustive.
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Closed sets}
\label{sect.closed.sets}

\subsection{Closed sets}
\label{subsect.closed.sets.basics}


\begin{rmrk}
\label{rmrk.computing.closures}
In Subsection~\ref{subsect.closed.sets.basics} we check that some familiar properties of closures carry over from topologies to semitopologies.
There are no technical surprises, but this in itself is a mathematical result that needs checked. 
From Subsection~\ref{subsect.trans.clos} and the following Subsections we will study the close relation between closures and sets of intertwined points. 

First, we spare a few words on why closures are particularly interesting in semitopologies:
\begin{enumerate*}
\item
A participant may wish to compute a quorum that it can be confident of remaining in agreement with, where algorithms succeed.
The notion of maximal topen from Definition~\ref{defn.transitive}(\ref{transitive.max.cc}) provides this, as discussed in Remark~\ref{rmrk.transitive.correlated} --- but computing maximal topens is hard since the definition involves quantifications over all open sets and there may be many of them.
\item
However, computing \emph{closures} is quite tractable in the right circumstances (see Section~\ref{sect.witness} and Remark~\ref{rmrk.computing.closed.sets}), so a characterisation of maximal topens using closed sets and closures is of practical interest.
\item
Closures are significant for other reasons too: see the discussions in Remarks~\ref{rmrk.fundamental.consensus} and~\ref{rmrk.why.top.closure}, and see the later material in Section~\ref{sect.dense} that considers \emph{dense sets}.
\end{enumerate*}
Thus, and just as is the case in topology, closures are an interesting object of study. 
\end{rmrk}


\begin{defn}
\label{defn.closure}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ and $P\subseteq\ns P$.
Then:
\begin{enumerate*}
\item\label{item.closure}
Define $\closure{P}\subseteq\ns P$ the \deffont{closure} of $P$ to be the set of points $p$ such that every open neighbourhood of $p$ intersects $P$.
In symbols using Notation~\ref{nttn.between}: 
$$
\closure{P} = \{ p'\in\ns P \mid \Forall{O{\in}\opens} p'\in O \limp P\between O\} .
$$
\item\label{item.closure.p}
As is standard, we may write $\closure{p}$ for $\closure{\{p\}}$.
Unpacking definitions for reference:
$$
\closure{p} = \{ p'\in\ns P \mid \Forall{O{\in}\opens} p'\in O \limp p\in O\} .
$$
\end{enumerate*}
\end{defn}




\begin{lemm}
\label{lemm.closure.monotone}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P,P'\subseteq\ns P$.
Then taking the closure of a set is: 
\begin{enumerate*}
\item\label{closure.monotone}
\emph{Monotone:}\quad If $P\subseteq P'$ then $\closure{P}\subseteq\closure{P'}$.
\item\label{closure.increasing}
\emph{Increasing:}\quad $P\subseteq\closure{P}$.
\item\label{closure.idempotent}
\emph{Idempotent:}\quad $\closure{P}=\closure{\closure{P}}$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By routine calculations from Definition~\ref{defn.closure}.
\end{proof}

\begin{lemm}
\label{lemm.closure.open.char}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$ and $O\in\opens$.
Then 
$$
P\between O
\quad\text{if and only if}\quad 
\closure{P}\between O.
$$
\end{lemm}
\begin{proof}
Suppose $P\between O$.
Then $\closure{P}\between O$ using Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}).

Suppose $\closure{P}\between O$.
Pick $p\in \closure{P}\cap O$.
By construction of $\closure{P}$ in Definition~\ref{defn.closure} $p\in O\limp P\between O$.
It follows that $P\between O$ as required.
\end{proof}


\begin{defn}
\label{defn.closed}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $C\subseteq\ns P$.
\begin{enumerate*}
\item\label{item.closed.set}
Call $C$ \deffont{closed} when $C=\closure{C}$.
\item
Call $C$ \deffont{clopen} when $C$ is closed and open.
\item
Write $\closed$ for the \deffont{set of closed sets} (as we wrote $\opens$ for the open sets; the ambient semitopology will always be clear or understood).
\end{enumerate*}
\end{defn}

\begin{lemm}
\label{lemm.closure.closed}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $S\subseteq\ns P$.
Then $\closure{S}$ is closed and contains $S$.
In symbols:
$$
S\subseteq \closure{S}\in\closed .
$$ 
\end{lemm}
\begin{proof}
From Definition~\ref{defn.closed}(1) and Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing} \& \ref{closure.idempotent}).
\end{proof}

\begin{xmpl}\leavevmode
\begin{enumerate}
\item
Take $\ns P=\{0,1\}$ and $\opens=\{\varnothing, \{0\}, \{0,1\}\}$.
Then the reader can verify that:
\begin{itemize*}
\item
$\{0\}$ is open.
\item
The closure of $\{1\}$ is $\{1\}$ and $\{1\}$ is closed.
\item
The closure of $\{0\}$ is $\{0,1\}$.
\item
$\varnothing$ and $\{0,1\}$ are the only clopen sets.
\end{itemize*}
\item
Now take $\ns P=\{0,1\}$ and $\opens=\{\varnothing, \{0\}, \{1\}, \{0,1\}\}$.\footnote{Following Definition~\ref{defn.value.assignment} and Example~\ref{xmpl.semitopologies}(\ref{item.boolean.discrete}), this is just $\{0,1\}$ with the \emph{discrete semitopology}.}
Then the reader can verify that:
\begin{itemize*}
\item
Every set is clopen.
\item
The closure of every set is itself.
\end{itemize*}
\end{enumerate}
\end{xmpl}

\begin{rmrk}
There are two standard definitions for when a set is closed: when it is equal to its closure (as per Definition~\ref{defn.closed}(1)), and when it is the complement of an open set.
In topology these are equivalent.
We do need to check that the same holds in semitopology, but as it turns out the proof is routine:
\end{rmrk}

\begin{lemm}
\label{lemm.closed.complement.open}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
Suppose $C\in\closed$ is closed (by Definition~\ref{defn.closed}: $C=\closure{C}$).
Then $\ns P\setminus C$ is open.
\item
Suppose $O\in\opens$ is open.
Then $\ns P\setminus O$ is closed (by Definition~\ref{defn.closed}: $\closure{\ns P\setminus O}=\ns P\setminus O$).
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $p\in \ns P\setminus C$.
Since $C=\closure{C}$, we have $p\in\ns P\setminus\closure{C}$.
Unpacking Definition~\ref{defn.closure}, this means precisely that there exists $O_p\in\opens$ with $p\in O_p \notbetween C$.
We use Lemma~\ref{lemm.open.is.open}. 
\item
Suppose $O\in\opens$.
Combining Lemma~\ref{lemm.open.is.open} with Definition~\ref{defn.closure} 
it follows that $O\notbetween \closure{\ns P\setminus O}$ so that $\closure{\ns P\setminus O}\subseteq\ns P\setminus O$.
Furthermore, by Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}) $\ns P\setminus O\subseteq\closure{\ns P\setminus O}$.
\qedhere\end{enumerate}
\end{proof}


\begin{corr}
\label{corr.closed.complement.union}
If $C\in\closed$ then $\ns P\setminus C=\bigcup_{O\in\opens} O\notbetween C$.
\end{corr}
\begin{proof}
By Lemma~\ref{lemm.closed.complement.open}(1) $\ns P\setminus C\subseteq\bigcup_{O\in\opens} O\notbetween C$.
Conversely, if $O\notbetween C$ then $O\subseteq\ns P\setminus C$ by Definition~\ref{defn.closure}(\ref{item.closure}). 
\end{proof}


\begin{corr}
\label{corr.closure.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$ and $\mathcal C\subseteq\powerset(\ns P)$.
Then:
\begin{enumerate*}
\item
$\varnothing$ and $\ns P$ are closed.
\item\label{closure.closure.cap}
If every $C\in\mathcal C$ is closed, then $\bigcap\mathcal C$ is closed.
Or succinctly in symbols:
$$
\mathcal C\subseteq\closed \limp \bigcap\mathcal C\in\closed .
$$
\item\label{item.closure.as.intersection}
$\closure{P}$ is equal to the intersection of all the closed sets that contain it.
In symbols:
$$
\closure{P}=\bigcap\{C\in\closed \mid P\subseteq C\}. 
$$
\end{enumerate*}
\end{corr}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Immediate from Lemma~\ref{lemm.closed.complement.open}(2).
\item
From Lemma~\ref{lemm.closed.complement.open} and Definition~\ref{defn.semitopology}(1\&2).
\item
By Lemma~\ref{lemm.closure.closed} $\bigcap\{C\in\closed \mid P\subseteq C\}\subseteq\closure{P}$.
By construction $P\subseteq\bigcap\{C\in\closed \mid P\subseteq C\}$, and using Lemma~\ref{lemm.closure.monotone}(\ref{closure.monotone}) and part~2 of this result we have
$$
\closure{P} 
\stackrel{L\ref{lemm.closure.monotone}(\ref{closure.monotone})}\subseteq 
\closure{\bigcap\{C\in\closed \mid P\subseteq C\}} 
\stackrel{pt.2}= 
\bigcap\{C\in\closed \mid P\subseteq C\} .
$$ 
\qedhere\end{enumerate}
\end{proof}

The usual characterisation of continuity in terms of inverse images of closed sets being closed, remains valid:
\begin{corr}
\label{corr.alternative.cont.closed}
Suppose $(\ns P,\opens)$ and $(\ns P',\opens')$ are semitopological spaces (Definition~\ref{defn.semitopology}) and suppose $\avaluation:\ns P\to\ns P'$ is a function.
Then the following are equivalent:
\begin{enumerate*}
\item
$\avaluation$ is continuous, meaning by Definition~\ref{defn.continuity}(\ref{item.continuous.function}) that $\avaluation^\mone(O')\in\opens$ for every $O'\in\opens'$.
\item
$\avaluation^\mone(C')\in\closed$ for every $C'\in\closed'$.
\end{enumerate*}
\end{corr}
\begin{proof}
By routine calculations as for topologies, using Lemma~\ref{lemm.closed.complement.open} and the fact that the inverse image of a complement is the complement of the inverse image; see~\cite[Theorem~7.2, page~44]{willard:gent} or~\cite[Proposition~1.4.1(iv), page~28]{engelking:gent}.
\end{proof}


\subsection{Duality between closure and interior}

The usual dualities between closures and interiors remain valid in semitopologies.
There are no surprises but this still needs checked so we spell out the details:
\begin{lemm}
\label{lemm.closure.interior}
Suppose $(\ns P,\opens)$ is a semitopology and $O\in\opens$ and $C\in\closed$.
Then:
\begin{enumerate*}
\item\label{item.closure.interior.open}
$O\subseteq\interior(\closure{O})$.  The inclusion may be strict.
\item\label{item.closure.interior.closed}
$\closure{\interior(C)}\subseteq C$.  The inclusion may be strict.
\item\label{item.closure.interior.complement.closure}
$\interior(\ns P\setminus O)=\ns P\setminus\closure{O}$.
%Willard, General topology, just after Definition 3.9
\item\label{item.closure.interior.complement.interior}
$\closure{\ns P\setminus C}=\ns P\setminus\interior(C)$. 
%\cite[Theorem~1.1.5]{engelking:gent}.
\end{enumerate*}
\end{lemm}
\begin{proof}
The reasoning is just as for topologies, but we spell out the details:
\begin{enumerate}
\item
By Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}) $O\subseteq\closure{O}$.
By Corollary~\ref{corr.interior.monotone} $\interior(O)\subseteq\interior(\closure{O})$.
By Lemma~\ref{lemm.interior.open}(2) $O=\interior(O)$, so we are done.

For an example of the strict inclusion, consider $\mathbb R$ with the usual topology (which is also a semitopology) and take $O=(0,1)\cup(1,2)$.
Then $O\subsetneq\interior(\closure{O})=(0,2)$.
\item
By Lemma~\ref{lemm.interior.open}(1) $\interior(C)\subseteq C$.
By Lemma~\ref{lemm.closure.monotone}(\ref{closure.monotone}) $\closure{\interior(C)}\subseteq\closure{C}$.
By Definition~\ref{defn.closed}(\ref{item.closed.set}) (since we assumed $C\in\closed$) $\closure{C}=C$, so we are done.

For an example of the strict inclusion, consider $\mathbb R$ with the usual topology and take $C=\{0\}$.
Then $\closure{\interior(C)}=\varnothing\subsetneq C$.
\item
Consider some $p'\in\ns P$.
By Definition~\ref{defn.interior} $p'\in \interior(\ns P\setminus O)$ when there exists some $O'\in\opens$ such that $p'\in O'\notbetween O$.
By definition in Definition~\ref{defn.closure}(\ref{item.closure}) this happens precisely when $p'\not\in\closure{O}$. 
\item
By Definition~\ref{defn.closure}(\ref{item.closure}), $p'\not\in \closure{\ns P\setminus C}$ precisely when there exists some $O'\in\opens$ such that $p'\in O'\notbetween \ns P\setminus C$.
By facts of sets this means precisely that $p'\in O'\subseteq C$.
By Definition~\ref{defn.interior} this means precisely that $p'\in\interior(C)$.
\qedhere\end{enumerate}
\end{proof}


\begin{corr}
\label{corr.ic.ci}
Suppose $(\ns P,\opens)$ is a semitopology and $O\in\opens$ and $C\in\closed$.
Then:
\begin{enumerate*}
\item
$\closure{O} = \closure{\interior(\closure{O})}$. 
\item
$\interior(C)=\interior(\closure{\interior(C)})$.
\end{enumerate*}
\end{corr}
\begin{proof}
We use Lemma~\ref{lemm.closure.interior}(\ref{item.closure.interior.open}\&\ref{item.closure.interior.complement.closure}) along with Lemma~\ref{lemm.closure.monotone}(\ref{closure.monotone}) and Corollary~\ref{corr.interior.monotone}: 
$$
\begin{array}{r@{\ }c@{\ }c@{\ }c@{\ }ll}
\closure{O}
&\stackrel{L\ref{lemm.closure.interior}(\ref{item.closure.interior.open})}\subseteq&
\closure{\interior(\closure{O})}
&\stackrel{L\ref{lemm.closure.interior}(\ref{item.closure.interior.closed})}\subseteq&
\interior(\closure{O})
\\
\interior(C)
&\stackrel{L\ref{lemm.closure.interior}(\ref{item.closure.interior.open})}\subseteq&
\interior(\closure{\interior(C)})
&\stackrel{L\ref{lemm.closure.interior}(\ref{item.closure.interior.closed})\&C\ref{corr.interior.monotone}}\subseteq&
\interior(C)
\end{array}
$$
\end{proof}



\subsection{Transitivity and closure}
\label{subsect.trans.clos}

We explore how the topological closure operation interacts with taking transitive sets.
\begin{lemm}
\label{lemm.open.consensus}
Suppose $(\ns P,\opens)$ is a semitopology and $T\subseteq\ns P$ is transitive and $O\in\opens$.
Then 
$$
\atopen\between O
\quad\text{implies}\quad
\closure{T}\subseteq\closure{O}.
$$
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.closure}
we have:
$$
\begin{array}{r@{\ }l}
p'\in\closure{T}\liff&\Forall{O'{\in}\opens}p'\in O'\limp O'\between \atopen 
\qquad\text{and}
\\
p'\in\closure{O}\liff&\Forall{O'{\in}\opens}p'\in O'\limp O'\between O
.
\end{array}
$$
It would suffice to prove $O'\between \atopen\limp O'\between O$ for any $O'\in\opens$.

So suppose $O'\between \atopen$.
By assumption $\atopen\between O$ and by transitivity of $\atopen$ (Definition~\ref{defn.transitive}) $O'\between O$.
\end{proof}


\begin{prop}
\label{prop.open.consensus}
\label{prop.open.strong-consensus}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\in\topens$ and $O\in\opens$.
Then the following are equivalent:
$$
\atopen\between O
\quad\text{if and only if}\quad
\atopen\subseteq\closure{\atopen}\subseteq \closure{O}
.
$$
\end{prop}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
Suppose $\atopen\between O$.
By Lemma~\ref{lemm.open.consensus} $\closure{\atopen}\subseteq\closure{O}$.
By Lemma~\ref{lemm.closure.monotone}(\ref{closure.increasing}) (as standard) $\atopen\subseteq\closure{\atopen}$. 
\item
Suppose $\atopen\subseteq\closure{\atopen}\subseteq\closure{O}$.
Then $\atopen\between\closure{O}$ and by Lemma~\ref{lemm.closure.open.char} (since $\atopen$ is nonempty (and transitive) and open) also $\atopen\between O$.
\qedhere\end{itemize}
\end{proof}


\begin{rmrk}
\label{rmrk.gradecast}
In retrospect we can see the imprint of topens (Definition~\ref{defn.transitive}) in previous work, if we look at things in a certain way.
Many consensus algorithms have the property that once consensus is established in a quorum $O$, it propagates to $\closure{O}$.

This is apparent (for example) in the Grade-Cast algorithm~\cite{feldman_optimal_1988}, in which participants assign a confidence grade of 0, 1 or 2 to their output and must ensure that if any participant outputs $v$ with grade 2 then all must output $v$ with grade at least 1.
In this algorithm, if a participant finds that all its quorums intersect some set $S$ that unanimously supports value $v$, then the participant assigns grade at least 1 to $v$.
From the view of our paper, this is just taking a closure in the style we discussed in Remark~\ref{rmrk.computing.closures}.
If $T$ unanimously supports $v$ and participants communicate enough, then eventually every member of $\closure{T}$ assigns grade at least 1 to $v$.
Thus, Proposition~\ref{prop.open.strong-consensus} suggests that, to convince a topen to agree on a value, we can first convince an open neighbourhood that intersects the topen, and then use Grade-Cast to convince the closure of that open set and thus in particular the topen which we know must be contained in that closure. 
\end{rmrk}


\begin{rmrk}
Later on we will revisit these ideas and fit them into a nice general framework having to do with dense subsets.
See Lemma~\ref{lemm.strongly.dense.for.closure} and Proposition~\ref{prop.most.general}. 
\end{rmrk}

\subsection{Closed neighbourhoods and intertwined points}
\label{subsect.closed.neighbourhoods}

\subsubsection{Definition and basic properties}


\begin{defn}
\label{defn.cn}
Suppose $(\ns P,\opens)$ is a semitopology.
We generalise Definition~\ref{defn.open.neighbourhood} as follows:
\begin{enumerate*}
\item\label{item.neighbourhood.of.p}
Call $P\subseteq\ns P$ a \deffont{neighbourhood} when it contains an open set (i.e. when $\interior(P)\neq\varnothing$), and call $P$ a \deffont{neighbourhood of $p$} when $p\in\ns P$ and $P$ contains an open neighbourhood of $p$ (i.e. when $p\in\interior(P)$).
In particular:
\item\label{item.closed.neighbourhood.of.p}
$C\subseteq\ns P$ is a \deffont{closed neighbourhood of $p\in\ns P$} when $C$ is closed and $p\in\interior(C)$.
\item\label{item.closed.neighbourhood}
$C\subseteq\ns P$ is a \deffont{closed neighbourhood} when $C$ is closed and $\interior(C)\neq\varnothing$.
\end{enumerate*} 
\end{defn}

\begin{rmrk}
\leavevmode
\begin{enumerate}
\item
If $C$ is a closed neighbourhood of $p$ in the sense of Definition~\ref{defn.cn}(\ref{item.closed.neighbourhood.of.p}) then $C$ is a closed neighbourhood in the sense of Definition~\ref{defn.cn}(\ref{item.closed.neighbourhood}), just because if $p\in\interior(C)$ then $\interior(C)\neq\varnothing$. 
\item
For $C$ to be a closed neighbourhood of $p$ it is not enough for $p\in C$.
We require $p\in\interior(C)$, which is a stronger condition.

For instance take the semitopology $\ns P=\{0,1,2\}$ and $\opens=\{\varnothing,\ns P,\{0\}, \{2\}\}$ from Figure~\ref{fig.012} (top-left diagram), and consider $p=1$ and $C=\{0,1\}$.
Then $p\in C$ but $p\not\in\interior(C)=\{0\}$, so that $C$ is not a closed neighbourhood of $p$. 
\end{enumerate}
\end{rmrk}




Recall from Definition~\ref{defn.intertwined.points} the notions of $p\intertwinedwith p'$ and $\intertwined{p}$.
Proposition~\ref{prop.intertwined.as.closure} packages up our material for convenient use in later results. 
\begin{prop}
\label{prop.intertwined.as.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
Then:
\begin{enumerate*}
\item
We can characterise when $p'$ is intertwined with $p$ as follows: 
$$
p\intertwinedwith p' 
\quad\text{if and only if}\quad
\Forall{O{\in}\opens} p\in O\limp p'\in\closure{O} .
$$
\item\label{item.intertwined.as.intersection.of.closures}
As a corollary,
$$
\intertwined{p} = \bigcap\{\closure{O} \mid p\in O\in\opens\}.
$$
\item\label{intertwined.as.closure.closed}
Equivalently:
$$
\begin{array}{r@{\ }l@{\qquad}l}
\intertwined{p}
=& \bigcap\{C\in\closed \mid p\in \interior(C) \}
\\
=&
\bigcap\{C\in\tf{Closed} \mid C\text{ a closed neighbourhood of }p\}
&\text{Definition~\ref{defn.cn}}.
\end{array}
$$
Thus in particular, if $C$ is a closed neighbourhood of $p$ then $\intertwined{p}\subseteq C$.
\item\label{intertwined.p.closed}
$\intertwined{p}$ is closed and (by Lemma~\ref{lemm.closed.complement.open}(1)) $\ns P\setminus\intertwined{p}$ is open.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We just rearrange Definition~\ref{defn.intertwined.points}.
So\footnote{The proof relies on pushing around bracketed scopes, so we bracket everywhere for extra clarity.}
$$
\Forall{O,O'\in\opens}((p\in O\land p'\in O') \limp O\between O')
$$
rearranges to
$$
\Forall{O\in\opens}(p\in O\limp \Forall{O'\in\opens} (p'\in O' \limp O\between O')) . 
$$
We now observe from Definition~\ref{defn.closure} that this is precisely
$$
\Forall{O\in\opens}(p\in O\limp p'\in\closure{O}).
$$
\item
We just rephrase part~1 of this result.
\item
Using part~\ref{item.intertwined.as.intersection.of.closures} of this result it would suffice to prove
$$
\bigcap\{\closure{O}\mid p\in O\in\opens\} = \bigcap\{C\in\closed \mid p\in \interior(C) \} .
$$
We will do this by proving that for each $O$-component on the left there is a $C$ on the right with $C\subseteq\closure{O}$; and for each $C$-component on the right there is an $O$ on the left with $\closure{O}\subseteq C$:
\begin{itemize}
\item
Consider some $O\in\opens$ with $p\in O$.

We set $C=\closure{O}$, so that trivially $C\subseteq\closure{O}$.
By Lemma~\ref{lemm.closure.interior}(1) $O\subseteq\interior(\closure{O})$, so $p\in\interior(C)$.
\item
Consider some $C\in\closed$ such that $p\in\interior(C)$.

We set $O=\interior(C)$.
Then $p\in O$, and by Lemma~\ref{lemm.closure.interior}(2) $\closure{O}\subseteq C$.
\end{itemize}
\item
We combine part~\ref{item.intertwined.as.intersection.of.closures} of this result with Corollary~\ref{corr.closure.closure}(\ref{closure.closure.cap}).
\qedhere\end{enumerate}
\end{proof}

\begin{defn}
\label{defn.nbhd.system}
\label{defn.nbhd}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
\begin{enumerate*}
\item
Write $\nbhd(p)=\{O\in\opens\mid p\in\opens\}$ and call this the \deffont{open neighbourhood system} of $p\in\ns P$. 
\item
Write $\nbhd^c(p)=\{C\in\closed\mid p\in\closed\}$ and call this the \deffont{closed neighbourhood system} of $p\in\ns P$.
\end{enumerate*}
\end{defn}



\begin{rmrk}
\label{rmrk.nbhd.filter}
If $(\ns P,\opens)$ is a topology, then $\nbhd(p)$ is a filter (a nonempty up-closed down-directed set) and this is often called the \emph{neighbourhood filter} of $p$.

We are working with semitopologies, so $\opens$ is not necessarily closed under intersections, and $\nbhd(p)$ is not necessarily a filter.
Figure~\ref{fig.nbhd} illustrates examples of this: e.g. in the left-hand example $\{0,1\},\{0,2\}\in \nbhd(0)$ but $\{0\}\not\in\nbhd(0)$ (because this is not an open set).
\end{rmrk}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[align=c,width=0.3\columnwidth,trim={50 20 50 20},clip]{diagrams/012_triangle_nbhd.pdf}
\quad
\includegraphics[align=c,width=0.3\columnwidth,trim={50 20 50 80},clip]{diagrams/012_nbhd.pdf}
\quad
\includegraphics[align=c,width=0.3\columnwidth,trim={50 20 50 20},clip]{diagrams/lower_join.pdf}
\caption{Examples of open neighbourhoods (Remark~\ref{rmrk.nbhd.filter})}
\label{fig.nbhd}
\end{figure}


\begin{rmrk}
\label{rmrk.cluster.convergence.2}
We can relate Proposition~\ref{prop.intertwined.as.closure} to concepts from topology. 
Then:
\begin{itemize*}
\item
Proposition~\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures}) identifies $\intertwined{p}$ as the the set of \deffont{cluster points} of $\nbhd(p)$; see \cite[Definition~2, page~69]{bourbaki:gent1}, \cite[page~52]{engelking:gent}, or \href{https://en.wikipedia.org/wiki/Filters_in_topology\#Cluster_point_of_a_filter}{Wikipedia} (\href{https://web.archive.org/web/20230831101457/https://en.wikipedia.org/wiki/Filters_in_topology\#Cluster_point_of_a_filter}{permalink}).
\item
Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) identifies $\intertwined{p}$ as the set of \deffont{convergence points} of $\nbhd^c(p)$.
\end{itemize*}
\end{rmrk}


\subsubsection{Application to characterise (quasi/weak) regularity}


\begin{rmrk}
\label{rmrk.how.weakly.regular}
Recall that Theorem~\ref{thrm.max.cc.char} characterised regularity in multiple ways, including as the existence of a greatest topen neighbourhood. 
Proposition~\ref{prop.views.of.regularity} below does something similar, for quasiregularity and weak regularity and the existence of closed neighbourhoods (Definition~\ref{defn.cn}), and Theorem~\ref{thrm.up.down.char} is a result in the same style, for regularity.

Here, for the reader's convenience, is a summary of the relevant results:
\begin{enumerate*}
\item
Proposition~\ref{prop.views.of.quasiregularity}:\ 
$p$ is quasiregular when $\intertwined{p}$ is a closed neighbourhood.
\item
Proposition~\ref{prop.views.of.regularity}:\ 
$p$ is weakly regular when $\intertwined{p}$ is a closed neighbourhood of $p$.
\item
Theorem~\ref{thrm.up.down.char}:\ 
$p$ is regular when $\intertwined{p}$ is a closed neighbourhood of $p$ and is a minimal closed neighbourhood.
\end{enumerate*}
\end{rmrk}


\begin{prop}
\label{prop.views.of.quasiregularity}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is quasiregular, or in full: $\community(p)\neq\varnothing$ (Definition~\ref{defn.tn}(\ref{item.quasiregular.point})).
\item
$\intertwined{p}$ is a closed neighbourhood (Definition~\ref{defn.cn}(\ref{item.closed.neighbourhood})).
\end{enumerate*}
\end{prop}
\begin{proof}
By construction in Definition~\ref{defn.tn}(\ref{item.tn}), $\community(p)=\interior(\intertwined{p})$.
So $\community(p)\neq\varnothing$ means precisely that $\intertwined{p}$ is a closed neighbourhood.
\end{proof}


\begin{prop}
\label{prop.views.of.regularity}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is weakly regular, or in full: $p\in\community(p)$ (Definition~\ref{defn.tn}(\ref{item.weakly.regular.point})).
\item\label{item.intertwined.p.closed.neighbourhood.of.p}
$\intertwined{p}$ is a closed neighbourhood of $p$ (Definition~\ref{defn.cn}(\ref{item.closed.neighbourhood.of.p})).
\item
The poset of closed neighbourhoods of $p$ ordered by subset inclusion, has a least element.
\item
$\intertwined{p}$ is least in the poset of closed neighbourhoods of $p$ ordered by subset inclusion.
\end{enumerate*}
\end{prop}
\begin{proof}
We prove a cycle of implications:
\begin{itemize}
\item
Suppose 
$p\in\interior(\intertwined{p})$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed, so this makes it a closed neighbourhood of $p$ as per Definition~\ref{defn.cn}.
\item
Suppose $\intertwined{p}$ is a closed neighbourhood of $p$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) 
$\intertwined{p}$ is the intersection of \emph{all} closed neighbourhoods of $p$, and it follows that this poset has $\intertwined{p}$ as a least element.
\item
Assume the poset of closed neighbourhoods of $p$ has a least element; write it $C$.
So $C=\bigcap\{C'\in\tf{Closed}\mid C'\text{ is a closed neighbourhood of }p\}$ and thus by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $C=\intertwined{p}$.
\item
If $\intertwined{p}$ is least in the poset of closed neighbourhoods of $p$ ordered by subset inclusion, then in particular $\intertwined{p}$ is a closed neighbourhood of $p$ and it follows from Definition~\ref{defn.cn} that $p\in\interior(\intertwined{p})$. 
\qedhere\end{itemize}
\end{proof}


Recall from Definition~\ref{defn.tn} that $\community(p)=\interior(\intertwined{p})$:
\begin{lemm}
\label{lemm.closure.community.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then $\closure{\community(p)}\subseteq\intertwined{p}$.
\end{lemm}
\begin{proof}
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed; we use Lemma~\ref{lemm.closure.interior}(2).
\end{proof}


\begin{thrm}
\label{thrm.pKp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ weakly regular then $\closure{\community(p)}=\intertwined{p}$.
In symbols:
$$
p\in\community(p)
\quad\text{implies}\quad \closure{\community(p)}=\intertwined{p}.
$$
\item\label{item.closure.community.p.intertwined}
As an immediately corollary, if $p$ is regular then $\closure{\community(p)}=\intertwined{p}$.
\end{enumerate*}
\end{thrm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p\in\community(p)=\interior(\intertwined{p})$ then $\closure{\community(p)}$ is a closed neighbourhood of $p$, so by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{p}\subseteq\closure{\community(p)}$.
By Lemma~\ref{lemm.closure.community.subset} $\closure{\community(p)}\subseteq\intertwined{p}$.
\item
By Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}) if $p$ is regular then it is weakly regular.
We use part~1 of this result. 
\qedhere\end{enumerate}
\end{proof}



We can combine Theorem~\ref{thrm.pKp} with Corollary~\ref{corr.regular.is.regular}: 
\begin{corr}
\label{corr.corr.pKp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$p$ is weakly regular and $\intertwined{p}=\intertwined{p'}$ \ for every $p'\in\community(p)$.
\end{enumerate*} 
\end{corr}
\begin{proof}
Suppose $p$ is regular and $p'\in\community(p)$.
Then $p$ is weakly regular by Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}), and $\community(p)=\community(p')$ by Corollary~\ref{corr.regular.is.regular}, and $\intertwined{p}=\intertwined{p'}$ by Theorem~\ref{thrm.pKp}.

Suppose $p$ is weakly regular and $\intertwined{p}=\intertwined{p'}$ for every $p'\in\community(p)$.
By Definition~\ref{defn.tn}(\ref{item.tn}) also $\community(p)=\interior(\intertwined{p})=\interior(\intertwined{p'})=\community(p')$ for every $p'\in\community(p)$, and by Corollary~\ref{corr.regular.is.regular} $p$ is regular.
\end{proof}

\begin{rmrk}
Note a subtlety to Corollary~\ref{corr.corr.pKp}: it is possible for $p$ to be regular, yet it is not the case that $\intertwined{p}=\intertwined{p'}$ for every $p'\in\intertwined{p}$ (rather than for every $p'\in\community(p)$).
For an example consider the top-left semitopology in Figure~\ref{fig.012}, taking $p=0$ and $p'=1$; then $1\in\intertwined{0}$ but $\intertwined{0}=\{0,1\}$ and $\intertwined{1}=\{0,1,2\}$.

To understand why this happens the interested reader can look ahead to Subsection~\ref{subsect.reg.tra.int}: in the terminology of that Subsection, $p'$ needs to be \emph{unconflicted} in Corollaries~\ref{corr.regular.is.regular} and~\ref{corr.corr.pKp}. 
\end{rmrk}


%%%%%%%%%%%%%%
\subsection{Intersections of communities with open sets}

\begin{rmrk}[An observation about consensus]
\label{rmrk.fundamental.consensus}
Proposition~\ref{prop.regular.closure} and Lemma~\ref{lemm.regular.between} tell us some interesting and useful things about distributed consensus from a semitopological perspective:
\begin{itemize*}
\item
Suppose a weakly regular $p$ wants to convince its community $\community(p)$ of some belief.
How might it proceed?

By Proposition~\ref{prop.regular.closure} it would suffice to seed one of the open neighbourhoods in its community with that belief, and then compute a \emph{topological closure} of that open set; in Remark~\ref{rmrk.why.top.closure} we discuss why topological closures are particularly interesting. 
\item
Suppose $p$ is regular, so it is a member of a transitive open neighbourhood, and $p$ wants to convince its community $\community(p)$ of some belief.

By Lemma~\ref{lemm.regular.between} $p$ need only convince \emph{some} open set that intersects its community (this open set need not even contain $p$), and then compute a topological closure as in the previous point.
\end{itemize*}
\end{rmrk}




\begin{lemm}
\label{lemm.regular.between}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular (so $p\in\community(p)\in\topens$).
Suppose $O\in\opens$.
Then
$$
p\in O\between \community(p)
\quad\text{implies}\quad 
\community(p)\subseteq\intertwined{p}\subseteq\closure{O}.
$$
In word:
\begin{quote}
If an open set intersects the community of a regular point, then that community is included in the closure of the open set.
\end{quote}
\end{lemm}
\begin{proof}
Suppose $p$ is regular, so $p\in\community(p)\in\topens$, and suppose $p\in O\between\community(p)$.
By Proposition~\ref{prop.open.strong-consensus} $\community(p)\subseteq\closure{\community(p)}\subseteq\closure{O}$.
By Theorem~\ref{thrm.pKp} $\closure{\community(p)}=\intertwined{p}$, and putting this together we get 
$$
\community(p)\subseteq\intertwined{p}\subseteq\closure{O}
$$ 
as required.
\end{proof}



Proposition~\ref{prop.regular.closure} generalises Theorem~\ref{thrm.pKp}, and is proved using it.
We regain Theorem~\ref{thrm.pKp} as the special case where $O=\community(p)$: 
\begin{prop}
\label{prop.regular.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is weakly regular (so $p\in\community(p)\in\opens$).
Suppose $O\in\opens$.
Then:
\begin{enumerate*}
\item
$p\in O\subseteq\community(p)$ implies
$\intertwined{p}=\closure{O}$.
\item
As a corollary, $p\in O\subseteq\intertwined{p}$ implies
$\intertwined{p}=\closure{O}$.
\end{enumerate*}
\end{prop}
\begin{proof}
If $p\in O\subseteq\community(p)$ then $p\in\community(p)$ and using Theorem~\ref{thrm.pKp} $\closure{\community(p)}\subseteq\intertwined{p}$.
Since $O\subseteq\community(p)$ also $\closure{O}\subseteq\intertwined{p}$.
Also, by Proposition~\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures}) (since $p\in O\in\opens$) $\intertwined{p}\subseteq\closure{O}$.

For the corollary, we note that if $O$ is open then $O\subseteq\interior(\intertwined{p})=\community(p)$ if and only if $O\subseteq\intertwined{p}$.
\end{proof}


\begin{rmrk}
Note in Proposition~\ref{prop.regular.closure} that it really matters that $p\in O$ --- that is, that $O$ is an open neighbourhood \emph{of $p$} and not just an open set in $\intertwined{p}$.

To see why, consider the example in Lemma~\ref{lemm.two.intertwined} (illustrated in Figure~\ref{fig.012}, top-left diagram): so $\ns P=\{0,1,2\}$ and $\opens=\{\varnothing,\ns P,\{0\},\{2\}\}$.
Note that:
\begin{itemize*}
\item
$\intertwined{1}=\{0,1,2\}$.
\item
If we set $O=\{0\}\subseteq\{0,1,2\}$ then this is open, but $\closure{O}=\{0,1\}\neq\{0,1,2\}$.
\item
If we set $O=\{0,1,2\}\subseteq\{0,1,2\}$ then $\closure{O}=\{0,1,2\}$.
\end{itemize*}
\end{rmrk}



\begin{rmrk}
\label{rmrk.why.top.closure}
Topological closures will matter because we will develop a theory of computable semitopologies which will (amongst other things) deliver a distributed algorithm to compute closures (see Remark~\ref{rmrk.computing.closed.sets}).

Thus, putting together the results above with the witness semitopology machinery to come in Definition~\ref{defn.trust.topology} onwards, we can say that from the point of view of a regular participant $p$, Proposition~\ref{prop.regular.closure} and Lemma~\ref{lemm.regular.between} reduce the problem of 
\begin{quote}
$p$ wishes to progress with value $v$
\end{quote}
to the simpler problem of 
\begin{quote}
$p$ wishes to find an open set that intersects with the community of $p$, and work with this open set to agree on $v$ (which open set does not matter; $p$ can try several until one works).
\end{quote}
Once this is done, the distributed algorithm will safely propagate the belief across the network.

Note that no forking is possible above; all the action is in finding and convincing the $O\between \community(p)$, and then the rest is automatic.

More discussion of this when we develop the notion of a \emph{kernel} in Section~\ref{sect.kernels}.
\end{rmrk}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Regularity, maximal topens, and minimal closed neighbourhoods}
\label{subsect.reg.max.min}

\begin{rmrk}
\label{rmrk.arc}
Recall we have seen an arc of results which 
\begin{itemize*}
\item
started with Theorem~\ref{thrm.max.cc.char} and Corollary~\ref{corr.regular.is.regular} --- characterisations of regularity $p\in\community(p)\in\topens$ in terms of maximal topens --- and 
\item
passed through Proposition~\ref{prop.views.of.regularity} --- characterisation of weak regularity $p\in\community(p)\in\opens$ in terms of minimal closed neighbourhoods.
\end{itemize*}
We are now ready to complete this arc by stating and proving Theorem~\ref{thrm.up.down.char}.
This establishes a pleasing --- and not-at-all-obvious --- duality between `has a maximal topen neighbourhood' and `has a minimal closed neighbourhood'.
\end{rmrk}

\begin{thrm}
\label{thrm.up.down.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$\community(p)$ is a maximal/greatest topen neighbourhood of $p$.
\item
$p$ is weakly regular (meaning that $p\in\community(p)=\interior(\intertwined{p})$) and $\intertwined{p}$ is a minimal closed neighbourhood (Definition~\ref{defn.cn}).\footnote{We really do mean ``$\intertwined{p}$ is minimal amongst closed neighbourhoods'' and \emph{not} the weaker condition ``$\intertwined{p}$ is minimal amongst closed neighbourhoods of $p$''!  That weaker condition is treated in Proposition~\ref{prop.views.of.regularity}.  See Remark~\ref{rmrk.don't.misread}.}
\end{enumerate*}
\end{thrm}
\begin{proof}
Equivalence of parts~1 and~2 is just Theorem~\ref{thrm.max.cc.char}(2).

For equivalence of parts~2 and~3 we prove two implications:
\begin{itemize}
\item
Suppose $p$ is regular.
By Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}) $p$ is weakly regular.
Now consider a closed neighbourhood $C'\subseteq \intertwined{p}$.
Note that $C'$ has a nonempty interior by Definition~\ref{defn.cn}(\ref{item.closed.neighbourhood}), so pick any $p'$ such that
$$
p'\in\interior(C')\subseteq C'\subseteq\intertwined{p} .
$$
It follows that $p'\in\community(p)=\interior(\intertwined{p})$, and $p$ is regular, so by Corollary~\ref{corr.corr.pKp} $\intertwined{p'}=\intertwined{p}$, 
and then by Proposition~\ref{prop.views.of.regularity}(\ref{intertwined.as.closure.closed}) (since $p'\in C'$) $\intertwined{p'}\subseteq C'$.
Putting this all together we have
$$
\intertwined{p}=\intertwined{p'} \subseteq C' \subseteq\intertwined{p},
$$
so that $C'=\intertwined{p}$ as required.
\item
Suppose $p$ is weakly regular and suppose $\intertwined{p}$ is minimal in the poset of closed neighbourhoods ordered by subset inclusion.

Consider some $p'\in\community(p)$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{p'}\subseteq\intertwined{p}$, and by minimality it follows that $\intertwined{p'}=\intertwined{p}$.
Thus also $\community(p')=\community(p)$.

Now $p'\in\community(p)$ was arbitrary, so by Corollary~\ref{corr.regular.is.regular} $p$ is regular as required.  
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
\label{rmrk.indeed.two.closed.neighbourhoods}
Recall Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234b}), as illustrated in Figure~\ref{fig.irregular} (right-hand diagram).
This has a point $0$ whose community $\community(0)=\{1,2\}$ is not a single topen (it contains two topens: $\{1\}$ and $\{2\}$).

A corollary of Theorem~\ref{thrm.up.down.char} is that $\intertwined{0}=\{0,1,2\}$ cannot be a minimal closed neighbourhood, because if it were then $0$ would be regular and $\community(0)$ would be a maximal topen neighbourhood of $0$.

We check, and see that indeed, $\intertwined{0}$ contains \emph{two} distinct minimal closed neighbourhoods: $\{0,1\}$ and $\{0,2\}$.
\end{rmrk}

\begin{rmrk}
\label{rmrk.don't.misread}
Theorem~\ref{thrm.up.down.char}(3) looks like Proposition~\ref{prop.views.of.regularity}(4), but
\begin{itemize*}
\item
Proposition~\ref{prop.views.of.regularity}(4) regards the \emph{poset of closed neighbourhoods of $p$} (closed sets with a nonempty open interior that contains $p$),
\item
Theorem~\ref{thrm.up.down.char}(3) regards the \emph{poset of all closed neighbourhoods} (closed sets with a nonempty open interior, not necessarily including $p$).
\end{itemize*}
So the condition used in Theorem~\ref{thrm.up.down.char}(3) is strictly stronger than the condition used in Proposition~\ref{prop.views.of.regularity}(4).
Correspondingly, the regularity condition in Theorem~\ref{thrm.up.down.char}(1) can be written as $p\in\community(p)\in\topens$, and (as noted in Lemma~\ref{lemm.wr.r} and Example~\ref{xmpl.wr}(\ref{item.wr.2})) this is strictly stronger than the condition $p\in\community(p)$ used in Proposition~\ref{prop.views.of.regularity}(1). 
\end{rmrk}




Corollary~\ref{corr.anti-hausdorff} makes Remark~\ref{rmrk.not.hausdorff} (intertwined is the opposite of Hausdorff) a little more precise:
\begin{corr}
\label{corr.anti-hausdorff}
Suppose $(\ns P,\opens)$ is a Hausdorff semitopology (so every two points have a pair of disjoint neighbourhoods).
Then if $p\in\ns P$ is regular, then $\{p\}$ is clopen.
\end{corr}
\begin{proof}
Suppose $\ns P$ is Hausdorff and consider $p\in \ns P$.
By Remark~\ref{rmrk.not.hausdorff} $\intertwined{p}=\{p\}$. 
From Theorem~\ref{thrm.up.down.char}(3) $\{p\}$ is closed and has a nonempty open interior which must therefore also be equal to $\{p\}$.
By Corollary~\ref{corr.when.singleton.topen} (or from Theorem~\ref{thrm.up.down.char}(2)) this interior is transitive.
\end{proof}


\begin{prop}
\label{prop.max.topen.min.closed}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
Every maximal topen is equal to the interior of a minimal closed neighbourhood.
\item
The converse implication holds if $(\ns P,\opens)$ is a topology, but need not hold in the more general case that $(\ns P,\opens)$ is a semitopology: there may exist a minimal closed neighbourhood whose interior is not topen.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $\atopen$ is a maximal topen.
By Definition~\ref{defn.transitive}(\ref{transitive.cc}) $\atopen$ is nonempty, so choose $p\in \atopen$.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed, and using Theorem~\ref{thrm.max.cc.char} 
$$
p\in \atopen=\community(p)=\interior(\intertwined{p})\subseteq\intertwined{p}.
$$
Thus $p$ is weakly regular and by Proposition~\ref{prop.views.of.regularity}(1\&4) $\intertwined{p}$ is a least closed neighbourhood of $p$.
\item
It suffices to provide a counterexample.
This is Example~\ref{xmpl.not.intertwined} below.
However, we also provide here a breaking `proof', which throws light on precisely what Example~\ref{xmpl.not.intertwined} is breaking, and illustrates what the difference between semitopology and topology can mean in practical proof.

Suppose $\atopen$ is the nonempty open interior of a minimal closed neighbourhood $C$: we will try (and fail) to show that this is transitive.
By Theorem~\ref{thrm.cc.char} it suffices to prove that $p\intertwinedwith p'$ for every $p,p'\in \atopen$.

So suppose $p\in O$ and $p'\in O'$ and $\neg(O\between O')$.
Since $p'\not\in\closure{O}$, we know that $\closure{O}\cap C\subseteq C$ is a strictly smaller closed set.
Also, $O\cap\f{closure}(C)$ is nonempty because it contains $p$.

If $(\ns P,\opens)$ is a topology then we are done, because $O\cap\interior(C)$ would be necessarily open, contradicting our assumption that $C$ is a minimal closed neighbourhood. 

However, if $(\ns P,\opens)$ is a semitopology then this does not necessarily follow: $O\cap\interior(C)$ need not be open, and we cannot proceed.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.4\columnwidth]{diagrams/square-diagram.pdf}
\vspace{-1em}
\caption{An unconflicted, irregular space (Proposition~\ref{prop.unconflicted.irregular}) in which every minimal closed neighbourhood has a non-transitive open interior (Example~\ref{xmpl.not.intertwined})}
\label{fig.square.diagram}
\end{figure}


\begin{lemm}
\label{lemm.square.diagram.not.qr}
Consider the semitopology illustrated in Figure~\ref{fig.square.diagram}.
So:
\begin{itemize}
\item
$\ns P = \{0, 1, 2, 3\}$.
\item
$\opens$ is generated by $\{A,B,C,D\}$ where: 
$$
A=\{3, 0\}, 
\quad
B=\{0, 1\},
\quad
C=\{1, 2\},
\quad\text{and}\quad
D=\{2, 3\}.
$$
\end{itemize}
Then for every $p\in\ns P$ we have:
\begin{enumerate*}
\item
$p$ is intertwined only with itself.
\item
$\community(p)=\varnothing$.
\end{enumerate*}
\end{lemm}
\begin{proof}
Part~1 is by routine calculations from Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}).
Part~2 follows, noting that $\interior(\{p\})=\varnothing$ for every $p\in\ns P$.
\end{proof}


\begin{xmpl}
\label{xmpl.not.intertwined}
The semitopology illustrated in Figure~\ref{fig.square.diagram}, and specified in Lemma~\ref{lemm.square.diagram.not.qr},
contains sets that are minimal amongst closed sets with a nonempty interior, yet that interior is not topen:
\begin{itemize*}
\item
$A$, $B$, $C$, and $D$ are clopen, because $C$ is the complement of $A$ and $D$ is the complement of $B$, so they are their own interior.
\item
$A$ is a minimal closed neighbourhood (which is also open, being $A$ itself), because 
\begin{itemize*}
\item
$A=\{3, 0\}$ is closed because it is the complement of $C$, and it is its own interior, and 
\item
its two nonempty subsets $\{3\}$ and $\{0\}$ are closed (being the complement of $B\cup C$ and $C\cup D$ respectively) but they have empty open interior because $\{3\}$ and $\{0\}$ are not open.
\end{itemize*} 
\item
$A$ is not transitive because $3$ and $0$ are not intertwined: $3\in D$ and $0\in B$ and $B\cap D=\varnothing$.
\item
Similarly $B$, $C$, and $D$ are minimal closed neighbourhoods, which are also open, and they are not transitive.
\end{itemize*}
We further note that:
\begin{enumerate*}
\item
$\closure{0}=\{0\}$, because its complement is equal to $C\cup D$ (Definition~\ref{defn.closure}; Lemma~\ref{lemm.closed.complement.open}).
Similarly for every other point in $\ns P$.
\item
$\intertwined{0}=\{0\}$, as noted in Lemma~\ref{lemm.square.diagram.not.qr}.
Similarly for every other point in $\ns P$.
\item\label{item.square.diagram.not.regular}
$\community(0)=\interior(\intertwined{0})=\varnothing$ as noted in Lemma~\ref{lemm.square.diagram.not.qr},
so that $0$ is not regular (Definition~\ref{defn.tn}(\ref{item.tn})), and $0$ is not even weakly regular or quasiregular.
Similarly for every other point in $\ns P$.
\item
$0$ has \emph{two} minimal closed neighbourhoods: $A$ and $B$.
Similarly for every other point in $\ns P$.
\end{enumerate*}
This illustrates that $\intertwined{p}\subsetneq C$ is possible, where $C$ is a minimal closed neighbourhood of $p$.
\end{xmpl}




\begin{rmrk}
The results and discussions above tell us something interesting above and beyond the specific mathematical facts which they express.

They demonstrate that points being intertwined (the $p\intertwinedwith p'$ from Definition~\ref{defn.intertwined.points}) is a distinct \emph{semitopological} notion. 
A reader familiar with topology might be tempted to identify maximal topens with interiors of minimal closed neighbourhood (so that in view of Theorem~\ref{thrm.cc.char}, being intertwined would be topologically characterised just as two points being in the interior of the same minimal closed neighbourhood).

This works in topologies, but we see from Example~\ref{xmpl.not.intertwined} that in semitopologies being intertwined has its own distinct identity.
\end{rmrk}

We conclude with one more example, showing how an (apparently?) slight changes to a semitopology can make a big difference to its intertwinedness:
\begin{xmpl}
\label{xmpl.two.topen.examples}
\leavevmode
\begin{enumerate*}
\item
$\mathbb Q^2$ with open sets generated by any covering collection of pairwise non-parallel \deffont{rational lines} --- meaning a set of solutions to a linear equation $a.x\plus b.y=c$ for $a$, $b$, and $c$ integers --- is a semitopology.

This consists of a single (maximal) topen: lines are pairwise non-parallel, so any two lines intersect and (looking to Theorem~\ref{thrm.cc.char}) all points are intertwined.
There is only one closed set with a nonempty open interior, which is the whole space.
\item
$\mathbb Q^2$ with open sets generated by all (possibly parallel) rational lines, is a semitopology.
It has no topen sets and (looking to Theorem~\ref{thrm.cc.char}) no two distinct points are intertwined.

For any line $l$, its complement $\mathbb Q^2\setminus l$ is a closed set, given by the union of all the lines parallel to $l$.
Thus every closed set is also an open set, and vice versa, and every line $l$ is an example of a minimal closed neighbourhood (itself), whose interior is not a topen. 
\end{enumerate*}
\end{xmpl}


\subsection{More on minimal closed neighbourhoods}

We make good use of closed neighbourhoods, and in particular minimal closed neighbourhoods, in Subsection~\ref{subsect.reg.max.min} and elsewhere.
We take a moment to give a pleasing alternative characterisation of this useful concept. 

\subsubsection{Regular open/closed sets}

\begin{rmrk}
The terminology `regular open/closed set' is from the topological literature.
It is not directly related to terminology `regular point' from Definition~\ref{defn.tn}(\ref{item.regular.point}), which comes from semitopologies.
However, it turns out that a mathematical connection does exist between these two notions. 
We outline some theory of regular open/closed sets, and then demonstrate the connections to what we have seen in our semitopological world. 
\end{rmrk}

\begin{defn}
\label{defn.regular.open.set}
Suppose $(\ns P,\opens)$ is a semitopology.
Recall some standard terminology from topology~\cite[Exercise~3D, page~29]{willard:gent}:
\begin{enumerate*}
\item
We call an open set $O\in\opens$ \deffont{regular} when $O=\interior(\closure{O})$.
\item
We call a closed set $C\in\closed$ \deffont{regular} when $C=\closure{\interior(C)}$.
\item
Write $\regularOpens$ and $\regularClosed$ for the sets of regular open and regular closed sets respectively.
\end{enumerate*}
\end{defn}



\begin{lemm}
\label{lemm.ic.ci.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $O\in\opens$ and $C\in\closed$.
Then:
\begin{enumerate*}
\item
$\interior(C)$ is a regular open set.
\item
$\closure{O}$ is a regular closed set.
\end{enumerate*}
\end{lemm}
\begin{proof}
Direct from Definition~\ref{defn.regular.open.set} and Corollary~\ref{corr.ic.ci}.
\end{proof}

\begin{corr}
\label{corr.interior.closure.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $O\in\opens$.
Then $\interior(\closure{O})$ is a regular open set.
\end{corr}
\begin{proof}
By Lemma~\ref{lemm.closure.closed} $\closure{O}$ is closed, and by Lemma~\ref{lemm.ic.ci.regular} $\interior(\closure{O})$ is regular open. 
\end{proof}

The regular open and the regular closed sets are the same thing, up to an easy and natural bijection: 
\begin{corr}
\label{corr.ro=rc}
Suppose $(\ns P,\opens)$ is a semitopology.
Then 
\begin{itemize*}
\item
the topological closure map $\closure{\text{-}}$ and 
\item
the topological interior map $\interior(\text{-})$ 
\end{itemize*}
define a bijection of posets between $\regularOpens$ and $\regularClosed$ ordered by subset inclusion. 
\end{corr}
\begin{proof}
By Lemma~\ref{lemm.ic.ci.regular}, $\closure{\text{-}}$ and $\interior(\text{-})$ map between $\regularOpens$ to $\regularClosed$.
Now we note that the regularity property from Definition~\ref{defn.regular.open.set}, which states that $\interior(\closure{O})=O$ when $O\in\regularOpens$ and $\closure{\interior(C)}=C$ when $C\in\regularClosed$, expresses precisely that these maps are inverse.

They are maps of posets by Lemmas~\ref{corr.interior.monotone} and~\ref{lemm.closure.monotone}(\ref{closure.increasing}). 
\end{proof}

\begin{lemm}
\label{lemm.regular.open.closed}
Suppose $(\ns P,\opens)$ is a semitopology and $O\in\opens$ and $C\in\closed$.
Then:
\begin{enumerate*}
\item
$O$ is a regular open set if and only if $\ns P\setminus O$ is a regular closed set if and only if $\closure{O}$ is a regular closed set.
\item
$C$ is a regular closed set if and only if $\ns P\setminus C$ is a regular open set if and only if $\interior(C)$ is a regular open set.
\end{enumerate*}
\end{lemm} 
\begin{proof}
By routine calculations from the definitions using parts~\ref{item.closure.interior.complement.closure} and~\ref{item.closure.interior.complement.interior} of Lemma~\ref{lemm.closure.interior}.
\end{proof}

\subsubsection{Intertwined points and regular open sets}

We make an easy observation about open sets:
\begin{lemm}
\label{lemm.clint.between}
Suppose $(\ns P,\opens)$ is a semitopology and $O,O'\in\opens$.
Then the following are equivalent:
\begin{enumerate*}
\item 
$O\between O'$.
\item
$O\between\interior(\closure{O'})$.
\item
$\interior(\closure{O})\between\interior(\closure{O'})$.
\end{enumerate*}
\end{lemm}
\begin{proof}
First we prove the equivalence of parts~1 and~2:
\begin{enumerate}
\item
Suppose $O\between O'$.
By Lemma~\ref{lemm.closure.interior}(\ref{item.closure.interior.open}) $O\between \interior(\closure{O'})$.
\item
Suppose there is some $p\in O\cap\interior(\closure{O'})$.
Then $O$ is an open neighbourhood of $p$ and $p\in\closure{O'}$, so by Lemma~\ref{lemm.closure.using.nbhd.intersections} (or just direct from Definition~\ref{defn.closure}(\ref{item.closure})) $O\between O'$ as required.
\end{enumerate}
Equivalence of parts~1 and~3 then follows easily by two applications of the equivalence of parts~1 and~2.
\end{proof}

\begin{corr}
\label{corr.nonintersect.nonintersect.regular}
Suppose $(\ns P,\opens)$ is a semitopology and $p,p'\in\ns P$.
Then the following conditions are equivalent:
\begin{enumerate*}
\item
$p$ and $p'$ have a nonintersecting pair of open neighbourhoods.
\item 
$p$ and $p'$ have a nonintersecting pair of regular open neighbourhoods.
\end{enumerate*}
\end{corr}
\begin{proof}
Part~2 clearly implies part~1, since a regular open set is an open set.
Part~1 implies part~2 using Lemma~\ref{lemm.clint.between} and Corollary~\ref{corr.interior.closure.regular}.
\end{proof}

\begin{rmrk}
\label{rmrk.intertwined.with.regular.opens}
In Definition~\ref{defn.intertwined.points}(\ref{item.p.intertwinedwith.p'}) we defined $p\intertwinedwith p'$ in terms of open neighbourhoods of $p$ and $p'$ as follows:
$$
\Forall{O,O'{\in}\opens} (p\in O\land p'\in O') \limp O\between O' .
$$ 
In the light of Corollary~\ref{corr.nonintersect.nonintersect.regular}, we could just as well have defined it just in terms of regular open neighbourhoods: 
$$
\Forall{O,O'{\in}\regularOpens} (p\in O\land p'\in O') \limp O\between O' .
$$ 
Mathematically, for what we have needed so far, this latter characterisation is not needed.
However, it is easy to think of scenarios in which it might be useful.
In particular, \emph{computationally} it could make sense to restrict to the regular open sets, simply because there are fewer of them. 
\end{rmrk}


\subsubsection{Minimal nonempty regular closed sets are precisely the minimal closed neighbourhoods}


\begin{lemm}
\label{lemm.lcn.nrc}
Suppose $(\ns P,\opens)$ is a semitopology and $C\in\closed$.
Then:
\begin{enumerate*}
\item
If $C$ is a minimal closed neighbourhood (a closed set with a nonempty open interior), then $C$ is a nonempty regular closed set (Definition~\ref{defn.regular.open.set}).
\item
If $C$ is a nonempty regular closed set then $C$ is a closed neighbourhood (Definition~\ref{defn.cn}).
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
\emph{Suppose $C$ is a minimal closed neighbourhood.}

Write $O'=\interior(C)$ and $C'=\closure{O'}=\closure{\interior(C)}$.
Because $C$ is a closed neighbourhood, by Definition~\ref{defn.cn} $O'\neq\varnothing$.
By Lemma~\ref{lemm.closure.closed} $C'\in\closed$.
Using Corollary~\ref{corr.ic.ci} $\interior(C')=\interior(\closure{\interior(C)})=\interior(C)=O'\neq\varnothing$, so that $C'$ is a closed neighbourhood, and by minimality $C'=C$.
But then $C=\closure{\interior(C)}$ so $C$ is regular, as required.
\item
\emph{Suppose $C$ is a nonempty regular closed set,} so that $\varnothing\neq C=\closure{\interior(C)}$.

It follows that $\interior(C)\neq\varnothing$ and this means precisely that $C$ is a closed neighbourhood. 
\qedhere\end{enumerate}
\end{proof}

In Theorem~\ref{thrm.up.down.char} we characterised the point $p$ being regular in terms of minimal closed neighbourhoods.
We can now characterise the minimal closed neighbourhoods in terms of something topologically familiar:
\begin{prop}
\label{prop.lnrc.lcn}
Suppose $(\ns P,\opens)$ is a semitopology and $C\in\closed$.
Then the following are equivalent:
\begin{enumerate*}
\item
$C$ is a minimal nonempty regular closed set. 
\item
$C$ is a minimal closed neighbourhood. 
\end{enumerate*}
\end{prop}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
\emph{Suppose $C$ is a minimal closed neighbourhood.}

By Lemma~\ref{lemm.lcn.nrc}(1) $C$ is a nonempty regular closed set.
Furthermore by Lemma~\ref{lemm.lcn.nrc}(2) if $C'\subseteq C$ is any other nonempty regular closed set contained in $C$, then it is a closed neighbourhood, and by minimality it is equal to $C$.
Thus, $C$ is minimal.
\item
\emph{Suppose $C$ is a minimal nonempty regular closed set.}

By Lemma~\ref{lemm.lcn.nrc}(2) $C$ is a closed neighbourhood.
Furthermore by Lemma~\ref{lemm.lcn.nrc}(1) if $C'\subseteq C$ is any other closed neighourhood then it is a nonempty regular closed set, and by minimality it is equal to $C$.
\qedhere\end{itemize}
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{How are $\intertwined{p}$ and $\closure{p}$ related?}

\begin{rmrk}
\label{rmrk.re-read.closure}
Recall the definitions of $\intertwined{p}$ and $\closure{p}$:
\begin{itemize*}
\item
The set $\closure{p}$ is the \emph{closure} of $p$.

By Definition~\ref{defn.closure} this is the set of $p'$ such that every open neighbourhood $O'\ni p'$ intersects with $\{p\}$.
By Definition~\ref{defn.closed} $\closure{p}$ is closed.
\item
The set $\intertwined{p}$ is the set of points \emph{intertwined} with $p$.

By Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}) this is the set of $p'$ such that every open neighbourhood $O'\ni p'$ intersects with every open neighbourhood $O \ni p$. 
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed.
\end{itemize*}
So we see that $\closure{p}$ and $\intertwined{p}$ give us two canonical ways of generating a closed set from a point $p\in \ns P$. 
This invites a question: 
\begin{quote}
\emph{How are $\intertwined{p}$ and $\closure{p}$ related?}
\end{quote}
In this section we develop answers. 
\end{rmrk}



Lemma~\ref{lemm.char.not.intertwined} rephrases Remark~\ref{rmrk.re-read.closure} more precisely by looking at it through sets complements.
\begin{lemm}
\label{lemm.char.not.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\ns P\setminus\closure{p} = \bigcup \{O\in\opens \mid p\not\in O\}\in\opens$.

In words: $\ns P\setminus\closure{p}$ is the union of the {\bf open} sets that avoid $p$.
\item
$\ns P\setminus\intertwined{p} = \bigcup\{C\in\closed \mid p\not\in C\}\in\opens$.

In words: $\ns P\setminus\intertwined{p}$ is the union of the {\bf closed} sets that avoid $p$.
\item\label{item.intertwined.open.avoid}
$\ns P\setminus\intertwined{p} = \bigcup\{O'\in\opens \mid \Exists{O{\in}\opens} p\in O\land O'\notbetween O\}\in\opens$.

In words: $\ns P\setminus\intertwined{p}$ is the union of the open sets that avoid some neighbourhood of $p$.
\end{enumerate*}
\end{lemm} 
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Immediate from Definitions~\ref{defn.intertwined.points} and~\ref{defn.closure}.\footnote{A longer proof via Corollary~\ref{corr.closure.closure}(3) and Lemma~\ref{lemm.closed.complement.open} is also possible.}
Openness is from Definition~\ref{defn.semitopology}(\ref{semitopology.unions}).
\item
We reason as follows using Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}):
$$
\ns P\setminus\intertwined{p} = \bigcup \{\ns P\setminus \closure{O} \mid p\in O\} = \bigcup\{C\in\closed \mid p\not\in C\}.
$$
Openness is 
Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}).
\item
From part~2 of this result using Definition~\ref{defn.closure}, or by a routine argument direct from Definition~\ref{defn.intertwined.points}. 

Openness is from Definition~\ref{defn.semitopology}(\ref{semitopology.unions}).
\qedhere\end{enumerate}
\end{proof}


\begin{prop}
\label{prop.closure.intertwined}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\closure{p}\subseteq \intertwined{p}$.
\item
The subset inclusion may be strict; that is, $\closure{p}\subsetneq\intertwined{p}$ is possible --- even if $p$ is regular (Definition~\ref{defn.tn}(\ref{item.regular.point})).
\item
If $\interior(\closure{p})\neq\varnothing$ (so $\closure{p}$ has a nonempty interior)
then 
$\closure{p}=\intertwined{p}$.
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We reason as follows:
$$
\begin{array}{r@{\ }l@{\quad}l}
\closure{p}=&
\closure{\{p\}}
&\text{Definition~\ref{defn.closure}(\ref{item.closure.p})}
\\
=&
\bigcap\{C\in\closed \mid p\in C\}
&\text{Corollary~\ref{corr.closure.closure}(\ref{item.closure.as.intersection})}
\\
\subseteq&
\bigcap\{C\in\closed \mid p\in\interior(C)\}
&\text{Fact of intersections}
\\
=&
\intertwined{p} 
&\text{Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed})}
\end{array}
$$
\item
Example~\ref{xmpl.closure.101} below shows that $\closure{p}\subsetneq\intertwined{p}$ is possible for $p$ regular. 
\item
Write $O=\interior(\closure{p})$.
By standard topological reasoning, $\closure{p}$ is the complement of the union of the open sets that do not contain $p$, and $O=\interior(\closure{p})$ is the greatest open set such that $\Forall{O'{\in}\opens}O\between O'\limp p\in O'$.  
We assumed that $O$ is nonempty, so $O\between O$, thus $p\in O$.

Then by part~1 of this result $p\in O\subseteq\closure{p}\subseteq\intertwined{p}$, and by Proposition~\ref{prop.regular.closure}(2) $\intertwined{p}=\closure{O}$.
Using more standard topological reasoning (since $O\neq\varnothing$) $\closure{O}=\closure{p}$, and the result follows.
\qedhere\end{enumerate}
\end{proof}


\begin{xmpl}
\label{xmpl.closure.101}
Take $\ns P=\{0,1\}$ and $\opens=\{\varnothing,\{1\},\{0,1\}\}$ (this space has a name: the \emph{Sierpi\'nski topology}).
Then:
\begin{itemize*}
\item
$\closure{0}=\{0\}$ (because $\{1\}$ is open), but
\item
$\intertwined{0}=\{0,1\}$ (because every open neighbourhood of $0$ intersects with every open neighbourhood of $1$). 
\end{itemize*}
Thus we see that $\closure{0}=\{0\}\subsetneq\{0,1\}=\intertwined{0}$, and $0$ is regular since $0\in\interior(\intertwined{0})=\{0,1\}\in\topens$.
\end{xmpl}

\begin{rmrk}
We have one loose end left.
We know from Theorem~\ref{thrm.up.down.char}(3) that $\intertwined{p}$ is a minimal closed neighbourhood (closed set with nonempty open interior) when $p$ is regular. 
We also know from Proposition~\ref{prop.closure.intertwined} that $\closure{p}\subsetneq\intertwined{p}$ is possible, even if $p$ is regular.

So a closed \emph{neighbourhood} in between $\closure{p}$ and $\intertwined{p}$ is impossible by minimality, but can there be any closed \emph{sets} (not necessarily having a nonempty open interior) in between $\closure{p}$ and $\intertwined{p}$?

Somewhat counterintuitively perhaps, this is possible: 
\end{rmrk}

\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then it is possible for there to exist a closed set $C\subseteq\ns P$ with $\closure{p}\subsetneq C\subsetneq\intertwined{p}$, even if $p$ is regular.
\end{lemm}
\begin{proof}
It suffices to provide an example.
Consider $\mathbb N$ with the semitopology whose open sets are generated by 
\begin{itemize*}
\item
final segments $n_\geq=\{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$ (cf. Example~\ref{xmpl.meet-irreducible}(\ref{item.final.N})), and 
\item
$\{0,1,2,3,4,5,6,7,8,9\}$.
\end{itemize*} 
The reader can check that $\closure{0}=\{0\}$ and $\intertwined{0}=\{0,1,2,3,4,5,6,7,8,9\}$.
However, there are also eight closed sets $\{0,1\}$, $\{0,1,2\}$, \dots, $\{0,1,2,3,\dots,8\}$ in between $\closure{0}$ and $\intertwined{0}$. 
\end{proof}

We will study $\intertwined{p}$ further but to make more progress we need the notion of a(n un)conflicted point.
This is an important idea in its own right and gets its own Section:


\section{(Un)conflicted points: transitivity of $\intertwinedwith$}
\label{sect.unconflicted.point}

\subsection{The basic definition} 
\label{subsect.reg.tra.int}

In Lemma~\ref{lemm.intertwined.not.transitive} we asked whether the `is intertwined with' relation $\intertwinedwith$ from Definition~\ref{defn.intertwined.points}(1) is transitive --- answer: not necessarily.

Transitivity of $\intertwinedwith$ is a natural condition.
We now have enough machinery to study it in more detail, and this will help us gain a deeper understanding of the properties of not-necessarily-regular points. 


\begin{defn}
\label{defn.conflicted}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate*}
\item
Call a point $p$ \deffont{conflicted} when there exist $p'$ and $p''$ such that $p'\intertwinedwith p$ and $p\intertwinedwith p''$ yet $\neg(p'\intertwinedwith p'')$.
\item\label{item.unconflicted}
If $p'\intertwinedwith p\intertwinedwith p''$ implies $p'\intertwinedwith p''$ always, then call $p$ \deffont{unconflicted}.
\item
Continuing Definition~\ref{defn.tn}(\ref{item.regular.S}), if $P\subseteq\ns P$ and every $p\in P$ is conflicted/unconflicted, then we may call $P$ \deffont{conflicted/unconflicted} respectively. 
\end{enumerate*}
\end{defn}


\begin{xmpl}
\label{xmpl.conflicted.points}
We consider some examples:
\begin{enumerate*}
\item\label{item.example.of.conflicted.point}
In Figure~\ref{fig.012} top-left diagram, $0$ and $2$ are unconflicted and intertwined with themselves, and $1$ is conflicted (being intertwined with $0$, $1$, and $2$).

If the reader wants to know what a conflicted point looks like: it looks like $1$. 
\item 
In Figure~\ref{fig.012} top-right diagram, $0$ and $2$ are unconflicted and intertwined with themselves, and $1$ is conflicted (being intertwined with $0$, $1$, and $2$).
\item
In Figure~\ref{fig.012} lower-left diagram, $0$ and $1$ are unconflicted and intertwined with themselves, and $3$ and $4$ are unconflicted and intertwined with themselves, and $2$ is conflicted (being intertwined with $0$, $1$, $2$, $3$, and $4$).
\item
In Figure~\ref{fig.012} lower-right diagram, all points are unconflicted, and $0$ and $2$ are intertwined just with themselves, and $1$ and $\ast$ are intertwined with one another.
\item
In Figure~\ref{fig.square.diagram}, all points are unconflicted and intertwined only with themselves.
\end{enumerate*}
\end{xmpl}

So $p$ is conflicted when it witnesses a counterexample to $\intertwinedwith$ being transitive.
We start with an easy lemma (we will use this later, but we mention it now for Remark~\ref{rmrk.intertwined.unconflicted.in.context}):
\begin{lemm}
\label{lemm.unconflicted.char}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is unconflicted.
\item\label{item.unconflicted.p.in.q}
If $q\in\ns P$ and $p\in\intertwined{q}$ then $\intertwined{p}\subseteq\intertwined{q}$. 
\item\label{item.p'.in.unconflicted.p}
$\intertwined{p}\subseteq\intertwined{p'}$ for every $p'\in\intertwined{p}$.
\item\label{item.unconflicted.as.least}
$\intertwined{p}$ is least in the set $\{\intertwined{p'}\mid p\intertwinedwith p'\}$ ordered by subset inclusion.
\end{enumerate*}
\end{lemm}
\begin{proof}
The proof is just by pushing definitions around in a cycle of implications.
\begin{itemize}
\item
\emph{Part~1 implies part~\ref{item.unconflicted.p.in.q}.}

Suppose $p$ is unconflicted.
Consider $q\in\ns P$ such that $p\in\intertwined{q}$, and consider any $p'\in\intertwined{p}$.
Unpacking definitions we have that $p'\intertwinedwith p\intertwinedwith q$ and so $p'\intertwinedwith q$, thus $p'\in\intertwined{q}$ as required.
\item
\emph{Part~\ref{item.unconflicted.p.in.q} implies part~\ref{item.p'.in.unconflicted.p}.}

From the fact that $p'\in\intertwined{p}$ if and only if $p'\intertwinedwith p$ if and only if $p\in\intertwined{p'}$.
\item
\emph{Part~\ref{item.p'.in.unconflicted.p} implies part~\ref{item.unconflicted.as.least}.}

Part~4 just rephrases part~3.
\item
\emph{Part~\ref{item.unconflicted.as.least} implies part~1.}

Suppose $\intertwined{p}$ is $\subseteq$-least in $\{\intertwined{p'}\mid p\intertwinedwith p'\}$ and suppose $p''\intertwinedwith p\intertwinedwith p'$.
Then $p''\in\intertwined{p}\subseteq\intertwined{p'}$, so $p''\intertwinedwith p'$ as required.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
\label{rmrk.intertwined.unconflicted.in.context}
Lemma~\ref{lemm.unconflicted.char} is just an exercise in reformulating definitions, but part~\ref{item.unconflicted.as.least} of the result helps us to contrast the property of being unconflicted, with structurally similar 
characterisations of \emph{weak regularity} and of \emph{regularity} in Proposition~\ref{prop.views.of.regularity} and Theorem~\ref{thrm.up.down.char} respectively.
For the reader's convenience we collect them here --- all sets below are ordered by subset inclusion:
\begin{enumerate}
\item
$p$ is unconflicted when \emph{$\intertwined{p}$ is least in $\{\intertwined{p'}\mid p\intertwinedwith p'\}$}. 
\item
$p$ is weakly regular when \emph{$\intertwined{p}$ is least amongst closed neighbourhoods of $p$}.

See Proposition~\ref{prop.views.of.regularity} and recall from Definition~\ref{defn.cn} that a closed neighbourhood of $p$ is a closed set $C$ such that $p\in\interior(C)$.
\item 
$p$ is regular when \emph{$\intertwined{p}$ is a closed neighbourhood of $p$ and minimal amongst all closed neighbourhoods}.

See Theorem~\ref{thrm.up.down.char} and recall that a closed neighbourhood is any closed set with a nonempty interior (not necessarily containing $p$).
\end{enumerate}
We know from Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}) that regular implies weakly regular. 
We now consider how these properties relate to being unconflicted.
\end{rmrk}

\subsection{A key result: regular = weakly regular + unconflicted}
\label{subsect.r=wr+uc}

\begin{prop}
\label{prop.unconflicted.irregular}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item\label{item.reg.implies.unconflicted}
If $p$ is regular then it is unconflicted.

Equivalently by the contrapositive: if $p$ is conflicted then it is not regular.
\item
$p$ may be unconflicted and neither quasiregular, weakly regular, nor regular.
\item
There exists a semitopological space such that 
\begin{itemize*}
\item
every point is unconflicted (so $\intertwinedwith$ is a transitive relation) yet 
\item
every point has empty community, so that the space is irregular, not weakly regular, and not quasiregular.%
\footnote{See also Proposition~\ref{prop.conflicted.weakly.regular}.}
\end{itemize*}
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
So consider $q\intertwinedwith p \intertwinedwith q'$.
We must show that $q\intertwinedwith q'$, so consider open neighbourhoods $Q\ni q$ and $Q'\ni q'$.
By assumption $p$ is regular, so unpacking Definition~\ref{defn.tn}(\ref{item.regular.point}) $\community(p)$ is a topen (transitive and open) neighbourhood of $p$.
By assumption $Q\between \community(p)\between Q'$, and by transitivity of $\community(p)$ (Definition~\ref{defn.transitive}(\ref{transitive.transitive})) we have $Q\between Q'$ as required.
\item
Consider the semitopology illustrated in Figure~\ref{fig.square.diagram}.
By Lemma~\ref{lemm.square.diagram.not.qr} the point $0$ is trivially unconflicted (because it is intertwined only with itself), but it is also neither quasiregular, weakly regular, nor regular, because its community is the empty set. 
See also Example~\ref{xmpl.boundary.examples}. 
\item
As for the previous part, noting that the same holds of points $1$, $2$, and $3$ in Figure~\ref{fig.square.diagram}.
\qedhere\end{enumerate}
\end{proof}


We can combine Proposition~\ref{prop.unconflicted.irregular} with a previous result Lemma~\ref{lemm.wr.r} to get a precise and attractive relation between being 
\begin{itemize*}
\item
regular (Definition~\ref{defn.tn}(\ref{item.regular.point})), 
\item
weakly regular (Definition~\ref{defn.tn}(\ref{item.weakly.regular.point})), and 
\item
unconflicted (Definition~\ref{defn.conflicted}), 
\end{itemize*}
as follows:
\begin{thrm}
\label{thrm.r=wr+uc}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$p$ is regular.
\item
$p$ is weakly regular and unconflicted.
\end{itemize*}
More succinctly we can write: \emph{regular = weakly regular + unconflicted}.\footnote{See also Theorem~\ref{thrm.regular=qr+sc}, which does something similar for semiframes.}
\end{thrm}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
If $p$ is regular then it is weakly regular by Lemma~\ref{lemm.wr.r} and unconflicted by Proposition~\ref{prop.unconflicted.irregular}(1). 
\item
Suppose $p$ is weakly regular and unconflicted.
By Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) $p\in\community(p)$ and by Lemma~\ref{lemm.three.transitive}(3) it would suffice to show that $q\intertwinedwith q'$ for any $q,q'\in\community(p)$.

So consider $q,q'\in\community(p)$.
Now by Definition~\ref{defn.tn}(\ref{item.tn}) $\community(p)=\interior(\intertwined{p})$ so in particular $q,q'\in\intertwined{p}$.
Thus $q\intertwinedwith p\intertwinedwith q'$, and since $p$ is unconflicted $q\intertwinedwith q'$ as required.
\qedhere\end{itemize}
\end{proof}


We can use Theorem~\ref{thrm.r=wr+uc} to derive simple global well-behavedness conditions on spaces, as follows: 
\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If the $\intertwinedwith$ relation is transitive (i.e. if every point is unconflicted) then a point is regular if and only if it is weakly regular.
\item
If every point is weakly regular (i.e. if $p\in\community(p)$ always) then a point is regular if and only if it is unconflicted.
\end{enumerate*} 
\end{corr}
\begin{proof}
Immediate from Theorem~\ref{thrm.r=wr+uc}. 
\end{proof}




\subsection{The boundary of $\intertwined{p}$}
\label{subsect.boundary.intertwined}

In this short Subsection we ask what points on the topological boundary of $\intertwined{p}$ can look like:
\begin{nttn}
\label{nttn.boundary}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
\begin{enumerate*}
\item
As standard, we define 
$$
\f{boundary}(P) = P\setminus\interior(P)
$$ 
and we call this the \deffont{boundary} of $P$.
\item
In the case that $P=\intertwined{p}$ for $p\in\ns P$ then 
$$
\f{boundary}(\intertwined{p})=\intertwined{p}\setminus\interior(\intertwined{p})=\intertwined{p}\setminus\community(p).
$$
\end{enumerate*}
\end{nttn}


Points in the boundary of $\intertwined{p}$ are \emph{not} regular points:
\begin{prop}
\label{prop.boundary.points.not.regular}
\label{prop.char.boundary}
Suppose $(\ns P,\opens)$ is a semitopology and $p,q\in\ns P$ and $q\in\intertwined{p}$.
Then:
\begin{enumerate*}
\item
If $q$ is regular then $q\in\community(p)=\interior(\intertwined{p})$.
\item
If $q$ is regular then $q\not\in\boundary(\intertwined{p})$.
\item
If $q\in\boundary(\intertwined{p})$ then $q$ is either conflicted or not weakly regular (or both).
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $q$ is regular.
By Theorem~\ref{thrm.r=wr+uc} $q$ is unconflicted, so that by Lemma~\ref{lemm.unconflicted.char}(\ref{item.p'.in.unconflicted.p}) $\intertwined{q}\subseteq\intertwined{p}$; and also $q$ is weakly regular, so that $q\in\community(q)\in\opens$ and $\community(q)\subseteq\intertwined{q}\subseteq\intertwined{p}$.
Thus $\community(q)$ is an open neighbourhood of $q$ that is contained in $\intertwined{p}$ and thus $q\in\interior(\intertwined{p})$ as required.
\item
This just repeats part~2 of this result, bearing in mind from Notation~\ref{nttn.boundary} that $q\in\boundary(\intertwined{p})$ if and only if $q\not\in\interior(\intertwined{p})$.
\item
This is just the contrapositive of part~2, combined with Theorem~\ref{thrm.r=wr+uc}.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/counterexample-1.pdf}
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/012a.pdf}
\includegraphics[width=0.32\columnwidth,trim={50 20 50 20},clip]{diagrams/conflicted-and-not-wr.pdf}
\caption{Examples of boundary points (Example~\ref{xmpl.boundary.examples}).}
\label{fig.boundaries}
\end{figure}


\begin{xmpl}
\label{xmpl.boundary.examples}
Proposition~\ref{prop.char.boundary}(3) tells us that points on the topological boundary of $\intertwined{p}$ are either conflicted, or not weakly regular, or perhaps both.
It remains to show that all options are possible.
It suffices to provide examples: 
\begin{enumerate*}
\item
In Figure~\ref{fig.boundaries} (left-hand diagram) the point $\ast$ is on the boundary of $\intertwined{1}=\{\ast,1\}$.
It is unconflicted (being intertwined just with itself and $1$), and not weakly regular (since $\ast\not\in\community(\ast)=\{1\}$). 
\item
In Figure~\ref{fig.boundaries} (middle diagram) the point $1$ is on the boundary of $\intertwined{0}=\{0,1\}$.
It is conflicted (since $0\intertwinedwith 1\intertwinedwith 2$ yet $0\notintertwinedwith 2$) and it is weakly regular (since $1\in\community(1)=\{0,1,2\}$).\footnote{This semitopology is also in Figure~\ref{fig.012}.  We reproduce it here for the reader's convenience so that the examples are side-by-side.}
\item
In Figure~\ref{fig.boundaries} (right-hand diagram) the point $2$ is conflicted (since $1\intertwinedwith 2\intertwinedwith 3$ yet $1\notintertwinedwith 3$) and it is not weakly regular, or even quasiregular (since $\community(2)=\interior(\{1,2,3\})=\varnothing$).
\end{enumerate*} 
Example~3 above illustrates a boundary point that does two things --- be conflicted \emph{and} be non-weakly-regular --- even though examples~1 and~2 already provide examples of boundary points that each do one of these (but not the other).
It would also be nice to be able to build an example that does two (bad) things by composing two smaller examples that do one (bad) thing each --- e.g. by suitably composing examples~1 and~2 above.
In fact this is easy to do using products of semitopologies, but we need a little more machinery for that; see Corollary~\ref{corr.conflicted.and.not.wr}.
\end{xmpl}



We consider the special case of \emph{regular} spaces (we will pick this thread up again in Subsection~\ref{subsect.boundaries.of.closed.sets} after we have built more machinery):
\begin{corr}
\label{corr.bgp}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$. 
Then:
\begin{enumerate*}
\item
If the set $\intertwined{p}$ is regular, then $\boundary(\intertwined{p})=\varnothing$ and $\intertwined{p}$ is clopen (closed and open) and transitive.
\item
If $\ns P$ is a regular space (so every point in it is regular) then $\ns P$ partitions into clopen transitive components given by $\{\intertwined{p} \mid p\in\ns P\}$.
\end{enumerate*}
\end{corr}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
By Proposition~\ref{prop.char.boundary} $\intertwined{p}=\interior(\intertwined{p})$, so by Lemma~\ref{lemm.interior.open} $\intertwined{p}$ is open.
By Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}) $\intertwined{p}$ is closed.
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $p\in\community(p)=\interior(\intertwined{p})\in\topens$.
It follows that $\intertwined{p}$ is (topen and therefore) transitive.
\item
By part~1 of this result each $\intertwined{p}$ is a clopen transitive set.
Using Theorem~\ref{thrm.r=wr+uc} every point is unconflicted and it follows that if $\intertwined{p}\between\intertwined{p'}$ then $\intertwined{p}=\intertwined{p'}$. 
\qedhere\end{enumerate}
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%% 
\subsection{The intertwined preorder}

\subsubsection{Definition and properties}

\begin{rmrk}
Recall the \emph{specialisation preorder} on points from topology, defined by 
$$
p\leq p'
\quad\text{when}\quad
\closure{p}\subseteq\closure{p'}.
$$
In words: we order points $p$ by subset inclusion on their closure $\closure{p}$.

This can also be defined on semitopologies of course, but we will also find a similar preorder interesting, which is defined using $\intertwined{p}$ instead of $\closure{p}$ (Definition~\ref{defn.intertwined.preorder}).
Recall that:
\begin{itemize*}
\item
$\closure{p}$ is a closed set and is equal to the intersection of all the closed sets containing $p$, and 
\item
$\intertwined{p}$ is also a closed set (Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}))
and it is the intersection of all the closed neighbourhoods of $p$ (closed sets with an interior that contains $p$; see Definition~\ref{defn.cn} and Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed})).
\end{itemize*}
\end{rmrk}


\begin{defn}
\label{defn.intertwined.preorder}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate}
\item
Define the \deffont{intertwined preorder} on points $p,p'\in\ns P$ by:
$$
p\leqk p'
\quad\text{when}\quad
\intertwined{p}\subseteq\intertwined{p'}.
$$
As standard, we may write $p'\geqk p$ when $p\leqk p'$ (pronounced `$p'$ is intertwined-less/intertwined-greater than $p$').

Calling this the `intertwined preorder' does not refer to the ordering being intertwined in any sense; it just means that we order on $\intertwined{p}$ (which is read `intertwined-$p$').
\item\label{item.intertwined-bounded}
Call $(\ns P,\opens)$ \deffont{$\intertwinedwith$-complete} (read `\deffont{intertwined-complete}') when 
for every subset $P\subseteq\ns P$ that is totally ordered by $\leqk$, 
there exists some $p\in\ns P$ such that $\intertwined{p}\subseteq \bigcap_i\{\intertwined{p}\mid p\in P\}$.
\end{enumerate}
\end{defn}


\begin{rmrk}
\label{rmrk.intertwinedwith-bounded.natural}
Being $\intertwinedwith$-complete (Definition~\ref{defn.intertwined.preorder}(\ref{item.intertwined-bounded})) is a plausible well-behavedness condition, because important classes of semitopologies are $\intertwinedwith$-complete: 
\begin{enumerate*}
\item
Finite semitopologies, since a descending chain of subsets of a finite set is terminating.
Note that real systems are finite, so assuming that a semitopology is $\intertwinedwith$-complete is justifiable just on these practical grounds.
\item\label{item.intertwinedwith-bounded.natural.chain-bounded}
The strongly chain-complete semitopologies which we consider later in Definition~\ref{defn.chain-complete} are $\intertwinedwith$-complete; see Lemma~\ref{lemm.chain-bounded.implies.intertwinedwith.bounded}. 
\end{enumerate*}
For now, it suffices to just work with what we need for this subsection, which is being $\intertwinedwith$-complete. 
\end{rmrk}


\begin{rmrk}
There is also the \deffont{community preorder} defined such that $p\leq_K p'$ when $\community(p)\subseteq\community(p')$, which is related to $p\leq p'$ via the fact that by definition $\community(p)=\interior(\intertwined{p})$, so that $\leq_K$ is a coarser relation (meaning: it relates more points).
There is an argument that this would sit more nicely with the condition $q\in\community(p)$ in Lemma~\ref{lemm.weakly.regular.community}, but ordering on $\community(p)$ would relate all points with empty community, e.g. all of the points in Figure~\ref{fig.square.diagram}, and would slightly obfuscate the parallel with the specialisation preorder. 
This strikes us as uninutitive, so we prefer to preorder on $\intertwined{p}$. 
\end{rmrk}

\begin{lemm}
\label{lemm.weakly.regular.community}
Suppose $(\ns P,\opens)$ is a semitopology and $p,q\in\ns P$. 
Then:
\begin{enumerate*}
\item
If $q\in\community(p)$ then $q\leqk p$ (meaning that $\intertwined{q}\subseteq\intertwined{p}$).
\item
If $q\in\community(p)$ then $\community(q)\subseteq \community(p)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $q\in\community(p)$ and recall from Lemma~\ref{lemm.two.intertwined}(1)
that $\community(p)\in\opens$, which means that $\closure{\community(p)}$ is a closed neighbourhood of $q$.
We use Proposition~\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures}) and Lemma~\ref{lemm.closure.community.subset}:\footnote{If the reader prefers a proof by concrete calculations, it runs as follows:
Suppose $p'\in\community(p)$, so that in particular $p'\intertwinedwith p$.
We wish to prove that $\intertwined{p'}\subseteq\intertwined{p}$.
So consider $p''\intertwinedwith p'$; we will show that $p''\intertwinedwith p$, i.e. that every pair of open neighbourhoods of $p''$ and $p$ must intersect.
Consider a pair of open neighbourhoods $p''\in O''\in\opens$ and $p\in O\in\opens$.
We note that $O''\between \community(p)$, because $p'\in\community(p)\in\opens$ and $p''\intertwinedwith p'$.
Choose $q\in\community(p)\cap O''$. 
Now $q\intertwinedwith p$ and $q\in O''$ and $p\in O$, and we conclude that $O''\between O$ as required.
}
$$
\intertwined{q} 
\stackrel{P\ref{prop.intertwined.as.closure}(\ref{item.intertwined.as.intersection.of.closures})}{\subseteq} 
\closure{\community(p)} 
\stackrel{L\ref{lemm.closure.community.subset}}{\subseteq} 
\intertwined{p}.
$$
\item
Suppose $q\in\community(p)$.
By part~1 of this result and Definition~\ref{defn.intertwined.preorder} $\intertwined{q}\subseteq\intertwined{p}$.
It is a fact that then $\interior(\intertwined{q})\subseteq\interior(\intertwined{p})$.
By Definition~\ref{defn.tn}(\ref{item.tn}) therefore $\community(q)\subseteq\community(p)$ as required.
\qedhere\end{enumerate}
\end{proof}



In the rest of this Subsection we develop corollaries of Lemma~\ref{lemm.weakly.regular.community} (and compare this with Proposition~\ref{prop.community.partition}):
\begin{corr}
\label{corr.community.intersects.community}
Suppose $(\ns P,\opens)$ is a semitopology and $q,q'\in\ns P$.
Then:
\begin{enumerate*}
\item
If $\community(q)\between\community(q')$ then $q\intertwinedwith q'$.
\item
If $q$ and $q'$ are weakly regular (so that $q\in\community(q)$ and $q'\in\community(q')$) then
$$
q\intertwinedwith q'
\quad\text{if and only if}\quad
\community(q)\between\community(q').
$$
\end{enumerate*}
\end{corr}
\begin{proof} 
We consider each part in turn:
\begin{enumerate}
\item
Suppose $r\in\community(q)\cap\community(q')$.
Then $\intertwined{r}\subseteq\intertwined{q}\cap\intertwined{q'}$ using Lemma~\ref{lemm.weakly.regular.community}(1).
But $q\in\intertwined{r}$, so $q\in\intertwined{q'}$, and thus $q\intertwinedwith q'$.
\item
If $q$ and $q'$ are weakly regular and $q\intertwinedwith q'$ then $\community(q)\between\community(q')$ follows from Definition~\ref{defn.intertwined.points}(1).
The result follows from this and from part~1 of this result.
\qedhere\end{enumerate}
\end{proof}




Theorem~\ref{thrm.K-regular} is somewhat reminiscent of the \emph{hairy ball theorem}:\footnote{This famous result states that every tangent vector field on a sphere of even dimension --- this being the surface of a ball of odd dimension --- must vanish at at least one point.  Intuitively, if we consider a `hairy ball' in three-dimensional space and we try to comb its hairs so they all lie smoothly flat (with no discontinuities in direction), then at least one of the hairs is pointing straight up (i.e. its projection onto the ball is zero).  A nice combinatorial proof is in \cite{doi:10.1080/00029890.2004.11920120}.} 
\begin{thrm}
\label{thrm.K-regular}
Suppose $(\ns P,\opens)$ is an $\intertwinedwith$-complete quasiregular semitopology (Definition~\ref{defn.tn}(\ref{item.quasiregular.point}): a semitopology that is $\intertwinedwith$-complete and whose every point has a nonempty community).
Then:
\begin{enumerate*}
\item
For every $p\in\ns P$ there exists some regular $q\in\community(p)$.
\item
$\ns P$ contains a regular point.
\end{enumerate*}
(See also Proposition~\ref{prop.up.down.wr}, which gives similar result for weak regularity.)
\end{thrm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Consider the subset $\{p'\in\ns P \mid p'\leqk p\}\subseteq\ns P$ ordered by $\leqk $.
Using Zorn's lemma (on $\geqk$), this contains a $\leqk$-minimal element $q'$.
By assumption of quasiregularity $\community(q')\neq\varnothing$, so choose $q\in\community(q')$.
By Lemma~\ref{lemm.weakly.regular.community}(1) $\intertwined{q}\subseteq\intertwined{q'}$ and by $\leqk$-minimality $\intertwined{q}=\intertwined{q'}$ and it follows that $q\in\community(q)$.
Thus $q$ is weakly regular.
Applying similar reasoning to $p'\in\community(q)$ we deduce that $\intertwined{p'}=\intertwined{q}$, and thus $\community(p')=\community(q)$, for every $p'\in\community(q)$, and so by Corollary~\ref{corr.corr.pKp} $q$ is regular.
\item
Choose any $p\in\ns P$, and use part~2 of this result.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
We care about the existence of regular points as these are the ones that are well-behaved with respect to our semitopological model. 
A semitopology with a regular point is one that --- in some idealised mathematical sense --- is capable of some collaboration somewhere to take some action.

So Theorem~\ref{thrm.K-regular} can be read as a guarantee that, provided the semitopology is $\intertwinedwith$-complete and quasiregular, there exists somebody, somewhere, who can make sense of their local network and progress to act.
This a mathematical guarantee and not an engineering one, much as is the hairy ball theorem of which the result reminds us. 
\end{rmrk} 

%%%%%%%%%%%%%%%%%%%%
\subsubsection{Application to quasiregular conflicted spaces}


In Proposition~\ref{prop.unconflicted.irregular}(3) we saw an example of an unconflicted irregular space (illustrated in Figure~\ref{fig.square.diagram}): this is a space in which every point is unconflicted but not weakly regular.
In this subsection we consider a dual case, of a conflicted quasiregular space: a space in which every point is conflicted yet quasiregular.

One question is: does such a creature even exist?
The answer is: 
\begin{itemize*}
\item
no, in the finite case (Corollary~\ref{corr.no.finite.wr.c}); and 
\item
yes, in the infinite case (Proposition~\ref{prop.conflicted.weakly.regular}).
\end{itemize*}



\begin{prop}
\label{prop.weakly.regular.to.regular}
Suppose $(\ns P,\opens)$ is a finite quasiregular semitopology (so $\ns P$ is finite and every $p\in\ns P$ is quasiregular) --- in particular this holds if the semitopology is weakly regular.
Then:
\begin{enumerate*}
\item
For every $p\in\ns P$ there exist some regular $q\in\community(p)$. 
\item
$\ns P$ contains a regular point.
\end{enumerate*}
In words we can say: every finite quasiregular semitopology contains a regular point.
\end{prop}
\begin{proof}
From Theorem~\ref{thrm.K-regular}, since `is finite' implies `is $\intertwinedwith$-complete'.%
\footnote{The proof of Theorem~\ref{thrm.K-regular} uses Zorn's lemma.  A longer, direct proof of Proposition~\ref{prop.weakly.regular.to.regular} is also possible, by explicit induction on size of sets.}
\end{proof}




\begin{corr}
\label{corr.no.finite.wr.c}
There exists no finite quasiregular conflicted semitopology (i.e. a semitopology with finitely many points, each of which is quasiregular but conflicted).
\end{corr}
\begin{proof}
Suppose $(\ns P,\opens)$ is finite and quasiregular.
By Proposition~\ref{prop.weakly.regular.to.regular} it contains a regular $q\in\ns P$ and by Proposition~\ref{prop.unconflicted.irregular}(1) $q$ is unconflicted. 
\end{proof}


\begin{figure}
\centering
\includegraphics[width=0.6\columnwidth]{diagrams/binary-tree.pdf}
\caption{A weakly regular, conflicted space (Proposition~\ref{prop.conflicted.weakly.regular}); the opens are the down-closed sets}
\label{fig.weakly-regular.conflicted}
\end{figure}

Corollary~\ref{corr.no.finite.wr.c} applies to finite semitopologies because these are necessarily $\intertwinedwith$-complete.
The infinite case is different, as we shall now observe:
\begin{prop}
\label{prop.conflicted.weakly.regular}
There exists an infinite quasiregular --- indeed it is also weakly regular --- conflicted semitopology $(\ns P,\opens)$.

In more detail:
\begin{itemize*}
\item
every $p\in\ns P$ is weakly regular (so $p\in\community(p)\in\opens$; see Definition~\ref{defn.tn}(\ref{item.weakly.regular.point})) yet 
\item
every $p\in\ns P$ is conflicted (so $\intertwinedwith$ is not transitive at $p$; Definition~\ref{defn.conflicted}(1)).
\end{itemize*}
Furthermore: $\ns P$ is a topology\footnote{Forward reference: it is also a witness semitopology.  See Lemma~\ref{lemm.w.cwr}.} and contains no topen sets.
\end{prop}
\begin{proof}
Take $\ns P=[01]^*$ to be the set of words (possibly empty finite lists) from $0$ and $1$.
For $w,w'\in\ns P$ write $w\leq w'$ when $w$ is an initial segment of $w'$ and define 
$$
w_\geq = \{w' \mid w\leq w'\}
\quad\text{and}\quad
w_\leq = \{w' \mid w'\leq w\}.
$$
Let open sets be generated as (possibly empty) unions of the $w_\geq$.
This space is illustrated in Figure~\ref{fig.weakly-regular.conflicted}; open sets are down-closed subsets. 

The reader can check that $\neg(w0\intertwinedwith w1)$, because $w0_\geq\cap w1_\geq=\varnothing$, and that $w\intertwinedwith w'$ when $w\leq w'$ or $w'\leq w$.
It follows from the above that 
$$
\intertwined{w}=w_\geq\cup w_\leq
\quad\text{and}\quad 
\community(w)=\interior(\intertwined{w})=w_\geq,
$$
and since $w\in w_\geq$ every $w$ is weakly regular. 
Yet every $w$ is also conflicted, because $w0\intertwinedwith w \intertwinedwith w1$ yet $\neg(w0\intertwinedwith w1)$. 

This example is a topology, because an intersection of down-closed sets is still down-closed.
It escapes the constraints of Theorem~\ref{thrm.K-regular} by not being $\intertwinedwith$-complete.
It contains no topen sets because if it did contain some topen $\atopen$ then by Theorem~\ref{thrm.max.cc.char}(\ref{char.p.regular}\&\ref{char.some.topen}) there would exist a regular $p\in\atopen$ in $\ns P$.
\end{proof}




\subsubsection{(Un)conflicted points and boundaries of closed sets}
\label{subsect.boundaries.of.closed.sets}

Recall from Definition~\ref{defn.cn} that a closed neighbourhood is a closed set with a nonempty interior, and recall that $\intertwined{p}$ --- the set of points intertwined with $p$ from Definition~\ref{defn.intertwined.points} --- is characterised using closed neighbourhoods in Proposition~\ref{prop.closure.intertwined}, as the intersection of all closed neighbourhoods that have $p$ in their interior.

This leads to the question of whether the theory of $\intertwined{p}$ might \emph{be} a theory of closed neighbourhoods.
The answer seems to be no: $\intertwined{p}$ has its own distinct character, as the results and counterexamples below will briefly illustrate. 

For instance: in view of Proposition~\ref{prop.closure.intertwined} characterising $\intertwined{p}$ as an intersection of closed neighbourhoods of $p$, might it be the case that for $C$ a closed neighbourhood, $C=\bigcup\{\intertwined{p} \mid p\in\interior(C)\}$.
In words: is a closed neighbourhood $C$ the union of the points intertwined with its interior? 
This turns out to be only half true:
\begin{lemm}
\label{lemm.ab12}
Suppose $(\ns P,\opens)$ is a semitopology and $C\in\closed$ is a closed neighbourhood.
Then: 
\begin{enumerate*}
\item
$\bigcup\{\intertwined{p} \mid p\in\interior(C)\}\subseteq C$.
\item
This subset inclusion may be strict: it is possible for $p\in\ns P$ to be on the boundary of a closed neighbourhood $C$, but not intertwined with any point in that neighbourhood's interior.
This is true even if $\ns P$ is a regular space (meaning that every $p\in\ns P$ is regular).
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p\in\interior(C)$ then $\intertwined{p}\subseteq C$ by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}).
\item
We provide a counterexample, as illustrated in Figure~\ref{fig.Ast12} (left-hand diagram): 
\begin{itemize*}
\item
$\ns P=\{\ast, 1, 2\}$.
\item
Open sets are generated by $\{1\}$, $\{2\}$, and $\{\ast,2\}$.
\item
We set $p=\ast$ and $C=\{1,\ast\}$.
\end{itemize*}
Then the reader can check that $\interior(C)=\{2\}$ $\intertwined{\ast}=\{\ast,2\}$ and $\ast\notintertwinedwith 2$ and every point in $\ns P$ is regular.
\qedhere\end{enumerate}
\end{proof}

\begin{figure}
\vspace{-2em}
\centering
\subcaptionbox{Regular boundary point of closed neighbourhood that is not intertwined with its interior (Lemma~\ref{lemm.ab12}(2))}{\includegraphics[width=0.4\columnwidth,trim={50 60 50 50},clip]{diagrams/Ast12.pdf}}
\qquad
\subcaptionbox{Regular point in kissing set of closed neighbourhoods, not intertwined with interiors (Lemma~\ref{corr.ab123}(2))}{\includegraphics[width=0.4\columnwidth,trim={50 20 50 50},clip]{diagrams/Ast12b.pdf}}
\caption{Two counterexamples}
\label{fig.Ast12}
\end{figure}


\begin{defn}
Suppose $(\ns P,\opens)$ is a semitopology and $P,P'\subseteq\ns P$.
Then
define 
$$
\f{kiss}(P,P')=\boundary(P)\cap \boundary(P')
$$ 
and call this the \deffont{kissing set} of $P$ and $P'$.
\end{defn}

\begin{lemm}
\label{lemm.kissing.conflict}
Suppose $(\ns P,\opens)$ is a semitopology.
Then the following are equivalent:
\begin{itemize*}
\item
$p$ is conflicted.
\item
There exist $q,q'\in\ns P$ such that $q\notintertwinedwith q'$ and $p\in\kiss(\intertwined{q},\intertwined{q'})$.
\item
There exist $q,q'\in\ns P$ such that $q\notintertwinedwith q'$ and $p\in\intertwined{q}\cap\intertwined{q'}$.
\end{itemize*}
\end{lemm}
\begin{proof}
We prove a cycle of implications:
\begin{itemize}
\item
\emph{Suppose $p$ is conflicted.}\quad

Then there exist $q,q'\in\ns P$ such that $q\intertwinedwith p\intertwinedwith q'$ yet $q\notintertwinedwith q'$.
Rephrasing this, we obtain that $p\in\intertwined{q}\cap\intertwined{q'}$.

We need to check that $p\not\in\community(q)$ and $p\not\in\community(q')$.
We prove $p\not\in\community(q)$ by contradiction ($p\not\in\community(q')$ follows by identical reasoning).
Suppose $p\in\community(q)$.
Then by Lemma~\ref{lemm.weakly.regular.community}(1) $\intertwined{p}\subseteq\intertwined{q}$.
But $q'\in\intertwined{p}$, so $q'\in\intertwined{q}$, so $q'\intertwinedwith q$, contradicting our assumption.
\item
\emph{Suppose $q\notintertwinedwith q'$ and $p\in\boundary(\intertwined{q})\cap\boundary(\intertwined{q'})$.}

Then certainly $p\in\intertwined{q}\cap\intertwined{q'}$.
\item
\emph{Suppose $q\notintertwinedwith q'$ and $p\in\intertwined{q}\cap\intertwined{q'}$.}

Then $q\intertwinedwith p\intertwinedwith q'$ and $q\notintertwinedwith q'$, which is precisely what it means to be conflicted.
\qedhere\end{itemize}
\end{proof}

We can look at Definition~\ref{defn.conflicted} and Lemma~\ref{lemm.kissing.conflict} and conjecture that a point $p$ is conflicted if and only if it is in the kissing set of a pair of distinct closed sets.
Again, this is half true:
\begin{corr}
\label{corr.ab123}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ is conflicted then there exist a pair of closed sets such that $p\in\kiss(C,C')$.
\item
The reverse implication need not hold: it is possible for $p$ to be in the kissing set of a pair of closed sets $C$ and $C'$, yet $p$ is unconflicted.
This is even possible if the space is regular (meaning that every point in the space is regular, including $p$) and $C$ and $C'$ are closed neighbourhoods.
\end{enumerate*}
\end{corr}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $p$ is conflicted then we use Lemma~\ref{lemm.kissing.conflict} and Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.p.closed}).
\item
We provide a counterexample, as illustrated in Figure~\ref{fig.Ast12} (right-hand diagram): 
\begin{itemize*}
\item
$\ns P=\{\ast, 1, 2, 3\}$.
\item
Open sets are generated by $\{1\}$, $\{2\}$, $\{3\}$, and $\{\ast, 2\}$. 
\item
We set $p=\ast$ and $C=\{\ast,1\}$ and $C'=\{\ast, 3\}$.
\end{itemize*}
Note that $\ast$ is regular (being intertwined with itself and $2$), and $C$ and $C'$ are closed neighbourhoods that kiss at $\ast$, and $1$, $2$, and $3$ are also regular. 
\qedhere\end{enumerate}
\end{proof}



\subsection{Regular = quasiregular + hypertransitive}

\begin{rmrk}
In Theorem~\ref{thrm.r=wr+uc} we characterised regularity in terms of weak regularity and being unconflicted.
Regularity and weak regularity are two of the regularity properties considered in Definition~\ref{defn.tn}, but there is also a third: \emph{quasiregularity}.
This raises the question whether there might be some other property $X$ such that regular = quasiregular + $X$?\footnote{By Lemma~\ref{lemm.wr.r}(\ref{item.wr.implies.qr}) being weakly regular is a stronger condition than being quasiregular, thus we would expect $X$ to be stronger than being unconflicted.  And indeed this will be so: see Lemma~\ref{lemm.regular.sc}(\ref{item.sc.implies.uc}).}

Yes there is, and we develop it in this Subsection, culminating with Theorem~\ref{thrm.regular=qr+sc}
\end{rmrk}
 

\subsubsection{Hypertransitivity}

\begin{nttn}
\label{nttn.between.nbhd}
Suppose $(\ns P,\opens)$ is a semitopology and $O'\in\opens$ and $\mathcal O\subseteq\opens$.
\begin{enumerate*}
\item
Write $O'\between\mathcal O$, or equivalently $\mathcal O\between O'$, when $O'\between O$ for every $O\in\mathcal O$.
In symbols:
$$
O'\between\mathcal O
\quad\text{when}\quad
\Forall{O{\in}\mathcal O}O'\between O .
$$
\item\label{item.between.nbhd}
As a special case of part~1 above taking $\mathcal O=\nbhd(p)$ (Definition~\ref{defn.nbhd.system}), if $p\in\ns P$ then write $O'\between\nbhd(p)$, or equivalently $\nbhd(p)\between O'$, when $O'\between O$ for every $O\in\opens$ such that $p\in O$. 
\end{enumerate*}
\end{nttn}

\begin{lemm}
\label{lemm.closure.using.nbhd.intersections}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $O'\in\opens$.
Then 
$$
p\in\closure{O'}
\quad\text{if and only if}\quad 
O'\between\nbhd(p) .
$$
\end{lemm}
\begin{proof}
This just rephrases Definition~\ref{defn.closure}(\ref{item.closure}). 
\end{proof}

\begin{defn}
\label{defn.sc}
Suppose $(\ns P,\opens)$ is a semitopology.
Call $p\in\ns P$ \deffont{hypertransitive} when for every $O',O''\in\opens$, 
$$
O'\between\nbhd(p)\between O''
\quad\text{implies}\quad O'\between O''.
$$
\end{defn}


\begin{lemm}
\label{lemm.sc.op.reg.op}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is hypertransitive.
\item
For every pair of open sets $O',O''\in\opens$, $p\in \closure{O'}\cap \closure{O''}$ implies $O'\between O''$.
\item
For every pair of \emph{regular} open sets $O',O''\in\regularOpens$, $p\in \closure{O'}\cap \closure{O''}$ implies $O'\between O''$ (cf. Remark~\ref{rmrk.intertwined.with.regular.opens}).
\end{enumerate*}
\end{lemm}
\begin{proof}
For the equivalence of parts~1 and~2 we reason as follows:
\begin{itemize*}
\item
Suppose $p$ is hypertransitive and suppose $p\in\closure{O'}$ and $p\in\closure{O''}$.
By Lemma~\ref{lemm.closure.using.nbhd.intersections} it follows that $O'\between\nbhd(p)\between O''$.
By hypertransitivity, $O'\between O''$ as required.
\item
Suppose for every $O,O'\in\opens$, $p\in\closure{O}\cap\closure{O'}$ implies $O'\between O''$, and suppose $O'\between\nbhd(p)\between O''$.
By Lemma~\ref{lemm.closure.using.nbhd.intersections} $p\in\closure{O}\cap\closure{O'}$ and therefore $O'\between O''$.
\end{itemize*}
For the equivalence of parts~2 and~3 we reason as follows: 
\begin{itemize*}
\item
Part~2 implies part~3 follows since every open regular set is also an open set.
\item
To prove that part~3 implies part~2, suppose for every pair of regular open sets $O',O''\in\regularOpens$, $p\in \closure{O'}\cap \closure{O''}$ implies $O'\between O''$, and suppose $O',O''\in\opens$ are two open sets that are not necessarily regular, and suppose $p\in\closure{O'}\cap\closure{O''}$.
We must show that $O'\between O''$.

Write $P'=\interior(\closure{O'})$ and $P''=\interior(\closure{O''})$ and note by Lemma~\ref{lemm.ic.ci.regular} that $P'$ and $P''$ are regular open sets and $\closure{P'}=\closure{O'}$ and $\closure{P''}=\closure{O''}$.
Then $\closure{P'}\between\closure{P''}$, so $P'\between P''$, and $O'\between O''$ follows from Lemma~\ref{lemm.clint.between}
\qedhere\end{itemize*}
\end{proof}



\subsubsection{The corollary}

\begin{lemm}
\label{lemm.regular.sc}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns p$.
Then:
\begin{enumerate*}
\item\label{item.r.implies.sc}
If $p$ is regular then it is hypertransitive.
\item\label{item.sc.implies.uc}
If $p$ is hypertransitive then it is unconflicted.
\item
It is possible for $p$ to be hypertransitive (and unconflicted), but not quasiregular (and thus not weakly regular or regular).
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part:
\begin{enumerate}
\item
Suppose $p$ is regular and $O,O'\in\opens$ and $O\between\nbhd(p)\between O'$.
By Definition~\ref{defn.tn}(\ref{item.regular.point}) (since $p$ is regular) $\community(p)$ is a topen (= open and transitive) neighobourhood of $p$.
By transitivity therefore, $O\between O'$ as required. 
\item
Suppose $p$ is hypertransitive and suppose $p',p''\in\ns P$ and $p'\intertwinedwith p\intertwinedwith p''$.
Now consider $p'\in O'\in\opens$ and $p''\in O''\in\opens$.
By our intertwinedness assumptions we have that $O'\between\nbhd(p)\between O''$.
But $p$ is hypertransitive, so $O'\between O''$ as required.
\item
It suffices to provide an example.
Consider the semitopology illustrated in Figure~\ref{fig.012}, top-right diagram; so $\ns P=\{0,1,2\}$ and $\opens=\{\varnothing,\{0\},\{2\},\{1,2\},\{0,1\},\{0,1,2\}\}$.
The reader can check that $p=1$ is hypertransitive, but $\intertwined{1}=\{1\}$ and $\community(1)=\varnothing$ so $p$ is not quasiregular.
\qedhere\end{enumerate}
\end{proof}

(Yet) another characterisation of being quasiregular will be helpful:
\begin{lemm}
\label{lemm.quasiregular.iff.between}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following conditions are equivalent:
\begin{enumerate*}
\item
$p$ is quasiregular (meaning by Definition~\ref{defn.tn}(\ref{item.quasiregular.point}) that $\community(p)\neq\varnothing$).
\item
$\community(p)\between\nbhd(p)$ (meaning by Notation~\ref{nttn.between.nbhd}(\ref{item.between.nbhd}) that $\community(p)\between O$ for every $O\in\nbhd(p)$).
\item
$p\in\closure{\community(p)}$.
\end{enumerate*}
\end{lemm}
\begin{proof}
Equivalence of parts~2 and~3 is immediate from Lemma~\ref{lemm.closure.using.nbhd.intersections}.

For equivalence of parts~1 and~2, we prove two implications:
\begin{itemize}
\item
Suppose $p$ is quasiregular, meaning by Definition~\ref{defn.tn}(\ref{item.quasiregular.point}) that $\community(p)\neq\varnothing$.
Pick some $p'\in\community(p)$ (it does not matter which).
It follows by construction in Definitions~\ref{defn.intertwined.points}(\ref{intertwined.defn}) and~\ref{defn.tn}(\ref{item.tn}) and Lemma~\ref{lemm.interior.open} that $p'\intertwinedwith p$, so that $p'\in\community(p)$. 
Using Definition~\ref{defn.intertwined.points}(\ref{item.p.intertwinedwith.p'}) it follows that $\community(p)\between O$ for every $O\in\nbhd(p)$, as required.
\item
Suppose $\community(p)\between\nbhd(p)$.
Then in particular $\community(p)\between\ns P$, and by Notation~\ref{nttn.between}(\ref{item.between}) it follows that $\community(p)\neq\varnothing$.
\qedhere\end{itemize}
\end{proof}

Compare and contrast Theorem~\ref{thrm.regular=qr+sc} with Theorem~\ref{thrm.r=wr+uc}:
\begin{thrm}
\label{thrm.regular=qr+sc}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns p$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is regular.
\item
$p$ is quasiregular and hypertransitive.
\end{enumerate*}
\end{thrm}
\begin{proof}
We consider two implications:
\begin{itemize}
\item
\emph{Suppose $p$ is regular.}\quad

Then $p$ is quasiregular by Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}\&\ref{item.wr.implies.qr}), and hypertransitive by Lemma~\ref{lemm.regular.sc}(\ref{item.r.implies.sc}). 
\item
\emph{Suppose $p$ is quasiregular and hypertransitive.}\quad

By Lemma~\ref{lemm.regular.sc}(\ref{item.sc.implies.uc}) $p$ is unconflicted.
If we can prove that $p$ is weakly regular (meaning by Definition~\ref{defn.tn}(\ref{item.weakly.regular.point}) that $p\in\community(p)$), then by Theorem~\ref{thrm.r=wr+uc} it would follow that $p$ is regular as required.
Thus, it would suffice to show that $p\in\community(p)$, thus that there is an open neighbourhood of points with which $p$ is intertwined.

Write $O''=\interior(\ns P\setminus\community(p))$.
We have two subcases to consider:
\begin{itemize*}
\item
\emph{Suppose $\nbhd(p)\between O''$.}\quad

By Lemma~\ref{lemm.quasiregular.iff.between} (since $p$ is quasiregular) we have that $\community(p)\between\nbhd(p)$.
Thus $\community(p)\between\nbhd(p)\between O''$, and by hypertransitivity of $p$ it follows that $\community(p)\between O''$.
But this contradicts the construction of $O''$ as being a subset of $\ns P\setminus\community(p)$, so this case is impossible.
\item
\emph{Suppose $\nbhd(p)\notbetween O''$.}\quad
Then there exists some $O\in\nbhd(p)$ such that $O\notbetween O''$, and it follows that $O\subseteq\community(p)$ so that $p\in\community(p)$ as required.
\end{itemize*}
Thus $p$ is weakly regular, as required.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
\label{rmrk.two.char.r}
So we have obtained two nice characterisations of regularity of points from Definition~\ref{defn.tn}(\ref{item.regular.point}):
\begin{enumerate*}
\item
Regular = weakly regular + unconflicted, by Theorem~\ref{thrm.r=wr+uc}. 
\item
Regular = quasiregular + hypertransitive, by Theorem~\ref{thrm.regular=qr+sc}. 
\end{enumerate*}
It remains an open problem to check whether there is some natural property $X'$ such that regular = indirectly regular + $X'$ (see Definition~\ref{defn.indirectly.regular}).
\end{rmrk}



%%%%%%%%%%%%%%%%%%
\section{The product semitopology} 
\label{sect.product}

Products of semitopologies can be defined just as for topologies.
We do this in Definition~\ref{defn.product.semitopology}, then study how semitopological properties --- like being a (maximal) topen or being a regular point --- interact with products.

\subsection{Basic definitions and results (shared with topologies)} 

\begin{defn}
\label{defn.squares}
Suppose $\ns P_1$ and $\ns P_2$ are sets and suppose $P_1\subseteq\ns P_1$ and $P_2\subseteq\ns P_2$.
Then:
\begin{enumerate}
\item
Call the set 
$$
P_1{\times}P_2=\{(p_1,p_2)\mid p_1\in P_1,\ p_2\in P_2\}
$$ 
a \deffont{square}, and 
\item
call $P_1$ and $P_2$ the \deffont{sides} of the square. 
\end{enumerate}
\end{defn}

\begin{defn}[Product semitopology]
\label{defn.product.semitopology}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
\begin{enumerate}
\item
As for topologies, define the \deffont{product semitopology} $\ns P_1\times\ns P_2$ such that:
\begin{itemize*}
\item
The set of points is the cartesian product $\ns P_1\times\ns P_2$.
\item
Open sets are (possibly empty, possibly infinite) unions of squares $O_1{\times} O_2$ for $O_1\in\opens_1$ and $O_2\in\opens_2$.
By abuse of notation we may write this set $\opens_1\times\opens_2$.
\end{itemize*}
\item
Define the \deffont{first-} and \deffont{second projections} $\pi_1:\ns P_1\times\ns P_2\to \ns P_1$ and $\pi_2:\ns P_1\times\ns P_2\to\ns P_2$ as usual such that $\pi_1(p_1,p_2)=p_1$ and $\pi_2(p_1,p_2)=p_2$.
\item
For this Subsection, if $X$ is a set and $f$ is a function on $X$ then we write $f(X)$ for the \deffont{pointwise application} defined by
$$
f(X) =\{f(x)\mid x\in X\}.
$$
In particular we will use this notation for pointwise application of $\pi_1$ and $\pi_2$ to subsets $P\subseteq\ns P_1\times\ns P_2$.
\end{enumerate}
\end{defn}

\begin{lemm}
\label{lemm.proj.cont}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
Then the first and second projections $\pi_1$ and $\pi_2$ from Definition~\ref{defn.product.semitopology}(2) are
\begin{itemize*}
\item
continuous (inverse image of open set is open / inverse image of closed set is closed), and
\item
open (pointwise image of open set is open).
\end{itemize*}
\end{lemm}
\begin{proof}
By routine calculations, as for topologies; see for example~\cite{engelking:gent}, page~79, just before Example~2.3.10.
\end{proof}


Lemma~\ref{lemm.point.closure.square} below is a special case of a general result from topology~\cite[Lemma~2.3.3, page~78]{engelking:gent} that (in our terminology from Definition~\ref{defn.squares}) the closure of a square is the square of the closure of its sides.
We do need to check that this still works for semitopologies, and it does:
\begin{lemm}
\label{lemm.point.closure.square}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then
$$
\closure{(p_1,p_2)}=\closure{p_1}{\times}\closure{p_2}.
$$
\end{lemm}
\begin{proof}
The closure of a set is the complement of the largest open set disjoint from it.\footnote{That is: the complement of the interior of the complement.} 
By construction in Definition~\ref{defn.product.semitopology}, open sets in the product topology are unions of squares of opens, and the result now just follows noting that for $O_1\in\opens_1$ and $O_2\in\opens_2$, $(p_1,p_2)\in O_1{\times}O_2$ if and only if $p_1\in O_1$ and $p_2\in O_2$. 
\end{proof}


\subsection{Componentwise composition of semitopological properties}
\label{subsect.componentwise.composition}

We prove a sequence of results checking how properties such as being intertwined, regular, weakly, regular, and conflicted relate between a product space and the component spaces.
Most notably perhaps, we show that `being intertwined', `being regular', `being weakly regular', and `being conflicted' hold componentwise --- i.e. the results have the form 
\begin{quote}
``$(\ns P_1,\ns P_2)$ has property $\phi$ if and only if $\ns P_1$ and $\ns P_2$ have $\phi$''.
\end{quote}
We will then use this to generate examples with complex behaviour that is obtained by composing the behaviour of their (simpler) components: see in particular Corollary~\ref{corr.conflicted.and.not.wr} and Theorem~\ref{thrm.nitpicked}.

 

\begin{lemm}[Intersecting squares is componentwise]
\label{lemm.intersecting.squares}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and suppose $O,O'\in\opens_1\times\opens_2$ are squares. 
Then
$$
O\between O'
\quad\text{if and only if}\quad
\pi_1(O)\between\pi_1(O') \ \land\ \pi_2(O)\between\pi_2(O') .
$$
\end{lemm}
\begin{proof}
By routine sets calculations, noting that since $O$ and $O'$ are squares by definition $O=\pi_1(O)\times\pi_2(O)$ and $O'=\pi_1(O')\times\pi_2(O')$.
\end{proof}


\begin{prop}[Being intertwined is componentwise]
\label{prop.product.intertwined}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
Then:
\begin{enumerate*}
\item 
$(p_1,p_2)\between (p_1',p_2')$ if and only if $p_1\between p_1' \ \land\  p_2\between p_2'$.
\item
As an immediate corollary, $\intertwined{(p_1,p_2)} = \intertwined{{p_1}}\times\intertwined{{p_2}}$.
\end{enumerate*}
\end{prop}
\begin{proof}
For part~1 of this result we prove two implications:
\begin{itemize}
\item
\emph{Suppose $p_1\between p_1'$ and $p_2\between p_2'$.}\quad

Consider two open neighbourhoods $O\ni (p_1,p_2)$ and $O'\ni (p_1',p_2')$.
We wish to show that $O\between O'$.

Without loss of generality we may assume that $O$ and $O'$ are squares, since: opens are unions of squares so we just choose squares in $O$ and $O'$ that contain $(p_1,p_2)$ and $(p_1',p_2')$ respectively.
Thus, $O=O_1{\times} O_2$ and $O'=O_1'{\times} O_2'$.

Now $p_1\in O_1$ and $p_1'\in O_1'$ and $p_1\between p_1'$, thus $O_1\between O_1'$.
Similarly for $p_2$ and $p_2'$.
We use Lemma~\ref{lemm.intersecting.squares}.
\item
\emph{Suppose $(p_1,p_2)\between (p_1',p_2')$.}\quad

Then in particular all square open neighbourhoods intersect, and by Lemma~\ref{lemm.intersecting.squares} so must their sides.
\end{itemize}
Part~2 just rephrases part~1 of this result using Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}).
\end{proof}


\begin{corr}[(Maximal) topen is componentwise]
\label{corr.topens.are.squares}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $\atopen\in\opens_1{\times}\opens_2$ is a square.
Then for each of `a topen' / `a maximal topen' below, the following are equivalent:
\begin{itemize*}
\item
$\atopen\in\opens_1{\times}\opens_2$ is a topen / a maximal topen in $\ns P_1\times\ns P_2$.
\item
The sides $\pi_1(\atopen)$ and $\pi_2(\atopen)$ of $\atopen$ are topens / maximal topens in $\ns P_1\times\ns P_2$.
\end{itemize*}
\end{corr}
\begin{proof}
First, we consider the versions without `maximal':
\begin{enumerate}
\item
\emph{Suppose $\atopen\in\opens_1{\times}\opens_2$ is a topen in $\ns P_1\times\ns P_2$.}

By Lemma~\ref{lemm.proj.cont}(2) its sides $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are open.
Now consider $p_1,p_1'\in\pi_1(\atopen)$ and choose any $p_2\in\pi_2(\atopen)$.
We know $(p_1,p_2)\between(p_1',p_2)$ must hold, because both points are in $\atopen$ and by Theorem~\ref{thrm.cc.char} all points in $\atopen$ are intertwined.
By Proposition~\ref{prop.product.intertwined}(1) it follows that $p_1\between p_1'$.
Since $p_1$ and $p_1'$ were arbitrary in $\pi_1(\atopen)$ it follows using Theorem~\ref{thrm.cc.char} again that $\pi_1(\atopen)$ is topen. 

The reasoning for $\pi_2(\atopen)$ is precisely similar.
\item
\emph{Suppose $T_1\in\opens_1$ and $T_2\in\opens_2$ are topen in $\ns P_1\times\ns P_2$.}

By construction in Definition~\ref{defn.product.semitopology} the square $T_1{\times}T_2$ is open, and it follows using Proposition~\ref{prop.product.intertwined}(1) and Theorem~\ref{thrm.cc.char} that $T_1{\times}T_2$ is topen.
\end{enumerate}
We now consider maximality:
\begin{enumerate}
\item
\emph{Suppose $\atopen\in\opens_1{\times}\opens_2$ is a maximal topen in $\ns P_1\times\ns P_2$.}

By our reasoning above its sides are topens, but if those sides were not maximal topens --- so at least one of them is included in a strictly larger topen --- then, again using our reasoning above, we could use obtain a larger topen square in $\opens_1{\times}\opens_2$, contradicting maximality of $\atopen$.
\item 
\emph{Suppose $T_1\in\opens_1$ and $T_2\in\opens_2$ are maximal topens in $\ns P_1$ and $\ns P_2$.}

By our reasoning above the square $T_1{\times}T_2$ is a topen.
If it were not a maximal topen --- so it is included in some strictly larger topen $\atopen$ --- then by our reasoning above $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are also topens and one of them would have to be larger than $T_1$ or $T_2$, contradicting their maximality.
\qedhere\end{enumerate}
\end{proof}

\begin{corr}[Regular is componentwise]
\label{corr.regular.pair}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then the following are equivalent:
\begin{itemize*}
\item
$(p_1,p_2)$ is regular in $\ns P_1\times\ns P_2$. 
\item
$p_1$ is regular in $\ns P_1$ and $p_2$ is regular in $\ns P_2$.
\end{itemize*}
\end{corr}
\begin{proof}
Suppose $(p_1,p_2)$ is regular.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.p.regular}\&\ref{char.some.topen}) it has a topen neighbourhood $\atopen$.
Using Corollary~\ref{corr.topens.are.squares} $\pi_1(\atopen)$ and $\pi_2(\atopen)$ are topen neighbourhoods of $p_1$ and $p_2$ respectively.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.p.regular}\&\ref{char.some.topen}) $p_1$ and $p_2$ are regular.

If conversely $p_1$ and $p_2$ are regular then we just reverse the reasoning of the previous paragraph. 
\end{proof}



Proposition~\ref{prop.wr.pair} does for `is conflicted' and `is weakly regular' what Corollary~\ref{corr.regular.pair} does for `is regular'.
With the machinery we now have, the argument is straightforward:
\begin{prop}[Unconflicted \& weakly regular is componentwise]
\label{prop.wr.pair}
Suppose $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies and suppose $p_1\in\ns P_1$ and $p_2\in\ns P_2$.
Then:
\begin{enumerate*}
\item
$(p_1,p_2)$ is unconflicted in $\ns P_1\times\ns P_2$ if and only if $p_1$ is unconflicted in $\ns P_1$ and $p_2$ is unconflicted in $\ns P_2$.
\item
$(p_1,p_2)$ is weakly regular in $\ns P_1\times\ns P_2$ if and only if $p_1$ is weakly regular in $\ns P_1$ and $p_2$ is weakly regular in $\ns P_2$.
\end{enumerate*}
\end{prop}
\begin{proof}
For part~1 we prove two implications:
\begin{itemize}
\item
\emph{Suppose $(p_1,p_2)$ is unconflicted.}
We will show that $p_1$ is unconflicted (the case of $p_2$ is precisely similar).

Consider $p',p''\in \ns P_1$ and suppose $p'\intertwinedwith p_1\intertwinedwith p''$.
Using Proposition~\ref{prop.product.intertwined}(1) $(p',p_2)\intertwinedwith (p_1,p_2)\intertwinedwith (p'',p_2)$, by transitivity (since we assumed $(p_1,p_2)$ is unconflicted) $(p',p_2)\intertwinedwith (p'',p_2)$, and using Proposition~\ref{prop.product.intertwined}(1) we conclude that $p'\intertwinedwith p''$ as required.

\emph{Suppose $p_1$ and $p_2$ are unconflicted.}
We will assume $(p_1',p_2')\intertwinedwith (p_1,p_2)\intertwinedwith (p_1'',p_2'')$ and prove $(p_1',p_2')\intertwinedwith(p_1'',p_2'')$.

Using Proposition~\ref{prop.product.intertwined}(1) $p_1'\intertwinedwith p_1\intertwinedwith p_1''$ and by transitivity (since we assumed $p_1$ is unconflicted) we have $p_1'\intertwinedwith p_1''$.
Similarly $p_2'\intertwinedwith p_2''$, and using Proposition~\ref{prop.product.intertwined}(1) $(p_1',p_2')\intertwinedwith (p_1'',p_2'')$ as required. 
\end{itemize}
Part~2 follows by routine reasoning just combining part~1 of this result and Corollary~\ref{corr.regular.pair} with Theorem~\ref{thrm.r=wr+uc}.  
\end{proof}


We now have the machinery that we need to make good on a promise made at the end of Example~\ref{xmpl.boundary.examples}:
\begin{corr}
\label{corr.conflicted.and.not.wr}
There exists a semitopology $(\ns P,\opens)$ and points $p,q\in\ns P$ such that 
\begin{itemize*}
\item
$q$ is on the boundary of $\intertwined{p}$ and 
\item
$q$ is conflicted and not weakly regular.
\end{itemize*}
\end{corr}
\begin{proof}
We already know this from Example~\ref{xmpl.boundary.examples}(3), as illustrated in the right-hand diagram in Figure~\ref{fig.boundaries},
but now we can give a more principled construction:
we let $(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ be the first and second examples from Example~\ref{xmpl.boundary.examples}, as illustrated in Figure~\ref{fig.boundaries} (left-hand and middle figure).

The point $\ast\in\ns P_1$ is on the boundary of $\intertwined{1}$ and it is 
unconflicted and not weakly regular.
The point $1\in\ns P_2$ is on the boundary of $\intertwined{0}$ and it is 
conflicted and weakly regular.
It follows from Proposition~\ref{prop.wr.pair} that $(\ast,1)$ is conflicted and not weakly regular.

By Proposition~\ref{prop.product.intertwined}(2) $\intertwined{(1,0)}=\intertwined{1}\times\intertwined{0}$, and by some routine topological calculation we see that $(\ast,1)$ is on the boundary of this set.
\end{proof}
 





%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Minimal closed neighbourhoods, with an application to a counterexample}

We continue the development of Subsection~\ref{subsect.componentwise.composition} and the example in Corollary~\ref{corr.conflicted.and.not.wr} with some slightly more technical results, leading up to another example. 

\begin{lemm}
\label{lemm.minimal.squares}
Suppose that:
\begin{itemize*}
\item
$(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies. 
\item
$C$ is a square (Definition~\ref{defn.squares}) in $\ns P_1\times\ns P_2$. 
\end{itemize*}
Then 
\begin{itemize*}
\item
if $C$ is a minimal closed neighbourhood in $\ns P_1\times\ns P_2$, 
\item
then the sides of $C$, $C_1=\pi_1(C)$ and $C_2=\pi_2(C)$, are minimal closed neighbourhoods in $\ns P_1$ and $\ns P_2$ respectively.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $C$ is a square minimal closed neighbourhood, and consider $C_1'\subseteq C_1$ a closed neighbourhood in $\ns P_1$.
We will show that $C_1'=C_1$ (the argument for $\ns P_2$ is no different).
Using Lemma~\ref{lemm.proj.cont}, $C_1'{\times}C_2$ is a closed neighbourhood in $\ns P_1\times\ns P_2$.
By routine sets calculations and minimality we have that $C_1'{\times}C_2 = C_1{\times}C_2$, and it follows that $C_1'=C_1$.
\end{proof}



\begin{corr}
\label{corr.neighbourhood.up}
Suppose that:
\begin{itemize*}
\item
$(\ns P_1,\opens_1)$ and $(\ns P_2,\opens_2)$ are semitopologies.
\item
$p_2\in\ns P_2$.
\item
$\intertwined{{p_2}}$ is not a minimal closed neighbourhood of $p_2$.
\end{itemize*}
Then for every $p_1\in\ns P_1$ and for every $C$ a minimal closed neighbourhood of $(p_1,p_2)$, we have that $\intertwined{(p_1,p_2)}\subsetneq C$. 
\end{corr}
\begin{proof}
By Proposition~\ref{prop.product.intertwined}(2) $\intertwined{(p_1,p_2)}=\intertwined{{p_1}}{\times}\intertwined{{p_2}}$ and by Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) $\intertwined{(p_1,p_2)}\subseteq C$.

If $C=\intertwined{(p_1,p_2)}=\intertwined{{p_1}}{\times}\intertwined{{p_2}}$ then by 
Lemma~\ref{lemm.minimal.squares} its side $\intertwined{{p_2}}$ is a minimal closed neighbourhood of $p_2$, but we assumed this is not the case.
Thus, $\intertwined{(p_1,p_2)}\subsetneq C$ as required.
\end{proof}



\begin{rmrk}
Recall that Proposition~\ref{prop.closure.intertwined}(1) shows that $\closure{p}\subseteq\intertwined{p}$, and Example~\ref{xmpl.closure.101} shows that this inclusion may be strict by giving a semitopology in which $\closure{p}\subsetneq\intertwined{p}$.
Recall also that it follows from Proposition~\ref{prop.intertwined.as.closure}(\ref{intertwined.as.closure.closed}) that $\intertwined{p}\subseteq C$ for any $C$ a (minimal) closed neighbourhood of $p$, and Example~\ref{xmpl.not.intertwined} shows that this inclusion may be strict by giving a semitopology in which $\intertwined{p}\subsetneq C$ for $C$ a minimal closed neighbourhood of $p$.
What we have not done so far is show that both inclusions may be strict \emph{for a single $p$}: we can now apply what we have shown about the product semitopology in this Subsection, to `glue' our examples together: 
\end{rmrk}

\begin{thrm}
\label{thrm.nitpicked}
There exists a semitopology $(\ns P,\opens)$ and a $p\in\ns P$ and a minimal closed neighbourhood $C$ of $p$ such that the inclusions below are strict: 
$$
\closure{p} \subsetneq \intertwined{p} \subsetneq C .
$$ 
\end{thrm}
\begin{proof}
Let $(\ns P_1,\opens_1)$ be the semitopology from Example~\ref{xmpl.closure.101}, and $(\ns P_2,\opens_2)$ be that from Example~\ref{xmpl.not.intertwined}.
We set:
\begin{itemize*}
\item
$(\ns P,\opens)=(\ns P_1,\opens_1)\times(\ns P_2,\opens_2)$, the product semitopology.
\item
$p_1=1\in\ns P_1$, for which $\closure{1}\subsetneq\intertwined{1}=\{0,1\}$, and 
\item
$p_2=(0,0)$, which has a minimal closed neighbourhood $A=\{(0,0),(1,0)\}$ which is not equal to $\intertwined{{p_2}}=\intertwined{(0,0)}=\{(0,0)\}$, and
\item
$C=\{0,1\}{\times}\{(0,0), (1,0)\}$.
\end{itemize*}
We show that $\closure{(p_1,p_2)}\subsetneq\intertwined{(p_1,p_2)}$, as follows:
$$
\begin{array}{r@{\ }l@{\qquad}l}
\closure{(p_1,p_2)}
=&
\closure{p_1}{\times}\closure{p_2}
&\text{Lemma~\ref{lemm.point.closure.square}}
\\
\subsetneq&
\intertwined{{p_1}}{\times}\closure{p_2}
&\closure{1}\subsetneq \intertwined{1}
\\
\subseteq&
\intertwined{{p_1}}{\times}\intertwined{{p_2}}
&\text{Proposition~\ref{prop.closure.intertwined}(1)} .
\end{array}
$$
Furthermore, by Corollary~\ref{corr.neighbourhood.up} $\intertwined{(p_1,p_2)}\subsetneq C$, because $\intertwined{{p_2}}\subsetneq A$.
\qedhere
\end{proof}



\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.4\columnwidth]{diagrams/counterexample-1.pdf}
\vspace{-2em}
\caption{Example~\ref{xmpl.nitpick}: $\closure{\ast}\subsetneq\intertwined{\ast}\subsetneq \{0,1,\ast\}$}
\label{fig.nitpick}
\end{figure}

\begin{xmpl}
\label{xmpl.nitpick}
We now give a smaller, but less compositional, example for Theorem~\ref{thrm.nitpicked}.
Set 
\begin{itemize*}
\item
$\ns P=\{0,1,2,\ast\}$ and 
\item
let $\opens$ be generated by $\{0\}$, $\{1\}$, $\{2\}$ (so $\{0,1,2\}$ has the discrete semitopology) and by $\{0,1,\ast\}$, and $\{1,2,\ast\}$,
\end{itemize*}
as illustrated in Figure~\ref{fig.nitpick} (we used this same example in Figure~\ref{fig.boundaries}, left-hand diagram).
Then: 
\begin{itemize*}
\item
$\closure{\ast}=\{\ast\}$, because $\{0,1,2\}$ is open.
\item
$\intertwined{\ast}=\{1,\ast\}$, since $\{1,2,\ast\}$ is disjoint from $\{0\}$ and $\{0,1,\ast\}$ is disjoint from $\{2\}$.
\item
$\{0,1,\ast\}$ and $\{1,2,\ast\}$ are distinct minimal closed neighbourhoods of $\ast$, with open interiors $\{0,1\}$ and $\{1,2\}$ respectively.
\end{itemize*}
\end{xmpl}


%%%%%%%%%%%%%%%%%%%%%
\section{Computing semitopologies: witnessed sets and the witness semitopology}
\label{sect.witness}


\subsection{Discussion}

\begin{rmrk}
\label{rmrk.local}
In this Section, we turn to the problem of computing with semitopologies.
We want two things from our maths: 
\begin{itemize*}
\item
that it will deliver algorithms; and also 
\item
that these algorithms should be \deffont{local}, by which we mean \emph{executable by points knowing only information near (local) to them, by communicating with local peers}.
\end{itemize*}
In particular, a local algorithm should not assume that points can globally synchronise or agree.\footnote{Indeed, to do this would be to assume a solution to the problem that semitopologies were created to study.}

We now note that our notion of `open neighbourhood of a point' from semitopologies is not \emph{a priori} particularly local.
The simplest illustration is perhaps to note that $(\ns P,\opens)=(\mathbb N,\{\varnothing,\mathbb N\})$ expresses that points coordinate on whether they all agree, but the lack of locality shows up in the mathematics in other, perhaps unexpected ways, because we can encode nontrivial information in the structure of open sets.
Consider the following example of a semitopology with (by design) poor algorithmic behaviour:
\end{rmrk}

\begin{xmpl}
\label{xmpl.uncomputable.semitopology}
Let the \deffont{uncomputable semitopology} have 
\begin{itemize*}
\item
$\ns P=\mathbb N$ and 
\item
open sets generated as unions of \emph{uncomputable subsets} of $\mathbb N$.
\end{itemize*}
(Call a subset $U\subseteq\mathbb N$ \emph{uncomputable} when there is no algorithm that inputs $n\in\mathbb N$ and returns `true' if $n\in U$ and `false' if $n\not\in U$.)
This is a semitopology.
It is not a topology, since the intersection of two uncomputable subsets need not be uncomputable. 
By construction, no algorithm can compute its open sets.
\end{xmpl}



\begin{rmrk}
\label{rmrk.computational.content}
Example~\ref{xmpl.uncomputable.semitopology} just comes from the fact that the definition of semitopologies involves a subset of the (powerset of) $\mathbb N$.
This is not unusual, and the existence of such uncomputable subsets is well-known~\cite[Theorem~XVIII, page~360]{church:unspen}.

What we should do now is determine and study algorithmically tractable semitopologies.
So: what is an appropriate and useful definition?
 
In this Section will identify a class of algorithmically tractable semitopologies, and furthermore this in the strong sense that the definition is clean, makes a novel connection to declarative programming, and from it we extract distributed and local algorithms in the sense discussed above.
To do this, we will define witnessed sets (Definition~\ref{defn.witnessed.set}) and show that they determine computationally tractable semitopologies in a sense made formal by results including 
\begin{itemize*}
\item
Propositions~\ref{prop.open.limit} and~\ref{prop.lim.is.closure} (which show that algorithms exist to compute open and closed sets) and 
\item
the remarkable Theorem~\ref{thrm.lim.O.open} (which shows intuitively that witness semitopologies behave locally like finite sets, even if they are globally infinite). 
\end{itemize*}
\end{rmrk}

The impatient reader can jump to Remarks~\ref{rmrk.computing.open.sets} and~\ref{rmrk.computing.closed.sets}, where we describe these algorithms.
They are described at a high level, but what matters is that they exist, and
what is nice about them is that they correspond to natural (semi)topological operations.


%%%%%%%%%%%%%%%%%%%%%
\subsection{The witness function and semitopology}

\begin{nttn}
\label{nttn.finpow}
We extend Notation~\ref{nttn.powerset}.
Suppose $\ns P$ is a set.
\begin{itemize*}
\item
Write $\powerset_{\neq\varnothing}(\ns P)$ for the nonempty powerset of $\ns P$ (the set of nonempty subsets of $\ns P$).
\item
Write $\finpow(\ns P)$ for the finite powerset of $\ns P$ (the set of finite subsets of $\ns P$).
\item
Write $\finpow_{\neq\varnothing}(\ns P)$ for the finite nonempty powerset of $\ns P$ (the set of finite nonempty subsets of $\ns P$).
\end{itemize*}
\end{nttn}



\begin{defn}
\label{defn.witnessed.set}
Suppose $\ns P$ is a set. 
Then:
\begin{enumerate*}
\item\label{witness.function}
A \deffont{witness function} $\witness$ on $\ns P$ is a function
$$
\witness:\ns P\to\finpow_{\neq\varnothing}(\powerset_{\neq\varnothing}(\ns P)) . 
$$
Call a pair $(\ns P,\witness)$ of a set and a witness function on that set, a \deffont{witnessed set}.
\item\label{witness.witness}
If $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ then call $w\in\witness(p)$ a \deffont{witness-set} for $p$ and say that the witness-set $w$ \deffont{witnesses} $p$.
\end{enumerate*}
In words: a witness function $\witness$ assigns to every $p\in\ns P$ a nonempty finite family of nonempty subsets of $\ns P$; the elements of $\witness(p)$ are called the witness-sets of $p$.
\end{defn}


\begin{rmrk}
There is design freedom whether we want to include (or exclude) $p\in w\in\witness(p)$: Definition~\ref{defn.witnessed.set} makes no commitment either way.
Lemma~\ref{lemm.might.as.well} below expresses a mathematical sense in which this choice does not really matter, so that we can choose whatever is most convenient for a particular case (we use it later, to prove Lemma~\ref{lemm.more-than-one}).

But, if we have a reasonable intuition of a witness-set $w\in\witness(p)$ as being a set of points that $p$ trusts or will take into account when it determines its next action or belief, then having $p\not\in w$ is like a person reading a newspaper article that they were not involved in writing.
\end{rmrk}


\begin{rmrk}\leavevmode
\begin{enumerate}
\item
A witness function $\witness$ gives rise to a relation in $\ns P\times\powerset_{\neq\varnothing}(\ns P)$ by taking 
$$
p\mathrel{\witness}w \quad\text{when}\quad
w\in\witness(p).
$$
\item
If we read the relation from right-to-left then for each $w\in\witness(p)$ we can read $w$ as an abstract notion of `potential evidence for determining the beliefs or actions of $p$'. 
\item
The nonemptiness conditions implies that every $p$ is witnessed by some nonempty $\varnothing\neq w\in\witness(p)$ --- even if $w$ is just equal to $\{p\}$. 
\end{enumerate} 
\end{rmrk}


\begin{defn}
\label{defn.trust.topology}
Suppose $(\ns P,\witness)$ is a witnessed set (Definition~\ref{defn.witnessed.set}).
\begin{enumerate*}
\item
Call $O\subseteq\ns P$ \deffont{$\witness$-witnessed} --- or just \deffont{witnessed} for short if meaning is clear --- when
$$
\Forall{p\in O} \Exists{w{\in}\witness(p)}w\subseteq O .
$$
In words, $O$ is witnessed when every $p\in O$ is accompanied in $O$ by some witnessing witness-set $w\in\witness(p)$. 
\item\label{item.witness.semitopology}
Let the \deffont{witness semitopology} $\opens(\witness)$ on $\ns P$ be the set of $\witness$-witnessed sets.
In symbols:
$$
\opens(\witness) = \{O\subseteq\ns P \mid \text{$O$ is $\witness$-witnessed} \} =  
\{ O\subseteq \ns P \mid \Forall{p\in O} \Exists{w{\in}\witness(p)}w\subseteq O \}.
$$ 
\end{enumerate*}
\end{defn}

\begin{lemm}
Suppose $(\ns P,\witness)$ is a witnessed set.
Then $\opens(\witness)$ from Definition~\ref{defn.trust.topology} is indeed a semitopology in the sense of Definition~\ref{defn.semitopology}.
\end{lemm}
\begin{proof}
Routine from the definitions.
\end{proof}



\begin{lemm}
\label{lemm.might.as.well}
Suppose $(\ns P,\witness)$ is a witnessed set.
Let $\witness'$ and $\witness''$ be defined by\footnote{The case-split in $\witness''$ is required just because witness function in Definition~\ref{defn.witnessed.set}(\ref{witness.function}) must return a finite set of \emph{nonempty} sets.}
$$
\begin{array}{r@{\ }l}
\witness'(p)=&\{w\cup\{p\} \mid w\in\witness(p)\} 
\\
\witness''(p)=&\{w\setminus\{p\} \mid w\in\witness(p)\land w\neq\{p\}\}\cup\{w \mid w\in\witness(p)\land w=\{p\}\} 
\end{array}
$$
Then $(\ns P,\witness')$ and $(\ns P,\witness'')$ are also witnessed sets, and they generate the same witness semitopology as does $(\ns P,\witness)$.
\end{lemm}
\begin{proof}
By a routine calculation.
\end{proof}


\begin{rmrk}
Intuitively, $O\subseteq\ns P$ is open when every $p\in O$ is witnessed by some witness-set $w\in\witness(p)$ such that $w\subseteq O$. 

Note that $O$ need not contain \emph{every} witness-set of $p$: the condition in Definition~\ref{defn.trust.topology} is existential ($\Exists{w{\in}\witness(p)}w\subseteq O$), not universal.

We will use declarative programming to give an interpretation of witness functions as Horn clause theories in Subsection~\ref{subsect.declarative.witness}.
But first, we give examples and develop the motivating theory.
\end{rmrk} 




%%%%%%%%%%%%%%%%%%%
\subsection{Examples} 

\begin{rmrk}
\leavevmode
\begin{itemize*}
\item
Sometimes, proving the existence of a witness function $\witness$ to generate a given semitopology $(\ns P,\opens)$ as a witness semitopology (Definition~\ref{defn.trust.topology}) is fairly straightforward.
Lemma~\ref{lemm.finite.witness} gives a natural example of this.
\item
Sometimes, the existence of a witness function is less evident.
Lemma~\ref{lemm.all-but-one} illustrates one example of a non-obvious witness function for a semitopology, and Lemma~\ref{lemm.more-than-one} conversely illustrates an apparently not dissimilar semitopology, but for which no witness function exists.
\end{itemize*}
\end{rmrk}

\begin{lemm}
\label{lemm.finite.witness}
Suppose $(\ns P,\opens)$ is a \emph{finite} semitopology (so $\ns P$ is finite, and so is $\opens$). 
Then $(\ns P,\opens)$ can be generated as witness semitopology.
Thus: every finite semitopology is also a witness semitopology for a witnessed set.\footnote{The reader might consider Lemma~\ref{lemm.finite.witness} to be a satisfactory answer to the open problem we describe later in Remark~\ref{rmrk.two.open.problems}, since all semitopologies realisable in the real world are finite.
We are not so sure --- even if all you care about is physically realisable semitopologies --- for reasons outlined in Remark~\ref{rmrk.why.infinite}.}  
\end{lemm}
\begin{proof}
Set $\witness(p)=\{O\in\opens \mid p\in O\}$.
The reader can check that this satisfies the finiteness conditions on a witness function in Definition~\ref{defn.witnessed.set}; it remains to show that $\opens(\witness)=\opens$.
If $X\in\opens(\witness)$ then by Definition~\ref{defn.trust.topology}(1) $X$ is a union of open sets, and thus $X\in\opens$. 
Conversely, if $O\in\opens$ then $O\in\opens(\witness)$ because each $p\in O$ is witnessed by $O$.
\end{proof}


\begin{lemm}
\label{lemm.all-but-one}
Consider the \emph{all-but-one semitopology} on $\mathbb Z$ from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}): 
\begin{itemize*}
\item
$\ns P=\mathbb Z$ and 
\item
$\opens = \{ \varnothing,\ \mathbb Z\} \cup \{\mathbb Z{\setminus}\{i\}\mid i\in\mathbb Z\}$.
\end{itemize*}
Then a witness function for this semitopology is: 
$$
\witness(i)=\{ \{i\minus 1, i\plus 1\},\ \mathbb Z\setminus\{i\plus 1\},\ \mathbb Z\setminus\{i\minus 1\} \} 
$$
\end{lemm}
\begin{proof}
We prove that $\opens=\opens(\witness)$ by checking two subset inclusions.
\begin{itemize}
\item
\emph{We check that if $O\in\opens$ then $O\in\opens(\witness)$:}

If $O=\varnothing$ or $O=\mathbb Z$ then there is nothing to prove.
So suppose $O = \mathbb Z\setminus \{i\}$.

We must show that every $j\in O$ is witnessed by some element $w_j\in\witness(j)$.
This is routine:
\begin{itemize*}
\item
For $j\not\in\{i\minus 1,i\plus 1\}$ we use witness-set $\{j-1,j+1\}$; 
\item
for $j=i\minus 1$ we use witness-set $\mathbb Z\setminus \{j\plus 1\}$; and 
\item
for $j=i\plus 1$ use witness-set $\mathbb Z\setminus \{j\minus 1\}$.
\end{itemize*}
\item
\emph{We check that if $O\in\opens(\witness)$ then $O\in\opens$.}

If $O=\varnothing$ or $O = \mathbb Z$ then there is nothing to prove.
So suppose $O\not\in\{\varnothing,\mathbb Z\}$.

Then there exists an $i\in\mathbb Z$ such that $i\in O$ and $\{i\minus 1,i\plus 1\}\not\subseteq O$.
We assumed $O\in\opens(\witness)$, so one of the following must hold:
\begin{itemize*}
\item
$\{i\minus 1,i\plus 1\}{\subseteq} O$, which we assumed is not the case, or
\item
$i\plus 1\not\in O$ and $\mathbb Z\setminus\{i\plus 1\}\subseteq O$, so we are done because, with $O\neq \mathbb Z$, it must be that $O=\mathbb Z\setminus\{i\plus 1\}$, or
\item
$i\minus 1\not\in O$ and $\mathbb Z\setminus\{i\minus 1\}\subseteq O$, and again we are done.
\qedhere\end{itemize*}
\end{itemize}
\end{proof}


\begin{lemm}
\label{lemm.w.cwr}
A witness function for the semitopology used in Proposition~\ref{prop.conflicted.weakly.regular}, as illustrated in Figure~\ref{fig.weakly-regular.conflicted}, is
$$
\witness(w)=\{\{w0,w1\}\}.
$$
\end{lemm}
\begin{proof}
Setting $\witness(w)=\{\{w0,w1\}\}$ just expresses that if $w\in O$ then $w0,w1\in O$, i.e. that $O$ is down-closed --- for `down' as illustrated in Figure~\ref{fig.weakly-regular.conflicted}.
\end{proof}

Lemma~\ref{lemm.more-than-one} will provide a key counterexample later in Lemma~\ref{lemm.elaborating}:
\begin{lemm}
\label{lemm.more-than-one}
Consider the \emph{more-than-one semitopology} on $\mathbb N$ from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.more-than-one}): so $X=\mathbb N$ and opens have the form $\varnothing$ or any set of cardinality more than one (i.e. containing at least two elements).
There is no witness function for this semitopology.
\end{lemm}
\begin{proof}
Suppose some such witness function $\witness$ exists.
Using Lemma~\ref{lemm.might.as.well} we may assume without loss of generality that $n\in w$ for every $w\in\witness(n)$ for every $n\in\mathbb N$.
Furthermore because no singletons are open, we know that $\{n\}\not\in\witness(n)$ for every $n\in\mathbb N$.

Now consider two distinct $n\neq n'\in\mathbb N$
We know that $\{n,n'\}$ is open, so it follows that one of the following must hold: 
\begin{enumerate*}
\item
\emph{Suppose $\{n,n'\}\in\witness(n)$ and $\{n,n'\}\not\in\witness(n')$.}\quad

This is impossible because $\{n'\}\not\in\witness(n')$ and $\witness(n')$ is not empty, so $\{n,n'\}$ could not be open. 
\item
\emph{Suppose $\{n,n'\}\in\witness(n')$ and $\{n,n'\}\not\in\witness(n)$.}\quad

This is also impossible because $\{n\}\not\in\witness(n)$ and $\witness(n)$ is not empty, so $\{n,n'\}$ could not be open. 
\item
It follows that $\{n,n'\}\in\witness(n)$ and $\{n,n'\}\in\witness(n')$.
\end{enumerate*}
It follows that $\{n,n'\}\in\witness(n)$ for \emph{every} $n'$ other than $n$.
But this contradicts finiteness of $\witness(n)$.
\end{proof}



%%%%%%%%%%%%%%%%
\subsection{Computing open and closed sets in witness semitopologies}


%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Computing open sets: $X$ is open when $X\witno X$}

\begin{defn}
\label{defn.prec}
Suppose that $(\ns P,\witness)$ is a witnessed set (Definition~\ref{defn.witnessed.set}) and $X,X'\subseteq\ns P$.
Define the \deffont{witness ordering} by 
$$
X\witno X'
\quad\text{when}\quad
X\subseteq X' 
\ \land\  
\Forall{p{\in}X}\Exists{w{\in}\witness(p)}w\subseteq X' .
$$ 
If $X\witno X$ then call $X$ a \deffont{$\witno$-fixedpoint}. 
\end{defn}

\begin{rmrk}
Intuitively, $X\witno X'$ when $X'$ extends $X$ with (at least) one witness-set for every element $p\in X$.
\end{rmrk} 

\begin{lemm}
Suppose $(\ns P,\witness)$ is a witnessed set, and recall the witness ordering $\witno$ from Definition~\ref{defn.prec}.
Then:
\begin{enumerate*}
\item
If $X\witno X'$ then $X\subseteq X'$, or in symbols: ${\witno}\subseteq{\subseteq}$.
\item
$\witno$ is a transitive ($X\witno X'\witno X''$ implies $X\witno X''$) and antisymmetric ($X\witno X'$ and $X'\witno X$ implies $X=X'$) relation on $\powerset(\ns P)$. 
\end{enumerate*}
\end{lemm}
\begin{proof}
By routine calculations from Definition~\ref{defn.prec}.
\end{proof}

\begin{lemm}
\label{lemm.char.prec.open}
\label{lemm.obvious.open}
Suppose $(\ns P,\witness)$ is a witnessed set. 
Then the following are equivalent:
\begin{itemize*}
\item
$O$ is open in the witness semitopology (Definition~\ref{defn.trust.topology}).
\item
$O$ is a $\witno$-fixedpoint (Definition~\ref{defn.prec}).
\end{itemize*}
In symbols:
$$
\opens(\witness) = \{ X\subseteq\ns P \mid X\witno X\} .
$$
\end{lemm}
\begin{proof}
Being a $\witno$-fixedpoint in Definition~\ref{defn.prec} --- every point in $O$ is witnessed by a subset of $O$ --- simply reformulates the openness condition from Definition~\ref{defn.trust.topology}.
\end{proof}


\begin{prop}
\label{prop.open.limit}
\label{prop.prec.upchain}
Suppose $(\ns P,\witness)$ is a witnessed set and suppose $\mathcal X=(X_0\witno X_1\witno\dots)$ is a countably ascending $\witno$-chain.
Write $\bigcup \mathcal X$ for the union $\bigcup_i X_i$ of the elements in $\mathcal X$.
Then:
\begin{enumerate*}
\item
$\bigcup\mathcal X$ is a $\witno$-limit for $\mathcal X$.
In symbols: $\Forall{i}X_i\witno\bigcup\mathcal X$.
\item
$\bigcup\mathcal X$ is a $\witno$-fixedpoint and so (by Lemma~\ref{lemm.char.prec.open}) is open.
In symbols: $\bigcup\mathcal X\witno\bigcup\mathcal X\in\opens(\witness)$.
\end{enumerate*} 
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
We must show that if $p\in X_i$ then $w\subseteq\bigcup\mathcal X$ for some $w\in\witness(p)$.
But this is automatic from the fact that $X_i\witno X_{i\plus 1}\subseteq\bigcup\mathcal X$.
\item
From part~1 noting that if $p\in\bigcup\mathcal X$ then $p\in X_i$ for some $i$.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}[Computing open sets]
\label{rmrk.computing.open.sets}
Proposition~\ref{prop.open.limit} and Lemma~\ref{lemm.obvious.open} above are not complicated\footnote{This is a feature and did not happen by accident: it required design effort.} 
and they say something important: in the \emph{witness} semitopology, open sets can be computed with a simple loop that accumulates a set of points; and for each point in the set so far, add some choice of witness-set of that point to the set (if one is not already present); repeat until we reach a fixed point; then return the result.

In more detail, to compute an open set in the witness semitopology: 
\begin{enumerate*}
\item
Nondeterministically choose an initial $R_0$ --- in particular, to compute an open neighbourhood of $p\in\ns P$ we can set $R_0=\{p\}$.
\item
Given $R_i$, for each $p\in R_i$ nondeterministically pick some witness-set $w(p)\in\witness(p)$ and set $R_{i\plus 1}=R_i\cup\bigcup_{p\in R_i}w(p)$.
\item
If $R_{i\plus 1}=R_i$ then terminate with result $R_i$; otherwise loop back to~2.
\end{enumerate*}
This algorithm is nondeterministic and could run forever if $\ns P$ is infinite, but it is an algorithm and it is local in the sense of Remark~\ref{rmrk.local}.
We continue this thread in Remarks~\ref{rmrk.computing.closed.sets} and~\ref{rmrk.algorithms}. 
\end{rmrk}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Computing closed sets using limit points: $\closure{P}=\f{lim}(P)$}


\begin{defn}
\label{defn.O.between.R}
Suppose $P$ is a set and $\mathcal W$ is a set (or a sequence) of sets.
Define $P\between \mathcal W$ by
$$
P\between\mathcal W
\quad\text{when}\quad
\Forall{W{\in}\mathcal W}P\between W .
$$
In words: $P\between \mathcal W$ when $P$ intersects with every $W\in\mathcal W$.
\end{defn}

\begin{defn}
\label{defn.admires}
Suppose $(\ns P,\witness)$ is a witnessed set and $P\subseteq\ns P$.
Define $\f{lim}_w(P)$ by
$$
\f{lim}_w(P) = P \cup \{p\in\ns P \mid P\between\witness(p) \} .
$$ 
In words: $\f{lim}_w(P)$ is the set of points $p$ whose every witness-set contains a $P$-element.

We iterate this:
$$
\begin{array}{r@{\ }l@{\quad}l}
\f{lim}_0(P) =& P
\\
\f{lim}_{i\plus 1}(P)=&\f{lim}_w(\f{lim}_i(P))
\\
\f{lim}(P)=&\bigcup_{n\geq 0}\f{lim}_n(P)
\end{array}
$$
We call $\f{lim}(P)$ the set of \deffont{limit points} of $P$.
\end{defn}

\begin{rmrk}
In Definition~\ref{defn.witnessed.set}(\ref{witness.function}) we insisted that $\witness(p)$ is nonempty for every point $p$.
This avoids a degenerate situation in the definition of $\f{lim}_w(P)$ in Definition~\ref{defn.admires} above in which the condition $P\between \witness(p)$ is vacuously satisfied by a $p$ with empty $\witness(p)$ (i.e. by a $p$ with no witness sets).
Definition~\ref{defn.witnessed.set}(\ref{witness.function}) excludes this by insisting that $p$ has to have at least one witness, even if it is just $\witness(p)=\{\{p\}\}$.
\end{rmrk}

\begin{lemm}
\label{lemm.R.subset.lim.R}
Suppose $(\ns P,\witness)$ is a witnessed set and $P\subseteq\ns P$.
Then 
$$
P\subseteq\f{lim}(P).
$$
\end{lemm}
\begin{proof}
It is a fact of Definition~\ref{defn.admires} that $P=\f{lim}_0(P)\subseteq\f{lim}_1(P)\subseteq\f{lim}(P)$. 
\end{proof}

\begin{lemm}
\label{lemm.limit.is.open}
Suppose $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ and $P\subseteq\ns P$.
Then:
\begin{enumerate*}
\item
If $\f{lim}(P)\between\witness(p)$  (Definition~\ref{defn.O.between.R}) then $p\in \f{lim}(P)$.
\item
By the contrapositive and expanding Definition~\ref{defn.O.between.R},
$$
p\in \ns P\setminus\f{lim}(P)
\quad\text{implies}\quad
\Exists{w{\in}\witness(p)}w\cap \f{lim}(P)=\varnothing. 
$$
\end{enumerate*}
\end{lemm}
\begin{proof}
Suppose $\f{lim}(P)\between\witness(p)$.
Unpacking Definitions~\ref{defn.O.between.R} and~\ref{defn.admires} it follows that for every $w{\in}\witness(p)$ there exists $n_w\geq 0$ such that $\f{lim}_{n_w}(P)\between w$.
Now by Definition~\ref{defn.witnessed.set}(\ref{witness.function}) $\witness(p)$ --- the set of witness-sets to $p$ --- is finite, and 
it follows that for some/any $n$ greater than the maximum of all the $n_w$, we have $\f{lim}_n(P)\between\witness(p)$.
Thus $p\in\f{lim}_w(\f{lim}_n(P))\subseteq\f{lim}(P)$ as required.
\end{proof}

\begin{lemm}
\label{lemm.O.between.lim.R}
Suppose $(\ns P,\witness)$ is a witnessed set and $p\in\ns P$ and $P\subseteq\ns P$ and $O\in\opens(\witness)$.
Then:
\begin{enumerate*}
\item
If $O\between \f{lim}_w(P)$ then $O\between P$.
\item
If $O\between \f{lim}(P)$ then $O\between P$.
\item
As a corollary, if $O\cap P=\varnothing$ then $O\cap\f{lim}(P)=\varnothing$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Consider $p\in\ns P$ such that $p\in O$ and $p\in\f{lim}_w(P)$.
By assumption there exists $w\in\witness(p)$ such that $w\subseteq O$.
Also by assumption $w\between P$.
It follows that $O\between P$ as required.
\item
If $O\between\f{lim}(P)$ then $O\between\f{lim}_n(P)$ for some finite $n\geq 0$.
By a routine induction using part~1 of this result, it follows that $O\between P$ as required.
\item
This is just the contrapositive of part~2 of this result, noting that $O\between P$ when $O\cap P=\varnothing$ by Notation~\ref{nttn.between}, and similarly for $O\between\f{lim}(P)$.
\qedhere\end{enumerate}
\end{proof}

\begin{prop}
\label{prop.lim.is.closure}
Suppose $(\ns P,\witness)$ is a witnessed set and suppose $P\subseteq\ns P$.
Then:
$$
\f{lim}(P) = \closure{P} .
$$
In words: the set of limit points of $P$ from Definition~\ref{defn.admires} is equal to the topological closure of $P$ from Definition~\ref{defn.closure}.
\end{prop}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
\emph{Suppose $p\not\in\closure{P}$.}\quad

Then there exists some $p\in O\in\opens(\witness)$ such that $O\cap P=\varnothing$.
Thus by Lemma~\ref{lemm.O.between.lim.R}(3) also $O\cap\f{lim}(P)=\varnothing$. 
\item
\emph{Suppose $p\not\in \f{lim}(P)$.}\quad

By Definition~\ref{defn.closure} we need to exhibit an $p\in O\in\opens(\witness)$ that is disjoint from $P$, and since $P\subseteq\f{lim}(P)$ by Lemma~\ref{lemm.R.subset.lim.R}, 
it would suffice to exhibit $p\in O\in\opens(\witness)$ that is disjoint from $\f{lim}(P)$.
We set 
$$
O=\ns P\setminus \f{lim}(P).
$$
Lemma~\ref{lemm.limit.is.open}(2) expresses precisely that this is an open set in the witness semitopology, and by construction it is disjoint from $\f{lim}(P)$.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}[Computing closed sets]
\label{rmrk.computing.closed.sets}
As in Remark~\ref{rmrk.computing.open.sets} we see that in the \emph{witness} semitopology, closed sets can be computed with a simple loop that accumulates a set of points so far: and for each point in the space, if all of its witness-sets intersect with the set of points so far, add that point to the set so far; repeat until we reach a fixed point; return the result. 

In more detail, to compute a closed set in the witness semitopology: 
\begin{enumerate*}
\item
Nondeterministically choose an initial $P_0$ --- in particular, to compute a closed set containing $p\in\ns P$ we can set $P_0=\{p\}$.
\item
Given $P_i$, for every $p\in \ns P$ check if $w\between P_i$ for every witness-set $w\in\witness(p)$ and collect these $p$ into a set $B_i$.
Set $P_{i\plus 1}=P_i\cup B_i$.
\item
If $P_{i\plus 1}=P_i$ then terminate with result $P_i$; otherwise loop back to~2.
\end{enumerate*}

This algorithm could run forever if $\ns P$ is infinite, but it is an algorithm and it is local in the sense of Remark~\ref{rmrk.local}.
Note that quantification over every point is local in the sense of Remark~\ref{rmrk.local}, in spite of the quantification over all $p\in\ns P$ in step~2 above: participants would listen for queries from peers on the channel ``I am trying to compute an open set; here is my $R_i$; do you want to join it?''.
\end{rmrk}




\begin{rmrk}[Summing up]
\label{rmrk.distributed.witnesses}
From a distributed-computing perspective, it might at first appear that working with semitopologies would require some form of prior coordination: e.g.\ for participants to at least have common knowledge of their shared, minimal open neighbourhoods.
For, consider a new participant $p$ joining a permissionless system based on semitopology: how is $p$ supposed to know which are the open sets?

Suprisingly, we have seen that \emph{witness semitopologies can be built without any coordination}.
Each participant just unilateraly chooses a set of witness-sets.
As discussed in Remarks~\ref{rmrk.computing.open.sets} and \ref{rmrk.computing.closed.sets}, and even in an infinite semitopology, 
a participant can compute open and closed sets --- they do not have to, but they can if they wish to spend the bandwidth --- by exploring witness-sets using nondeterministic algorithms. 

We make no claims to efficiency (we have not even set up machinery in this paper to measure what that would mean) but what matters is that for witness semitopologies such procedures exist, in contrast e.g.\,to the uncomputable semitopology from Example~\ref{xmpl.uncomputable.semitopology}.

In the next subsection we offer an interpretation of witness functions that in some sense explains why this should be so,
and gives a new intuition of why witness semitopologies are amenable to a distributed, local, uncoordinated computation in the style that we require.
\end{rmrk}


\subsection{Declarative content of witness semitopologies}
\label{subsect.declarative.witness}

\subsubsection{Witnessed sets and Horn clause theories}

\begin{rmrk} 
\label{rmrk.algorithms}
Recall that a \emph{sequential space} is one in which the sets closed under convergent sequences, are precisely the closed sets.
Proposition~\ref{prop.lim.is.closure} ($\f{lim}(P) = \closure{P}$) looks, just a bit, like a sequential space closure result.
Looking more closely, we see that the similarity comes from the fact that the definition uses an $\omega$-iteration that is, just a little, reminiscent of a converging $\omega$-sequence of points. 
Perhaps surprisingly, we can make this resemblance into something much more precise, as follows: 
\end{rmrk}



\begin{defn}
\label{defn.logic}
Suppose $(\ns P,\witness)$ is a finite witnessed set (so $\ns P$ is a finite set).
\begin{enumerate}
\item
Let the \deffont{derived logic} $\tf{Prop}(\ns P,\witness)$ be a propositional syntax with connectives $\tbot$, $\ttop$, $\tor$, $\tand$, and $\timp$ over a set of \deffont{atomic proposition symbols} $\bar{\ns P}=\{\bar p\mid p\in\ns P\}$.

Note that $\bar p$ is just a symbol in our formal syntax; there is one such for each point $p\in\ns P$.
\item\label{item.logic.axiom}
For each $p\in\ns P$ define an \deffont{axiom}\footnote{Below, $\tand$ and $\tor$ denote a finite list of $\tand$ and $\tor$ connectives.  We use this instead of $\bigwedge$ and $\bigvee$ to emphasise that this is formal syntax in $\tf{Prop}(\ns P,\witness)$.}
$$
\bar\witness(p) = \bigl( \tand_{w\in\witness(p)} \tor_{q\in w} \bar q\bigr) \timp \bar p 
$$
and collect these axioms into a set
$$
\tf{Ax}(\ns P,\witness) = \{\bar\witness(p)\mid p\in\ns P\}.
$$
\item
A \deffont{sequent} $\Phi\barcent\Psi$ is a pair of finite sets of propositions in the syntax of $\tf{Prop}(\ns P,\witness)$.
\item
Call $\Phi\barcent\Psi$ \deffont{derivable} when $\Phi,\tf{Ax}(\ns P,\witness)\cent\Psi$ is derivable in propositional logic.
\item\label{item.S.deductively.closed}
If $S\subseteq\ns P$ write $\bar S=\{\bar p\mid p\in S\}$.
Call $\bar S$ a \deffont{model} or \deffont{answer set} for $\tf{Ax}(\ns P,\witness)$ when 
$$
\Forall{p{\in}\ns P}(\bar S\barcent \bar p \limp \bar p\in\bar S).
$$
\end{enumerate}
\end{defn}


\begin{prop}[Declarative interpretation]
\label{prop.declarative.interpretation}
Suppose $(\ns P,\witness)$ is a finite witnessed set and $S\subseteq\ns P$.
Then the following are equivalent: 
\begin{itemize*}
\item
$S$ is closed in the witness semitopology (Definition~\ref{defn.trust.topology}).
\item
$\bar S$ is a model (Definition~\ref{defn.logic}(\ref{item.S.deductively.closed})).
\end{itemize*}
\end{prop}
\begin{proof}
The condition for $T\subseteq\ns P$ to be an open set (Definition~\ref{defn.trust.topology}) can be written as 
$$
p\in T \limp \Exists{w{\in}\witness(p)}\Forall{q{\in}w} q\in T .
$$
Taking the contrapositive we derive 
$$
\bigl(\Forall{w{\in}\witness(p)}\Exists{q{\in}w} q\not\in T \bigr) \limp p\not\in T . 
$$
If we write $S=\ns P\setminus T$ and $q{\in}S$ as $\bar q$ and $p{\in}S$ as $\bar p$, then we recover the axiom $\bar\witness(p)$ from Definition~\ref{defn.logic}.

It follows by routine reasoning that $S$ is a model for $\tf{Ax}(\ns P,\witness)$ if and only if $S$ is the complement of an open set; and by Lemma~\ref{lemm.closed.complement.open} this is precisely when $S$ is closed. 
\end{proof}

\begin{corr}
\label{corr.finite.witness.horn}
Every finite semitopology can be exhibited as the set of (set complements of) models of a propositional Horn clause theory.
\end{corr}
\begin{proof}
Lemma~\ref{lemm.finite.witness} shows how to exhibit a finite semitopology as the witness semitopology of a witnessed set, and Proposition~\ref{prop.declarative.interpretation} shows how to interpret that witnessed set as a Horn clause theory in a propositional logic.
\end{proof}

\begin{rmrk}
\label{rmrk.horn}
An axiom $\bar\witness(p)$ consists of a propositional goal implied by a conjunction of disjunctions of (unnegated) propositional goals.  
This fits the Horn clause syntax from Section~3 of~\cite{miller:unipfl}, and it can be translated into a more restricted Prolog-like syntax if required, just by expanding the disjuncts into multiple clauses using the \rulefont{\tor L} rule.\footnote{An example makes the point: $((\bar q\tor\bar q')\tand\bar q'') \timp\bar p$ is equivalent to two simpler clauses $(\bar q\tand \bar q'')\timp\bar p$ and $(\bar q'\tand\bar q'')\timp \bar p$; for more details see~\cite{miller:unipfl}.} 

Thus closed sets --- and so also open sets, which are their complements --- can be computed from the axioms $\tf{Ax}(\ns P,\witness)$ by asking a suitable propositional solver to compute \emph{models}. 
Answer Set Programming (ASP) tool is one such tool~\cite{lifshitz:whaasp,lifshitz:anssp}.
Thus:
\begin{itemize*}
\item
We can view the algorithm for computing closed sets described in Remark~\ref{rmrk.computing.closed.sets} as `just' (see next Remark) a distributed ASP solver for the Horn clause theory $\tf{Ax}(\ns P,\witness)$ in the logic $\tf{Prop}(\ns P,\witness)$.
\item
Conversely, we can view this Subsection as observing that the set of all solutions to a finite Horn clause theory has a semitopological structure, via witnessed sets.
\end{itemize*}
\end{rmrk}

\begin{rmrk}
Proposition~\ref{prop.declarative.interpretation} 
is not a `proof' that we should, or even could, actually use an ASP solver to do this.

Proposition~\ref{prop.declarative.interpretation} assumes complete and up-to-date information on the witness function.
Mathematically this is fine, just as writing `consider an uncomputable subset of $\mathbb N$' is mathematically fine --- we can prove that this exists.
As a \emph{computational} statement about possible implementations, this is more problematic, because it is precisely the point of a network being permissionless, that we do not suppose that a participant could ever collect a global snapshot of the network state; and if they somehow did, it could become out-of-date; and in any case, in the presence of failing or adversarial participants it could be inaccurate.
So just because there \emph{is} a network state at some point in time, does not mean we have access to it.

Even mathematically, Proposition~\ref{prop.declarative.interpretation} is not the full story of (witness) semitopologies: 
\begin{itemize*}
\item
it concerns \emph{finite} semitopologies, whereas we are also interested in \emph{infinite} ones (see Remark~\ref{rmrk.why.infinite}); and
\item
the questions we ask in the mathematics --- especially the second-order ones such as ``Are these two points intertwined?'' or ``Find a maximal topen neighbourhood of this point, or confirm that none such exists.'' --- have not been considered in declarative programming, so far as we know. 
\end{itemize*} 
So it is important to appreciate that while Proposition~\ref{prop.declarative.interpretation} characterises closed and open sets in a witness semitopology in terms of solutions to Horn clause theories, and so helps us to understand what these sets really are at a mathematical level, this is not in and of itself automatically useful to actually turning such a semitopology into working permissionless network --- for that, we need algorithms like that described in Remark~\ref{rmrk.computing.closed.sets} --- nor is it a full mathematical account of all the facts of interest about semitopologies.

One practical use case where the correspondence with declarative programming might be immediately useful would be a monitoring tool, especially one testing mathematical properties to detect leading indicators of network malfunction.
Thus, for a network that is operating well and not changing too quickly, it would be feasible to traverse the network collecting information, and then use something like an ASP solver as part of a monitoring tool to compute the closed and open sets and so monitor properties such as the current intertwinedness of the network.
This is fine, so long as the reader is clear that a (centralised) network monitor that works in good conditions is not the same thing as the robust distributed network itself.
\end{rmrk}
 

\subsubsection{Witnessed sets and topologies}

If finite semitopologies can be thought of as sets of solutions to Horn clause theories via witnessed sets, as outlined in Corollary~\ref{corr.finite.witness.horn}, what do finite topologies correspond to? 
We will find answers just by unrolling definitions and doing some simple reasoning, but the results are perhaps illuminating and a little bit surprising:

\begin{defn}
\label{defn.deterministic}
\leavevmode
\begin{enumerate*}
\item
Call a semitopology $(\ns P,\opens)$ \deffont{deterministic} when each point $p$ has a unique least open neighbourhood $p\in M_p\in\opens$.
\item
Call a Horn clause theory (in the sense used in Definition~\ref{defn.logic}(\ref{item.logic.axiom})) \deffont{deterministic} when for each propositional atom $\bar p\in\bar{\ns P}$ there exists at most one axiom in which $\bar p$ appears in its head.\footnote{The \emph{head} of the axiom is its final propositional atom, written to the right-hand side of the $\timp$ in Definition~\ref{defn.logic}(\ref{item.logic.axiom}).} 
\item
Call a witnessed set $(\ns P,\witness)$ (Definition~\ref{defn.witnessed.set}(\ref{witness.function})) \deffont{deterministic} when for each point $p$, $\witness(p)$ is a singleton set; thus $\witness(p)=\{W_p\}$.\footnote{$W_p$ (the witness-set to $p$) is not necessarily equal to $M_p$ (the least open set containing $p$).  The witness function \emph{generates} a witness semitopology, but is not necessarily \emph{equal} to it.}
In words: $\witness$ is deterministic when \emph{every point has precisely one (possibly empty) witness-set}. 
\end{enumerate*}
\end{defn}

\begin{rmrk}
Recall the algorithms for computing open and closed sets from witness functions from Remarks~\ref{rmrk.computing.open.sets} and~\ref{rmrk.computing.closed.sets}.
When $\witness$ is deterministic, the algorithms simplify: there is precisely one witness-set to each point, and this removes the \emph{nondeterminism} from the algorithms and they become deterministic --- as our choice of name in Definition~\ref{defn.deterministic} suggests. 
\end{rmrk}

\begin{lemm}
\label{lemm.top.det}
Suppose $(\ns P,\opens)$ is a finite semitopology.
Then the following are equivalent:
\begin{enumerate*}
\item
$(\ns P,\opens)$ is a topology (intersections of open sets are open).
\item
$(\ns P,\opens)$ is a deterministic semitopology (every $p\in\ns P$ has a unique least open neighbourhood $M_p\in\opens$).
\end{enumerate*}
\end{lemm}
\begin{proof}
Suppose $(\ns P,\opens)$ is a topology and consider some $p\in\ns P$.
We must find a least open neighbourhood $p\in M_p$.
We just set $M_p=\bigcap\{O\in\opens \mid p\in O\}$.
Open sets in topologies are closed under finite unions, so $M_p$ is an open neighbourhood of $p$, and by construction it is least.

Suppose $(\ns P,\opens)$ is deterministic and consider $O,O'\in\opens$.
We must show that $O\cap O'$ is open.
We just note that $O\cap O'=\bigcup\{M_p \mid p\in O\cap O'\}$.
This is a union of open sets and so an open set, and by construction it contains $O\cap O'$.
But also it is contained in $O\cap O'$, since if $p\in O$ then $M_p\subseteq O$, and similarly for $O'$.
\end{proof}


\begin{rmrk}
Returning to the terminology \emph{deterministic} in Definition~\ref{defn.deterministic} above: when we are doing resolution in the Horn clause theory, and when we are building an open set using the algorithm in Remark~\ref{rmrk.computing.open.sets}, there is only ever one witness/clause for each point.
Thus resolution never has to backtrack; and building the open set never has to make any choices.
\end{rmrk}

\begin{lemm}
\label{lemm.top.horn}
Suppose $(\ns P,\opens)$ is a finite semitopology.
Then the following are equivalent:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a topology.
\item
$(\ns P,\opens)=(\ns P,\opens(\witness))$ for some deterministic witness function $\witness$ on $\ns P$.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $(\ns P,\opens)$ is a topology.
We just modify the construction from Lemma~\ref{lemm.finite.witness} and set $\witness(p)=\{M_p\}$.
The reader can check that $\opens=\opens(\witness)$. 

Conversely, suppose $\opens=\opens(\witness)$ for deterministic $\witness$, and write $\witness(p)=\{W_p\}$.
Now consider $O,O'\in\opens$; we need to show that $O\cap O'\in\opens$.
By the construction of the witness semitopology in Definition~\ref{defn.trust.topology}(\ref{item.witness.semitopology}) it would suffice to show that if $p\in O\cap O'$ then $W_p\subseteq O\cap O'$.
But this is immediate, since $O,O'\in\opens(\witness)$ so that if $p\in O$ then $W_p\subseteq O$, and similarly for $O'$.
\end{proof}

\begin{prop}
\label{prop.det}
Suppose $(\ns P,\opens)$ is a finite semitopology.
Then the following are equivalent:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a topology.
\item
$(\ns P,\opens)$ is a deterministic semitopology. 
\item
$(\ns P,\opens)$ is the witness semitopology of a deterministic witness function.
\end{itemize*}
\end{prop}
\begin{proof}
We combine Lemmas~\ref{lemm.top.det} and~\ref{lemm.top.horn}. 
\end{proof}

\begin{rmrk}
The definitions and proofs in this Subsection are quite easy, but they capture a nice intuition which is not immediately obvious from just looking at the definitions: 
\begin{itemize*}
\item
Finite semitopologies correspond to computation with nondeterminism and backtracking.
\item
Finite topologies correspond to computation that does not require backtracking.
\end{itemize*}
Proposition~\ref{prop.det} makes this intuition formal up to a point, but it is not the full story.
What is missing is that a semitopology may have more than one presentation as the witness semitopology of a witnessed set.\footnote{Let's spell that out: it is possible for $\opens=\opens(\witness)=\opens(\witness')$ for distinct $\witness$ and $\witness'$.}
In particular, it is possible to create a non-deterministic witness function that generates a topology; intuitively, just because there might be a choice of witness-set, does not mean that the choice makes any difference to the final result.
Put another way: \emph{determinism} ensures that backtracking is impossible, but nondeterminism not necessarily imply that it is \emph{required}.\footnote{Think of reducing a simply-typed $\lambda$-calculus term; there are many reduction paths, but they all lead to the same normal form.}

We speculate that Proposition~\ref{prop.det} could be strengthened to show that topologies correspond to Horn clause theories that (may not be deterministic in the sense of Definition~\ref{defn.deterministic}, but that) do not require backtracking.
We leave this for future work. 
\end{rmrk}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{(Strongly) chain-complete semitopologies}
\label{sect.cc.cb}

\subsection{Definition and discussion}


\begin{rmrk}
\label{rmrk.not.chain-complete}
Just as for topologies, in semitopologies it is not true in general that the intersection of a descending chain of open sets is open.

Consider $\mathbb N$ with the semitopology generated by $O\subseteq\mathbb N$ such that $\{0\}\subsetneq O$.
Then $(\{0\}\cup i_\geq\mid i\geq 1)$ where $i_\geq=\{i'\mid i'\geq i\}$ is a descending chain of open sets, but its intersection $\{0\}$ is not open.

For the special case of \emph{witness} semitopologies, we can say something considerably stronger, as we shall see in Definition~\ref{defn.chain-complete} and Theorem~\ref{thrm.lim.O.open}.
\end{rmrk} 




Recall from Definition~\ref{defn.ascending.chains} the notion of an ascending/descending \emph{chain of sets}:
\begin{defn}
\label{defn.chain-complete}
\leavevmode
\begin{enumerate*}
\item\label{item.chain-complete}
Call a semitopology \deffont{chain-complete} when for every descending chain of open sets $\mathcal O\subseteq\opens$ (Definition~\ref{defn.ascending.chains}), its intersection $\bigcap\mathcal O$ is open.
\item\label{item.chain-bounded}
Call a semitopology \deffont{strongly chain-complete} when for every nonempty descending chain of nonempty open sets $\mathcal O\subseteq\opens_{\neq\varnothing}$, its intersection $\bigcap\mathcal O$ is open and nonempty.\footnote{We insist the chain is nonempty to exclude the pathological case of an empty chain over the semitopology $(\varnothing,\{\varnothing\})$.} 
\end{enumerate*}
\end{defn}

\begin{rmrk}[Chain-completeness in context]
We make a few general observations about Definition~\ref{defn.chain-complete} in the context of topology: 
\begin{enumerate}
\item
The strong chain-completeness condition (every descending chain of nonempty open sets is nonempty and open) is reminiscent of, though different from, a standard \emph{compactness} condition on metric spaces, that every descending chain of nonempty closed sets should be nonempty and closed.
\item
Call a topological space \deffont{Alexandrov} when its open sets are closed under arbitrary (and not just finite) intersections.

In the case that a semitopology $(\ns P,\opens)$ is a topology (so open sets are closed under finite intersections), and assuming that open sets can be well-ordered, being chain-complete is equivalent to being Alexandrov.
Clearly, an Alexandrov space is chain-complete; and conversely if we have an infinite collection of open sets in a chain-complete topology then (assuming that this collection can be well-ordered) we obtain their intersection by a transfinite induction taking limits of infinite descending chains of intersections.

The Alexandrov condition is unnatural in semitopologies in the sense that we do not assume even that finite intersections exist, so there is no finite-intersections condition to strengthen to the infinite case.
However, the chain-completeness condition \emph{is} natural in semitopologies, so in the light of the previous paragraph we could argue that chain-completeness is to semitopologies as being Alexandrov is to topologies. 

This is an intuitive observation, not a mathematical one, but it may help to guide the reader's intuitions.
\item
Strong chain-completeness has a much stronger flavour of finiteness than chain-completeness.

For example: a strongly chain-complete space can contain only finitely many disjoint open sets --- since otherwise it would be easy to form an infinite descending chain of open sets with an empty intersection --- so, in the light of the topen partitioning result in Theorem~\ref{thrm.topen.partition}, we see that the topen partition of a strongly chain-complete semitopology is \emph{actually finite}.
\end{enumerate}
\end{rmrk}

\begin{rmrk}
\label{rmrk.cc.natural}
Definition~\ref{defn.chain-complete} abstracts two useful properties of two important classes of semitopologies:
\begin{enumerate*}
\item
Every finite semitopology is strongly chain-complete, because a strictly descending chain of finite sets is finite.\footnote{For the record, it is easy to come up with other conditions.  For instance, an even stronger condition is that a descending chain of open sets strictly above some $O\in\opens$ has an open intersection that is also strictly above $O$ (we recover the strong chain-completeness condition just by restricting $O$ to be equal to $\varnothing$).  This is a very reasonable thing to say: it is in a footnote and not the main text just because we have not (yet) found a direct use for it.  In contract, strong chain-completeness turns out to be natural and very useful, so we focus on that.} 
\item
Every witness semitopology is chain-complete; we will prove this shortly, in Theorem~\ref{thrm.lim.O.open}.
\end{enumerate*}
More discussion of these points is in Remark~\ref{rmrk.plausible.abstraction}.
The main mathematical/technical properties that come out of a semitopology being chain-complete and strongly chain-complete are respectively:
\begin{itemize*}
\item
Lemma~\ref{lemm.zorn.for.open.covers} and Corollary~\ref{corr.cover.exists} (existence of open covers), and 
\item
Lemma~\ref{lemm.zorn.for.atoms} and Corollary~\ref{corr.atom.exists} (existence of open atoms) respectively.
\end{itemize*}
However, before we come to that, we will set up some machinery and check some useful properties.
\end{rmrk}


\subsection{Elementary properties of the definition} 


\begin{lemm}
\label{lemm.strongly.chain-complete.implies.chain-complete}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If $(\ns P,\opens)$ is strongly chain-complete, then it is chain-complete.
\item
The reverse implication need not hold: it is possible for a semitopology to be chain-complete but not strongly chain-complete.
\item
Not every semitopology is chain-complete.
\end{enumerate*} 
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Consider a descending chain of open sets $\mathcal O$.
If one of the elements in $\mathcal O$ is empty then $\bigcap\mathcal O=\varnothing$ and $\varnothing\in\opens$ so we are done.
If all of the elements in $\mathcal O$ are nonempty then by chain-completeness $\bigcap\mathcal O$ is nonempty and open, and thus in particular it is open.
\item
A counterexample is $(\mathbb N,\powerset(\mathbb N))$ (the discrete semitopology on the infinite set of natural numbers).
Then $i_\geq=\{i'\mid i'\geq i\}$ for $i\geq 0$ is a descending chain of nonempty open sets whose intersection $\varnothing$ is open but notnonempty.
\item
This just repeats Remark~\ref{rmrk.not.chain-complete}, which gives an easy counterexample.
\qedhere\end{enumerate} 
\end{proof} 


\begin{xmpl}
\leavevmode
\begin{enumerate}
\item
The \emph{all-but-one} and \emph{more-than-one} semitopologies (see Examples~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}\&\ref{item.counterexample.more-than-one})) are (strongly) chain-complete.
\item
The closed interval $[\minus 1,1]$ with its usual topology is not chain-complete (and not strongly chain-complete): e.g. $\{(\minus 1/i, 1/i) \mid i\geq 1\}$ is a descending chain of open sets but its intersection $\{0\}$ is not open.
Similarly for the two semitopologies on $\mathbb Q^2$ in Example~\ref{xmpl.two.topen.examples}.

(Looking ahead just for a moment to Theorem~\ref{thrm.lim.O.open}, this tells us that these semitopologies cannot be generated by witness functions.)
\end{enumerate}
\end{xmpl}


\begin{lemm}
\leavevmode
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
$\ns P$ is chain-complete if and only if the union of any ascending chain of closed sets, is closed.
\item
$\ns P$ is strongly chain-complete if and only if the union of any ascending chain of closed sets that are not equal to $\ns P$, is closed and not equal to $\ns P$. 
\end{enumerate*}
\end{lemm}
\begin{proof}
Direct from Definition~\ref{defn.chain-complete} using Lemma~\ref{lemm.closed.complement.open}, which notes that closed sets are the complements of open sets (just as for topologies).
\end{proof}


\subsection{Consequences of being strongly chain-complete}

Being strongly chain-complete is a useful well-behavedness condition.
We consider some of its consequences. 

\subsubsection{Strongly chain-complete implies $\intertwinedwith$-complete}

We saw a chain-completeness condition before: $\intertwinedwith$-completeness from Definition~\ref{defn.intertwined.preorder}(\ref{item.intertwined-bounded}).
As promised in Remark~\ref{rmrk.intertwinedwith-bounded.natural}(\ref{item.intertwinedwith-bounded.natural.chain-bounded}), we now note that strongly chain-complete semitopologies are also $\intertwinedwith$-complete:
\begin{lemm}
\label{lemm.chain-bounded.implies.intertwinedwith.bounded}
Suppose $(\ns P,\opens)$ is a quasiregular semitopology.
Then if $(\ns P,\opens)$ is strongly chain-complete then it is $\intertwinedwith$-complete (Definition~\ref{defn.intertwined.preorder}(\ref{item.intertwined-bounded})). 
\end{lemm}
\begin{proof}
Suppose we have a $\geqk$-descending chain of points $p_1\geqk p_2\geqk \dots$.

Since $\ns P$ is quasiregular, $\community(p_i)\in\opens_{\neq\varnothing}$ for every $i$.
Write $I=\bigcap_i \community(p_i)$.

Since $\ns P$ is strongly chain-complete (Definition~\ref{defn.chain-complete}(\ref{item.chain-bounded})), $I\in\opens_{\neq\varnothing}$ (we need \emph{strong} chain-completeness here to know that $I$ is not just open but also nonempty).
Choose some $p\in I$.

It follows from Lemma~\ref{lemm.weakly.regular.community}(1) that $p\leqk p_i$ for every $i$, thus $p$ is a $\leqk$-lower bound for the chain.
\end{proof}

\subsubsection{Indirectly regular points: inherent properties}

In Definition~\ref{defn.tn} we saw three regularity conditions on points: quasiregular, weakly regular, and regular.
We now add a fourth condition to this mix: \emph{indirect regularity}.
A point is indirectly regular when it is intertwined with a regular point; intuitively, if regular points are `nice' then an indirectly regular point is a point that is not necessarily nice itself, but it is intertwined with a point that \emph{is} nice.\footnote{Like in the movies: where a gangster falls in love with a nice person; the gangster may not stop being a gangster, but they now have a moral compass, if only indirectly.}
It is not at all obvious that this should have anything to do with strong chain-completeness, but it does: a punchline of this Subsection will come in Remark~\ref{rmrk.linear.regularity}, where we note that if a semitopology in strongly chain-complete then indirect regularity slots in particularly nicely with the three regularity conditions from Definition~\ref{defn.tn}.
We now set about building the machinery we need to tell this story:
\begin{defn}
\label{defn.indirectly.regular}
Suppose $(\ns P,\opens)$ is a semitopology.
Call $p$ \deffont{indirectly regular} when $p\intertwinedwith q$ for some regular $q$.
\end{defn}

\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then $p$ is indirectly regular if and only if $p$ is in the closure of a topen set.
\end{lemm}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
\emph{Suppose $p$ is indirectly regular; so $p\intertwinedwith q$ for some regular $q\in\ns P$.}
 
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $q\in\community(q)\in\topens$.
By Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}) (since $p\intertwinedwith q$) $p\in\intertwined{q}$, and by Theorem~\ref{thrm.pKp}(\ref{item.closure.community.p.intertwined}) $\intertwined{q}=\closure{\community(q)}$.
Thus $p$ is in the closure of the topen set $\community(q)$.
\item
\emph{Suppose $p\in\closure{\atopen}$ for some $\atopen\in\topens$.}

Choose any $q\in\atopen$.
Note by Theorem~\ref{thrm.max.cc.char}(\ref{char.some.topen}) that $q$ is regular; we will now show that $p\intertwinedwith q$.

Consider a pair of open neighbourhoods $p\in O\in\opens$ and $q\in O'\in\opens$.
Then $O\between\atopen$ (because $p\in O$ and $p\in\closure{\atopen}$), and $\atopen\between O'$ (because $q\in\atopen\cap O'$).
By transitivity of $\atopen$, $O\between O'$.
It follows that $p\intertwinedwith q$ as required.
\qedhere\end{itemize}
\end{proof}

We will need Lemma~\ref{lemm.intertwined.community.subset} below.
We can think of this as a version of Lemma~\ref{lemm.weakly.regular.community} where we know that one of the points is regular:
\begin{lemm}
\label{lemm.intertwined.community.subset}
Suppose $(\ns P,\opens)$ is a semitopology and $p,q\in\ns P$ and $q$ is regular.
Then:
\begin{enumerate*}
\item
If $q\intertwinedwith p$ then $\community(q)\subseteq\intertwined{p}$. 
\item
As a corollary, if $p\in\intertwined{q}$ or $q\in\intertwined{p}$, then $\community(q)\subseteq\intertwined{p}$. 
\end{enumerate*}
\end{lemm}
\begin{proof}
The corollary follows because by Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}), $p\in\intertwined{q}$ and $q\in\intertwined{p}$ are both equivalent to $p\intertwinedwith q$. 

So suppose $q$ is regular and $q\in\intertwined{p}$.
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $q\in\community(q)\in\topens$ and by Theorem~\ref{thrm.r=wr+uc} $q$ is unconflicted.
Consider any other $q'\in\community(q)$; unpacking Definition~\ref{defn.tn}(\ref{item.tn}) and~\ref{defn.intertwined.points}(\ref{intertwined.defn}) $p\intertwinedwith q\intertwinedwith q'$ and so by Definition~\ref{defn.conflicted}(\ref{item.unconflicted}) (since $q$ is unconflicted) $p\intertwinedwith q'$.
Thus $\community(q)\subseteq\intertwined{p}$ as required.
\end{proof}

\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
Then the following are equivalent:
\begin{enumerate*}
\item
$p$ is indirectly regular.
\item
$\intertwined{p}$ contains a topen set.
\end{enumerate*}
\end{corr}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
\emph{Suppose there exists $\atopen\in\topens$ such that $\atopen\subseteq\intertwined{p}$.}

Take any $q\in\atopen$.
By Theorem~\ref{thrm.max.cc.char}(\ref{char.some.topen}) $q$ is regular, and by Definition~\ref{defn.intertwined.points}(\ref{intertwined.defn}) $q\intertwinedwith p$.
\item
\emph{Suppose $p$ is indirectly regular.}

By Definition~\ref{defn.indirectly.regular} $p\intertwinedwith q$ for some regular $q\in\ns P$.
By Lemma~\ref{lemm.intertwined.community.subset} $\community(q)\subseteq\intertwined{p}$.
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $\community(q)\in\topens$.
\qedhere\end{itemize}
\end{proof}

\subsubsection{Indirectly regular points in the context of other regularity properties}


\begin{rmrk}
\label{rmrk.linear.regularity}
This Subsection develops a sequence of results that are interesting in themselves, but also taken together they indicate that in a strongly chain-complete semitopology, our regularity conditions organise into a list ordered by increasing strength as follows:
\begin{itemize*}
\item
Being quasiregular (having a nonempty community).
\item
Being indirectly regular (intertwined with a regular point / being on the boundary of a topen set).
\item
Being weakly regular (being an element of your community).
\item
Being regular (being an element of your \emph{topen} community).
\end{itemize*}
If the semitopology is not strongly chain-complete, then being indirectly regular does not fall so neatly in line.
We read this as evidence that the \emph{strongly chain-complete semitopologies} are a particularly natural class of semitopologies for us to study, and they are a useful abstraction of the finite semitopologies (much as e.g. Alexandrov topologies, or compact topologies, capture aspects of finiteness for topologies).
\end{rmrk}
 
\begin{prop}
\label{prop.up.down.wr}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology.
Then:
\begin{enumerate*}
\item\label{item.up.down.wr.ir}
If $p\in\ns P$ is weakly regular then $p$ is indirectly regular.
\item
The converse implication need not hold: it is possible for $(\ns P,\opens)$ to be strongly chain-complete and $p\in\ns P$ is indirectly regular 
but not weakly regular.  
\item
If $(\ns P,\opens)$ is not strongly chain-complete then the implication might fail: it is possible for $p\in\ns P$ to be weakly regular but not indirectly regular.
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $p\in\ns P$ is weakly regular.
From Proposition~\ref{prop.views.of.regularity} $\intertwined{p}$ is a closed neighbourhood (a closed set with a nonempty open interior).
Using strong chain-completeness and Zorn's lemma on $\supseteq$, the set of closed neighbourhoods that are subsets of $\intertwined{p}$ contains a minimal closed neighbourhood $C\subseteq\intertwined{p}$ (we need \emph{strong} chain-completeness to ensure that $C$ has a \emph{nonempty} open interior).
Take $q\in \interior(C)$; By Theorem~\ref{thrm.up.down.char} $q$ is regular.
\item
For a counterexample consider point $\ast$ in Figure~\ref{fig.nitpick}.  Then $\community(\ast)=\{1\}$ and $1$ is regular, but $\ast\not\in\community(\ast)$ so $\ast$ is not weakly regular. 

(It \emph{does} follow from existence of a regular $q\in\community(p)$ that $p$ is quasiregular, but only because existence of \emph{any} (not necessarily regular) $q\in\community(p)$ means precisely that $\community(p)\neq\varnothing$.
and $\community(q)\subseteq\community(p)$.)
\item
A counterexample is in Figure~\ref{fig.weakly-regular.conflicted}.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}
Proposition~\ref{prop.up.down.wr} is just an easy corollary of Theorem~\ref{thrm.up.down.char}.
We can think of this as another version of the `hairy ball' result that we saw in Theorem~\ref{thrm.K-regular}, but for the case of a weakly regular point, instead of for a quasiregular space.

Recall that we care about regular points because these are (for our purposes) well-behaved: they have a topen neighbourhood (Theorem~\ref{thrm.max.cc.char}), by which fact local consensus is guaranteed where algorithms succeed (Remark~\ref{rmrk.transitive.correlated}).
Thus the interest of Proposition~\ref{prop.up.down.wr} is that it provides certain guarantees of progress; a weakly regular point may not be able to progress (even if algorithms succeed), but it guaranteed to be intertwined with some well-behaved regular point.
\end{rmrk}


\begin{corr}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology (by Remark~\ref{rmrk.cc.natural} this holds in particular if $\ns P$ is finite).
Then:
\begin{enumerate*}
\item
If $p$ is weakly regular then $p$ is indirectly regular.
\item
The converse implication need not hold: it is possible for $p$ to be indirectly regular yet $p$ is not weakly regular, even if the semitopology is strongly chain-complete, and indeed even if the semitopology is actually finite.
\end{enumerate*}
\end{corr}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
We just combine Proposition~\ref{prop.up.down.wr}(\ref{item.up.down.wr.ir}) with Definition~\ref{defn.indirectly.regular}.
\item
A counterexample is point $\ast$ in Figure~\ref{fig.nitpick}.
Then $\ast\intertwinedwith 1$ and $1$ is regular, but $\ast$ is (quasiregular but) not weakly regular.
\qedhere\end{enumerate}
\end{proof}




\begin{figure}
\centering
\includegraphics[width=0.4\columnwidth,trim={50 50 50 50},clip]{diagrams/square-diagram-with-point.pdf}
\caption{Lemma~\ref{lemm.indirectly.regular.to.quasiregular}(2): a point $\ast$ that is quasiregular but not indirectly regular}
\label{fig.ir.not.qr}
\end{figure}

\begin{lemm}
\label{lemm.indirectly.regular.to.quasiregular}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$.
Then:
\begin{enumerate*}
\item
If $p$ is indirectly regular then $p$ is quasiregular.
\item
The converse implication need not hold: it is possible for $p$ to be quasiregular but not indirectly regular.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
Suppose $p$ is indirectly regular.
By Definition~\ref{defn.indirectly.regular} $p\in\intertwined{q}$ for some regular $q$.
By Lemma~\ref{lemm.wr.r}(\ref{item.r.implies.wr}\&\ref{item.wr.implies.qr}) $q$ is quasiregular, meaning that $\varnothing\neq\community(q)$.
By Lemma~\ref{lemm.intertwined.community.subset} $\community(q)\subseteq\community(p)$,
so that $\community(p)$ is nonempty and $p$ is quasiregular.
\item
It suffices to provide a counterexample.
Consider the point $\ast$ in the semitopology illustrated in Figure~\ref{fig.ir.not.qr}:\footnote{This is an elaboration of the semitopology we have already seen in Figure~\ref{fig.square.diagram}).}
\begin{itemize}
\item
$\ns P = \{\ast, 0, 1, 2, 3\}$.
\item
$\opens$ is generated by $\{\{3,0\},\ \{0,1\},\ \{1,2\},\ \{2,3\}\}$;
note that the only open neighbourhood of $\ast$ is all of $\ns P$.
\end{itemize}
The reader can check that $\intertwined{\ast}=\ns P$, so $\community(\ast)=\ns P\neq\varnothing$ so $\ast$ is quasiregular.
However, the reader can also check that no point in this space is regular, so $\ast$ is not intertwined with any regular point.
\qedhere\end{enumerate}
\end{proof}





 


\subsection{Witness semitopologies are chain-complete}


\begin{thrm}
\label{thrm.lim.O.open}
Suppose that
$(\ns P,\witness)$ is a witnessed set.
Then the witness semitopology $\opens(\witness)$ from Definition~\ref{defn.trust.topology} is chain-complete.

Unpacking this we can say:
\begin{quote}
In a witness semitopology, intersections of descending chains of open sets are open, and unions of ascending chains of closed sets are closed.
\end{quote}
\end{thrm}
\begin{proof}
Consider a chain of open sets $\mathcal O\subseteq\opens$. 
There are three cases:
\begin{itemize}
\item
\emph{Suppose $\bigcap\mathcal O=\varnothing$.}\quad

We note that $\varnothing\in\opens$ (Definition~\ref{defn.semitopology}(\ref{semitopology.empty.and.universe})) and we are done.
\item
\emph{Suppose $\mathcal O$ has a least element $O$.}\quad

Then $O=\bigcap\mathcal O$ and $O\in\opens$ and we are done.
\item
\emph{Suppose $\mathcal O\neq\varnothing$ and $\mathcal O$ has no least element.}\quad

Then note that $\mathcal O$ is infinite.
Consider some $p\in\bigcap\mathcal O$.
By construction of the witness semitopology (Definition~\ref{defn.trust.topology}) for each $O\in\mathcal O$ there exists a witness-set $w_O\in\witness(p)$ such that $w_O\subseteq O$.
Now by Definition~\ref{defn.witnessed.set}(\ref{witness.function}) $\witness(p)$ is finite, so by the pigeonhole principle, there exists some $w\in\witness(p)$ such that $w\subseteq O$ for for every $O\in\mathcal O$,
and thus $w\subseteq\bigcap\mathcal O$. 

Now $p$ in the previous paragraph was arbitrary, so we have shown that if $p\in\bigcap\mathcal O$ then also there exists $w\in\witness(p)$ such that $w\subseteq\bigcap\mathcal O$. 
It follows by construction of the witness semitopology in Definition~\ref{defn.trust.topology} that $\bigcap\mathcal O$ is open as required.
\qedhere\end{itemize}
\end{proof}

\begin{lemm}
\label{lemm.elaborating}
The reverse implication in Theorem~\ref{thrm.lim.O.open} does not hold: there exists a chain-complete semitopology (indeed, it is also strongly chain-complete) that is not generated as the witness semitopology of a witnessed set.
\end{lemm}
\begin{proof}
It is a fact that the more-than-one semitopology on $\mathbb N$ (having open sets generated by distinct pairs $\{i,i'\}\subseteq\ns P$; see Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.more-than-one})) is strongly chain-complete, but by Lemma~\ref{lemm.more-than-one} is is not generated by a witness function.
\end{proof}


\begin{rmrk}
Elaborating further on Lemma~\ref{lemm.elaborating}, suppose $(\ns P,\opens)$ is a chain-complete semitopology.
Then to every $p$ we can assign a nonempty set $\mathcal O_p$ of \emph{covers} (minimal open sets containing $p$; see Definition~\ref{defn.open.covers}).

Can we obtain a witness function just by setting $\witness(p)=\mathcal O_p$?
No: because $p$ need not have finitely many covers, and Definition~\ref{defn.witnessed.set} insists on a \emph{finite} set of (possibly infinite) nonempty witness-sets.\footnote{See Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}) for an example of a semitopology containing points with infinitely many covers, though interestingly, this \emph{can} be generated by a witness function, as noted in Lemma~\ref{lemm.all-but-one}.}  

We could allow an infinite set of witness-sets in Definition~\ref{defn.witnessed.set}, but at a price:
\begin{itemize*}
\item
The proof of Theorem~\ref{thrm.lim.O.open} depends on the pigeonhole principle, which uses finiteness of the set of witness-sets.
\item
The proof of Lemma~\ref{lemm.limit.is.open} depends on the set of witness-sets being finite, and this is required for Proposition~\ref{prop.lim.is.closure}.
\end{itemize*}
\end{rmrk}



\begin{rmrk}
\label{rmrk.characterise.witness.semitopologies}
Theorem~\ref{thrm.lim.O.open} shows that witness semitopologies are chain-complete, but Lemma~\ref{lemm.elaborating} demonstrates that this cannot precisely characterise witness semitopologies.
Might there be another way?

We might look at Corollary~\ref{corr.cover.exists} (open covers exist), cross-reference with Definition~\ref{defn.witnessed.set}(\ref{witness.function}) (every $p$ has only finitely many witness-sets), and ask if we might characterise witness semitopologies as those topologies that are chain-complete \emph{and} every $p$ has finitely many open covers (Definition~\ref{defn.open.covers}(\ref{item.open.cover})).

No: by Lemma~\ref{lemm.all-but-one}, the all-but-one semitopology from Example~\ref{xmpl.semitopologies}(\ref{item.counterexample.X-x}) is a witness semitopology, and if the underlying set of points is infinite then every point has infinitely many covers.
See also Remark~\ref{rmrk.two.open.problems}(1).
\end{rmrk}

 
\begin{prop}
\label{prop.finite.chain-bounded}
\leavevmode
\begin{enumerate*}
\item
Not every witness semitopology (Definition~\ref{defn.trust.topology}) is strongly chain-complete (Definition~\ref{defn.chain-complete}(\ref{item.chain-bounded})).
\item
Part~1 holds even if we restrict the witness function 
$\witness:\ns P\to\finpow_{\neq\varnothing}(\powerset_{\neq\varnothing}(\ns P))$ in Definition~\ref{defn.witnessed.set}(\ref{witness.function}) to return a finite set of finite witness-sets, so that 
$\witness:\ns P\to\finpow_{\neq\varnothing}(\finpow_{\neq\varnothing}(\ns P))$.
\item
Every \emph{finite} semitopology (this includes every finite witness semitopology) is strongly chain-complete. 
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
It suffices to provide a counterexample.
Consider $\mathbb N$ with witness function $\witness(i)=\{\{i\plus 1\}\}$.
This generates a semitopology with open sets generated by $i_\geq=\{i'\in\mathbb N\mid i'\geq i\}$.
Then $(i_\geq\mid i\in\mathbb N)$ is a descending chain of open sets with an open, but empty, intersection.
\item
We just use the counterexample in part~1.
\item
We noted already in Remark~\ref{rmrk.cc.natural} that if the semitopology is finite then every descending chain of open sets is eventually stationary; so we just take the final element in the chain. 
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
\label{rmrk.plausible.abstraction}
We are particularly interested in the concrete example of finite witnessed semitopologies, since these are the ones that we can actually implement.
But we can ask what it is about this class of examples that makes them mathematically well-behaved; what essential algebraic features might we identify here?
Proposition~\ref{prop.finite.chain-bounded} suggests that being strongly chain-complete may be a suitable mathematical abstraction: 
\begin{itemize*}
\item
by Proposition~\ref{prop.finite.chain-bounded} the abstraction is both non-trivial and sound (not every witness semitopology is strongly chain-complete, but every \emph{finite} witness semitopology is), and 
\item
Theorem~\ref{thrm.lim.O.open} asserts that for a (possibly infinite) $(\ns P,\opens)$, any convergence using a descending sequence of open sets has a flavour of being `locally finite' in the sense of being guaranteed to have a nonempty open intersection.\footnote{There is also a computational interpretation to (strong) chain-completeness: think of a descending chain of open sets as a computation that computes to narrow down possibilities to smaller and smaller nonempty open sets, then this possibly infinite computation does deliver a final answer that is a (nonempty) open set.} 
\end{itemize*}
So strongly chain-complete semitopologies are a plausible abstraction of finite witness semitopologies.\footnote{There may be more than one such abstraction; identifying one candidate does not mean there may not be others.  For example, both \emph{rings} and \emph{models of first-order arithmetic} are valid abstractions of the notion of `number'.  Which of these mathematical structures we work with, depends on which aspects of the concrete thing we are interested in studying.}
The test is now to explore the theory of strongly chain-complete semitopologies and see if they preserve enough structure, and enough of the right kind of structure, to model how finite witness semitopologies are applied to distributed collaborative action.

Key results in this direction are Corollaries~\ref{corr.cover.exists} and~\ref{corr.atom.exists}, which ensure that in a strongly chain-complete semitopology, open covers and atoms always exist, and we will build from there.
\end{rmrk}



\begin{rmrk}[Why infinity?]
\label{rmrk.why.infinite}
\label{rmrk.infinite}
Following on from Remark~\ref{rmrk.plausible.abstraction},
we sometimes get asked, especially by engineers, why we care about infinite models when all practical computer networks are finite.

A simple answer is that we do this for the same reason that Python (and many other programming languages) have a datatype for infinite precision integers.
Any given execution will only compute numbers in a finite subset this infinity, but since we may not be able to predict how large this subset is, it is natural to support the notion of an infinite datatype.
Note this this holds for data, not just datatypes: e.g. Python accommodates values for $\pi$, $e$, and $j$ even though these are not rational numbers, and for infinite streams and may other `infinite' objects.\footnote{The first author once spent several minutes trying to convince a Computer Science undergraduate student that $1/3$ is a finite number, and that it actually exists.  The blockage was that the student's only believed in the \texttt{float} datatype, and the decimal expansion of $1/3$ as $0.333\dots$ is infinite.  This deadlock was broken by inviting the student to implement a base-3 float type as homework.  The deeper point here is that what we consider `infinite' may depend on what representation we assume as primitive.  We see something similar going on in model theory, where we may distinguish between \emph{internal} and \emph{external} notions of size in a model.  The bottom line is: obsessing about size can become a dead end; we also need to pay attention to what seems elegant and natural, i.e. to what our brains want --- and then model \emph{that}.} 

However there is another, very interesting reason: in \emph{permissionless} consensus, participants cannot depend on an exhaustive search of the full network ever terminating (nor that even an attempt at this would be cost-effective), so this requires a theory and algorithms that make sense on at least countably infinitely many points.

In fact, arguably the natural cardinality for semitopology as applied to permissionless consensus is at least \emph{uncountable}, since for a participant on a permissionless network, especially with network latency,\footnote{Subtle point: permissionless means `people might join or leave the network'; permissionless-and-latent means `people might \emph{have joined or left} the network (and you just haven't heard about it yet)'.} the network is not just unbounded, but also unenumerable.
This is another reason that Theorem~\ref{thrm.lim.O.open} is remarkable.
\end{rmrk}


\subsection{Minimal sets: open covers and atoms}

\subsubsection{Open covers (minimal open neighbourhoods)}

First, some useful notation:
\begin{nttn}
\label{nttn.gtrdot}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Write 
$$
O\gtrdot P \quad\text{and synonymously}\quad P\lessdot O
$$
when $O$ is a minimal nonempty open set containing $P$.
In symbols:
$$
O\gtrdot P
\quad\text{when}\quad
O\neq\varnothing\land P\subseteq O\land \Forall{O'{\in}\opens_{\neq\varnothing}}(P\subseteq O'\subseteq O \limp O'=O).
$$
We may combine $\gtrdot$ with other relations for compactness.
For example:
\begin{itemize*}
\item
$p\in O\gtrdot P$ is shorthand for $p\in O \land O\gtrdot P$; and 
\item
$P\supseteq O\gtrdot Q$ is shorthand for $O\subseteq P\land O\gtrdot Q$.
\end{itemize*}
\end{nttn}


Definition~\ref{defn.open.covers} collects some (standard) terminology.
\begin{defn}
\label{defn.open.covers}
\leavevmode
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
\begin{enumerate}
\item
Call $O\in\opens$ an \deffont{(open) neighbourhood} of $p$ when $p\in O$.
\item\label{item.open.cover}
Call $O\in\opens$ an \deffont{(open) cover} of $p$, write 
$$
O\gtrdot p
\quad\text{and/or}\quad 
p\lessdot O, 
$$
and say that $O$ \deffont{covers} $p$, when $O\gtrdot\{p\}$ (Notation~\ref{nttn.gtrdot}).

In words using the terminology of part~1: $O\gtrdot p$ when $O$ is a minimal open neighbourhood of $p$.
\item
Write $\f{Covers}(p)$ for the set of open covers of $p$.
In symbols:
$$
\f{Covers}(p)=\{O\in\opens \mid p\lessdot O\} .
$$
\end{enumerate}
\end{defn}




\begin{lemm}
\label{lemm.zorn.for.open.covers}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and suppose $\varnothing\neq\mathcal O\subseteq\opens_{\neq\varnothing}$ is a nonempty set of nonempty open sets that is $\subseteq$-down-closed (meaning that if $\varnothing\neq O'\subseteq O\in\mathcal O$ then $O'\in\mathcal O$).

Then $\mathcal O$ contains a $\subseteq$-minimal element. 
\end{lemm}
\begin{proof}
A straightforward application of Zorn's Lemma~\cite{jech:axic,campbell:orizl}:
By strong chain-completeness, $\mathcal O$ ordered by the \emph{superset} relation (the reverse of the subset inclusion relation), contains limits, and so upper bounds, of ascending chains.
By Zorn's Lemma, $\mathcal O$ contains a $\supseteq$-maximal element.
This is the required $\subseteq$-minimal element.
\end{proof}


\begin{corr}[Existence of open covers]
\label{corr.cover.exists}
Suppose $(\ns P,\opens)$ is a chain-complete semitopology and $p\in\ns P$.\footnote{Note that we only require \emph{chain-completeness} here, not strong chain-completeness.}
Then $p$ has at least one open cover.
In symbols:
$$
\Exists{O\in\opens} p\lessdot O
\quad\text{and equivalently}\quad
\f{Covers}(p) \neq\varnothing.  
$$
Furthermore, if $p\in O'\in\opens$ then $O'$ contains an open cover of $p$.
In symbols: 
$$
\Exists{O\in\opens} p\lessdot O\subseteq O' .
$$
\end{corr}
\begin{proof}
Direct from Lemma~\ref{lemm.zorn.for.open.covers}, considering 
$\{O\in\opens \mid p\in O\}$ (nonempty because it contains $\ns P$) and $\{O\in\opens \mid p\in O\subseteq O'\}$ (nonempty because it contains $O'$).
\end{proof}

\begin{rmrk}
\label{rmrk.uncomputable.semitopology}
Recall that our semitopological analysis of consensus is all about continuity and value assignments being locally constant --- as per Definitions~\ref{defn.continuity}(\ref{item.continous.function.at.p}) and~\ref{defn.value.assignment} and results like Lemma~\ref{lemm.open.lc} --- and these discussions are about the open neighbourhoods of $p$.
Thus, to understand consensus at $p$ we need to understand its open neighbourhoods.

Corollary~\ref{corr.cover.exists} tells us that in a witness semitopology, 
we can simplify and just consider the open covers of $p$.
This is because if a continuous function $f:\ns P\to\ns P'$ such that $f(p)=p'\in O'$ is continuous at $p\in\ns P$, then using continuity and Corollary~\ref{corr.cover.exists} there exists some open cover $p\lessdot P\subseteq f^\mone(O')$.

Turning this around, if we want to \emph{create} consensus around $p$ --- perhaps as part of a consensus algorithm --- it suffices to find some open cover of $p$, and convince that cover.
This fact is all the more powerful because Corollary~\ref{corr.cover.exists} does not assume that $\ns P$ is finite: it is a fact of witness semitopologies of any cardinality.
\end{rmrk}


\subsubsection{Atoms (minimal nonempty open sets)}


\begin{defn}
\label{defn.atomic.open.set}
Suppose $(\ns P,\opens)$ is a semitopology.
\begin{enumerate}
\item\label{item.atom}
Call $A\in\opens$ an \deffont{(open) atom} when $A$ is a minimal nonempty open set.\footnote{An open atom covers every point that it contains, but an open cover for a point $p$ need not be an atom, since it may contain a smaller open set --- just not one that contains $p$.  See Example~\ref{xmpl.p.not.in.O}(\ref{item.atom.need.not.contain.p}).} 
In symbols using Notation~\ref{nttn.gtrdot} this is: 
$$
A\gtrdot\varnothing \quad\text{and synonymously}\quad \varnothing\lessdot A.
$$
\item\label{item.atoms.of.P}
If $P\subseteq\ns P$ then write $\f{Atoms}(P)$ for the atoms that are subsets of $P$. 
In symbols:
$$
\f{Atoms}(P) = \{A\in\opens \mid \varnothing\lessdot A \subseteq P\} .
$$
\end{enumerate}
\end{defn}


\begin{lemm}
\label{lemm.zorn.for.atoms}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and suppose $\varnothing\neq\mathcal O\subseteq\opens_{\neq\varnothing}$ is a nonempty set of nonempty open sets that is $\subseteq$-down-closed (meaning that if $\varnothing\neq O'\subseteq O\in\mathcal O$ then $O'\in\mathcal O$).

Then $\mathcal O$ contains an atom.
\end{lemm}
\begin{proof}
Just from Lemma~\ref{lemm.zorn.for.open.covers}, noting that an atom is precisely a $\subseteq$-minimal nonempty open set.
\end{proof}


\begin{corr}[Existence of atoms]
\label{corr.atom.exists}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and $O\in\opens_{\neq\varnothing}$ is a nonempty open set.
Then $O$ contains an atom.
In symbols:
$$
\f{Atoms}(O)\neq\varnothing .
$$
\end{corr}
\begin{proof}
From Lemma~\ref{lemm.zorn.for.atoms}, considering $\{O'\in\opens \mid \varnothing\neq O'\subseteq O\}$ (which is nonempty because it contains $O$).
\end{proof}

\begin{rmrk}
\label{rmrk.topology.crush}
A simple observation is that if $(\ns P,\opens)$ is a strongly chain-complete topology --- thus, a strongly chain-complete semitopology whose opens are closed under finite intersections --- then the atom that exists by Corollary~\ref{corr.atom.exists} is unique, simply because if we have atoms $A$ and $A'$ then $A\cap A'$ is less than both and so by minimality must be equal to both.
See also Lemma~\ref{lemm.kernel.crush}.
\end{rmrk}


\subsubsection{Discussion}

\begin{rmrk}[Origin of terminology]
\label{rmrk.why.cover}
\leavevmode
\begin{enumerate*}
\item
The terminology ``$O$ covers $p$'' in Definition~\ref{defn.open.covers}(\ref{item.open.cover})
is adapted from order theory (see e.g.~\cite[\S 1.14]{priestley:intlo}), where we say that $y$ covers $x$ when $y>x$ and there exists no $z$ such that $y>z>x$.
\item
The terminology ``$A$ is an atom'' in Definition~\ref{defn.atomic.open.set}(1)
is also adapted from order theory (see e.g.~\cite[\S 5.2]{priestley:intlo}), where we call $x$ an atom when it is a least element not equal to $\bot$ (i.e. when $x$ covers $\bot$).
\end{enumerate*}
\end{rmrk}

\begin{xmpl}[(Counter)examples of atoms and open covers]
\label{xmpl.p.not.in.O}
\leavevmode
\begin{enumerate}
\item
\emph{$p$ can be in multiple distinct atoms (minimal nonempty open sets), and/or open covers (minimal open sets that contain $p$).}

For instance, consider $\mathbb N$ with the semitopology generated by $1_\leq=\{0,1\}$ and $1_\geq = \{1,2,3,\dots\}$.
Then $1\in 1_\leq$ and $1\in 1_\geq$, and $1_\leq$ and $1_\geq$ are distinct minimal open sets (and also open covers of $1$).

A topology would compress this example down to nothing: if $\{0,1\}$ is open and $\{1,2,3,\dots\}$ is open then their intersection $\{1\}$ would be open, and this would be the unique least open set containing $1$.
Because open sets in semitopologies are not necessarily closed under intersection, semitopologies permit richer structure.
\item
\emph{An open cover $O$ of $p$ is a minimal open set that contains $p$ --- but $O$ need not be an atom (a minimal nonempty open set).} 

Consider $\mathbb N$ with the semitopology generated by $i_\geq = \{i'\in\mathbb N \mid i'\geq i\}$.
Then $\f{Covers}(i)=\{i_\geq\}$ but (with this semitopology) $\f{Atoms}(\ns P)=\varnothing$; there are no least nonempty open sets.
\item\label{item.atom.need.not.contain.p}
\emph{An atom $A\in\f{atoms}(p)$ is a minimal nonempty open set that is a subset of a minimal open set that contains $p$ --- but $A$ need not contain $p$.}

For instance, consider $\mathbb N$ with the semitopology generated by $i_\leq = \{i'\in\mathbb N \mid i'\leq i\}$.
Then $\f{atoms}(i)=\{\{0\}\}$ for every $i$, because with this semitopology $\f{Atoms}(\mathbb N)=\{\{0\}\}$ and each $i$ is covered by $i_\leq$, and $\{0\}\subseteq i_\leq$.
However, we only have $i\in\{0\}$ when $i=0$.
\end{enumerate}
\end{xmpl}


\begin{rmrk}[Two open problems]
\label{rmrk.two.open.problems}
\leavevmode
\begin{enumerate}
\item
\emph{Topological characterisation of witness semitopologies.}

Following on from Remark~\ref{rmrk.characterise.witness.semitopologies}, we have seen that witness semitopologies are chain-complete, but that this does not precisely characterise witness semitopologies.
A topological characterisation of witness semitopologies, or a proof that such a characterisation is impossible, remains an open problem. 
To this end, the material in Subsection~\ref{subsect.declarative.witness} may be relevant, which relates witness semitopologies to a Turing-complete model of computation.
\item
\emph{Conditions on witness functions to guaranteee (quasi)regularity.}

It remains an open problem to investigate conditions on witness functions to guarantee that every point is quasiregular.
In view of Proposition~\ref{prop.weakly.regular.to.regular} and Corollary~\ref{corr.no.finite.wr.c}, such conditions would suffice to guarantee the existence of a regular point in the finite case.
Regular points are well-behaved, so a system with at least one regular point is a system that is in some sense `somewhere sensible'. 
\end{enumerate}
\end{rmrk} 


\section{Kernels: the atoms in a community}
\label{sect.kernels}

\subsection{Definition and examples}


\begin{rmrk}
\label{rmrk.arrow}
We have studied $\community(p)$ the community of a point and have seen that is has a rich mathematics. 
We also know from results (like Theorem~\ref{thrm.correlated}) and discussions (like Remark~\ref{rmrk.fundamental.consensus}) that to understand consensus in a semitopology, we have to understand its communities. 

It is now interesting to look at the atoms in a community (Definition~\ref{defn.atomic.open.set}; minimal nonempty open sets).
As we shall see later, the atoms in a community dictate its ability to act --- see e.g. Corollary~\ref{corr.boundary.kernel}, which is reminiscent of \emph{Arrow's theorem} from social choice theory --- so that understanding $\community(p)$ is, in a sense we will make formal, much the same thing as understanding the atoms in $\community(p)$ (see e.g. Proposition~\ref{prop.kernel.weakly.strongly.dense}).

Kernels are also interesting in and of themselves, so we start in this Section by studying them (culminating, out of several results, with Propositions~\ref{prop.kernel.atoms.subset.intersect} and~\ref{prop.kernel.O}).
\end{rmrk}

 

\begin{defn}
\label{defn.kernel}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$.
\begin{enumerate*}
\item\label{item.kernel}
Define $\kernel(p)$ the \deffont{kernel} of $p$ to be the union of the atoms in its community.
We give equivalent formulations which we may use as convenient:
$$
\begin{array}{r@{\ }l}
\kernel(p) 
=& \bigcup\{A\in\f{Atoms}(\ns P) \mid A\subseteq \intertwined{p} \}  
\\
=& \bigcup\{A\in\f{Atoms}(\ns P) \mid A\subseteq \community(p)\}  
\\
=& \bigcup\{A\in\opens \mid \varnothing\lessdot A\subseteq \community(p)\}  .
\end{array}
$$
Above, $\varnothing\lessdot A$ is just another way of saying that $A$ is an atom (minimal nonempty open set; see Definition~\ref{defn.atomic.open.set}), and $A\subseteq\intertwined{p}$ if and only if $A\subseteq\community(p)$ because $A$ is open and $\community(p)$ is just the open interior of $\intertwined{p}$ (Definition~\ref{defn.tn}(\ref{item.tn})).
\item\label{item.kernel.atom}
If $A$ is an atom that is a subset of $\kernel(p)$ (in symbols: $\varnothing\lessdot A\subseteq\kernel(p)$) then we might call $A$ a \deffont{kernel atom of $p$}.
\item\label{item.kernel.P}
Extend $\kernel$ to subsets $P\subseteq\ns P$ by taking a sets union:
$$
\kernel(P) = \bigcup\{\kernel(p) \mid p\in P\} .
$$
\end{enumerate*}
\end{defn}




We return to and extend Example~\ref{xmpl.p.not.regular}, and we include details of the kernels:
\begin{xmpl}
\label{xmpl.p.not.regular.2}
\leavevmode
\begin{enumerate}
\item\label{item.p.not.regular.R.2}
Take $\ns P$ to be $\mathbb R$ the real numbers, with its usual topology (which is also a semitopology), as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.R}).
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{x\}$ and $\community(x)=\varnothing$ for every $x\in\mathbb R$.
\item
$\kernel(x)=\varnothing$ for every $x\in\mathbb R$.
\item
$\kernel(\mathbb R)=\varnothing$.
\end{itemize*}
\item\label{item.p.not.regular.012.2}
We take, as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.012}) and as illustrated in Figure~\ref{fig.012}, top-left diagram:
\begin{itemize*}
\item
$\ns P=\{0,1,2\}$.
\item
$\opens$ is generated by $\{0\}$ and $\{2\}$. 
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{0}=\{0,1\}$ and $\community(0)=\interior(\intertwined{0})=\{0\}=\kernel(0)$. 
\item
$\intertwined{2}=\{1,2\}$ and $\community(2)=\interior(\intertwined{2})=\{2\}=\kernel(2)$. 
\item
$\intertwined{1}=\{0,1,2\}$ and $\community(1)=\{0,1,2\}$ and $\kernel(1)=\{0,2\}$. 
\item
$\kernel(\ns P)=\{0,2\}$.
\end{itemize*}
\item\label{item.p.not.regular.01234.2}
We take, as per Example~\ref{xmpl.p.not.regular}(\ref{item.p.not.regular.01234}), as illustrated in Figure~\ref{fig.irregular}, and as reproduced for convenience here in Figure~\ref{fig.irregular.2} (left-hand diagram):
\begin{itemize*}
\item
$\ns P=\{0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{1,2\}$ for $x\in\{0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\item
$\kernel(x)=\{1,2\}$ for $x\in\{0,1,2\}$. 
\item
$\kernel(x)=\{x\}$ for $x\in\{3,4\}$. 
\item
$\kernel(\ns P)=\{1,2,3,4\}$.
\item
By construction $\kernel(\ns P)\subseteq\bigcup\f{Atoms}(\ns P)$, but but we see here that the inclusion may be strict, since e.g. $\{0,1,3\}$ is an atom in this example but $0\not\in\kernel(\ns P)$.
\end{itemize*}
\item\label{item.p.not.regular.01234.2b}
We add one point to part~\ref{item.p.not.regular.01234.2} of this example, $\minus 1$, which is intertwined with $0$, $1$, and $2$ but is not in a minimal nonempty open set, as illustrated in Figure~\ref{fig.irregular.2} (right-hand diagram):
\begin{itemize*}
\item
$\ns P=\{\minus 1,0,1,2,3,4\}$.
\item
$\opens$ is generated by $\{\minus 1,1,2\}$, $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$.
\end{itemize*}
Then:
\begin{itemize*}
\item
$\intertwined{x}=\{\minus 1,0,1,2\}$ and $\community(x)=\interior(\intertwined{x})=\{\minus 1,1,2\}$ for $x\in\{\minus 1,0,1,2\}$.
\item
$\intertwined{x}=\{x\}=\community(x)$ for $x\in\{3,4\}$.
\item
$\kernel(x)=\{1,2\}$ for $x\in\{\minus 1,0,1,2\}$. 
\item
$\kernel(x)=\{x\}$ for $x\in\{3,4\}$. 
\item
$\kernel(\ns P)=\{1,2,3,4\}$.
\item
By construction $\kernel(p)\subseteq\community(p)\subseteq\intertwined{p}$, but the inclusions may be strict.
For instance:
$$
\kernel(0)=\kernel(\minus 1)=\{1,2\}\subsetneq \community(0)=\community(\minus 1)=\{\minus 1,1,2\}\subsetneq\intertwined{0}=\intertwined{\minus 1}=\{\minus 1,0,1,2\}.
$$
\end{itemize*}
\item\label{item.nonempty.community.empty.kernel}
We take $\ns P=\mathbb N$, with the semitopology (also a topology) generated by final subsets $n_\geq = \{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$.
Then $\intertwined{n}=\mathbb N=\community(n)$ for every $n\in\mathbb N$, and $\kernel(n)=\varnothing$ (because there is no minimal nonempty open set). 
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample.pdf}
\includegraphics[width=0.35\columnwidth]{diagrams/universal-counterexample-1.pdf}
\vspace{-0em}
\caption{Illustration of Example~\ref{xmpl.p.not.regular.2}(3\&4)}
\label{fig.irregular.2}
\end{figure}



We warm up with a couple of simple lemmas:
\begin{lemm}
\label{lemm.kernel.atoms.intersect}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is a regular point.

Then all kernel atoms of $p$ intersect, or in symbols:
$$
\varnothing\lessdot A,A'\subseteq\kernel(p) \quad\text{implies}\quad A\between A'.
$$
\end{lemm}
\begin{proof}
By construction in Definition~\ref{defn.kernel}(\ref{item.kernel}) $A,A'\subseteq\kernel(p)\subseteq\community(p)$.
By regularity (Definition~\ref{defn.tn}(\ref{item.regular.point})) $\community(p)$ is transitive.
Then $A\between \community(p)\between A'$ and by transitivity (Definition~\ref{defn.transitive}) it follows that $A\between A'$. 
\end{proof}


\begin{lemm}
\label{lemm.kernel.crush}
Suppose $(\ns P,\opens)$ is a \emph{topology} --- thus: a semitopology whose open sets are closed under intersections --- and $p\in\ns P$ is regular.
Then one of the following holds:
\begin{itemize*}
\item
$\kernel(p)=\varnothing$.
\item
$\kernel(p)=A$ for some atom $\varnothing\lessdot A$.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $\kernel(p)\neq\varnothing$, and suppose there exist two atoms $A,A'\subseteq\kernel(p)$.
Then (just as already noted in Remark~\ref{rmrk.topology.crush}) $A\cap A'$ is an open set.
It is not empty because $A\between A'$ by Lemma~\ref{lemm.kernel.atoms.intersect}.
By minimality, $A=A\cap A'=A'$.
Thus, being a topology crushes Definition~\ref{defn.kernel} down to be at most a single atom.
\end{proof}

\subsection{Characterisations of the kernel}


We open with a non-implication:
\begin{lemm}
\label{lemm.reg.ker.0}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular (so $p\in\community(p)\in\topens$).
Then it is not necessarily the case that $\kernel(p)\neq\varnothing$.
\end{lemm}
\begin{proof}
A counterexample is Example~\ref{xmpl.p.not.regular.2}(\ref{item.nonempty.community.empty.kernel}).
In full: we consider $\mathbb N$ with the semitopology generated by $n_\geq = \{n'\in\mathbb N\mid n'\geq n\}$ for $n\in\mathbb N$.
Then $\intertwined{n}=\mathbb N=\community(n)$ for every $n\in\mathbb N$, but $\kernel(n)=\varnothing$ because there is no minimal nonempty open set.
\end{proof}

We can exclude the case noted in the proof of Lemma~\ref{lemm.reg.ker.0} by restricting to strongly chain-complete semitopologies. 
\begin{lemm}
\label{lemm.nonempty.community}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology --- in particular, this holds if $\ns P$ is finite by Proposition~\ref{prop.finite.chain-bounded} --- and $p\in\ns P$.
Then:
\begin{enumerate*}
\item
$\community(p)=\varnothing$ if and only if $\kernel(p)=\varnothing$, and equivalently $\community(p)\neq\varnothing$ if and only if $\kernel(p)\neq\varnothing$.

In words: $p$ has a nonempty community if and only if it has a nonempty kernel.
\item\label{nonempty.community.topen}
If $p$ is regular then $\kernel(p)$ is a topen subset of $\community(p)$ (nonempty transitive and open, see Definition~\ref{defn.transitive}(\ref{transitive.cc})).

(See also Lemma~\ref{lemm.topen.max.min}, which proves a stronger version of this property for the kernel atoms of a regular $p$.)
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
Suppose $\varnothing\neq\community(p)=\interior(\intertwined{p})$.
Then by Corollary~\ref{corr.atom.exists} (since $\ns P$ is strongly chain-complete) $\community(p)$ contains at least one atom $A$, which is a subset of $\community(p)$ by construction, and so $A\in\kernel(p)$.

Conversely, if there exists an atom $A\in\kernel(p)$ then (since an atom is by assumption a nonempty set) we have $\varnothing\neq A\subseteq\community(p)$. 
\item
Suppose $p$ is regular.
Unpacking Definition~\ref{defn.tn}(\ref{item.regular.point}) this means that $p\in\community(p)$.
Thus in particular $\community(p)\neq\varnothing$, and by part~1 of this result $\kernel(p)\neq\varnothing$. 

So $\kernel(p)$ is a nonempty subset of $\community(p)$.
By Theorem~\ref{thrm.max.cc.char} $\community(p)$ is a (maximal) topen, and by Lemma~\ref{lemm.transitive.subset}(2) $\varnothing\neq\kernel(p)\subseteq\community(p)$ is topen as required.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}
\label{rmrk.kernel.not.neighbourhood.of.p}
Note in Lemma~\ref{lemm.nonempty.community}(\ref{nonempty.community.topen}) that $\kernel(p)$ need not be a topen neighbourhood of $p$, simply because $p$ (even if it is regular) might generate a topen community $\community(p)$ but need not necessarily be in an atom in that community. See Example~\ref{xmpl.p.not.regular.2}(\ref{item.p.not.regular.01234.2b}) taking $p=0$ or $p=\minus 1$, or Lemma~\ref{lemm.kernel.non-implications}(3).
\end{rmrk}

We complement Lemma~\ref{lemm.nonempty.community} with some non-implications:
\begin{lemm}
\label{lemm.kernel.non-implications}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
$\kernel(p)\neq\varnothing$ does not imply that $p$ is regular.
\item
$\kernel(p)$ topen does not imply that $p$ is regular. 
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
See Example~\ref{xmpl.p.not.regular}(2):
then $\kernel(1)=\{0,2\}\neq\varnothing$ but (as noted in Lemma~\ref{lemm.p.not.regular}) $1$ is not regular. 
\item
See Example~\ref{xmpl.p.not.regular}(\ref{item.point.not.regular.but.community.is.topen}): so $\ns P=\{0,1,2,3,4\}$ and $\opens$ is generated by $\{1,2\}$, $\{0,1,3\}$, $\{0,2,4\}$, $\{3\}$, and $\{4\}$ and $\kernel(0)=\community(0)=\{1,2\}$, and this is (nonempty and) topen, but $0$ is not regular since $0\not\in\community(0)=\{1,2\}$.
\item
Take $\ns P=\{0,1\}$ and set $\opens=\{\varnothing,\{0\},\{0,1\}\}$.
Then $1$ is regular but $1\not\in\kernel(p)=\{0\}$.
\qedhere\end{enumerate}
\end{proof}



\begin{lemm}
\label{lemm.topen.max.min}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is a regular point and $A\subseteq\community(p)$.
Then the following are equivalent:
\begin{enumerate*}
\item
$A$ is a kernel atom of $p$ ($\varnothing\lessdot A\subseteq\community(p)$).
\item
$A$ is a minimal topen in $\community(p)$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We prove two implications:
\begin{itemize}
\item
Suppose $A$ is a kernel atom of $p$.
By assumption in Definition~\ref{defn.kernel}(\ref{item.kernel.atom}) it is an atom (a minimal nonempty open set) in $\community(p)$, and by Lemma~\ref{lemm.transitive.subset}(2) it is topen; so it is necessarily a minimal topen.
\item
Suppose $A$ is a minimal topen in $\community(p)$ and suppose $A'\subseteq A$ is any nonempty open set.
By Lemma~\ref{lemm.transitive.subset}(2) $A'$ is topen, so by minimality $A=A'$.
Thus, $A$ is an atom in $\community(p)$, and so is a kernel atom of $p$.
\qedhere\end{itemize}
\end{proof}

\begin{rmrk}
\label{rmrk.topen.minimax}
The proof of Lemma~\ref{lemm.topen.max.min} above is elementary given our results so far, but it makes a useful observation. 
Recall from Theorem~\ref{thrm.max.cc.char} that if $p$ is regular (so $p\in\community(p)\in\topens$) then $\community(p)$ is a maximal topen, and recall from Definition~\ref{defn.kernel} that a kernel atom is an atom (i.e. a minimal nonempty open set) in $\community(p)$.
So we can read Lemma~\ref{lemm.topen.max.min} as follows: 
\begin{quote}
\emph{A kernel atom is a minimal topen inside a maximal topen.}
\end{quote}
Thus for regular $p$, $\kernel(p)$ and $\community(p)$ are in some sense dual: the community of $p$ is the maximal topen containing $p$, and the kernel of $p$ is the union of the minimal topens inside that maximal topen.
\end{rmrk}


So Lemma~\ref{lemm.topen.max.min} tells us that for regular $p$, the kernel atoms of $p$ are the minimal topens that are subsets of the community of $p$.
Proposition~\ref{prop.kernel.atoms.subset.intersect} strengthens this to show that in fact, the kernel atoms of regular $p$ are also the minimal topens that even \emph{intersect} with the community of $p$ (the significance of this to distributed consensus is discussed in Remark~\ref{rmrk.fundamental.consensus}):
\begin{prop}
\label{prop.kernel.atoms.subset.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.\footnote{We do not seem to need $\ns P$ to be (strongly) chain-complete here.  This is simply because we normally use strong chain-completeness to ensure that atoms and open covers exist, but in this result this is assumed.}
\item
$A\in\f{Atoms}(\ns P)$ is an atom.
\item
$p\in\ns P$ is a regular point (so by Definition~\ref{defn.tn}(\ref{item.tn}) $p\in\community(p)\in\topens$).
\item
$O\in\topens$ and $O\between\community(p)$, so $O$ is any topen set that intersects the community of $p$ (at least one such exists, by regularity, namely $\community(p)$ itself).\footnote{By Proposition~\ref{prop.topen.intersect.subset}, this is equivalent to $O\subseteq\community(p)$.  We use $O\between\community(p)$ because it yields a stronger form of the result.}
\end{itemize*}
Then the following are all equivalent:
\begin{enumerate*}
\item
$A\subseteq\kernel(p)$.

In words: $A$ is a kernel atom of $p$.
\item
$A\subseteq\community(p)$.

In words: $A$ is an atom in the community of $p$.
\item
$A$ is topen and $A\between O$.

In words: $A$ is topen and intersects $O$.
\end{enumerate*}
In particular, if $A$ is a topen atom\footnote{An atom is a minimal nonempty open set, and a topen is a nonempty open transitive set; so saying `topen atom' is just the same as saying `transitive atom'.} then we have:
$$
A\subseteq \kernel(p) 
\quad\liff\quad
A\subseteq \community(p) 
\quad\liff\quad
A\between O
\quad\liff\quad
A\between\kernel(p) 
\quad\liff\quad
A\between\community(p) . 
$$
\end{prop}
\begin{proof}
We consider a cycle of implications:
\begin{itemize}
\item
Suppose $A\subseteq\kernel(p)$.
By construction in Definition~\ref{defn.kernel}(\ref{item.kernel}) $\kernel(p)\subseteq\community(p)$, so $A\subseteq\community(p)$.
\item
Suppose $A\subseteq\community(p)$.
By Definition~\ref{defn.atomic.open.set}(1) (since $A$ is an atom) $A$ is nonempty.
Then $A\between\community(p)\between O$.
By regularity $\community(p)$ is topen, so by transitivity (Definition~\ref{defn.transitive}) $A\between O$ as required.
\item
Suppose $A$ is topen and $A\between O$.
By assumption $A\between O\between\community(p)$ so by transitivity of $O$, $A\between\community(p)$.
By Proposition~\ref{prop.topen.intersect.subset} $A\subseteq\community(p)$ and it follows from Definition~\ref{defn.kernel}(\ref{item.kernel.atom}) that $A\subseteq\kernel(p)$ as required.
\end{itemize}
The equivalence 
$$
A\between O\liff A\between\kernel(p) \iff A\between\community(p)
$$
then follows routinely from the above, noting the equivalence $A\between O\liff A\subseteq\community(p)$ and choosing $O=\kernel(p)$ or $O=\community(p)$.
\end{proof}

\begin{corr}
\label{corr.kernel.as.topen.atoms.intersecting.O}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ and $O\in\topens$ and $p\in O$ (so $p$ is regular and $O$ is some topen neighbourhood of $p$).
Then 
$$
\kernel(p) = \bigcup\{A{\in}\topens(\ns P) \mid \varnothing\lessdot A\between O\}.
$$
In words: for any topen neighbourhood $O$ of $p$, $\kernel(p)$ is equal to the union of the topen atoms that intersect that neighbourhood. 
\end{corr}
\begin{proof}
Unpacking Definition~\ref{defn.kernel}(\ref{item.kernel}), $\kernel(p)$ is the union of atoms $A\subseteq\community(p)$.
We use Proposition~\ref{prop.kernel.atoms.subset.intersect}. 
\end{proof}

Lemma~\ref{lemm.atom.is.kernel.atom} explicitly characterises the union of all kernels as the union of all transitive atoms, which (given the results above) is what one might expect:
\begin{lemm}
\label{lemm.atom.is.kernel.atom}
Suppose $(\ns P,\opens)$ is a semitopology.
Then:
\begin{enumerate*}
\item
If $A\subseteq\ns P$ is a transitive atom then $A\subseteq\kernel(p)$ for every $p\in A$.

In words we can say: a transitive atom is a kernel atom for any points that it contains.
\item
$\kernel(\ns P)$ is the union of the transitive atoms in $\ns P$.
\end{enumerate*}
\end{lemm}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
If $p\in A\in\topens$ then $A$ is a topen neighbourhood for $p$. 
By Theorem~\ref{thrm.max.cc.char} $p\in A\subseteq \community(p)$.
But then by construction $A$ is an atom in $\community(p)$ so by Definition~\ref{defn.kernel}(\ref{item.kernel}) $A\subseteq\kernel(p)$.
\item
It follows from Lemma~\ref{lemm.topen.max.min} and Definition~\ref{defn.kernel}(\ref{item.kernel.P}) that every atom in $\kernel(\ns P)$ is (topen and so) transitive.
Conversely by part~1 of this result every transitive atom is in the kernel of the community of its points. 
\qedhere\end{enumerate}
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%
\subsection{Further properties of kernels}

%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Intersections between the kernel of $p$ and its open neighbourhoods}

Lemma~\ref{lemm.ker.intersect} is quite easy to prove by following definitions and applying transitivity properties, but it makes a useful point:
\begin{lemm}
\label{lemm.ker.intersect}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$p\in\ns P$ is a regular point.
\item
$A$ is a kernel atom for $p$.  In symbols: $\varnothing\lessdot A\subseteq\kernel(p)$.
\end{itemize*} 
Then 
$$
\Forall{O{\in}\opens} p\in O \limp A\between O .
$$
In words: 
\begin{quote}
If $p$ is regular then every open neighbourhood of $p$ intersects every kernel atom of $p$.\footnote{This property is a bit subtle, because it is not necessarily the case that $p\in\kernel(p)$ (cf. Remark~\ref{rmrk.kernel.not.neighbourhood.of.p}).  So a kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ is is not itself necessarily a neighbourhood of $p$, but it still has a property of `oversight' over $p$ in the sense that it intersects with every quorum (open neighbourhood) that $p$ has.}
\end{quote} 
\end{lemm}
\begin{proof}
By our assumption that $p$ is regular we have $p\in\community(p)\in\topens$ (Definition~\ref{defn.tn}(\ref{item.regular.point})), and we assumed $p\in O$, so $O\between\community(p)$.

Also by assumption $A\between\community(p)$, since $A\subseteq\kernel(p)\subseteq\community(p)$ by Definition~\ref{defn.kernel}(\ref{item.kernel.atom}\&\ref{item.kernel}).
Thus $O\between\community(p)\between A$.
Now $\community(p)$ is topen, thus it is transitive (Definition~\ref{defn.transitive}(\ref{transitive.transitive})) and so $O\between A$ as required. 
\end{proof}


\begin{prop}
\label{prop.kernel.O}
$(\ns P,\opens)$ is a semitopology and $p$ is regular and $p\in O\in\opens$.
Then:
\begin{enumerate*}
\item 
The kernel of $p$ is a subset of the union of the atoms intersecting $O$.
In symbols:
$$
\kernel(p) \subseteq \bigcup\{A{\in}\opens \mid \varnothing\lessdot A\between O\} = \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between O\}.
$$
\item
The inclusion may be strict, even if $O$ is an open cover of $p$ (in symbols: $O\gtrdot p$).
\item
The inclusion may be strict, even if $O\gtrdot p$ is a topen (transitive open) cover of $p$.
\item
If $O$ is a topen cover of $p$, then the kernel of $p$ is precisely equal to the union of the transitive atoms intersecting $O$.
In symbols: 
$$
\kernel(p) = \bigcup\{A{\in}\topens(\ns P) \mid \varnothing\lessdot A\between O\}.
$$
\end{enumerate*}
\end{prop}
\begin{proof}
\leavevmode
\begin{enumerate}
\item
For the inclusion we just combine Lemma~\ref{lemm.ker.intersect} with Definition~\ref{defn.kernel}(\ref{item.kernel}).
\item
To see how the inclusion may be strict, see Example~\ref{xmpl.strict.kernel.O}(1).
\item
To see how the inclusion may be strict, even for transitive $O$, see Example~\ref{xmpl.strict.kernel.O}(2).
\item
This just repeats Corollary~\ref{corr.kernel.as.topen.atoms.intersecting.O}.
\qedhere
\end{enumerate}
\end{proof}

\begin{xmpl}
\label{xmpl.strict.kernel.O}
\leavevmode
\begin{enumerate}
\item
Take $\ns P=\{0,1,2\}$ and let opens be generated by $\{0,1\}$ and $\{0,2\}$ and $\{1,2\}$ and $\{2\}$, as illustrated in Figure~\ref{fig.ovals} (left-hand diagram).

Set $p=1$ and $O=\{1,2\}$.
Then we can calculate that:
\begin{itemize*}
\item
$0$, $1$, and $2$ are all regular.
\item
The community and kernel of $1$ and $0$ are equal to $\{0,1\}$ --- $2$ is not intertwined with $0$ or $1$ because $\{2\}\cap\{0,1\}=\varnothing$.
\item
The community and kernel of $2$ are equal to $\{2\}$. 
\item
$\{1,2\}$ is an open cover of $1$.
\item
The union of the atoms that intersect with $\{1,2\}$ is the whole space $\{0,1,2\}$.
\end{itemize*}
Thus $\kernel(1) =\{0,1\}\subsetneq \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between \{1,2\}\}=\{0,1\}\cup\{2\}=\{0,1,2\}$.
\item
Take $\ns P=\{0,1,2,3\}$ and let opens be generated by $\{0,1\}$ and $\{1,2\}$ and $\{2,3\}$, as illustrated in Figure~\ref{fig.ovals} (right-hand diagram). 

Set $p=1$ and $O=\{0,1\}$.
Then we can calculate that:
\begin{itemize*}
\item
$\ns P$ splits into two disjoint topen sets: $\{0,1\}$ and $\{2,3\}$.
So $O$ is topen.
\item
The community and kernel of $0$ and $1$ are equal to $\{0,1\}$ --- $2$ is not intertwined with $0$ or $1$ because $\{2,3\}\cap\{0,1\}=\varnothing$.
So $\{1,2\}$ is an atom, but it is not transitive.
\item
The community and kernel of $2$ and $3$ are equal to $\{2,3\}$. 
\item
$\{0,1\}$ is an open cover of $1$.
\end{itemize*}
Thus $\kernel(1) =\{0,1\}\subsetneq \bigcup\{A{\in}\f{Atoms}(\ns P) \mid A\between \{0,1\}\}=\{0,1\}\cup\{1,2\}=\{0,1,2\}$.
\end{enumerate}
\end{xmpl}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth]{diagrams/ovals.pdf}
\hspace{-2em}
\includegraphics[width=0.35\columnwidth]{diagrams/strict-kernel-inclusion-transitive.pdf}
\vspace{-1em}
\caption{The semitopologies in Example~\ref{xmpl.strict.kernel.O}}
\label{fig.ovals}
\end{figure}





\begin{rmrk}[Algorithmic content of Proposition~\ref{prop.kernel.O}]
Proposition~\ref{prop.kernel.O} 
reduces the problem of computing kernels to the problem of identifying transitive sets.\footnote{We considered \emph{that} question in results including Proposition~\ref{prop.views.of.regularity} and Theorem~\ref{thrm.up.down.char}.}
Once we have this, an algorithm for computing $\kernel(p)$ for regular $p$ follows:
\begin{itemize*}
\item
Compute a transitive open neighbourhood $O$ of $p$ --- for example using the algorithm outlined in 
Remark~\ref{rmrk.computing.open.sets} to compute open neighbourhoods of $p$, and testing until we find one that is transitive.
At least one transitive cover of $p$ exists, by our assumption that $p$ is regular.
\item
For each $p'\in O$, compute all the atoms that contain $p'$ --- for example by computing the open neighbourhoods of $p'$ and checking which are atoms, and are transitive.
\end{itemize*}
By Proposition~\ref{prop.kernel.O}(4), this collection of transitive atoms that intersect with $O$, will return the kernel atoms of $p$. 
\end{rmrk}


We conclude by noting a non-result:
\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Recall from Theorem~\ref{thrm.up.down.char} that $\community(p)$ the community of $p$ is the greatest transitive open neighbourhood of $p$, so that any \emph{transitive} open neighbourhood of $p$ is contained in the community of $p$.

However, there may still exist a non-transitive open cover of $p$ that is not contained in the community of $p$.
\end{lemm}
\begin{proof}
It suffices to provide a counterexample, and as it happens we have just considered one.
Consider Example~\ref{xmpl.strict.kernel.O}(2), as illustrated in Figure~\ref{fig.ovals} (right-hand diagram).
Then $\intertwined{1}=\community(1)=\{0,1\}$ and $\{1,2\}$ is an open cover of $1$ and $\{1,2\}\not\subseteq\{0,1\}$. 
\end{proof}


\subsubsection{Idempotence properties of the kernel and community}


\begin{rmrk}
In Definitions~\ref{defn.tn}(\ref{item.community.P}) and~\ref{defn.kernel}(\ref{item.kernel.P}) we extend the notions of community and kernel of a set of points, using sets union.
This allows us to take the community of a community $\community(\community(p))$, then kernel of a kernel $\kernel(\kernel(p))$, and so forth.
Does doing this add any information?
One would hope not --- but this needs checked.

In this Subsection we take check this for regular points, and see that they display good behaviour (e.g.: the community of the community is just the community, and so forth).
The proofs also illuminate how regularity condition ensures good behaviour.
\end{rmrk}


\begin{lemm}
\label{lemm.double.community}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then
$$
\community(\community(p))=\community(p).
$$
\end{lemm}
\begin{proof}
We prove two subset inclusions:
\begin{itemize}
\item
Suppose $q\in\community(\community(p))$, so unpacking Definition~\ref{defn.tn}(\ref{item.community.P}) there exists $p'\in\community(p)$ such that $q\in\community(p')$.
By Corollary~\ref{corr.regular.is.regular} (since $p$ is regular) $\community(p')=\community(p)$, so $q\in\community(p)$.

$q$ was arbitrary, and it follows that $\community(\community(p))\subseteq\community(p)$.
\item
Suppose $q\in\community(p)$.
Then by Corollary~\ref{corr.regular.is.regular} (since $p$ is regular) $\community(q)=\community(p)\in\topens$, so in particular $q\in\community(q)$.

$q$ was arbitrary, and it follows that $\community(p)\subseteq\community(\community(p))$. 
\qedhere\end{itemize}
\end{proof}

\begin{corr}
\label{corr.community.kernel.p}
Suppose $(\ns P,\opens)$ is a semitopology and $p\in\ns P$ is regular.
Suppose further that $\kernel(p)\neq\varnothing$ (if $\ns P$ is strongly chain-complete or finite then by Lemma~\ref{lemm.nonempty.community}(\ref{nonempty.community.topen}) and Proposition~\ref{prop.finite.chain-bounded} $\kernel(p)\neq\varnothing$ is guaranteed).
Then
$$
\community(p)=\community(\kernel(p)).
$$
\end{corr}
\begin{proof}
Suppose $q\in\community(p)$ and pick any $k\in\kernel(p)\subseteq\community(p)$.
Then $k\in\community(p)$ so by Corollary~\ref{corr.regular.is.regular} $\community(p)=\community(k)$ so $q\in\community(k)$.
Thus $\community(p)\subseteq\community(\kernel(p))$.

Furthermore $\community(\kernel(p))\subseteq\community(\community(p))$ is a structural fact of Definition~\ref{defn.tn}(\ref{item.community.P}) and the fact, noted above, that $\kernel(p)\subseteq\community(p)$.

We finish with Lemma~\ref{lemm.double.community}:
$$
\community(p)\subseteq\community(\kernel(p))\subseteq\community(\community(p)) \stackrel{L\ref{lemm.double.community}}= \community(p) .
\qedhere$$ 
\end{proof}


\begin{lemm}
\label{lemm.kernel.community}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then 
$$
\kernel(\community(p))=\kernel(p).
$$
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.kernel}, $\kernel(\community(p))=\bigcup\{\kernel(p')\mid p'\in\community(p)\}$ and for each $p'\in\community(p)$ we have $\kernel(p')=\bigcup\{A\subseteq\ns P \mid \varnothing\lessdot A\subseteq \community(p')\}$. 
By Corollary~\ref{corr.regular.is.regular}, $\community(p)=\community(p')$ for every $p'\in\community(p)$, and threading this equality through the definitions above, we obtain the result.
\end{proof}


\begin{lemm}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $p\in\ns P$ is regular.
Then
$$
\kernel(p)=\kernel(\kernel(p)).
$$
\end{lemm}
\begin{proof}
If $\kernel(p)=\varnothing$ then the result is immediate.
So suppose $\kernel(p)\neq\varnothing$.
We show two subset inclusions.
\begin{itemize}
\item
To prove $\kernel(p)\subseteq\kernel(\kernel(p))$ we can reason as follows:
$$
\begin{array}{r@{\ }l@{\quad}l}
\kernel(\kernel(p))\subseteq&\kernel(\community(p))
&\kernel(p){\subseteq}\community(p), \text{Def.~\ref{defn.kernel}(\ref{item.kernel.P})}
\\
=&\kernel(p) &\text{Lemma~\ref{lemm.kernel.community}}
\end{array}
$$
\item 
To prove $\kernel(\kernel(p))\subseteq\kernel(p)$ we note that a kernel is a union of atoms in Definition~\ref{defn.kernel}(\ref{item.kernel}), and we reason as follows, for an atom $\varnothing\lessdot A$ (which exists because $\kernel(p)$ is a union of atoms and we assumed $\kernel(p)\neq\varnothing$):
$$
\begin{array}{r@{\ }l@{\quad}l}
A\subseteq\kernel(p) 
\liff& A\subseteq\community(p) 
&\text{Definition~\ref{defn.kernel}(\ref{item.kernel})}
\\
\liff& A\subseteq\community(\kernel(p)) 
&\community(p)=\community(\kernel(p))=\community(\community(p))
\\
\liff& A\subseteq\kernel(\kernel(p))
&\text{Definition~\ref{defn.kernel}(\ref{item.kernel})} .
\end{array}
$$
Above, $\community(p)=\community(\kernel(p))=\community(\community(p))$ follows from Lemma~\ref{lemm.double.community} and Corollary~\ref{corr.community.kernel.p} (since we assumed $\kernel(p)\neq\varnothing$).
\qedhere\end{itemize}
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%
\section{Dense subsets and continuous extensions}
\label{sect.dense}

\subsection{Definition and basic properties}

\begin{rmrk}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
The following four standard definitions of what it means for $D$ to be \emph{dense} in $P$ are equivalent in topology: 
\begin{enumerate*}
\item
Every nonempty open subset of $P$ intersects $D$.
\item
The interior of $P\setminus D$ is empty.
\item
Every open subset that intersects $P$, intersects $D$.
\item
$\closure{D}=\closure{P}$.
\end{enumerate*}
We shall see that in semitopologies, these definitions split into two groups.
\end{rmrk}


\begin{defn}
\label{defn.dense}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item\label{item.dense}
Call $D$ \deffont{weakly dense} in $P$ when 
$$
\Forall{O\in\opens} \varnothing\neq O\subseteq P \limp D\between O . 
$$
In words: 
\begin{quote}
$D$ is weakly dense in $P$ when every nonempty open subset of $P$ intersects $D$.
\end{quote}
\item\label{item.strongly.dense}
Call $D$ \deffont{strongly dense in} $P$ when 
$$
\Forall{O\in\opens} P\between O \limp D\between O . 
$$
In words: 
\begin{quote}
$D$ is (strongly) dense in $P$ when every open subset that intersects $P$, intersects $D$.\footnote{We do not need to explicitly state that $O$ is nonempty because if $O$ is empty then $O\between P$ is false.}
\end{quote}
\item\label{item.dense.neighbourhood}
If $D$ is strongly dense in $P$ and $\interior(D)\neq\varnothing$ then we may call $D$ a strongly dense \deffont{neighbourhood} in $P$. 
\end{enumerate*}
\end{defn}


In a topology, the two notions of being \emph{dense} described in Definition~\ref{defn.dense} above are equivalent.
A semitopology permits richer structure (because we do not insist that intersections of open sets be open) and thus it discriminates more finely between the definitions:
\begin{lemm}
\label{lemm.sd.implies.wd}
Suppose $(\ns P,\opens)$ is a semitopology and $\varnothing\neq D\subseteq P\in\opens$.
Then:
\begin{enumerate*}
\item
If $D$ is strongly dense in $P$ then $D$ is weakly dense in $P$.
\item
In a topology, the reverse implication holds; but 
\item
in a semitopology the reverse implication need not hold: it may be that $D$ is weakly dense but not strongly dense in $P$.
\end{enumerate*}
\end{lemm}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If a nonempty open set is a subset of $P$ then it intersects with $P$.
It follows that if $D$ intersects every nonempty open set that intersects $P$, then it certainly intersects every nonempty open set that is a subset of $P$. 
\item
Suppose $(\ns P,\opens)$ is a topology and suppose $D$ is weakly dense in $P$ and $O\between P$.
Then $\varnothing\neq O\cap P\between P$, and because (this being a topology) $O\cap P\in\opens$ we have that $O\cap P\between D$ and so $O\between D$ as required.
\item
It suffices to provide a counterexample.
Consider the top-right semitopology in Figure~\ref{fig.012} and take $D=\{0\}$ and $P=\{0,1\}$.
Then $D$ is weakly dense in $P$ (because $D$ intersects $\{0\}$ and $\{0,1\}$) but $D$ is not strongly dense in $P$ (because $D$ does not intersect $\{1,2\}$).
\qedhere\end{enumerate}
\end{proof} 



We can rearrange the definitions to obtain more abstract characterisations of weakly and strongly dense:
\begin{prop}
\label{prop.wd.sd.iff}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item
$D$ is weakly dense in $P$ if and only if $\interior(P\setminus D)=\varnothing$.
\item
$D$ is strongly dense in $P$ if and only if $\closure{D}=\closure{P}$.
\end{enumerate*}
\end{prop}
\begin{proof}
For each part we prove two implications:
\begin{enumerate}
\item
$\interior(P\setminus D)=\varnothing$ means precisely that there is no nonempty open subset of $P\setminus D$, i.e. that every nonempty subset of $P$ intersects $D$.
But this is just the definition of $D$ being weakly dense in $P$ from Definition~\ref{defn.dense}(\ref{item.dense}).
\item
Since $D\subseteq P$, also $\closure{D}\subseteq\closure{P}$.

To prove $\closure{P}\subseteq\closure{D}$ it suffices to prove $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$.
By Corollary~\ref{corr.closed.complement.union}
$\ns P\setminus \closure{D}$ is the union of the open sets that do not intersect $D$, and $\ns P\setminus\closure{P}$ is the union of the open sets that do not intersect $P$.
So $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$ when for every open set $O\in\opens$, if $O$ does not intersect $D$ then $O$ does not intersect $P$.
This is just the contrapositive of the property of $D$ being strongly dense in $P$ from Definition~\ref{defn.dense}(\ref{item.strongly.dense}).
\qedhere\end{enumerate}
\end{proof}


\begin{corr}
\label{corr.wd.meets.atoms}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and $\varnothing\neq D\subseteq P\in\opens$ ($D$ need not be open).
Then:
\begin{enumerate*}
\item
$D$ is weakly dense in $P$ if and only if $D$ intersects every atom $\varnothing\lessdot A\subseteq P$ in $P$.

In symbols using Definitions~\ref{defn.atomic.open.set} and~\ref{defn.O.between.R}: 
$$
\text{$D$ weakly dense in $P$} 
\quad\liff\quad
D\between\f{Atoms}(P).
$$
\item
$D$ is not weakly dense in $P$ if and only if $D$ is disjoint from some atom $\varnothing\lessdot A\subseteq P$ in $P$.
\end{enumerate*}
\end{corr}
\begin{proof}
Part~2 is just the contrapositive of part~1.
For part~1 we prove two implications:
\begin{itemize}
\item
Suppose $D$ is weakly dense in $P$.
By Definition~\ref{defn.dense}(\ref{item.dense}) this means that $D$ intersects every open $O\subseteq P$.
In particular, $D$ intersects every atom $\varnothing\lessdot A\subseteq P$.
\item
Conversely, suppose $D$ intersects every atom $\varnothing\lessdot A\subseteq P$ and suppose $O\subseteq P$ is open.
By Corollary~\ref{corr.atom.exists} (since $\ns P$ is strongly chain-complete) there exists an atom $\varnothing\lessdot A\subseteq O$ and by assumption $D\between A$, thus also $D\between O$ as required.
\qedhere\end{itemize}
\end{proof}


\subsection{Dense subsets of topen sets}


\begin{lemm}
\label{lemm.open.O.dense.in.topen} 
Suppose $(\ns P,\opens)$ is a semitopology and suppose $P\in\topens$ and $O\in\opens_{\neq\varnothing}$ and $O\subseteq P$. 
Then $O$ is strongly dense in $P$.

In words: any nonempty open subset of a topen set is strongly dense.
\end{lemm}
\begin{proof}
Suppose $P\between O'\in\opens$.
Thus $O\between P\between O'$ and by transitivity of $P$ (since $P$ is topen; see Definition~\ref{defn.transitive}) we have $O\between O'$ as required.
\end{proof}


\begin{corr}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $\varnothing\neq D\subseteq P\in\topens$.
Then \emph{precisely one} of the following holds:
\begin{itemize*}
\item
$D$ is weakly dense in $P$.
\item
$P\setminus D$ is a strongly dense neighbourhood in $P$.
\end{itemize*}
Equivalently, \emph{precisely one} of the following holds:
\begin{itemize*}
\item
$D$ is a strongly dense neighbourhood in $P$.
\item
$P\setminus D$ is weakly dense in $P$.
\end{itemize*}
\end{corr}
\begin{proof}
If $D$ is weakly dense in $P$ then by Proposition~\ref{prop.wd.sd.iff}(1) $\interior(P\setminus D)=\varnothing$, so following Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}) $P\setminus D$ is not a strongly dense neighbourhood.

If $D$ is not weakly dense in $P$ then by Proposition~\ref{prop.wd.sd.iff}(1) $\interior(P\setminus D)\neq\varnothing$.
By Lemma~\ref{lemm.open.O.dense.in.topen} (since $P$ is topen)
$\interior(P\setminus D)$ is strongly dense in $P$, thus so is $P\setminus D$.
It follows from Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}) that $P\setminus D$ is a strongly dense neighbourhood in $P$, as required.
\end{proof}


\begin{corr}
\label{corr.sd.char}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and suppose $\varnothing\neq D\subseteq P\in\topens$. 
Then the following are equivalent:
\begin{itemize*}
\item
$D$ is a strongly dense neighbourhood in $P$.
\item
$\interior(D)\neq\varnothing$.
\item
$D$ contains an atom, or in symbols: $\varnothing\lessdot A\subseteq D$.
\end{itemize*}
\end{corr} 
\begin{proof}
We prove a cycle of implications:
\begin{itemize*}
\item
If $D$ is a strongly dense neighbourhood in $P$ then $\interior(D)\neq\varnothing$ direct from Definition~\ref{defn.dense}(\ref{item.dense.neighbourhood}).
\item
If $\interior(D)\neq\varnothing$ then there exists an atom $\varnothing\lessdot A\subseteq \interior(D)\subseteq D$ by Corollary~\ref{corr.atom.exists} (since $P$ is strongly chain-complete).
\item
If $\varnothing\lessdot A\subseteq D$ then using Lemma~\ref{lemm.open.O.dense.in.topen} (since $P$ is topen) $D$ is dense in $P$.
\qedhere\end{itemize*}
\end{proof}



\subsection{Explaining kernels}
\label{subsect.explaining.kernels}

\begin{nttn}
Suppose $(\ns P,\opens)$ is a semitopology and $\varnothing\neq D\subseteq P\subseteq\ns P$.
Then:
\begin{enumerate}
\item
Call $D$ \deffont{minimally weakly dense} in $P$ when:
\begin{itemize*}
\item
$D$ is weakly dense in $P$, and 
\item
if $\varnothing\neq D'\subseteq D$ and $D'$ is weakly dense in $P$, then $D'=D$.
\end{itemize*}
\item
Call $D$ a \deffont{minimally strongly dense open subset} of $P$ when:
\begin{itemize*}
\item
$D\in\opens$,
\item
$D$ is a strongly dense subset of $P$, and 
\item
if $\varnothing\neq D'\subseteq D$ and $D'$ is a strongly dense open subset of $P$, then $D'=D$.
\end{itemize*}
\end{enumerate}
\end{nttn}


Recall from Definition~\ref{defn.atomic.open.set}(\ref{item.atoms.of.P}) that $\f{Atoms}(P)=\{A\in\opens \mid \varnothing\lessdot A\subseteq P\}$.
\begin{prop}
\label{prop.kernel.weakly.strongly.dense}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and $P\in\opens$.
Then:
\begin{enumerate*}
\item
$\bigcup\f{Atoms}(P)$ is equal to the sets union of the minimal weakly dense subsets of $P$.
\item
If furthermore $P$ is transitive (so that $P\in\topens$) then $\bigcup\f{Atoms}(P)$ is equal to sets the union of the minimal strongly dense open subsets of $P$. 
\item\label{item.kernel.weakly.strongly.dense}
If $p\in\ns P$ is regular then $\kernel(p)$ is equal to the union of the minimal weakly dense subsets of $\community(p)$ and also to the union of the minimal strongly dense subsets of $\community(p)$.
\end{enumerate*}
\end{prop}
\begin{proof}
We consider each part in turn:
\begin{enumerate}
\item
If $D$ is weakly dense in $P$ then by Corollary~\ref{corr.wd.meets.atoms}(1) (since $\ns P$ is strongly chain-complete) $D\between A$ for every atom in $P$.
Thus the union of the minimal weakly dense subsets of $P$ contains $\bigcup\f{Atoms}(P)$.

We also see from Corollary~\ref{corr.wd.meets.atoms}(1) 
that if $D$ is weakly dense then so is $D\cap\bigcup\f{Atoms}(P)$.
Thus the union of the minimal weakly dense subsets of $P$ is contained in $\bigcup\f{Atoms}(P)$.
\item 
If $D$ is strongly dense in $P\in\topens$ then by Corollary~\ref{corr.sd.char} (since $\ns P$ is strongly chain-complete) $D$ contains an atom.
Thus the union of the minimal strongly dense subsets of $P$ contains $\bigcup\f{Atoms}(P)$.

We also see from Corollary~\ref{corr.sd.char} that if $D$ is minimal strongly dense then $D$ must be \emph{equal} to an atom.
Thus the union of the minimal strongly dense subsets of $P$ is contained in $\bigcup\f{Atoms}(P)$.
\item
By Definition~\ref{defn.tn}(\ref{item.regular.point}) $\community(p)$ is transitive, and 
by Definition~\ref{defn.kernel}(\ref{item.kernel}) $\kernel(p)=\bigcup\f{Atoms}(\community(p))$.
The result now follows by parts~1 and~2 of this result.
\qedhere\end{enumerate}
\end{proof}

\begin{rmrk}
Proposition~\ref{prop.kernel.weakly.strongly.dense}(3) gives some independent explanation for why $\kernel(p)$ --- the atoms in the community of $p$, as studied in Section~\ref{sect.kernels} --- is interesting.
$\kernel(p)$ identifies where the minimal weakly dense and strongly dense subsets of $\community(p)$ are located.
\end{rmrk}


\subsection{Unifying is-transitive and is-strongly-dense-in}
\label{subsect.unifying.trans.dense}


It turns out that transitivity and denseness are closely related:
in this Subsection we explore their relationship.


\begin{rmrk}
Consider the following three notions:
\begin{enumerate*}
\item
\emph{$D$ is strongly dense in $P$} from Definition~\ref{defn.dense}(\ref{item.strongly.dense}).
\item
\emph{$P$ is transitive} from Definition~\ref{defn.transitive}(\ref{transitive.transitive}).
\item
\emph{$P$ is strongly transitive} from Definition~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}).
\end{enumerate*}
Notice that while the definitions are different, they share a `family resemblance'. 
Can we identify a common ancestor for them; some definition that naturally subsumes them into a most general principle?

Yes: it is easy to see that item~1 and~3 above are very closely related --- see Lemma~\ref{lemm.strongly.dense.strongly.transitive} --- and then we will prove that all three definitions listed above are special instances of a general definition --- see Definition~\ref{defn.transitive.wrt} and Proposition~\ref{prop.most.general}.
\end{rmrk}

\begin{lemm}
\label{lemm.strongly.dense.strongly.transitive}
Suppose $(\ns P,\opens)$ is a semitopology and $P\subseteq\ns P$.
Then the following are equivalent:\footnote{Cf. also Lemma~\ref{lemm.meet-irreducible}.}
\begin{itemize*}
\item
$P$ is strongly transitive.
\item
$O\cap P$ is strongly dense in $P$, for every $O{\in}\opens$ such that $O\between P$ (meaning that $O\cap P\neq\varnothing$).
\end{itemize*}
In words we can say:
\begin{quote}
$P$ is strongly transitive when every nontrivial open intersection with $P$ is strongly dense. 
\end{quote}
\end{lemm}
\begin{proof}
Unpacking Definition~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}), $P$ is strongly transitive when $O\between P\between O'$ implies $O\cap P\between O'\cap P$.
Unpacking Definition~\ref{defn.dense}(\ref{item.strongly.dense}), $O\cap P$ is strongly dense in $P$ when $P\between O'$ implies $O\cap P\between O'$ --- and this is clearly equivalent to $O\cap P\between O'\cap P$.
The result now follows by routine reasoning.
\end{proof}


We can generalise the notion of strongly dense from Definition~\ref{defn.dense}(\ref{item.strongly.dense}) from $D\subseteq P$ to \emph{any} $D$.
\begin{defn}
\label{defn.transitive.wrt}
Suppose $(\ns P,\opens)$ is a semitopology and $D,P\subseteq\ns P$.

Call $D$ \deffont{strongly dense for} $P$ when
$$
\Forall{O{\in}\opens}P\between O\limp D\between O.
$$
\end{defn}

We state the obvious:
\begin{lemm}
$\varnothing\neq D\subseteq P$ is strongly dense \emph{in} $P$ in the sense of Definition~\ref{defn.dense}(\ref{item.strongly.dense}) if and only if it is strongly dense \emph{for} $P$ in the sense of Definition~\ref{defn.transitive.wrt}.
\end{lemm}
\begin{proof}
The definitions are identical where they overlap.
The only difference is that Definition~\ref{defn.dense}(\ref{item.strongly.dense}) assumes a nonempty subset of $P$, whereas Definition~\ref{defn.transitive.wrt} assumes a nonempty set that intersects (but is not necessarily a subset of) $P$. 
\end{proof}

\begin{lemm}
\label{lemm.strongly.dense.for.closure}
Suppose $(\ns P,\opens)$ is a semitopology and $D,P\subseteq\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$D$ is strongly dense for $P$.
\item
$\closure{P}\subseteq\closure{D}$.
\end{itemize*}
\end{lemm}
\begin{proof}
Suppose $D$ is strongly dense for $P$.
Then $O\in\opens$ does not intersect with $P$ if and only if $O$ does not intersect with $D$, and it follows (just as in the proof of Proposition~\ref{prop.wd.sd.iff}(2)) that $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$, and so that $\closure{P}\subseteq\closure{D}$.

Conversely, if $\closure{P}\subseteq\closure{D}$ then $\ns P\setminus\closure{D}\subseteq\ns P\setminus\closure{P}$ and it follows that if $O\in\opens$ does not intersect with $P$ then $O$ does not intersect with $D$, and thus that $D$ is strongly dense for $P$.
\end{proof}



\begin{prop}
\label{prop.most.general}
Suppose $(\ns P,\opens)$ is a semitopology and $\atopen\subseteq\ns P$.
Then the following are equivalent:
\begin{itemize*}
\item
$\atopen$ is transitive.
\item
$O$ is strongly dense for $\atopen$, for every $O\in\opens$ such that $O\between \atopen$.\footnote{Compare with Lemma~\ref{lemm.strongly.dense.strongly.transitive}, of course.}
\end{itemize*}
\end{prop}
\begin{proof}
We unpack Definition~\ref{defn.transitive.wrt} and see that a condition that $\atopen$ is transitive with respect to every $\atopen\between O\in\opens$ is precisely what Definition~\ref{defn.transitive}(\ref{transitive.transitive}) asserts, namely: for every $O\in\opens$ such that $O\between \atopen$,
$$
\Forall{O'{\in}\opens} \atopen\between O' \limp O\between O'.
\qedhere
$$
\end{proof}


\begin{rmrk}
\label{rmrk.strongly.dense.for}
In topology it makes less sense to talk about $D$ being dense in $P$ for $D\not\subseteq P$, since we can just consider $D\cap P$ --- and if $D$ and $P$ are open then so is $D\cap P$.
In semitopology the following happens: 
\begin{itemize*}
\item
The notion of \emph{dense in} splits into two distinct concepts (\emph{weakly dense in} and \emph{strongly dense in}), as we saw in Definition~\ref{defn.dense} and the subsequent discussion.
\item
The notion of \emph{strongly dense in} generalises to a notion that we call \emph{strongly dense for}, which has the same definition but just weakens a precondition that $D\subseteq P$.
\end{itemize*}
Given the above, we then see from Lemma~\ref{lemm.strongly.dense.strongly.transitive} and Proposition~\ref{prop.most.general}
that the notions of \emph{transitive} and \emph{strongly transitive} from Definitions~\ref{defn.transitive}(\ref{transitive.transitive}) and~\ref{defn.strongly.transitive}(\ref{item.strongly.transitive}) lend themselves to being naturally expressed in terms of strongly-dense-for.
\end{rmrk}


\subsection{Towards a continuous extension result} 
\label{subsect.towards.ce}





\begin{rmrk}
\label{rmrk.top.ce}
Topology has a family of results on \emph{continuous extensions} of functions: a nice historical survey is in~\cite{gutev:simecu}. 
Here is an example, adapted from~\cite[Theorem~24.1.15]{erdman:protac}:\footnote{Available online (\href{https://web.archive.org/web/20221128144749/https://web.pdx.edu/~erdman/PTAC/problemtext_pdf.pdf}{permalink}).}
\begin{quote}
Suppose $f:B\to\mathbb R$ is uniformly continuous and suppose $B$ is a dense subset of $A$.
Then $f$ has a unique extension to a continuous function $g:A\to\mathbb R$.
\end{quote}
This is true in the world of topologies: but what might correspond to this in the semitopological world?

A direct translation to semitopologies seems unlikely.\footnote{Except trivially that we can restrict to those semitopologies that are also topologies (i.e. for which intersections of open sets are open).} 
This is because we have seen from Definition~\ref{defn.dense} and Lemma~\ref{lemm.sd.implies.wd} and the subsequent discussion and results how the notion of `is dense in' behaves differently for semitopologies in general, so that the very premise of the topological result above is now up for interpretation.\footnote{There are other differences.  For instance we care a lot in this paper about value assignments --- maps to discrete semitopologies --- rather than maps to $\mathbb R$.
Of course we could try to generalise from value assignments to more general examples, but as we shall see, even this `simple' case of value assignments is more than rich enough to raise some canonical questions.} 

The issue is now whether we can find definitions and well-behavedness conditions on semitopological spaces in general, reflecting the spirit of the corresponding topological results but without assuming that intersections of open sets are open.

We shall see that this is possible and we propose a suitable result below in Definition~\ref{defn.continuous.extension}.
However, before we come to that, we will sketch a design space of \emph{failing} definitions and counterexamples --- and so put our working definition in its proper design context.

We map to semitopologies of values, so (the spirit of) uniform continuity is automatic, and we concentrate (to begin with) on being strongly dense in rather than weakly dense in, since by Lemma~\ref{lemm.sd.implies.wd}(1) the former implies the latter:
\begin{enumerate}
\item
\deffont{Candidate definition 1}.
\begin{quote}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $f:\ns P\to\tf{Val}$ is a value assignment that is continuous on $D\subseteq\ns P$, and suppose $D$ is a strongly dense subset of $\ns P$.
Then $f$ has a unique extension to a continuous function $g:\ns P\to\tf{Val}$.
\end{quote}
This does not work: 
\begin{itemize*}
\item
Take $(\ns P,\opens)$ to be the top-left example in Figure~\ref{fig.012} and 
\item
$\tf{Val}=\{0,1\}$ with the discrete semitopology.
\item
Define $f:\ns P\to\tf{Val}$ such that $f(0)=0$ and $f(1)=1$ and $f(2)=1$ and 
\item
set $D=\{0,2\}$ and $P=\ns P$.
\end{itemize*}
Note that $D$ is a strongly dense open subset of $\ns P$, and $f$ is continuous on $D$.

However, $f$ cannot be continuously extended to a $g$ that is continuous at $1$.
We note that $1$ is conflicted and intertwined with two distinct topens, $\{0\}$ and $\{1\}$.
Looking at this example we see that Candidate definition~1 is unreasonable: \emph{of course} we cannot extend $f$ continuously to $1$, because $1$ is intertwined with two distinct topen sets on which $f$ takes distinct values.
The natural solution is just to exclude conflicted points since they may be, as the terminology suggests, conflicted:
\item
\deffont{Candidate definition 2.}\quad
\begin{quote}
Suppose $(\ns P,\opens)$ is a semitopology and suppose $f:\ns P\to\tf{Val}$ is a value assignment that is continuous on $D\subseteq\ns P$, and suppose $D$ is a strongly dense subset of $\ns P$.
Then $f$ has a unique extension to a function $g:\ns P\to\tf{Val}$ that is continuous at all \emph{unconflicted} points.
\end{quote}
This does not work:
\begin{itemize*}
\item
Take $(\ns P,\opens)$ to be the semitopology in Figure~\ref{fig.nitpick} and 
\item
$\tf{Val}=\{0,1,2\}$ with the discrete semitopology. 
\item
Define $f:\ns P\to\tf{Val}$ such that $f(0)=0$ and $f(1)=1$ and $f(2)=2$ and $f(\ast)=0$ and 
\item
set $D=\{0,1,2\}$ and $P=\ns P$.
\end{itemize*}
Note that $D$ is a strongly dense open subset of $\ns P$ and $f$ is continuous on $D$.

Note that $\ast$ is unconflicted (because $\intertwined{\ast}=\{\ast, 1\}$). 
However, $f$ cannot be continuously extended to a $g$ that is continuous at $\ast$.
\item\label{item.semi-regular}
Candidate definition~2 is even more telling than it might appear.
Note that $\ast$ is unconflicted and quasiregular (Definition~\ref{defn.tn}(\ref{item.quasiregular.point})), because $\community(\ast)=\{1\}\neq\varnothing$.

Thus we could not even rescue Candidate definition~2 above by insisting that points be not only unconflicted but also quasiregular (i.e. unconflicted and having a nonempty community).
The next natural step up from this is to be unconflicted and weakly regular, which by Corollary~\ref{corr.corr.pKp} leads us to regular points.
\end{enumerate}
We can now state a definition and result that work:
\end{rmrk}

\begin{defn}
\label{defn.continuous.extension}
Suppose $f,g:(\ns P,\opens)\to\tf{Val}$ are value assignments (Definition~\ref{defn.value.assignment}(2)) and suppose $P\subseteq\ns P$.
\begin{enumerate}
\item
Say that $g$ \deffont{continuously extends} $f$ to regular points in $P$ when:
\begin{itemize*}
\item
If $f$ is continuous at $p\in P$ then $f(p)=g(p)$.
\item
$g$ is continuous on every regular $p\in P$ (Definition~\ref{defn.tn}(\ref{item.regular.point})).
\end{itemize*}
\item
Say that $g$ is a \deffont{unique} continuous extension of $f$ to regular points in $P$ when for any other continuous extension $g'$ 
of $f$ to $P$, we have $g(p)=g'(p)$ for every regular $p\in P$.
\end{enumerate}
\end{defn}


\begin{rmrk}[Justification for regular points]
\label{rmrk.cont.uniq}
Note that `continuously extends' and `uniquely' in Definition~\ref{defn.continuous.extension} both apply to to \emph{regular} points in $P$ only.
By the examples in Remark~\ref{rmrk.top.ce} it would not be reasonable to expect unique continuous extensions on non-regular points.
This gives a retrospective justification for the theories of topens and regular points that we develop in this paper (see Definitions~\ref{defn.transitive} and~\ref{defn.tn}): regularity arises as a natural condition for a semitopological continuous extension result.\footnote{This is not an exclusive claim: other reasonable conditions might also exist.} 
\end{rmrk}


\begin{prop}
\label{prop.cet}
Suppose $f:(\ns P,\opens)\to\tf{Val}$ is a value assignment and suppose $D, P\subseteq\ns P$.
Then:
\begin{enumerate*}
\item
If $f$ is continuous on $D$ then $f$ can be continuously extended to all regular points in $\ns P$.
\item
If $D$ is strongly dense for $P$ (Definition~\ref{defn.transitive.wrt}) then this extension is unique on $P$ in the sense of Definition~\ref{defn.continuous.extension}(2).
\end{enumerate*}
\end{prop}
\begin{proof}
Choose some fixed but arbitrary \emph{default value} $v\in\tf{Val}$ and for this choice of $v$ define $g$ by cases as follows:
\begin{itemize}
\item
\emph{Suppose $f$ is continuous at $p$.}

We set $g(p)=f(p)$.
\item
\emph{Suppose $f$ is not continuous at $p$ and $\community(p)\between D$.}

Choose some $d\in\community(p)\cap D$ and set $g(p)=f(d)$.

If $p$ is intertwined with two points $d$ and $d'$ then (because $p$ is regular and so unconflicted by Theorem~\ref{thrm.r=wr+uc}) $d\intertwinedwith d'$ and their open neighbourhoods of continuity intersect, so that $f(d)=f(d')$.
\item
\emph{Suppose $f$ is not continuous at $p$ and $\community(p)\notbetween D$.}

If $D$ is strongly dense for $P$ then this case cannot happen because $P\between\community(p)$ so by the strong dense property $D\between\community(p)$ (see Definition~\ref{defn.dense}(\ref{item.strongly.dense})).

Otherwise, we set $g(p)=v$ (so $g(p)$ is the fixed but arbitrary default value). 
\end{itemize}
We now show that if $p\in \ns P$ is regular, then $g$ is continuous at $p$.
The proof is again by cases:
\begin{itemize}
\item
If $f$ is continuous at $p$ then $g(p)=f(p)$ and so $g$ is continuous at $p$.
\item
If $f$ is not continous at $p$ and $d\in \community(p)\cap D$ then $g(p)=f(d)$.
Thus (since we assumed that $p$ is regular) $p\in \community(p)\subseteq g^\mone(g(p))$, so that $g$ is continuous at $p$.
\item
If $f$ is not continous at $p$ and $\community(p)\cap D=\varnothing$ then $g(p)=v$.
Thus (since we assumed that $p$ is regular) $p\in \community(p)\subseteq g^\mone(v)$, so that $g$ is continuous at $p$.
\end{itemize}
If $D$ is strongly dense for $P$ then uniqueness follows by routine reasoning from the above, using Theorem~\ref{thrm.correlated}.
\end{proof}


In view of Lemma~\ref{lemm.strongly.dense.for.closure} we can more succinctly rephrase Proposition~\ref{prop.cet} as follows:
\begin{corr}
\label{corr.cet.closed}
Suppose 
$f:(\ns P,\opens)\to\tf{Val}$ is a value assignment. 
Then if $f$ is continuous on $D\subseteq \ns P$, then $f$ can be continuously extended to all regular points in $\closure{D}$.
\end{corr}
\begin{proof}
Direct from Proposition~\ref{prop.cet} taking $P=\closure{D}$ and using Lemma~\ref{lemm.strongly.dense.for.closure}. 
\end{proof}

\begin{rmrk}
\label{rmrk.wd.not.enough}
\leavevmode
\begin{enumerate}
\item
There are a few subtleties to Corollary~\ref{corr.cet.closed}.
The result actually tells us that there exists an open set $O\in\opens$ such that $D\subseteq\closure{D}\subseteq O$, and $f$ continuously extends to some $g:\ns P\to\tf{Val}$ that is continuous at $O$.
This is because if $g$ is continuous at $p\in\closure{D}$, then it is by definition continuous on some open neighbourhood of $p$.
\item
Similarly, the condition that $f$ be continuous on $D$ is equivalent to insisting that $f$ be continuous on an \emph{open} $D$.
\item
The condition of $D$ being strongly dense in $P$ is required for uniqueness in Proposition~\ref{prop.cet}(2).
Being weakly dense is not enough.
For, consider the semitopology illustrated in Figure~\ref{fig.wd-not-enough}, such that:
\begin{itemize*}
\item
$\ns P=\{0,1,2,3\}$.
\item
$\opens$ is generated by $D=\{0\}$, $\{0,1\}$, $P=\{0,1,2\}$, and $\{2,3\}$.
\end{itemize*} 
Then we have $D\subseteq P\subseteq\ns P$, and we even have that $D,P\in\opens$ and every point in the space is regular, making this is a particularly well-behaved example.
This semitopology is \emph{not} is a topology, because $P\cap\{2,3\}\not\in\opens$; we will exploit this fact in a moment. 
The reader can check that 
\begin{itemize*}
\item
$D$ is weakly dense in $P$ (because $D$ intersects every open wholly contained in $P$) but 
\item
$D$ is not strongly dense in $P$ (because $D$ does not intersect $\{2,3\}$), and 
\end{itemize*}
the value assignment $f:\ns P\to\mathbb B$ mapping $0$ to $\bot$ and every other point to $\top$ has two continuous extensions to all of $P$: $g$ mapping all points to $\bot$, and $g'$ mapping $0$ and $1$ to $\bot$ and $2$ and $3$ to $\top$.
\end{enumerate}
\end{rmrk}

\begin{figure}
\vspace{-1em}
\centering
\includegraphics[width=0.35\columnwidth,trim={50 20 50 20},clip]{diagrams/wd-not-enough.pdf}
\vspace{-2em}
\caption{A weakly dense subset is not enough for uniqueness (Remark~\ref{rmrk.wd.not.enough}(2))}
\label{fig.wd-not-enough}
\end{figure}





\subsection{Kernels determine values of continuous extensions} 
\label{subsect.kerels.determine}

\begin{rmrk}
In Subsection~\ref{subsect.towards.ce} we considered continuous extensions in a semitopological context.
We concluded with Corollary~\ref{corr.cet.closed}, which showed how to extend a value assignment $f:\ns P\to\tf{Val}$ that is continuous on some $D$, to a $g$ that is continuous on $D$ and on the regular points in $\closure{D}$.

We also discussed why this result is designed as it is and why it seems likely to be optimal within a certain design space as outlined in Remark~\ref{rmrk.top.ce}.

However, our study of semitopologies is motivated by distributed systems.
This means that we also care about intermediate continuous extensions of $f$; i.e. about $g$ that continuously extend $f$ but not necessarily on all of $\closure{D}$. 

The mathematics in this subsection is in some moral sense a `pointwise' dual to the `setwise' mathematics in Subsection~\ref{subsect.towards.ce}.
Perhaps surprisingly, we shall see that when developed pointwise, the details are different: contrast Theorem~\ref{thrm.p.kernel.p} and Corollary~\ref{corr.boundary.kernel} with Proposition~\ref{prop.cet} and Corollary~\ref{corr.cet.closed}; they are similar, but they are not the same.
\end{rmrk} 

Recall that:
\begin{itemize*}
\item
A point $p$ is \emph{regular} when its community (which is the interior of its intertwined points) is a topen neighbourhood of $p$; see Definition~\ref{defn.tn}(\ref{item.regular.point}).
\item
$\kernel(p)$ is the union of the kernel atoms of $p$ (minimal nonempty open sets in the community of $p$); see Definition~\ref{defn.kernel}(\ref{item.kernel}).
\item
A value assignment $f:\ns P\to\tf{Val}$ is a mapping from $\ns P$ to some set of values $\tf{Val}$ having the discrete semitopology; see Definition~\ref{defn.value.assignment}.
\end{itemize*}
We now consider how the value of $f$ on kernel atoms influences the value of $f$ at regular points.


\begin{defn}
\label{defn.regular.f}
Suppose $(\ns P,\opens)$ is a semitopology and $f,g:\ns P\to\tf{Val}$ are value assignments (Definition~\ref{defn.value.assignment}).\footnote{This definition makes sense for $f$ mapping $\ns P$ to any semitopology $\ns Q$, but (for now) we will only care about the case when $\ns Q$ is a discrete semitopology so that $f$ is a value assignment.} 
\begin{enumerate*}
\item
Call $f$ \deffont{confident} at $p\in\ns P$ when $f$ is continuous on some atom $\varnothing\lessdot A\subseteq\kernel(p)$.
\item
Call $f$ \deffont{unanimous} at $p\in\ns P$ when $f$ is continuous on all of $\community(p)$.
\item
We generalise Definition~\ref{defn.continuous.extension} and write $f\leq g$, and call $g$ a \deffont{(partial) continuous extension} of $f$, when for every $p\in\ns P$, if $f$ is continuous at $p$ then $g$ is continuous at $p$ and $f(p)=g(p)$.\footnote{Definition~\ref{defn.continuous.extension} is interested in a $g$ that continuously extends $f$ all at once from $D$ to $\closure{D}$, which is fine mathematically but less helpful computationally.  The definition here refines this concept and is interested in the space of all possible $g$ such that $f\leq g$, which more accurately reflects how $g$ might be computed, in stages, on a network.}

It is routine to check that $\leq$ is a partial order (transitive, reflexive, antisymmetric).
\end{enumerate*}
\end{defn}



\begin{rmrk}
Intuitively, $f$ is `confident' at $p$ when the value we obtain if we continuously extend $f$ to $p$, is already determined.
In the context of a distributed system, it may be that a result has been determined by some part of the system, but not yet fully propagated to the whole system.\footnote{For instance: $f$ may know the results of an election, but not yet have told point $p$; whereas some $g\geq f$ may represent a state in which this result has been correctly propagated to $p$.  Similarly, technology allows us to determine the weather tomorrow based on weather data that was collected this morning, but that is not the same thing as knowing what the weather will be: a supercomputer needs to run calculations, and the data needs to be broadcast, and put on a webpage and sent down a cable and rendered to a computer screen, and so on.}

We make this formal in Theorem~\ref{thrm.p.kernel.p}(\ref{item.fg.leq.cc}).
\end{rmrk}


We start with an easy lemma:
\begin{lemm}
\label{lemm.unanimous.implies.confident}
Suppose $(\ns P,\opens)$ is a strongly chain-complete semitopology and $f,g:\ns P\to\tf{Val}$ are value assignments.
Then:
\begin{enumerate*}
\item
If $f\leq g$ and $f$ is confident/unanimous at $p$ then $g$ is also confident/unanimous at $p$.
\item
If $f$ is unanimous at $p\in\ns P$ then it is confident at $p$.
\end{enumerate*}
\end{lemm}
\begin{proof}
By simple arguments from the definitions:
\begin{enumerate}
\item
Just unpacking definitions: if $f$ is continuous on some $\varnothing\lessdot A\subseteq\kernel(p)$ then so is $g$; and if $f$ is continuous on $\community(p)$ then so is $g$.
\item
Suppose $f$ is unanimous at $p$, meaning that $f$ is continuous on $\community(p)$.
Then $f$ is also continuous on some kernel atom in $\community(p)$ --- at least one such kernel atom exists by Corollary~\ref{corr.atom.exists}, since $\ns P$ is strongly chain-complete.
It follows that $f$ is confident at $p$ as required.
\qedhere\end{enumerate}
\end{proof}


\begin{rmrk}
\label{rmrk.machinery.together}
Suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Val}$ is a value assignment.
Then:
\begin{enumerate}
\item
Suppose $f$ is confident at $p\in\ns P$.

By Definition~\ref{defn.regular.f} $f$ is continuous on some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$.
By Lemma~\ref{lemm.topen.max.min} $A$ is transitive, so by Theorem~\ref{thrm.correlated} (since $f$ is continuous on $A$) $f$ is constant on $A$, and thus it makes sense to use Notation~\ref{nttn.f.const} and write $f(A)$ to denote the (unique) value of $f$ on $A$. 
\item
Likewise if $f$ is unanimous at $p$ then we can sensibly write 
$f(\community(p))$.
\item
Just for this paragraph call $f$ \emph{doubly confident} at $p$ when $f$ is continuous on two distinct kernel atoms $\varnothing\lessdot A\neq A'\subseteq\kernel(p)$ of $p$.
Suppose $f$ is doubly confident at $p$ and suppose $p$ is regular; so by the previous paragraph $f(A)$ and $f(A')$ are both well-defined.
Now $A\between A'$ by Lemma~\ref{lemm.kernel.atoms.intersect}, so $f(A)=f(A')$.

Thus being doubly confident at $p$ is the same as just being confident, provided that $p$ is regular so that all of its kernel atoms intersect.
\end{enumerate}
\end{rmrk}



Remark~\ref{rmrk.machinery.together} brings us to a notation:
\begin{defn}
\label{defn.fp.limit}
Suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Val}$ is a value assignment and $p\in\ns P$ is a regular point.
Then define $\lim_p f$ the \deffont{limit} of $f$ at $p$ by 
$$
\lim_p f = f(A) 
$$ 
where $\varnothing\lessdot A\subseteq\kernel(p)$ is some/any (by Remark~\ref{rmrk.machinery.together}(3) writing `some/any' makes sense) kernel atom of $p$ on which $f$ is continuous.
The justification for calling this value the \emph{limit} of $f$ at $p$ is below in Theorem~\ref{thrm.p.kernel.p}, culminating with part~\ref{item.fg.leq.cc} of that result. 
\end{defn}



Recall that Theorem~\ref{thrm.correlated} asserted that continuous value assignments are constant on transitive sets.
We can now prove a more general result along the same lines: 
\begin{thrm}
\label{thrm.p.kernel.p}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a semitopology.
\item
$p\in\ns P$ is regular. 
\item
$f,g:\ns P\to\tf{Val}$ are value assignments to some set of values $\tf{Val}$. 
\end{itemize*}
Then:
\begin{enumerate}
\item
If $f$ is confident at $p$ (Definition~\ref{defn.regular.f}(1)) then
$$
f\leq g
\quad\text{implies}\quad 
\lim_p f = \lim_p g .
$$
\item
If $f$ is confident at $p$ and also $f$ is continuous at $p$ (Definition~\ref{defn.continuity}) then
$$
f(p)=\lim_p f.
$$
\item\label{item.fg.leq.cc}
Combining parts~1 and~2 of this result, if $f$ is confident at $p$ and $g$ is continuous at $p$ then
$$
f\leq g 
\quad\text{implies}\quad 
g(p)=\lim_p f.
$$
In words: the limit value of an $f$ confident at $p$, is the value of any sufficiently continuous extension of $f$ --- where `sufficiently continuous' means `continuous at $p$'.
\item\label{item.gpf}
As a corollary using Lemma~\ref{lemm.unanimous.implies.confident}, if $f$ is unanimous at $p$ (Definition~\ref{defn.regular.f}(2)) and $g$ is continuous at $p$, then 
$$
f\leq g 
\quad\text{implies}\quad 
g(p) = \lim_p f = f(\community(p)).
$$
\end{enumerate}
\end{thrm}
\begin{proof}
We reason as follows:
\begin{enumerate}
\item
Since $f$ is confident at $p$, there exists some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ 
on which $f$ is continuous (by Remark~\ref{rmrk.machinery.together}(3) it does not matter which one).
Since $f\leq g$, $g$ is also continuous at $A$.
It follows from Definition~\ref{defn.fp.limit} that $\lim_p f = \lim_p g$.
\item
Since $f$ is confident at $p$, $f$ is continuous on some kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$. 
Since $f$ is continuous at $p$, $f$ is continuous on some open neighbourhood $p\in O\in\opens$.
By Lemma~\ref{lemm.ker.intersect} $O\between A$, and using Corollary~\ref{corr.correlated.intersect} we have that $f(p) = f(O) = f(A) = \lim_p f$ as required. 
\item
Direct from parts~1 and~2 of this result, using Lemma~\ref{lemm.unanimous.implies.confident}(1) to note that $g$ is confident at $p$ because $f$ is and $f\leq g$.
\item
Suppose $f$ is unanimous at $p$.
Then by Lemma~\ref{lemm.unanimous.implies.confident} $f$ is confident at $p$, and we use part~\ref{item.fg.leq.cc} of this result.
\qedhere\end{enumerate}
\end{proof}



\begin{rmrk}
We can use Theorem~\ref{thrm.p.kernel.p} to obtain a result that seems to us similar in spirit to Arrow's theorem~\cite{fey:strpat} from social choice theory, in the sense that $\kernel(p)$ is identified as a `dictator set' for $\community(p)$ (the technical details seem to be different):
\end{rmrk}


\begin{corr}
\label{corr.boundary.kernel}
Suppose that:
\begin{itemize*}
\item
$(\ns P,\opens)$ is a 
semitopology.
\item
$p\in\ns P$ is regular.
\item
$f,f':\ns P\to\tf{Val}$ are value assignments to some set of values $\tf{Val}$. 
\item
$f$ and $f'$ are continuous and confident at $p$. 
\end{itemize*}
Then
$$
f|_{\kernel(p)}=f'|_{\kernel(p)}
\quad\text{implies}\quad
f(p)=f'(p).
$$
In words we can say:
\begin{quote}
Confident continuous values at regular points are determined by their kernel.
\end{quote}
Note that we assume that $f$ and $f'$ are equal on $\kernel(p)$, but they do not need to be continuous on all of $\kernel(p)$; they only need to be continuous (and confident) at $p$.
\end{corr}
\begin{proof}
By confidence of $f$ and $f'$ 
there exist
\begin{itemize*}
\item
a kernel atom $\varnothing\lessdot A\subseteq\kernel(p)$ on which $f$ is continuous and so (as discussed in Remark~\ref{rmrk.machinery.together}) on which $f$ is constant with value $f(A)=\lim_p f$, and 
\item
a kernel atom $\varnothing\lessdot A'\subseteq\kernel(p)$ on which $f'$ is continuous and so constant with value $f'(A')=\lim_p f'$.
\end{itemize*}
We do not know that $A$ and $A'$ are equal, but by Lemma~\ref{lemm.kernel.atoms.intersect} they intersect --- in symbols: $A\between A'$ --- so that $\lim_p f= \lim_p f'$.\footnote{If we only had $f|_O=f'|_O$ for some open set $O$ that intersects the kernel (so $O\between\kernel(p)$), then the reasoning would break down at this point. 
We would still know that $A\between A'$ but we would not necessarily know that $O\between (A\cap A')$ so that $f(A)=f(A')$ and $\lim_p f=\lim_p f'$.  (Remember that we have not assumed continuity on all of $\kernel(p)$, so $f$ and $f'$ might not be constant on $\kernel(p)$.)}

We use Theorem~\ref{thrm.p.kernel.p}(1) and the above to reason as follows: 
$$
\begin{array}{r@{\ }l@{\qquad}l}
f(p) =& \lim_p f 
&\text{Theorem~\ref{thrm.p.kernel.p}(3)}
\\
=& \lim_p f' 
&\lim_p f {=} f(A),\ \lim_p f' {=} f'(A'),\ A\between A'
\\
=& f'(p) 
&\text{Theorem~\ref{thrm.p.kernel.p}(3).}
\end{array}
$$
\end{proof}




\section{Conclusions}
\label{sect.conclusions}

In this paper, we start by noticing that a notion of `actionable coalition' as discussed in the Introduction, leads to the topology-like structure which we call \emph{semitopologies}.

We simplified and purified our motivating examples --- having to do with understanding agreement and consensus in distributed systems --- to two precise mathematical questions: 
\begin{enumerate*}
\item
understand antiseparation properties, and 
\item
understand the implications of these for value assignments.\footnote{A value assignment is just a not-necessarily-continuous map from a semitopology to a discrete space.}
\end{enumerate*}
We have surveyed the implications of these ideas and if this paper does one thing, it is to make evident that these implications are mathematically rich and varied.
Point-set semitopologies have an interesting theory which obviously closely resembles point-set topology, but is not identical to it.
In particular, dropping the condition that intersections of open sets must be open permits a wealth of new structure, which our taxonomy of antiseparation properties and its applications to value assignments explores. 
This paper provides many specific results, but we also hope that it will serve as a stimulus to considering semitopologies as a new field of research.


\subsection{Topology vs. semitopology}
\label{subsect.vs}

We briefly compare and contrast topology and semitopology: 
\begin{enumerate}
\item
\emph{Topology:}\ 
Topology considers a wealth of separation properties, but we are not aware of a taxonomy of anti-separation properties in the topological literature.\footnote{The Wikipedia page on separation axioms (\href{https://web.archive.org/web/20221103233631/https://en.wikipedia.org/wiki/Separation_axiom}{permalink}) includes an excellent overview with over a dozen separation axioms; no anti-separation axioms are proposed.  Important non-Hausdorff spaces do exist; e.g. the \emph{Zariski topology}~\cite[Subsection~1.1.1]{hulek:eleag}.} 

\emph{Semitopology:}\ 
This paper considers a taxonomy of antiseparation properties, including: points being intertwined (see Definition~\ref{defn.intertwined.points} and Remark~\ref{rmrk.not.hausdorff}), and points being quasiregular, indirectly regular, weakly regular, and regular (Definitions~\ref{defn.tn} and~\ref{defn.indirectly.regular}), (un)conflicted (Definition~\ref{defn.conflicted}(\ref{item.unconflicted})), and hypertransitive (Definition~\ref{defn.sc}).\footnote{An extra word on the converse of this:  Our theory of semitopologies admits spaces whose points partition into distinct communities, as discussed in Theorem~\ref{thrm.topen.partition} and Remark~\ref{rmrk.partition}.  To a professional blockchain engineer it might seem terrible if two points points are \emph{not} intertwined, since this means they might not be in consensus in a final state. 
Should this not be excluded by the definition of semitopology, as is done in the literature on quorum systems, where it typically definitionally assumed that all quorums in a quorum system intersect?  
No! 
Separation is a fact of life which we permit not only so that we can mathematically analyse it (and we do), but also because we may need it for certain \emph{normal situations}.
For example, most blockchains have a \emph{mainnet} and several \emph{testnets} and it is understood that each should be coherent within itself, but different nets \emph{need not} be in consensus with one another.  Indeed, if the mainnet had to agree with a testnet then this would likely be a bug, not a feature.  So the idea of having multiple partitions is nothing new \emph{per se}.  It is a familiar idea, which semitopologies put in a powerfully general mathematical context.}
\item
\emph{Topology:}\quad 
If a minimal open neighbourhood of a point exists then it is least, because we can intersect two minimal neighbourhoods to get a smaller one which by minimality is equal to both.

Yet, in topology the existence of a least open neighbourhood is not guaranteed (e.g. $0\in\mathbb R$ has no least open neighbourhood).

\emph{Semitopology:}\ 
A point may have multiple minimal open neighbourhoods --- examples are very easy to generate, see e.g. the top-right example in Figure~\ref{fig.012}.
Furthermore, in the useful special case of a chain-complete semitopology, every open neighbourhood of $p$ contains a(t least one) minimal open neighbourhood of $p$ (Corollary~\ref{corr.cover.exists}) so that existence of minimal open neighbourhoods is assured. 
\item
\emph{Topology:}\quad 
We are typically interested in functions on topologies that are continuous (or mostly so, e.g. $f(x)=1/x$).
Thus for example, the definition of $\tf{Top}$ the category of topological spaces takes continuous functions as morphisms, essentially building in assumptions that continuous functions are of most interest and that finding them is enough of a solved problem that we can restrict to continuous functions in the definition.
 
\emph{Semitopology:}\quad 
For our intended application to consensus, 
we are explicitly interested in functions that may be discontinuous.
This models initial and intermediate states where local consensus has not yet been achieved, or final states on semitopologies that include disjoint topens and non-regular points (e.g. conflicted points), as well as adversarial or failing behaviour.
Thus, having continuity is neither a solved problem, nor even necessarily desirable.
\item
Sometimes, definitions from topology transfer to semitopology but split into multiple distinct notions when they do. 
For example: topology has one notion of \emph{dense subset of} and, as discussed in Remark~\ref{rmrk.top.ce}, when we transfer this to semitopologies it splits into two notions --- \emph{weakly} dense and \emph{strongly} dense (Definition~\ref{defn.dense}) --- both of which turn out to be important.

Sometimes, ideas that come from semitopology project down to topology but may lose impact in doing so; they make mathematical sense, but become less interesting, or at least lose finesse.
For example: our theory of semitopologies considers notions of \emph{topen set} and \emph{strongly topen set} (Definitions~\ref{defn.transitive} and~\ref{defn.strongly.transitive}).
In topology these are equivalent to one another, and to a known and simpler topological property of being \emph{hyperconnected} (Definition~\ref{defn.tangled}).\footnote{\dots but (strong) topens are their own thing.  Analogy: a projection from $\mathbb C$ to $\mathbb R$ maps $a+bi$ to $a$; this is not evidence that $i$ is equivalent to $0$!} 
Something similar happens with the semitopological notion of \emph{strongly dense for}; see the discussion in Remark~\ref{rmrk.strongly.dense.for}.
\item
Semitopological questions such as \emph{`is this a topen set'} or \emph{`are these two points intertwined'} or \emph{`does this point have a topen neighbourhood'} --- and many other definitions in this paper, such as our taxonomy of points into \emph{regular}, \emph{weakly regular}, \emph{indirectly regular}, \emph{quasiregular}, \emph{unconflicted}, and \emph{hypertransitive}; or the notions of \emph{witnessed set}, and \emph{kernel} \dots and so on --- appear to be novel.

Also in the background 
is that we are particularly interested in properties and algorithms that work well using local and possibly incomplete or even partially incorrect information.

Thus semitopologies have their own distinct character: because they are mathematically distinct, and because modern applications having to do with actionable coalitions and distributed systems motivate us to ask questions that have not necessarily been considered before.
\end{enumerate}

\subsection{Related work}
\label{subsect.related.work}

\paragraph*{Semiframes}

This paper is about point-set semitopologies: everything we do is in concrete sets, just as in point-set topology.

Yet, a semitopology is just a complete subsemilattice of a powerset --- just as a topology is just a complete and finitely co-complete sublattice of a powerset.
The reader may know of \emph{pointless topology}, which abstracts away the concrete powerset to a pointless (i.e. point-free) theory of \emph{locales}; an accessible and brief discussion is in~\cite{johnstone:poipt}.

A companion paper~\cite{gabbay:semahc} (unpublished draft, submitted for publication) treats semitopologies from a pointless, algebraic, and categorical perspective.
We set up categories of semitopologies and semiframes and construct a categorical duality between them, consciously imitating the classic duality between topologies and frames --- and this is informative, since the proofs require semiframes to be more than just semilattices; they come out as something else.
We also give algebraic characterisations of the regularity properties considered in this paper, such as those mentioned in Definition~\ref{defn.tn}. 



\paragraph*{Union sets and minimal structures}


There is a thread of research into \emph{union-closed families}; these are subsets of a finite powerset closed under unions, so that a union-closed families is precisely just a finite semitopology. 
The motivation is to study the combinatorics of finite subsemilattices of a powerset.
Some progress has been made in this~\cite{poonen:unicf}; the canonical reference for the relevant combinatorial conjectures is the `problem session' on page~525 (conjectures 1.9, 1.9', and 1.9") of~\cite{rival:grao}.
See also recent progress in a conjecture about union-closed families (\href{https://web.archive.org/web/20230330170701/https://en.wikipedia.org/wiki/Union-closed_sets_conjecture#Partial_results}{permalink}).

There is no direct connection to this work, though the combinatorial properties considered may yet become useful for proving properties of concrete algorithms.

A \emph{minimal structure} on a set $X$ is a subset of $\powerset(X)$ that contains $\varnothing$ and $X$.
Thus a semitopology is a minimal structure that is also closed under arbitrary unions.
There is a thread of research into minimal structures, studying how notions familiar from topology (such as continuity) fare in weak (minimal) settings~\cite{noiri:defsgf} and how this changes as axioms (such as closure under unions) are added or removed.
An accessible discussion is in~\cite{szaz:minsgt}, and see the brief but comprehensive references in Remark~3.7 of that paper.
Of course our focus is on properties of semitopologies 
which are not considered in that literature; but we share an observation with minimal structures that it is useful to study topology-like constructs, in the absence of closure under intersections. 

\paragraph*{Gradecast converges on a topen}

Many consensus algorithms have the property that once consensus is established in a quorum $O$, it propagates to $\closure{O}$.
For example, in the Grade-Cast algorithm~\cite{feldman_optimal_1988}, participants assign a confidence grade of 0, 1 or 2 to their output and must ensure that if any participant outputs $v$ with grade 2 then all must output $v$ with grade at least 1.
If all the quorums of a participant intersect some set $S$ that unanimously supports value $v$, then the participant assigns grade at least 1 to $v$.

From the view of our paper, this is just taking a closure, which suggests that, to convince a topen to agree on a value, it would suffice to first convince an open neighbourhood that intersects the topen, and then use Grade-Cast to convince the whole topen.
More on this in Proposition~\ref{prop.open.strong-consensus} and Remark~\ref{rmrk.gradecast}. 



\paragraph*{Algebraic topology as applied to distributed computing tasks}

Continuing the discussion of tasks above, the reader may know that solvability results about distributed computing tasks have been obtained from algebraic topology, starting with the impossibility of wait-free $k$-set consensus using read-write registers and the Asynchronous Computability Theorem~\cite{herlihy_asynchronous_1993,borowsky_generalized_1993,saks_wait-free_1993} in 1993.
See~\cite{herlihy_distributed_2013} for numerous such results.

The basic observation is that the set of final states of a distributed algorithm forms a simplicial complex, called the \emph{protocol complex}, and topological properties of this complex, like connectivity, are constrained by the underlying communication and fault model.
These topological properties in turn can determine what tasks are solvable.
For example: every algorithm in the wait-free model with atomic read-write registers has a connected protocol complex, and because the consensus task's output complex is disconnected, consensus in this model is not solvable~\cite[Chapter~4]{herlihy_distributed_2013}.

This paper is also topological, but in a different way: we use (semi)topologies to study consensus in and of itself, rather than the solvability of consensus or other tasks in particular computation models.
Put another way: the papers cited above use topology to study the solvability of distributed tasks, but this paper shows how the very idea of `distribution' can be viewed as having a semitopological foundation.

Of course we can imagine that these might be combined --- that in future work we may find interesting and useful things to say about the topologies of distributed algorithms when viewed as algorithms \emph{on} and \emph{in} a semitopology. 




\paragraph*{Fail-prone systems and quorum systems}

Given a set of processes $\ns P$, a \emph{fail-prone} system~\cite{malkhi_byzantine_1998}  (or \emph{adversary structure}~\cite{hirt_player_2000}) is a set of \emph{fail-prone sets} $\mathcal{F}=\{F_1,...,F_n\}$ where, for every $1\leq i\leq n$, $F_i\subseteq \ns P$.
$\mathcal{F}$ denotes the assumptions that the set of processes that will fail (potentially maliciously) is a subset of one of the fail-prone sets.
A \emph{dissemination quorum system} for $\mathcal{F}$ is a set  $\{Q_1,..., Q_m\}$ of quorums where, for every $1\leq i\leq m$, $Q_i\subseteq \ns P$, and such that 
\begin{itemize*}
\item
for every two quorums $Q$ and $Q'$ and for every fail-prone set $F$, $\left(Q\cap Q'\right)\setminus F\neq\emptyset$ and 
\item
for every fail-prone set $F$, there exists a quorum disjoint from $F$.
\end{itemize*}
Several distributed algorithms, such as Bracha Broadcast~\cite{bracha_asynchronous_1987} and PBFT~\cite{castro_practical_2002}, rely on a quorum system for a fail-prone system $\mathcal{F}$ in order to solve problems such as reliable broadcast and consensus assuming (at least) that the assumptions denoted by $\mathcal{F}$ are satisfied.

Several recent works generalise the fail-prone system model.
Under the failure assumptions of a traditional fail-prone system, Bezerra et al.~\cite{bezerra_relaxed_2022} study reliable broadcast when participants each have their own set of quorums.
Asymmetric Fail-Prone Systems~\cite{cachin_asymmetric_2019} generalise fail-prone systems to allow participants to make different failure assumption and have different quorums.
In Permissionless Fail-Prone Systems~\cite{cachin_quorum_2023}, participants not only make assumptions about failures, but also make assumptions about the assumptions of other processes;
the resulting structure seems closely related to witness semitopologies, but the exact relationship still needs to be elucidated.

In Federated Byzantine Agreement Systems~\cite{mazieres2015stellar}, participants declare quorum slices and quorums emerge out of the collective quorum slices of their members.
Quorum slices are a special case of the notion of witness-set in Definition~\ref{defn.witnessed.set}(\ref{witness.witness}).
Garca-Prez and Gotsman~\cite{garcia2018federated} rigorously prove the correctness of broadcast abstractions in Stellar's Federated Byzantine Agreement model and investigate the model's relationship to dissemination quorum systems.
The Personal Byzantine Quorum System model~\cite{losa:stecbi} is an abstraction of Stellar's Federated Byzantine Agreement System model and accounts for the existence of disjoint consensus clusters (in the terminology of the paper) which can each stay in agreement internally but may disagree between each other.
Consensus clusters are closely related to the notion of topen in Definition~\ref{defn.transitive}(\ref{transitive.cc}).

Sheff et al. study heterogeneous consensus in a model called Learner Graphs~\cite{sheff_heterogeneous_2021} and propose a consensus algorithm called Heterogeneous Paxos.

Cobalt, the Stellar Consensus Protocol, Heterogeneous Paxos, and the Ripple Consensus Algorithm~\cite{macbrough_cobalt_2018,mazieres2015stellar,sheff_heterogeneous_2021,schwartz_ripple_2014} are consensus algorithms that rely on heterogeneous quorums or variants thereof.
The Stellar network~\cite{lokhafa:fassgp} and the XRP Ledger~\cite{schwartz_ripple_2014} are two global payment networks that use heterogeneous quorums to achieve consensus among an open set of participants; the Stellar network is an instance of a witness semitopology.

Quorum systems and semitopologies are not the same thing.
Quorum systems are typically taken to be such that all quorums intersect (in our terminology: they are \emph{intertwined}), whereas semitopologies do not require this.
On the other hand, quorums are not always taken to be closed under arbitrary unions, whereas semitopologies are (see the discussion in Example~\ref{xmpl.semitopologies}(\ref{item.quorum.system})).

But there are also differences in how the maths has been used and understood.
This paper has been all about point-set topology flavoured ideas, whereas the literature on fail-prone systems and quorum systems has been most interested in synchronisation algorithms for distributed systems. 
We see these interests as complementary, and the difference in emphasis is a feature, not a bug.
Some work by the second author and others~\cite{losa:stecbi} gets as far as proving an analogue to Lemma~\ref{lemm.cc.unions} (though we think it is fair to say that the presentation in this paper is much simpler and more clear), but it fails to notice the connection with topology and the subsequent results which we present in this paper.


\subsection{Future work} 

There is a great deal more to say than we have covered in this paper.\footnote{\dots for all its length, it's just a start.} 
We briefly outline the many ways in which this work can be extended and improved:
\begin{enumerate}
\item
In Definition~\ref{defn.value.assignment} we define a \emph{value assignment} $f:\ns P\to\tf{Val}$ to be a function from a semitopology to a codomain $\tf{Val}$ that is given the discrete semitopology.
This is a legitimate starting point, but of course we should consider more general codomains.
This could include an arbitrary semitopology on the right (for greatest generality), but even for our intended special case of consensus it would be interesting to try to endow $\tf{Val}$ with a semilattice structure (or something like it), at least, e.g. to model merging of distinct updates to a ledger.\footnote{We write `something like it' because we might also consider, or consider excluding, possibly conflicting updates.}
We can easily generate a (semi)topology from a semilattice by taking points to be elements of the lattice and open sets to be up-closed sets, and this would be a natural generalisation of the discrete semitopologies we have used so far.
\item
We have not considered morphisms of semitopologies and how to organise semitopologies into a category.
Since this paper was drafted, we have completed a treatment of the category of semitopologies, along with a categorical duality with a category of what we call \emph{semiframes}, and of algebraic versions of the anti-separation and regularity properties considered in this paper.
This is described in~\cite{gabbay:semahc} (submitted and under review). 
\item 
We have discussed dense subsets, but not (yet) considered notions of sequence or net convergence.
Nor have we considered what would correspond to the exponential (or \emph{Vietoris}) semitopology.
Semilattice representation results exist~\cite{bredhikin:repts}, but a design space exists here and we should look for representations well-suited to computationally verifying or refuting properties of witness semitopologies.
\item
We mentioned in Subsection~\ref{subsect.related.work} that this paper on semitopology is not about algebraic topology applied to solvability of distributed computing tasks.
These are distinct topics, and the fact that they share a word in their name does not make them any more equal than a Great Dane and a Danish pastry.

But, it is a very interesting question what algebraic \emph{semi}topology might look like.
To put this another way: what is the geometry of semitopological spaces?
We would very much like to know.
\item
It remains to consider Byzantine behaviour, by which we mean that some participants may misreport their view of the network in order to `invent' or sabotage quorums and so influence the outcome of consensus.

So for instance we can ask: ``What conditions can we put on a witness function to guarantee that changing the witness function at one point $p$ will not change $\kernel(p')$ for any $p'\neq p$?''.
Thus intuitively, given a semitopology $(\ns P,\opens)$ we are interested in asking how properties range over an `$\epsilon$-ball' of perturbed semitopologies --- as might be caused by various possible non-standard behaviours from a limited number of Byzantine points --- and in particular we are looking for criteria to guarantee that appropriately-chosen good properties be preserved under perturbation.
\item
This paper studies how consensus, once achieved on an open set $O$, propagates to its closure $\closure{O}$; see Proposition~\ref{prop.open.strong-consensus} and Remark~\ref{rmrk.gradecast}. 
But this is just half of the problem of consensus: it remains to consider (within our semitopological framework) what it is to attain consensus on some open set in the first place.
That is: suppose $(\ns P,\opens)$ is a semitopology and $f:\ns P\to\tf{Var}$ is a value assignment.
Then what does it mean, in maths and algorithms, to find a value assignment $f':\ns P\to\tf{Var}$ that is `close' to $f$ but is continuous on some open set $O$?
In this paper we have constructed a detailed theory of what it would then be to extend $f'$ to an $f''$ that continuously extends $f'$ to regular points; but we have not yet looked at how to build the $f'$. 
We speculate that unauthenticated Byzantine consensus algorithms (like Information-Theoretic HotStuff~\cite{abraham_information_2020}) can be understood in our setting; unlike authenticated algorithms, unauthenticated algorithms do not rely on one participant being able to prove to another, by exhibiting signed messages, that a quorum has acted in a certain way.
\end{enumerate}


%\bibliographystyle{amsalpha}
%\bibliography{JamieBIB}
\input{topoc.bbl}

\end{document}
