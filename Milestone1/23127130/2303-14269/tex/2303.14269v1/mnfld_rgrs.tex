 

\documentclass[11pt]{article}
\usepackage{palatino}

%%%MY FILES%%%
 
\usepackage[margin = 1in]{geometry}

\input{notation}



%\usepackage{setspace}
%\setstretch{1}


%\usepackage[margin = 1.25in]{geometry}



%\newcommand{\sj}[1]{\textcolor{blue}{SJ: #1}}

\def  \FF{\ff_{\text{eff}}}
 \def \RF{{\mathRF}}
\def \diago{{\diag}}


\def \citet{\cite}  

\DeclareMathOperator*{\ISO}{ISO} 
\DeclareMathOperator*{\proj}{proj} 
\DeclareMathOperator*{\mathRF}{RF} 
\DeclareMathOperator*{\diag}{diag} 
\DeclareMathOperator*{\GL}{GL} 
\DeclareMathOperator*{\Spec}{Spec} 
\DeclareMathOperator*{\inv}{inv} 
\DeclareMathOperator*{\vol}{vol} 
\DeclareMathOperator*{\id}{id} 






%%%%%%%%%%%




 
\usepackage{microtype}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{booktabs}  
\usepackage{hyperref}

 
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}

 
\usepackage[capitalize,noabbrev]{cleveref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% THEOREMS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

 
\usepackage[textsize=tiny]{todonotes}
 

\begin{document}





\title{The Exact Sample Complexity Gain from Invariances for Kernel Regression on Manifolds}

 
\author{
  Behrooz Tahmasebi  \\ 
  MIT CSAIL\\ 
  \texttt{bzt@mit.edu} \and
    Stefanie Jegelka  \\ 
  MIT CSAIL\\ 
  \texttt{stefje@mit.edu} 
}

\date{}
\maketitle



\begin{abstract}
In practice, encoding invariances into models helps sample complexity. In this work, we tighten and generalize theoretical results on how invariances improve sample complexity. In particular, we provide minimax optimal rates for kernel ridge regression on any manifold, with a target function that is invariant to 
an arbitrary group action on the manifold.
Our results hold for (almost) any group 
action, even groups of positive dimension. For a finite group, the gain increases the ``effective'' number of samples by the group size. For groups of positive dimension, the gain is observed by a reduction in the manifold's dimension, in addition to a factor proportional to the volume of the quotient space. Our proof takes the viewpoint of differential geometry, in contrast to the more common strategy of using invariant polynomials. Hence, this new geometric viewpoint on learning with invariances may be of independent interest.
\end{abstract}





\section{Introduction}













In a broad range of applications, including machine learning for physics, molecular biology, point clouds, and social networks, the underlying learning problems are invariant with respect to a group action.
The invariances are observed widely in practice, for instance, in the study of high energy particle physics \cite{fenton2022permutationless, lee2020zero}, galaxies \cite{gonzalez2018galaxy, dominguez2018improving, aniyan2017classifying}, and also molecular datasets \cite{anderson2019cormorant, schutt2021equivariant, wang2021symmetry, li2021hamnet} (see \cite{willard2020integrating} for a survey).
In learning with invariances, one aims to develop powerful architectures that exploit the problem's invariance structure as much as possible.  An essential question is thus: what are the fundamental benefits of model invariance, e.g., in terms of sample complexity?










 
 





Several architectures for learning with invariances have been proposed for various types of data and invariances, including DeepSet \cite{zaheer2017deep} (for sets), Convolutional Neural Networks (CNNs)  \cite{krizhevsky2017imagenet} (for images), PointNet  \cite{qi2017pointnet, qi2017pointnetplus} (for point clouds with permutation invariance), 
tensor field neural networks  \cite{thomas2018tensor} (for point clouds with rotations, translations, and permutations symmetries), 
Graph Neural Networks (GNNs) \cite{scarselli2008graph} (for graphs), SignNet and BasisNet \cite{lim2022sign} (for spectral data) -- see in addition \cite{villar2021scalars} for invariance with respect to the orthogonal group, and \cite{maron2018invariant} for invariant and equivariant graph networks. These architectures are to exploit the invariance of data as much as possible, and are invariant/equivariant by design. 


In fixed dimensions, one important common feature of many invariant models, including those discussed above, is that the data lie on a manifold (not necessarily a sphere, e.g., the Stiefel manifold for spectral data), 
and are invariant with respect to a  group action on that manifold. 
Thus, characterizing the theoretical gain of invariances corresponds to studying the gain of learning under group actions on manifolds. Adopting this view, 
in this paper, we answer the question: \emph{how much gain in sample complexity is achievable by encoding invariances?} As this problem is algorithm and model dependent, it is hard to address in general, as it needs a precise analysis of deep invariant networks. A focused version of the problem,  but still interesting, is to study the same sample complexity gain in kernel-based algorithms, which is what we address here. As neural networks in certain regimes behave like kernels (for example, the Neural Tangent Kernel (NTK) \cite{jacot2018neural, li2019enhanced}), the results on kernels should be understood as relevant to a range of models.  


 

Formally, we consider kernel (ridge) regression (KRR) with i.i.d.\ data on a manifold $\calM$. The target function lies in a Reproducing Kernel Hilbert space (RKHS) of Sobolev functions $\calH^s(\calM)$, $s\ge 0$. % (larger $s$ corresponds to including more smooth functions).  
In addition, the target function is invariant to the action of an arbitrary group $G$ on the manifold. 
%The Kernel Ridge Regression (KRR) optimization problem returns the regularized empirical risk minimizer and can be expressed as a closed-form solution of a convex optimization program.  Note that this is the classical setting of learning with kernels.  
We aim to quantify:  \emph{by varying the group $G$, how does the sample complexity change, and what is the precise gain as $G$ grows?}



\textbf{Main results.} Our main results characterize minimax optimal rates for the convergence of the population risk (generalization error) of KRR with invariances.
 More precisely, for the Sobolev kernel, the most commonly studied case of kernel regression, we prove that a (excess) population risk  (generalization error) $\propto \Big ( \frac{\sigma^2 \vol(\calM / G)}{n}\Big)^{s/(s+d/2)},$ is both achievable and minimax optimal,   where $\sigma^2$ is the variance of the observation noise, $\vol(\calM / G)$ is the volume\footnote{
 While the quotient space is not always a manifold, we will show that a notion of volume can still be defined for it.
 } of the corresponding quotient space, and $d$ is the effective dimension of the \emph{quotient space} (see Section \ref{ps} for a precise definition).
%
This result shows a reduction in sample complexity in \emph{two} intuitive ways: scaling the effective number of samples, and reducing dimension and hence exponent. First, for finite groups, the factor $\vol(\calM / G)$ reduces to $\vol(\calM)/|G|$, and can hence be interpreted as scaling the ``effective'' number of samples by the size of the group. That is, each data point conveys the information of $|G|$ data points due to the invariance. Second, and importantly, the parameter $d$ in the exponent can in general be much smaller than $\dim(\calM)$, which would be the correspondent of $d$ in the non-invariant case. In the best case, $d = \dim(\calM) - \dim(G)$, where $\dim(G)$ is the dimension of the Lie group $G$. Hence, the second gain shows a gain in the dimensionality of the space, and hence in the exponent.  

Our results generalize and greatly expand previous results 
%by
  \citet{bietti2021sample}, which only apply to finite groups and isometric actions and are valid only on spheres. In contrast, we derive optimal rates for all manifolds and groups, including groups of positive dimension. In particular, the reduction in dimension applies to infinite groups, since for finite groups $\dim(G)=0$. Hence, our results bring out a new perspective on the reduction in sample complexity that was not possible with previous assumptions. Our rates are consistent with the classical results for learning in Sobolev spaces on manifolds without invariances \cite{hendriks1990nonparametric}. 

To illustrate the general results, in Section~\ref{examples}, we make our results explicit for kernel counterparts of popular invariant models, such as DeepSets, GNNs, PointNet, and SignNet.
 
 % This generalizes previous results by  \citet{bietti2021sample}, which only apply to finite groups, isometric actions, and are valid only on spheres. In contrast, we derive optimal rates for all manifolds and groups, including groups of positive dimension. Indeed, while for finite groups, $\dim(G)=0$, the parameter $d$ can be significantly smaller than $\dim(\calM)$ in general; in the most extreme case, $d = \dim(\calM) - \dim(G)$ where $\dim(G)$ is the dimension of the Lie group $G$. This shows that, while all the rates considered here suffer from the curse of dimensionality, the
% exact gain of invariance can even provably change the effective dimension of the space. In addition, the factor $\vol(\calM / G)$, which reduces to $\vol(\calM)/|G|$ for finite groups, can be interpreted as a reduction in the sample size by considering the "effective" number of samples while using an invariant model.  
% It is also worth mentioning that the achieved rates are  consistent with the classical results for learning in Sobolev spaces on manifolds without invariances \cite{hendriks1990nonparametric}. 
%  Given the general result, in Section~\ref{examples} we address several instances of learning with invariant models (such as DeepSets, GNNs, PointNet, SignNet, etc.) and explicitly compute the gain of their kernel-based counterpart. 


  
Even though our theoretical results look intuitively reasonable, the proof is challenging: the quotient space $\calM/G$ is not always a manifold and may exhibit non-trivial boundaries that complicate matters; we explain these challenges in the proof sketch (Section \ref{prs}). 
In fact, the ideas behind the proof are of potential independent interest: we provide a differential geometric viewpoint of the class of functions defined on manifolds and study the group actions on manifolds from this perspective. This stands in contrast to the classical way of using polynomials generating the class of functions, which is restricted to spheres. The theory of the Laplace-Beltrami operator is at the core of our analysis for simple reasons: the existence of Weylâ€™s asymptotic law and the diagonalizability of the Sobolev kernel in the Laplace spectrum provide a basis for analyzing the actual dimension of the problem. 
 To the best of our knowledge, the tools used in the paper are new to the literature on learning with invariances. 


In short, we make the following contributions: 
\begin{itemize}\setlength{\itemsep}{2pt}
\item We characterize the exact sample complexity gain from invariances for kernel regression on manifolds for an arbitrary group action. 
\item Our proof technique based on differential geometry may be of independent interest.
\end{itemize}






\section{Related Work}

The perhaps closest related work to this paper is \cite{bietti2021sample}, which considers the same setup for finite isometric actions on spheres. We generalize their result in several aspects: the group actions are not necessarily finite or isometric, and the manifold is arbitrary (including compact submanifolds of $\mathbb{R}^k$), and can hence observe a new axis of complexity gain.  
%\citet{mei2021learning} 
In \citet{mei2021learning}, the authors 
consider invariances for random features and kernels, but in a different scaling/regime; thus, theirs are not comparable to our results. For density estimation on manifolds, optimal rates are given in \cite{hendriks1990nonparametric}, which are consistent with our theory. Also,  non-asymptotic sample complexity bounds for regression on manifolds are known in the literature \cite{mcrae2020sample}. A similar technique was recently applied in \cite{ma2022optimally}, but for a very different setting of covariate shifts.







The generalization benefits for invariant classifiers are observed in the most basic setup in \cite{sokolic2017generalization}, and for linear invariant/equivariant networks in \cite{elesedy2021provably, elesedy2021provablykernel}. Some works propose covering ideas to measure the generalization benefit of invariant models 
\cite{zhu2021understanding}, while others use the properties of the quotient space \cite{sannai2021improved, mroueh2015learning}. 
It is known that structured data exhibit certain gains for localized classifiers \cite{ciliberto2019localized}. 
Sample complexity gains are also observed for CNN on images \cite{du2018many, li2020convolutional}. 
%\citet{wang2020incorporating} 
In \citet{wang2020incorporating} , the authors
incorporate more symmetry in CNNs to improve generalization. 











Many works introduce models for learning with invariances for various data types; in addition to those mentioned in the introduction, there are, e.g., group invariant scattering models \cite{mallat2012group, bruna2013invariant}. 
A probabilistic viewpoint of invariant/equivariant functions \cite{bloem2020probabilistic} and a functional perspective \cite{zweig2021functional} also exist in the literature. 
The connection between group invariances and data augmentation is addressed in \cite{chen2020group,lyle2020benefits}. 


Universal expressiveness has been studied for many settings; e.g., rotation equivariant point clouds \cite{dym2020universality},  sets with symmetric elements \cite{maron2020learning}, permutation invariant/equivariant functions \cite{sannai2019universal}, invariant neural networks \cite{ravanbakhsh2020universal,yarotsky2022universal, maron2019universality}, and graph neural networks \cite{xu2018powerful,morris19}. 
%\citet{lawrence22implicit} 
In \citet{lawrence22implicit}, the authors
study the implicit bias of linear equivariant networks. For surveys on invariant/equivariant neural networks, see 
\cite{gerken2021geometric,bronstein2021geometric}. 















\section{Preliminaries and Problem Statement}\label{ps}


Consider a smooth connected closed\footnote{
While all the results in this paper can be adjusted to hold for a manifold with boundary, we consider the boundaryless case here for simplicity. 
} (i.e., compact boundaryless) $\dim(\calM)-$dimensional (Riemannian) manifold $(\calM, g)$, 
where $g$ is the Riemannian metric.
Let $G$  denote an arbitrary compact Lie group of dimension $\dim(G)$ (i.e., a group with a smooth manifold structure), and assume that $G$ acts smoothly on the manifold $(\calM,g)$; this means that each $\tau \in G$ corresponds to a diffeomorphism $\tau: \calM \to \calM$, i.e., an invertible smooth map. 
Without loss of generality, we can assume that $G$ acts \textit{isometrically} on $(\calM,g)$, i.e., $G$ is a Lie subgroup of the isometry group  $\ISO(\calM,g)$. To see why this is not restrictive, given a base metric $g$, consider a new metric $\tilde{g} = \mu_G(\tau^*g)$, where $\mu_G$ is the left-invariant Haar (uniform) measure of $G$, and $\tau^*g$ is the pullback of the metric  $g$ by $\tau$. Under the new metric, $G$ acts isometrically on $(\calM,\tilde{g})$.  
We review basic facts about manifolds and their isometry groups in Appendix \ref{preli_mnfld} and Appendix \ref{preli_iso}.
 





A dataset $\calS = \{ (x_i,y_i): i= 1,2,\ldots,n\} \subseteq (\calM \times \R)^n$ of $n$ labeled samples is given where $x_i \sim_{\text{i.i.d.}} \mu$, for 
the uniform (Borel) probability measure $d\mu(x):=\frac{1}{\vol(\calM)}d\vol_g(x)$%, which is therefore absolutely continuous with respect to $d\vol_g$
. Here, $d\vol_g(x)$ denotes the volume element of the manifold defined using the Riemannian metric $g$. We assume the uniform sampling for simplicity; our results hold for non-uniform cases, too.
The hypothesis class is a set $\calF\subseteq L^2_{\inv}(\calM,G) \subseteq L^2(\calM)$ including only $G-$invariant square-integrable functions on the manifold, i.e.,  any $f \in L^2(\calM)$ satisfying $f(\tau(x))=f(x)$ for all $\tau \in G$.
%We assume the data to satisfy that 
%the following condition (being \emph{well-specified} with respect to $\calF$): 
We assume that
there exists a function $f^\star \in \calF$ such that $y_i = f^\star(x_i)+ \epsilon_i$ for each  $(x_i,y_i) \in \calS$, where $\epsilon_i$'s are conditionally zero-mean random variables with variance $\sigma^2$, i.e., $\E[\epsilon_i|x_i] = 0$ and $\E[\epsilon^2_i|x_i]\le \sigma^2$. 




Let $K:\calM \times \calM$ denote a continuous positive-definite symmetric  (PDS) kernel on the manifold $\calM$,  and $\calH \subseteq L^2(\calM)$ denote its Reproducing Kernel Hilbert Space (RKHS). The kernel $K$ is \emph{$G-$invariant}\footnote{
This definition is different from being shift-invariant; a kernel $K$ is shift-invariant (with respect to the group $G$) if and only if $
    K(x,y)= K(\tau(x), \tau(y)),
$
for all $x,y \in \calM$, and all $\tau$. For any given shift-invariant kernel $K$, one can construct a $G$-invariant kernel $\tilde{K}(x,y) = \int_G K(\tau(x),y) d\mu_G(\tau)$, where $\mu_G$ is the left-invariant Haar (uniform) measure of $G$. 
} if and only if for all $x,y \in \calM$,
\begin{align}
K(x,y) = K(\tau(x), \tau'(y)),
\end{align}
for any $\tau,\tau' \in G$; in other words, $K(x,y) = K([x],[y])$, where $[x] := \{ \tau(x): \tau \in G\}$ is the orbit of the group action that includes $x$. 



Kernel Ridge Regression (KRR) on the data $\calS$ with a $G-$invariant kernel $K$ asks to find the function $\hat{f}$ that minimizes %the regularized empirical risk
%solving  the following convex optimization problem:
\begin{align}
\hat{f}:=\argmin_{f \in \calH} ~  \Big \{ \frac{1}{n}\sum_{i=1}^n (y_i - f(x_i))^2 + \eta \|f\|^2_{\calH} \Big \}.
\end{align}
%with $\calRR(f):=\frac{1}{n}\sum_{i=1}^n (y_i - f(x_i))^2$ is called the empirical risk of $f \in \calH$, and $\eta$ is the regularization parameter.  
By the representer theorem \cite{mohri2018foundations}, the optimal solution $\hat{f} \in \calH$ is of the form
$\hat{f} = \sum_{i=i}^{n} a_i K(x_i,.)$ for a weight vector $\ba \in \R^n$. The empirical risk $\calRR(h)$ can thus be written as 
\begin{align}
\calRR(h) = \frac{1}{n} \| \by - \bK \ba\|_2^2 +\eta \ba^T \bK \ba,
\end{align}
where $\by = (y_1, y_2, \ldots, y_n)^n$ and $\bK = \{K(x_i,x_j)\}_{i,j=1}^n$ is the Gram matrix. This gives the closed-form solution $\ba = (\bK + n\eta I)^{-1} \by$.  

Using the population risk $\calR(f):= \E_{x \sim \mu} [(y- f(x))^2]$, the \emph{effective ridge regression estimator} is defined as
\begin{align}
\FF: = \argmin_{f \in \calH} ~ \Big \{ \calR(f) + \eta \|f\|^2_{\calH}\Big \}.
\end{align}

 In this paper, we focus on  the class of Sobolev functions, $f^\star \in \calH^s(\calM)$, $s>0$. For $G-$invariant functions,  $\calH^s_{\inv}(\calM) = \calH^s(\calM) \cap L^2_{\inv} (\calM,G)$. Note that $\calH^s(\calM)$ has only continuous functions when $s>d/2$. Moreover, it contains only continuously differentiable functions up to order $k$ when $s>d/2+k$ (Appendix \ref{sobolev_kernel}). 
% Let us define $s = \frac{d}{2}(\kappa+1)$ for a positive $\kappa$. 


\subsection{Laplacian on Manifolds}




 

%We now have the following decomposition of error terms:
%\begin{align}
%\calR(\ff) & = \calR(\ff) - \calRR(\ff) &&\quad  \quad \text{(concentration)}
%\\& + \calRR(\ff) - \calRR(\FF) && \quad  \quad  (\text{by definition} ~\le 0)
%\\& + \calRR(\FF) - \calR(\FF)  && \quad \quad \text{(concentration)}
%\\& + \calR(\FF).  &&\quad  \quad \text{(population risk)}
%\end{align}


The \emph{Laplace-Beltrami operator} is the linear operator $\Delta_g: C^\infty(\calM) \to  C^\infty(\calM)$ satisfying the property
  \begin{align} %\nonumber
\int_{\calM} f_1(x) &\Delta_g f_2(x) d\text{vol}_g(x) = - \int_{\calM}  \langle \nabla_g f_1(x) , \nabla_g  f_2(x) \rangle_g d \text{vol}_g(x),
\end{align}
 for any $f_1,f_2 \in C^\infty(\calM)$, and it can be naturally extended to a unique continuous operator between Sobolev spaces. 
 This generalizes the usual definition of the Laplacian operator  $\Delta = \partial_1^2+ \cdots+\partial^2_d$, defined on the Euclidean space $\R^d$, which satisfies this property by integration by parts. 
 %The kernel of the operator $\Delta_g$ includes the harmonic functions. In the case of compact boundariless manifolds, the only harmonic functions are constants.  
 
The operator $(-\Delta_g)$ is elliptic,  self-adjoint,  and can be diagonalized in $L^2(\calM)$ \cite{chavel1984eigenvalues}. In particular, there exists an orthonormal basis $\{\phi_\ell(x) \}_{\ell=0}^{\infty}$ of $L^2(\calM)$ starting from the constant function $\phi_0 \equiv 1$ such that $\Delta_g  \phi_\ell + \lambda_\ell \phi_\ell = 0$, for the discrete spectrum $0=\lambda_0 < \lambda_1 \le \lambda_2\le \ldots$.   Note that eigenvalues appear in this sequence with their multiplicities.
Let us call $\{\phi_\ell(x) \}_{\ell=0}^{\infty}$ the Laplace-Beltrami basis for $L^2(\calM)$. 

\subsection{Kernels in the Laplace-Beltrami Basis}

By Mercer's theorem, a positive-definite symmetric (PDS) kernel $K:\calM \times \calM \to \R$ can be diagonalized in an appropriate orthonormal basis of functions in $L^2(\calM)$. Indeed, with a number of appropriate assumptions (see Proposition \ref{prop_kernel}), it can be diagonalized in the Laplace-Beltrami basis; there exist appropriate $\mu_{\ell} \ge 0 $, $\ell=0,1,\ldots$, such that
\begin{align}
K(x,y) = \sum_{\ell=0}^{\infty} \mu_{\ell} \phi_\ell(x) \phi_\ell(y),
\end{align}
where $\phi_\ell, \ell=0,1,\ldots$, form a basis for $L^2(\calM)$ such that $\Delta_g \phi_\ell + \lambda_\ell \phi_\ell = 0$ for each $\ell$. 
For a $G$-invariant kernel $K$, a more compact %($G-$dependent) 
representation is possible (Appendix \ref{prelim_kernel_inv}). 



Fortunately, many kernels in practice satisfy this condition, e.g., any dot-product kernel on a sphere. In particular, the Sobolev space $\calH^s(\calM)\subseteq L^2(\calM)$ is diagonalizable in the Laplace-Beltrami basis with $\mu_\ell = \min(1,\lambda_{\ell}^{-s})$ for all $\ell$. 
While we present the results of this paper for Sobolev kernels, one can use any kernel satisfying the condition in  Proposition \ref{prop_kernel} and apply the same techniques to obtain its convergence rates. 





%\begin{proposition}\label{prop_kernel}
%Consider a   positive-definite symmetric (PDS)  kernel $K: \calM \times \calM \to \R$, such that the differential equation $\Delta_{g,x} (K(x,y)) = \Delta_{g,y}(K(x,y))$.  Then, $K$ can be diagonalized in the basis of the eigenfunctions of the Laplace-Beltrami operator; there exist appropriate $\mu_{\ell} \ge 0 $, $\ell=0,1,\ldots$, such that
%\begin{align}
%K(x,y) = \sum_{\ell=0}^{\infty} \mu_{\ell} %\phi_\ell(x) \phi_\ell(y),
%\end{align}
%where $\phi_\ell, \ell=0,1,\ldots$, form a basis for $L^2(\calM)$ such that $\Delta_g \phi_\ell + \lambda_\ell \phi_\ell = 0$ for each $\ell$.
%\end{proposition}



Note that if $K$ is diagonalizable in the Laplace-Beltrami basis and  if $f^\star = \sum_{\ell=0}^\infty \langle f^\star, \phi_\ell \rangle_{L^2(\calM)} \phi_\ell$,  then the effective estimator is given by  the closed-form formula 
\begin{align}
\FF = \sum_{\ell=0}^\infty \frac{\mu_{\ell}}{\mu_{\ell} + \eta}\langle f^\star, \phi_\ell \rangle_{L^2(\calM)} \phi_\ell.
\end{align}






  \subsection{Weyl's Law}\label{sec:weyl}

An important quantity in our context is the number of eigenvalues of the Laplace-Beltrami operator up to $\lambda$, denoted by $N(\lambda) := \#\{ \ell : \lambda_\ell \le \lambda\}$. The celebrated Weyl's law determines the asymptotic distribution of eigenvalues:
\begin{align} %\nonumber
N(\lambda) \approx  
 \frac{\omega_{\dim(\calM)}}{(2\pi)^{\dim(\calM)}} \vol(\calM) \lambda^{{\dim(\calM)}/2},
\end{align}
 where $\omega_d$ is the volume of the unit $d-$ball in the Euclidean space $\R^{d}$. 

 One important property of the Laplace-Beltrami operator is that it commutes with all isometries $\tau \in \ISO(\calM,g)$: 
\begin{align} %\nonumber
 \Delta_g  \phi_\ell + \lambda_\ell \phi_\ell = 0 \iff  \Delta_g  (\phi_\ell \circ \tau) + \lambda_\ell (\phi_\ell \circ \tau) = 0.
\end{align}
Therefore, $G$ acts on eigenspaces of the Laplace-Beltrami operator, and one can define the quantity  $N(\lambda; G)$ to be the dimension of the space of $G$-invariant eigenfunctions of the Laplace-Beltrami operator with eigenvalues up to $\lambda$. See Appendix \ref{iso_eig} for more details. 



\subsection{Quotient Spaces}

The quotient space $\calM/G$ is defined as the set of all orbits $[x] := \{ \tau(x): \tau \in G\}$, $x\in \calM$, and is equipped with the quotient topology. However, $\calM/G$ is not always a closed manifold (Appendix \ref{prelim_quotient}). Thus, it is not immediately possible to define its dimension/volume. In Appendix \ref{prelim_quotient} and Appendix \ref{app_pot}, we review the theory of the quotients of manifolds, and we observe that there exists an open dense subset $\calM_0 \subseteq \calM$ such that $\calM_0/G$ is  open and dense in $\calM/G$, and more importantly, it is a connected precompact manifold. 
The quotient space is indeed a finite disjoint union of some manifolds, each of its specific dimension/volume. $\calM_0/G$ is called the \textit{principal} part of the quotient space, as it is dense, open, and connected (in $\calM/G$). It also has the largest dimension among all those manifolds (Appendix \ref{prelim_quotient} and Appendix \ref{app_pot}). 
 The projection map $\pi: \calM_0 \to \calM_0/G$ induces a metric on $\calM_0/G$ and this allows us to define $\vol(\calM/G):=\vol(\calM_0/G)$.  Note that $\vol(\calM/G)$ depends on the Riemannian metric, which itself might depend on the group $G$ if we start from a base metric and then deform it to make the action isometric. Also, $\vol(\calM_0/G)$ is computed with respect to the dimension of $\calM_0/G$, thus being nonzero even if $\dim(\calM_0/G)< \dim(\calM)$.
 
The effective dimension of the quotient space is also defined as $d:= \dim(\calM_0/G)$. Alternatively, one can define the effective dimension as
\begin{align}
    d:= \dim(\calM)- \dim(G)+ \min_{x \in \calM} \dim(G_x),
\end{align}
where $G_x := \{ \tau \in G: \tau(x) = x\}$ is called the isotropic group of the action at point $x \in \calM$. For example, if there exists a point $x \in \calM$ with the trivial isotropy group $G_x = \{\text{id}_G\}$, then $d= \dim(\calM)- \dim(G)$. 
%
We explain more about the quotient spaces of manifolds in Appendix \ref{prelim_quotient} and Appendix \ref{app_pot}.  




  
 \section{Main Results}

 

Our first theorem provides an upper bound on the excess population risk, or the generalization error, of KRR with invariances.
%
 \begin{theorem}[Convergence rate of KRR with invariances]\label{thrm_sobolev}
 Consider the  KRR problem with invariances defined in Section \ref{ps}. Assume that $f^\star  \in {\calH^{s\theta}_{\inv}(\calM)}$ for some $\theta \in (0,1]$, and let $s = \frac{d}{2}(\kappa+1)$ for a positive $\kappa$.  
 Then,  
  \begin{align} %\nonumber
  \E \Big[ \calR(\hat{f}) & -  \calR(f^\star) \Big] 
  \le  ~ 32 \Big (\frac{1}{\kappa \theta}  \frac{\omega_d}{(2\pi)^d}  \frac{\sigma^2 \vol(\calM / G)}{n} \Big  
)^{\theta s/(\theta s +d/2)}  \| f^\star \|^{d/(\theta s + d/2)}_{\calH^{s\theta}_{\inv}(\calM)},
 \end{align}
 with the optimal regularization parameter
  \begin{align} %\nonumber
 \eta = \Big (\frac{1}{2\kappa \theta  \| f^\star \|^2_{\calH^{s \theta}_{\inv}(\calM)}}  \frac{\omega_d}{(2\pi)^d}  \frac{\sigma^2 \vol(\calM / G)}{n} \Big  
)^{\theta s/(\theta s +d/2)}.
 \end{align}
 \end{theorem}












 Note that ${\calH^{s}_{\inv}(\calM)} \subseteq {\calH^{s\theta}_{\inv}(\calM)} \subseteq L^2_{\inv}(\calM)$ is interpolating between the two Hilbert spaces. 
 In cases where the regression function $f^\star$ does not belong to the Sobolev space  ${\calH^{s}_{\inv}(\calM)}$ (i.e., $\theta \in (0,1)$), the achieved exponent 
 only depends on $\theta s$ (i.e., the smoothness of the regression function $f^\star$ and not the smoothness of the kernel). 
 %behaves similarly to KRR with the  Sobolev space ${\calH^{s\theta}_{\inv}(\calM)}$.

 The bound is monotonically decreasing as $s$ increases, as expected: smoother functions are easier to learn. Setting $G = \{\text{id}_G\}$ (i.e., the trivial group) allows one to compare the sample complexities with and without invariances. The gain of the group invariances is two-fold:
 %can be summarized as follows:
 \begin{itemize}
\item \textbf{Exponent}: the exponent is improved as $d$ can be much smaller than $\dim(\calM)$. 
\item \textbf{Effective number of samples}: the number of samples is effectively multiplied by 
\begin{align} \label{eq:effective_samples}
\frac{\omega_{\dim(\calM)}/(2\pi)^{\dim(\calM)} }{\omega_{d}/(2\pi)^{d}} 
.\frac{\vol(\calM)}{\vol(\calM / G)}.
\end{align}
 \end{itemize}
 The quantity (\ref{eq:effective_samples}) reduces to $|G|$ if $G$ is a finite group that efficiently acts on $\calM$, i.e., if any group element acts   non-trivially on the manifold. For groups of positive dimension, it measures how the group is contracting the volume of the manifold. Note that for finite groups, one always has $\frac{\vol(\calM)}{\vol(\calM/G)} \ge 1$. 
 




 The next theorem states our minimax optimality result. For simplicity, we assume $\theta =1$. 
 
 \begin{theorem}[Minimax optimality]\label{thrm_converse}
 For any estimator $\hat{f}$, 
\begin{align} %\nonumber
%\inf_{\hat{f}} 
\sup_{
\substack{f^\star \in \calH^{s}_{\inv}(\calM) \\
\|f^\star\|_{\calH^{s}_{\inv}(\calM)}=1}}  \E \Big [ \calR(\hat{f})  -  \calR(f^\star) \Big]  \ge
       C_{\kappa}\Big (  \frac{\omega_d}{(2\pi)^d} \frac{\sigma^2 \vol(\calM / G)}{n}\Big)^{s/(s+d/2)},
  \end{align}
  where $C_\kappa$ is a constant only depending on $\kappa$.
 \end{theorem}
 
An explicit formula for $C_\kappa$ is given in the appendix.   Note that the above minimax lower bound not only proves that the achieved bound by the KRR estimator is optimal but also shows the optimality of the prefactor characterized in Theorem~\ref{thrm_sobolev} with respect to the effective dimension $d$ (up to multiplicative constants depending on $\kappa$). 
   
   
%  \begin{theorem}[Convergence rate of KRR with finite-dimensional invariance -- Random Gaussian Features]\label{thrm_rgf}
%
% \end{theorem}
 

 \subsection{Dimension Counting Bounds}

 
% This section presents a method to measure the "complexity" of function spaces on manifolds and their quotients. It gives a compact way to achieve "universal" results holding for almost general cases with an efficient error term. Let us begin with some definitions to clarify how to measure a function space's complexity. 
 

 
 %Let us denote the set of distinct eigenvalues of a manifold by $\Spec(\calM):= \{ \lambda_0,\lambda_1,\ldots\} \subset \R_{\ge0}$, and 
 Recall that $N(\lambda; G)$ denotes the dimension of the $G-$invariant subspace of the space of eigenfunctions of the Laplace-Beltrami operator with eigenvalues up to $\lambda$. 
 Characterizing the asymptotic behavior of $N(\lambda; G)$ is essential for proving our main results on the gain of invariances. Intuitively, the quantity $N(\lambda; G)/N(\lambda)$ corresponds to the fraction of  functions that are $G-$invariant. One of this paper's main contributions is to determine the exact asymptotic behavior of this quantity for the analysis of KRR. The tight bound on $N(\lambda; G)$ can be of potential independent interest to other problems related to learning with invariances. %, which we leave those applications to future studies.


 
 \begin{theorem}[Dimension counting theorem]\label{thrm_dim}
Let $(\calM,g)$ be a smooth connected closed (i.e., compact boundaryless) Riemannian manifold of dimension $\dim(\calM)$ and let $G$ be a compact Lie group of dimension $\dim(G)$ acting isometrically on $(\calM,g)$.   Recall the definition of the effective dimension of the quotient space  $d:= \dim(\calM)- \dim(G)+ \min_{x \in \calM} \dim(G_x)$. 
Then, 
\begin{align} %\nonumber
N(\lambda;G)&=  
 \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \lambda^{d/2} + \calO(\lambda^{\frac{d-1}{2}}),
\end{align}
as $\lambda \to \infty$, where $\omega_d = \frac{\pi^{d/2}}{\Gamma(\frac{d}{2}+1)}$ is the volume of the unit $d-$ball in the Euclidean space $\R^d$.  
 \end{theorem}
 
In Appendix \ref{app:dim_proof}, we prove a generalized version of the above bound (i.e., a  \textit{local} version). Moreover, we show that the projections of invariant functions onto the quotient space satisfy the Neumann boundary condition on the (potential) boundaries of the quotient space, thus exactly characterizing the space of invariant functions. Note that, in general, different boundary conditions can lead to completely different function spaces for manifolds with boundaries. See Section \ref{prs} for a proof sketch. 

 

\subsection{Application to the Space of Low-Energy Functions}
 

 Applications of Theorem \ref{thrm_dim} are not just limited to Sobolev spaces. In this section, we study KRR with finite-dimensional PDS kernels $K:\calM \times \calM \to \R$ with an RKHS $\calH \subseteq L^2(\calM)$ (the inclusion must be understood as Hilbert spaces, i.e., the inner product on $\calH$ is just the usual inner product defined on $L^2(\calM)$, making it completely different from Sobolev spaces). Examples of these finite-dimensional spaces are random feature models and two-layer neural networks in the lazy training regime. 
The goal of this section is to relate the generalization error of KRR to the average amount of fluctuations of functions in the space.  To formalize this notion of complexity, we need to review some definitions.




The Dirichlet form $\calE$ is a bilinear form defined as  
\begin{align}
\calE(f_1,f_2):= \int_\calM \langle \nabla_g f_1(x), \nabla_g f_2(x) \rangle_g d\text{vol}_g(x),
\end{align} 
for any two smooth functions $f_1, f_2:\calM \to \R$. It can be easily extended (continuously) to any Sobolev space $\calH^s(\calM)$, $s\ge 1$. For each $f\in \calH^s(\calM)$, the diagonal quantity $\calE(f,f)$ is called the Dirichlet energy of the function. 
Dirichlet energy is a way to measure the complexity of a function. Functions with low Dirichlet energy have little fluctuation; intuitively, those have low (normalized) Lipschitz constants on average. Indeed, since $\calE(af,af) = |a|^2 \calE(f,f)$, it is more accurate to restrict to the case $\|f\|_{L^2(\calM)}=1$ while studying low-energy functions.  


Let us introduce a finite-dimensional $G$-invariant kernel $K$ generating the space of $G-$invariant low-energy functions as follows:
\begin{align}
K (x,y) = \sum_{\ell=0}^{D-1} \phi_\ell(x)\phi_\ell(y),
\end{align}
for any $x,y \in \calM$  (the non-zero $G-$invariant eigenfunctions $\phi_\ell$ are   sorted with respect to their eignevalues; see Appendix \ref{prelim_kernel_inv}).
 Clearly, $K$ is a kernel of dimension $D$, and it is diagonal in the basis of the Laplace-Beltrami operator eigenfunctions. The RKHS of $K$ is also of finite dimension $D$ and can be written as
\begin{align} %\nonumber
\calH_G: = \Big \{
f \in L^2(\calM) :  f &= \sum_{\ell=0}^{D-1} \langle 
f, \phi_\ell
\rangle_{L^2(\calM)}
\phi_\ell 
\Big \} 
\subseteq L^2_{\inv}(\calM,G),
\end{align}
thus $D = \dim(\calH_G)$. 
One can also use $\calE(f,f)$ to define a complexity notion for vector spaces of functions. Indeed, for any $D-$dimensional vector space $\calH \subseteq L^2_{\inv}(\calM,G)$, define
\begin{align}
\calL(\calH):= \max_{f \in \calH} \Big \{ \calE(f,f): \|f\|_{L^2(\calM)}\le 1 \Big\}.
\end{align} 
For a vector space $\calH$, larger $\calL(\calH)$ corresponds to having functions with more (normalized) fluctuation. Thus, $\calL(V)$ is a notion of complexity for the vector space $V$. The following proposition shows how $\calH_G$ is the \textit{simplest}  subspace of $L^2(\calM)$ with dimension $D$.  

\begin{proposition}\label{prop_finite_energy} For any $D-$dimensional vector space $\calH \subseteq L^2_{\inv}(\calM,G)$, 
\begin{align} 
\calL(\calH) \ge \lambda_{D-1},
\end{align}
and the equality is only achieved when $\calH = \calH_G$ with $D = \dim(\calH_G)$.  The eigenfunctions are sorted according to   Appendix \ref{prelim_kernel_inv}.
\end{proposition}


Using the dimension counting bound in Theorem \ref{thrm_dim}, we can explicitly determine the asymptotic relation between the dimension of $\calH_G$ and its complexity $\calL(\calH_G)$. 
 
 \begin{theorem}[Dimension of the space of low-energy functions]\label{thrm_finite}
Under the assumptions in Theorem \ref{thrm_dim}, one has the following relation between the dimension of the vector space $\calH_G$ and the complexity of it $\calL(\calH_G)$:
\begin{align} %\nonumber
\dim(\calH_G)&=  
 \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \calL(\calH_G)^{d/2} + \calO(\calL(\calH_G)^{\frac{d-1}{2}}),
\end{align}
 where $\omega_d = \frac{\pi^{d/2}}{\Gamma(\frac{d}{2}+1)}$ is the volume of the unit $d-$ball in the Euclidean space $\R^d$.  
 \end{theorem}
 
 
Given the above result, in conjunction with Proposition~\ref{prop_finite_energy}, one can relate the complexity of any finite-dimensional RKHS space $\calH \subseteq L^2(\calM)$ to the convergence rate of the KRR generalization error.  
   
   \begin{corollary}[Convergence rate of KRR with  invariances -- finite dimensional kernels]\label{cor_finite}  For KRR with an arbitrary finite-dimensional $G-$invariant RKHS $\calH \subseteq L^2(\calM)$, 
 \begin{align} %\nonumber
  \E \Big[ \calR(\hat{f})  -  \calR(f^\star) \Big] 
  \lesssim & 
  \Big( \frac{\omega_d}{(2\pi)^d} \frac{\sigma^2 \vol(\calM / G)}{n} \Big) \calL(\calH)^{d/2} \|f^\star\|_{L^2(\calM)},
\end{align}
where $\lesssim$ hides absolute constants. Moreover, the upper bound is minimax optimal if $\calH = \calH_G$ (similar to Theorem \ref{thrm_converse}).
 \end{corollary}


 The significance of this upper bound is that it is not explicitly written in terms of the dimension of the space $\calH$. In contrast, it allows relating the generalization error to the average fluctuations, i.e., the normalized energy, of the functions in $\calH$, which is completely new to the best of our knowledge. The same gain of invariances in terms of sample complexity is observed here as in Theorem \ref{thrm_sobolev}. 
 Note that in the asymptotic analysis for the above corollary, we assume that $\calL(\calH)$ is large enough, allowing us to use Theorem \ref{thrm_finite}. 
 

   
   \section{Examples and Applications}\label{examples}



Next, we discuss several instances of learning with invariances on manifolds, and make our general results concrete for a number of popular learning settings with invariances. This yields results for kernel versions of popular corresponding architectures. 

\subsection{Sets}

When learning with sets, each data instance is a subset $\{x_1,x_2\ldots, x_m\}$ of elements $x_i \in \calX$, $i \in [m]$, from a given space $\calX$. A set is invariant under permutations of its elements, i.e.,
\begin{align}
\{x_1,x_2\ldots, x_m\} = \{x_{\sigma_1},x_{\sigma_2} \ldots, x_{\sigma_m}\},\label{set_inv}
\end{align}
where $\sigma:[m]\to [m]$ can be any permutation. A successful architecture for learning on sets are DeepSets \cite{zaheer2017deep}, which are permutation invariant. Similarly, PointNets are a permutation invariant architecture for point clouds \cite{qi2017pointnet, qi2017pointnetplus}.
  %
To analyze learning with sets and kernel versions of these architectures using our formulation, we assume sets of fixed cardinality  $m$.  If the space $\calX$ has a manifold structure, then one can identify each data instance as a point on the product manifold 
\begin{align}
\calM = \calX^m = \underbrace{\calX \times \calX \cdots \times \calX}_{m}.
\end{align}
The task is invariant to the action of the symmetric group $S_m$ on $\calM$; each $\sigma \in S_m$ acts on $\calM$ by permuting the coordinates (see Equation (\ref{set_inv})). This action is indeed isometric,  $\dim(S_m) = 0$, and $|S_m| = 1/m!$.  Theorem~\ref{thrm_sobolev} hence implies that the sample complexity gain from permutation invariance is having effectively $n \times m!$ samples, where $n$ is the number of observed sets. In fact, this result holds (for KRR) for \textit{any} space $\calX$ with a manifold structure. 



\subsection{Images}
Learning models on images needs to respect shift invariance. E.g., 
Convolutional Neural Networks  (CNNs) \cite{lecun89cnn,krizhevsky2017imagenet} compute shift-invariant image representations. Each image is a 2D array $(x_{i,j})_{i,j =0}^{m-1}$ such that $x_{i,j} \in \calX$ for a space $\calX$ (e.g., for RGB, $\calX \subseteq \R^3$ is a compact subset). If $\calX$ has a manifold structure, then one can identify each image with a point on the manifold
\begin{align}
    \calM = \bigotimes_{i,j=0}^{m-1} \calX^{i,j},
\end{align}
where $\calX^{i,j}$ is a copy of $\calX$. The learning task is invariant under the action of the finite group $(\mathbb{Z}/m\mathbb{Z})\times (\mathbb{Z}/m\mathbb{Z})$ on $\calM$ by shifting pixels: each   $(p,q) \in (\mathbb{Z}/m\mathbb{Z})\times (\mathbb{Z}/m\mathbb{Z})$  corresponds to the isometry $(x_{i,j})_{i,j =1}^m \mapsto (x_{i+p,j+q})_{i,j =1}^m$ (the sum is understood modulo  $m$). As a result, the sample complexity gain corresponds to having effectively $n\times m^2$ samples, where $n$ is the number of images. 

%an image is just a product of tori,     Convolutional Neural Networks (CNNs)  (for images),


  

\subsection{Point Clouds}
3D point clouds have rotation, translation, and permutation symmetries. Tensor field neural networks  \cite{thomas2018tensor} respect these invariances. 
%can effectively compute representations for 3D point clouds with rotation, translation, and permutation symmetries. 
We view each 3D point cloud as a set $\{x_1,x_2\ldots, x_m\}$ such that $x_i \in \R^3/\mathbb{Z}^3 \equiv [0,1]^3$, which is essentially a point on the manifold $\calM = (\R^3/\mathbb{Z}^3 )^m$ with $\dim(\calM) = 3m$. The learning task is invariant with respect to permuting the coordinates of $\calM$, translating all points $x_i \mapsto x_i + r$ for some $r \in \R^3$, and jointly rotating all points, $x_i \mapsto x_iQ$ for an orthogonal matrix $Q$. We denote the group defined by those three operations as $G$ and observe that $\dim(G) = 6$. Thus, the gains of invariances in sample complexity are (1) reducing the dimension $d$ of the space from $3m$ to $3m - 6$, and (2) having effectively $n \times m!$ samples, where $n$ is the number of point clouds.








\subsection{Sign Flips of Eigenvectors}
SignNet \cite{lim2022sign} is a recent architecture for learning functions of eigenvectors in a spectral decomposition.  Each data instance is a sequence of eigenvectors $(v_1,v_2,\ldots, v_m)$, $v_i \in \R^d$, and flipping the sign of an eigenvector $v_i \to -v_i$ does not change its eigenspace. The spectral data can be considered as a point on the manifold $\calM = (\mathbb{S}^{d-1})^m$ (where $\mathbb{S}^{d-1}$ is the $(d-1)$-dimensional sphere),  while the task is invariant to all $2^m$ possibilities of sign flips.
The sample complexity gain of invariances is thus having effectively $n \times 2^m$ samples, where $n$ is the number of spectral data points.


\subsection{Changes of Basis for Eigenvectors}
BasisNet \cite{lim2022sign} represents spectral data with eigenvalue multiplicities. Each input instance is a
sequence of eigenspaces $(V_1,V_2,\ldots, V_p)$, and each $V_i$ is represented by an orthonormal basis such as $(v_{i,1},v_{i,2},\ldots, v_{i,m_i})\in (\R^d)^{m_i}$. This is the \emph{Stiefel manifold} with dimension $dm_i -\frac{m_i(m_i+1)}{2}$. Thus, the spectral data lie on a manifold of dimension 
\begin{align}
    \dim(\calM) =\sum_{i=1}^p \Big (dm_i -\frac{m_i(m_i+1)}{2} \Big). 
\end{align}
The vector spaces' representations are invariant to a change of basis, i.e., the group action defined as $(v_{i,1},v_{i,2},\ldots, v_{i,m_i}) \mapsto (v_{i,1}Q,v_{i,2}Q,\ldots, v_{i,m_i}Q)$ for any orthogonal matrix $Q$ that fixes the eigenspace $V_i$. 
If $G$ denotes this group of invariances, then
 \begin{align}
    \dim(G) = \sum_{i=1}^p \Big (\frac{m_i(m_i-1)}{2} \Big).
\end{align}
Thus, the gain of invariances is observed as a reduction of the manifold's dimension to $\sum_{i=1}^p (dm_i - m_i^2)$. For example, if $m_i=m$ for all $i$, then with $d=pm$ we get $\dim(\calM) = d^2 - \frac{1}{2} d(m+1)$ while after the reduction we have $\dim(\calM/G) = d^2-dm$. Note that in this example, the quotient space is called the \textit{Grassmannian manifold}.  



\subsection{Learning on Graphs}
Each (weighted/directed) graph on $m$ vertices can be naturally encoded by its adjacency matrix $A\in \R^{m\times m}$. Learning tasks on graphs are invariant to permutations of rows and columns, i.e., the action of the symmetric group as $  A \mapsto P^{-1}AP$ for any permutation matrix $P$. For instance, Graph Neural Networks (GNNs) and graph kernels \cite{vishwanathan2010graph} implement this invariance.
The sample complexity gain from invariances is thus evident; it corresponds to having effectively  $n\times m!$ samples, where $n$ is the number of sampled graphs.


 

  
  % \subsection{Scaler} orthogonal group, Scaler \cite{villar2021scalars} for invariance with respect to the orthogonal group,


%\subsection{Sphere}  Sphere: infinite isometry groups on the sphere

 

\subsection{Hyperbolic Spaces, Tori, etc.}

One important feature of the results in this paper is that they are not restricted to Euclidean spaces. In particular, the results are also valid for hyperbolic spaces; see \cite{peng2021hyperbolic} for a survey on applications of hyperbolic spaces in machine learning. 

Another type of space where our results are still valid are tori, i.e., $\mathbb{T}^d:= (\mathbb{S}^1)^d$. Tori naturally occur for modeling joints in robot control \cite{liu2022robot}. In fact, Riemannian manifolds are beneficial in a broader context for learning in robotics, e.g., arising from constraints, as surveyed in 
%It is also worth mentioning the applicability of our results on robot's constrained manifolds  
\cite{calinon2020gaussians}. Our results apply to invariant learning in all of these settings, too.


 
 

  %\section{Experiments}
   
   
 
\section{Proof Sketch}\label{prs}


This section provides an overview of our proof ideas and challenges. 
%First, note that the upper bound of KRR (Theorem \ref{thrm_sobolev}) and the minimax lower bound (Theorem \ref{thrm_converse}) can be obtained using standard tools and approaches, if one assumes the dimension counting result (Theorem \ref{thrm_dim}). It states a smaller actual dimension, which can be plugged into a standard analysis. 
We focus on Theorem \ref{thrm_dim}, which is at the core of all the other proofs in this paper.


We define the dimension $N(\lambda;G)$ as the dimension of projecting the eigenspaces of the Laplace-Beltrami operator on $\calM$ onto the space of $G-$invariant functions, and using all eigenvalues up to $\lambda$. Why? Intuitively, a smooth $G-$invariant function $f:\calM \to \R$ corresponds to a smooth function $\tilde{f}: \calM/G \to \R$ on the quotient space $\calM/G$, where $\tilde{f}([x]) = f(x)$ for all $x \in \calM$. Using this correspondence, we can argue that $N(\lambda;G)$ is simultaneously the number of eigenvalues of the Laplace-Beltrami operator on $\calM/G$ up to $\lambda$, as $G$ acts on each eigenspace. 

Weyl's law (Section~\ref{sec:weyl}) determines  the asymptotic distribution of eigenvalues for a Riemannian manifold $(\calM,g)$. The bound in Theorem \ref{thrm_dim} is indeed the same as Weyl's law, if we write it in terms of the quotient space $\calM/G$.
%
 % 
%Weyl's law (Section~\ref{sec:weyl}) determines  the asymptotic distribution of eigenvalues for a Riemannian manifold $(\calM,g)$. The bound in Theorem \ref{thrm_dim} is indeed the same as Weyl's law, if we write it in terms of the quotient space $\calM/G$. One can thus can intuitively reason as follows. A smooth $G-$invariant function $f:\calM \to \R$ corresponds to a smooth function $\tilde{f}: \calM/G \to \R$, where $\tilde{f}([x]) = f(x)$ for all $x \in \calM$.  
%The group  $G$ acts isometrically  on the eigenspaces of the Laplace-Beltrami operator on $\calM$, and the quanity $N(\lambda;G)$ corresponds to the dimension of the  eigenspace  projection  onto the space of $G-$invariant functions.  However, by the correspondence between the $G-$invariant functions on $\calM$ and smooth functions on $\calM/G$, we can argue that $N(\lambda;G)$ is simultaneously the number of eigenvalues of the Laplace-Beltrami operaotor on $\calM/G$ up to $\lambda$ (note $G$ acts on each eigenspace). Therefore, by an application of Weyl's law on $\calM/G$, we conclude the desired result. 
%
%
But, this intuition is not rigorous, and in general, we cannot directly apply Weyl's law. For instance, the quotient space $\calM/G$ is not always a manifold (see Appendix \ref{prelim_quotient}). Even if we restrict our attention to the principal part $\calM_0/G$, which is provably a manifold, other complications arise (see Appendix \ref{app_pot} for more on the principal part; it is an open dense connected subset of $\calM/G$). 



Up to this point, we have just considered closed manifolds $\calM$, which are boundaryless. However, the quotient $\calM_0/G$ can exhibit a boundary, even if the original space is boundaryless. For a concrete example, consider the circle $\mathbb{S}^1 = \{(x,y): x^2+y^2 = 1\}$, parameterized by the angle $\theta \in [0,2\pi)$, under the isometric action $G = \{\text{id}_G, \tau \}$,  where $\tau(\theta) = \pi - \theta$ is the reflection across the $y-$axis. The resulting space is a semicircle with two boundary points $(0,\pm1)$. 

To see why boundary points can make the problem challenging, note that  Weyl's law for compact manifolds with boundary is true only if we impose an appropriate boundary condition (such as the Neumann/Dirichlet boundary conditions) for finding the eigenfunctions. Different boundary conditions will lead to completely different function spaces. Thus, it is unclear which one is the accurate choice for studying the projection of invariant functions onto the quotient space. (see below for an example). 
Our results show that smooth $G$-invariant functions on $\calM$ satisfy the Neumann boundary condition on the (potential) boundaries of the principal quotient space, making it possible to complete the proof. More precisely, we exactly characterize the function space corresponding to the projection of invariant functions onto the quotient space, which can indeed be of independent interest. 


To see how the Neumann boundary condition appears, consider the circle again and note that its eigenfunctions are the constant function $\phi_0\equiv 1$,  $\sin(k \theta)$, and $\cos(k \theta)$, with eigenvalues $\lambda = k^2$, $k \in \mathbb{N}$. Note that each eigenvalue has a multiplicity of two, except the zero eigenvalue with one multiplicity. For the quotient space $\mathbb{S}^1/G$, however, the eigenfunctions are just the constant function, 
$\sin((2k+1) \theta)$, and $\cos(2k \theta)$,  $k \in \mathbb{Z}$ (note how roughly half of the eigenfunctions survived, as $|G|=2$). In particular, the boundary points $(0,\pm 1)$ satisfy the Neumann boundary condition, while the Dirichlet boundary condition fails to hold; look at the eigenfunctions at $\theta = \pi/2$.  We generalize this idea in our proof to any manifold and group using differential geometric tools (see Appendix  \ref{prelim_quotient} and Appendix \ref{app_pot}). Also, note that if we consider the Dirichlet boundary condition, then we get a function space that includes only functions vanishing at the boundary points: $\phi(\pi/2) = \phi(3\pi/2)=0$. This clearly does not correspond to the space of invariant functions. 
 

In the above example, the boundary points come from the fact that the group action has non-trivial fixed points, i.e., $(0,\pm1)$ are fixed points. If the action is free, meaning that we have only trivial fixed points, then the quotient space $\calM/G$ is indeed a closed manifold; i.e., it is boundaryless. Thus, challenges towards the proof arise from the existence of non-trivial fixed points. 



 \textbf{Comparison to prior work.}  Lastly, we discuss an example on the two-dimensional flat torus $\mathbb{T}^2 = \R^2/2 \pi\mathbb{Z}^2$, which shows that the proof ideas in \cite{bietti2021sample}  are indeed not applicable for general manifolds even with finite group actions. For this boundaryless manifold, consider the isometric action $G = \{\text{id}_G, \tau\}$, where $\tau(\theta_1,\theta_2) = (\theta_1+\pi,\theta_2)$, and note that the quotient space $\mathbb{T}^2/G$ is again a torus. 
In this case, the eigenfuntions of $\mathbb{T}^2$ are the  functions  $\exp(ik_1x+ik_2y)$, for all $k_1,k_2 \in \mathbb{Z}$, with eigenvalue $\lambda = k_1^2+k_2^2$. But eigenfunctions of the quotient space are those with even $k_1$. This means that some eigenspaces of $\mathbb{T}^2$ (such as those with eigenvalue $\lambda = 2(2n+1)^2$) are completely lost after projection onto the space of invariant functions. This means that the method used in \cite{bietti2021sample} fails to give a non-trivial bound here. Note that in this example, the quotient space is boundaryless.  
 
  % Tori: this is a toy example but simply shows how the bounds are computable and gives some hints about the proof
 
%  \section{Discussion and Open Problems}
  
% In this paper, w Dependence on the group limits, uniform bounds on group size \& bounds for. 
  



\bibliography{mnfld_rgrs}
\bibliographystyle{ieeetr}
%\bibliographystyle{icml2023}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% APPENDIX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%\newpage
\appendix
%\onecolumn




\appendix

\section{Preliminaries}\label{preli}

\subsection{Manifolds}\label{preli_mnfld}

A completely metrizable second countable topological space $\calM$ that is locally homeomorphic to the Euclidean space $\R^{\dim(\calM)}$ is called a manifold of dimension $\dim(\calM)$. Sphere, torus, and $\R^d$ are some examples of manifolds. A Riemannian manifold $(\calM, g)$ is a manifold that is equipped with a smooth inner product $g$ on the tangent space $T_x\calM$ around each point $x\in \calM$. A Riemannian metric tensor $g$ allows the use of the following two important tools in the study of manifolds: (i) the geodesic distance $d_{\calM}(x,y)$ between any points $x,y\in \calM$, and (ii) the volume element $d\vol_g(x)$, that defines a Borel measure on the manifold (on the Borel sigma-algebra of open subsets of the manifold). The distance function and the volume element depend on the Riemannian metric tensor $g$ and make the manifold a metric-measure space. The functional spaces on manifolds, such as $L^p(\calM)$, $p\in [1,\infty]$, and the Sobolev spaces $\calH^s(\calM)$, $s \ge 0$, are defined similar to the Euclidean spaces.   

\subsection{Isometries}\label{preli_iso}

A  bijection $\tau : \calM \to \calM$ is called an isometry of $(\calM,g)$, if and only if $d_{\calM}(\tau(x),\tau(y)) = d_{\calM}(x,y)$ for all $x,y \in \calM$. 
The space of isometries of $(\calM,g)$ forms a group under composition, denoted by $\ISO(\calM,g)$ or simply by $\ISO(\calM)$. By the Myersâ€“Steenrod theorem, for connected manifolds, each $\tau \in \ISO(M,g)$ is not only bijective but indeed smooth (i.e., infinitely many times differentiable) \cite{petersen2006riemannian}. Moreover,  $\ISO(\calM,g)$ is a Lie group (i.e., a smooth manifold which is simultaneously a group) of dimension at most $\frac{\dim(\calM)(\dim(\calM)+1)}{2}$. Another characterization of isometries on manifolds is based on metric tensors, where a function  $\tau: \calM \to \calM$ is an isometry if and only if the pullback of the metric tensor $g$ by $\tau$ is itself, i.e., $g = \tau^*g$. This means that $\tau$ locally preserved inner products of tangent vectors. 
For the applications in this paper, whenever it is not mentioned, a $\dim(\calM)-$dimensional Riemannian manifolds $(\calM, g)$ is smooth, connected, and closed  (i.e., compact boundaryless). 

\subsection{Laplacain on Manifolds}

The Laplace-Beltrami operator is the unique continuous linear operator $\Delta_g: \calH^s (\calM) \to \calH^{(s-2)} (\calM) $ satisfying the property
  \begin{align}
\int_{\calM} \psi(x) \Delta_g \phi(x) d\text{vol}_g(x) = - \int_{\calM}  \langle \nabla_g \phi(x) , \nabla_g  \psi(x)\rangle_g d \text{vol}_g(x),
\end{align}
 for any $\phi,\psi \in \calH^s (\calM)$. This generalizes the usual definition of the Laplacian operator  $\Delta = \partial_1^2+ \cdots+\partial^2_d$, defined on the Euclidean space $\R^d$, which satisfies this property by integration by parts. The kernel of the operator $\Delta_g$ includes the so-called harmonic functions. In the case of compact boundariless manifolds, the only harmonic functions are constants. 
 
The operator $(-\Delta_g)$ is elliptic,  self-adjoint,  and can be diagonalized in $L^2(\calM)$ \cite{chavel1984eigenvalues}. In particular, there exists an orthonormal basis $\{\phi_\ell(x) \}_{\ell=0}^{\infty}$ of $L^2(\calM)$ starting from the constant function $\phi_0 \equiv 1$ such that $\Delta_g  \phi_\ell + \lambda_\ell \phi_\ell = 0$, for the discrete spectrum $0=\lambda_0 < \lambda_1 \le \lambda_2\le \ldots$.   Note that eigenvalues appear in this sequence with their multiplicities.
Using the above identity,  for an arbitrary $f \in L^2(\calM)$ with the expansion $f = \sum_{\ell=0}^\infty \langle f, \phi_\ell \rangle_{L^2(\calM)} \phi_\ell$ and $L^2(\calM)-$norm $ \quad \| f \|^2_{L^2(\calM)}  = \sum_{\ell=0}^{\infty} |\langle f, \phi_\ell \rangle_{L^2(\calM)}|^2$, we have $ \Delta_g f = - \sum_{\ell=0}^{\infty} \lambda_\ell \langle f, \phi_\ell \rangle \phi_\ell$ and
\begin{align}
%f& = \sum_{i=0}^\infty \langle f, \phi_i \rangle_{L^2(\calM)} \phi_i,
 %\quad \| f \|^2_{L^2(\calM)}  = \sum_{i=0}^{\infty} |\langle f, \phi_i \rangle_{L^2(\calM)}|^2 \\ 
\| \nabla_gf \|^2_{L^2(\calM)} &= \int_{\calM} \langle \nabla_gf(x) , \nabla_gf(x)\rangle_{g} d \text{vol}_g(x)
\\
&= - \int_{\calM} f(x) \Delta_g f(x) d \text{vol}_g(x)\\
&= \sum_{\ell=0}^{\infty} \lambda_\ell \langle f, \phi_\ell \rangle_{L^2(\calM)}^2,\label{equation_grad}
\end{align}
whenever the sums converge. 

\subsection{(Local) Weyl's Law}
It is known that the Laplace-Beltrami spectrum can encode many manifold geometric properties, such as dimension, volume, etc. However, it is also known that isospectral (non-isomorphic) manifolds exist. Still, it provides rich information about the manifold. Let us denote the set of distinct eigenvalues of a manifold by $\Spec(\calM):= \{ \lambda_0,\lambda_1,\ldots\} \subset \R_{\ge0}$.  

 Weyl's law characterizes the asymptotic distribution of the eigenvalues in a closed-form formula.
Let us denote the number of eigenvalues of the Laplace-Beltrami operator up to $\lambda$ as $N(\lambda) := \#\{ \ell : \lambda_\ell \le \lambda\}$. 
\begin{proposition}[Local Weyl's law, \cite{canzani2013analysis, hormander1968spectral, sogge1988concerning}] \label{local_weyl}
Let $(\calM,g)$ denote an arbitrary $\dim(\calM)-$dimensional closed  (i.e., compact boundariless) Riemannian manifold. Then, for all $x \in \calM$,
\begin{align}
N_x(\lambda): = \sum_{\ell: \lambda_\ell \le \lambda} |\phi_\ell(x)|^2  =  \frac{\omega_{\dim(\calM)}}{(2\pi)^{\dim(\calM)}} \vol(\calM) \lambda^{\dim(\calM)/2} + \calO(\lambda^{\frac{\dim(\calM)-1}{2}}),
\end{align}
as $\lambda \to \infty$, where  $\omega_d = \frac{\pi^{d/2}}{\Gamma(\frac{d}{2}+1)}$ is the volume of the unit $d-$ball in the Euclidean space $\R^d$. The constant in the error term is indeed independent of $x$ and may only depend on the sectional curvature and the injectivity radius of the manifold \cite{donnelly2001bounds}. As a byproduct, the following $L^\infty$ upper bound also holds:
\begin{align}
\max_{\lambda_\ell \le \lambda} \max_{x \in \calM} |\phi_\ell(x)| = \calO \Big (\lambda^{\frac{\dim(\calM)-1}{4}} \Big). 
\end{align}
\end{proposition}
By definition, $N(\lambda) = \int_{\calM} N_x(\lambda) d\vol_g(x) $ and thus, while the above result is called  the local Weyl's law, the traditional Weyl's law can be easily derived as
$N(\lambda) =  \frac{\omega_{\dim(\calM)}}{(2\pi)^{\dim(\calM)}} \vol(\calM) \lambda^{{\dim(\calM)}/2} + \calO(\lambda^{\frac{\dim(\calM)-1}{2}})$. 
For compact Riemannian manifolds $(\calM,g)$ with boundary, to define the eigenfunctions of the Laplace-Beltrami operator (i.e., the solutions to the equation $\Delta_g\phi + \lambda \phi = 0$), one has to consider boundary conditions.     
For the  Dirichlet boundary condition (i.e., assuming the solution vanishes on the boundary), or the Neumann boundary condition (i.e., assuming the solution's gradient vanishes on the outward normal vector at each point of the boundary), the above claim on the local behavior of eigenfunctions still holds. 



%In this paper, we use a non-asymptotic local version of Weyl's law as follows. Let $N_x(\lambda): = \sum_{i: \lambda_i \le \lambda} \phi^2_{i}(x)$ for any $x \in \calM$.
%
%   \begin{proposition}[\cite{mcrae2020sample}, non-asymptotic local Weyl's law] $N_x(\lambda) \le \frac{3 \sqrt{d}}{(2 \pi)^d} \omega_d \vol(\calM)  \lambda^{d/2}$ for $\lambda \ge \frac{d^3}{3}\kappa$ where $\kappa$ is an upper bound on the sectional curvature of the manifold.
%\end{proposition}


 


The asymptotic distribution of eigenvalues allows us to define the Minakshisundaramâ€“Pleijel zeta function of the manifold $(\calM,g)$  as follows \cite{minakshisundaram1949some}: 
\begin{align}
\calZ_{\calM}(s) = \sum_{\ell=1}^{\infty} \lambda_\ell^{-s} = \int_{0+}^\infty  \lambda^{-s} dN(\lambda); \quad \Im(s)>\frac{\dim(\calM)}{2},
\end{align}
where the sum converges absolutely by Weyl's law. Note that the integral must be understood as a Riemannâ€“Stieltjes integral. The zeta function can be analytically continued to a meromorphic function on the complex plane and has a functional equation. By integration by parts, 
\begin{align}
\calZ_{\calM}(s) &=   \int_{0+}^\infty  \lambda^{-s} dN(\lambda) 
\\ & = \lambda^{-s} N(\lambda) \big |_{0+}^\infty -  \int_{0^+}^\infty  N(\lambda) (-s) \lambda^{-s-1} d\lambda
\\& = s \int_{0+}^\infty  N(\lambda) \lambda^{-s-1} d\lambda,
\end{align}
by $N(\lambda) = \calO(\lambda^{\dim(\calM)/2})$ and the assumption $\Im(s)>\frac{\dim(\calM)}{2}$.

For more information on the spectral theory of Riemannian manifolds, see \cite{lablee2015spectral}. 

\subsection{Quotient Manifold Theorem}\label{prelim_quotient}

This part reviews some classical results about group actions on manifolds (mostly from \cite{lee2013smooth, kobayashi2012transformation, bredon1972introduction}). 
Let $G$ be an arbitrary group. The action of $G$ on the manifold $\calM$ is a mapping $\theta: G \times \calM \to \calM$ such that $\theta(\text{id}_G, .) =\text{id}_{\calM}$ and $\theta(\tau_1\tau_2,.) = \theta(\tau_1, \theta(\tau_2,.))$ for any $\tau_1,\tau_2 \in G$. In particular, any group action gives a $G-$indexed set of bijections on $\calM$ with respect to the group law of $G$. For example, $\ISO(\calM)$ acts on $\calM$ by the isometric transformations (which are bijections by definition).

For each $x\in \calM$, the orbit of $x$ is defined as the set of all images of the group transformations at $x$ on the manifold:
\begin{align}
[x]:= \big \{ \theta(\tau,x) \in \calM: \tau \in G \big \}.
\end{align}
Also, for any $x\in \calM$, define the isotropy group  $G_x:= \{ \tau \in G:  \theta(\tau,x) = x\}$. In other words, the isotropy group $G_x$, as a subgroup of $G$, includes all the transformations $\tau \in G$ which have $x\in \calM$ as a fixed point. 
The set of all orbits is denoted by $\calM / G$ and is called the orbit space (or sometimes the fundamental domain) of the action on the manifold:
\begin{align}
\calM / G:= \big \{ [x]: x\in \calM \big \}.
\end{align}
It is known that $\calM / G$ admits a unique topological structure coming from the topology of the manifold, making the projection (or the quotient) map $\pi: \calM \to \calM / G$ continuous. 

However, $\calM/ G$ is not always a manifold. For example, if $\calM = \R^d$ and $G = \GL_d(\R)$, then the resulting orbit space $\calM / G$ is not Hausdorff. Even in cases where it is a manifold,  the orbit space $\calM / G$ may have boundaries while $\calM$ is boundaryless.   For example, consider the action of the orthogonal group   $\calO(d) := \{ A \in \GL_d(\R) : A^TA = A^TA = I_d\}$  on  the manifold $\calM = \R^d$, where the orbit space becomes  $\calM / G = \R_{\ge 0}$. For the purpose of this paper, boundaries are important and affect the results drastically. 


The quotient manifold theorem gives a number of sufficient conditions on the manifold/group, such that the orbit space is always a manifold.  To introduce the theorem, we need to review a few classical definitions as follows. 

A group action is called free, if and only if it has no non-trivial fixed points, i.e., $\theta(\tau,x) \neq x$ for all $\tau \neq \text{id}_G$ (equivalently, $G_x = \{ \text{id}_G\}$ for all $x\in \calM$). For example, the action of the group of linear transformations $\theta(r,x) = x+ r$, for each $x, r\in \R^d$, on the manifold $\R^d$ is a free action. An action is called smooth if and only if for each $\tau\in G$, the mapping $\theta(\tau,.):\calM \to \calM$ is smooth. An action is called proper, if and only if the map $\big (\theta(\tau,x), x\big) : G \times \calM \to \calM \times \calM$ is a proper map. As a sufficient condition, every continuous action of a compact Lie group $G$ on a manifold is proper. To simplify our notation, let us define $\tau(x) := \theta(\tau,x)$. 

%the action of the on $(d-1)-$sphere $\mathbb{S}^{d-1}:= \{ x \in \R^d: \|x\|_2 = 1\}$. 


\begin{theorem}[Quotient Manifold Theorem, \cite{lee2013smooth}] \label{qmt}
 Let $G$ be a Lie group acting smoothly, freely, and properly on a smooth manifold $(\calM,g)$. Then, the orbit space (or the fundamental domain) $\calM / G$ is a smooth manifold of dimension $\dim(\calM) - \dim(G)$ with a unique smooth structure such that the projection (or the quotient) map $\pi: \calM \to \calM / G$ is a smooth submersion. 
\end{theorem}


\begin{corollary}\label{qmt_cor}
Suppose $\calM$ is a connected smooth closed (i.e., compact boundariless) manifold. Then, the isometry group $\ISO(\calM)$ is a compact Lie group acting smoothly on $\calM$. Thus,   if $G$ is a closed subgroup of $\ISO(\calM)$, then the action of $G$ on $\calM$ is smooth and proper. In addition, if this action is free, then the orbit space $\calM / G$ becomes a connected closed (i.e, compact boundaryless) manifold of dimension $\dim(\calM) - \dim(G)$. 

Furthermore, assuming $(\calM,g)$ is a Riemannian manifold,  there exists a unique Riemannian metric $\tilde{g}$ such that the projection map $\pi: (\calM,g) \to (\calM/G, \tilde{g})$ is a Riemannian submersion. 
\end{corollary}


There is indeed a natural way to interpret these results. Given a manifold $(\calM,g)$, the orbit space is somehow the shrinkage of the manifold to represent exactly one representative from each orbit, and the metric $\tilde{g}$ is just identical to the original metric if the tangent lines survive; otherwise, the tangent lines are killed, and the inner product defined by  $\tilde{g}$ is zero. 


\subsection{Principal Orbit Theorem}\label{app_pot}


The quotient manifold theorem is, however, restricted to free actions. Unfortunately, this assumption is generally necessary to prove that the quotient space is a closed (i.e., compact boundaryless) manifold. In the lack of freeness, it is still possible to show that the quotient space is \textit{almost} a manifold (possibly with boundary). First, let us introduce a few definitions. Two isotropy groups $G_x$ and $G_y$ are called conjugate (with respect to $G$), if and only if $\tau^{-1} G_x \tau = G_y$ for some $\tau \in G$. This is a relation on the manifold, and the \textit{isotropy type} of any $x \in \calM$ is defined as the equivalence class of its isotropy group, denoted as $[G_x]$. Since all the points on an orbit have the same isotropy type (by definition), one can also define the isotropy type of an orbit in the same way.  Given the conjugacy relation, a partial order can be naturally defined as follows: $H_1 \preceq H_2$ if and only if $H_1$ is conjugate to a subgroup of $H_2$. Since the definition is unchanged modulo conjugate groups, one can also restrict the partial order to the conjugacy class of subgroups. This allows us to define a partial order on orbits as well: for any two orbits $[x], [y]$, we write $[x] \le [y]$ if and only if $G_y \preceq G_x$. For example, if $G_x = \{\text{id}_G \}$, then $[y] \le [x]$ for all $y \in \calM$.       


Given the above formal definitions, the quotient manifold theorem assumes that \textit{all} the orbits have a \textit{unique maximal orbit type}, namely, the orbit type $[\{ \text{id}_G\}]$.  By removing the freeness assumption, however, there might be several orbit types that are not necessarily comparable with respect to the partial order. However, the \textit{principal orbit type theorem} shows that there always exists a \textit{unique maximal orbit type}, where when the action is restricted to those orbits, it defines a Riemannian submersion (thus the image is a manifold), and moreover, the \textit{principal orbits} (those orbit with the maximal orbit types) are \textit{dense} in the manifold $\calM$.   This shows that we almost get a nice space, which suffices for our subsequent proofs in the next sections.



\begin{theorem}[Principal Orbit Theorem]\label{pot}
 Let $G$ be a compact Lie group acting isometrically on a Riemannian manifold $(\calM,g)$. Then, there exists an open dense subset $\calM_0 \subseteq \calM$, such that $[x] \ge [y]$ for all $x \in \calM_0$ and $y \in \calM$.   Moreover, the natural projection $\pi: \calM_0 \to \calM_0 / G \subseteq \calM/G$ is a Riemannian submersion. Also, the set $\calM_0/G\subseteq \calM/G$ is open, dense, and connected in $\calM/G$.
\end{theorem}

\begin{corollary}\label{pot_cor}
One has the decomposition
\begin{align}
\calM/G = \bigsqcup_{[H] \preceq G} \calM_{[H]}/G,
\end{align}
where $\calM_{[H]}:= \{ x \in \calM : [G_x] = [H]\}$ is a submanifold of $\calM$. The disjoint union is taken over all isotropy types of the group action on the manifold. The map $\pi: \calM_{[H]} \to \calM_{[H]}/G$ is a Riemannian submersion; therefore its image is a manifold. By an application of the Slice theorem, one can observe that only finitely many isotropy types can exist when $G$ and $\calM$ are both compact. Thus, the disjoint union is indeed over finitely many precompact smooth manifolds. Among those, the principal part $\calM_0/G:= \calM_{[H_0]}/G$ is dense in $\calM/G$, where $[H_0]$ is the unique maximal isotropy type of the group action.  
\end{corollary}


Intuitively, the above corollary shows that the quotient space can be decomposed to finitely many "pieces," and each piece has a nice smooth structure. 
In the case of a free action, the decomposition above reduces to just one "piece" with the unique trivial maximal orbit type (i.e., having a trivial isotropy group). 
 The dimension of each "piece" $\calM_{[H]}/G$ can be computed as 
\begin{align}
\dim(\calM_{[H]}/G) = \dim(\calM) - \dim(G)+\dim(H).
\end{align}  
The \textit{effective dimension of the quotient space} is then defined as \begin{align}
d:=\dim(\calM_{[H_0]}/G) =\dim(\calM_0/G) = \dim(\calM) - \dim(G)+\dim(H_0),
\end{align}
where $[H_0]$ is the unique maximal isotropy type of the group action.


\subsection{Isometries and Laplace-Beltrami Eigenspaces}\label{iso_eig}

In Weyl's law, the eigenvalues are counted with their multiplicities. Let us define $V_{\lambda}$ as the eigenspace of the eigenvalue $\lambda$ with the finite dimension $\dim (V_{\lambda})$. Then, $N(\lambda) = \sum_{\lambda' \le \lambda} \dim (V_{\lambda'})$. 
%Also, let $N^0(\lambda):= \sum_{\lambda' \le \lambda} \mathds{1}_{\{n_{\lambda'}\}}$ denote the number of distinct eigenvalues up to $\lambda$.   


As a well-known fact from differential geometry, the Laplace-Beltrami operator $\Delta_g$ commutes with all isometries $\tau \in \ISO(\calM)$. Thus, 
\begin{align}
 \Delta_g  \phi_\ell + \lambda_\ell \phi_\ell = 0 \iff  \Delta_g  (\phi_\ell \circ \tau) + \lambda_\ell (\phi_\ell \circ \tau) = 0.
\end{align}
This means that the eigenspaces of the Laplace-Beltrami operator are invariant with respect to the action of the isometry group on the manifold. 

\begin{corollary} 
$L^2(\calM) = \bigoplus_{\lambda \in \Spec(\calM)} V_\lambda$,  
and the isometry group of the manifold $\ISO(\calM)$  (and thus all its closed subgroups) acts on each eigenspace $V_\lambda$.
\end{corollary}

Now consider an arbitrary closed subgroup $G$ of the isometry group $\ISO(\calM)$. Then $G$ acts on the eigenspaces of the Laplace-Beltrami operator and each $\tau \in G$ corresponds to a bijective linear transformation $f \mapsto f\circ \tau$,  denoted as $\tau^*_{\lambda}: V_{\lambda} \to V_{\lambda}$. There is a natural way to extend this operator into the whole space $L^2(\calM)$ so one may consider  $\tau^*_{\lambda}: L^2(\calM) \to L^2(\calM)$.  Since $\tau$ is an isometry, for any $\phi \in V_{\lambda}$, 
\begin{align}
\| \tau^*_{\lambda} \phi \|^2_{L^2(\calM)} &= \int_{\calM} |\tau^*_{\lambda} \phi(x) |^2 d\text{vol}_g(x)
\\ &= \int_{\calM} |\phi(x) |^2 d\text{vol}_{g}(x)
\\ & = \| \phi \|^2_{L^2(\calM)}
\\ & = 1,
\end{align}
since $d\vol_g$ is invariant with respect to any isometry $\tau \in G$. This shows that the bijective linear transformation $\tau^*_{\lambda}$ is indeed a representation of the group $G$ into the orthogonal group $\calO(\dim (V_{\lambda}))$ for each eigenvalue $\lambda$.


%\begin{definition} The orthogonal group of order $n$ is defined as 
%\begin{align}
%\calO(n) := \{ A \in GL_n(\R) : A^TA = A^TA = I_n\}.
%\end{align}
%For an aribtrary group $G$, a mapping $\rho: G \to \calO(n)$ is called a representation if and only if it is a group homomorphism: $\rho(g_1g_2) = \rho(g_1)\rho(g_2)$ for any $g_1,g_2 \in G$.
%\end{definition}


In this paper, we are interested in the space of invariant functions defined with respect to an arbitrary closed subgroup $G$ of the isometry group $\ISO(\calM)$.

\begin{definition}
The space of invariant functions with respect to a closed subgroup $G$ of the isometry group $\ISO(\calM)$ is defined as 
\begin{align}
L_{\inv}^2(\calM, G):= \Big\{ f \in L^2(\calM) : \forall \tau \in G: \tau^*f := f \circ \tau= f \Big\} \subseteq L^2(\calM),
\end{align}
as a closed subspace of $L^2(\calM)$. 
\end{definition}

Let $d\tau$ denote the Haar measure (i.e., the uniform measure) associated with a closed subgroup $G$ of the isometry group $\ISO(\calM)$. 
Let the projection operator $\calP_{G} : L^2(\calM) \to L_{\inv}^2(\calM, G)$ be defined as $f(x) \mapsto \int_{G} (f\circ \tau)(x) d\tau  = \int_{G} \tau^*f(x) d\tau$. Claerly, $f \in L_{\inv}^2(\calM, G)$ if and only if $f \in \ker(I-\calP_G)$.


\begin{proposition}\label{prop_group}
For any closed subgroup $G$ of the isometry group $\ISO(\calM)$, the following decomposition holds:
\begin{align}
L_{\inv}^2(\calM, G)&= \ker(I-\calP_G)
\\
& = \bigcap_{\substack{\lambda \in \Spec (\calM)  \\ \tau \in G}} \ker(I - \tau^*_\lambda)
\\
&=\bigoplus_{\lambda \in \Spec (\calM)} V_{\lambda,G},
\end{align}
where each $V_{\lambda,G}$ is a linear subspace of $V_{\lambda}$ defined as
\begin{align}
V_{\lambda,G} &:= \Big \{ f \in V_{\lambda}: \forall \tau \in G: \tau^*_\lambda f := f \circ \tau= f \Big \}
\\
& = \bigcap_{ \tau \in G} \ker(I - \tau^*_\lambda).
\end{align} 
Clearly, $\dim(V_{\lambda,G}) \le \dim(V_{\lambda})$. 

Moreover,   the  (restricted) projection operator $\calP_G: V_{\lambda} \to V_{\lambda} $ has the image $V_{\lambda, G}$ and it can be diagonalized in a basis for $V_{\lambda}$ such as $\phi_{\lambda, \ell} \in V_{\lambda}, \ell=1,2,\ldots,  \dim(V_{\lambda})$, such that for each $f = \sum_{\ell=1}^{ \dim(V_{\lambda})} \alpha_\ell \phi_{\lambda, \ell} \in V_{\lambda}$,  
\begin{align}
&f \in V_{\lambda, G} 	 \iff   \forall \ell > \dim(V_{\lambda,G}) :   \alpha_{\ell} = 0
\\
&\calP_{\lambda,G} f =  \sum_{\ell=1}^{ \dim(V_{\lambda,G})} \alpha_\ell \phi_{\lambda, \ell} \in V_{\lambda, G}.
\end{align} 
\end{proposition}
Due to its simplicity, we omit the proof of this proposition. We always consider the diagonalized basis in this paper, as it always exists for appropriate eigenfunctions.





\subsection{Reproducing Kernel Hilbert Spaces on Manifolds}\label{prelim_kernel}


A smooth connected closed (i.e., compact boundaryless) Riemannian manifold $(\calM,g)$ is indeed a compact metric-measure space, and a kernel $K: \calM \times \calM \to \R$ can be thought of as a measure of similarity between points on the manifold. We assume that $K$ is continuous, symmetric, and positive-definite, meaning that $K(x,y) = K(y,x)$ and $\sum_{i,j=1}^n a_ia_j K(x_i,y_j) \ge0$ for any $a_i \in \R, x_i,y_j \in \calM, i,j=1,2,\ldots,n$, and the equality happens only when $a_1=a_2=\ldots = a_n = 0$ (assuming the points on the manifold are distinct).  The Reproducing Kernel Hilbert Space (RKHS) of $K$ is a Hilbert space $\calH \subseteq L^2(\calM)$ that is achieved by the completion of the span of functions $K(.,y) \in \calH$ for each $y \in \calM$,  satisfying the following property: for all $f \in \calH$, $f(x) = \langle f,K(x,.) \rangle_{\calH}$. Associated with the kernel $K$, there exists an integral operator   
$\calK: L^2(\calM) \to L^2(\calM)$  defined as $\mathcal{K}(f) = \int_{\calM} K(x,y)f(y) d\vol_g(y)$. It can be shown that $K$ can be diagonalized in an appropriate orthonormal basis of functions in $L^2(\calM)$ (Mercer's theorem). Indeed, with a number of appropriate assumptions, it can be diagonalized in the Laplace-Beltrami spectrum.

\begin{proposition}\label{prop_kernel}
Consider a  symmetric positive-definite  kernel $K: \calM \times \calM \to \R$, and assume  that $K\in C^2(\calM \times \calM)$ satisfies the differential equation $\Delta_{g,x} (K(x,y)) = \Delta_{g,y}(K(x,y))$.  Then, $K$ can be diagonalized in the basis of the eigenfunctions of the Laplace-Beltrami operator; there exist appropriate $\mu_{\ell} \ge 0 $, $\ell=0,1,\ldots$, such that
\begin{align}
K(x,y) = \sum_{\ell=0}^{\infty} \mu_{\ell} \phi_\ell(x) \phi_\ell(y),
\end{align}
where $\phi_\ell, \ell=0,1,\ldots$, form an orthonormal basis for $L^2(\calM)$ such that $\Delta_g \phi_\ell + \lambda_\ell \phi_\ell = 0$ for each $\ell$.
\end{proposition}
\begin{proof}
Note that  $\mathcal{K} (\phi_\ell (x)) = \int_{\calM} K(x,y) \phi_\ell(y) d\vol_g(y)$. Therefore, 
\begin{align}
  \Delta_{g,x}(\mathcal{K} (\phi_\ell)) &= \Delta_{g,x} \Big (\int_{\calM} K(x,y) \phi_\ell(y) d\text{vol}_g(y) \Big)
\\&=   \int_{\calM}  \Delta_{g,x} K(x,y) \phi_\ell(y) d\text{vol}_g(y) 
\\&= \int_{\calM}  \Delta_{g,y} K(x,y) \phi_\ell(y) d\text{vol}_g(y) 
\\& = \int_{\calM}   K(x,y) \Delta_{g,y}\phi_\ell(y) d\text{vol}_g(y) 
\\& =  \lambda_\ell \int_{\calM}   K(x,y) \phi_\ell(y) d\text{vol}_g(y)
\\& = \lambda_\ell \mathcal{K} (\phi_\ell),
\end{align}
where we used the symmetry of the kernel,  the regularity condition of the kernel (allowing the interchange of the differentiation and the integral sign), and also the self-adjointness of the Laplace-Beltrami operator. Now since $\calK (\phi_\ell)$ satisfies the equation $\Delta_g ( \calK (\phi_\ell)) + \lambda_i  \calK (\phi_\ell) = 0$,  we conclude that $   \calK (\phi_\ell)$ is indeed an eigenfunction with respect to the eigenvalue $\lambda_\ell$, or equivalently $   \calK (\phi_\ell)\in V_{\lambda_\ell}$. In other words, $V_{\lambda}$, $\lambda \in \Spec(\calM)$, are the invariant subspaces of the integral operator associated with the kernel. This means that one can choose an appropriate basis of eigenfunctions in each eigenspace, such that the kernel is diagonalized in each eigenspace (Mercer's theorem). 
\end{proof}

\begin{remark}
While Proposition \ref{prop_kernel} holds for a kernel   $K \in C^2(\calM \times \calM)$, it can be shown that it holds under a weaker assumption that $K$ is just continuous. The identity $\Delta_{g,x} (K(x,y)) = \Delta_{g,y}(K(x,y))$ should  then be understood as the identity of two distributions.
\end{remark}
%As an important caveat, note that while each kernel $K(.,.)$ can be diagonalized in the Laplace spectrum, and also each eigenspace $V_{\lambda, G}$ can be made a projection operator in the Laplace spectrum, the two diagonalizations may not be available simultaneously. 
In this paper, we always consider the diagonalized kernels in the Laplace-Beltrami spectrum. An example of a kernel of this form is the heat kernel with $\mu_\ell = e^{-\lambda_\ell t}$, $t\in \R$. Given a diagonalized kernel  $K(x,y) = \sum_{\ell=0}^{\infty} \mu_\ell \phi_\ell(x) \phi_\ell(y)$, one can explicitly define the RKHS associated with $K$ as   
\begin{align}
\calH = \Big \{ f = \sum_{\ell=0}^\infty \alpha_\ell \phi_\ell : \sum_{\ell=0}^\infty  \frac{|\alpha_\ell|^2}{\mu_{\ell}} < \infty \Big \},
\end{align}
with the inner-product 
\begin{align}
\Big \langle \sum_{\ell=0}^\infty \alpha_\ell \phi_\ell , \sum_{\ell=0}^\infty \beta_\ell \phi_\ell  \Big\rangle_{\calH} = \sum_{\ell=0}^\infty \frac{\alpha_\ell \beta_\ell}{\mu_{\ell}},
\end{align}
 where the sum is considered convergent whenever it converges absolutely.  The feature map is therefore given as $\Phi_x =K(x,.)= \sum_{\ell=0}^\infty \mu_{\ell} \phi_\ell(x) \phi_\ell(.)$ for any $x \in \calM$. The covariance operator $\Sigma : \calH \to \calH$ is also defined as $\Sigma = \E_{x \sim \mu}[ \Phi_x \otimes_{\calH} \Phi_x]$ where the expectation is with respect to the uniform sample $x \in \calM$ (with respect to the normalized volume element $d\mu = \frac{1}{\vol(\calM)}d\vol_g(x)$). It is worth mentioning the identity $\| \calK^{1/2}(f)\|_{\calH} = \| f \|_{L^2(\calM)}$. 



\subsection{Invariant Kernels}\label{prelim_kernel_inv}

A kernel $K : \calM \times \calM \to \R$ is called $G-$invariant  with respect to a closed subgroup  $G$ of $\ISO(\calM)$, if and only if $K(x,y) = K(\tau(x),\tau'(y))$ for any $\tau,\tau' \in G$. Equivalently, one has $K(x,y) = K([x],[y])$ for any $x,y \in \calM$. In the previous section, it is observed that $K$ can be written as $
K(x,y) = \sum_{\ell=0}^{\infty} \mu_{\ell} \phi_\ell(x) \phi_\ell(y)
$, under a few conditions. Since $K$ is $G-$invariant,  
a new basis of eigenfunctions exists that allows a more compact representation of the kernel.  

%$\tilde{\phi}_i$ in $V_{\lambda}$ such that $K_{\lambda} = \sum_{i=1}^{d_{\lambda,G}} \mu_i \tilde{\phi}_i(x) \tilde{\phi}_i(y)$. 

\begin{proposition}\label{prop_inv_ker}
For any closed subgroup $G$ of $\ISO(\calM)$, consider  a symmetric positive-definite  $G-$invariant kernel  $K: \calM \times \calM \to \R$, and assume  that $K\in C^2(\calM \times \calM)$ satisfies the differential equation $\Delta_{g,x} (K(x,y)) = \Delta_{g,y}(K(x,y))$. Then, $K$ can be diagonalized in the basis of eigenfunctions of the Laplace-Beltrami operator:
\begin{align}
K(x,y) = \sum_{\lambda \in \Spec(\calM)} \sum_{\ell=1}^{\dim(V_{\lambda,G})} \mu_{\lambda, \ell} \phi_{\lambda,\ell}(x) \phi_{\lambda,\ell}(y),
\end{align}
where the functions $\phi_{\lambda,\ell}$,  for any $\lambda \in \Spec(\calM)$,  and any $\ell=1,\ldots, \dim(V_{\lambda})$,  form a basis for $L^2(\calM)$ such that $\Delta_g (\phi_{\lambda,\ell}) + \lambda (\phi_{\lambda,\ell}) = 0$ for each $\ell,\lambda$. Moreover, the functions $\phi_{\lambda,\ell}$,  for any $\lambda \in \Spec(\calM)$,  and any $\ell=1,\ldots, \dim(V_{\lambda,G})$,  form an orthonormal basis for $L^2_{\inv}(\calM,G)$.
\end{proposition}
Therefore, the RKHS of a $G-$invariant kernel $K$ can be  defined as 
\begin{align}
\calH = \Big \{ f = \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{ \dim(V_{\lambda,G}) } \alpha_{\lambda,\ell}\phi_{\lambda,\ell}:  \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{\dim(V_{\lambda,G}) } \frac{|\alpha_{\lambda,\ell}|^2}{\mu_{\lambda,\ell}} < \infty \Big \}, 
\end{align}
with the inner-product 
\begin{align}
\Big \langle \sum_{\lambda \in \Spec(\calM)} \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } \alpha_{\lambda,\ell}\phi_{\lambda,\ell} , \sum_{\lambda \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G})} \beta_{\lambda,\ell}\phi_{\lambda,\ell} \Big \rangle_{\calH} = \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } \frac{\alpha_{\lambda,\ell} \beta_{\lambda,\ell}}{\mu_{\lambda,\ell}}.
\end{align} 
Whenever $G$ is the trivial group, the above identities reduce to what is proposed for general (not necessarily invariant) kernels on manifolds in the previous section. Once again, the assumption $K \in C^2(\calM \times \calM)$   can be weakened to just the continuity of $K$.  



\subsection{Sobolev Spaces of Functions on Manifolds}\label{sobolev_kernel}

For any integer $s\ge 0 $, the Sobolev space $\calH^s(\calM)$ is the Hilbert space of measurable functions on $\calM$ with square-integrable partial derivatives\footnote{The partial derivatives on manifolds are defined locally in each coordinate.} up to order $s$. More generally, $\calH^{s,q}(\calM)$ denotes the 
Banach space of measurable functions with $L^p$ bounded partial derivatives up to order $s$. 
 As observed in \cite{hendriks1990nonparametric}, one can define the Sobolev space $\calH^s(\calM) \subset L^2(\calM)$ using the eigenfunctions of the Laplace-Beltrami operator as 
\begin{align}
\calH^s(\calM) := \Big\{ f = \sum_{\ell=0}^\infty \alpha_\ell \phi_\ell : \|f\|^2_{\calH^s(\calM)} = \sum_{\ell=0}^\infty  \max(1,\lambda_{\ell}^{s}) |\alpha_\ell |^2 < \infty \Big\}.
\end{align}
The inner-product on $\calH^s(\calM)$ is defined as 
\begin{align}
\Big \langle  \sum_{\ell=1}^\infty \alpha_{\ell}\phi_{\ell} ,  \sum_{\ell=1}^\infty \alpha_{\ell}\phi_{\ell} \Big \rangle_{\calH^s(\calM)} =  \sum_{\ell=1}^{\infty}   \max(1,\lambda_{\ell}^{s}){\alpha_\ell \beta_\ell}.
\end{align} 
This makes $\calH^s(\calM)$ an RKHS with the Sobolev kernel defined as
\begin{align}
K_{\calH^s(\calM)}(x,y) = \sum_{\lambda \in \Spec(\calM)} \sum_{\ell=1}^{\dim(V_{\lambda})}  \min(1,\lambda_\ell^{-s}) \phi_{\lambda,\ell}(x) \phi_{\lambda,\ell}(y),
\end{align}
For $G-$invariant functions, as before, the above sum must be truncated to $\dim(V_{\lambda, G})$ instead of $\dim(V_{\lambda})$. Therefore, $\calH^s_{\inv}(\calM) = \calH^s(\calM) \cap L^2_{\inv} (\calM,G)$ is well-defined.



We note that $\calH^s(\calM)$ includes only continuous functions when $s>d/2$. Moreover, it contains only continuously differentiable functions up to order $k$ when $s>d/2+k$; see the Sobolev inequality:



\begin{proposition}[\cite{aubin1998some}, Sobolev inequality] Let $\frac{1}{2} - \frac{s}{d} = \frac{1}{q} - \frac{\ell}{d}$ with $s\ge \ell \ge0$ and $q>2$,  where $d$ is the dimension of the smooth compact closed manifold $\calM$. Then, 
\begin{align}
\|f\|_{\calH^{\ell,q}(\calM)} \le C \|f\|_{\calH^s(\calM)}. 
\end{align}
The constant $C$ may depend only on the manifold and the parameters but is independent of the function $f \in L^2(\calM)$.
\end{proposition}

 



\section{Proof of Theorem \ref{thrm_dim}}\label{app:dim_proof}



We first prove Theorem \ref{thrm_dim} for the cases that the group action on the manifold is \textit{free} (Proposition \ref{prop_group_1}), and then we extend it to the general case. 
We use the preset notation/definitions introduced in Appendix \ref{preli} (specifically, Proposition \ref{prop_group}) in this section. 

\begin{proposition}[] \label{prop_group_1}
Let $(\calM,g)$ be a smooth connected closed (i.e., compact boundaryless) Riemannian manifold of dimension $\dim(\calM)$. Let $G$ be a Lie subgroup of $\ISO(\calM)$ of dimension $\dim(G)$, and assume that $G$ acts freely on $\calM$ (i.e., having no non-trivial fixed point), and let $d:= \dim(\calM)- \dim(G)$ denote the effective dimension of the quotient space. 
%Assume either $G$ is discrete (i.e., $\dim(G) = 0$) or the manifold is embedded in a Euclidean space, and the metric $g$ is induced by the Euclidean metric. 
Then, 
\begin{align}
N_x(\lambda;G)&:= \sum_{\lambda' \le \lambda}  \sum_{\ell=1}^{ \dim(V_{\lambda',G})}  |\phi_{\lambda',\ell}(x)|^2 =  
 \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \lambda^{d/2} + \calO(\lambda^{\frac{d-1}{2}}), \label{thrm_dim_bound}
\end{align}
as $\lambda \to \infty$, where $\omega_d = \frac{\pi^{d/2}}{\Gamma(\frac{d}{2}+1)}$ is the volume of the unit $d-$ball in the Euclidean space $\R^d$. 
\end{proposition}

\begin{remark}Note that the above proposition provides a much stronger result than Theorem \ref{thrm_dim}; it is  \textit{local}. Observe that $N(\lambda;G) = \int_{\calM} N_x(\lambda;G) d\vol_g(x)$, and thus integrating the left-hand side of the above equation proves Theorem \ref{thrm_dim} for the special case of free actions. We will later prove the same local result (Equation (\ref{thrm_dim_bound})) for the general compact Lie group actions on a manifold, presuming the assumptions in Theorem \ref{thrm_dim}.  
\end{remark}  



\begin{proof}[Proof of Proposition \ref{prop_group_1}]
By the quotient manifold theorem (Theorem \ref{qmt}) and Corollary \ref{qmt_cor},  the orbit space $\calM / G$ is a connected closed (i.e, compact boundaryless) manifold of dimension $d = \dim(\calM) - \dim(G)$. Let us denote the Laplace-Beltrami operators on $\calM$ and $\calM / G$ by $\Delta_g$ and $\Delta_{\tilde{g}}$, where $\tilde{g}$ is the induced Riemannian metric on $\calM / G$ from $g$. Consider two arbitrary smooth functions $\phi : \calM \to \R$ and $\tilde{\phi} : \calM / G \to \R$ such that $\phi(x) = \tilde{\phi}([x])$.  Note that $\phi$ is smooth on $\calM$, if and only if $\tilde{\phi}$ is smooth on $\calM / G$, and also, $\phi$ is invariant by definition. Fix an arbitrary $\lambda$. We claim that 
\begin{align}
\Delta_{\tilde{g}} \tilde{\phi} + \lambda \tilde{\phi} = 0 \iff \Delta_{{g}} {\phi} + \lambda {\phi} = 0 
\end{align}
Given the above identity, the desired result follows immediately by an application of the local Weyl's law (Proposition \ref{local_weyl}) on the manifold $\calM / G$ of dimension $d= \dim(\calM)- \dim(G)$.

To prove the claim, we only need to show that $\Delta_{\tilde{g}} \tilde{\phi} = \Delta_{g}  \phi$. First assume that $G$ is a finite group (i.e., $\dim(G) = 0$). Note that in local coordinates $(x^1,x^2,\ldots,x^{\dim(\calM)})$ we have
\begin{align}
\Delta_g \phi = \frac{1}{\sqrt{|\det g|}}\partial_i\big( \sqrt{|\det g|} g^{ij} \partial_j \phi\big).
\end{align}
However, the projection map $\pi: \calM \to \calM / G$ is a Riemannian submersion, with differential $d\pi_x: T_x\calM \to T_{[x]}(\calM / G)$ being an invertible linear map from a $\dim(\calM)-$dimensional vector space to   another $\dim(\calM)-$dimensional vector space.  This shows that the local coordinates $(x^1,x^2,\ldots,x^{\dim(\calM)})$ are also simultaneously some local coordinates for $\calM / G$, and since $\tilde{g}$ is induced by the metric $g$, the result holds by the above identity for the Laplace-Beltrami operator. 

Now assume $\dim(G) \ge 1$. In this case, for the projection map $\pi: \calM \to \calM / G$, the differential map $d\pi_x: T_x\calM \to T_{[x]}(\calM / G)$ is a surjective linear map from a $\dim(\calM)-$dimensional vector space to  a $(\dim(\calM)- \dim(G))-$dimensional vector space. Indeed, $T_x\calM = \ker(d\pi_x) \oplus \ker^{\bot}(d\pi_x)$, with respect to the inner product defined by $g$. 
This means that with an appropriate choice of local coordinates such as  $(x^1,x^2,\ldots,x^{\dim(\calM)})$ around a point $x \in \calM$, satisfying
\begin{align}
g_{ij} = g\Big(
\frac{\partial}{\partial_i},
 \frac{\partial}{\partial_j}
\Big) = \ind \{i = j\},
\end{align}
for any $i,j \in \{1,2,\ldots,\dim(\calM)\}$, we have $\frac{\partial}{\partial_i} \in \ker^{\bot}(d\pi_x)$ for any $i = 1,2,\ldots, \dim(\calM) - \dim(G)$, and  $\frac{\partial}{\partial_i} \in \ker(d\pi_x)$ for any $i >\dim(\calM) - \dim(G)$. In particular, the restriction of the local coordinates to the first $\dim(\calM)-\dim(G)$ elements is assumed to be some local coordinates for $\calM / G$. This is always possible for an appropriate choice of local coordinates.

In these specific local coordinates, by definition, 
\begin{align}
\Delta_g \phi &= \sum_{i=1}^{\dim(\calM)}\partial^2_i\phi \\
\Delta_{\tilde{g}} \tilde{\phi} &= \sum_{i=1}^{\dim(\calM)-\dim(G)}\partial^2_i\tilde{\phi}. 
\end{align}
 Note that  $\partial^2_i \tilde{\phi} = \partial^2_i \phi$ for $i=1,2,\ldots, \dim(\calM)-\dim(G)$.  Thus, the proof is complete if we show $\partial_i \phi \equiv 0$, for all $i>\dim(\calM)-\dim(G)$, for a neighborhood around $x$ in the local coordinates  $(x^{\dim(\calM)-\dim(G)+1},\ldots,x^{\dim(\calM)})$, while the other coordinates are kept the same as $x$. 
But note that for any $x'$ sufficiently close to $x$ with the same coordinates $(x^1,x^2,\ldots,x^{\dim(\calM)-\dim(G)})$, one has $[x'] = [x]$, by definition. This means that $\phi(x) = \phi(x')$ and this completes the proof. 
\end{proof}
 
 

To extend Proposition \ref{prop_group_1} to a general compact Lie group action $G$, we need to use the principal orbit theorem (Theorem \ref{pot}) and its consequences (see Appendix \ref{app_pot}). Again, we prove that the generalized local result (Equation (\ref{thrm_dim_bound})) holds, presuming the assumptions in Theorem \ref{thrm_dim}.





%To extend the dimension Proposition \ref{prop_group_1} to a general  Lie group action $G$, one way is to first "separate" the group into two parts,  the first having no non-trivial fixed point (i.e., the "nice" part of the group for which we can still use Proposition \ref{prop_group_1}). Then for the rest of the group, under some assumptions, even if has isometries with non-trivial fixed points,  we can prove a dimension counting result as follows. 


 

%
%\begin{proposition}\label{prop_group_2}
%Let $(\calM,g)$ be a smooth connected closed (i.e., compact boundaryless) Riemannian manifold of dimension $\dim(\calM)$. Let $G$ be a closed subgroup of $\ISO(\calM)$, and assume that 
%\begin{itemize}
%\item $G = S \cup H = SH = HS$, where $H$ is a Lie subgroup of $G$ of dimension $\dim(H)$, 
%\item $S\subset G$ is a subset of $G$ with $\id_G \in S$,
%\item $H$  acts freely on $\calM$ (i.e., having no non-trivial fixed point). 
%\item $s^{-1}Hs = H$, for any $s \in S$, 
%\item   $\{ sH: s \in S\}$ is a finite set. 
%\end{itemize}
%Let $d:= \dim(\calM)- \dim(H)$.
%Then, 
%\begin{align}
%N_x(\lambda;G)&:= \sum_{\lambda' \le \lambda}  \sum_{\ell=1}^{ \dim(V_{\lambda',G})}  |\phi_{\lambda',\ell}(x)|^2 =  
% \frac{\omega_d}{(2\pi)^d} \frac{\vol(\calM / H)}{|\{ sH: s \in S\}|} \lambda^{d/2} + \calO(\lambda^{\frac{d-1}{2}}),
%\end{align}
%as $\lambda \to \infty$, where $\omega_d = \frac{\pi^{d/2}}{\Gamma(\frac{d}{2}+1)}$ is the volume of the unit $d-$ball in the Euclidean space $\R^d$. In this case, we define $\vol(\calM / G) :=  \frac{\vol(\calM / H)}{|\{ sH: s \in S\}|}$.   
%\end{proposition}
%

\begin{proof}[Proof of Theorem \ref{thrm_dim}]
According to Corollary \ref{pot_cor}, one has the following decomposition of the quotient space: $\calM/G = \bigsqcup_{[H] \preceq G} \calM_{[H]}/G$. In other words, the quotient space is the disjoint union of finitely many manifolds, and among them, $\calM_0/G$ is open and dense in $\calM/G$. As a first step towards the proof, we show that $\Delta_{\tilde{g}} \tilde{\phi} = \Delta_{g}  \phi$ for any two smooth functions $\phi : \calM_0 \to \R$ and $\tilde{\phi} : \calM_0 / G \to \R$ such that $\phi(x) = \tilde{\phi}([x])$, for any $x \in \calM_0$ and $[x] \in \calM_0/G$.  However, the proof of this claim is exactly the same as what is presented in the proof of Proposition \ref{prop_group_1}; thus, we skip it.  

 





%According to Proposition \ref{prop_group_1}, the quotient manifold theorem (Theorem \ref{qmt}) and Corollary \ref{qmt_cor}, the orbit space $\calM / H$ is a connected closed (i.e, compact boundaryless) manifold of dimension $d = \dim(\calM) - \dim(H)$. Using the assumptions,  the set $\tilde{S}:= \{ sH: s \in S\}$ forms a group, and  acts isometrically on $\calM / H$. 



Recall that the effective dimension of the quotient space is defined as $
d:=\dim(\calM_{[H_0]}/G) =\dim(\calM_0/G) = \dim(\calM) - \dim(G)+\dim(H_0),$
where $[H_0]$ is the unique maximal isotropy type (corresponding to $\calM_0$). 
We claim that there exists a connected compact manifold (possibly with boundary) $\widetilde{\calM}\subseteq \calM/G$ such that (1) it includes the principal part, i.e., $\widetilde{\calM} \supseteq \calM_0/G$, and (2) the projected invariant functions on $\widetilde{\calM}$ satisfy 
the Neumann boundary condition on its boundary $\partial(\widetilde{\calM})$. More precisely, the second condition means that for any two smooth functions $\phi : \calM_0 \to \R$ and $\tilde{\phi} : \calM_0 / G \to \R$ such that $\phi(x) = \tilde{\phi}([x])$, for any $x \in \calM_0$ and $[x] \in \calM_0/G$, the function $\tilde{\phi}$ satisfies the Neumann boundary condition on $\partial(\widetilde{\calM})$. 
Given this claim, by the local Weyl's law (Proposition \ref{local_weyl}), the proof is complete. 




%if we show either of the following conditions hold: (1)  $\partial(\overline{\calM_0/G}) = \emptyset$,  i.e., the closure of the set of principal orbits in the quotient space $\calM_0/G$ is a closed (i.e., compact boundaryless) manifold, or (2) $\partial(\overline{\calM_0/G})$ in non-empty (and indeed it is a subset of the finite decomposition of the quotient space), 
%and for any two smooth functions $\phi : \calM_0 \to \R$ and $\tilde{\phi} : \calM_0 / G \to \R$ such that $\phi(x) = \tilde{\phi}([x])$, for any $x \in \calM_0$ and $[x] \in \calM_0/G$, the function $\tilde{\phi}$ satisfies the Neumann boundary condition on $\partial(\overline{\calM_0/G})$. Note that $\partial$ means the boundary of a manifold, and without loss of generality, we can omit those manifolds $\calM_{[H]}/G$ with a dimension less than $d-1$. From now on, we use $\overline{\calM_0/G}$ and $\calM/G$ interchangeably while always we assume that some finite disjoint sets in the decomposition of the quotient space are removed, if necessary. 
%Since the proof of the theorem assuming condition (1) is trivial, we focus on condition (2) and prove that the claim about having the Neumann boundary condition holds. 
   



%For any $s \in S$, let $\calM_s$ denote the set of fixed points of the action of $s$ on $\calM$. For any $x \in \calM / \cup_{s\neq 1} \calM_s$ (i.e, $x$ is not a fixed-point of any non-trivial isometry), there exists a fundamental domain $\calM / S$ around $x \in \calM$ and an open subset $U\ni x$ of $\calM$ such that $U \subset \calM/S$ (note that here we are clearly using the fact that $S$ is finite). Thus, given a connected closed fundamental domain $\calM / S$, the only possible boundary points are those fixed by some non-trivial isometry $s \in S$, i.e., $\partial\big( \calM / S \big) \subseteq \cup_{s\neq \id_G} \calM_s$. 
%Note that $\partial\big( \calM / S \big)$  includes a  finite number of  (if any) piece-wise smooth submanifolds of $\calM$ of dimension $\dim(\calM) -1$, plus possibly a negligible set (i.e., a measure-zero set).  






%Thus, without loss of generality, one can assume that $H = \{1\}$, and $\tilde{S}=S$ is a finite group of isometries of $\calM/H = \calM$.  For any $s \in S$, let $\calM_s$ denote the set of fixed points of the action of $s$ on $\calM$. For any $x \in \calM / \cup_{s\neq 1} \calM_s$ (i.e, $x$ is not a fixed-point of any non-trivial isometry), there exists a fundamental domain $\calM / S$ around $x \in \calM$ and an open subset $U\ni x$ of $\calM$ such that $U \subset \calM/S$ (note that here we are clearly using the fact that $S$ is finite). Thus, given a connected closed fundamental domain $\calM / S$, the only possible boundary points are those fixed by some non-trivial isometry $s \in S$, i.e., $\partial\big( \calM / S \big) \subseteq \cup_{s\neq \id_G} \calM_s$. 
%Note that $\partial\big( \calM / S \big)$  includes a  finite number of  (if any) piece-wise smooth submanifolds of $\calM$ of dimension $\dim(\calM) -1$, plus possibly a negligible set (i.e., a measure-zero set).  


%Note that $\partial\big( \calM / S \big)$  includes a  finite number of  (if any) piece-wise smooth submanifolds of $\calM$ of dimension $\dim(\calM) -1$, plus possibly a negligible set (i.e., a measure-zero set).  As a first step towards the proof, we need to show that $\Delta_{\tilde{g}} \tilde{\phi} = \Delta_{g}  \phi$ for any two smooth functions $\phi : \calM \to \R$ and $\tilde{\phi} : \calM / S \to \R$ such that $\phi(x) = \tilde{\phi}([x])$, for $x \in \text{int}(\calM / S)$, i.e., on the interior of the space $\calM / S$.  But this is trivial, as there exists an open set around each such $x \in \text{int}(\calM / S)$ such that $\calM / S$ is locally identical to the manifold $\calM$.



We only need to specify the manifold $\widetilde{\calM}$ and prove that each projected invariant function on it satisfies the Neumann boundary condition. Indeed, the construction of the manifold $\widetilde{\calM}$ follows  from the finite decomposition of the quotient space $\calM/G = \bigsqcup_{[H] \preceq G} \calM_{[H]}/G$. Moreover, we can assume that the boundary of $\widetilde{\calM}$ is piecewise smooth. Let $[x] \in \partial(\widetilde{\calM})$ be a boundary point (in the interior of a smooth piece of the boundary). We claim that
%Note that the assumed compact boundary is a disjoint union of finitely many smooth manifolds of dimension $d-1$, and thus without loss of generality, we can prove the claim for an interior point of the smooth pieces (the point is still on the boundary). 
%In particular, the claim is that for a boundary point $[x] \in \partial(\overline{\calM_0/G})$,  
\begin{align}
\phi \text{~is $G-$invariant~on~$\calM$~}\implies \langle \nabla_{\tilde{g}} \tilde{\phi}([x]), \hat{n}_{[x]} \rangle_{\tilde{g}} = 0,
\end{align}
for any smooth  $\phi:\calM \to \R$, where  $\phi(x) = \tilde{\phi}([x])$, and this completes the proof.  Note that $\hat{n}_{[x]} \in T_{[x]}(\widetilde{\calM})$ is the unit outward normal vector of the manifold $\widetilde{\calM}$ at $[x]$. 
To prove the claim, we write $T_{[x]}(\widetilde{\calM}) = \text{span}(\hat{n}_{[x]}) \oplus H_{[x]}$ for an orthogonal vector space $H_{[x]}$. But $H_{[x]} \simeq T_{[x]}{\partial(\widetilde{\calM})}$. Also,  in a neighborhood $\calN$ around $[x]$ in $\partial (\widetilde{\calM})$, for each $[y] \in \calN$, we have the smooth identity
 $(\rho_{[y]}^{-1}\circ \tau_{[x]} \circ \rho_{[y]}) (y)= y$ 
 for some $\rho_{[y]}, \tau_{[x]} \in G$,  such that $(\rho_{[y]}^{-1}\circ \tau_{[x]} \circ \rho_{[y]}) $  does not belong to isotropy groups of $\calM_0/G$ near $[x]$. WLOG, we assume that $\rho_{[x]} = \text{id}_G$. 

 
%To prove the claim, we write $T_x\calM = \text{span}(\hat{n}_x) \oplus H_x$ for the orthogonal vector space $H_x$. But $H_x \simeq T_{[x]}{\partial(\calM / S)}$, and around $[x]$ in $\partial (\calM/S)$, we have the identity $\tau(x) = x$. 

Now consider a geodesic on $\calM$ starting from $x\in \calM$ with unit velocity such as $\gamma(t)$ with $\gamma(0)=x$ and $d\pi_{[x]}(\gamma'(0)) = \hat{n}_{[x]}$. Note that  $[\gamma(t) ]\notin \partial (\widetilde{M})$ for small enough $t\in(0,\epsilon)$, and thus it belongs to $\calM_0 / G$. But it is simultaneously "on the other side" of the particular fundamental domain of $\calM_0 /G$  around $[x]$, meaning that $[\tau_{[x]}(\gamma(t))]$ is necessarily a curve starting from $[x]$ towards the inside of the fundamental domain. In particular, since $\tau_{[x]}$ is an isometry (and thus a local isometry),  we necessarily have  $(\tau_{[x]}\circ\gamma)'(0) = -\hat{n}_{[x]}$ (note that in this step we clearly use the explanations in the previous paragraph). Now by considering the function $\phi\circ \gamma = \phi \circ \tau_{[x]}\circ \gamma$ on the interval $t \in (0,\epsilon)$, we get 
\begin{align}
\langle \nabla_{\tilde{g}} \tilde{\phi}([x]), \hat{n}_{[x]} \rangle_{\tilde{g}} = \langle \nabla_{\tilde{g}} \tilde{\phi}([x]), -\hat{n}_{[x]} \rangle_{\tilde{g}} \implies \langle \nabla_{\tilde{g}} \tilde{\phi}([x]), \hat{n}_{[x]} \rangle_{\tilde{g}} = 0,
\end{align}
and this completes the proof.
\end{proof}







 \section{Proof of Theorem \ref{thrm_sobolev}}
 
 

 
 
 
 
 In this section, we use Theorem \ref{thrm_dim} to prove Theorem \ref{thrm_sobolev}. 
 Let us first state a standard bound in the literature holding for any RKHS. 
 
 \begin{proposition}[\cite{bach2021learning}, Proposition 7.3] \label{prop_error}Consider the KRR problem in an RKHS setting, and let $f^\star_{\proj}$ denote the orthogonal projection of $f^\star$ on the Hilbert space $\calH$.  Assume that $K(x,x) \le R^2$ for any $x \in \calM$, $\eta \le R^2$, and $n \ge \frac{5R^2}{\eta} (1+ \log(\frac{R^2}{\eta}))$. Then, 
 \begin{align}
 \E [ \calR(\hat{f})  - \calR(f^\star_{\proj}) ] &\le 16 \frac{\sigma^2}{n} \tr [  (\Sigma + \eta I)^{-1} \Sigma     ] \\&+ 16 \inf_{f \in \calH} \big \{     \|f - f^\star_{\proj} \|^2_{L^2(\calM)} + \eta \| f \|^2_{\calH}                     \big \}
 +\frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)},
 \end{align}
where the expectation is over the randomness of the dataset $\calS$, and $\Sigma = \E_{x \sim \mu}[ \Phi_x \otimes_{\calH} \Phi_x]$ is the covariance operator with the feature map $\Phi_x= \sum_{\ell=0}^\infty \mu_{\ell} \phi_\ell(x) \phi_\ell$ for any $x \in \calM$. 
\end{proposition} 
Note that $f^\star_{\proj} = f^\star$ if the closure of $\calH$ with respect to the $L^2(\calM)-$norm is $L_{\inv}^2(\calM, G)$.
In the Laplace-Beltrami basis, $\Sigma$ is diagonal with the diagonal elements $(\Sigma)_{\ell,\ell} = \mu_{\ell}$ for each $\ell$. Note that the first and second terms in the above upper bound are known as the variance and the bias terms, respectively. Also, while the bound holds in expectation for a random dataset $\calS$, assuming $\epsilon_i$'s are sub-Gaussian, one can extend the result to a high-probability bound using standard concentration inequalities. However, for the brevity/clarity of the paper, we restrict our attention to the expectation of the population risk. 
 
 We need to have an explicit upper bound for $R$ to use the above proposition. Although the problem is essentially homogenous with respect to $R$, for the sake of completeness, we explicitly compute a uniform upper bound on the diagonal values of the kernel in terms of the problem's parameters. The goal is to first check that the two conditions $R <\infty$ and $n \ge \frac{5R^2}{\eta} (1+ \log(\frac{R^2}{\eta}))$ are satisfied. The latter condition is indeed satisfied when $\eta \ge \frac{5R^2\log(n)}{n}$. Note that if  $\mu_{\lambda, \ell} \neq 0$ for any $\lambda,\ell$ with $\ell = 1,2,\ldots, \dim(V_{\lambda, G})$, then any $G-$invariant function $f^\star \in \calF \subseteq L^2_{\inv}(\calM,G)$ is in the closure of $\calH$.  Indeed, in that case the closure of $\calH$ with respect to the $L^2(\calM)-$norm includes $L_{\inv}^2(\calM, G)$.
 
 
 \subsection{Bounding $K(x,x)$}\label{diag_bound}
 
 We start with the definition of $R$; for any $x \in \calM$, we have
 \begin{align}
 K(x,x) & = \langle \Phi_x, \Phi_x\rangle_{\calH}=\sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } \mu_{\lambda, \ell}|\phi_{\lambda,\ell}(x)|^2.
 \end{align}
%We now need a uniform bound on the eigenfunction of the Laplace operator, which is available in the literature. 
%  \begin{proposition}[\cite{hormander1968spectral, sogge1988concerning}] \label{prop_infty} Let $\lambda >0$ be an eigenvalue of the Laplace-Beltrami operator on a compact Riemannian manifold with the corresponding to the eigenfunction $\phi \in C^\infty(\calM)$. Then, $\| \phi\|_{L^{\infty}(\calM)} \le C_1 \lambda^{\frac{d-1}{4}} \| \phi\|_{L^{2}(\calM)},$ where $C_1$ is a constant depending only on the manifold.
% \end{proposition}
%The constant $C_1$ depends only on the sectional curvature and the injectivity radius of the manifold \cite{donnelly2001bounds}.
By the local version of Theorem \ref{thrm_dim}, we know that $N_x(\lambda;G)= \sum_{\lambda' \le \lambda}  \sum_{\ell=1}^{ \dim(V_{\lambda',G})}  |\phi_{\lambda',\ell}(x)|^2 \le  
 \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \lambda^{d/2} + C_{\calM / G}\lambda^{\frac{d-1}{2}}$, for an absolute constant $C_{\calM / G}$, where $d$ denotes the effective dimension of the quotient space. 
Therefore, if $\mu_{\lambda, \ell} \le u(\lambda)$ for a differentiable bounded function $u(\lambda)$, for any $\lambda, \ell$, then
 \begin{align}
 K(x,x) & \le     \int_{0^-}^\infty u(\lambda)  dN_x(\lambda;G)\\
  & \overset{(a)}{=} \lim_{\lambda \to \infty}u(\lambda) N_x(\lambda;G) - u(0^-) N_x(0^-;G)
  -  \int_{0^-}^\infty N_x(\lambda;G) u'(\lambda)  d\lambda\\
  & \overset{(b)}{\le} \frac{-\omega_d}{(2\pi)^d} \vol(\calM / G) \int_{0^-}^\infty  \lambda^{d/2} u'(\lambda)  d\lambda 
  + 
C_{\calM/G}   \int_{0^-}^\infty  \lambda^{(d-1)/2} u'(\lambda)  d\lambda  \\
& \overset{(c)}{=}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \frac{d}{2} \int_{0^-}^\infty  \lambda^{d/2-1} u(\lambda)  d\lambda 
  + 
C_{\calM/G}    \int_{0^-}^\infty  \lambda^{(d-1)/2-1} u(\lambda)  d\lambda   \\
& =   \frac{d}{2}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big  (\{\calM u\}(d/2) \Big)
  + 
C_{\calM/G}   \Big ( \{\calM u \}((d-1)/2)\Big),
  \end{align}
  where (a) and (c) follow by integration by parts,  and (b) follows from Theorem \ref{thrm_dim}. Also, the Mellin transform is defined as $\{\calM u\}(s):= \int_0^\infty t^{s-1}u(t) dt$.
  
  
  
  
  
  
  
%  
%  
%  
%  
%where we define  $\gamma_{\lambda,G}(x) := \frac{1}{d_{\lambda}}\sum_{i=1}^{d_{\lambda,G}}   \phi^2_{\lambda,i}(x)$ for any $x \in \calM$. %By Weyl's law, $N(\lambda) = O(\lambda^{d/2}),$ so the first term vanishes whenever $\mu(\lambda) \gamma_{G,\lambda}(x) = o(\lambda^{-d/2})$. 
%
%
%
%
%Note that the expected value of $\gamma_{\lambda,G}(x)$ is $\int_{\calM} \gamma_{\lambda,G}(x) d\vol_g(x)  = \frac{d_{\lambda,G}}{d_\lambda}$.  By the above proposition, we can get a uniform bound $\gamma_{\lambda,G}(x) \le C_1 \frac{d_{\lambda,G}}{d_\lambda} \lambda^{\frac{d-1}{2}}$ for $\lambda >0$. Thus, $K(x,x) \le  \frac{\mu(0)}{\vol(\calM)}+ C_1 \int_{0^+}^\infty \mu(\lambda)    \frac{d_{\lambda,G}}{d_\lambda} \lambda^{\frac{d-1}{2}}  dN(\lambda)$. One can further use $\frac{d_{\lambda,G}}{d_\lambda}\le 1$ to obtain another bound $K(x,x) \le \frac{\mu(0)}{\vol(\calM)}+  C_1 \int_{0^+}^\infty \mu(\lambda)  \lambda^{\frac{d-1}{2}}  dN(\lambda) $. By the definition of the zeta function, if $\mu(\lambda) \le C_{\xi}(\lambda+1)^{-s}$, then
%\begin{align}
%K(x,x) & \le   \frac{C_{\xi}}{\vol(\calM)}+ C_1 \int_{0^+}^\infty \mu(\lambda)  \lambda^{\frac{d-1}{2}}  dN(\lambda)
%\\& \le  \frac{C_{\xi}}{\vol(\calM)}+ C_1C_{\xi}  \int_{0^+}^\infty  \lambda^{-s+\frac{d-1}{2}}  dN(\lambda)
%\\& = \frac{C_{\xi}}{\vol(\calM)}+ C_1C_{\xi}  \calZ_{\calM}(s-\frac{d-1}{2}).
% \end{align}
%
%
%
%
%
 
 
 

 \subsection{Bounding the Bias Term}  We have already observed that the function achieving the infimum is 
 \begin{align}
 \FF = \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }\frac{\mu_{\lambda, \ell}}{\mu_{\lambda, \ell} + \eta}\langle f^\star, \phi_{\lambda,\ell} \rangle_{L^2(\calM)} \phi_{\lambda,\ell}.
 \end{align} 
 Note that clearly $\FF \in \calH$ for $\eta>0$, as we can explicitly compute $\|\FF\|_{\calH} <\infty$. 
 %Using standard bounds in the literature \cite[Theorem 3]{cucker2002mathematical}, we obtain
 Also, 
 \begin{align}
 f^\star_{\proj} = \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }   \ind \{\mu_{\lambda, \ell} \neq 0\} \langle f^\star, \phi_{\lambda,\ell} \rangle_{L^2(\calM)} \phi_{\lambda, \ell}.
 \end{align}
 Thus,
 \begin{align}
 16 \inf_{f \in \calH} \Big \{     \|f - f^\star_{\proj} \|^2_{L^2(\calM)} &+ \eta \| f \|^2_{\calH} \Big \} 
 =  16    \| \FF - f^\star_{\proj} \|^2_{L^2(\calM)} + 16 \eta \| \FF \|^2_{\calH}  
\\&  = 16 \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } \Big(\frac{\mu_{\lambda, \ell}}{\mu_{\lambda, \ell} + \eta}-1\Big)^2 \langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)} 
\\
& + 16 \eta \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } \frac{1}{\mu_{\lambda, \ell}} 
\Big ( \frac{\mu_{\lambda, \ell}}{\mu_{\lambda, \ell} + \eta}\langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle_{L^2(\calM)} \Big)^2 \\
& = 16 \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
\Big (\frac{\eta^2 + \eta \mu_{\lambda,\ell}}{(\mu_{\lambda, \ell} + \eta)^2}\Big )
\langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}\\
& = 16 \eta\sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
\Big (\frac{1}{\mu_{\lambda, \ell} + \eta }\Big )
\langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}.
 \end{align}  
 
% \begin{align}
% 16 \inf_{f \in \calH} \big \{     \|f - f^\star\|^2_{L^2(\calM)} + \eta \| f \|^2_{\calH}      \big \}
%& = 16 \sum_{i=0}^\infty (\langle f^\star, \phi_i \rangle_{L^2(\calM)})^2 (\frac{\mu_{\ell}}{\mu_{\ell} + \eta} - 1)^2
%+ \frac{\eta}{\mu_{\ell}}  (\langle f^\star, \phi_i \rangle_{L^2(\calM)})^2
%\\& = 16 \sum_{i=0}^\infty (\langle f^\star, \phi_i \rangle_{L^2(\calM)})^2 ((\frac{\eta^2}{\mu_{\ell} + \eta} )^2 + \frac{\eta}{\mu_{\ell}}).
% \end{align}
 
 
  \subsection{Bounding the Variance Term} 
 We need to compute the trace of the operator $ (\Sigma + \eta I)^{-1} \Sigma$. But this operator is diagonal in the Laplace-Beltrami basis, and thus we get
 \begin{align}
 16 \frac{\sigma^2}{n} \tr [  (\Sigma + \eta I)^{-1} \Sigma   ] &=  
 16 \frac{\sigma^2}{n} \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }
 \frac{\mu_{\lambda, \ell}}{\mu_{\lambda,\ell} + \eta}. 
 \end{align}




%
%where we define $\gamma_{\lambda,G} = \frac{d_{\lambda,G}}{d_{\lambda}} \le 1$.
%
%
% Let us also set 
% \begin{align}
%   D(T)&:= \int_{0^-}^T \frac{\mu(\lambda)}{\mu(\lambda)+\eta}  dN(\lambda)
%   \\   {\bar{\gamma}}_{G}(T) &:= \Big (\int_{T}^\infty \frac{\mu(\lambda)}{\mu(\lambda)+\eta} \frac{d_{\lambda,G}}{d_{\lambda}} dN(\lambda) \Big )
%   /
%   \Big (
%    \int_{T}^\infty \frac{\mu(\lambda)}{\mu(\lambda)+\eta}  dN(\lambda)  
%   \Big )
% \end{align}
%
% Now assume  that $\mu(\lambda) \ge C_{\xi,1}(\lambda+1)^{-s_1}$, $\mu(\lambda) = o(\lambda^{-d/2 })$,  and $|(\mu)'(\lambda)| \le C'_{\xi}(\lambda+1)^{-s_2-1}$ with $s_1>s_2>d/2$. 
%Then by integration by parts, assuming $N(\lambda) \le C_d \lambda^{d/2}$ (by non-asymptotic Weyl's law), 
% \begin{align}
% \int_{0^-}^\infty \frac{\mu(\lambda)}{\mu(\lambda)+\eta}  dN(\lambda)
% & =  \frac{\mu(\lambda)}{\mu(\lambda)+\eta} N(\lambda) \big |_{0^-}^\infty +   \int_{0^-}^\infty \eta  \frac{  |(\mu)'(\lambda)|       N(\lambda)}{(\mu(\lambda)+\eta)^2} d\lambda
% \\ & = \eta \int_{0^-}^\infty   \frac{  |(\mu)'(\lambda)|       N(\lambda)}{(\mu(\lambda)+\eta)^2} d\lambda
% \\& \le   \eta \int_{0^-}^\infty   \frac{  C'_{\xi}(\lambda+1)^{-s_2-1}      C_d \lambda^{d/2}}{(\mu(\lambda)+\eta)^2} d\lambda
%  \\& \le   \eta \int_{0^-}^\infty   \frac{  C'_{\xi}(\lambda+1)^{-s_2-1}      C_d \lambda^{d/2}}{\xi^4(\lambda)+\eta^2} d\lambda
% \\ & \le  \eta \int_{0^-}^\infty   \frac{  C'_{\xi}(\lambda+1)^{-s_2-1}      C_d \lambda^{d/2}}{ C^2_{\xi,1}(\lambda+1)^{-2s_1} +\eta^2} d\lambda
% \\ & \le C_d C'_{\xi} \eta \int_{1^-}^\infty   \frac{     \lambda^{-s_2-1+ d/2}}{  C^2_{\xi,1}\lambda^{-2s_1} +\eta^2} d\lambda
%  \\ & \le C_d C'_{\xi} \eta \int_{1^-}^\infty   \frac{     \lambda^{2s_1-s_2-1+ d/2}}{  C^2_{\xi,1} +\eta^2\lambda^{2s_1}} d\lambda
%   \\ & \le C_d C'_{\xi}   \eta^{1-1/s_1-1/s_1(2s_1-s_2-1+ d/2)} \int_{\eta^{1/s_1}}^{\infty \times \eta^{1/s_1}}   \frac{     u^{2s_1-s_2-1+ d/2}}{  C^2_{\xi,1} + u^{2s_1}} du \quad \quad \text{if} \quad u = \eta^{1/s_1} \lambda
%      \\ & \le C_d C'_{\xi}   \eta^{s_2/s_1 - 1 - d/(2s_1)} \int_{\eta^{1/s_1}}^{\infty \times \eta^{1/s_1}}   \frac{     u^{2s_1-s_2-1+ d/2}}{  C^2_{\xi,1} + u^{2s_1}} du 
%       \\& \le C_K  \eta ^{s_2/s_1 - 1- d/(2s_1)},
% \end{align}
% which holds for a constant $C_K$, if $2s_1 > 2s_1 -s_2-1+d/2+1$ or $s_2 > d/2$.
% Similarly, for the truncated integral on $\lambda = T$, we get 
% \begin{align}
% D(T) &= \int_{0^-}^T \frac{\mu(\lambda)}{\mu(\lambda)+\eta}  dN(\lambda)
% \\& \le \frac{\mu(\lambda)}{\mu(\lambda)+\eta} N(\lambda) \big |_{0^-}^T +    C_d C'_{\xi}   \eta^{s_2/s_1 - 1 - d/(2s_1)} \int_{\eta^{1/s_1}}^{T \times \eta^{1/s_1}}   \frac{     u^{2s_1-s_2-1+ d/2}}{  C^2_{\xi,1} + u^{2s_1}} du 
% \\& \le C_D + C_I \times T\eta^{1/s_1},
% \end{align}
% for suitable constants $C_D, C_I$. Note that this bound is useful only when $T$ is small. 
% 
% 
% Therefore, the variance term is bounded as
% \begin{align}
% 16 \frac{\sigma^2}{n} \tr [  (\Sigma + \eta I)^{-1} \Sigma     ] & \le   16 \frac{\sigma^2}{n} D(T) +  16 \frac{\sigma^2}{n} C_K {\bar{\gamma}}_{G}(T)   \eta ^{s_2/s_1 - 1- d/(2s_1)}
% \\ & \le 16 \frac{\sigma^2}{n} (C_D + C_I \times T\eta^{1/s_1}) +  16 \frac{\sigma^2}{n} C_K {\bar{\gamma}}_{G}(T)   \eta ^{s_2/s_1 - 1- d/(2s_1)}.
% \end{align}
% 
% 
%Therefore, we have  
% \begin{align}
% \E [ \calR(\hat{f}) ] \le 
% 16 \frac{\sigma^2}{n}\sum_{i=0}^\infty \frac{\mu_{\ell}}{\mu_{\ell} + \eta}
%+16 \sum_{i=0}^\infty (\langle f^\star, \phi_i \rangle_{L^2(\calM)})^2 ((\frac{\eta^2}{\mu_{\ell} + \eta} )^2 + \frac{\eta}{\mu_{\ell}})
%+\frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)},
% \end{align}
% 
% 
 
 
 \subsection{Bounding the Population Risk}
 Now we combine the previous steps to get
% \begin{align}
%   \E [ \calR(\hat{f}) ] \le 16 \frac{\sigma^2}{n} D(T) +  16 \frac{\sigma^2}{n} C_K {\bar{\gamma}}_{G}(T)   \eta ^{- d/(2s)}+ 16 C^2_{f^\star}\eta^{2r} + \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)}
% \end{align}
  \begin{align}
   \E [ \calR(\hat{f})  - \calR(f^\star_{\proj}) ] 
 &\le 16 \frac{\sigma^2}{n} \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }
 \frac{\mu_{\lambda, \ell}}{\mu_{\lambda,\ell} + \eta}
 \\& +16 \eta\sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
\Big (\frac{1}{\mu_{\lambda, \ell} + \eta }\Big )
\langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}
\\& + \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)},
 \end{align}
 which holds when $R < \infty$ and $\eta \ge \frac{5R^2\log(n)}{n}$. 
 
 
% 
% \subsubsection{Case I: Kernels with Finite Rank}
% To evaluate the convergence rate of the population risk, we impose a few assumptions on the spectral properties of the kernel. For this part, we assume there are only $D$ non-zero eigenfunctions appearing in the spectral decomposition of the kernel. This means that $D=| \{(\lambda, \ell) : \mu_{\lambda, \ell} \neq 0\}|$ for a positive integer $D$. Note that in this case, $\calH$ is a $D-$dimensional vector space. 
% 
%Let us  start with the trivial bound $ \frac{\mu_{\lambda, \ell}}{\mu_{\lambda,\ell} + \eta}
% \le 1$, for those with $\mu_{\lambda, \ell} \neq 0$. Also, since $\eta\ge0$, one has $\frac{1}{\mu_{\lambda, \ell} + \eta }\le \frac{1}{\mu_{\lambda, \ell}}$. Thus, 
%   \begin{align}
%   \E [ \calR(\hat{f})  - \calR(f^\star_{\proj}) ] 
% &\le 16 \frac{\sigma^2}{n}D+16 \eta\sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
%\frac{1}{\mu_{\lambda, \ell} }
%\langle f^\star_{\proj}, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}+ \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)} 
%\\
%& = 16 \frac{\sigma^2}{n}D+16 \eta \| f^\star_{\proj} \|^2_{\calH}+ \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)}. 
% \end{align}
% To optimize the bound, note that any $\eta \in [\frac{5R^2\log(n)}{n},R^2]$ is allowed. We make the special choice of $\eta  = \frac{5R^2\log(n)}{n}$ to minimize  it and get
%   \begin{align}
%   \E [ \calR(\hat{f})  - \calR(f^\star_{\proj})] \le
% 16 \frac{\sigma^2}{n}D+ \frac{80R^2\log(n)}{n} \| f^\star_{\proj} \|^2_{\calH}+ \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)}. 
% \end{align}
% 
 
 
 
% \subsubsection{Case II: Sobolev Kernels}
 
 
We are now ready to bound the convergence rate of the population risk of KRR for invariant Sobolev space $\calH^s_{\inv}(\calM)$ (See Section \ref{sobolev_kernel} for the definition). In this case, $\mu_{\lambda, \ell} =u(\lambda)= \min(1,\lambda ^{-s})$ for each $\lambda, \ell$. Therefore, 
 \begin{align}
 \{\calM u \}(d/2) =  \int_0^\infty \min(1,\lambda ^{-s}) t^{d/2-1} dt \le 1 + \frac{1}{s-d/2}. 
 \end{align}
 Similarly, $\{\calM u \}((d-1)/2) \le 1 + \frac{1}{s-(d-1)/2}$. Thus,  using the analysis in Section \ref{diag_bound}, we get
 \begin{align}
K_{\calH^s(\calM)}(x,x) \le   R^2:=&    \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big( d/2 + \frac{ d/2}{s-d/2}\Big)  \\&+ 
C_{\calM/G}   \Big( 1 + \frac{1}{s-(d-1)/2}\Big).\label{R_equation}
  \end{align}
  In particular, $R< \infty$ if $s>d/2$. 
 We now compute the bias and the variance terms as follows. Let us start with the variance term: 
\begin{align}
16 \frac{\sigma^2}{n} & \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }
 \frac{\mu_{\lambda, \ell}}{\mu_{\lambda,\ell} + \eta} 
 = 
 16 \frac{\sigma^2}{n} \int_{0^-}^\infty  
 \frac{ \min(1,\lambda ^{-s}) }{ \min(1,\lambda ^{-s}) + \eta} dN(\lambda; G)\\
 & \le  16 \frac{\sigma^2}{n} N(1; G) 
 +  16 \frac{\sigma^2}{n} \int_{1}^\infty 
 \frac{ \lambda ^{-s} }{ \lambda ^{-s} + \eta} dN(\lambda; G) \\
 & = 16 \frac{\sigma^2}{n} N(1; G) 
 +  16 \frac{\sigma^2}{n} \int_{1}^\infty 
 \frac{ 1 }{1+ \eta \lambda^s} dN(\lambda; G) \\
 & \overset{(a)}{=}  16 \frac{\sigma^2}{n} N(1; G) 
+16 \frac{\sigma^2}{n}\lim_{\lambda \to \infty}  \Big ( \frac{ N(\lambda; G)}{1+ \eta \lambda^s} \Big) - 16 \frac{\sigma^2}{n} \frac{ N(1; G) }{1+ \eta} \\
& +  16 \frac{\sigma^2}{n} \int_{1}^\infty 
N(\lambda; G) \frac{ s\eta \lambda^{s-1}}{(1+ \eta \lambda^s)^2} d\lambda \\
& \overset{(b)}{=}  16 \frac{\sigma^2}{n} \frac{\eta}{1+\eta}N(1; G) 
+  16 \frac{\sigma^2}{n} \int_{1}^\infty 
N(\lambda; G) \frac{ s\eta \lambda^{s-1}}{(1+ \eta \lambda^s)^2} d\lambda \\
& \overset{(c)}{=}  16 \frac{\sigma^2}{n} \frac{\eta}{1+\eta}N(1; G) 
+  16 \frac{\sigma^2}{n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) s\eta  \int_{1}^\infty 
 \lambda^{d/2} \frac{  \lambda^{s-1}}{(1+ \eta \lambda^s)^2} d\lambda \\
  & +  16 \frac{\sigma^2}{n} C_{\calM/ G} s\eta  \int_{1}^\infty 
  \lambda^{(d-1)/2} \frac{ \lambda^{s-1}}{(1+ \eta \lambda^s)^2} d\lambda \\
  & \le 16 \frac{\sigma^2}{n} \eta N(1; G) 
+  16 \frac{\sigma^2}{n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) s\eta  \int_{1}^\infty 
 \frac{  \lambda^{d/2+s-1}}{1+ \eta^2 \lambda^{2s}} d\lambda \\
  & +  16 \frac{\sigma^2}{n} C_{\calM/ G} s\eta  \int_{1}^\infty 
 \frac{ \lambda^{(d-1)/2+s-1}}{1+ \eta^2 \lambda^{2s}} d\lambda, 
\end{align}
where (a) follows by integration by parts, (b) follows by $\lim_{\lambda \to \infty}  \Big ( \frac{ N(\lambda; G)}{1+ \eta \lambda^s} \Big) =0$ since $s > d/2$, and (c) follows from Theorem \ref{thrm_dim}. By a change of variable in the integrals as $t = \lambda \eta^{1/s}$, we have 
\begin{align}
 \int_{1}^\infty 
 \frac{  \lambda^{d/2+s-1}}{1+ \eta^2 \lambda^{2s}} d\lambda & = \eta^{\frac{-1}{s}(s+d/2-1)} \eta^{-1/s}  \int_{1}^\infty  \frac{  t^{d/2+s-1}}{1+  t^{2s}} dt  \le \frac{\eta^{\frac{-1}{s}(s+d/2)}}{2s-d} .
 \end{align}
We can similarly evaluate the other integral and conclude
\begin{align}
16 \frac{\sigma^2}{n}  \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }
 &\frac{\mu_{\lambda, \ell}}{\mu_{\lambda,\ell} + \eta} 
   \le 16 \frac{\sigma^2}{n} \eta N(1; G) \\
&+  16 \frac{s\sigma^2}{(2s-d)n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)  
 \eta^{1-\frac{1}{s}(s+d/2)}\\
  & +  16 \frac{s \sigma^2}{(2s-d+1)n} C_{\calM/ G}  
  \eta^{1-\frac{1}{s}(s+(d-1)/2)}.
  \end{align}
One can also use the bound $N(1; G) \le  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) + C_{\calM/G}$ to simplify the upper bound.













Note that $f^\star_{\proj} = f^\star$ since the closure of $\calH^s_{\inv}(\calM)$ with respect to the $L^2(\calM)-$norm is the whole space $L_{\inv}^2(\calM, G)$. 
Let us now analyze the bias term by noting that $\mu_{\lambda,\ell} + \eta \ge \mu_{\lambda,\ell}^{\theta} \eta^{1-\theta}$ for any $\theta \in (0,1]$, and thus
 \begin{align}
16 \eta\sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
\Big (\frac{1}{\mu_{\lambda, \ell} + \eta }\Big )&
\langle f^\star, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}
\\&\le
16 \eta^{\theta} \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) } 
\mu_{\lambda,\ell}^{-\theta} 
\langle f^\star, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)}
\\&  =  16 \eta^{\theta} 
  \sum_{\lambda \in \Spec(\calM) } \sum_{\ell=1}^{  \dim(V_{\lambda,G}) }  \max(1,\lambda ^{s\theta})
\langle f^\star, \phi_{\lambda,\ell} \rangle^2_{L^2(\calM)} 
\\& = 16 \eta^{\theta} \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)}.
 \end{align}
 where $\theta \in (0,1]$ is chosen so that $f^\star  \in {\calH^{s\theta}_{\inv}(\calM)}$. 
Therefore,  
\begin{align}
   \E [ \calR(\hat{f})  - \calR(f^\star) ] 
 &\le 
  16 \frac{\sigma^2}{n} \eta \big(\frac{\omega_d}{(2\pi)^d} \vol(\calM / G) + C_{\calM/G}\big) \\
&+  16 \frac{s\sigma^2}{(2s-d)n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)  
 \eta^{1-\frac{1}{s}(s+d/2)}  \\
  & +  16 \frac{s \sigma^2}{(2s-d+1)n} C_{\calM/ G}  
  \eta^{1-\frac{1}{s}(s+(d-1)/2)}  
 \\& + 16 \eta^{\theta} \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)}
+ \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)},
 \end{align}
The result is only true when  $R < \infty$ and $\eta \ge \frac{5R^2\log(n)}{n}$, where $R$ is defined in Equation (\ref{R_equation}). 
 
 

 We can now optimize the above bound for $\eta$. First consider the function $p(t) = c_at^{-a} + c_bt^b$ on $\R_{\ge 0}$ for $a,b,c_a,c_b>0$. Note that $p(0) = p(\infty) = \infty$, and to find its stationary points, we solve $p'(t) = 0$ and get the only solution $t = (\frac{ac_a}{bc_b})^{1/(a+b)}$ which is thus the global minimum of the function. Thus by minimizing 
 \begin{align}
 p(\eta)&= \Big (16 \frac{s\sigma^2}{(2s-d)n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)  \Big ) \eta^{-\frac{d}{2s}} 
 + \Big ( 16  \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)} \Big ) \eta^{\theta},
 \end{align}
 we get 
 \begin{align}
 \eta =  \Big (\frac{d\sigma^2}{2\theta  \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)}(2s-d) n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)\Big )^{s/(\theta s +d/2)}.
 \end{align}
Therefore, the population risk is bounded as follows:
 \begin{align}
   \E [ &\calR(\hat{f})  -  \calR(f^\star) ] \\
& \le 
 \underbrace{ 
 16\big(\frac{\omega_d}{(2\pi)^d} \vol(\calM / G) + C_{\calM/G}\big) \frac{\sigma^2}{n} \Big (\frac{d\sigma^2}{2\theta  \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)}(2s-d) n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)\Big )^{s/(\theta s +d/2)}
 }_{\calO(n^{-1- s/(\theta s +d/2)})}
 \\
&+    
\underbrace{
 16 \frac{s \sigma^2}{(2s-d+1)n} C_{\calM/ G} 
\Big (\frac{d\sigma^2}{2\theta  \| f^\star \|^2_{\calH^{s\theta}_{\inv}(\calM)} (2s-d)n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G)  
 \Big )^{-(d-1)/(2\theta s +d)}
  }_{\calO(n^{-(\theta s+1/2)/(\theta s +d/2)})}
 \\& + 
 \underbrace{
 32\Big (\frac{d\sigma^2}{2\theta (2s-d)n}  \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big  
)^{\theta s/(\theta s +d/2)} \| f^\star \|^{d/(\theta s + d/2)}_{\calH^{s\theta}_{\inv}(\calM)}
 }_{\calO(n^{-\theta s/(\theta s +d/2)})}
  \\& +
  \underbrace{
  \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)}
   }_{\calO(1/n^2)}, 
 \end{align}
 and this completes the proof since $s = \frac{d}{2}(\kappa+1)$ and the third term dominates the sum.
% Note that in the asymptotic analysis, the above bound for a large sample size  becomes
%  \begin{align}
%  \E [ \calR(\hat{f})  -  \calR(f^\star) ] 
%  \le 32 & \Big (\frac{d}{2\theta (2s-d)}  \frac{\omega_d}{(2\pi)^d} \frac{\sigma^2 \vol(\calM / G)}{n} \Big  
%)^{\theta s/(\theta s +d/2)} \| f^\star \|^{d/(\theta s + d/2)}_{\calH^{s\theta}_{\inv}(\calM)}
%\\
%&+ {\calO(n^{-(\theta s+1/2)/(\theta s +d/2)})}.
% \end{align}
 

\section{Proofs of Theorem \ref{thrm_finite}, Proposition \ref{prop_finite_energy}, and Corollary \ref{cor_finite}}

Corollary \ref{cor_finite} follows from Theorem \ref{thrm_finite} on the dimension of the vector space $\calH_G$, just according to standard bounds in the literature on the population risk of KRR for finite-rank kernels (see \cite{wainwright2019high}). Therefore, we focus on the proof of Theorem \ref{thrm_finite} and Proposition \ref{prop_finite_energy}. 




% The Dirichlet form $\calE$ is a bilinear form defined as  
% \begin{align}
% \calE(f,g):= \int_\calM \langle \nabla_g \phi(x), \nabla_g \psi(x) \rangle_g d\text{vol}_g(x),
% \end{align} 
% for any two smooth functions $\phi,\psi:\calM \to \R$. It can be easily extended (continuously) to any Sobolev space $\calH^s(\calM)$, $s\ge 1$. For each $f\in \calH^s(\calM)$, the diagonal quantity $\calE(f,f)$ is called the Dirichlet energy of the function. 
% Dirichlet energy is a way to measure the "complexity" of a function. Functions with low Dirichlet energy have little fluctuation; intuitively, those have low (normalized) Lipschitz constants on average. Indeed, since $\calE(af,af) = |a|^2 \calE(f,f)$, it is more accurate to restrict to the case $\|f\|_{L^2(\calM)}=1$ while studying low-energy functions.  


% Let us introduce a finite-dimensional $G-$invariant kernel $K$ generating the space of low-energy functions as follows:
% \begin{align}
% K (x,y) = \sum_{\ell=0}^{D-1} \phi_\ell(x)\phi_\ell(y),
% \end{align}
% for any $x,y \in \calM$ (the eigenfunctions are sorted according to what is presented in Appendix \ref{prelim_kernel_inv}).
%  Clearly, $K$ is a kernel of dimension $D$, and it is diagonal in the basis of the Laplace-Beltrami operator eigenfunctions. The RKHS of $K_D$ is also of finite dimension $D$ and can be written as
% \begin{align}
% \calH_G: = \Big \{
% f \in L^2(\calM) :  f = \sum_{\ell=0}^{D-1} \langle 
% f, \phi_\ell
% \rangle_{L^2(\calM)}
% \phi_\ell 
% \Big \} \subseteq L^2_{\inv}(\calM,G),
% \end{align}
% thus $D = \dim(\calH_G)$. 
% One can also use $\calE(f,f)$ to define a complexity measure for vector spaces of functions. Indeed, for any $D-$dimensional vector space $V \subseteq L^2_{\inv}(\calM,G)$, define
% \begin{align}
% \calL(V):= \max \Big \{ \calE(f,f): \|f\|_{L^2(\calM)}\le 1 \Big\}.
% \end{align} 
% For a vector space $V$, larger $\calL(V)$ corresponds to having functions with more (normalized) fluctuation. 

% \begin{proposition} For any $D-$dimensional vector space $V \subseteq L^2_{\inv}(\calM,G)$, 
% \begin{align} 
% \calL(V) \ge \lambda_{D-1},
% \end{align}
% and the equality is only achieved when $V = \calH_G$ with $D = \dim(\calH_G)$.
% \end{proposition}






\begin{proof}[Proof of Proposition \ref{prop_finite_energy}]
This is a classical result; one can use a variational method to prove it. See \cite{chavel1984eigenvalues} for the proof for an arbitrary vector space $V$. Here, we prove it for $V = \calH_G$. 
Consider an arbitrary $ f = \sum_{\ell=0}^{D-1} \langle 
f, \phi_\ell
\rangle_{L^2(\calM)}
\phi_\ell \in  \calH_G$. Then, using Equation (\ref{equation_grad}), 
\begin{align}
\calE(f,f) &= \int_\calM | \nabla_g f(x)|_g^2 d\textit{\emph {vol}}_g(x)\\
&= \sum_{\ell=0}^{D-1} \lambda_\ell | \langle f, \phi_\ell \rangle_{L^2(\calM)} |^2\\
& \le   \lambda_{D-1} \sum_{\ell=0}^{D-1}  \langle f, \phi_\ell \rangle_{L^2(\calM)}^2 \\
& =  \lambda_{D-1} \|f \|^2_{L^2(\calM)},
\end{align}
and the bound is achieved by $f = \phi_{D-1}$. 
\end{proof}
 
 Now by Theorem \ref{thrm_dim}, the proof of Theorem \ref{thrm_finite} is also complete.
% 
% In the above function space, the parameter $L$ controls the average fluctuation of the function $f$, and it is closely related to the Lipschitz constant of the function. 
%While the sample complexity of learning functions with low energy depends on $L$,  by the identity $L = \sqrt{\lambda^{D-1}}$, it is also related to the dimension of the space of eigenfunctions with low eigenvalue. Fortunately, using the dimension counting theorems proved in the paper, we can observe the gain of invariance in learning functions with low energy via a closed-form formula.  
 
 
% \begin{proposition}\label{prop_finite}
% Consider the $D-$dimensional RKHS of the functions with low Dirichlet energy $\calH_G$ such that 
% \begin{align}
% \calE(f,f)= \int_\calM | \nabla_g f(x)|_g^2 d\textit{\emph {vol}}_g(x) \le L^2 \|f \|^2_{L^2(\calM)},
% \end{align}
% for any $f \in \calH_G$,  for a given constant $L$. Then, the risk of the KRR problem with the finite-dimensional kernel $K_D$ satisfies the following convergence rate:
%    \begin{align}
%   \E [ \calR(\hat{f})  - \calR(f^\star_{\proj})] \le &
% 16 \frac{\sigma^2}{n}( \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) L^d + C_{\calM / G}L^{d-1}) 
% \\
% &+ \frac{80( \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) L^d + C_{\calM / G} L^{d-1})\log(n)}{n} \| f^\star_{\proj} \|^2_{L^2(\calM)}
% \\&+ \frac{24}{n^2} \|f^\star \|^2_{L^{\infty}(\calM)}. 
% \end{align}
%  \end{proposition}
% 
% \begin{remark}
% Note that for large $n,L$ the bound becomes
% \begin{align}
%   \E [ \calR(\hat{f})  - \calR(f^\star_{\proj})] \le \frac{80\omega_d \vol(\calM / G) }{(2\pi)^d} \frac{L^d \log(n)}{n}\| f^\star_{\proj} \|^2_{L^2(\calM)} +\calO \Big(\frac{L^d + L^{d-1}\log(n)}{n}\Big ).
% \end{align}
%  This completes the proof of Theorem \ref{thrm_finite}.
% \end{remark}
% 
% \begin{proof}[Proof of Proposition \ref{prop_finite}]
% We use the proven results on the convergence rate of finite dimensional kernels (Theorem \ref{thrm_appendix}). 
% 
% 
% 
% $N_x(\lambda;G)= \sum_{\lambda' \le \lambda}  \sum_{\ell=1}^{ \dim(V_{\lambda',G})}  |\phi_{\lambda',\ell}(x)|^2 \le  
% \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \lambda^{d/2} + C_{\calM / G}\lambda^{\frac{d-1}{2}}$ for an absolute constant $C_{\calM / G}$ and $d:= \dim(\calM) - \dim(G)$. 
%
% \end{proof}
% 
 
 
 \section{Proof of Theorem \ref{thrm_converse}}
In this section, we mostly use/follow standard results in the literature of minimax lower bounds which can be found in \cite{wainwright2019high}. 
 Note that the unit ball in the Sobolev space $\calH^{s}_{\inv}(\calM)$ is isomorphic to the following ellipsoid (see Appendix \ref{sobolev_kernel}):
 \begin{align}
 \calE: = \Big \{
 (\alpha_{\ell})_{\ell=0}^{\infty}: \sum_{\ell=0}^\infty \frac{|\alpha_{\ell}|^2}{\min(1,\lambda_{\ell}^{-s})} \le 1 
 \Big\} \subseteq \ell^2(\N). 
 \end{align}
 Note that the eigenvalues are distributed according to the bound proved in Theorem \ref{thrm_dim}.
Consider $M$ functions/sequences $f_1,f_2,\ldots,f_M \in \calE$ such that $\|f_i - f_j\|_{\ell^2(\N)} \ge \delta$ for all $i\neq j$, for some $M$ and $\delta$ (to be set later). In other words, let $\{f_1,f_2,\ldots, f_M\}$ denote a $\delta-$packing of the set $\calE$ in the $\ell^2(\N)-$norm. 
 
 
   Consider a pair of random variables $(Z, J)$ as follows: first $J\in [M]:= \{1,2,\ldots,M\}$ and $x_i \in \calM$, $i =1,2\ldots,n,$ are chosen uniformly and independently at random, and then, $Z = (f_J(x_i) + \epsilon_i)_{i=1}^n \in \R^n$, where $\epsilon_i \sim  \calN(0,\sigma^2)$ are independent Gaussian variates.  Let $\pbb_j(.) = \pbb(.|J=j)$ denote the conditional law of $(Z,J)$, given the observation $J=j$.
 A straighforward computation shows that $D_{\text{KL}}(\pbb_i|| \pbb_j) = \frac{n}{2\sigma^2} \| f_i - f_j\|^2_{\ell^2(\N)} \ge \frac{n\delta}{2\sigma^2} $ for all $i,j \in [M]$.  
 
 According to Fano's method, one can get the minimax bound
   \begin{align}
\inf_{\hat{f}} \sup_{
\substack{f^\star \in \calH^{s}_{\inv}(\calM) \\ 
\|f^\star\|_{\calH^{s}_{\inv}(\calM)}=1}}
\E \Big [ \calR(\hat{f})  -  \calR(f^\star) \Big] 
  \ge \frac{1}{2}\delta^2,
  \end{align}
if  
$\log(M) \ge 2 I(Z;J) + 2\log(2)$. 
Using the Yang-Barron method  \cite{wainwright2019high}, this condition is satisfied if 
 \begin{align}
\epsilon^2 &\ge \log N_{\text{KL}}(\epsilon)\\
\log M &\ge 4\epsilon^2 + 2\log(2),
  \end{align}
  where $N_{\text{KL}}(\epsilon)$ denotes the $\epsilon-$covering number of  the space of distributions $\pbb(.|f)$ for some $f \in \calE$ (defined similarly  as  we have $\pbb(.|J=j) = \pbb(.|f = f_j)$), in the square-root KL-divergence. However, since $D_{\text{KL}}(\pbb_f|| \pbb_g) = \frac{n}{2\sigma^2} \| f - g\|^2_{\ell^2(\N)}$, this equals to the $\epsilon-$covering of the space $\calE$  in the $\ell^2(\N)-$norm. In other words, we have 
  \begin{align}
  N_{\text{KL}}(\epsilon)  = N_{\ell^2(\N)}\Big (\frac{\epsilon \sigma \sqrt{2}}{\sqrt{n}}\Big). 
  \end{align}
  Now note that, for any $M$ such that $\log M \ge \log N_{\ell^2(\N)}(\delta)$, there exists  a $\delta-$packing of the space $\calE$  in the $\ell^2(\N)-$norm (see the packing and covering numbers relationship \cite{wainwright2019high}). 
  
  In summary, we get the minimax rate of $\frac{1}{2}\delta^2$ if the following inequalities are satisfied:
   \begin{align}
\epsilon^2 &\ge \log N_{\ell^2(\N)}\Big (\frac{\epsilon \sigma \sqrt{2}}{\sqrt{n}}\Big)\\
\log  N_{\ell^2(\N)}(\delta) &\ge 4\epsilon^2 + 2\log(2),
  \end{align}
  for some pair $(\epsilon,\delta)$.
  Thus, our goal is to obtain tight lower/upper bounds for $\log N_{\ell^2(\N)}(.)$. 
  
  \begin{lemma}\label{lemma_covering} 
  For any positive $\zeta$,
  \begin{align}
  \log N_{\ell^2(\N)}(\zeta/2) &\ge N( \zeta^{\frac{-2}{s}}; G) \log (2) \\
  \log N_{\ell^2(\N)}(\sqrt{2}\zeta) &\le   N( \zeta^{\frac{-2}{s}}; G)(s/d +\log (4)) +  \calO(\zeta^{-\frac{d-1}{s}}),
  \end{align}
where the quantity $N( \zeta^{\frac{-2}{s}}; G)$ is defined in Theorem \ref{thrm_dim}.
  \end{lemma}
  First, let us show how the above lemma concludes the proof of Theorem \ref{thrm_converse}. According to the lemma, we just need to check the following inequalities:
  \begin{align}
\epsilon^2 &\ge  (s/d +\log (4)) \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) {\Big (\frac{\epsilon \sigma}{\sqrt{n}}\Big )}^{-d/s} + \calO(n^{-\frac{d-1}{2s}})\\
N( (2\delta)^{\frac{-2}{s}}; G) \log (2)&\ge 4\epsilon^2 + 2\log(2).
  \end{align}
  Without loss of generality, let us discard the big-O error terms in the above analysis. In our final adjustment, we can add a constant multiplicative factor to ensure that the bound is asymptotically valid.  To get the largest possible $\delta$, we set
   \begin{align}
\epsilon^2 =  (s/d +\log (4)) \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) {\Big (\frac{\epsilon \sigma}{\sqrt{n}}\Big )}^{-d/s},
  \end{align}
  and thus
  \begin{align}
\epsilon^2 =  \Big ((s/d +\log (4)) \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big )^{s/(s+d/2)} \times 
{\Big (\frac{ \sigma^2}{n}\Big )}^{-d/(s+d/2)}.
  \end{align}
  Therefore, the following inequality needs to be satisfied:
    \begin{align}
N( (2\delta)^{\frac{-2}{s}}; G) \log (2)&\ge 2\log(2)+ 4\Big ((s/d +\log (4)) \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big )^{s/(s+d/2)}  
{\Big (\frac{ \sigma^2}{n}\Big )}^{-d/(s+d/2)}.
  \end{align}
  Using asymptotic analysis, the inequality holds when
    \begin{align}
 \frac{\log (2)\omega_d}{(2\pi)^d} \vol(\calM / G) {(2\delta )}^{-d/s} 
&\ge 4\Big ((s/d +\log (4)) \frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \Big )^{s/(s+d/2)}  
{\Big (\frac{ \sigma^2}{n}\Big )}^{-d/(s+d/2)}.
  \end{align}
  Rearranging the terms shows that
  \begin{align}
 4\delta^2 \le 
  \Big (  \frac{\omega_d}{(2\pi)^d} \frac{\sigma^2 \vol(\calM / G)}{n}\Big)^{s/(s+d/2)}
  \times \underbrace{
  \Big ( \frac{4}{\log(2)   \big(s/d+2\log(2)\big)^{-s/(s+d/2)}   } \Big)^{-2s/d}}_{:=8C_{\kappa}},
  \end{align}
  where $C_{\kappa}$ only depends on $\kappa = 2s/d-1$. Since this gives a minimax lower bound of $\frac{1}{2}\delta^2$, the proof is complete.
  
  
  
  
  
The rest of this section is devoted to the proof of Lemma \ref{lemma_covering}. 
  \begin{proof}[Proof of Lemma \ref{lemma_covering}]
  Define the following truncated ellipsoid:
   \begin{align}
 \tilde{\calE}: = \Big \{
 (\alpha_{\ell})_{\ell=0}^{\infty} \in \calE: \forall \ell \ge {\Delta+1}: ~ \alpha_\ell = 0 
 \Big\} \subseteq \calE, 
 \end{align}
 where $\Delta$ is a parameter defined as 
 \begin{align}
 \Delta := \max \Big \{ \ell : \lambda_{\ell} \le \zeta^{\frac{-2}{s}}  \Big\} = N( \zeta^{\frac{-2}{s}}; G).
 \end{align}
 Note that  $\sum_{\ell=\Delta+1}^\infty |\alpha_\ell|^2 \le \zeta^2$ for all $(\alpha_{\ell})_{\ell=0}^{\infty} \in \calE$. 



To construct a $\zeta/2-$covering set, note that according to the definition of the truncated ellipsoid, $\calB_{\Delta}(\zeta)\subseteq \tilde{\calE} \subseteq \calE$, where $\calB_{\Delta}(\zeta)$ denotes the ball with radius $\zeta$ (in $\ell^2-$norm) is the Euclidean space of dimension $\Delta$. Using standard bounds in the literature \cite{wainwright2019high}, we get
\begin{align}
\log N_{\ell^2(\N)}(\zeta/2) \ge \Delta \log (2). 
\end{align}
To get the upper bound on the $\sqrt{2}\zeta-$covering number, using an argument based on the volume of the ellipsoid $\tilde{\calE}$ \cite{wainwright2019high}, we conclude
\begin{align}
\log N_{\ell^2(\N)}(\sqrt{2}\zeta) &\le \Delta \log (4/\zeta) + \frac{1}{2}\sum_{\ell=0}^\Delta \log (\lambda_\ell^{-s}) \\
& = \Delta \log (4/\zeta) 
- \frac{s}{2}\sum_{\ell=0}^\Delta \log (\lambda_\ell) \\
& = \Delta \log (4/\zeta) 
- \frac{s}{2} \int_1^{\zeta^{\frac{-2}{s}}} \log(t)dN(t;G) \\
&= \Delta \log (4/\zeta)
 - \frac{s}{2} \log(\zeta^{\frac{-2}{s}}) N(\zeta^{\frac{-2}{s}};G)
+ \frac{s}{2} \int_1^{\zeta^{\frac{-2}{s}}}N(t;G)\frac{dt}{t} \\
&= \Delta \log (4)
+ \frac{s}{2} \int_1^{\zeta^{\frac{-2}{s}}}N(t;G)\frac{dt}{t}.
\end{align} 
By Theorem \ref{thrm_dim},  
\begin{align}
\int_1^{\zeta^{\frac{-2}{s}}}N(t;G)\frac{dt}{t} &\le  \frac{2}{d}
N({\zeta^{\frac{-2}{s}}};G) + \calO(\zeta^{-\frac{d-1}{s}})\\
& = \frac{2}{d} 
\frac{\omega_d}{(2\pi)^d} \vol(\calM / G) \zeta^{-d/s} + \calO(\zeta^{-\frac{d-1}{s}}).
\end{align}
Therefore,
\begin{align}
\log N_{\ell^2(\N)}(\sqrt{2}\zeta) &\le  \Delta (s/d +\log (4)) +  \calO(\zeta^{-\frac{d-1}{s}}).
\end{align} 
  \end{proof}
  

\end{document}

