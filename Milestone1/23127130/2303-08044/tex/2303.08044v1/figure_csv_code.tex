\begin{figure}[t]%
\begin{code}
sCSV x_1 = Symbol nt matcher evaluator
  where   
    nt = App "CSV" [id_smb x_1]
    matcher l (c,cf) = descend (nt,l) (c,cf) (c_0 l l . c_4 l l)
     where  
      c_0 k r = continue (s_0,l,k,r) (match_smb (sCSV x_1) r ((s_1,l),c_1)) 
      c_1 k r = continue (s_1,l,k,r) (match_smb sCom r ((s_2,l),c_2)) 
      c_2 k r = continue (s_2,l,k,r) (match_smb (sCSV x_1) r ((s_3,l),c_3)) 
      c_3 k r = continue (s_3,l,k,r) (ascend (nt,l) r) 
      c_4 k r = continue (s_4,l,k,r) (match_smb x_1 r ((s_5,l),c_5))
      c_5 k r = continue (s_5,l,k r) (ascend (nt,l) r) 
    s_0 = (nt,[],[id_smb (sCSV x_1),id_smb sCom,id_smb (sCSV x_1)])
    s_1 = (nt,[id_smb (sCSV x_1)],[id_smb sCom,id_smb (sCSV x_1)])
    s_2 = (nt,[id_smb (sCSV x_1),id_smb sCom],[id_smb (sCSV x_1)])
    s_3 = (nt,[id_smb (sCSV x_1),id_smb sCom,id_smb (sCSV x_1)],[])
    s_4 = (nt,[],[id_smb x_1])
    s_5 = (nt,[id_smb x_1],[])
    evaluator inp bsrs l r nts   | nt `member` nts   = []
                                 | otherwise         = res
     where   
      nts' p q   | l /= p || r /= q  = empty
                 | otherwise         = insert nt nts
      res =  [   sv_1 ++ sv_3 -- semantic action of first alternate
             |   p_3   <- pivots (s_3,l,r) bsrs
             ,   p_2   <- pivots (s_2,l,p_3) bsrs
             ,   p_1   <- pivots (s_1,l,p_2) bsrs -- |p_1 == l|
             ,   sv_3  <- eval_smb (sCSV x_1) inp bsrs p_3 r (nts' p_3 r)
             ,   sv_2  <- eval_smb sCom inp bsrs p_2 p_3 (nts' p_2 p_3)
             ,   sv_1  <- eval_smb (sCSV x_1) inp bsrs l p_2 (nts' l p_2)
             ]   ++ 
             [   [sv_1] -- semantic action of second alternate
             ,   p_1   <- pivots (s_5,l,r) bsrs -- |p_1 == l|
             |   sv_1  <- eval_smb x_1 inp bsrs l r (nts' l r) ]
\end{code}%
\caption{Code generated by the GLL back-end for the production of Figure~\ref{fig_csv}. |sCom| is the |Symbol| for token |','|.}%
\label{fig_csv_code}%
\end{figure}%
