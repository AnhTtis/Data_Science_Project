
    \begin{tikzpicture}[font=\fontsize{8}{8}\selectfont]
        \tikzstyle{block} = [
            thick,
            inner sep=2pt,
            rectangle, 
            rounded corners=2, 
            blur shadow={
                shadow blur steps=5, 
                shadow xshift=1pt, 
                shadow yshift=-1pt
            },
            align=center,
            draw=black!40, 
        	fill=black!15,
        ]

        \def\xs{180pt}
        \def\ys{200pt}
        \def\lw{1pt}
        
        \begin{scope}[x=\xs, y=\ys]
            \def\s{.06 * \xs}
            \tikzstyle{data} = [block, minimum size=\s]
            \tikzstyle{queue} = [block, minimum width=.1 * \xs, minimum height=\s]
            \tikzstyle{disc} = [block, minimum width=.1 * \xs, minimum height=2 * \s, draw=pg!50!black!75, fill=pg!35]
            \tikzstyle{batchHead} = [block, minimum width=.12 * \xs, minimum height=1.5 * \s, draw=b2!50!black!75, fill=b2!35]
            \tikzstyle{batchHeadDetail} = [block, draw=b2!50!black!75, fill=b2!35]
            \tikzstyle{concat} = [block, circle, inner sep=.005 * \xs]
            \tikzstyle{conv} = [block, minimum width=.1 * \xs, minimum height=\s, draw=pg!50!black!75, fill=pg!35]
            \tikzstyle{activ} = [block, minimum width=.1 * \xs, minimum height=\s, draw=or!50!black!75, fill=or!35]
            \tikzstyle{batchStats} = [block, minimum width=.1 * \xs, minimum height=\s, draw=pr!50!black!75, fill=pr!35]
            \tikzstyle{flow} = [-{Latex[length=1.5mm,width=1.5mm]}, rounded corners, line width=\lw]
    

            \node[disc,align=center] (disc) at (0, 0) {discriminator\\(PatchGAN)};
            \node[data, anchor=east, fill=white] (x) at ([xshift=-\s]disc.west) {$x$};
            \node[inner sep=0, anchor=south, align=center] (xlabel) at ([yshift=.3 * \s]x.north) {a single\\image};
            \node[data, anchor=south] (z) at ([yshift=\s]disc.north) {$z$};
            \node[concat, anchor=south] (p) at ([yshift=\s]z.north) {$\oplus$};
            \node[queue, anchor=west] (zq) at ([xshift=1.5 * \s]p.east) {$z$ cache};
            \node[batchHead, anchor=south] (bh) at ([yshift=\s]p.north) {batch head};
            \node[inner sep=0, align=center, anchor=south east] (plabel) at (zq.east |- z.south) {concatenate\\along batch};
            \node[data, anchor=south] (y) at ([yshift=\s]bh.north) {$y$};
            
            \draw[flow] (x) -- (disc);
            \draw[flow] (disc) -- (z);
            \draw[flow] (z) -- (p);
            \draw[flow] (zq) -- (p);
            \draw[flow] (p) -- (bh);
            \draw[flow] (bh) -- (y);

            \node[batchHeadDetail, anchor=north west, inner sep=4pt] (bhd) at ($(bh.north west)!3!(bh.north east)$) {
                \begin{tikzpicture}
                    \def\yshift{.01 * \xs}
                    \node[batchStats] (bs) at (0, 0) {batch stats.};
                    \node[conv, anchor=south] (conv1) at ([yshift=\yshift]bs.north) {Conv $3\times 3$};
                    \node[activ, anchor=south] (activ) at ([yshift=\yshift]conv1.north) {ReLU};
                    \node[conv, anchor=south] (conv2) at ([yshift=\yshift]activ.north) {Conv $3\times 3$};
                    \node[inner sep=0, anchor=south] (label) at ([yshift=2 * \yshift]conv2.north) {batch head};
                \end{tikzpicture}
            };
            \def\op{.5}
            \node[queue, anchor=north, opacity=\op, blur shadow={shadow opacity=.2}] (bh_input) at ([yshift=-\s]bhd.south) {$(z, z\textrm{ cache})$};
            \node[data, anchor=south, opacity=\op, blur shadow={shadow opacity=.2}] (bh_output) at ([yshift=\s]bhd.north) {$y$};
            \draw[flow, opacity=.3 * \op] (bh_input) -- (bhd);
            \draw[flow, opacity=.3 * \op] (bhd) -- (bh_output);

            \begin{pgfonlayer}{back}
                \draw[name path=U, white] (bh.south east) to[bend left=20] ([xshift=2pt, yshift=2pt]bhd.south west);
                \draw[name path=D, white] ([yshift=-2pt]bh.north east) -- ([yshift=-2pt]bhd.north west);
                \tikzfillbetween[of=U and D]{black!30, path fading=east, fill=b2!30}
            \end{pgfonlayer}
        \end{scope}
    \end{tikzpicture}
    % }
