\usepackage[noblocks]{authblk} %% Affiliations with superscripts (1,2,3)
\usepackage[numbers]{natbib}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage[colorlinks=true, linkcolor=MidnightBlue, urlcolor=MidnightBlue, citecolor=PineGreen]{hyperref}
\usepackage[tableposition=top, justification=justified, textfont=it]{caption}
\usepackage{titlesec}
\usepackage{multicol}
\usepackage{afterpage}
\usepackage{lipsum}
\usepackage[dvipsnames, x11names]{xcolor}
\usepackage[inner=4cm, outer=4cm, top=2.8cm, bottom=2.8cm, marginparsep=0cm, marginparwidth=0cm, includehead, includefoot]{geometry}
\usepackage{setspace}
\usepackage{array}
\usepackage{bm}
\usepackage{tikz}
\usepackage{float}
\usepackage[framemethod]{mdframed}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   T E M P L A T E
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Increase the head height
\setlength{\headheight}{15pt}%

% Section style
\titleformat{\section}{\Large \bfseries \centering \scshape}{\thesection.}{0.3em}{}[{\titlerule[0.5pt]}]

% Subsection style
\definecolor{shadecolor}{RGB}{230,230,230}
\newcommand{\mybox}[1]{\par\noindent\colorbox{shadecolor}
{\parbox{\dimexpr\textwidth-2\fboxsep\relax}{#1}}}

\titleformat{\subsection}{\large \bfseries \mybox}{\thesubsection}{1em}{}

% Subsubsection style
\titleformat{\subsubsection}{\itshape}{\thesubsubsection.}{0.3em}{}

% Abstract environment
\renewenvironment{abstract}
{\vskip 2.5ex {\large\bf\noindent Abstract}\vspace{0.7ex} \\ %
  \bgroup\noindent\ignorespaces}%
{\par\egroup\vskip 2.5ex}

% Keywords environment
\newenvironment{keywords}
{\bgroup\leftskip 20pt\rightskip 20pt \small\noindent{\bf Keywords:} }%
{\par\egroup\vskip 10ex}

% Define the page style for the first page
\fancypagestyle{firstpage}{%
  \renewcommand{\headrulewidth}{0pt}
  \fancyhead[]{}
  \fancyfoot[C]{}
%%% FOR PREPRINT
%%% TIP: overleaf block comment : Cmd+/ (Mac) Ctrl+/ (PC)
  \fancyfoot[L]{\footnotesize To appear in \\
  O. Colliot (Ed.), \textit{Machine Learning for Brain Disorders}, Springer\\
  }

%%% FOR POSTPRINT
%%% TIP: overleaf block comment : Cmd+/ (Mac) Ctrl+/ (PC)
%   \fancyfoot[L]{\footnotesize 
%   O. Colliot (Ed.), \textit{Machine Learning for Brain Disorders}, Springer\\
%   \url{https://doi.org/99999999999} %%%%%%% Enter DOI Here
%   }
%%% \fancyfoot[L]{\footnotesize \textit{Machine Learning for Brain Disorders (O. Colliot, ed.)  %\\ ISBN \\ DOI link }

}

% Define the page style for the other pages
\fancypagestyle{otherpages}{%
  \renewcommand{\headrulewidth}{0pt}
  \fancyhead[LE]{\thepage}
  \fancyhead[RE]{\runningauthor}
  \fancyhead[LO]{\runningheadtitle}
  \fancyhead[RO]{\thepage}
  \fancyfoot[L]{\footnotesize  \textit{Machine Learning for Brain Disorders}, Chapter~\chapternumber}
  \fancyfoot[C]{}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Change the layout of the title
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\thispagestyle{firstpage}

\renewcommand{\maketitle}{\bgroup\setlength{\parindent}{0pt}

% Chapter number
\begin{flushright}
  \color{MidnightBlue}
  \textbf{\LARGE Chapter~\chapternumber}
\end{flushright}

\vspace{0.3in}

% Title, authors and affiliations
\begin{flushleft}
    \setstretch{2.0} %% allows a nicer formatting of the title by adding more space between lines
    \textbf{\color{MidnightBlue}\huge\@title}
\end{flushleft}

\vspace{0.15in}

\begin{flushleft}
    \textbf{\bfseries \large\@author}
\end{flushleft}\egroup
}

\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Change the font for the author names and their affiliations
\renewcommand\Authfont{\bfseries}
\renewcommand\Affilfont{\normalfont\small}

% Change the layout of captions for figures and tables
\DeclareCaptionLabelFormat{labelformat}{\color{MidnightBlue}\bfseries #1 #2}
\captionsetup{labelformat=labelformat}

% Bibliography style (References section)
\renewcommand\bibsection{\subsection*{\refname}}
\renewcommand{\bibpreamble}{\scriptsize \begin{multicols}{2}}
\renewcommand{\bibpostamble}{\end{multicols}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Boxes
\mdfsetup{skipabove=\topskip, skipbelow=\topskip}

\newcounter{nicebox}
\newenvironment{nicebox}[1][]{%
    \refstepcounter{nicebox}%
    \ifstrempty{#1}%
    {\mdfsetup{%
        frametitle={%
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=blue!20]
            {\strut Theorem~\thetheo};}}
    }%
    {\mdfsetup{%
        frametitle={%
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=blue!20]
            {\strut Box~\thenicebox:~#1};}}%
    }%
    \mdfsetup{innertopmargin=10pt,linecolor=blue!20, linewidth=2pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    \begin{mdframed}[]\relax%
    }{\end{mdframed}}

\newfloat{floatbox}{thp}{lop}
\floatname{floatbox}{Box}
\newcommand{\niceboxautorefname}{Box}

% Math stuff
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\DeclareMathAlphabet{\mathsfit}{\encodingdefault}{\sfdefault}{m}{sl}
\SetMathAlphabet{\mathsfit}{bold}{\encodingdefault}{\sfdefault}{bx}{n}