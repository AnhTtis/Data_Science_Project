% \begin{algorithm}[H]
% \caption{\red{IMC training procedure}}
% \begin{algorithmic}[1]
%     \STATE \textbf{Require:} Data $\mathcal{D} = \{(\obs_n, \act_n)\}_{n=1}^N$
%     \STATE \textbf{Require:} Number of components $N_{\comp}$
%     \STATE \textbf{Require:} Curriculum pacing $\eta$
%     \WHILE{{$|\Delta L|\leq \epsilon$}}
%     \STATE Sample mini-batch $\mathcal{B} \subseteq \mathcal{D}$
%     \vspace{0.1cm}
%     \STATE $q(\comp|\obs_n, \act_n) \leftarrow \tilde{p}(\obs_n, \act_n|\comp) / \sum_{\comp} \tilde{p}(\obs_n, \act_n|\comp)$
%     \vspace{0.1cm}
%     \FOR{$z \leftarrow 1,...,N_{z}$}
%     \FOR{$i \leftarrow 1,...,|\mathcal{B}|$}
%         %
%     \vspace{0.1cm}
%     \STATE \small ${{R_{\comp}(\obs_n, \act_n)} \leftarrow\log p_{\vtheta_{\comp}}(\act_n|\obs_n,\comp) + \eta \log q(\comp|\obs_n, \act_n)}$
%     %
%     \vspace{0.1cm}
%     \STATE \small$\tilde{p}(\obs_n, \act_n|\comp) \leftarrow \exp \big({R_{\comp}(\obs_n, \act_n)}/{\eta}\big)$
%     %
%     \ENDFOR
%     % \vspace{0.1cm}
%     \STATE \small $\vtheta_{\comp}^* \leftarrow \argmax_{\vtheta_{\comp}} \sum_{i} \tilde{p}(\obs_n, \act_n|\comp) \log p_{\vtheta_{\comp}}(\act_n |\obs_n,\comp)$
%     % \vspace{0.1cm}
%     \ENDFOR
%     \ENDWHILE
%     \vspace{0.05cm}
%     % \State $\vphi^* \leftarrow \argmin_{\vphi}  \sum_n \sum_{\comp} \tilde{p}(\mathcal{D}_n|\comp) \log g_{\vphi}(\comp|\obs_n)$
% \end{algorithmic}
% \label{algo:imc_training}
% \end{algorithm}

% Batched version
\begin{algorithm}[H]
\caption{{IMC training procedure}}
\begin{algorithmic}[1]
    \STATE \textbf{Require:} Data $\mathcal{D} = \{(\obs_n, \act_n)\}_{n=1}^N$
    \STATE \textbf{Require:} Number of components $N_{\comp}$
    \STATE \textbf{Require:} Curriculum pacing $\eta$
    \WHILE{{$|\Delta L|\leq \epsilon$}}
    \STATE Perform E-step:
    \vspace{0.1cm}
    \STATE $q(\comp|\obs_n, \act_n) \leftarrow \tilde{p}(\obs_n, \act_n|\comp) / \sum_{\comp} \tilde{p}(\obs_n, \act_n|\comp) \ \forall n$
    \vspace{0.1cm}
    \FOR{$z \leftarrow 1,...,N_{z}$}
        %
    \STATE Perform M-step for curricula:
    \vspace{0.1cm}
    \STATE \small ${{R_{\comp}(\obs_n, \act_n)} \leftarrow\log p_{\vtheta_{\comp}}(\act_n|\obs_n,\comp) + \eta \log q(\comp|\obs_n, \act_n)} \ \forall n$
    %
    \vspace{0.1cm}
    \STATE \small$\tilde{p}(\obs_n, \act_n|\comp) \leftarrow \exp \big({R_{\comp}(\obs_n, \act_n)}/{\eta}\big) \ \forall n$
    \vspace{0.1cm}
    %
    % \vspace{0.1cm}
    \STATE Perform M-step for experts:
    \vspace{0.1cm}
    \STATE \small $\vtheta_{\comp}^* \leftarrow \argmax_{\vtheta_{\comp}} \sum_{n} \tilde{p}(\obs_n, \act_n|\comp) \log p_{\vtheta_{\comp}}(\act_n |\obs_n,\comp)$
    % \vspace{0.1cm}
    \ENDFOR
    \ENDWHILE
    \vspace{0.05cm}
    % \State $\vphi^* \leftarrow \argmin_{\vphi}  \sum_n \sum_{\comp} \tilde{p}(\mathcal{D}_n|\comp) \log g_{\vphi}(\comp|\obs_n)$
\end{algorithmic}
\label{algo:imc_training}
\end{algorithm}