\section{Proofs}
\label{appendix:proofs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Proof of Proposition \ref{thm:implicit}}
\label{proof:implicit}
Expanding the entropy in Equation \ref{eq:opt_mw} we obtain
\begin{equation*}
    p^*(o) \propto \exp\big( \E_{p^*(\mathcal{D}|o)}[{R_o(\mathcal{D})}/{\eta} - \log p^*(\mathcal{D}|o)] \big).
\end{equation*}
Using $p^*(\mathcal{D}|o) = \tilde{p}(\mathcal{D}|o)/ \sum_n \tilde{p}(\mathcal{D}_n|o)$ yields
\begin{align*}
    p^*(o) \propto & \exp\big( \E_{p^*(\mathcal{D}|o)}[{R_o(\mathcal{D})}/{\eta} - \log \tilde{p}(\mathcal{D}|o) \\ + & \log  \sum_n \tilde{p}(\mathcal{D}_n|o)] \big).
\end{align*}
Next, leveraging that $\log \tilde{p}(\mathcal{D}|o) = {R_o(\mathcal{D}_n)}/{\eta} $ we see that
\begin{equation*}
    p^*(o) \propto  \exp\big( \E_{p^*(\mathcal{D}|o)}[\log  \sum_n \tilde{p}(\mathcal{D}_n|o)] \big)
    =  \sum_n \tilde{p}(\mathcal{D}_n|o),
\end{equation*}
which concludes the proof. $\qed$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Proof of Corollary \ref{thm:lowerbound}}
\label{proof:lowerbound}
We start by rewriting the lower bound as $L(\vpsi, q) = $
\begin{align*}
    \E_{p^*(o)}\big[\E_{p^*(\mathcal{D}|o)}[R_o(\mathcal{D}) - \eta \log p^*(\mathcal{D}|o)]- \eta \log p^*(o)\big].
\end{align*}
Using $p^*(\mathcal{D}|o) \propto \tilde{p}(\mathcal{D}|o)$ and Proposition \ref{thm:implicit} we obtain
\begin{align*}
    L(\vpsi, q) = & \E_{p^*(o)}\big[\E_{p^*(\mathcal{D}|o)}[R_o(\mathcal{D}) - \eta \log \tilde{p}(\mathcal{D}|o) \\
    + & \eta \log  \sum_n \tilde{p}(\mathcal{D}_n|o) ] -\eta \log \sum_n \tilde{p}(\mathcal{D}_n|o) \\
    + &  \eta \log \sum_o \sum_n \tilde{p}(\mathcal{D}_n|o) \big]
\end{align*}
With $\eta \log \tilde{p}(\mathcal{D}|o) = {R_o(\mathcal{D}_n)}$ all most terms cancel, giving
\begin{align*}
    L(\vpsi, q) = & \E_{p^*(o)}\big[\eta \log \sum_o \sum_n \tilde{p}(\mathcal{D}_n|o)\big] \\ = & \eta \log \sum_o \sum_n \tilde{p}(\mathcal{D}_n|o),
\end{align*}
which concludes the proof. $\qed$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Proof of Corollary \ref{thm:gating}}
\label{proof:gating}
Expanding the expected KL divergence, we get 
\begin{align*}
    &\min_{\vphi} \E_{p({\mathcal{D}})}\KL\big(p(o|\mathcal{D})\Vert g_{\vphi}(o|\mathbf{x})\big) \\ = \ 
    & \min_{\vphi} \sum_n p({\mathcal{D}_n}) \sum_o p(o|\mathcal{D}_n) \log \frac{p(o|\mathcal{D}_n)}{g_{\vphi}(o|\mathbf{x}_n)}.
\end{align*}
Noting that $p(o|{\mathcal{D}_n})$ is independent of $\vphi$ we can rewrite the objective as
\begin{equation*}
    \max_{\vphi} \sum_n p({\mathcal{D}_n}) \sum_o p(o|\mathcal{D}_n) \log {g_{\vphi}(o|\mathbf{x}_n)}.
\end{equation*}
Using that $p(o|\mathcal{D}) = \tilde{p}(\mathcal{D}|o)/ \sum_o \tilde{p}(\mathcal{D}|o)$ together with $p({\mathcal{D}})=\sum_o p^*(o)p^*(\mathcal{D}|o)$ yields
\begin{align*}
    \max_{\vphi} \sum_n \sum_o p^*(o)p^*(\mathcal{D}_n|o) \sum_o \frac{\tilde{p}(\mathcal{D}_n|o)}{\sum_o\tilde{p}(\mathcal{D}_n|o)}  \log {g_{\vphi}(o|\mathbf{x}_n)}.
\end{align*}
Using Proposition \ref{thm:implicit} we can rewrite $p^*(o)p^*(\mathcal{D}|o)$ as $\tilde{p}(\mathcal{D}|o) / \sum_o \sum_n \tilde{p}(\mathcal{D}_n|o)$. Since the constant factor $1 / \sum_o \sum_n \tilde{p}(\mathcal{D}_n|o)$ does not affect the optimal value of $\vphi$ we obtain
\begin{align*}
    & \max_{\vphi} \sum_n \sum_o \tilde{p}(\mathcal{D}_n|o)   \sum_o \frac{\tilde{p}(\mathcal{D}_n|o)}{\sum_o\tilde{p}(\mathcal{D}_n|o)}  \log {g_{\vphi}(o|\mathbf{x}_n)} \\
    & \max_{\vphi} \sum_n   \sum_o {\tilde{p}(\mathcal{D}_n|o)}  \log {g_{\vphi}(o|\mathbf{x}_n)},
\end{align*}
which concludes the proof. $\qed$

%     \begin{align*}
%     &\min_{\vphi} \E_{p({\mathcal{D}})}\KL\big(p(o|\mathcal{D})\Vert g_{\vphi}(o|\mathbf{x})\big) \\ = \ 
%     & \max_{\vphi} \sum_n \sum_o \tilde{p}(\mathcal{D}_n|o) \log g_{\vphi}(o|\mathbf{x}_n).
% \end{align*}


% \begin{equation*}
%     p^*(o) \propto \exp\big( \E_{p(\mathcal{D}|o)}[{R_o(\mathcal{D})}/{\eta}] + \mathcal{H}(\mathcal{D}|o)\big),
% \end{equation*}
% and 
% \begin{equation*}
%     p^*(\mathcal{D}_n|o) \propto \tilde{p}(\mathcal{D}_n|o) = \exp\big( {R_o(\mathcal{D}_n)}/{\eta}\big),
% \end{equation*}