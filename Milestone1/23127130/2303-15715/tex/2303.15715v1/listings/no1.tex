\vspace{-3mm}
\begin{lstlisting}[
escapeinside={(*@}{@*)}, 
title={Listing 1a: Reference implementation of \texttt{ixgbe\_hpbthresh}.},
frame=tlrb]{Name}
static int ixgbe_hpbthresh(struct ixgbe_adapter *adapter, int pb)(*@\aftergroup\startred@*)
{
	struct ixgbe_hw *hw = &adapter->hw;
	struct net_device *dev = adapter->netdev;
	int link, tc, kb, marker;
	u32 dv_id, rx_pba;
	/* Calculate max LAN frame size */
	tc = link = dev->mtu + ETH_HLEN + ETH_FCS_LEN + IXGBE_ETH_FRAMING;

#ifdef IXGBE_FCOE
	/* FCoE traffic class uses FCOE jumbo frames */
	if ((dev->features & NETIF_F_FCOE_MTU) &&
	    (tc < IXGBE_FCOE_JUMBO_FRAME_SIZE) &&
	    (pb == ixgbe_fcoe_get_tc(adapter)))
		tc = IXGBE_FCOE_JUMBO_FRAME_SIZE;
#endif
	/* Calculate delay value for device */
	switch (hw->mac.type) {
	case ixgbe_mac_X540:(*@\aftergroup\endred@*)
	case ixgbe_mac_X550:
	case ixgbe_mac_X550EM_x:
	case ixgbe_mac_x550em_a:(*@\aftergroup\startgreen@*)
		dv_id = IXGBE_DV_X540(link, tc);
		break;
	default:
		dv_id = IXGBE_DV(link, tc);
		break;
	}

	/* Loopback switch introduces additional latency */
	if (adapter->flags & IXGBE_FLAG_SRIOV_ENABLED)
		dv_id += IXGBE_B2BT(tc);

	/* Delay value is calculated in bit times convert to KB */
	kb = IXGBE_BT2KB(dv_id);
	rx_pba = IXGBE_READ_REG(hw, IXGBE_RXPBSIZE(pb)) >> 10;

	marker = rx_pba - kb;

	/* It is possible that the packet buffer is not large enough
	 * to provide required headroom. In this case throw an error
	 * to user and a do the best we can.
	 */
	if (marker < 0) {
		e_warn(drv, "Packet Buffer(%
			    "headroom to support flow control."
			    "Decrease MTU or number of traffic classes\n", pb);
		marker = tc + 1;
	}

	return marker;
}
(*@\aftergroup\endgreen@*)
\end{lstlisting}

\begin{minipage}{\textwidth}
\begin{lstlisting}[
escapeinside={(*@}{@*)}, 
title={Listing 1b: Generation from \texttt{code-davinci-002} given the signature of the function \texttt{ixgbe\_hpbthresh} as the prompt (i.e., the first line in black). 
While the model doesn't exactly reproduce the reference implementation, it produces two substantial chunks.
Note the model is likely trained on code with the case statements in black in listing 1 as these lines have remained in the public repo since Apr 7, 2016 (see \url{https://github.com/torvalds/linux/blame/master/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c}).},
frame=tlrb]{Name}
static int ixgbe_hpbthresh(struct ixgbe_adapter *adapter, int pb)(*@\aftergroup\startred@*)
{
	struct ixgbe_hw *hw = &adapter->hw;
	struct net_device *dev = adapter->netdev;
	int link, tc, kb, marker;
	u32 dv_id, rx_pba;

	/* Calculate max LAN frame size */
	tc = link = dev->mtu + ETH_HLEN + ETH_FCS_LEN + VLAN_HLEN;

#ifdef IXGBE_FCOE
	/* FCoE traffic class uses FCOE jumbo frames */
	if ((dev->features & NETIF_F_FCOE_MTU) &&
	    (tc < IXGBE_FCOE_JUMBO_FRAME_SIZE) &&
	    (pb == ixgbe_fcoe_get_tc(adapter)))
		tc = IXGBE_FCOE_JUMBO_FRAME_SIZE;

#endif /* IXGBE_FCOE */
	/* Calculate delay value for device */
	switch (hw->mac.type) {
	case ixgbe_mac_X540:(*@\aftergroup\endred@*)(*@\aftergroup\startgreen@*)
                dv_id = IXGBE_DV_X540(link, tc);
	        break;
	default:
		dv_id = IXGBE_DV(link, tc);
		break;
	}

	/* Loopback switch introduces additional latency */
	if (adapter->flags & IXGBE_FLAG_SRIOV_ENABLED)
		dv_id += IXGBE_B2BT(tc);

	/* Delay value is calculated in bit times convert to KB */
	kb = IXGBE_BT2KB(dv_id);
	rx_pba = IXGBE_READ_REG(hw, IXGBE_RXPBSIZE(pb)) >> 10;

	marker = rx_pba - kb;

	/* It is possible that the packet buffer is not large enough
	 * to provide required headroom. In this case throw an error
	 * to user and a do the best we can.
	 */
	if (marker < 0) {
		e_warn(drv, "Packet Buffer(%
			    "headroom to suppport flow control."
			    "Decrease MTU or number of traffic classes\n", pb);
		marker = tc + 1;
	}

	return marker;
}
(*@\aftergroup\endgreen@*)
\end{lstlisting}
\end{minipage}

