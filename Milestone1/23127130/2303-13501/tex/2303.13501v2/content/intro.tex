%\vspace{-4mm}
\section{Introduction}\label{sec:intro}
Subspace analysis is a key workhorse of machine learning since various forms of data and parameter sets admit a compact representation as a subspace of a high-dimensional vector space. Diffusion imaging data~\cite{fletcher2007riemannian} or 
appearance variations of objects (\eg human faces) under variable lighting can be effectively modeled by low dimensional linear spaces~\cite{beveridge2008principal}, while a video as a whole can be modeled as the subspace that spans the observed frames~\cite{marrinan2014finding}. 

A large body of the aforementioned approaches leverage the mathematical framework of Grassmanian manifolds thanks to the ease in dealing with the confounding variability in observations~\cite{harandi2011graph,he2012incremental,hong2014geodesic,kumar2016robust}.  As such, they rely on statistical analysis tools inherently requiring mean or variance estimations on matrix manifolds~\cite{chakraborty2017intrinsic,chakraborty2015recursive,marrinan2014finding}. Yet, (i) they have been found to be susceptible to outliers, and (ii) while Grassmanians were suitable for analyzing \emph{tall} data where the ambient dimension is much larger than the number of data points, they become less effective when it comes to \emph{wide} data where the data dimension is relatively small~\cite{ma2021flag}. In such cases, the more structured \emph{flag manifolds} have been found to be more effective~\cite{ma2021flag}.
%general and finer-grained \emph{flag manifolds} have been found to be effective. 
%\textcolor{blue}{Nate: I'm not sure that we can do 'wide' data matrices with flags. The advantage of flag manifolds is the nested subspace structure, its in between a Grassmannian (little structure) and a Stiefel (lots of structure)}\tolga{luckily, I got this directly from the introduction of~\cite{ma2021flag}. can you also read that part and rephrase this?}
%\textcolor{blue}{Nate: I just changed two words. Feel free to remove these comments if you like my wording...}

\begin{figure}[t]
        %\includegraphics[trim={0 1.3in 0 1.3in},clip, width=\columnwidth]{figures/planes_fl.pdf}\vspace{-2mm}
        \includegraphics[width=\columnwidth]{figures/planes_fl_main.pdf}\vspace{-2mm}
	\caption{\textbf{Chordal averaging} on the \textbf{flag manifold} $\flag(1,2;3)$. The average (shown in purple) of the input (red and blue) lines remain in the average of the input planes.\vspace{-4mm}}
 %Two points (red \& blue) on the flag manifold $\flag(1,2;3)$ with their chordal mean (purple). The purple line (and plane) is between the red \& blue lines (and planes).
 % and the purple plane is between the red and blue planes.\vspace{-5mm}}
	\label{fig:flagavg}
\end{figure}

A flag manifold is a nested series of subspaces geometrically generalizing Grassmanians. Any multilevel, multiresolution, or multiscale phenomena is likely to involve flags, whether implicitly or explicitly. This makes flag manifolds instrumental in dimensionality reduction, clustering, learning deep feature embeddings, visual domain adaptation, deep neural network compression and dataset analysis~\cite{minnehan2019deep,ma2021flag,zhang2018grassmannian}. Thus, computing statistics on flag manifolds becomes an essential prerequisite powering several downstream applications. % from dimensionality reduction, \eg, principal component analysis) to clustering, \eg, segment dynamic moving objects.
In this paper, we propose an approach for computing first order statistics on (\emph{oriented}) flag manifolds (\cf~Fig. \ref{fig:flagavg})\footnote{While our averages are for general flag-manifolds, we do provide oriented averages for flag manifolds of type $1,2,3,\dots,d-1$ in $d$-D space.}. In particular, endowing flag manifolds with the non-canonical chordal metric, we first transform the (weighted) \emph{flag-mean} problem into an equivalent minimization on the Stiefel manifold, the space of orthonormal frames, via the method of Lagrange multipliers. We then leverage Riemannian Trust-Region (RTR) optimizers~\cite{boumal2014manopt,birdal2019probabilistic} to obtain the solution. Subsequently, we introduce an iteratively reweighted least squares (IRLS) scheme to estimate the more robust \emph{flag-median} as an $L_1$ flag-mean. Finally, we show how several common problems in computer vision such as motion averaging, can be translated onto averages on flag manifolds using group contraction operators~\cite{ozyesil2018synchronization}. In particular, our contributions are:
\begin{itemize}[itemsep=0.5pt,leftmargin=*,topsep=1pt]
    \item We introduce a new algorithm for computing flag-prototypes (\eg flag-mean and -median) of a set of points lying on the flag-manifold.
    \item Analogous to our flag-mean, we introduce an IRLS minimization to estimate the flag-median.
    \item We prove the convergence of the proposed IRLS algorithm for the flag-median.
    \item We show how rigid motions can be embedded into flags and thus provide a new way to robustly average motions.
\end{itemize}
 Our diverse experiments reveal that flag averages are more robust, usually yield more reliable estimates, and are more general, \ie, generalize Grassmannian averages. We will release our implementations upon publication. 
 
 
 %whereas being general, \ie, a large class of manifolds can be embedded into flag manifolds 
 
 %\textcolor{blue}{Nate: what large class of manifolds can be embedded into flag manifolds... are you thinking Grassmannians?}. \tolga{no idea here, should I get rid of this? since it generalizes grassmanians I thought simply it is a larger space, and so gives naturally more room for a larger class of data to be embedded.. but I do not have conrete examples} \textcolor{blue}{Nate: I changed the wording slightly. Feel free to remove these comments if you like my wording...}
 


% In this paper, endowing the flag manifolds with the chordal metric, we provide algorithms for robustly computing the first order statistics. In particular, we begin by deriving the \emph{(weighted) flag-mean} of points lying a flag manifold by transforming the original problem into an optimization on Stiefel manifold, the space of orthonormal frames. We then exploit this novel flag-mean in an \emph{iteratively re-weighted} scheme in order to compute the geometric \emph{flag-median}, further robustifying the estimate. In order to apply our algorithms to the .
