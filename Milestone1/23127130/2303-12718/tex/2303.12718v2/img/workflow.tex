% !TEX root =  ../main.tex
\definecolor{forestgreen}{rgb}{0.1,0.6,0.1}

\begin{tikzpicture}[scale=.9,square/.style={regular polygon,regular polygon sides=4}]
        \node at (-8,1.5) [minimum width=3cm,minimum height=1cm,rectangle,draw,label] (policy) {sampling strategy};
        \node at (-8,-1.5) [minimum width=3cm,minimum height=1cm,rectangle,draw,label] (imdpvi) {IMDP VI};
        
        \node at (-1.5,-0.5) [minimum width=5cm,minimum height=4cm,rectangle,draw,label={[yshift=-.7cm]IMDP  \textcolor{forestgreen}{with scopes}}] (box) {};
        
        \node at (-4.25,0.25) [gray!50,minimum width=10.5cm,minimum height=6cm,rectangle,draw,label={[shift=({-4cm,-1cm})]\textcolor{gray!80}{\large \textsf{agent}}}] (agent) {};
        
        \node at (-3,-.75) [circle,minimum size=.8cm,draw] (s0) {$s$};
        \node at (0,-.75) [forestgreen,circle,minimum size=.8cm,draw] (s2) {$s'_2$};
        \node at (0,-1.75) [circle,minimum size=.8cm,draw] (s3) {$s'_3$};
        \node at (0,.25) [forestgreen,circle,minimum size=.8cm,draw] (s1) {$s'_1$};
        
        \node at (6,0) [cloud,cloud ignores aspect, minimum width=5cm, minimum height=5cm,draw,label={[yshift=-1.5cm]\textcolor{gray!80}{\large \textsf{environment}}}] (env)  {};
        \node at (4.5,-.5) [circle,minimum size=.8cm,draw] (s0e) {$s$};
        \node at (7,-.5) [circle,minimum size=.8cm,draw] (s2e) {$s'_2$};
        \node at (7,-1.5) [circle,minimum size=.8cm,draw] (s3e) {$s'_3$};
        \node at (7,.5) [circle,minimum size=.8cm,draw] (s1e) {$s'_1$};
        
        \draw[thick,-{Latex[length=3mm,width=1.5mm]}] (policy) edge[bend left=25] node[above] {action} (env);
        \draw[-{Latex[length=3mm,width=1.5mm]}] (env) edge[bend right=20] node[below] {next state} (policy);
        \draw[forestgreen,-{Latex[length=3mm,width=1.5mm]}] (s0) |- node[above,pos=0.75] {$\alpha\colon[\underline{p_1},\overline{p_1}]$} (s1);
        \draw[forestgreen,-{Latex[length=3mm,width=1.5mm]}] (s0) -- node[above] {$\alpha\colon[\underline{p_2},\overline{p_2}]$} (s2);
        \draw[-{Latex[length=3mm,width=1.5mm]},dashed] (s0) |- node[below,pos=0.75] {$\beta\colon[1,1]$} (s3);
        
        \draw[-{Latex[length=3mm,width=1.5mm]}] (s0e) |- node[above,pos=0.75] {$\alpha\colon p_1$} (s1e);
        \draw[-{Latex[length=3mm,width=1.5mm]}] (s0e) -- node[above] {$\alpha\colon p_2$} (s2e);
        \draw[-{Latex[length=3mm,width=1.5mm]}] (s0e) |- node[below,pos=0.75] {$\beta\colon 1$} (s3e);
        
        \draw[thick,-{Latex[length=3mm,width=1.5mm]}] (imdpvi) -- node[above,label={[align=center,shift={(-.8,-.83)}]value \\ function \\ bounds}] {} (policy);
         
         \draw[thick,-{Latex[length=3mm,width=1.5mm]}] (box.200) |- node[below,label={[align=center,shift={(-1,-1)}]reduced \\ model}] {} (imdpvi);
         
          \draw[thick,-{Latex[length=3mm,width=1.5mm]}] (env.219) |- node[below,label={[align=center,shift={(-1,-1)}]collected \\ samples}] {} (box.340);
        
\end{tikzpicture}