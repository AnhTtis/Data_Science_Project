\section{PCR Finite-Sample Analysis}
\label{sec:vertical_regression}

In this section, we present the finite-sample analysis of the vertical regression procedure (step 2 of \method) done via principal component regression \cite{agarwal2020principal,agarwal2019robustness}. 
\begin{proposition}
\label{prop:pcr_convergence_rate}
Let Assumptions \ref{ass:observation_model}, \ref{ass:subgaussian_noise}, \ref{ass:balanced_spectrum}, \ref{ass:rowspace_inclusion}, and $\kappa = \text{rank}(E[Y_{\mathcal{I}}^{(\Pi_n)}]) \coloneqq r_{n}$. Then, conditioned on $\mathcal{A}$, we have 
\begin{equation}
    \hat{\bw}^n - \Tilde{\bw}^n=  \tilde{O}_p \left(r_n \left[\frac{\lVert \Tilde{\bw}^{n} \rVert_2  }{\min\{\sqrt{|\Pi_n|},\sqrt{|\mathcal{I}|\}}}  + \Delta_E \right]  ~ \bigg| ~ \mathcal{A} \right) 
\end{equation}
where $\Tilde{\bw}^n = \bV_{\mathcal{I}}^{(\Pi_n)}(\bV_{\mathcal{I}}^{(\Pi_n)})^T\bw^n$ and $\bV_{\mathcal{I}}^{(\Pi_n)}$ are the right singular vectors of $\E[\bY_{\mathcal{I}}^{(\Pi_n)}]$.
\end{proposition}

\begin{proof} The proof follows from adapting the notation of Proposition E.3 in \cite{agarwal2021causal} to that used in this paper. Specifically, we present  table \ref{tab:notational_changes} that matches their notation to  ours %\begin{center}
\begin{table}[htbp]
\centering
\begin{tabular}{||c c||} 
 \hline
 Notation of \cite{agarwal2021causal} & Our Notation \\ [1ex] 
 \hline
 $\bY$ & $\bY_{\Pi_n}$  \\ [1ex]
 \hline
 $\bX$ & $\E[\bY_{\mathcal{I}}^{(\Pi_n)}]$ \\  [1ex]
 \hline
 $\bZ$ &  $\hat{\E}[\bY_{\mathcal{I}}^{(\Pi_n)}]$  \\ [1ex]
 \hline 
 $n$ & $|\Pi_n|$ \\
 \hline 
 $p$ & $|\mathcal{I}|$ \\
 \hline 
$\bbeta^*$ & $\Tilde{\bw}$ \\
\hline
$\hat{\bbeta}$ & $\hat{\bw}$ \\
\hline
$\Delta_E$ & $\Delta_E$ \\
\hline 
$r$ & $r$ \\
\hline 
$\phi^{lr}$ & $0$ \\ [1ex]
 \hline
 $\Bar{A}$ & $1$ \\ 
 \hline
 $\Bar{K}$ & 0  \\ [1ex] 
 \hline
 $K_{a}, \kappa, \Bar{\sigma}$ & $C\sigma$ \\
 \hline 
 $\rho_{min}$ & 1 \\
 \hline 
 \end{tabular}
\caption{A summary of the main notational differences between our setting and that of \cite{agarwal2021causal}.}
\label{tab:notational_changes}
\end{table}
%\end{center}

Using the table above, we have that the following holds with probability $1 - O\left(\left(|\mathcal{I}||\Pi_n|\right)^{-10}\right)$ 
\begin{equation*}
    \lVert \hat{\bw}^n - \Tilde{\bw}^n \rVert_2 \leq C\sigma^3\log^3\left(\left(|\mathcal{I}||\Pi_n|\right)\right)\left[\frac{\lVert \Tilde{\bw}^{n} \rVert_2  }{\min\{\sqrt{|\Pi_n|},\sqrt{|\mathcal{I}|\}}}  + \Delta_E \right]
\end{equation*}
This completes the proof. 
\end{proof}
