\begin{figure}
    \centering
    \begin{tikzpicture}[blockchain]
        \small
        \begin{scope} [xshift=-1cm]

            \node at (-1.5,0) {(a)};

            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \draw [link-hon] (h2) -- (h1);

            
            \node [block-blank,opacity=1] (hNEW1) at (-0,-3) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW2) at (-0.2,-3.1) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW3) at (-0,-3.2) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank, opacity=1] (hNEW4) at (-0.2,-2.9) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h2);

            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            \draw [link-adv,opacity=1] (a1.north) -- (G);
        \end{scope} 
        
        \begin{scope}[xshift=2cm]

            \node at (-1.5,0) {(b)};


            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \node [block-hon, opacity=0.3] (h3) at (0,-3) {3};
            \draw [link-hon] (h2) -- (h1);
            \draw [link-hon] (h3) -- (h2);

            
            \node [block-blank,opacity=1] (hNEW1) at (-1,-3) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW2) at (-1.2,-3.1) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW3) at (-1,-3.2) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h2);
            \node [block-blank, opacity=1] (hNEW4) at (-0,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW4) -- (h3);
            
            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            
            \draw [link-adv,opacity=1] (a1.north) -- (G);
        \end{scope}

        \begin{scope}[xshift=5cm]

            \node at (-1.5,0) {(c)};


            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \node [block-hon, opacity=0.3] (h3) at (0,-3) {3};
            \draw [link-hon] (h2) -- (h1);
            \draw [link-hon] (h3) -- (h2);

            
            \node [block-blank,opacity=1] (hNEW1) at (-1,-3) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW2) at (-1.2,-3.1) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW3) at (-1,-3.2) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h2);
            \node [block-blank, opacity=1] (hNEW4) at (-0,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW4) -- (h3);
            
            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            \node [block-adv,opacity=0.3] (a2) at (1,-2) {2};
            \node [block-adv,opacity=0.3] (a3) at (1,-3) {3};
            \node [block-adv,opacity=0.3] (a4) at (1,-4) {4};

            \draw [link-adv,opacity=1] (a1.north) -- (G);
            \draw [link-adv,opacity=0.3] (a2.north) -- (a1);
            \draw [link-adv,opacity=0.3] (a3.north) -- (a2);
            \draw [link-adv,opacity=0.3] (a4.north) -- (a3);
        \end{scope}
        
        \begin{scope}[xshift=-1cm,yshift=-3cm]%

            \node at (-1.5,0) {(d)};


            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \node [block-hon, opacity=0.3] (h3) at (0,-3) {3};
            \draw [link-hon] (h2) -- (h1);
            \draw [link-hon] (h3) -- (h2);
            \node [block-hon, opacity=0.3] (h3) at (0,-3) {3};

            
            \node [block-blank] (hNEW1) at (-1,-3) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank] (hNEW2) at (-1.2,-3.1) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank] (hNEW3) at (-1,-3.2) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h2);
            \node [block-blank] (hNEW4) at (-0,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW4) -- (h3);
            
            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            \node [block-adv,opacity=1] (a2) at (1,-2) {2};
            \node [block-adv,opacity=0.3] (a3) at (1,-3) {?};
            \node [block-adv,opacity=0.3] (a4) at (1,-4) {?};

            \draw [link-adv,opacity=1] (a1.north) -- (G);
            \draw [link-adv,opacity=1] (a2.north) -- (a1);
            \draw [link-adv,opacity=0.3] (a3.north) -- (a2);
            \draw [link-adv,opacity=0.3] (a4.north) -- (a3);
        \end{scope}

        \begin{scope}[xshift=2cm,yshift=-3cm]%

            \node at (-1.5,0) {(e)};

            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \draw [link-hon] (h2) -- (h1);
            \node [block-hon, opacity=1] (h3) at (0,-3) {3};
            \draw [link-hon] (h3) -- (h2);
            \node [block-hon, opacity=1] (h3-2) at (-1,-3) {3};
            \draw [link-hon] (h3-2) -- (h2);

            
            \node [block-blank,opacity=1] (hNEW1) at (-1,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW2) at (-1.2,-4.1) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank,opacity=1] (hNEW3) at (-1,-4.2) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h3-2);
            \node [block-blank, opacity=1] (hNEW4) at (-0,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW4) -- (h3);
            
            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            \node [block-adv,opacity=1] (a2) at (1,-2) {2};


            \draw [link-adv,opacity=1] (a1.north) -- (G);
            \draw [link-adv,opacity=1] (a2.north) -- (a1);

        \end{scope}

\begin{scope}[xshift=5cm,yshift=-3cm]%

            \node at (-1.5,0) {(f)};

            \node [block] (G) at (0,0) {G};

            \node [block-hon] (h1) at (0,-1) {1};
            \draw [link-hon] (h1) -- (G);

            \node [block-hon] (h2) at (0,-2) {2};
            \draw [link-hon] (h2) -- (h1);
            \node [block-hon, opacity=1] (h3) at (0,-3) {3};
            \draw [link-hon] (h3) -- (h2);
            \node [block-hon, opacity=1] (h3-2) at (-1,-3) {3};
            \draw [link-hon] (h3-2) -- (h2);
            \node [block-hon, opacity=0.3] (h4-2) at (-1,-4) {4};
            \draw [link-hon] (h4-2) -- (h3-2);

            
            \node [block-blank,opacity=1] (hNEW1) at (-1,-5) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW1) -- (h4-2);
            \node [block-blank,opacity=1] (hNEW2) at (-2,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW2) -- (h3-2);
            \node [block-blank,opacity=1] (hNEW3) at (-2,-3.8) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \node [block-blank, opacity=1] (hNEW4) at (-0,-4) {\includegraphics[width=0.6em]{figures/icon-pick-emoji_u26cf.png}};
            \draw [link-hon,opacity=1] (hNEW4) -- (h3);
            
            \node [block-adv,opacity=1] (a1) at (1,-1) {1};
            \node [block-adv,opacity=1] (a2) at (1,-2) {2};
            \node [block-adv,opacity=0.3] (a3) at (1,-3) {3};
            \node [block-adv,opacity=0.3] (a4) at (1,-4) {4};
            \node [block-adv,opacity=0.3] (a5) at (1,-5) {5};


            \draw [link-adv,opacity=1] (a1.north) -- (G);
            \draw [link-adv,opacity=1] (a2.north) -- (a1);
            \draw [link-adv,opacity=0.3] (a3.north) -- (a2);
            \draw [link-adv,opacity=0.3] (a4.north) -- (a3);
            \draw [link-adv,opacity=0.3] (a5.north) -- (a4);

        \end{scope}


    \end{tikzpicture}%
    \vspace{-0.5em}%
    \caption{
        %
        \Teaserattack:
        %
        \textcolor{myParula05Green}{Green}/\textcolor{myParula07Red}{red} are honest/adversarial blocks, 
        %
        and 
        %
        numbers on blocks indicate 
        %
        height in the blockchain. Semi-transparent blocks have been announced (\ie, headers released) but were not yet downloaded by honest nodes.
        %
        %
        (a) We begin when 
        %
        honest nodes have a chain of length $2$. All blocks have been downloaded and 
        %
        validated by honest nodes.
        %
        (b) An honest node builds a block at height $k=3$, and announces it. The majority of the nodes are still mining on top of the block at height $k-1$. The adversary wishes to delay the download of the new block.
        %
        (c) The adversary announces a block at height $k+1$ from a chain it had been withholding. Since this is 
        %
        the longest announced chain, honest nodes prioritize its download beginning with the adversary's block $2$.
        %
        (d) Honest nodes have downloaded and validated the adversary's block $2$. Since they do not yet have a longer validated chain, they keep mining as before. When they request the adversary's block of height $k=3$, they find it to be unavailable (`?'), and so ignore the rest of the attacker's chain and resume downloading the honest block of height $k=3$. 
        %
        (e) While download was delayed, some mining power may have been wasted and another conflicting honest block of height $k=3$ may have been constructed. Notice now that we are in a scenario similar to the beginning of the attack and that a similar sequence can now repeat. 
        %
        (f) Once an honest node mines a block of height $4$, the attacker announces a block at height $5$, and proceeds to allow a download of height $3$, delaying again the verification of the honest block at height $4$.
        %
        Eventually, the attack breaks safety as the adversary releases content for its chain to overtake the honest chain.
        }
    \label{fig:attack-teaser}
\end{figure}