\begin{figure}
    \centering
    %
    \begin{tikzpicture}
        \footnotesize
        \def\blockinterval{0.75}
        \begin{scope}[blockchainold,x=1cm,y=0.6cm]

            \coordinate (G) at (-1*\blockinterval,0);
            
            \node [block-gray] (b0) at (0,0) {};
            \draw [link] (b0) -- (G);

            \node [block-gray] (C01) at (\blockinterval,0) {};
            \draw [link] (C01) -- (b0);
            \node [block-gray] (C02) at (2*\blockinterval,0) {};
            \draw [link] (C02) -- (C01);
            \node [block-gray] (C03) at (3*\blockinterval,0) {};
            \draw [link] (C03) -- (C02);
            \node [block-gray] (C04) at (4*\blockinterval,0) {};
            \draw [link] (C04) -- (C03);
            \node [block-gray] (C05) at (5*\blockinterval,0) {};
            \draw [link] (C05) -- (C04);
            \node [anchor=north west, inner sep=0] at (C05.south east) {$\Chain_0$};

            \foreach \i in {1,...,4} {
                \node [block-red] (C\i1) at (1*\blockinterval,\i) {};
                \draw [link] (C\i1.west) -- (b0);
                \node [block-red] (C\i2) at (2*\blockinterval,\i) {};
                \draw [link] (C\i2) -- (C\i1);
                \node [block-red] (C\i3) at (3*\blockinterval,\i) {};
                \draw [link] (C\i3) -- (C\i2);
                \node [block-red] (C\i4) at (4*\blockinterval,\i) {};
                \draw [link] (C\i4) -- (C\i3);
                \node [block-red] (C\i5) at (5*\blockinterval,\i) {};
                \draw [link] (C\i5) -- (C\i4);
            }
            
            \node [inner sep=0,anchor=north west] at (C15.south east) {$\Chain$};
            %

            
            \node [block-gray] (b1) at (6*\blockinterval,1) {};
            \draw [link] (b1) -- (C15);
            \node [anchor=west, inner sep=0, xshift=2pt, yshift=-1pt] at (b1.east) {$b_1$};

            \node [inner sep=0,anchor=north west] at (C25.south east) {$\Chain'$};
            \node [block-gray] (b2) at (7*\blockinterval,2) {};
            \draw [link] (b2) -- (C25);
            \node [anchor=west, inner sep=0, xshift=2pt, yshift=-1pt] at (b2.east) {$b_2$};
            %

            %
            \node [block-gray] (b3) at (8*\blockinterval,3) {};
            \draw [link] (b3) -- (C35);
            \node [anchor=west, inner sep=0, yshift=-1pt, xshift=2pt] at (b3.east) {$b^*$ (new $\Chain_0$)};

            \node [block-red] (b') at (6.5*\blockinterval,4) {};
            \draw [link] (b') -- (C45);
            \node [anchor=west, inner sep=0, yshift=-1pt, xshift=2pt] at (b'.east) {$b'$ (new $\Chain$)};
            
            \draw [decorate,decoration={brace,amplitude=4pt,raise=5pt}]
                (C41.north west) -- (C45.north east)
                node [midway,above=9pt,anchor=south,align=center]
                {$L = \log(\kappa)$ blocks};

            \def\timeheight{-1}
            \begin{scope}%
                \draw [Latex-] (10*\blockinterval,\timeheight) -- (-1*\blockinterval,\timeheight) node [below right] {\emph{Time}};
                
                \draw [] (5*\blockinterval,\timeheight) ++(0,0.2) -- ++(0,-0.4) node [below] {$t_0$};
                \draw [] (6*\blockinterval,\timeheight) ++(0,0.2) -- ++(0,-0.4) node [below] {$t_1$};
                \draw [] (7*\blockinterval,\timeheight) ++(0,0.2) -- ++(0,-0.4) node [below] {$t_2$};
                \draw [] (8*\blockinterval,\timeheight) ++(0,0.2) -- ++(0,-0.4) node [below] {$t^*$};
                \draw [] (9.5*\blockinterval,\timeheight) ++(0,0.2) -- ++(0,-0.4) node [below] {$t^* + \frac{L}{\bwtime\slotduration}$};
                %
                %
                \draw [|-|] (8*\blockinterval,\timeheight+0.5) -- (9.5*\blockinterval,\timeheight+0.5) node [midway, above, anchor=south] {No blocks};
            \end{scope}

        \end{scope}
    \end{tikzpicture}%
    \vspace{-1em}%
    \caption{Illustration of 
    the
    new attack of Section~\ref{sec:tp-attack-analysis-overview}.
    At time $t_0$, $\Chain_0$ is the longest downloaded chain of all honest nodes, and the adversary produces a chain $\Chain$ that forks off $\Chain_0$ by $L=\log(\kappa)$ blocks.
    Blocks produced in time slots $t_1,t_2,...$ (whether honest or adversarial) extend the chain $\Chain$ or a chain $\Chain'$ containing equivocation of the blocks in $\Chain$,
    and are not downloaded by all honest nodes in time before
    the next block production opportunity.
    Time slot $t^*$ is the first slot such that there are no block productions in the $\frac{L}{\bwtime\slotduration}$ slots after $t^*$.
    The block $b^*$ produced in slot $t^*$ therefore gets downloaded. If the adversary had at least one block production opportunity $t' \in [t_0, t^* + L/(\bwtime\slotduration)]$, then the adversary sets the chain ending in $b^*$ as new $\Chain_0$ and the chain ending in $b'$ as new $\Chain$, and repeats the attack.}
    \label{fig:tp-log-kappa-attack}
\end{figure}