\subsubsection{Many Probabilistic Pivots Imply One Combinatorial Pivot}
\label{sec:analysis-details-many-pps-one-cps}

%

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%


%
%
%
%

%
%
%
%
%
%
%
%
%
%
%
%
%
    
%
%
%
%
%
%
%
    
%
%
%
%
%
%
%
%
%
%

%
%


As a concrete choice of 
%
download rule, we consider the `download longest header chain' rule $\dlrulelong$ (\algref{longest-header-chain-rule}).
%
This rule has some useful properties that we prove below.
Intuitively, nodes using this rule 
\begin{enumerate}[(P1)]
    %
    \item \label{item:good-download-rule-no-repeat} do not download the same block twice,
    \item \label{item:good-download-rule-one-per-bpo} download at most one block from each \BPO (in PoW),
    \item \label{item:good-download-rule-honest-block} either download the most recent honest block, or fully utilize their bandwidth to download other blocks (don't stay idle), and
    \item \label{item:good-download-rule-cutoff} download only blocks that were produced `recently'.
    %
\end{enumerate}
%
%

%
\ref{item:good-download-rule-no-repeat} clearly holds as this rule only downloads content for headers whose content is yet $\BLOCKUNKNOWN$, hence was not downloaded before.
\ref{item:good-download-rule-one-per-bpo} holds in PoW because there is only one block per \BPO. In PoS, the download rule is modified to satisfy this property (\secref{pos}).
\ref{item:good-download-rule-honest-block} holds because the download rule $\dlrulelong$
is never idle, and 
will always download towards an honest block
when it has downloaded all longer chains
%
and there is bandwidth remaining.
%
Moreover, we expect that under a secure execution,
\ref{item:good-download-rule-cutoff} holds because the longest header chain can not fork off too much from the longest downloaded chain of an honest node, otherwise it would cause a safety violation.
%
More precisely, due to \lemref{cps-stabilize},
any longest header chain in any honest node's view must extend the block produced in the most recent \sltcp, and therefore blocks with higher download priority must have been produced after the most recent \sltcp (\propref{download-or-spend-budget}).
%
%


Given the above properties of the download rule, we now want to show that \sltcps occur often.
To start with, let us show that there is at least one \sltcp in $\intvl{0}{\Kcp}$.
From \lemref{many-pps}, there are many \sltpps in $\intvl{0}{\Kcp}$.
If there were no \sltcps in $\intvl{0}{\Kcp}$, then the adversary must prevent each \sltpp from turning into a \sltcp.
We know that in any interval around a \sltpp, there are more \sltgood \iindices than \sltbad \iindices, in fact \sltgood \iindices outnumber \sltbad \iindices by a margin that increases linearly with the size of the interval.
Therefore, for a \sltpp to not be a \sltcp, the adversary must prevent an honest node from downloading the most recent honest block in several of these \sltgood \timeslots.
From \propref{download-or-spend-budget}, for each such \iindex, the adversary must `spend' at least $\goodsepbw$ blocks that the honest node downloads.
These blocks must come from a `budget' that can at most contain all blocks mined since the beginning of the protocol.
However, these intervals around the \sltpps begin no later than \timeslot $\Kcp$, so the number of such blocks is limited.
If this `budget' falls short of the number of blocks required to overthrow all \sltcps, then there must be at least one \sltcp in $\intvl{0}{\Kcp}$.
%


%
Next, we would like to show that there is at least one \sltcp in $\intvl{m\Kcp}{(m+1)\Kcp}$ for all $m \geq 0$ (where 
%
we just saw the base case $m=0$)
%
%
Here,
the adversary might save up many blocks from the past and attempt to make honest nodes download these blocks at a particular target \timeslot $t_k$.
This is where the property of the download rule proven in \propref{download-or-spend-budget} becomes useful.
%
%
%
%
Given that one \sltcp occurred in $\intvl{(m-1)\Kcp}{m\Kcp}$, \propref{download-or-spend-budget} ensures that honest nodes will only download blocks that are produced after $(m-1)\Kcp$.
This allows us to bound the `budget' of blocks that the adversary can use to overthrow \sltcps, and therefore show that there is at least one \sltcp in $\intvl{m\Kcp}{(m+1)\Kcp}$.
We thus prove the required claim inductively in \lemref{one-cp-induction-full}.



While all the analysis below is done for the download rule $\dlrulelong$, the proofs only use the properties \ref{item:good-download-rule-no-repeat}, \ref{item:good-download-rule-one-per-bpo}, \ref{item:good-download-rule-honest-block}, \ref{item:good-download-rule-cutoff}
and thus apply to several other simple download rules.
%
%
A few examples are
i) ``download towards the freshest block'' \cite{bwlimitedposlc},
ii) ``download only blocks that are consistent with the node's confirmed chain'', or iii) ``at \timeslot $t_k$, only download blocks produced in \timeslots $\intvl{t_k-\Tdl}{t_k}$'' for some $\Tdl$.
In fact, iii) gives an alternative definition of the property \ref{item:good-download-rule-cutoff} instead of the one in \propref{download-or-spend-budget}.
In this work, we did not adopt i) because `freshness' cannot be determined in PoW, and ii) and iii) because they would fail to recover from a network split (as demonstrated in the \greedyattack in \secref{greedy-attack}).
In \secref{pos}, we modify the `download longest header chain rule' to remove equivocations in PoS.
We show that this rule satisfies the above properties, and hence the analysis of this section carries over in PoS as well.




\begin{proposition}
\label{prop:download-or-spend-budget}
If $G_k = 1$ and $D_k = 0$, then during \timeslots $[t_k, t_k + \goodsep]$, all honest nodes 
using the download rule $\dlrulelong$
download content of at least $\goodsepbw$ blocks that are produced in $\intvl{i}{k}$, where $i<k$ is the largest index such that $\predCP{i}$ (if such an $i$ does not exist, $i=0$).
\end{proposition}


%

%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%

%
%




%


\begin{lemma}
\label{lem:one-cp-induction-full}
\label{lem:many-pps-one-cps}
%
If all honest nodes use the download rule $\dlrulelong$,
%
and if
%
%
%
%
%
%
%
\begin{IEEEeqnarray}{C}
    \label{eq:cp-induction-full-margin-condition}
    \forall \intvl{i}{j} \intvlgeq \Kcp
    %
    \colon 
    %
    \qquad \frac{\goodsepbw}{2} \left( \Gin{i}{j} - \Bin{i}{j} \right) > \Qin{i-2\Kcp}{j}, \text{ and} \\
    \label{eq:cp-induction-full-ppivots-condition}
    \forall m \geq 0 \colon 
    \frac{\goodsepbw}{4} \Pin{m\Kcp}{(m+1)\Kcp} > \Qin{(m-2)\Kcp}{(m+2)\Kcp},
\end{IEEEeqnarray}
then 
$\forall m \geq 0 \colon$ 
$\exists k_m^* \in \intvl{m\Kcp}{(m+1)\Kcp} \colon \predCP{k_m^*}$.
\end{lemma}

This is proven inductively
%
using \propref{download-or-spend-budget}. The proof is in \secref{appendix-security-proofs-many-pps-one-cp}.


