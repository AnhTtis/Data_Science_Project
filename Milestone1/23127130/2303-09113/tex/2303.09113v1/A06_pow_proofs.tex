\section{Proof-of-Work Security Proofs}
\label{sec:appendix-pow-proofs}


\begin{proposition}
    \label{prop:index-time-bridge-pow}
    \begin{IEEEeqnarray}{C}
        \forall k, K \in \IN \colon
        \Prob{ \slotduration(t_{k+K} - t_{k}) \geq \frac{K}{\blkratetime(1-\delta)} } \leq \exp\left( - \frac{K\delta^2}{2(1+\delta)}\right)
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
\end{proposition}
\begin{proof}
    This results from a Poisson tail bound for the number of \BPOs in real time $K/\blkratetime$, and noting that 
    each non-\sltempty \timeslot has exactly one \BPO.
    %
\end{proof}


\begin{lemma}
    \label{lem:safety-and-liveness-comb-pow}
    If for some $\Kcp > 0$,
    \begin{IEEEeqnarray}{C}
        \label{eq:condition-one-cp-m-pow-safety}
        \forall m \geq 0 \colon \exists k_m^* \in \intvl{m\Kcp}{(m+1)\Kcp} \colon \predCP{k_m^*},
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    then the PoW longest chain protocol $\protocol$ with $\confDepth = 2\Kcp + 1$ satisfies safety.
    Further, if
    \begin{IEEEeqnarray}{C}
        \label{eq:cond-index-time-bridge-pow}
        \forall k \in \IN, K \geq \Kcp \colon t_{k+K} - t_{k} < \frac{K}{\blkratetime\slotduration(1-\delta)},
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    then it also satisfies liveness with $\Tlive = \frac{6\Kcp + 2}{\blkratetime\slotduration(1-\delta)}$.
\end{lemma}
\begin{proof}
    Safety: For an arbitrary \timeslot $t$, let $k$ be the largest \iindex such that $t_k \leq t$.
    From \eqref{condition-one-cp-m-pow-safety}, every interval of $2\Kcp$ \iindices contains at least one \sltcp. Therefore, there exists $k^* \in \intvl{k-2\Kcp-1}{k-1}$ such that $\predCP{k^*}$.
    Let $b^*$ be the block from \iindex $k^*$.
    Due to \lemref{cps-stabilize}, for all honest nodes $p,q$ and $t' \geq t$,
    $b^* \in \dC_p(t)$ and $b^* \in \dC_q(t')$.
    But $k^* \geq k-\confDepth$, so the block $b^*$ cannot be $\confDepth$-deep in any chain at \timeslot $t$ Therefore, $\LOG{p}{t}$ is a prefix of $b^*$ which in turn is a prefix of $\dC_q(t')$.
    We can thus conclude that
    either 
    $\LOG{p}{t} \preceq \LOG{q}{t'}$ or $\LOG{q}{t'} \preceq \LOG{p}{t}$.
    Therefore, safety holds.

    %
    %
    %
    %
    %
    %
    %
    %

    Liveness: Assume a transaction $\tx$ is received by all honest nodes before \timeslot $t$. Again let $k$ be the largest \iindex such that $t_k \leq t$.
    We know that there exists $k^* \in (k,k+2\Kcp]$ such that $\predCP{k^*}$.
    The honest block $b^*$ from \iindex $k^*$ or its prefix must contain $\tx$ since $\tx$ is seen by all honest nodes at time $t < t_{k^*}$.
    Since $k^*$ is a \sltcp, for all $\intvl{i}{j} \ni k^*$, $\Din{i}{j} > \Nin{i}{j}$ (\defref{cp} and \eqref{random_walks_X_and_Y}), and hence $\Din{i}{j} > \frac{j-i}{2}$.
    Particularly,
    \begin{IEEEeqnarray}{rCl}
        \Din{k^*-1}{k^* + 2\confDepth-1} &>& \confDepth \\
        \implies \Din{k^*}{k^* + 2\confDepth - 1} &>& \confDepth - 1.
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    Then from \propref{chain-growth-interval},
    \begin{IEEEeqnarray}{rCl}
        L_{\min}(t_{k^*+2\confDepth-1}+\goodsep) - L_{\min}(t_{k^*+1}-1) &\geq& \Din{k^*}{k^* + 2\confDepth - 1} \nonumber \\
        &\geq& \confDepth.
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    Due to \lemref{cps-stabilize},
    $b^*\in\dC_p(t')$ for all honest nodes $p$ and $t'\geq t_{k^*} + \goodsep$, and $L_{\min}(t_{k^*+1}-1) \geq \len{b^*}$. This means that $b^*$ is $\confDepth$-deep in $\dC_p(t')$ for all honest nodes $p$ and all $t' \geq t_{k^*+2\confDepth-1}+\goodsep$.
    Finally, with $k^* \leq k+2\Kcp$ and \eqref{cond-index-time-bridge-pow},
    \begin{IEEEeqnarray}{rCl}
        t_{k^*+2\confDepth-1}+\goodsep - t &\leq& t_{k + 6\Kcp + 1} + \goodsep - t_{k} \nonumber \\
        &\leq& t_{k + 6\Kcp + 2} - t_{k} \nonumber \\
        &<& \frac{6\Kcp + 2}{\blkratetime\slotduration(1-\delta)}.
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    Therefore, $\mathsf{tx}\in\LOG{p}{t'}$ for all $t'\geq t+\Tlive$.
\end{proof}


%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%

%
%
%
%

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%
%
%

%
%
%
%
%
%
%
%



\begin{proof}[Proof of \Thmref{safety-and-liveness-pow}]

First, we show that the conditions of \lemref{one-cp-induction-full} hold, and therefore \sltcps occur.
Define the event
\begin{IEEEeqnarray}{rCl}
    \Event_1 &=& \left\{\forall \intvl{i}{j} \intvlgeq \Kcp \colon \Pin{i}{j} > (1-\delta)\probPP(j-i) \right\}
\end{IEEEeqnarray}
Suppose that $\Event_1$ occurs, and $\frac{\goodsepbw}{16}\probPP (1-\delta) > 1$.
Then,
%
\begin{IEEEeqnarray}{rCl}
    \forall \intvl{i}{j} \intvlgeq \Kcp \colon \qquad \frac{\goodsepbw}{4} \Pin{i}{j} &>& \frac{\goodsepbw}{4} (1-\delta)\probPP(j-i) \\
    &>& 4(j-i) \\
    &\eqA& \Qin{i-2\Kcp}{j+\Kcp}
\end{IEEEeqnarray}
where (a) is because as $\slotduration \to 0$, each non-\sltempty \timeslot has exactly one \BPO. This satisfies \eqref{cp-induction-full-ppivots-condition} in \lemref{one-cp-induction-full}. Further,
\begin{IEEEeqnarray}{rCl}
    \frac{\goodsepbw}{2} \left( \Gin{i}{j} - \Bin{i}{j} \right)
    &\geq& \frac{\goodsepbw}{2} \Pin{i}{j} \\
    &>& 3 (j-i) \\
    &>& \Qin{i-2\Kcp}{j}
\end{IEEEeqnarray}
which satisfies condition \eqref{cp-induction-full-margin-condition} in \lemref{one-cp-induction-full}. 
%
Therefore there is one \sltcp in every interval of the form $\intvl{m\Kcp}{(m+1)\Kcp}$.
%
Also suppose the following event occurs:
\begin{IEEEeqnarray}{rCl}
    \Event_2 &=& \left\{\forall k \in \IN, K \geq \Kcp \colon t_{k+K} - t_k < \frac{K}{\blkratetime\slotduration(1-\delta)} \right\}.
\end{IEEEeqnarray}
%
%
%
%
%
%
%
Then \lemref{safety-and-liveness-comb-pow} guarantees safety and liveness with $\confDepth = 2\Kcp$ and $\Tlive = \frac{6\Kcp+2}{\blkratetime\slotduration(1-\delta)}$.

%
By choosing $\Kcp = \Omega(\kappa^2)$, $\Khorizon = \poly(\kappa)$, and using \lemref{many-pps}, \propref{index-time-bridge-pow},
\begin{IEEEeqnarray}{rCl}
    \Prob{\lnot \Event_1 } &=& \negl(\kappa) \\
    %
    \Prob{\lnot \Event_2 } 
    &\leq& \Khorizon^2 e^{ - \Kcp \delta^2 /(2(1+\delta))}
    = \negl(\kappa).
\end{IEEEeqnarray}
By a union bound, 
%
the probability of failure of either $\Event_1$ or $\Event_2$ is $\negl(\kappa)$.
Finally, indices are mapped to real time as $\TliveReal \triangleq \Tlive \slotduration$.

Finally, we take the limit $\slotduration \to 0$.
%
With the relations $\blkratetime = \blkrateslot/\slotduration$, $\BWEquation$, and 
$\probPP = \probPPFormula$,
\begin{IEEEeqnarray}{C}
    \label{eq:prob-good-equation-pow}
    \probGood = \probGoodFormula \to (1-\beta)e^{-\blkratetime\left(\DeltaHeader + \goodsepbw/\bwtime\right)}, \\
    \label{eq:C-equation-pow}
    \frac{\goodsepbw}{16} \frac{(2\probGood-1)^2}{\probGood} (1-\delta) > 1
\end{IEEEeqnarray}
%

%
%
%
%
%


Note that $\goodsepbw$ is an analysis parameter whose value is arbitrarily.
To find the maximum block production rate $\blkratetime$ that the protocol can achieve, we should optimize over $\goodsepbw$.
To find the maximum achievable $\blkratetime$,
we can take $\delta \to 0$ as we can increase the latency through increasing $\Kcp$ to still satisfy the error bounds.
Then solving for $\probGood$ from \eqref{C-equation-pow},
\begin{IEEEeqnarray}{C}
    \probGood > \frac{\goodsepbw+4 + \sqrt{8\goodsepbw+16}}{2\goodsepbw}.
\end{IEEEeqnarray}
Then from \eqref{prob-good-equation-pow},
\begin{IEEEeqnarray}{C}
    \blkratetime\left(\DeltaHeader + \goodsepbw/\bwtime\right) > \ln\left( \frac{2(1-\beta)\goodsepbw}{\goodsepbw+4 + \sqrt{8\goodsepbw+16}} \right).
\end{IEEEeqnarray}
Maximizing over $\goodsepbw$ gives the resulting threshold.



%
%
%
\end{proof}