\section{The \TeaserAttack}
    \label{sec:experiments}

\import{./figures/}{fig-attack-race-concept.tex}

We begin by exploring a strategy that the attacker can adopt which forces honest nodes to waste capacity on blocks that do not contribute to chain growth. This strategy demonstrates that the well-studied \emph{private attack} \cite{nakamoto_paper,dem20} is not the worst case behavior of the attacker, and that the previously established security bounds of the bounded-delay model do not hold in the bounded-capacity setting. 
We go on to simulate our \teaserattack and to show how it compares to the private attack (summarized in \cref{fig:attack-race-concept}%
). 
%
%
%
%
%

%
Previous analyses concluded that the private attack (\cref{fig:attack-race-concept}) is worst-case
based on the false assumption that delays, and hence the honest chain growth rate, do not depend on whether the adversary releases blocks and causes congestion. We exploit congestion to develop the \teaserattack.


\import{./figures/}{fig-attack-teaser.tex}

\import{./figures/}{fig-experiment-teaser.tex}


\myparagraph{Description of the \TeaserAttack}
\label{sec:teaser-attack}
%
The key idea in the \teaserattack (summarized in \cref{fig:attack-teaser}) is that the adversary can strategically time the release of blocks it had mined in order to take up some of the capacity of honest nodes.\footnote{While similar 
%
to the BDoS attack of \cite{mirkin2020bdos}, we note that while they exploit miner incentives to depress honest mining, our \teaserattack exploits network and processing congestion to attack safety.}
In a nutshell, while the adversary continues to mine a private chain, every time an honest node announces a block at a new height,
the adversary releases the headers of a segment of its longer withheld chain and the contents of only the first block.
Due to \rulelc scheduling, honest nodes prioritize processing blocks on the chain announced by the adversary.
%
Only after an honest node has processed the first adversary block and realizes that the content for the remaining blocks in the announced adversary chain segment are unavailable, does the \rulelc rule switch back to processing the newly created honest block.
Therefore, the adversary \emph{`teased'} the honest nodes to spend some of their resources processing the adversary chain,  but without actually gaining a longer chain of blocks compared to the chain they already possessed.
The result of this strategy is delayed processing of honest blocks that extend the longest honest chain. Processing is delayed by a factor of $2$ compared to the private attack.
This in turn results in more honest blocks forking, thus slowing down the honest chain growth rate 
(\cref{fig:experiment-teaser}~\ref{plt:experiment-teaser-attacker}) to $\blkratetimeGrowthTeaser < \blkratetimeGrowthSilent$.

\myparagraph{Conditions for success of the \teaserattack}
Formally, in both the private attack and the \teaserattack, the length difference between the adversary chain and the honest chain is a random walk \cite{dem20} which increases
at the rate $\blkratetimeAdv$
%
and decreases at the rate $\blkratetimeGrowth$.
%
If $\blkratetimeAdv > \blkratetimeGrowth$, the random walk has a positive drift, so
%
in the long run, the adversary chain will outgrow the honest chain indefinitely and the attack succeeds.
Conversely, if $\blkratetimeAdv < \blkratetimeGrowth$, the random walk has a negative drift and the attack will eventually fail. 
%
%
%
%
Thus, $\blkratetimeGrowth$
%
determines the fraction $\beta$ of total mining power that the adversary needs for the attack, \ie, the attack succeeds if
\begin{IEEEeqnarray}{c}
    \label{eq:chain-growth-rate-beta}
    \beta \triangleq \frac{\blkratetimeAdv}{\blkratetimeAdv+\blkratetimeHon} > \frac{\blkratetimeGrowth}{\blkratetimeGrowth+\blkratetimeHon}.
\end{IEEEeqnarray}
%
\import{./figures/}{fig-experiment-teaser-start3.tex}

Note that the \teaserattack requires the adversary to maintain a lead of at least two blocks with respect to the honest chain at all times (to proceed in steps (a), (e) in \cref{fig:attack-teaser}). If this fails, then the adversary must give up and try the attack again.
We show a sample plot of the adversary's lead for different mining rates in \cref{fig:experiment-teaser-start}. For a large enough adversary (if $\blkratetimeAdv > \blkratetimeGrowthSilent$), it is clear the lead has a positive drift and eventually stays positive. However, the \teaserattack succeeds even when the lead has a negative drift initially (\eg for $\blkratetimeGrowthTeaser < \blkratetimeAdv < \blkratetimeGrowthSilent$), as it only needs a random lucky short burst to kickstart step (a). The resulting congestion then decreases the average growth rate of the honest chain to $\blkratetimeGrowthTeaser$, and the adversary with mining power $\blkratetimeAdv > \blkratetimeGrowthTeaser$ can positively bias the random walk, thus eventually maintaining a positive lead, and succeed. We see this process in \cref{fig:experiment-teaser-start}~\ref{plt:teaser-medium2}: the adversary's lead rises and drops to zero a few times, causing the adversary to try again. However, eventually, the adversary manages
to maintain a permanent lead. On the other hand, when $\blkratetimeAdv < \blkratetimeGrowthTeaser$, the adversary's lead has a negative drift even after the congestion effects kick in (\cref{fig:experiment-teaser-start}~\ref{plt:teaser-weak2}), and therefore the \teaserattack is bound to run out of blocks and fail.


With the combined mining rate $\blkratetime \triangleq \blkratetimeHon + \blkratetimeAdv$ of honest nodes and adversary,
and the honest chain growth rates from \cref{fig:experiment-teaser}, we use \eqref{chain-growth-rate-beta} to calculate the adversary fraction $\beta$
required for each attack
and plot it in \cref{fig:comparison-bddelay-bdbandwidth}.


\myparagraph{Simulation details}
We simulate\footnote{Source code: \gitSourceUrl} both the private attack and the \teaserattack
on a network of $100$ nodes.
%
Honest nodes collectively 
mine
blocks at a rate $\blkratetimeHon = 1$ block per second.
Each node has a limited processing rate of $\bwtime$ blocks per second.
Blocks consist of content (transactions) and a header
(PoW and parent block pointer).
Since the header contains all information necessary to verify the PoW,
nodes only process validly created blocks.
All honest nodes and the adversary can directly send valid block headers to one another.
Given a tree of valid block headers, nodes run the \emph{\rulelc policy}, \ie,
nodes attempt to process (download and verify) the first unprocessed block along the longest header chain.
If the longest chain is already processed, or if the content of any block on that chain is unavailable or invalid, then the rule considers the next longest header chain, and so on.
We further elaborate on the setup and other simulation details in \appendixRef{\cref{sec:attacks-details}}.

\myparagraph{Practical aspects of the \teaserattack}
The \teaserattack may not acutely break specific real-world implementations of PoW NC,
%
%
%
mainly because 
%
miners have over-provisioned capacity. 
%
%
%
%
Although the \teaserattack is specific to the \rulelc policy,
%
%
%
it is possible to devise attacks that exploit congestion
even for other policies
%
(see \appendixRef{\cref{sec:greedy-attack}}).
%
%
%
%
%
We also note that in basic PoS NC, the adversary can 
%
exacerbate the \teaserattack by 
equivocating the whole adversary chain 
%
every time before it releases a block.
%
%
As the attack goes on, the length of the new announced chain increases. This increases the time honest nodes spend processing this chain, and \emph{decelerates} the honest chain growth until it comes to a halt. As a result, 
%
the chain growth rate under the \PoSteaserattack is nearly zero (details in \appendixRef{\cref{sec:pos-teaser-attack}}).
The key takeaway from the \teaserattack is 
that exploiting congestion results in attacks that are more severe than the private attack, 
%
%
%
even in PoW where the block production is limited, and even when the block production rate is below the capacity of nodes. This invalidates the bounded-delay model's predictions and emphasizes the need for a security analysis under models that capture the effects of congestion, especially for protocols that aim to saturate physical performance limits.


\input{figures/fig-experiment-teaser-spv.tex}


\myparagraph{Effect of SPV miners}
Rational miners in PoW NC face a \emph{verifier's dilemma}~\cite{verifier-dilemma,tuxedo,demystifying-incentives}:
there is no incentive to download and verify a block's content before mining to extend it.
Some so called \emph{SPV miners}
(named after simple-payment-verification clients who download only block headers)
mine empty blocks without verifying the parent block's content first,
and thus
%
%
get more time to mine, increasing their chances of being rewarded for mining the next block.
%
%
%
Since SPV miners are immune to congestion (as they do not process block content), how does their presence affect the \teaserattack?
Under the \teaserattack, SPV miners would mine on the adversaryâ€™s longer header chain (red block $3$ in \cref{fig:attack-teaser}(d)) without waiting for its contents. However, the remaining honest miners (who we assume still outnumber the SPV miners) still do not consider this chain valid (due to unavailable content). They continue mining on the honest chain, and would still be slowed down by the \teaserattack just as before.
We added SPV miners to our simulation and verified that the \teaserattack still succeeds with lower adversary power than the private attack
(\cref{fig:experiment-teaser-spv}).
%
%
Thus, the qualitative insight from the \teaserattack, that congestion enables worse attacks than the private attack, persists.


