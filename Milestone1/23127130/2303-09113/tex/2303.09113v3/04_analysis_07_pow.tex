\subsection{Security of Proof-of-Work Nakamoto Consensus}
\label{sec:proof-pow}


%
%
From \cref{lem:many-pps-informal,lem:many-pps-one-cps-informal}, we conclude that for suitable $\blkratetime$,
%
with overwhelming probability, \sltcps occur
%
in every $2\Kcp$-interval.
This allows us, together with \cref{lem:cps-stabilize-informal} (\sltcps stabilize), to prove safety and liveness of the protocol for a confirmation depth $\confDepth=\Theta(\Kcp)$.
The key arguments are in the proof of the following lemma.




\begin{lemma}
    \label{lem:safety-and-liveness-comb-pow}
    If for some $\Kcp > 0$,
    \begin{IEEEeqnarray}{C}
        \label{eq:condition-one-cp-m-pow-safety}
        \forall k \colon \exists k^* \in \intvl{k}{k+2\Kcp} \colon \predCP{k^*},
        \IEEEeqnarraynumspace
    \end{IEEEeqnarray}
    then the PoW Nakamoto consensus protocol $\protocol$ with $\confDepth = 2\Kcp + 1$ satisfies safety.
    %
    %
    %
    %
    %
    %
    %
    %
    Further, if the environment is $((\frac{1}{2}-\beta)\blkrateslot, 2\Kcp/\blkrateslot)$-tx-limited, 
    then $\protocol$ also satisfies 
    %
    liveness with 
    $\Tlive = \Theta(\Kcp)$.
    %
\end{lemma}
\begin{proof}
    \emph{Safety:}
    Denote the longest downloaded chain of node $p$ at \timeslot $t$ as $\dC_p(t)$ and its $\confDepth$-deep prefix as $\dC_p(t)\trunc{\confDepth}$.
    For an arbitrary \timeslot $t$, let $k$ be the largest \iindex such that $t_k \leq t$.
    From \cref{lem:many-pps-one-cps-informal}, every interval of $2\Kcp$ \iindices contains at least one \sltcp. Therefore, there exists $k^* \in \intvl{k-2\Kcp-1}{k-1}$ such that $\predCP{k^*}$.
    Let $b^*$ be the block from \iindex $k^*$.
    Due to \cref{lem:cps-stabilize-informal}, for all honest nodes $p,q$ and $t' \geq t$,
    $b^* \in \dC_p(t)$ and $b^* \in \dC_q(t')$.
    But $k^* \geq k-\confDepth$, so the block $b^*$ cannot be $\confDepth$-deep in any chain at \timeslot $t$. Therefore, $\LOG{p}{t}$ is a prefix of $b^*$ which in turn is a prefix of $\dC_q(t')$.
    We can thus conclude that
    either 
    $\LOG{p}{t} \preceq \LOG{q}{t'}$ or $\LOG{q}{t'} \preceq \LOG{p}{t}$.
    Therefore, safety holds.


    \emph{Liveness (proof sketch, details in \cref{sec:fullproof-pow}):}
    Recall that since \iindices count \timeslots with block production, $T$ \timeslots corresponds to roughly $\blkrateslot T$ \iindices.
    %
    Again let $k$ be the largest \iindex such that $t_k \leq t$.
    We will first prove that all transactions received between \iindices $k-2\Kcp$ and $k$, which are of total size at most $(1-2\beta)\Kcp$ as per the tx-limited environment, will be added to the longest downloaded chains of all nodes by \iindex $k + 2\Kcp$.
    We know that there exists $k^* \in (k,k+2\Kcp]$ such that $\predCP{k^*}$.
    %
    Since $k^*$ is a \sltcp, there are more \iindices $j$ with $\Dat{j}=1$ than \iindices with $\Dat{j} = 0$ in the interval $\intvl{k}{k + 2\Kcp}$ (by \cref{def:cp-informal}).
    Since each \iindex with $\Dat{j}=1$ leads to chain growth, every honest node's longest downloaded chain grows by at least $\Kcp$ between \iindices $k$ and $k + 2\Kcp$.
    There are at most $\beta \cdot 2\Kcp$ adversary block productions in the interval $\intvl{k}{k+2\Kcp}$, hence every honest node's longest downloaded chain grows by at least $\Kcp - 2\beta\Kcp$ \emph{honest blocks}.
    These honest blocks will include pending transactions, whose size is at most $(1-2\beta)\Kcp$.
    Moreover, in the interval $\intvl{k+2\Kcp}{k+2\Kcp+2\confDepth}$, every honest node's longest downloaded chain grows by at least $\confDepth$.
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    %
    Thus, the newly added transactions are $\confDepth$-deep, hence confirmed, by all nodes by \iindex $k + 2\Kcp + 2\confDepth$, which is a latency of $\Tlive = \frac{6\Kcp+2}{\blkrateslot}$ \timeslots.   
\end{proof}











Subsequently, we take $\slotduration \to 0$ and $\blkratetime \triangleq \blkrateslot/\slotduration$ in order to model PoW accurately. 
%
%
%
%
Finally, since $\goodsepbw, \goodsep$ were analysis parameters chosen arbitrarily, we maximize over these parameters to find the best possible security--performance tradeoff (\cref{thm:safety-and-liveness-pow}).
The result is plotted for $\DeltaHeader \approx 0$ (reasonable approximation for large block content relative to headers) in \cref{fig:comparison-bddelay-bdbandwidth}.



\begin{restatable}{theorem}{RestateThmSafetyAndLivenessPow}
%
\label{thm:safety-and-liveness-pow}
For all $\beta < 1/2$,
$\blkratetime > 0$,
such that
\begin{IEEEeqnarray}{C}
\label{eq:pow-max-tp}
    \blkratetime < \max_{\goodsepbw} \frac{1}{\DeltaHeader + \goodsepbw/\bwtime} \ln\left( \frac{2(1-\beta)\goodsepbw}{\goodsepbw+4 + \sqrt{8\goodsepbw+16}} \right),
    \IEEEeqnarraynumspace
\end{IEEEeqnarray}
the PoW Nakamoto consensus protocol 
%
with 
the \rulelc download rule,
%
$\slotduration \to 0$,
$\blkrateslot = \blkratetime \slotduration$,
and
$\confDepth = \Theta(\kappa^2)$
is secure
with 
transaction rate $(\frac{1}{2}-\beta)\blkratetime$,
confirmation latency
%
$\Theta(\kappa^2)$ 
over a time horizon of 
$\Thorizon = \poly(\kappa)$.
%
\end{restatable}

\Cref{thm:safety-and-liveness-pow} is proved in \cref{sec:fullproof-pow}.


%
%
%
%
%
%
%
%
%
%
    
    
%
%
    
    
%
%
%
%
%
%
%
%
    
    
%
%
%
%
%
%



