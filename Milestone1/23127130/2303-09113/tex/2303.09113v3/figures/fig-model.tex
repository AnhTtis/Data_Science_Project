\begin{figure}[tb]%
    \centering%
    \begin{tikzpicture}[x=1.9cm]
        \footnotesize

        \node[cloud,draw=none,fill=black!5,minimum width=3cm,minimum height=1.8cm] (cloud) at (0.5,-2.17) {};

        %
        \node [align=left,anchor=west] at (-2,-2) {\textsc{Content}\\\textsc{Downloading}};
        \node [align=left,anchor=west] at (-2,1) {\textsc{Header}\\\textsc{Flooding}};

        \node [inner sep=2pt] (u1) at (-1,0) {\includegraphics[width=0.7cm]{icon-honest-emoji_u1f464.png}};
        \node [inner sep=2pt] (u2) at (0,0) {\includegraphics[width=0.7cm]{icon-honest-emoji_u1f464.png}};
        \node [inner sep=2pt] (u3) at (1,0) {\includegraphics[width=0.7cm]{icon-honest-emoji_u1f464.png}};
        \node [inner sep=2pt] (a) at (2,0) {\includegraphics[width=0.7cm]{icon-adversarial2-emoji_u1f608.png}};

        \def\TMPBLOCKCONTENT{\node [anchor=center] at (0.5,-0.65) {\tiny$\txs_2$};}

        \node (blkNew) at (-1.3,-0.7) {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!80] (0,0) rectangle (1,-0.3); \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); \TMPBLOCKCONTENT }};
        \node (blkNewSplit) at (-0.7,-0.7) {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!80] (0,0.2) rectangle (1,-0.1); \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); \TMPBLOCKCONTENT }};

        \draw [-latex] (blkNew) -- (blkNewSplit);
        \draw [-latex] (blkNewSplit) |- (0,1) node [above] {Delay $\leq\DeltaHeader$} -- (u2) node [midway,right] {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!80] (0,0) rectangle (1,-0.3); }};
        \draw [-latex] (blkNewSplit) |- (1,1) -- (u3) node [midway,left] {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!80] (0,0) rectangle (1,-0.3); }};

        \draw [-latex,myParula07Red] [bend right] (a) to (u3);
        \node [yshift=1.5em,anchor=south] at (1.5,0) {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!80] (0,0) rectangle (1,-0.3); }};
        \draw [-latex,myParula07Red] [bend left] (a) to (u3);
        \node [yshift=-1.5em,anchor=north] at (1.5,0) {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); }};

        \begin{scope}[yshift=-2em]
            \node (repoHeader) at (0.25,-1.25) {\scriptsize\textbf{Header}};
            \node (repoContent) at (0.75,-1.25) {\scriptsize\textbf{Content}};
            \node at (0.25,-1.5) {\scriptsize$\Chain_1$};
            \node at (0.75,-1.5) {\scriptsize$\txs_1$};
            \node at (0.25,-1.75) {\scriptsize$\Chain_2$};
            \node at (0.75,-1.75) {\scriptsize$\txs_2$};
            \node at (0.25,-2.05) {\scriptsize$\svdots$};
            \node (repoDots) at (0.75,-2.05) {\scriptsize$\svdots$};
        \end{scope}

        \draw [-latex] (blkNewSplit) -- (repoHeader) node [midway,below left,xshift=2pt,yshift=2pt] {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); \TMPBLOCKCONTENT }};

        \draw [-latex] ([xshift=-2pt]u2.south) -- ([xshift=-2pt]repoHeader.north) node [pos=0.3,left] {\scriptsize Req. $\Chain_2$};
        \draw [-latex] ([xshift=2pt]repoHeader.north) -- ([xshift=2pt]u2.south) node [pos=0.7,above right,xshift=-2pt,yshift=-2pt] {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); \TMPBLOCKCONTENT }};

        \draw [-latex] ([xshift=-2pt]u3.south) -- ([xshift=-2pt]repoContent.north) node [pos=0.3,left] {\scriptsize Req. $\Chain_2$};
        \draw [-latex] ([xshift=2pt]repoContent.north) -- ([xshift=2pt]u3.south) node [pos=0.7,below right,xshift=-2pt,yshift=2pt] {\tikz[x=12pt,y=10pt]{ \draw [fill=gray!20] (0,-0.3) rectangle (1,-1); \TMPBLOCKCONTENT }};

        \draw [myParula02Orange] (repoHeader.north) ++ (45:0.25) arc(45:135:0.25);
        \draw [myParula02Orange] (repoContent.north) ++ (45:0.25) arc(45:135:0.25);
        \node [myParula02Orange,align=center,anchor=north] at (0.5,-1.02) {\tiny Bandwidth\\\tiny $\bwtime$};

        \draw ($(repoHeader.north west)+(0,-0.05)$) rectangle (repoDots.south east -| repoContent.north east);

        \node [] at (-1,-1.0) {\circledScriptBlackSlim{\textbf{1}}};
        \node [] at (-0.5,-1.8) {\circledScriptBlackSlim{\textbf{3}}};
        \node [] at (0.5,1.3) {\circledScriptBlackSlim{\textbf{2}}};
        \node [] at (0.60,-0.3) {\circledScriptBlackSlim{\textbf{4}}};
        \node [] at (1.5,0) {\circledScriptBlackSlim{\textbf{5}}};

    \end{tikzpicture}%
    \caption[]{%
        Bandwidth constrained network model~\cite[Fig.~4]{bwlimitedposlc}:
        %
        %
        %
        \circledScriptBlackSlim{1} Honest node produces a block, made of header and content. A hash in the header commits to the content.
        %
        \circledScriptBlackSlim{2} Header is flooded ($\Env.\Call{broadcastHeaderChain}{}$), and arrives at all nodes ($\protocol.\Call{receivedHeaderChain}{}$) with at most $\DeltaHeader$ delay.
        %
        \circledScriptBlackSlim{3} Content is made available for peer-to-peer pull-based download ($\Env.\Call{uploadContent}{}$).
        %
        \circledScriptBlackSlim{4} Content associated with the header is downloaded ($\protocol.\Call{receivedContent}{}$), subject to a maximum rate of~$\bwtime$.
        %
        \circledScriptBlackSlim{5} The adversary can push headers and content to nodes, bypassing the delay and bandwidth constraints.
        %
        %
        %
        %
    }
    \label{fig:model}
\end{figure}