\pdfoutput = 1

\documentclass[reprint,prb,nofootinbib]{revtex4-2}

\usepackage{tikz}
\usetikzlibrary{decorations,decorations.pathmorphing,decorations.markings,calc,snakes,positioning,fixedpointarithmetic,shapes,shapes.geometric,patterns}

\usepackage{etoolbox}
\AtBeginEnvironment{tikzpicture}{\catcode`$=3 } % $ % was important for auctex preview??

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% tikz commands for drawing tensor networks %%%%%%%%%%%%%%%%%%%%

% Tensors are represented by either
% 1) Geometric shapes of fixed size. A label can be placed next to the shape in order to distinguish tensors of different shape. Repetedly used shapes are defined as pics in this preamble. Those pics also define anchor points for the index line, in the form of "picname-l", where "l" can be some letter. "l", "r", "t", "b", "c" stand for "left", "right", "top", "bottom", "center". For round shapes, "picname-c" usually defines a node. Watch out to add the "transform shape" key to nodes such that they are rotated.
% 2) A rectangular box node with the label inside. Repetedly used box styles are defined as tikz styles.


\tikzset{alignmid/.style={baseline={([yshift=-.5ex]current bounding box.center)}}} % adjust pictures vertically
\tikzset{every picture/.append style=alignmid}


% shortcuts for line styles
\tikzset{
bottomzigzag/.style={postaction={draw,decorate, decoration={zigzag,amplitude=1pt,segment length=3pt,raise=1pt}}},
zigzag/.style={draw,decorate, decoration={zigzag,amplitude=1pt,segment length=3pt}},
rc/.style=rounded corners,
}

% for giving arguments to a -| line
\tikzset{
    -|/.style={to path={-| (\tikztotarget)}},
    |-/.style={to path={|- (\tikztotarget)}},
}



%%%%%%%%%%%%%%%%%%%%%%%% begin deprecated %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{ifthen}
\usepackage{xparse,pgffor}

% dots at end of line
% \tikzset{enddots/.style= {postaction=decorate,decoration={name=markings,mark=at position 1 with{
%     \ifdimless{\pgflinewidth}{1pt}{\newcommand\dotlw{1pt}}{\newcommand\dotlw{\pgflinewidth}}
%     \ifdimless{\pgflinewidth}{1.5pt}{\newcommand\dotdist{1.5pt}}{\newcommand\dotdist{\pgflinewidth}}
%     \fill (1*\dotdist,0) circle (0.5*\dotlw);
%     \fill (2.5*\dotdist,0) circle (0.5*\dotlw);
%     \fill (4*\dotdist,0) circle (0.5*\dotlw);
% }}}}
% \tikzset{startdots/.style= {postaction=decorate,decoration={name=markings,mark=at position 0 with{
%    \ifdimless{\pgflinewidth}{1pt}{\newcommand\dotlw{1pt}}{\newcommand\dotlw{\pgflinewidth}}
%    \ifdimless{\pgflinewidth}{1.5pt}{\newcommand\dotdist{1.5pt}}{\newcommand\dotdist{\pgflinewidth}}
%    \fill (-1*\dotdist,0) circle (0.5*\dotlw);
%    \fill (-2.5*\dotdist,0) circle (0.5*\dotlw);
%    \fill (-4*\dotdist,0) circle (0.5*\dotlw);
% }}}}


% % labels at the middle of a line
% \tikzset{midlabeldistance/.store in=\midlabeldistance,midlabeldistance=0.2}
% \tikzset{midlabelpos/.store in=\midlabelpos,midlabelpos=0.5}
% \tikzset{midlabel/.style={decoration={markings, mark=at position \midlabelpos with {\node at (0,\midlabeldistance) {#1};}}, postaction={decorate}}}
% \tikzset{midlabelr/.style={decoration={markings, mark=at position \midlabelpos with {\node at (0,-\midlabeldistance) {#1};}}, postaction={decorate}}}

% % arrow indicating the contraction direction
% \tikzset{cdirpos/.store in=\cdirpos,cdirpos=0.5}
% \tikzset{cdir/.style={postaction=decorate,decoration={name=markings,mark=at position \cdirpos with{
% %    \draw[solid,line width=0.7] (#1 0.04,0)--(-#1 0.04,0.08) (#1 0.04,0)--(-#1 0.04,-0.08);
%     \coordinate (y0) at (#1 0.04,0.5*\pgflinewidth);
%     \coordinate (y1) at (#1 0.04,-0.5*\pgflinewidth);
%     \draw[solid,line width=0.7] (y0)--++(#1 -0.08,0.08) (y1)--++(#1 -0.08,-0.08);
%   }}}}

% % arrow indicating the time flow
% \tikzset{ndirpos/.store in=\ndirpos,ndirpos=0.5}
% \tikzset{ndir/.style={postaction=decorate,decoration={name=markings,mark=at position \ndirpos with{
%     \draw[solid,semithick] (#1 -0.04,-0.08)arc(90-#1 180:90:0.08);
%   }}}}

% % arrow indicating dual indices
% \tikzset{dualind/.style={postaction=decorate,decoration={name=markings,mark=at position \pgfdecoratedpathlength-0.08cm with{
%     \draw[solid,line width=0.7] (-0.04,0)--(0.04,0.08) (-0.04,0)--(0.04,-0.08);
%   }}}}

% \tikzset{
% }
%%%%%%%%%%%%%%%%%%%%%%%% end deprecated %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tikzset{
mark/.code={
\tikzset{postaction={/network/mark/.cd,#1,/tikz/.cd,decorate},decoration={name=markings,mark=at position \netmarkpos with{%+\netmarkposoff} with{
\begin{scope}[netmarktrafo]
\netmarkcode
\end{scope}
}}}
\def\netmarkpos{0.5}%\pgfdecoratedpathlength}
},
}

% different markings on lines
\def\netmarkpos{0.5}%\pgfdecoratedpathlength}
\def\netmarkposoff{0cm}
\def\netmarkcode{}
\def\netmarkanchor{center}
\tikzset{
netmarktrafo/.style={},
netmarkstyle/.style={solid,semithick,sharp corners},
}

\pgfkeys{
/network/mark/.cd,
sty/.code={
\tikzset{netmarkstyle/.style={#1}}
},
asty/.code={
\tikzset{netmarkstyle/.append style={#1}}
},
f/.style={asty=fill},
p/.code={ % relative positioning on decorated line
\def\netmarkpos{#1}%\pgfdecoratedpathlength}
},
poff/.code={ % absolute shift on decorated line in cm
\def\netmarkposoff{#1cm}
},
e/.code={ % mark at the End of line
\def\netmarkpos{\pgfdecoratedpathlength-0.005cm-\netmarkposoff}
\def\netmarkanchor{\pgfdecoratedangle}
\tikzset{netmarktrafo/.append style={shift={(-\netmarkwidth,0)}}}
},
s/.code={ % mark at the Start of line
\def\netmarkpos{0.005cm+\netmarkposoff}
\def\netmarkanchor{\pgfdecoratedangle+180}
\tikzset{netmarktrafo/.append style={shift={(\netmarkwidth,0)},xscale=-1,yscale=-1}}
},
a/.code={ % mark After end of line
\def\netmarkpos{\pgfdecoratedpathlength-0.005cm}
\def\netmarkanchor{\pgfdecoratedangle+180}
\tikzset{netmarktrafo/.append style={xscale=-1,shift={(-\netmarkwidth,0)}}}
},
b/.code={ % mark Before start of line
\def\netmarkpos{0.005cm}
\def\netmarkanchor{\pgfdecoratedangle}
\tikzset{netmarktrafo/.append style={xscale=-1,shift={(\netmarkwidth,0),yscale=-1}}}
},
-/.code={ % flip horizontally (mark backwards)
\tikzset{netmarktrafo/.append style={xscale=-1}}
},
r/.code={ % flip vertically (mark on the Right instead of left)
\tikzset{netmarktrafo/.append style={yscale=-1}}
},
sideoff/.code={ % shift sideways
\tikzset{netmarktrafo/.append style={shift={(0,#1)}}}
},
slab/.code={ % label next to the line
\def\netmarkwidth{0}
\def\netmarkcode{
\node[inner sep=0.04cm,netmarkstyle,draw=none] (mylabelwidthtest) at (0,0){\phantom{#1}};
\path let \p1=(mylabelwidthtest.north east), \p2=(mylabelwidthtest.south east), \n1 = {max(abs(\y1),abs(\y2))} in node[inner sep=0.04cm,netmarkstyle] at (0,\n1) {#1};
}
},
lab/.code={ % label on the line
\def\netmarkwidth{0}
\def\netmarkcode{
\node[inner sep=0.04cm,anchor=\netmarkanchor] (mylabelwidthtest) at (0,0) {\phantom{#1}};
\draw[white] (mylabelwidthtest.\pgfdecoratedangle)--(mylabelwidthtest.\pgfdecoratedangle+180);
\node[inner sep=0.04cm,anchor=\netmarkanchor,netmarkstyle] at (0,0) {#1};
}
},
arr/.code={ % arrow
\def\netmarkwidth{0.04}
\def\netmarkcode{\draw[netmarkstyle] (-0.04,0.08)--(0.04,0)--(-0.04,-0.08);}
},
rarr/.code={ % round arrow
\def\netmarkwidth{0.04}
\def\netmarkcode{\draw[netmarkstyle] (-0.04,-0.08)arc(90-180:90:0.08);}
},
dot/.code={ % dot
\def\netmarkwidth{0.08}
\def\netmarkcode{\draw[netmarkstyle] (0,0)circle(0.08);}
},
flag/.code={ % flag to the left
\def\netmarkwidth{0.06}
\def\netmarkcode{\draw[netmarkstyle] (-0.06,0)--(0,0.09)--(0.06,0)--cycle;}
},
darr/.code={ % "double arrow": half-arrow on the left
\def\netmarkwidth{0.08}
\def\netmarkcode{\draw[netmarkstyle] (-0.04,0)--(0.04,0)--(-0.04,0.08)--cycle;}
},
hcirc/.code={ % half-circle on the left
\def\netmarkwidth{0.1}
\def\netmarkcode{\draw[netmarkstyle] (-0.1,0) arc (180:0:0.1);}
},
bar/.code={ % tick, short line perpendicular to line
\def\netmarkwidth{0.05}
\def\netmarkcode{
\draw[netmarkstyle] (0,-0.08cm-0.5*\pgflinewidth)--(0,0.08cm+0.5*\pgflinewidth);
}
},
hbar/.code={ % tick, short perpendicular line towards the left
\def\netmarkwidth{0.05}
\def\netmarkcode{
\draw[netmarkstyle] (0, 0.5*\pgflinewidth)--++(0,0.12);
}
},
mill/.code={
\def\netmarkwidth{0.16}
\def\netmarkcode{
\draw[netmarkstyle] (0,-0.5*\pgflinewidth)--++(-0.08,-0.08)--++(0,0.08);
\draw[netmarkstyle] (0,0.5*\pgflinewidth)--++(0.08,0.08)--++(0,-0.08);
}
},
three dots/.code={
\def\netmarkwidth{0.2}
\def\netmarkcode{
\fill (-0.12,0) circle (0.5*0.05) (0,0) circle (0.5*0.05) (0.12,0) circle (0.5*0.05);
}
},
}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% start deprecated %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% next-to-shape markers %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Markers that are put on the index line right next to a tensor, formally part of the tensor shape

% \tikzset{flags/.style={postaction=decorate,decoration={name=markings,mark=at position 0.06cm with{
%     \draw[fill,solid,semithick,sharp corners] (-0.06,0)--(0,#1 0.09)--(0.06,0)--cycle;
%   }}}}
% \tikzset{flage/.style={postaction=decorate,decoration={name=markings,mark=at position \pgfdecoratedpathlength -0.06cm with{
%     \draw[fill,solid,semithick,sharp corners] (-0.06,0)--(0,#1 0.09)--(0.06,0)--cycle;
%   }}}}

% \tikzset{arrs/.style={postaction=decorate,decoration={name=markings,mark=at position 0.04 cm with{
%     \fill[sharp corners] (-#1 0.03,0.07)--(#1 0.05,0)--(-#1 0.03,-0.07);
%   }}}}
% \tikzset{arre/.style={postaction=decorate,decoration={name=markings,mark=at position \pgfdecoratedpathlength -0.04 cm with{
%     \fill[sharp corners] (-#1 0.03,0.07)--(#1 0.05,0)--(-#1 0.03,-0.07);
%   }}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Different box tensor styles %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% shortcuts for minimum width and miminum height
\tikzset{wid/.style={minimum width=#1cm}}
\tikzset{hei/.style={minimum height=#1cm}}

% shortcuts for shifting anchors on box nodes
\tikzset{sx/.style={xshift=#1cm}}
\tikzset{sy/.style={yshift=#1cm}}

% fat or regular, round or sharp boxes.
\tikzset{box/.style={draw,rectangle}}
\tikzset{fbox/.style={draw,rectangle, line width=1.1}}
\tikzset{roundbox/.style={draw,rectangle,rounded corners}}
\tikzset{froundbox/.style={draw,rectangle, rounded corners, line width=1.1}}
\tikzset{rounddiamond/.style={draw,diamond,rounded corners}}
\tikzset{dot/.style={draw, shape=circle, fill=black, scale=0.5}}

\tikzset{
netbox/.code={
\node[draw,netbdstyle] (\atomname) at (0,0) {#1};
\coordinate (\atomname-r) at (\atomname.east);
\coordinate (\atomname-l) at (\atomname.west);
\coordinate (\atomname-t) at (\atomname.north);
\coordinate (\atomname-b) at (\atomname.south);
\coordinate (\atomname-tr) at (\atomname.north east);
\coordinate (\atomname-br) at (\atomname.south east);
\coordinate (\atomname-tl) at (\atomname.north west);
\coordinate (\atomname-bl) at (\atomname.south west);
},
}


\tikzset{bdlw/.code={\tikzset{mybdstyle/.style={draw, line width=#1}}}}
\tikzset{bdcol/.code={\tikzset{mybdstyle/.append style={#1}}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% end deprecated %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






% define new elements
\newcommand\setelements[1]{
\pgfkeys{/network/atom/.cd,#1}
}

% define new elements
\newcommand\setmarks[1]{
\pgfkeys{/network/mark/.cd,#1}
}

% user level command
\newcommand\atoms[2]{
\foreach \name/\keys in {#2}{
\expandafter\atom\expandafter{\keys,#1}{\name}
}
}

\newcommand\atom[2]{
% pre-assignments for the keys
\def\atomname{#2}
\tikzset{
nettrafo/.style={},
netatompos/.style={},
netdeco/.style={},
netpostdeco/.style={},
}

% executing atom keys
\pgfkeys{/network/atom/.cd,#1}

\begin{scope}[netatompos] % shift to atom position
\begin{scope}[nettrafo] % rotate, flip and scale
\netshapecoords % set the anchor coordinates
\fill[netbackstyle] \netshapepath;
\clip \netshapepath;
\tikzset{netdeco}
\draw[netbdstyle] \netshapepath;
\end{scope}
\tikzset{netpostdeco} % draw post-decorations, not rotated, flipped, or scaled
\end{scope}

}


% shapes: define path and coordinates
\pgfkeys{
/network/atom/.cd,
square/.code={
\def\tempsize{0.18}
\def\netshapepath{(-\tempsize,-\tempsize)rectangle (\tempsize,\tempsize)}
\def\netshapecoords{
\node[rectangle,wid=2*\tempsize,hei=2*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate(\atomname-r) at (\tempsize,0);
\coordinate(\atomname-l) at (-\tempsize,0);
\coordinate(\atomname-t) at (0,\tempsize);
\coordinate(\atomname-b) at (0,-\tempsize);
\coordinate(\atomname-br) at (\tempsize,-\tempsize);
\coordinate(\atomname-tr) at (\tempsize,\tempsize);
\coordinate(\atomname-bl) at (-\tempsize,-\tempsize);
\coordinate(\atomname-tl) at (-\tempsize,\tempsize);
}},
circ/.code={
\def\tempsize{0.18}
\def\netshapepath{(0,0)circle(\tempsize)}
\def\netshapecoords{
\node[circle,wid=2*\tempsize,hei=2*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate(\atomname-r) at (\tempsize,0);
\coordinate(\atomname-l) at (-\tempsize,0);
\coordinate(\atomname-t) at (0,\tempsize);
\coordinate(\atomname-b) at (0,-\tempsize);
}},
triang/.code={
\def\tempsize{0.23}
\def\netshapepath{(-30:\tempsize)--(90:\tempsize)--(-150:\tempsize)--cycle}
\def\netshapecoords{
\node[regular polygon,regular polygon sides=3,wid=2*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate(\atomname-cr) at (-30:\tempsize);
\coordinate(\atomname-cl) at (-150:\tempsize);
\coordinate(\atomname-ct) at (90:\tempsize);
\coordinate(\atomname-mb) at (-90:0.5*\tempsize);
\coordinate(\atomname-mr) at (30:0.5*\tempsize);
\coordinate(\atomname-ml) at (150:0.5*\tempsize);
}},
diamond/.code={
\def\tempsize{0.23}
\def\netshapepath{(0,-\tempsize)--(\tempsize,0)--(0,\tempsize)--(-\tempsize,0)--cycle}
\def\netshapecoords{
\node[rotate=45,rectangle,wid=sqrt(2)*\tempsize,hei=sqrt(2)*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate(\atomname-r) at (\tempsize,0);
\coordinate(\atomname-l) at (-\tempsize,0);
\coordinate(\atomname-t) at (0,\tempsize);
\coordinate(\atomname-b) at (0,-\tempsize);
}},
pentagon/.code={
\def\tempsize{0.23}
\def\netshapepath{(-126:\tempsize)--(-54:\tempsize)--(18:\tempsize)--(90:\tempsize)--(162:\tempsize)--cycle}
\def\netshapecoords{
\node[regular polygon,regular polygon sides=5,wid=2*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate (\atomname-mb)at(-90:{\tempsize*cos(36)});
\coordinate (\atomname-mbr)at(-18:{\tempsize*cos(36)});
\coordinate (\atomname-mtr)at(54:{\tempsize*cos(36)});
\coordinate (\atomname-mtl)at(126:{\tempsize*cos(36)});
\coordinate (\atomname-mbl)at(-162:{\tempsize*cos(36)});
\coordinate (\atomname-cbr)at(-54:\tempsize);
\coordinate (\atomname-cr)at(18:\tempsize);
\coordinate (\atomname-ct)at(90:\tempsize);
\coordinate (\atomname-cl)at(162:\tempsize);
\coordinate (\atomname-cbl)at(-126:\tempsize);
}},
halfcirc/.code={
\def\tempsize{0.18}
\def\netshapepath{(\tempsize,0)arc(0:180:\tempsize)--++(0,-0.04)-|cycle}
\def\netshapecoords{
\node[circle,wid=2*\tempsize,hei=2*\tempsize,inner sep=0,transform shape](\atomname)at(0,0){};
\coordinate(\atomname-c) at (0,0);
\coordinate(\atomname-r) at (\tempsize,0);
\coordinate(\atomname-l) at (-\tempsize,0);
\coordinate(\atomname-t) at (0,\tempsize);
\coordinate(\atomname-b) at (0,0);
}},
void/.code={
\def\netshapepath{}
%\def\netshapepath{(0,0)}
\def\netshapecoords{
\coordinate(\atomname) at (0,0);
\coordinate(\atomname-c) at (0,0);
}},
labbox/.code={
\def\netshapepath{(0,0)}
\def\netshapecoords{}
\tikzset{netpostdeco/.append style={netbox=#1}}
},
}

% transformation keys
\pgfkeys{
/network/atom/.cd,
p/.code={\tikzset{netatompos/.append style={shift={(#1)}}}},
xscale/.code={\tikzset{nettrafo/.append style={xscale=#1}}},
yscale/.code={\tikzset{nettrafo/.append style={yscale=#1}}},
scale/.code={\tikzset{nettrafo/.append style={scale=#1}}},
rot/.code={\tikzset{nettrafo/.append style={rotate=#1}}},
hflip/.style={xscale=-1},
vflip/.style={yscale=-1},
big/.style={scale=3/2},
small/.style={scale=2/3},
huge/.style={scale=9/4},
tiny/.style={scale=4/9},
flat/.style={yscale=2/3},
fflat/.style={yscale=4/9},
}

% setting keys
\tikzset{
netbdstyle/.style={line width=0.15em}, % changed from pt(default)
netdecstyle/.style={},
netpostdecstyle/.style={},
netbackstyle/.style={white},
}
\pgfkeys{
/network/atom/.cd,
bdstyle/.code={\tikzset{netbdstyle/.style={#1}}},
bdastyle/.code={\tikzset{netbdstyle/.append style={#1}}},
decstyle/.code={\tikzset{netdecstyle/.style={#1}}},
decastyle/.code={\tikzset{netdecstyle/.append style={#1}}},
postdecstyle/.code={\tikzset{netpostdecstyle/.style={#1}}},
postdecastyle/.code={\tikzset{netpostdecstyle/.append style={#1}}},
backstyle/.code={\tikzset{netbackstyle/.style={#1}}},
backastyle/.code={\tikzset{netbackstyle/.append style={#1}}},
style/.style={bdstyle=#1, decstyle=#1, postdecstyle=#1},
astyle/.style={bdastyle=#1, decastyle=#1, postdecastyle=#1},
whiteblack/.style={decstyle=white,backstyle=black},
nobd/.code={bdstyle={line width=0}},
}

% user level decorations
\tikzset{
netbscope/.code={\begin{scope}[#1]},
netescope/.code={\end{scope}},
}

\pgfkeys{
/network/atom/.cd,
bscope/.code={\tikzset{netdeco/.append style={netbscope={#1}}}},
escope/.code={\tikzset{netdeco/.append style={netescope}}},
dec/.style 2 args={bscope={#1},#2,escope}, % for applying transformation keys to certain decorations only
vbar/.style={dec={rotate=90}{hbar}},
dcross/.style={dec={rotate=45}{hbar},dec={rotate=-45}{hbar}},
cross/.style={hbar,vbar},
sect6/.style={sect=60},
sect8/.style={sect=45},
sect10/.style={sect=36},
}

% register decorations
\def\regdec#1{\pgfkeys{/network/atom/.cd,#1/.code={\tikzset{netdeco/.append style={net#1}}}}}
\regdec{all}\regdec{rhalf}\regdec{rquart}\regdec{brquart}\regdec{dot}\regdec{spiral}\regdec{swirl}\regdec{hstripe}\regdec{hbar}\regdec{rrey}
\pgfkeys{/network/atom/.cd,sect/.code={\tikzset{netdeco/.append style={netsect=#1}}}}

% low level decorations
\tikzset{
netall/.code={\fill[netdecstyle] (-0.3,-0.3)rectangle (0.3,0.3);}, % fill all
netrhalf/.code={\fill[netdecstyle] (0,-0.3)rectangle (0.3,0.3);}, % right half
netrquart/.code={\fill[netdecstyle] (0.075,-0.3)rectangle (0.3,0.3);}, % right quarter
netbrquart/.code={\fill[netdecstyle] (0,0)rectangle (0.3,-0.3);}, % bottom right quarter
netsect/.code={\fill[netdecstyle] (0,0)--(0,-0.3)arc(-90:-90+#1:0.3)--cycle;}, % section of angle #1 starting from -90
netdot/.code={\fill[netdecstyle] (0,0)circle(0.07);}, % dot in the middle
netspiral/.code={\draw[netdecstyle] plot [variable=\t,domain=0:4] ({0.075*\t*cos(pi*(\t-0.5) r)},{0.075*\t*sin(pi*(\t-0.5) r)});}, % spiral
netswirl/.code={\fill[netdecstyle] plot [variable=\t,domain=0:2] ({0.15*\t*cos(pi*(\t-0.5) r)},{0.15*\t*sin(pi*(\t-0.5) r)}) arc(-90:-450:0.3)--cycle;}, % filled swirl
nethstripe/.code={\fill[netdecstyle] (-0.3,-0.05)rectangle(0.3,0.05);}, % horizontal stripe
nethbar/.code={\draw[netdecstyle] (-0.3,0)--(0.3,0);}, % horizontal line
netrrey/.code={\draw[netdecstyle] (0,0)--(0.3,0);} % line from the middle to the right
}

% user level after-decorations
\pgfkeys{
/network/atom/.cd,
postbscope/.code={\tikzset{netpostdeco/.append style={netbscope={#1}}}},
postescope/.code={\tikzset{netpostdeco/.append style={netescope}}},
postdec/.style 2 args={postbscope={#1},#2,postescope}, % for applying transformation keys to certain decorations only
arc/.code={\tikzset{netpostdeco/.append style={netarc=#1}}},
lab/.code={\tikzset{netpostdeco/.append style={netlab={#1}}}},
shadecirc/.code={\tikzset{netpostdeco/.append style=netshadecirc}},
shaderect/.code={\tikzset{netpostdeco/.append style={netshaderect={#1}}}},
debug/.code={\tikzset{netpostdeco/.append style=netdebug}},
markline/.code 2 args={\tikzset{netpostdeco/.append style={netmarkline={#1}{#2}}}},
postcirc/.code={\tikzset{netpostdeco/.append style=netpostcirc}},
}

% low level after-decorations
\tikzset{
netlab/.code={
\pgfkeys{/network/atom/lab/.cd,#1}
\node[netpostdecstyle] at (\ifdefined\netlabpos\netlabpos\else\netlabang:\netlabdist\fi) {\netlabwrap{\netlabtext}};
},
netarc/.code args={#1:#2:#3}{
\draw[netpostdecstyle] (#1:#3) arc (#1:#2:#3);
},
netshadecirc/.code= {
\fill[opacity=0.4,netpostdecstyle] (0,0)circle(0.4);
},
netpostcirc/.code= {
\draw[netpostdecstyle] (0,0)circle(0.15);
},
netshaderect/.code= {
\fill[rc,opacity=0.4,netpostdecstyle] ($-1*(#1)$) rectangle (#1);
},
netdebug/.code= {
\node[red] at (0,0){\atomname};
},
netmarkline/.code 2 args= {
\draw (\atomname)edge[mark={#2}]++(#1);
%\draw (0,0)edge[mark={#2}]++(#1);
},
}

% labels
\def\netlabwrap#1{#1}
\pgfkeys{
/network/atom/lab/.cd,
t/.code={\def\netlabtext{#1}}, % label text
p/.code={\def\netlabpos{#1}}, % position of the label
ang/.code={\def\netlabang{#1}},
dist/.code={\def\netlabdist{#1}},
wrap/.code={\def\netlabwrap##1{#1}}, % store in doesn't work
}





\usetikzlibrary{patterns.meta}

\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{mydef}{Definition}
\newtheorem{myprop}{Proposition}

\usepackage{bbold}
\usepackage{mathtools}
\usepackage{hyperref}
\usepackage{makecell}
\usepackage{braket}

\newcommand\todo[1]{\textcolor{red}{\textbf{#1}}}

\def\zz{\mathbb{Z}}
\def\cc{\mathbb{C}}
\def\pcoc{P_{\text{cocycle}}}

% colors for vertices in different levels
\definecolor{darkgreen}{rgb}{0,0.6,0.2}
\definecolor{darkyellow}{rgb}{0.7,0.5,0}
\newcommand{\vca}[1]{\textcolor{red}{#1}}
\newcommand{\vcb}[1]{\textcolor{darkgreen}{#1}}
\newcommand{\vcc}[1]{\textcolor{blue}{#1}}
\newcommand{\vcd}[1]{\textcolor{darkyellow}{#1}}

\tikzset{
ind/.style={mark={lab=#1,a}}, % normal open index label
startind/.style={mark={lab=#1,b}}, % normal open index label
classical/.style={line width=1.5},
quantum/.style={double,double distance=0.5mm},
actualedge/.style={line width=2},
anyon1gon/.style={fill=red,fill opacity=0.2,text opacity=1},
%e or not/.style={postaction={draw,red,dash pattern= on 3pt off 3pt,dash phase=3pt}},
e or not/.style={preaction={draw,very thick,red!50}},
%m or not/.style={pattern=checkerboard,pattern color=red,opacity=0.3},
m or not/.style={pattern={Hatch[distance=1.2mm,line width=0.3mm,angle=45]},pattern color=red,opacity=0.3},
front/.style={preaction={draw,white,line width=2}},
}

\setmarks{
ar/.style={arr,asty=fill},
}

% network elements
\setelements{
z2/.style={small,circ},
delta/.style={small,circ,all}, % delta tensor in toric-code path integral
deltatens/.style={tiny,circ,all}, % delta tensor for general purpose
cc/.style={small,circ,dcross},
hadamard/.style={small,square,dcross},
smat/.style={small,square,all},
umat/.style={small,square},
vertex/.style={tiny,circ,all},
vca/.style={astyle=red},
vcb/.style={style=darkgreen},
vcc/.style={style=blue},
vcd/.style={style=darkyellow},
}

\begin{document}

\title{Topological error correcting processes from fixed-point path integrals}
\author{Andreas Bauer}
\email{andibauer@zedat.fu-berlin.de}
\affiliation{Freie Universit{\"a}t Berlin, Arnimallee 14, 14195 Berlin, Germany}
\date{\today}

\begin{abstract}
We propose a unifying paradigm for analyzing and constructing topological quantum error correcting codes as dynamical circuits of geometrically local channels and measurements.
To this end, we relate such circuits to discrete fixed-point path integrals in Euclidean spacetime, which describe the underlying topological order:
If we fix a history of measurement outcomes, we obtain a fixed-point path integral carrying a pattern of topological defects.
As an example, we show that the stabilizer toric code, subsystem toric code, and CSS Floquet code can be viewed as one and the same code on different spacetime lattices, and the honeycomb Floquet code is equivalent to the CSS Floquet code under a change of basis.
We also use our formalism to derive two new error-correcting codes, namely a Floquet version of the $3+1$-dimensional toric code using only 2-body measurements, as well as a Floquet-like code based on the double-semion string-net path integral.
\end{abstract}

\maketitle
\tableofcontents

\section{Introduction}
One of the most promising routes towards scalable fault-tolerant quantum computation is topological quantum computation, where logical quantum information is stored in the ground state space of a topological phase on a topologically non-trivial spatial configuration \cite{Kitaev1997,Dennis2001,Nayak2007}.
Topological order has been shown to be robust under arbitrary local perturbations \cite{Bravyi2010}.
Similar in spirit, it is believed that topological quantum error correction (QEC) offers a threshold for arbitrary local noise.
Despite the similarity, those two notions of robustness are technically very different:
Whereas topological order concerns ground-state properties which are captured by the imaginary-time evolution, topological QEC executes a real-time evolution including syndrome measurements, noise, and corrections.

Both topological phases and topological QEC can be described by path integrals which are discrete in time and space.
For QEC, those are simply mixed-state circuits of quantum channels and measurements.
For topological phases, those are fixed-point models in the form of state-sum TQFTs \cite{Fukuma1992,Dijkgraaf1990,Turaev1992,Barrett1993,Crane1993} or tensor-network path integrals \cite{liquid_intro}.
These can classify topological phases due to their exact combinatorial topological invariance.
In this paper, we present a picture for topological QEC, at whose core is the relation between those two discrete path integrals.

Recently, the long established formalisms of topological stabilizer codes and subsystem codes \cite{Kribs2004,Bombin2009,Bravyi2012} have been challenged by the discovery of \emph{Floquet codes} \cite{Hastings2021,Kesselring2022,Davydova2022,Aasen2022}.
Floquet codes are determined by a sequence of gauge checks measured in a fixed schedule.
They manage to protect a certain amount of logical qubits, even though when viewing the gauge checks as a subsystem code, the latter would have less logical qubits or none at all.
This calls for a unified picture in which stabilizer, subsystem, as well as Floquet codes can be understood.
This work provides such a picture by connecting the QEC circuit of measurements to a fixed-point Euclidean-spacetime path integral of a topological phase.

On the one hand, our framework provides a way to systematically analyze existing codes.
In particular, we provide a clear definition for the phase of any topological code.
The phase determines the dimension of the logical subspace on different topologies, and the logical operations that can be performed.
On the other hand, our formalism also allows for the systematic construction of new codes as we demonstrate at hand of two examples.
We present a simple criterion, which guarantees that arbitrary errors of size $\lesssim \frac{L}{2}$ can be corrected by the code.
In Section~\ref{sec:general_formalism}, we discuss the general formalism relating topological fixed-point path integrals and error-correcting codes.

In Section~\ref{sec:examples}, we use our formalism to analyze existing topological codes.
We find that the stabilizer toric code, the subsystem toric code, and the CSS Floquet code correspond to the same path integral on different spacetime lattices.
So in our spacetime perspective all three are the same code, in the same way as traditionally, the toric code on a square and on a hexagonal lattice would both be considered toric codes.
We also find that the CSS Floquet code and the honeycomb Floquet code are directly equivalent under a local change of basis, which becomes apparent when viewed in spacetime.

In Section~\ref{sec:3d_toric_code}, we use our formalism to construct two new codes.
First, we construct a Floquet version of the $3+1$-dimensional toric code which uses only 2-body $XX$ and $ZZ$ measurements.
The code lives on a triangulation with 4-colorable vertices, with a qubit on every left-handed tetrahedron.
In each of 8 rounds we perform measurements on the qubits adjacent to each edges of a certain type.
Second, we present a non-Pauli and non-stabilizer Floquet-like code based on the double-semion Turaev-Viro path integral, consisting of 6-qubit measurements (which could be further decomposed).

\section{From fixed-point path integrals to error-correcting codes}
\label{sec:general_formalism}
\subsection{Fixed-point path integrals}
\label{sec:fixed_points}
In this section, we review fixed-point path integrals for topological phases, which are the key to understanding and constructing topological QEC codes in this work.
Fixed-point path integrals are defined on lattices representing a discrete Euclidean-signature spacetime.
The most common formulation of such path integrals is as \emph{state sums} \cite{Fukuma1992,Dijkgraaf1990,Turaev1992,Barrett1993,Crane1993}.
To this end we associate discrete variables to certain types of places (for example, all edges) in the lattice, and weights to other places (for example, all volumes).
Each weight depends on the configuration of the nearby variables.
We then perform a sum over all configurations of the variables, where the summand is given by the product of all the weights.
Such path integrals are commonly used as partition functions in classical statistical physics on a space-only lattice, for example in the Ising model.
Here we will use them on a spacetime lattice to represent the imaginary-time evolution of a quantum system.

An equivalent formulation which is better suited for our purpose are \emph{tensor-network path integrals} \cite{liquid_intro}.
Those are tensor networks whose tensors are located at some places (for example, all volumes) of the spacetime lattice, and nearby tensors share bonds (for example, at every face, connecting the two adjacent volumes).
Note that this is different from MPS or PEPS which live in space only and describe states, not path integrals.
In particular, tensor-network path integrals have no open indices except for when we cut the tensor network at some ``spatial'' surface, and there is no distinction between ``physical'' and ``virtual'' indices.

Topological fixed-point path integrals have one single powerful property which makes them exactly solvable, namely discrete topological invariance.
To this end, we first define the path integral not only on regular lattices, but on arbitrary triangulations or cellulations.
Let us consider here the case of $2+1$ dimensions where most of topological error correction takes place.
One possibility is to put the same 4-index tensor (in black) onto every tetrahedron of a 3-dimensional triangulation (in orange),
\begin{equation}
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.5,0}, 2/p={1,0.5}, 3/p={0.75,1.3}}
\draw[orange] (0)--(1)--(3)--(0);
\draw[orange,dashed] (0)--(2) (1)--(2) (3)--(2);
\atoms{circ,small,dot}{t/p={0.9,0.5}}
\draw (t)--++(135:0.8) (t)--++(-90:0.8) (t)--++(30:0.8) (t)--++(-130:0.4);
\end{tikzpicture}\;.
\end{equation}
Then, we choose a set of local deformations, which can arbitrarily change the lattice while keeping its overall topology fixed.
The local deformations of the lattice correspond to changing the tensor network by cutting out a small patch and gluing in another patch.
Topological invariance of the path integral is imposed by equating the cut-out and glued-in patches.
In our above example, we can demand invariance under \emph{Pachner moves} \cite{Pachner1991}, such as
\begin{equation}
\label{eq:pachner_move_equation}
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.5,0}, 2/p={1,0.5}, 3/p={0.75,1.3}, 4/p={0.75,-1.3}}
\draw[orange] (0)--(1)--(3)--(0) (0)--(4)--(1);
\draw[orange,dashed] (0)--(2) (1)--(2) (3)--(2) (4)--(2);
\atoms{circ,small,dot}{t1/p={0.9,0.5}, t2/p={0.9,-0.3}}
\draw (t1)--++(135:0.8) (t1)--++(30:0.8) (t1)--++(-130:0.4) (t2)--++(-135:0.8) (t2)--++(-30:0.8) (t2)--++(-80:0.4) (t1)--(t2);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.5,0}, 2/p={1,0.5}, 3/p={0.75,1.3}, 4/p={0.75,-1.3}}
\draw[orange] (0)--(1)--(3)--(0) (0)--(4)--(1);
\draw[orange,dashed] (0)--(2) (1)--(2) (3)--(2) (4)--(2);
\draw[orange,densely dotted] (3)--(4);
\atoms{circ,small,dot}{t1/p={0.75,0}, t2/p={0.5,0.25}, t3/p={1.25,0.25}}
\draw (t2)--++(135:0.7) (t2)--++(-135:0.7) (t1)--++(-80:0.4) (t1)--++(80:0.4) (t3)--++(-30:0.6) (t3)--++(30:0.6) (t1)--(t2)--(t3)--(t1);
\end{tikzpicture}\;.
\end{equation}
On the left hand side, we have two tetrahedra stacked on top of each other, whereas on the right there are three tetrahedra surrounding the vertical dotted line in the center.

As an example, let us consider the toric code path integral in 2+1 spacetime dimensions, which will be used in all examples in Section~\ref{sec:examples}.
It is well known that the toric code ground states are superpositions of all closed-loop pattern on a 2-dimensional lattice.
On a Poincar\'e dual lattice, such closed-loop pattern are $\zz_2$-valued \emph{1-cocycles}, that is, configurations of one $\zz_2$-variable at every edge such that at every plaquette the surrounding variables sum to $0$ (mod $2$ with $\zz_2$ written additively).
The path integral in the 2+1-dimensional spacetime cellulation is just the same, namely a sum over all 1-cocycles.
So it is a state sum with one $\zz_2$-variable on each edge, and one weight at each face which is $1$ if the surrounding edge variables sum to $0$, and $0$ otherwise.
As a tensor network, the summation over each $\zz_2$-variable at an edge is implemented by a \emph{$\delta$-tensor},
\begin{equation}
\label{eq:delta_definition}
\begin{tikzpicture}
\atoms{delta}{0/}
\draw (0)edge[ind=$a$]++(0:0.5) (0)edge[ind=$b$]++(90:0.5) (0)edge[ind=$c$]++(180:0.5);
\node at (-90:0.5){$\ldots$};
\end{tikzpicture}
=
\begin{cases}
1 & \text{if } a=b=c=\ldots\\
0 & \text{otherwise}
\end{cases}\;.
\end{equation}
Each weight at a face is implemented by a \emph{$\zz_2$-tensor},
\begin{equation}
\begin{tikzpicture}
\atoms{z2}{0/}
\draw (0)edge[ind=$a$]++(0:0.5) (0)edge[ind=$b$]++(90:0.5) (0)edge[ind=$c$]++(180:0.5);
\node at (-90:0.5){$\ldots$};
\end{tikzpicture}
=
\begin{cases}
1 & \text{if } a+b+c+\ldots=0\mod 2\\
0 & \text{otherwise}
\end{cases}\;.
\end{equation}
So in total, there is one $\zz_2$-tensor at every face and one $\delta$-tensor at every edge,
\begin{equation}
\begin{tikzpicture}
\atoms{void}{1/p={-30:0.6}, 2/p={90:0.6}, 3/p={-150:0.6}}
\fill[orange,opacity=0.35] (3)--(2)--(1)--cycle;
\draw[dashed,orange] (3)--(2) (2)--(1) (3)--(1);
\atoms{z2}{a/}
\draw (a)--++(30:0.5) (a)--++(150:0.5) (a)--++(-90:0.5);
\end{tikzpicture}
,\qquad
\begin{tikzpicture}
\fill[orange,opacity=0.35] (0,0)--(1,0)--++(150:0.6)--++(-1,0)--cycle;
\fill[orange,opacity=0.35] (0,0)--(1,0)--(1,-0.4)--(0,-0.4)--cycle;
\draw[dashed,orange,actualedge] (0,0)--(1,0);
\atoms{delta}{a/p={0.5,0}}
\draw (a)--++(150:0.7) (a)--++(-90:0.5);
\fill[orange,opacity=0.35] (0,0)--(1,0)--++(30:0.4)--++(-1,0)--cycle;
\draw (a)--++(30:0.5);
\end{tikzpicture}
\;,
\end{equation}
and for each pair of adjacent face and edge the tensors are connected by a bond.

2-index $\zz_2$-tensors or $\delta$-tensors are equal to the identity matrix, so at $2$-gons and $2$-valent edges we can just put a bond instead of a tensor, for example,
\begin{equation}
\label{eq:2gon_trivial}
\begin{tikzpicture}
\fill[orange,opacity=0.35] (0,0)to[bend left](1.5,0)--++(135:0.9)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend right](1.5,0)--++(-135:0.9)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend left](1.5,0)to[bend left](0,0);
\draw[dashed,orange,actualedge] (0,0)to[bend left=45](1.5,0);
\draw[dashed,orange,actualedge] (0,0)to[bend right=45](1.5,0);
\atoms{delta}{0/p={0.75,0.3}, 1/p={0.75,-0.3}}
\atoms{z2}{z/p={0.75,0}}
\draw (0)--(z) (z)--(1) (1)--++(-135:0.5) (1)--++(-45:0.5);
\fill[orange,opacity=0.35] (0,0)to[bend left=45](1.5,0)--++(45:0.8)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend right=45](1.5,0)--++(-45:0.8)--++(-1.5,0)--cycle;
\draw (0)--++(135:0.5)  (0)--++(45:0.5);
\end{tikzpicture}
=
\begin{tikzpicture}
\fill[orange,opacity=0.35] (0,0)to[bend left](1.5,0)--++(135:0.6)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend right](1.5,0)--++(-135:0.6)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend left](1.5,0)to[bend left](0,0);
\draw[dashed,orange,actualedge] (0,0)to[bend left](1.5,0);
\draw[dashed,orange,actualedge] (0,0)to[bend right](1.5,0);
\atoms{delta}{0/p={0.75,0.2}, 1/p={0.75,-0.2}}
\draw (0)--(1) (1)--++(-135:0.5) (1)--++(-45:0.5);
\fill[orange,opacity=0.35] (0,0)to[bend left](1.5,0)--++(45:0.5)--++(-1.5,0)--cycle;
\fill[orange,opacity=0.35] (0,0)to[bend right](1.5,0)--++(-45:0.5)--++(-1.5,0)--cycle;
\draw (0)--++(135:0.5)  (0)--++(45:0.5);
\end{tikzpicture}\;.
\end{equation}
Note here that the cellulations we consider are combinatorial and not geometrical, so it is possible that we have to bend some edges or faces in order to embed the lattice into Euclidean space.
Let us now define combinatorial moves which impose the topological invariance of the path integral.
While we could again use Pachner moves, there is a set of moves which is more elegant for the present path integral.
First, we impose equality of different ways of splitting faces into triangles along 2-valent edges,
\begin{equation}
\begin{tikzpicture}
\atoms{void}{0/, 1/p={0.5,-0.5}, 2/p={1,0}, 3/p={0.5,0.5}}
\fill[orange,opacity=0.35] (0)--(3)--(2)--(1)--cycle;
\draw[dashed,orange] (0)--(3) (3)--(2) (2)--(1) (0)--(1) (0)--(2);
\atoms{z2}{a/p={0.5,-0.2}, b/p={0.5,0.2}}
\draw (a)--(b) (b)--++(45:0.4) (b)--++(135:0.4) (a)--++(-45:0.4) (a)--++(-135:0.4);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{void}{0/, 1/p={0.5,-0.5}, 2/p={1,0}, 3/p={0.5,0.5}}
\fill[orange,opacity=0.35] (0)--(3)--(2)--(1)--cycle;
\draw[dashed,orange] (0)--(3) (3)--(2) (2)--(1) (0)--(1) (3)--(1);
\atoms{z2}{a/p={0.3,0}, b/p={0.7,0}}
\draw (a)--(b) (b)--++(45:0.4) (a)--++(135:0.4) (b)--++(-45:0.4) (a)--++(-135:0.4);
\end{tikzpicture}\;.
\end{equation}
Poincar\'e dually, we also equate different ways of splitting $n$-valent edges into $3$-valent ones separated by $2$-gon faces such as shown in Eq.~\eqref{eq:2gon_trivial}.
Finally, we add a move involving both face and edge tensors,
\begin{equation}
\label{eq:bialgebra_move}
\begin{tikzpicture}
\atoms{void}{2/p={-30:1}, 1/p={90:1}, 0/p={-150:1}}
\fill[orange,opacity=0.35] (0)to[bend right=20](2)--(1)--cycle;
\fill[orange,opacity=0.35] (1)--(2)--++(30:0.4)--($(1)+(30:0.4)$)--cycle;
\fill[orange,opacity=0.35] (0)--(1)--++(150:0.4)--($(0)+(150:0.4)$)--cycle;
\atoms{z2}{a/p={0.1,-0.1}}
\draw[dashed,orange,actualedge] (0)--(1) (1)--(2);
\atoms{delta}{c/p={30:0.5}, d/p={150:0.5}}
\draw[dashed,orange] (0)to[bend left=20](2) (0)to[bend right=20](2);
\draw (a)to[bend left=20](c) (a)to[bend right=20](d) (a)--++(-90:0.7);
\fill[orange,opacity=0.35] (0)to[bend left=20](2)--(1)--cycle;
\atoms{z2}{b/p={-0.2,-0.1}}
\draw (b)to[bend left=20](c) (b)to[bend right=20](d) (b)--++(-90:0.4);
\draw (c)--++(30:0.4) (d)--++(150:0.4);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{void}{2/p={-30:1}, 1/p={90:1}, 0/p={-150:1}}
\fill[orange,opacity=0.35] (0)--(2)--(1)--cycle;
\fill[orange,opacity=0.35] (0)--(2)--++(-150:0.5)--($(0)+(-150:0.6)$)--cycle;
\draw[dashed,orange] (0)--(1) (1)--(2);
\draw[dashed,orange,actualedge] (0)--(2);
\atoms{delta}{b/p={-90:0.5}}
\draw (b)--++(-150:0.7);
\fill[orange,opacity=0.35] (0)--(2)--++(-30:0.4)--($(0)+(-30:0.4)$)--cycle;
\atoms{z2}{a/}
\draw (a)--(b) (a)--++(30:0.6) (a)--++(150:0.6) (b)--++(-30:0.6);
\end{tikzpicture}\;.
\end{equation}
On the left-hand side, there are two triangles with two shared $3$-valent edges.
On the right-hand side, there is one triangle with one adjacent $3$-valent edge.
Note that this type of state sum (for general choices of face and edge tensors) can describe not only the toric code but any non-chiral topological phase, and is closely related to weak Hopf algebras \cite{liquid_intro}.
Also note that for the toric code, the equations above are a subset of the $ZX$ calculus \cite{Coecke2017,Wetering2020}.

We could also extend the definition of the path integral to manifolds with boundary, for example by adding two additional tensors associated to boundary edges and faces and imposing a boundary version of topological invariance.
Similarly, we can add anyons by altering the tensors or inserting special tensors along the corresponding worldlines.
For the toric code, there are two such types of anyon worldlines, namely $e$ and $m$ anyons.
$e$ anyons are located on 1-cycles in the lattice, that is, closed paths of edges.
We can introduce an $e$ anyon by replacing all $\delta$-tensors on the worldline by a \emph{signed $\delta$-tensor},
\begin{equation}
\label{eq:e_anyon_tensor}
\begin{tikzpicture}
\atoms{delta,bdastyle=red}{0/}
\draw (0)edge[ind=$a$]++(0:0.5) (0)edge[ind=$b$]++(90:0.5) (0)edge[ind=$c$]++(180:0.5);
\node at (-90:0.5){$\ldots$};
\end{tikzpicture}
=
\begin{cases}
1 & \text{if } a=b=c=\ldots=0\\
-1 & \text{if } a=b=c=\ldots=1\\
0 & \text{otherwise}
\end{cases}\;.
\end{equation}
Dually, $m$ anyons are located at 2-cocycles, that is, sequences of faces which are 1-cycles in the Poincar\'e dual lattice.
For an $m$ anyon, we replace all $\zz_2$-tensors on the worldline by a \emph{odd $\zz_2$-tensor},
\begin{equation}
\label{eq:m_anyon_tensor}
\begin{tikzpicture}
\atoms{z2,bdastyle=red}{0/}
\draw (0)edge[ind=$a$]++(0:0.5) (0)edge[ind=$b$]++(90:0.5) (0)edge[ind=$c$]++(180:0.5);
\node at (-90:0.5){$\ldots$};
\end{tikzpicture}
=
\begin{cases}
0 & \text{if } a+b+c+\ldots=0\mod 2\\
1 & \text{otherwise}
\end{cases}\;.
\end{equation}
There are additional tensor-network equations for these new tensors, such as
\begin{equation}
\begin{tikzpicture}
\atoms{z2,bdastyle=red}{0/}
\draw (0)--++(0:0.5) (0)--++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{z2,bdastyle=red}{1/p=180:0.4}
\draw (0)--++(0:0.5) (0)--++(90:0.5) (0)--(1) (1)--++(180:0.4) (0)--++(-90:0.5);
\end{tikzpicture}\;,
\qquad
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{z2,bdastyle=red}{1/p=180:0.4}
\draw (0)--++(0:0.5) (0)--++(90:0.5) (0)--(1) (1)--++(180:0.4) (0)--++(-90:0.5);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{z2,bdastyle=red}{1/p=90:0.4, 2/p=-90:0.4, 3/p=0:0.4}
\draw (0)--(3) (3)--++(0:0.4) (0)--(1) (1)--++(90:0.4) (0)--++(180:0.5) (0)--(2) (2)--++(-90:0.4);
\end{tikzpicture}\;,
\end{equation}
and the same equations with full and empty circles exchanged.
Those equations can be used to freely move the worldlines through the bulk.
In other words, they guarantee the topological invariance of the worldlines themselves.
\footnote{In this paper we will be dealing with invertible anyons which are not only invariant up to topology, but even up to homology.
For this reason, the $e$ and $m$ worldlines are $\zz_2$-valued (co-)cycles rather than loops embedded into the spacetime 3-manifold.}

There is a natural equivalence relation on path integrals.
Namely, two tensor-network path integrals $X$ and $Y$ are equivalent if they are related by applying local tensor-network equations.
Applying such an equation means to remove the left-hand side from the tensor network and insert the right-hand side, or vice versa.
More precisely, we apply such equations in parallel everywhere in the tensor network, for a constant number of rounds.
Alternatively, applying the tensor-network equations only inside some region $A$ yields a domain wall between $Y$ on $A$ and $X$ on the complement $\overline A$.
By applying the tensor-network equations we can make $A$ larger or smaller, which freely moves around the domain wall, making it a topological domain wall.
Since we can also remove, fuse, or generate new $A$ islands, the domain wall is also \emph{invertible}.
Equivalence classes under invertible domain walls will be called \emph{exact phases}.
Exact phases are the natural notion of phases of matter for fixed-point path integrals, analogous to how local unitary circuits can be used to define phases in fixed-point Hamiltonians.
The attribute ``exact'' comes from the fact that applying tensor-network equations cannot change the correlation length of a path integral, so exact phases only correspond to physical phases restricted to zero-correlation length fixed-point path integrals.
In this light, consider tensor-network equations imposing topological invariance such as Eq.~\eqref{eq:pachner_move_equation} or Eq.~\eqref{eq:bialgebra_move}:
They imply that the path integral on one lattice is in the same exact phase as that same path integral on another lattice.
For more detail and examples we refer the reader to Ref.~\cite{liquid_intro}.

\subsection{Imaginary versus real time}
In topological quantum computation, we store information in the ground space of codes or models defined on spatial configurations of non-trivial topology.
In order to perform logical operations we change the topology, either by adiabatic variation of the model parameters or by code deformation.
It is in principle possible to perform computation by only changing the topology of some bare spatial manifold.
However, the set of accessible logic gates becomes much richer if we introduce defects, such as boundaries, anyons, domain walls, twist defects, and so on.
This is also necessary for implementing computation in practice where we need to faithfully embed the topological manifolds into the Euclidean space we happen to live in.
Consider the following two examples of processes involving defects, with time flowing from bottom to top,
\begin{equation}
\label{eq:spacetime_processes}
\begin{tikzpicture}
\fill[cyan,opacity=0.2] (0,0)arc (180:0:1cm and 0.4cm)--++(0,2) arc(0:180:1cm and 0.4cm)--cycle;
\fill[red,opacity=0.3] (0,0)arc (-180:180:1cm and 0.4cm);
\draw[thick] (0.4,0)--(0.4,2) (0.8,0)to[out=90,in=-90](1.2,2) (1.6,0)--(1.6,2);
\fill[cyan!20] (1,1)circle(0.1);
\draw[thick] (1.2,0)to[out=90,in=-90](0.8,2);
\fill[red,opacity=0.3] (0,2)arc (-180:180:1cm and 0.4cm);
\fill[cyan,opacity=0.2] (0,0)arc (-180:0:1cm and 0.4cm)--++(0,2) arc(0:-180:1cm and 0.4cm)--cycle;
\end{tikzpicture}
\;,
\qquad
\begin{tikzpicture}
\fill[cyan,opacity=0.2] (0.8,1)rectangle++(1.5,2);
\fill[green,opacity=0.2] (0,0)--++(0.8,1)--++(0,2)--++(-0.8,-1)--cycle;
\fill[red,opacity=0.3] (0,0)--++(1.5,0)--++(0.8,1)--++(-1.5,0)--cycle;
\draw[thick] (1.9,1.2)--(0.4,1.8);
\fill[red,opacity=0.3] (0,2)--++(1.5,0)--++(0.8,1)--++(-1.5,0)--cycle;
\fill[green,opacity=0.2] (1.5,0)--++(0.8,1)--++(0,2)--++(-0.8,-1)--cycle;
\fill[cyan,opacity=0.2] (0,0)rectangle++(1.5,2);
\end{tikzpicture}\;.
\end{equation}
The left side shows a process where two of four anyons on a disk are exchanged.
The right side shows a code on a rectangle with two different types of boundary like the surface code, blue at the back and front and green on the left and right.
An anyon is moved from the green boundary on the right to the green boundary on the left.

The operations implemented on the logical quantum degrees of freedom only depend on the topological phase of the bulk, boundaries, anyons, etc.
Since the phase is a ground state property, it is captured by a path integral in a spacetime with an imaginary time direction, that is, with an Euclidean signature.
Now assume we are given a Euclidean fixed-point path integral for the bulk, boundary, anyons, and other defects involved.
The logical operations corresponding to a spacetime process are obtained by simply evaluating this path integral.
Note that the blue and green boundaries in Eq.~\eqref{eq:spacetime_processes} are \emph{physical boundaries} where the tensor-network path integrals terminate at some special tensors and bonds without open indices.
In contrast, the gray-red boundaries at the bottom and top are \emph{spatial boundaries}, where we simply cut the tensor network resulting in open indices.
So the contraction yields a linear operator from the bottom to the top open indices of the path integral.
This operator is only non-zero inside the ground state subspace at both input and output, and restricted to this ground state subspace yields the logical operation.

In other words, performing topological quantum computation is the same as executing the imaginary time evolution of some topological phase on some spacetime manifold, possibly including defects.
However, in the real world, we can only perform real time evolution.
Real time evolution can be described by a tensor-network path integral as well, namely as a unitary circuit.
However, the tensors of the imaginary time path integrals are not at all unitaries, and therefore it is impossible to execute the Euclidean path integral in the real world.
In this paper, we will understand how topological quantum error correction (QEC) is precisely a solution to this problem.
That is, topological QEC constructs a real-time path integral which is equal to a given imaginary-time fixed-point inside the ground or steady-state subspace.

Since unitary circuits do not have any (stable) steady states, we need to go from a pure-state description to a mixed-state description.
That is, the real-time tensor-network path integrals are now circuits of quantum channels, or more generally, quantum/classical hybrid channels.
Mathematically, such a channel is a tensor where every classical or quantum degree of freedom, either at the input or the output of the channel, corresponds to one index.
More precisely, a qu-$d$-it is represented by a pair of $d$-dimensional indices, one for the ket and one for the bra part, whereas a classical $d$-it is just a $d$-dimensional index.
For example, a channel with one quantum and one classical input, and two quantum and one classical output can look like:
\begin{equation}
\begin{tikzpicture}
\atoms{square,xscale=4}{0/}
\draw ([sx=-0.5]0-b)--++(-90:0.5) ([sx=-0.3]0-b)--++(-90:0.5) ([sx=-0.6]0-t)--++(90:0.5) ([sx=-0.4]0-t)--++(90:0.5) ([sx=0.1]0-t)--++(90:0.5) ([sx=-0.1]0-t)--++(90:0.5);
\draw[classical] ([sx=0.4]0-b)--++(-90:0.5) ([sx=0.4]0-t)--++(90:0.5);
\end{tikzpicture}\;,
\end{equation}
where the time direction is from bottom to top, like everywhere in this paper.

A proper channel needs to fulfill two conditions:
First, it needs to be \emph{completely positive} (CP):
For every fixed value of the classical indices, block all ket indices and all bra indices such that the tensor becomes a matrix.
This matrix has to be non-negative, for example,
\begin{equation}
\begin{tikzpicture}
\atoms{square,xscale=4}{0/}
\draw ([sx=-0.5]0-b)edge[ind=$a$]++(-90:0.5) ([sx=-0.3]0-b)edge[ind=$d$]++(-90:0.5) ([sx=-0.6]0-t)edge[ind=$b$]++(90:0.5) ([sx=-0.4]0-t)edge[ind=$e$]++(90:0.5) ([sx=0.1]0-t)edge[ind=$f$]++(90:0.5) ([sx=-0.1]0-t)edge[ind=$c$]++(90:0.5);
\draw[classical] ([sx=0.4]0-b)edge[ind=$i$]++(-90:0.5) ([sx=0.4]0-t)edge[ind=$j$]++(90:0.5);
\end{tikzpicture}
\rightarrow [M^{ij}]_{(abc),(def)} \geq 0\quad\forall i,j\;.
\end{equation}
Second, it needs to be \emph{trace preserving} (TP):
When closing all quantum output (double-)indices with a trace, and all classical output indices with a sum, we obtain a trace and sum at all classical and quantum input indices, for example,
\begin{equation}
\label{eq:channel_normalization}
\begin{tikzpicture}
\atoms{square,xscale=4}{0/}
\atoms{deltatens}{d/p={0.4,0.6}}
\draw ([sx=-0.5]0-b)--++(-90:0.5) ([sx=-0.3]0-b)--++(-90:0.5) ([sx=-0.6]0-t)--++(90:0.5)to[out=90,in=90]++(0:0.2)--([sx=-0.4]0-t) ([sx=0.1]0-t)--++(90:0.5)to[out=90,in=90]++(180:0.2)--([sx=-0.1]0-t);
\draw[classical] ([sx=0.4]0-b)--++(-90:0.5) ([sx=0.4]0-t)--(d);
\end{tikzpicture}
=
\begin{tikzpicture}
\atoms{deltatens}{d/}
\draw[classical] (d)--++(-90:0.5);
\draw (-0.5,-0.5)--++(90:0.5)to[out=90,in=90]++(180:0.2)--(-0.7,-0.5);
\end{tikzpicture}\;.
\end{equation}
Here the black dot is the $\delta$-tensor in Eq.~\eqref{eq:delta_definition} with one index, that is, a vector with all entries equal to $1$.

The point of topological quantum computation is to store and process quantum information in a way that is robust to \emph{any} local noise.
This type of computation is thus protected by one of the most fundamental principles of physics, namely locality of interactions.
Relying on locality means that also the physical gates and measurements we can perform should be local.
In other words, allowing non-local gates but only local noise seems unfair.
Thus, the circuit corresponding to a topological QEC process should be geometrically local, just like the fixed-point Euclidean path integrals.
Let us here distinguish between two types of topological QEC with different notions of locality.

\emph{Fully local QEC} is described by a completely geometrically local circuit of quantum/classical channels.
This can be viewed as self-correction using engineered dissipation, formulated in discrete time.
Examples for fully local QEC circuits are given by cellular automaton decoders \cite{Kubica2018}.
While such decoders are known to be fully fault tolerant in $4+1$ dimensions, the situation is less clear in $3+1$ and $2+1$ dimensions.

In \emph{active QEC}, the geometrically local circuit is assisted by a purely classical \emph{decoding} process which is not executed in the same spacetime, but treated as a black box with unlimited resources.
In practice, the efficiency of this classical process is of course still of great importance, and any reasonable decoder should be executable in at most a polynomially larger spacetime.
An example for this is minimum-weight-perfect-matching decoding of the toric code, where all the stabilizer measurements and the corrections are local, but the classical decoding algorithm has more-than-constant runtime even if we would allow for instant non-local communication.
From a fundamental point of view, active QEC does not have a threshold for arbitrary local noise, since the finite propagation speed in nature does not only hold for quantum but also for classical information.
However, active QEC might very well have a practical impact, since current implementations of qubits are by orders of magnitude larger, slower, and noisier, than classical information technology.

Let us now formulate three sufficient conditions which imply that a general topological QEC circuit does fault-tolerantly store and process information.
Consider the ``transfer'' operator corresponding to executing one time period of the circuit.
(1) There is a set of highest-magnitude eigenvalues, which are contained in an interval which shrinks exponentially with the system size $L$.
(2) The remaining eigenvalues are separated from the highest-magnitude subset by a gap which shrinks at most polynomially with $L$.
The dimension of the high-magnitude subspace equals the ground state degeneracy of the Euclidean fixed-point path integral of the phase.
(3) In order to perform computation, we consider a circuit which varies in time.
The circuit acts like the imaginary-time path integral when restricted to the high-magnitude subspace, and decouples from the remaining space, up to an error exponentially small in $L$.

Note that for the transfer operator of the imaginary-time evolution, the gap in (2) does not shrink at all, but is constant. 
However, for a real-time fully local QEC process, this gap must shrink at least like $~L^{-1}$ due to the finite propagation speed of information.
Namely, if we insert an ``error'' operation of size $~L$ into the circuit, then it takes time $~L$ to correct this error and return to the steady state.
In contrast, a gapped operator returns to the steady state from any starting point at a system-size independent rate.

\subsection{Construction of error-correcting circuits}
The three conditions formulated in the previous section are neither simple to verify for a generic circuit, nor do they directly help with constructing such QEC circuits.
In this section we describe an explicit general method to construct topological QEC circuits from topological fixed-point path integrals.
We focus on active QEC, but the methods can in principle also be used to construct fully local QEC circuits.
More specifically, we consider a geometrically local circuit of channels, some of which have an additional classical output, for example,
\begin{equation}
\begin{tikzpicture}
\atoms{square,xscale=4}{0/}
\draw[quantum] ([sx=-0.5]0-b)--++(-90:0.4) ([sx=0.5]0-b)--++(-90:0.4) ([sx=-0.5]0-t)--++(90:0.4) ([sx=0.5]0-t)--++(90:0.4);
\draw[classical] (0-t)--++(90:0.6);
\end{tikzpicture}\;.
\end{equation}
Physically, such a hybrid channel describes a measurement and is known as an \emph{instrument} in quantum information theory.
We run this circuit for a time $T\sim L$, recording all the classical outputs/measurement results, which we will refer to as a \emph{spacetime syndrome}.
After the time $T$, we feed this spacetime syndrome into some non-local purely classical decoding algorithm $D$.
Then we perform a constant-depth \emph{correction} layer of quantum channels with an additional classical input, for example,
\begin{equation}
\begin{tikzpicture}
\atoms{square}{0/}
\draw[classical] ([sx=-0.1]0-b)--++(-100:0.2);
\draw[quantum] (0-b)--++(-90:0.25) (0-t)--++(90:0.25);
\end{tikzpicture}\;.
\end{equation}
The inputs to those correction channels are the outputs of the decoding algorithm $D$.
So in total, such a circuit (for a $1+1$-dimensional spacetime) might look like
\begin{equation}
\label{eq:qec_circuit}
\begin{tikzpicture}
\begin{scope}
\clip (0.6,0.9) rectangle (6.4,5.4);
\foreach \y in {0,1,2,3}{
\foreach \x in {0,1,2,3,4,5,6}{
\atoms{square,yscale=0.7,xscale=2.2}{{a\x\y/p={\x*1.4,\y*1.2}}}
\draw[classical,black!50] (a\x\y-t)edge[mark={three dots,a}]++(90:0.15);
}};
\foreach \y in {0,1,2,3}{
\foreach \x in {0,1,2,3,4,5,6}{
\atoms{square,yscale=0.7,xscale=2.2}{{b\x\y/p={\x*1.4+0.7,\y*1.2+0.6}}}
\draw[classical,black!50] (b\x\y-t)edge[mark={three dots,a}]++(90:0.15);
}};
\foreach[count=\yy from 1] \y in {0,1,2,3}{
\foreach[count=\xx from 0] \x in {1,2,3,4,5,6}{
\draw[quantum] ([sx=0.25]a\x\y-t)--([sx=-0.25]b\x\y-b);
\draw[quantum] ([sx=-0.25]a\x\y-t)--([sx=0.25]b\xx\y-b);
}};
\foreach[count=\yy from 1] \y in {0,1,2}{
\foreach[count=\xx from 0] \x in {1,2,3,4,5,6}{
\draw[quantum] ([sx=-0.25]b\xx\y-t)--([sx=0.25]a\xx\yy-b);
\draw[quantum] ([sx=0.25]b\xx\y-t)--([sx=-0.25]a\x\yy-b);
}};
\foreach \x in {0,1,2,3,4,5}{
\atoms{square}{a\x/p={\x*1.4+0.35,5}, b\x/p={\x*1.4+1.05,5}}
\draw[classical,black!50] ([sx=-0.1]a\x-b)edge[mark={three dots,a}]++(-100:0.15) ([sx=0.1]b\x-b)edge[mark={three dots,a}]++(-80:0.15);
\draw[quantum] ([sx=-0.25]b\x3-t)--(a\x-b) ([sx=0.25]b\x3-t)--(b\x-b) (a\x-t)--++(90:0.25) (b\x-t)--++(90:0.25);
};
\end{scope}
\atoms{square,xscale=4,yscale=1.7,lab={t=$D$,p={0,0}}}{c/p={7.4,3.2}}
\draw[classical,white] (b31-t)edge[mark={three dots,a}]++(90:0.15) (a41-t)edge[mark={three dots,a}]++(90:0.15) (b41-t)edge[mark={three dots,a}]++(90:0.15) ([sx=-0.1]a4-b)edge[mark={three dots,a}]++(-100:0.15) ([sx=0.1]b3-b)edge[mark={three dots,a}]++(-80:0.15);
\draw[classical,opacity=0.5,rc] ([sx=0.2]c-b)--++(-90:0.3)-|(b31-t) ([sx=0.4]c-b)--++(-90:0.5)-|(a41-t) ([sx=0.6]c-b)--++(-90:0.7)-|(b41-t) ([sx=-0.1]a4-b)--++(-100:0.2)-|([sx=0.6]c-t) ([sx=0.1]b3-b)--++(-80:0.4)-|([sx=0.4]c-t);
\path (c-b)--++(-0.3,-0.15)node{$\ldots$};
\path (c-t)--++(-0.3,0.15)node{$\ldots$};
\end{tikzpicture}\;,
\end{equation}
where we have semi-transparently drawn some of the classical bonds connecting the circuit and $D$, and omitted the remaining ones.
Note that such decoding in spacetime is the natural approach if we want to be robust to any local noise including measurement noise \cite{Dennis2001}.

Let us now describe the concrete procedure for arriving at such a topological QEC circuit starting from a fixed-point path integral.
First, we put the path integral on some regular lattice and choose a time direction.
Then we interpret the tensor network as a geometrically local circuit of operators by dividing the indices of each tensor into input and output.
This can always be done, however the resulting operators, like
\begin{equation}
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$T_1$,p=180:0.4}}}
\draw (0-tl)--++(135:0.6) (0-bl)--++(-135:0.6) (0-tr)--++(45:0.6) (0-br)--++(-45:0.6);
\end{tikzpicture}\;,
\end{equation}
will not in general be unitaries, or equivalently, stacking two copies will not result in a channel which is normalized as in Eq.~\eqref{eq:channel_normalization},
\begin{equation}
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$T_1$,p=180:0.4}}, {1/p={0.3,0},lab={t=$T_1^*$,p=0:0.4}}}
\draw[rc] (0-tl)--++(135:0.6)--++(0:0.6)--(1-tl) (0-tr)--++(45:0.6)--++(0:0.6)--(1-tr);
\draw (0-bl)--++(-135:0.6) (0-br)--++(-45:0.6);
\draw (1-bl)--++(-135:0.6) (1-br)--++(-45:0.6);
\end{tikzpicture}
\neq
\begin{tikzpicture}
\draw[rc] (0,0)--++(0,0.5)-|++(0.3,-0.5) (0.8,0)--++(0,0.5)-|++(0.3,-0.5);
\end{tikzpicture}\;.
\end{equation}
In fact, it will never happen that all operators are unitary, since the operator corresponding to a full layer of imaginary-time evolution is a projector of low rank, and thus not a unitary.

Even though $T_1$ does not define a channel, it can always occur as part of an instrument.
To this end, we choose further tensors $T_2,T_3,\ldots$, which we combine into one single tensor using an additional classical output index,
\begin{equation}
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$\mathbf T$,p=180:0.4}}}
\draw (0-tl)--++(135:0.4) (0-bl)--++(-135:0.4) (0-tr)--++(45:0.4) (0-br)--++(-45:0.4);
\draw[classical] (0-t)--++(90:0.4);
\end{tikzpicture}
\coloneqq
\bigl(
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$T_1$,p=180:0.4}}}
\draw (0-tl)--++(135:0.4) (0-bl)--++(-135:0.4) (0-tr)--++(45:0.4) (0-br)--++(-45:0.4);
\end{tikzpicture}\;,
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$T_2$,p=180:0.4}}}
\draw (0-tl)--++(135:0.4) (0-bl)--++(-135:0.4) (0-tr)--++(45:0.4) (0-br)--++(-45:0.4);
\end{tikzpicture}\;,
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$T_3$,p=180:0.4}}}
\draw (0-tl)--++(135:0.4) (0-bl)--++(-135:0.4) (0-tr)--++(45:0.4) (0-br)--++(-45:0.4);
\end{tikzpicture}\;,
\ldots
\bigr)\;.
\end{equation}
We then use this tensor to define an instrument,
\begin{equation}
\label{eq:fixed_point_instrument}
I[\mathbf T]=
\begin{tikzpicture}
\atoms{square,xscale=4}{0/}
\draw[quantum] ([sx=-0.5]0-b)--++(-90:0.4) ([sx=0.5]0-b)--++(-90:0.4) ([sx=-0.5]0-t)--++(90:0.4) ([sx=0.5]0-t)--++(90:0.4);
\draw[classical] (0-t)--++(90:0.6);
\end{tikzpicture}
\coloneqq
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$\mathbf T$,p=180:0.4}}, {1/p={0.3,0},lab={t=$\mathbf T^*$,p=0:0.4}}}
\atoms{deltatens}{d/p={0,0.6}}
\draw (0-tl)--++(135:0.6) (0-bl)--++(-135:0.6) (0-tr)--++(45:0.6) (0-br)--++(-45:0.6);
\draw (1-tl)--++(135:0.6) (1-bl)--++(-135:0.6) (1-tr)--++(45:0.6) (1-br)--++(-45:0.6);
\draw[rc,classical] (0-t)--++(90:0.3)--(d) (1-t)--++(90:0.3)--(d) (d)--++(90:0.3);
\end{tikzpicture}\;.
\end{equation}
The small dot on the right denotes a $\delta$-tensor as defined in Eq.~\eqref{eq:delta_definition}, though here it serves a very different function and the indices can have other bond dimensions than $2$.
The normalization condition in Eq.~\eqref{eq:channel_normalization} of this instrument reduces to the following condition for $T$:
\begin{equation}
\begin{tikzpicture}
\atoms{square}{{0/p={-0.3,0},lab={t=$\mathbf T$,p=180:0.4}}, {1/p={0.3,0},lab={t=$\mathbf T$,p=0:0.4}}}
\draw[rc] (0-tl)--++(135:0.6)--++(0:0.6)--(1-tl) (0-tr)--++(45:0.6)--++(0:0.6)--(1-tr);
\draw (0-bl)--++(-135:0.6) (0-br)--++(-45:0.6);
\draw (1-bl)--++(-135:0.6) (1-br)--++(-45:0.6);
\draw[rc,classical] (0-t)--++(90:0.3)-|(1-t);
\end{tikzpicture}
=
\begin{tikzpicture}
\draw[rc] (0,0)--++(0,0.5)-|++(0.3,-0.5) (0.8,0)--++(0,0.5)-|++(0.3,-0.5);
\end{tikzpicture}\;.
\end{equation}
In other words, we are looking for tensors $T_2,T_3,\ldots$, such that the collection of $\mathbf T=(T_1,T_2,T_3,\ldots)$ forms an isometry.

We now use instruments as in Eq.~\eqref{eq:fixed_point_instrument} in the QEC circuit as in Eq.~\eqref{eq:qec_circuit}.
If we happen to always get the trivial measurement outcome corresponding to $T_1$, then we have successfully executed the imaginary-time fixed-point path integral.
However, if some of the outcomes are non-trivial, we have performed some other path integral and need to perform corrections.
In order to know which corrections to perform, also the non-trivial spacetime syndromes need to correspond to an exactly solvable fixed-point path integral of some sort.
This is where we use topological defects such as anyons.
We choose $T_2,T_3,\ldots$ such that every one of those tensors corresponds to a piece of fixed-point path integral which includes a segment of some topological defect.
Then if we measure an arbitrary spacetime syndrome for a time $T\sim L$, we know that we have executed the fixed-point Euclidean path integral including the corresponding configuration of defects.
The defects in each such a ``decorated'' fixed-point path integral can be closed by adding defect segments to the path integral at time $T$.
The operators corresponding to those closing defects form the correction layer in Eq.~\eqref{eq:qec_circuit}.
After closing the defects in a homologically trivial way, the defect-decorated path integral equals the defect-free path integral, due to the topological invariance of the defects.
If we close the defects in a homologically non-trivial way however, the path integral corresponds to a non-trivial logical operator.
Choosing a homologically trivial closure is part of the job of the classical decoder $D$.

String, membrane, or higher-dimensional defects must not terminate, otherwise the defect configuration is invalid and the fixed-point path integral evaluates to zero.
Thus, if we run the constructed QEC circuit, invalid spacetime syndromes are measured with probability zero.
However, if we perturb the circuit by adding noise, this will no longer be true.
More precisely, after expanding the noisy circuit as a sum over error configurations, the syndrome might be invalid inside the error region.
So to make the QEC procedure work fault-tolerantly, the decoder $D$ needs to perform a second job:
It has to repair invalid spacetime syndromes before using them for correction.
If this repair together with the error configuration does not contain any loops/membranes/etc of non-trivial homology, no logical error can occur.
Since the decoder $D$ does not know the error configuration, the best it can do is to choose a repair which is unlikely to result in a logical error.
To this end, we highly prefer repairs of small weight, such that error configurations of linear size $\lesssim\frac{L}{2}$ never result in a logical error.
Since the weight of an error configuration decreases exponentially with its size, this provides a way suppress the probability of logical errors.

The most notable example for this are $0+1$-dimensional defects in the bulk, that is, anyons.
In this case, the spacetime syndrome is given by an anyonic string net in spacetime.
If there is no noise, the spacetime syndrome will always be valid, that is, satisfy the anyon fusion rules.
The operators corresponding to closing the spacetime string net at time $T$ are known as \emph{string operators}.
If there is noise, then the string net might have broken fusion rules at some points.
An example for a classical decoding algorithm $D$ which runs in polynomial time is to apply \emph{minimum weight perfect matching} to the end points of the string net.
In higher dimensions than $2+1$, it also makes sense to use membrane defects as we demonstrate for the 3-dimensional Floquet toric code introduced in Section~\ref{sec:3d_toric_code}.

Let us summarize our considerations in the following definition.
\begin{mydef}
\label{def:path_integral_code}
A \emph{path-integral code} is a uniform geometrically local circuit of instruments of the form in Eq.~\eqref{eq:fixed_point_instrument}, such that the following holds:
For every configuration of measurement outcomes (spacetime syndrome), the resulting path integral is (in the same exact phase as) a fixed-point path integral for a topological phase, decorated by topological defects.
\end{mydef}

\begin{myprop}
\label{prop:path_integral_decoding}
A path-integral code can be turned into a full error-correcting procedure as depicted in Eq.~\eqref{eq:qec_circuit} which can correct any errors of size $\lesssim\frac{L}{2}$:
\begin{enumerate}
\item Run the circuit of instruments for a time $T\sim L$, recording the spacetime syndrome.
\item Let the classical decoder $D$ choose a low-weight repair of the recorded syndrome in spacetime, for example by minimum weight perfect matching.
\item Let $D$ find a defect network within a spatial layer at time $T$, which closes the repaired spacetime syndrome in a homologically trivial way.
\item Apply a circuit representing the spatial layer at time $T$ with the inserted defect network.
\end{enumerate}
\end{myprop}

\section{Known codes in terms of path integrals}
\label{sec:examples}
In this section, we consider four different examples of path-integral codes, which we all find to be equivalent to existing codes, namely the stabilizer toric code, subsystem toric code, CSS Floquet code, and honeycomb Floquet code.
The first three examples are all based on the toric-code path integral introduced in Section~\ref{sec:fixed_points}, which we put on different spacetime lattices with different choices of time direction.
The fourth example differs from the previous ones by only a change of basis of the tensor-network path integral.

\subsection{Stabilizer toric code}
\label{sec:stabilizer_toric_code}
As a first example let us consider the first of all topological error-correcting codes, namely the toric code on a square lattice \cite{Kitaev1997,Dennis2001}.
The underlying tensor-network path integral is the toric-code path integral from Section~\ref{sec:fixed_points} on a cubic lattice, whose unit vectors we call $x$, $y$, and $z$.
The time direction $t$ is coincident with $z$.

We now view the tensor-network path integral as a circuit of operators, where each operator corresponds to one or a few tensors.
To this end, we modify the cubic lattice slightly by splitting each $xt$ and $yt$ face into two triangles along a 2-valent diagonal edge.
Dually, we split all $x$ and $y$ 4-valent edges into two 3-valent edges separated by a 2-gon face as depicted in Eq.~\eqref{eq:2gon_trivial}.
With this, there are two kinds of operators:
At each $xy$ face, there is a 4-qubit operator $T_1$, consisting of that face together with the four adjacent 3-valent edges,
\begin{equation}
\begin{tikzpicture}
\draw (-0.6,0.3)edge[mark={arr,e},ind=$x$]++(0:0.3) (-0.6,0.3)edge[mark={arr,e},ind=$y$]++(40:0.3) (-0.6,0.3)edge[mark={arr,e},ind=$t$]++(90:0.3);
\atoms{vertex}{0/, 1/p={1.5,0}, 2/p={0.8,0.6}, 3/p={2.3,0.6}}
\draw[actualedge] (0)--(1)--(3)--(2)--(0);
\end{tikzpicture}
\rightarrow
T_1\coloneqq
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\end{tikzpicture}\;.
\end{equation}
At each $t$ edge, there is an operator $V_1$, consisting of that edge together with the surrounding triangles,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={2,0}, 2/p={1,-0.7}, 3/p={1,0.7}, 4/p={0.2,-0.5}, 5/p={1.8,0.5}}
\draw (0)--(2)--(1)--(3)--(0) (2)--(4)--(3) (2)--(5)--(3) (2)--(3);
\end{tikzpicture}
\rightarrow
V_1\coloneqq
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{z2}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\end{tikzpicture}\;.
\end{equation}
Note that those diagrams are identical to well-known $ZX$ diagrams for the vertex and plaquette terms of the toric code \cite{Gidney2022,Kissinger2022,Bombin2023}.

Neither $T_1$ nor $V_1$ are unitary.
In fact, $T_1$ is the projector onto the $+1$ eigenspace of the Pauli operator $Z_0Z_1Z_2Z_3$, and $V_1$ the projector onto the $+1$ eigenspace of $X_0X_1X_2X_3$.
To fix this, we define a second projector $T_m$ corresponding to a $xy$ face carrying a segment of $m$ worldline,
\begin{equation}
\label{eq:stabilizer_plaquette_operator}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={1,0}, 2/p={0.6,0.4}, 3/p={1.6,0.4}}
\draw[actualedge] (0)--(1)--(3)--(2)--(0);
\fill[red,opacity=0.3] (0-c)--(1-c)--(3-c)--(2-c)--cycle;
\end{tikzpicture}
\rightarrow
T_m
\coloneqq
\begin{tikzpicture}
\atoms{z2,bdastyle=red}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\end{tikzpicture}
\;.
\end{equation}
This way, $T_1$ is extended to an isometry $\mathbf T$,
\begin{equation}
\mathbf T\coloneqq (T_1,T_m)
=
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\draw[classical](0)--++(90:0.5);
\end{tikzpicture}\;.
\end{equation}
$\mathbf T$ defines an instrument $I[\mathbf T]$ via Eq.~\eqref{eq:fixed_point_instrument}, which is in fact just a projective $Z_0Z_1Z_2Z_3$ measurement.
Dually, we can define an operator $V_e$ carrying an $e$ anyon segment along a $t$ edge,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={2,0}, 2/p={1,-0.7}, 3/p={1,0.7}, 4/p={0.2,-0.5}, 5/p={1.8,0.5}}
\draw[red] (2)--(3);
\draw (0)--(2)--(1)--(3)--(0) (2)--(4)--(3) (2)--(5)--(3);
\end{tikzpicture}
\rightarrow
V_e\coloneqq
\begin{tikzpicture}
\atoms{delta,bdastyle=red}{0/}
\atoms{z2}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\end{tikzpicture}\;,
\end{equation}
giving rise to an isometry $\mathbf V$,
\begin{equation}
\label{eq:stabilizer_vertex_operator}
\mathbf V\coloneqq (V_1,V_e)
=
\begin{tikzpicture}
\atoms{hadamard}{h/p={0,0.5}}
\atoms{delta}{0/}
\atoms{z2}{1/p={0.8,0}, 2/p={-0.8,0}, 3/p={0.4,0.5}, 4/p={-0.4,-0.5}}
\draw (0)--(1) (0)--(2) (0)--(3) (0)--(4) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4) (3)--++(-90:0.4) (3)--++(90:0.4) (4)--++(-90:0.4) (4)--++(90:0.4);
\draw[classical] (0)--(h) (h-t)--++(90:0.4);
\end{tikzpicture}\;.
\end{equation}
$\mathbf V$ yields an instrument $I[\mathbf V]$, which is just a projective $X_0X_1X_2X_3$ measurement.
The presence of the \emph{Hadamard} matrix,
\begin{equation}
\label{eq:hadamard}
\begin{tikzpicture}
\atoms{hadamard}{0/}
\draw (0-l)--++(180:0.4) (0-r)--++(0:0.4);
\end{tikzpicture}
\coloneqq
H
\coloneqq
\frac1{\sqrt2}
\begin{pmatrix}
1&1\\1&-1
\end{pmatrix}\;,
\end{equation}
seemingly spoils the duality between Eq.~\eqref{eq:stabilizer_vertex_operator} and Eq.~\eqref{eq:stabilizer_plaquette_operator}.
This is explained by the fact that in Eq.~\eqref{eq:fixed_point_instrument} we use a $\delta$-tensor for both $I[\mathbf T]$ and $I[\mathbf V]$.

There are two ways in which a 4-gon can be divided into two triangles.
The choice of division determines in which order we apply the different operators at neighboring parallel $t$ edges.
In order to formally obtain a nice brick-layer circuit, we label vertices in a checkerboard-like manner, numbering the vertex at $ax+by+ct$ by $a+b\mod 2$.
Then we choose the diagonal edges such that they connect $0$ vertices at time $T$ to $1$ vertices at time $T-1$.
Dually, we also split up all 4-valent edges into pairs of 3-valent ones in this checkerboard-like fashion.
The following shows one $t$ period of the modified cubic lattice,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex,lab/p=120:0.2,lab/wrap={$\scriptstyle##1$}}{0/lab={t=1}, {1/p={1.5,0},lab={t=0}}, {2/p={3,0},lab={t=1}}, {3/p={1.2,1},lab={t=0}}, {4/p={2.7,1},lab={t=1}}, {5/p={4.2,1},lab={t=0}}, {6/p={2.4,2},lab={t=1}}, {7/p={3.9,2},lab={t=0}}, {8/p={5.4,2},lab={t=1}}}
\atoms{vertex}{0x/p={0,0.8}, 1x/p={1.5,0.8}, 2x/p={3,0.8}, 3x/p={1.2,1.8}, 4x/p={2.7,1.8}, 5x/p={4.2,1.8}, 6x/p={2.4,2.8}, 7x/p={3.9,2.8}, 8x/p={5.4,2.8}}
\draw[e or not] (0)--(0x) (1)--(1x) (2)--(2x) (3)--(3x) (4)--(4x) (5)--(5x) (6)--(6x) (7)--(7x) (8)--(8x);
\draw (0)edge[bend left=10,dashed](1) (1)to[bend left=20](2) (3)to[bend left=20](4) (4)edge[bend left=10,dashed](5) (6)edge[bend left=10,dashed](7) (7)to[bend left=20](8);
\draw (0)to[bend right=10](1)(1)edge[bend right=20,dashed](2) (3)edge[bend right=20,dashed](4)(4)to[bend right=10](5) (6)to[bend right=10](7)(7)edge[bend right=20,dashed](8);
\draw (0)to[bend left=20](3)(3)edge[bend left=10,dashed](6) (1)edge[bend left=10,dashed](4)(4)to[bend left=20](7) (2)to[bend left=20](5)(5)edge[bend left=10,dashed](8);
\draw (0)edge[bend right=20,dashed](3)(3)to[bend right=10](6) (1)to[bend right=10](4)(4)edge[bend right=20,dashed](7) (2)edge[bend right=20,dashed](5)(5)to[bend right=10](8);
\fill[m or not] (0-c)to[bend left=10](1-c)to[bend left=10](4-c)to[bend left=20](3-c)to[bend left=20]cycle;
\fill[m or not] (1-c)to[bend left=20](2-c)to[bend left=20](5-c)to[bend left=10](4-c)to[bend left=10]cycle;
\fill[m or not] (3-c)to[bend left=20](4-c)to[bend left=20](7-c)to[bend left=10](6-c)to[bend left=10]cycle;
\fill[m or not] (4-c)to[bend left=10](5-c)to[bend left=10](8-c)to[bend left=20](7-c)to[bend left=20]cycle;
\draw (0)--(1x) (0)--(3x) (2)--(1x) (2)--(5x) (4)--(1x) (4)--(5x) (4)--(7x) (4)--(3x) (6)--(3x) (6)--(7x) (8)--(7x) (8)--(5x);
\node at (1.2,0.5){$\scriptstyle 0$};
\node at (2.7,0.5){$\scriptstyle 1$};
\node at (2.4,1.5){$\scriptstyle 1$};
\node at (3.9,1.5){$\scriptstyle 0$};
\end{tikzpicture}\;.
\end{equation}
Here we have dashed the $x$ and $y$ edges are bent towards the negative $t$ direction, and semi-colored $t$ edges and $xy$ faces in red to show that they potentially carry $e$ or $m$ anyons.
We can see that one full period of the circuit consists of four layers of instruments,
\begin{equation}
\rightarrow I[\mathbf T]_0\rightarrow I[\mathbf T]_1\rightarrow I[\mathbf V]_0\rightarrow I[\mathbf V]_1\rightarrow\;.
\end{equation}
It is obvious how to write this circuit in terms of operators acting on qubits on a fixed spatial lattice:
The qubits are on the edges of the spatial square lattice, $I[\mathbf T]$ acts on the qubits surrounding a plaquette, and $I[\mathbf V]$ on those surrounding a vertex.
For the Floquet codes discussed later, this step is less obvious.

Let us briefly describe the general error-correcting procedure in Proposition~\ref{prop:path_integral_decoding} for the present code.
Without noise, the spacetime syndrome consists of a 1-cycle (for the $e$ measurements) and a 2-cocycle (for the $m$ measurements) inside the cubic spacetime lattice.
In fact, the $e$ 1-cycle consists of continued lines of $t$ edges, the $m$ 2-cocycle consists of continued Poincar\'e dual lines of $xy$ faces.
With noise, the spacetime syndrome does not always consist of (co-)cycles.
That is, the $e$ 1-cycle might have a boundary consisting of a set of vertices, and the $m$ 2-cocycle might have a boundary consisting of volumes.
The classical decoder $D$ now finds a low-weight repair which pairwise connects the $e$ end vertices with a set of edges and $m$ end volumes with a set of faces.
It is important to note that the edges/faces of the repair can be any edges/faces of the cubic lattices and not only $t$ edges or $xy$ faces.
At time $T$, we close the repaired syndrome in a homologically trivial way inside the $xy$ plane.
To this end, we insert a 2-gon and a 2-valent edge in between every time-$T$ $x$ and $y$ edge and the adjacent time-$(T+\frac12)$ $xt$ and $yt$ face.
Then we equip some of the 2-gons with $m$ worldlines and some of the 2-valent edges with $e$ worldlines, for example,
\begin{equation}
\label{eq:toric_code_correction}
\begin{tikzpicture}
\atoms{vertex}{0/, {1/p={1,0},style=blue}, 2/p={2,0}, 3/p={0.8,0.7}, 4/p={1.8,0.7}, 5/p={2.8,0.7}, 6/p={1.6,1.4}, 7/p={2.6,1.4}, {8/p={3.6,1.4},style=blue}}
\draw (0)--(1) (1)--(2) (3)--(4) (4)--(5) (6)--(7) (7)--(8);
\draw (0)--(3) (3)--(6) (1)--(4) (4)--(7) (2)--(5) (5)--(8);
\draw (0)edge[bend left](1) (1)edge[bend left](2) (3)edge[bend left](4) (4)edge[bend left](5) (6)edge[bend left](7) (7)edge[bend left,red](8);
\draw (0)edge[bend left](3) (3)edge[bend left](6) (1)edge[bend left,red](4) (4)edge[bend left,red](7) (2)edge[bend left](5) (5)edge[bend left](8);
\fill[red,opacity=0.3] (1-c)to[bend left](4-c)--cycle (3-c)to[bend left](4-c)--cycle (3-c)to[bend left](6-c)--cycle;
\fill[blue,opacity=0.3] (1-c)--(2-c)--(5-c)--(4-c)--cycle;
\end{tikzpicture}\;,
\end{equation}
where the boundary volumes and vertices of $m$ and $e$ were marked in blue.
For a 2-gon with an $m$ worldline, the corresponding tensor is an $X$ operator and therefore unitary,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{0/,1/p={1,0}}
\draw (0)to[bend left] (1)(0)to[bend right](1);
\fill[red,opacity=0.3] (0-c)to[bend left](1-c)to[bend left]cycle;
\end{tikzpicture}
\rightarrow
\begin{tikzpicture}
\atoms{z2,bdastyle=red}{0/}
\draw (0)--++(90:0.3) (0)--++(-90:0.3);
\end{tikzpicture}
=
X\;.
\end{equation}
Dually, the tensors at 2-valent edges with $e$ worldlines are $Z$ operators acting at those edges.
So the correction is just a product of single-qubit unitaries.

Note that, since all the operators commute, applying them in any order defines a valid spacetime cellulation.
For example, consider the alternative ordering
\begin{equation}
\rightarrow I[\mathbf T]_0\rightarrow I[\mathbf V]_0\rightarrow I[\mathbf T]_1\rightarrow I[\mathbf V]_1\rightarrow\;.
\end{equation}
This yields a modified cellulation where the $1$ $xy$ faces are replaced by faces formed by four diagonals.
That is, the $0$ cubes remain the same, but the $1$ cubes have their $0$ vertices shifted by 1 in $t$ direction:
\begin{equation}
\begin{tikzpicture}
\atoms{vertex,lab/p=120:0.2,lab/wrap={$\scriptstyle##1$}}{{0/p={0,0.8},lab={t=0}}, {1/p={1.5,0},lab={t=1}}, {2/p={1.2,1},lab={t=1}}, {3/p={2.7,1.8},lab={t=0}}}
\atoms{vertex}{0x/p={0,1.6}, 1x/p={1.5,0.8}, 2x/p={1.2,1.8}, 3x/p={2.7,2.6}}
\atoms{vertex,style=gray}{0y/p={0,0}, 1y/p={1.5,1.6}, 2y/p={1.2,2.6}, 3y/p={2.7,1}}
\fill[m or not] (0-c)--(1-c)--(3-c)--(2-c)--cycle;
\draw[e or not] (0)--(0x) (1)--(1x) (2)--(2x) (3)--(3x);
\draw (0)--(1) (1)--(3) (0)--(2) (2)--(3);
\draw (0x)--(1x) (1x)--(3x) (0x)--(2x) (2x)--(3x);
\draw[dotted,gray] (0)--(0y) (3)--(3y) (1y)--(1x) (2y)--(2x) (0y)--(1) (1)--(3y) (0y)--(2) (2)--(3y) (0)--(1x) (1x)--(3) (0)--(2x) (2x)--(3) (0x)--(1y) (1y)--(3x) (0x)--(2y) (2y)--(3x);
\node at (1.3,0.5){$\scriptstyle 1$};
\end{tikzpicture}\;.
\end{equation}
At last, we would like to remark that the toric code can be straight-forwardly generalized to arbitrary spatial cellulations.
The underlying spacetime cellulation is simply the product of the space cellulation with the regular 1-dimensional lattice.

\subsection{Subsystem toric code}
\label{sec:subsystem}
The \emph{subsystem toric code} is a topological subsystem code developed in Ref.~\cite{Bravyi2012}, which only involves 3-body measurements.
From the path integral point of view, it can be derived from the stabilizer toric code on a regular triangular spatial lattice by a simple modification of the spacetime cellulation.
So we start with a spacetime cellulation consisting of triangle-prism volumes,
\begin{equation}
\label{eq:triangle_prism}
\begin{tikzpicture}
\atoms{vertex}{{0/}, {2/p={1.6,0}}, 1/p={1,0.5}}
\atoms{vertex}{0x/p={0,1.4}, 2x/p={1.6,1.4}, 1x/p={1,1.9}}
\draw[dashed] (0)--(1) (1)--(2) (1)--(1x);
\draw (0)--(2) (0x)--(1x) (1x)--(2x) (0x)--(2x) (0)--(0x) (2)--(2x);
\end{tikzpicture}\;.
\end{equation}
This way, the operators $T_1$ at the $xy$ faces are already 3-qubit, but the operators $V_1$ at to the $t$ edges are 6-qubit.
However, $V_1$ can be split up into two 3-qubit operators $V_1^a$ and $V_1^b$ by the following trick.
We choose one spatial direction $x$ aligned with one third of the edges, and refer to the orthogonal direction as $y$.
Then at every space vertex, we pair up the two adjacent triangles whose centers are located in the positive and in the negative $y$ direction,
\begin{equation}
\begin{tikzpicture}
\draw (-0.6,1)edge[mark={arr,e},ind=$x$]++(0:0.3) (-0.6,1)edge[mark={arr,e},ind=$y$]++(90:0.3);
\clip (0,0)rectangle (3,2);
\foreach \y in {0,...,6}{
\foreach \x in {0,...,9}{
\draw ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+\y*(120:0.8)$);
\draw ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
\draw (${\x+1}*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
\atoms{vertex}{\x\y/p={$\x*(0:0.8)+\y*(120:0.8)$}}
\draw[opacity=0.3,line width=8,line cap=round] ($\x*(0:0.8)+\y*(120:0.8)+(-90:0.45)$)--($\x*(0:0.8)+\y*(120:0.8)+(90:0.45)$);
}
}
\end{tikzpicture}\;.
\end{equation}
In the spacetime cellulation, we get a pair of triangle prisms adjacent to each $t$ edge.
We simply split up each 6-valent $t$ edge into two 3-valent edges, such that the two adjacent prisms become one single volume,
\begin{equation}
\label{eq:subsys_volume}
\begin{tikzpicture}
\draw (-0.6,0.7)edge[mark={arr,e},ind=$x$]++(30:0.3) (-0.6,0.7)edge[mark={arr,e},ind=$y$]++(160:0.3) (-0.6,0.7)edge[mark={arr,e},ind=$t$]++(90:0.3);
\atoms{vertex}{{0/}, {2/p={1.6,0}}, 1/p={1,0.5}, 3/p={3.2,0}, 4/p={2.6,-0.5}}
\atoms{vertex}{0x/p={0,1.4}, 2x/p={1.6,1.4}, 1x/p={1,1.9}, 3x/p={3.2,1.4}, 4x/p={2.6,0.9}}
\draw[dashed] (0)--(1) (1)--(2) (2)--(3);
\draw[e or not,dashed]  (1)--(1x) (2)to[bend right](2x);
\draw (0)--(2) (0x)--(1x) (1x)--(2x) (0x)--(2x) (2)--(4)--(3) (2x)--(4x)--(3x) (2x)--(3x);
\draw[e or not] (3)--(3x) (4)--(4x) (0)--(0x) (2)to[bend left](2x);
\fill[m or not] (0-c)--(1-c)--(2-c)--cycle (2-c)--(3-c)--(4-c);
\fill[m or not] (0x-c)--(1x-c)--(2x-c)--cycle (2x-c)--(3x-c)--(4x-c);
\end{tikzpicture}\;.
\end{equation}
The operators $V_1^a$ and $V_1^b$ each correspond to one of those edges together with the three adjacent triangles.
We then define versions of $V^a_e$ and $V^b_e$ where the corresponding edge carries an $e$ anyon, and according instruments $I[\mathbf V^a]$, $I[\mathbf V^b]$.

In total, the QEC circuit consists of $X_0X_1X_2$ and $Z_0Z_1Z_2$ measurements on different triples of qubits, which are located at the edges of a triangular lattice.
After drawing a square lattice over the triangular lattice as follows,
\begin{equation}
\begin{tikzpicture}
\clip (0,0)rectangle (3,2);
\foreach \y in {0,...,6}{
\foreach \x in {0,...,9}{
\draw[gray,dashed] ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+\y*(120:0.8)$);
\draw[gray,dashed] ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
\draw[gray,dashed] (${\x+1}*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
\atoms{circ,tiny,bdastyle=gray}{\x\y/p={$\x*(0:0.8)+\y*(120:0.8)$}}
\atoms{vertex}{\x\y0/p={$\x*(0:0.8)+(180:0.4)+\y*(120:0.8)$}}
\draw ($\x*(0:0.8)+(180:0.4)+\y*(120:0.8)$)--++(60:0.8) ($\x*(0:0.8)+(180:0.4)+\y*(120:0.8)$)--++(120:0.8);
}
}
\end{tikzpicture}\;,
\end{equation}
we recover the subsystem code as presented in Ref.~\cite{Bravyi2012} with qubits on the edges and vertices, and measurements at the corners.

Let us briefly discuss the general decoding procedure of Proposition~\ref{prop:path_integral_decoding} for the present code.
As for the toric code, the spacetime syndrome consists of an $e$ 1-cocycle and an $m$ 2-cocycle in the spacetime lattice (which is now different).
However, when we run the noiseless QEC circuit starting from a steady state, we do not deterministically measure the empty spacetime syndrome.
Instead, at every split-up pair of $t$ edges sharing their start and end vertex, we measure twice $1$ or twice $e$ with probability $\frac12$.
Apart from this, the procedure is analogous to the stabilizer toric code.

\subsection{CSS Floquet code}
\label{sec:css_floquet}
As a third example, we consider the recently discovered CSS Floquet code \cite{Kesselring2022,Davydova2022,Aasen2022}.
This code performs 6 rounds of 2-body $XX$ or $ZZ$ measurements.
To obtain this code from our path-integral picture, we start with the toric code path integral on a cubic spacetime lattice, just as for the stabilizer toric code.
The only difference is that instead of $z$, we choose $t=x+y+z$ as the time direction.
The operators of the circuit are now just individual tensors at the edges and faces.
Traversing the path integral in the $t$ direction gives a natural direction to each tensor, acting as 2-qubit operators
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={0,1}}
\draw[actualedge] (0)--(1);
\end{tikzpicture}
\rightarrow
T_1\coloneqq
\begin{tikzpicture}
\atoms{delta}{0/}
\draw (0)--++(-45:0.6) (0)--++(-135:0.6) (0)--++(45:0.6) (0)--++(135:0.6);
\end{tikzpicture}
,\qquad 
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={1.4,0}, 2/p={0.7,-0.4}, 3/p={0.7,0.4}}
\draw (0)--(2)--(1)--(3)--(0);
\end{tikzpicture}
\rightarrow
V_1\coloneqq
\begin{tikzpicture}
\atoms{z2}{0/}
\draw (0)--++(-45:0.6) (0)--++(-135:0.6) (0)--++(45:0.6) (0)--++(135:0.6);
\end{tikzpicture}\;.
\end{equation}
Neither $T_1$ nor $V_1$ are unitaries.
In fact they are projectors onto the $+1$ subspace of 2-qubit operators $Z_0Z_1$ and $X_0X_1$.
Our construction proceeds by considering versions $T_m$ and $V_e$ of these operators including an anyon worldline segment.
To this end, we slightly modify the cubic lattice.
We split all faces into two triangles by diagonal 2-valent edges along the $x+y$, $x+z$, or $y+z$ direction, respectively.
Dually, we split all 4-valent edges into two 3-valent edges separated by a 2-gon, such that the 2-gons are perpendicular to the $x+y$, $x+z$, and $y+z$ directions.
A volume of this slightly modified cubic lattice thus looks like
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{{0/,vca}, {1/p={2,0},vcb}, {2/p={1,0.6},vcb}, {3/p={3,0.6},vcc}}
\atoms{vertex}{{0x/p={0,2},vcb}, {1x/p={2,2},vcc}, {2x/p={1,2.6},vcc}, {3x/p={3,2.6},vca}}
\draw[dashed] (0)to[bend left=20](2) (0)to[bend right=20](2) (2x)--(2)--(3) (3)to[bend left=20](3x) (2x)to[bend right=20](3x);
\draw[e or not,dashed] (0)--(3) (0)--(2x) (2)--(3x);
\draw (0)to[bend left=5](1) (0)to[bend left=20](1) (0)to[bend right=5](0x) (0)to[bend right=20](0x) (2x)--(0x)--(1x)--(1)--(3) (3)to[bend left=5](3x) (2x)to[bend right=5](3x) (1x)to[bend left=20](3x) (1x)to[bend right=20](3x);
\draw[e or not] (0)--(1x) (0x)--(3x) (1)--(3x);
\fill[m or not] (0-c)to[bend left=5](1-c)to[bend right=20]cycle (0-c)to[bend left=20](2-c)to[bend left=20]cycle (0-c)to[bend right=20](0x-c)to[bend left=5]cycle;
\fill[m or not] (3x-c)to[bend left=5](2x-c)to[bend right=20]cycle (3x-c)to[bend left=20](1x-c)to[bend left=20]cycle (3x-c)to[bend right=20](3-c)to[bend left=5]cycle;
\end{tikzpicture}\;,
\end{equation}
with new 2-valent edges and 2-gons shaded in red.
The coloring of vertices will become relevant later.
After this modification of the lattice path integral, $T_1$ now consists of two 3-valent edges separated by a 2-gon.
$T_m$ is the same with an anyon worldline perpendicular to the 2-gon,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{{0/vca}, {1/p={0,1.3},vcb}}
\draw[actualedge] (0)to[bend left](1) (0)to[bend right](1);
\fill[red,opacity=0.3] (0-c)to[bend left](1-c)to[bend left]cycle;
\end{tikzpicture}
\rightarrow
T_m\coloneqq
\begin{tikzpicture}
\atoms{z2,bdastyle=red}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}}
\draw (0)--(1) (0)--(2) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4);
\end{tikzpicture}\;.
\end{equation}
Together with $T_1$, we obtain an isometry $\mathbf T$,
\begin{equation}
\label{eq:floquet_t}
\mathbf T
\coloneqq
(T_1,T_m)
=
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}}
\draw (0)--(1) (0)--(2) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4);
\draw[classical] (0)--++(90:0.8);
\end{tikzpicture}\;.
\end{equation}
The according instrument $I[\mathbf T]$ is just a $Z_0Z_1$ measurement. 

Dually, $V_1$ now consists of a 2-valent diagonal edge together with the two adjacent triangles.
$V_e$ is the same with an $e$ anyon worldline segment along the diagonal edge,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{{0/vcb}, {1/p={2,0},vcb}, {2/p={1,-0.7},vca}, {3/p={1,0.7},vcc}}
\draw[red] (2)--(3);
\draw (0)--(2)--(1)--(3)--(0);
\end{tikzpicture}
\rightarrow
V_e
\coloneqq
\begin{tikzpicture}
\atoms{delta,bdastyle=red}{0/}
\atoms{z2}{1/p={0.8,0}, 2/p={-0.8,0}}
\draw (0)--(1) (0)--(2) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4);
\end{tikzpicture}\;,
\end{equation}
yielding an isometry
\begin{equation}
\label{eq:floquet_v}
\mathbf V
\coloneqq
(V_1,V_e)
=
\begin{tikzpicture}
\atoms{hadamard}{h/p={0,0.5}}
\atoms{delta}{0/}
\atoms{z2}{1/p={0.8,0}, 2/p={-0.8,0}}
\draw (0)--(1) (0)--(2) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4);
\draw[classical] (0)--(h) (h)--++(90:0.4);
\end{tikzpicture}\;.
\end{equation}
The according instrument $I[\mathbf V]$ is a $X_0X_1$ measurement. 

In principle, the spacetime cellulation fully specifies the combinatorics of the circuit formed by the instruments defined above.
However, it is instructive to express the circuit in a more conventional form as a sequence of measurements acting on qubits located on a fixed spatial lattice.
We start by decomposing the circuit into rounds of operators acting in parallel.
Within one $t=x+y+z$ period there are three different levels of vertices, which we will label $\vca0$, $\vcb1$, and $\vcc2$ and color red, green, and blue, respectively.
Accordingly, there are three types of edges, $\vca0\vcb1$, $\vcb1\vcc2$, and $\vcc2\vca0$, and three types of faces, $\vca0\vcb1\vcc2$, $\vcb1\vcc2\vca0$, and $\vcc2\vca0\vcb1$.
So one $t$ period of the circuit consists of 6 rounds of instruments:
\begin{equation}
\label{eq:floquet_circuit}
\begin{multlined}
\rightarrow I[\mathbf T]_{\vca0\vcb1} \rightarrow I[\mathbf V]_{\vca0\vcb1\vcc2} \rightarrow I[\mathbf T]_{\vcb1\vcc2}\\
\rightarrow I[\mathbf V]_{\vcb1\vcc2\vca0} \rightarrow I[\mathbf T]_{\vcc2\vca0} \rightarrow I[\mathbf V]_{\vcc2\vca0\vcb1}\rightarrow\;.
\end{multlined}
\end{equation}
An appropriate spatial lattice on which the circuit acts can be obtained by projecting the 3-dimensional cubic lattice along the $t$ direction.
This yields a 2-dimensional regular triangular lattice such that the vertices of each triangle have different numbers/colors,
\begin{equation}
\label{eq:triangular_projection}
\begin{tikzpicture}
\clip (0,0)rectangle (4.5,3);
\foreach \y in {0,...,6}{
\foreach \x in {0,...,9}{
\draw ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+\y*(120:0.8)$);
\draw ($\x*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
\draw (${\x+1}*(0:0.8)+\y*(120:0.8)$)--(${\x+1}*(0:0.8)+{\y+1}*(120:0.8)$);
}
}
\foreach \su in {0,3,6,9}{
\foreach \x in {0,...,9}{
\atoms{vertex,vca}{\x\su/p={$(0.8*\x,0)+{\su-\x}*(120:0.8)$}}
}
}
\foreach \su in {1,4,7,10}{
\foreach \x in {0,...,9}{
\atoms{vertex,vcb}{\x\su/p={$(0.8*\x,0)+{\su-\x}*(120:0.8)$}}
}
}
\foreach \su in {2,5,8,11}{
\foreach \x in {0,...,9}{
\atoms{vertex,vcc}{\x\su/p={$(0.8*\x,0)+{\su-\x}*(120:0.8)$}}
}
}
\end{tikzpicture}\;.
\end{equation}
The spacetime faces become rhombi in this spatial lattice, consisting of two triangles.

Each qubit corresponds to a time-like continued string of bonds in the tensor network/circuit diagram.
The goal is to arrive at a circuit which consists only of 2-body measurements without any swap operations.
This fully determines the time-like strings by the way the inputs and outputs are paired in Eq.~\eqref{eq:floquet_t} and Eq.~\eqref{eq:floquet_v}.
Geometrically, those time-like strings are sequences of faces and edges.
In the space projection, there is one such sequence for every triangle $F$ as follows,
\begin{equation}
\begin{tikzpicture}
\atoms{void}{x/p={0:1.2}, y/p={60:1.2}}
\atoms{vertex}{0/vca, {1/vcb,p=x}, {2/vcc,p=y}, {3/vcc,p={$(x)-(y)$}}, {4/vca,p={$(x)+(y)$}}, {5/vcb,p={$(y)-(x)$}}}
\draw (0)edge[mark={lab=$0$}](1) (0)edge[mark={lab=$2$}](2) (1)edge[mark={lab=$4$}](2);
\draw (0)--(3)--(1)--(4)--(2)--(5)--(0);
\node at ($0.5*(x)+(-90:0.3)$){$3$};
\node at ($0.5*(x)+(-90:0.3)$){$3$};
\node at ($(x)+0.5*(y)-0.5*(x)+(30:0.3)$){$1$};
\node at ($0.5*(y)+(150:0.3)$){$5$};
\node at ($1/3*(x)+1/3*(y)$){$F$};
\end{tikzpicture}\;.
\end{equation}
The labels $0$, $2$, $4$ correspond to projections of edges, and the labels $1$, $3$, $5$ at triangles at correspond to projections of faces formed by this triangle together with $F$.
Then the sequence $0-1-2-3-4-5$ is the time-like string within one $t$ period.
% We can define such a string for each triangle $F$ of the spatial lattice.
% Denote by $F_{\vca0\vcb1}$ a spacetime edge whose projection is the $\vca0\vcb1$ edge of $F$, and analogously for other numbers.
% Denote by $F_{\vca0\vcb1\vcc2}$ a spacetime face whose projection consists of the $F$ and the neighboring triangle sharing its $\vca0\vcc2$ edge, and analogously for other numbers.
% Then the string of bonds corresponding to the qubit at $F$ is given by
% \begin{equation}
% - F_{\vca0\vcb1} - F_{\vca0\vcb1\vcc2} - F_{\vcb1\vcc2}
% - F_{\vcb1\vcc2\vca0} - F_{\vcc2\vca0} - F_{\vcc2\vca0\vcb1}-\;,
% \end{equation}
% within one $t$ period.

As we have seen, there is one qubit associated to each triangle.
For each edge, the instrument $I[\mathbf T]$ acts on the qubits at the two triangles adjacent to its projection.
For each face, $I[\mathbf V]$ acts on the qubits at the two triangles contained in its projection.
Note that the instruments $I[\mathbf T]_{\vca0\vcb1}$ act on the same pairs of qubits as the instruments $I[\mathbf V]_{\vcb1\vcc2\vca0}$, and analogous for cyclic permutation of the numbers/colors.
Taking into account that $I[\mathbf T]$ is a $Z_0Z_1$ measurement and $I[\mathbf V]$ is a $X_0X_1$ measurement, we can rewrite Eq.~\eqref{eq:floquet_circuit} as
\begin{equation}
\begin{multlined}
\rightarrow ZZ_{\vca0\vcb1} \rightarrow XX_{\vcc2\vca0}\rightarrow ZZ_{\vca1\vcb2}
\\
\rightarrow XX_{\vcc0\vca1} \rightarrow ZZ_{\vca2\vcb0} \rightarrow XX_{\vcc1\vca2} \rightarrow\;.
\end{multlined}
\end{equation}
After going to the dual hexagonal lattice, we recover the CSS Floquet code as introduced in Refs.~\cite{Kesselring2022,Davydova2022,Aasen2022}.

Let us briefly describe the general decoding procedure in Proposition~\ref{prop:path_integral_decoding} for the present code.
As for previous codes, the noiseless spacetime syndrome consists of an $e$ 1-cycle and $m$ 2-cocycle inside the modified cubic spacetime lattice.
In contrast to the stabilizer and subsystem toric code, the anyon worldlines in the spacetime syndrome are not aligned with the $t$ direction.
As for the subsystem toric code, we do not deterministically measure the empty spacetime syndrome when applying the noiseless circuit starting with a steady state of the code.
Rather, the syndrome will be a random superposition of local loops.
Apart from those differences, the decoding is analogous to the stabilizer toric code.
That is, we insert 2-gons and 2-valent edges with potential $m$ and $e$ worldlines inside a spatial cut of the lattice at time $T$, similar to Eq.~\eqref{eq:toric_code_correction}.

\subsection{Honeycomb Floquet code}
\label{sec:honeycomb_floquet}
In this section, we consider the honeycomb Floquet code introduced in Ref.~\cite{Hastings2021}.
The underlying tensor-network path integral will be referred to as the \emph{honeycomb path integral}.
It has the same shape as the cubic-lattice toric-code path integral used in previous sections.
However, there is a third kind of tensor,
\begin{equation}
\begin{multlined}
\begin{tikzpicture}
\atoms{cc}{0/}
\draw (0)edge[mark={arr,s,f}, ind=$a$]++(0:0.5) (0)edge[mark={arr,s,f}, ind=$b$]++(90:0.5) (0)edge[ind=$c$]++(180:0.5);
\node at (-90:0.5){$\ldots$};
\end{tikzpicture}
\\
=
\begin{cases}
(-1)^{\frac{a+b-c+\ldots}{2}} & \text{if } a+b+c+\ldots=0\mod 2\\
0 & \text{otherwise}
\end{cases}\;.
\end{multlined}
\end{equation}
We will refer to this tensor as \emph{$\cc$-tensor} since it is related to the two-dimensional real algebra of complex numbers.
Note that the tensor depends on a choice of arrow direction at each index, which we indicate by an arrow at the incoming indices.
The honeycomb path integral has $\delta$-tensors at every $z$ edge and every $xy$ face, $\zz_2$-tensors at every $x$ edge and $yz$ face, and $\cc$-tensors at every $y$ edge and $xz$ face.
The choice of arrow directions of the $\cc$-tensors does not matter, but to be explicit we let them point in the positive $x$ and $z$ direction, respectively.

We will now see that the honeycomb path integral is in the same exact phase as the toric code path integral.
The sequence of tensor-network equations transforming one path integral into the other is very simple.
We first insert a resolution of the identity, $\mathbb1=GG^{-1}$ at every bond.
$G$ is an invertible matrix which can depend on the bond within a unit cell, but not on the unit cell.
Then we contract each 4-index tensor with the four surrounding matrices $G$ or $G^{-1}$, yielding a new 4-index tensor at that place.
In fact, this is just a complicated way of saying that the two tensor networks are equivalent up to a basis change at every bond.
The matrices $G$ are built from the Hadamard matrix $H$ in Eq.~\eqref{eq:hadamard}, together with the following two matrices,
\begin{equation}
\begin{tikzpicture}
\atoms{smat}{0/}
\draw (0-l)--++(180:0.4) (0-r)--++(0:0.4);
\end{tikzpicture}
\coloneqq
S\coloneqq
\begin{pmatrix}
1&0\\0&i
\end{pmatrix}\;,
\quad
\begin{tikzpicture}
\atoms{umat}{0/}
\draw (0-l)--++(180:0.4) (0-r)--++(0:0.4);
\end{tikzpicture}
\coloneqq
U
\coloneqq HSH\;.
\end{equation}
$H$, $S$, and $U$ are all unitary,
\begin{equation}
\label{eq:honeycomb_gauge2}
\begin{aligned}
\begin{tikzpicture}
\atoms{hadamard}{0/p={-0.3,0}, 1/p={0.3,0}}
\draw (0-l)--++(180:0.3) (1-r)--++(0:0.3) (0-r)--(1-l);
\end{tikzpicture}
&=
\begin{tikzpicture}
\draw (0,0)--++(0:0.8);
\end{tikzpicture}\;,
&
\begin{tikzpicture}
\atoms{smat}{0/p={-0.3,0}, {1/p={0.3,0},lab={t=$*$,p={90:0.2}}}}
\draw (0-l)--++(180:0.3) (1-r)--++(0:0.3) (0-r)--(1-l);
\end{tikzpicture}
&=
\begin{tikzpicture}
\draw (0,0)--++(0:0.8);
\end{tikzpicture}\;,
\\
\begin{tikzpicture}
\atoms{umat}{0/p={-0.3,0}, {1/p={0.3,0},lab={t=$*$,p={90:0.2}}}}
\draw (0-l)--++(180:0.3) (1-r)--++(0:0.3) (0-r)--(1-l);
\end{tikzpicture}
&=
\begin{tikzpicture}
\draw (0,0)--++(0:0.8);
\end{tikzpicture}\;,
&&
\end{aligned}
\end{equation}
where the $*$ denotes complex conjugation.
$H$, $S$, and $U$, together with the 4-index $\delta$, $\zz_2$ and $\cc$ tensors satisfy two types of equations.
First, adding $H$ to all indices exchanges $\delta$ and $\zz_2$, and the same holds with $S$, $\zz_2$ and $\cc$, as well as with $U$, $\delta$, and $\cc$,
\begin{equation}
\label{eq:honeycomb_gauge0}
\begin{aligned}
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{smat}{{x0/p=0:0.5,lab={t=$*$,p=90:0.25}}, {x1/p=90:0.5,lab={t=$*$,p=0:0.25}}, x2/p=180:0.5, x3/p=-90:0.5}
\draw (0)--(x0) (0)--(x1) (0)--(x2) (0)--(x3) (x0)--++(0:0.4) (x1)--++(90:0.4) (x2)--++(180:0.4) (x3)--++(-90:0.4);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{cc}{0/}
\draw (0)edge[mark={arr,s,f}]++(0:0.5) (0)edge[mark={arr,s,f}]++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;,
&
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{hadamard}{{x0/p=0:0.5}, {x1/p=90:0.5}, x2/p=180:0.5, x3/p=-90:0.5}
\draw (0)--(x0) (0)--(x1) (0)--(x2) (0)--(x3) (x0)--++(0:0.4) (x1)--++(90:0.4) (x2)--++(180:0.4) (x3)--++(-90:0.4);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{z2}{0/}
\draw (0)--++(0:0.5) (0)--++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;,
\\
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{umat}{{x0/p=0:0.5,lab={t=$*$,p=90:0.25}}, {x1/p=90:0.5,lab={t=$*$,p=0:0.25}}, x2/p=180:0.5, x3/p=-90:0.5}
\draw (0)--(x0) (0)--(x1) (0)--(x2) (0)--(x3) (x0)--++(0:0.4) (x1)--++(90:0.4) (x2)--++(180:0.4) (x3)--++(-90:0.4);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{cc}{0/}
\draw (0)edge[mark={arr,s,f}]++(0:0.5) (0)edge[mark={arr,s,f}]++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;.
&&
\end{aligned}
\end{equation}
Due to Eq.~\eqref{eq:honeycomb_gauge2}, each $H$, $S$, or $U$ matrix can be either on the right or on the left-hand side.
Furthermore, two $S$ matrices adjacent to a $\delta$-tensor can be canceled, and the same for $H$ and $\cc$, as well as for $U$ and $\zz_2$:
\begin{equation}
\label{eq:honeycomb_gauge3}
\begin{aligned}
\begin{tikzpicture}
\atoms{delta}{0/}
\atoms{smat}{{x0/p=0:0.5}, {x1/p=180:0.5,lab={t=$*$,p=90:0.25}}}
\draw (0)--(x0) (0)--(x1) (x0)--++(0:0.4) (x1)--++(180:0.4) (0)--++(90:0.6) (0)--++(-90:0.6);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{delta}{0/}
\draw (0)edge[]++(0:0.5) (0)edge[]++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;,
&
\begin{tikzpicture}
\atoms{cc}{0/}
\atoms{hadamard}{{x0/p=0:0.5}, {x1/p=180:0.5}}
\draw (0)edge[mark={arr,f,s}](x0) (0)--(x1) (x0)--++(0:0.4) (x1)--++(180:0.4) (0)edge[mark={arr,f,s}]++(90:0.6) (0)--++(-90:0.6);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{cc}{0/}
\draw (0)--++(0:0.5) (0)edge[mark={arr,s,f}]++(90:0.5) (0)edge[mark={arr,s,f}]++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;,
\\
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{umat}{{x0/p=0:0.5}, {x1/p=180:0.5,lab={t=$*$,p=90:0.25}}}
\draw (0)--(x0) (0)--(x1) (x0)--++(0:0.4) (x1)--++(180:0.4) (0)--++(90:0.6) (0)--++(-90:0.6);
\end{tikzpicture}
&=
\begin{tikzpicture}
\atoms{z2}{0/}
\draw (0)edge[]++(0:0.5) (0)edge[]++(90:0.5) (0)--++(180:0.5) (0)--++(-90:0.5);
\end{tikzpicture}\;.
&&
\end{aligned}
\end{equation}
The analogous equations also hold if $H$, $S$, or $U$ are at the top and bottom instead of left and right indices.
With this, we are now ready to find matrices $G$ which transform the toric-code path integral into the honeycomb path integral.
Each bond inside a unit cell can be specified by the involved edge $a$ (either $x$, $y$, or $z$), the involved face $b$ (either $xy$, $xz$, or $yz$), and the direction $\pm$ of the bond $a\rightarrow b$ relative to the $x$, $y$, or $z$ direction.
Thus, we need to specify 12 different matrices $G(a,b,\pm)$.
As an ansatz, we set $G(a,b,-)\coloneqq G(a,b,+)^*$, and impose that every $G$ is some product formed by $H$, $S$, and $U$.
For each edge $a$, there are different choices for the two matrices $G(a,\ldots,+)$, such that the toric-code tensor together with the surrounding $G$ matrices yields the according honeycomb tensor.
For example, for $a=x$, we want to transform a toric-code $\delta$-tensor into a honeycomb $\zz_2$-tensor.
First, any of the two matrices $G(a,\ldots,+)$ may or may not contain $S$, since each $G$ appears at two ($\pm$) indices and can be annihilated using the first of Eq.~\eqref{eq:honeycomb_gauge3}.
Then, both matrices $G(a,\ldots,+)$ need to contain $H$ in order to transform the $\delta$-tensor into a $\zz_2$-tensor via the second of Eq.~\eqref{eq:honeycomb_gauge0}.
Finally, each of $G(a,\ldots,+)$ may or may not contain $U$, due to the third of Eq.~\eqref{eq:honeycomb_gauge3}.
This yields a set of possible choices for either matrix $G(a,\ldots,+)$ which we denote by $(S)H(U)$.
The following table shows all potential $G(a,\ldots,+)$ for edges $a$ or $G(\ldots,b,+)$ for faces $b$,
\begin{equation}
\begin{tabular}{l|l|l|l}
$a/b$ & toric code & honeycomb & \makecell{potential\\$G(a/\ldots,\ldots/b,+)$}\\
\hline
$x$ & $\delta$ & $\zz_2$ & $(S)H(U)$\\
$y$ & $\delta$ & $\cc$ & $(S)U(H)$\\
$z$ & $\delta$ & $\delta$ & $(S)\mathbb{1}(S)$\\
$xy$ & $\zz_2$ & $\delta$ & $(U)H(S)$\\
$xz$ & $\zz_2$ & $\cc$ & $(U)S(H)$\\
$yz$ & $\zz_2$ & $\zz_2$ & $(U)\mathbb{1}(U)$
\end{tabular}\;.
\end{equation}
In order to find $G(a,b,+)$, we write out all potential $G(a,\ldots,+)$ and $G(\ldots,b,+)$ and take any common element.
A solution is given by
\begin{equation}
\label{eq:honeycomb_basis_transformation}
\begin{tabular}{rcl|l}
$a$&$-$&$b$&$G(a,b,+)$\\
\hline
$x$&$-$&$xy$&$H$\\
$x$&$-$&$xz$&$SH$\\
$y$&$-$&$xy$&$UH$\\
$y$&$-$&$yz$&$U$\\
$z$&$-$&$xz$&$S$\\
$z$&$-$&$yz$&$\mathbb{1}$\\
\end{tabular}\;.
\end{equation}
This change of basis can not only be applied the imaginary-time path integral, but to the whole QEC circuit of instruments of Section~\ref{sec:css_floquet}.
This way we obtain a circuit with three different instruments.
The $\delta$ and $\zz_2$ tensors give rise to operators $T_1$ and $V_1$ and instruments $I[\mathbf T]$ and $I[\mathbf V]$ as in the CSS Floquet code in Section~\ref{sec:css_floquet}.
The $\cc$-tensors yield an operator $W_1$ which is the $+1$ projector for the $Y_0Y_1$ measurement,
\begin{equation}
W_1\coloneqq
\begin{tikzpicture}
\atoms{cc}{0/}
\draw (0)--++(-45:0.6) (0)--++(-135:0.6) (0)--++(45:0.6) (0)--++(135:0.6);
\end{tikzpicture}
=
\frac12 (1+Y_0Y_1)
\;.
\end{equation}
Thus, $I[\mathbf W]$ is simply a $Y_0Y_1$ measurement.

Now the circuit in Eq.~\eqref{eq:floquet_circuit} becomes
\begin{equation}
\begin{multlined}
\rightarrow (I[\mathbf T]_{z\vca0\vcb1},I[\mathbf V]_{x\vca0\vcb1},I[\mathbf W]_{y\vca0\vcb1})\\
\rightarrow (I[\mathbf T]_{xy\vca0\vcb1\vcc2},I[\mathbf V]_{yz\vca0\vcb1\vcc2},I[\mathbf W]_{xz\vca0\vcb1\vcc2})\\
\rightarrow (I[\mathbf T]_{z\vcb1\vcc2},I[\mathbf V]_{x\vcb1\vcc2},I[\mathbf W]_{y\vcb1\vcc2})\\
\rightarrow (I[\mathbf T]_{xy\vcb1\vcc2\vca0},I[\mathbf V]_{yz\vcb1\vcc2\vca0},I[\mathbf W]_{xz\vcb1\vcc2\vca0})\\
\rightarrow (I[\mathbf T]_{z\vcc2\vca0},I[\mathbf V]_{x\vcc2\vca0},I[\mathbf W]_{y\vcc2\vca0})\\
\rightarrow (I[\mathbf T]_{xy\vcc2\vca0\vcb1},I[\mathbf V]_{yz\vcc2\vca0\vcb1},I[\mathbf W]_{xz\vcc2\vca0\vcb1})\rightarrow\;.
\end{multlined}
\end{equation}
Projecting the cubic lattice onto a triangular lattice as in Eq.~\eqref{eq:triangular_projection}, we see that the operators at $x\vca0\vcb1$ and $yz\vcb1\vcc2\vca0$ (and analogous pairs) act on the same pair of qubits.
Using this, we find that the circuit repeats already after three rounds, yielding
\begin{equation}
\begin{multlined}
\rightarrow (ZZ_{z\vca0\vcb1},XX_{x\vca0\vcb1},YY_{y\vca0\vcb1})\\
\rightarrow (ZZ_{z\vcc2\vca0},XX_{x\vcc2\vca0},YY_{y\vcc2\vca0})\\
\rightarrow (ZZ_{z\vcb1\vcc2},XX_{x\vcb1\vcc2},YY_{y\vcb1\vcc2})\rightarrow\;.
\end{multlined}
\end{equation}
After going to the dual hexagonal lattice, we obtain the honeycomb code as presented in \cite{Hastings2021}.

Let us express the above equivalence between the CSS Floquet code and honeycomb Floquet code in a more conventional way.
After every round of measurements $I_i$, we add a resolution of the identity $G_iG_i^{-1}$ for an on-site unitary $G_i$.
For each qubit, $G_i$ depends on the edge directions of the $XX$ and $ZZ$ measurements in this and the next round according to Eq.~\eqref{eq:honeycomb_basis_transformation}.
Then we combine $\widetilde I_i\coloneqq G_{i-1}^{-1}I_i G_i$ into a new instrument.

Note that the reduced time periodicity is closely related to the fact that the honeycomb path integral on a cubic lattice allows for a smaller choice of unit cell, namely one consisting of only one $\delta$, one $\zz_2$, and one $\cc$-tensor.
For example, consider an $xy$ plane containing $xy$ faces, and the honeycomb path integral restricted to this plane including the tensors at all $xy$ faces, $x$ edges, and $y$ edges.
When shifting this plane by $\frac12 z$, the tensors at $z$ edges, $xz$ faces, and $yz$ faces form exactly the same tensor network on the Poincar\'e dual lattice, that is, shifted by $\frac12x+\frac12y$.
So instead of $\{x,y,z\}$, we can choose $\{x,y,\frac12 x+\frac12 y+\frac12 z\}$ as a unit cell.
When we instead consider those two planes shifted by $\frac12 z$ for the toric code, we swap $\delta$ and $\zz_2$ tensors in addition to going to the dual lattice.
This has the same effect as inserting a duality domain wall (exchanging $e$ and $m$ anyons) in between the two planes.
So with the new unit cell, the phase of both path integrals is a toric code with a rigid stack of duality domain walls perpendicular to $z$.
The according exchange of $e$ and $m$ after one code cycle has already been observed in the honeycomb code \cite{Hastings2021}.
The halved unit cell is also responsible for the weak breaking of translation symmetry in the closely related Kitaev honeycomb model Hamiltonian \cite{Kitaev2005}.

\section{New codes from tensor-network path integrals}
\label{sec:new_examples}
In this section we use our path integral framework to construct two new error correcting codes.
First, we introduce a generalization of the CSS Floquet code to $3+1$ dimensions.
Then we construct a non-Pauli Floquet-like code based on the double-semion string-net model.
\subsection{Floquet toric code in 3+1 dimensions}
\label{sec:3d_toric_code}
In this section, we use our method to construct a new Floquet code, namely a Floquet version of the toric code in $3+1$ dimensions.
The $3+1$-dimensional toric code can be described by a Euclidean tensor-network path integral on arbitrary 4-dimensional cellulations.
It is given by a sum over all cellular 2-cocycles, that is, configurations of $\zz_2$ variables on all the faces, such that at every volume the sum of variables at its boundary faces is $0$ (mod $2$).
So the tensor network consists of one $\delta$-tensor at every face and one $\zz_2$-tensor at every volume, with bonds shared between pairs of adjacent face and volume.

We can also introduce defects inside the path integral.
We will use two types of defects, namely line-like $m$ defects, as well as membrane-like $e$ defects.
The $e$ defects are placed on 2-cycles, and at every face involved in the defect, we replace the $\delta$-tensor by the signed $\delta$-tensor in Eq.~\eqref{eq:e_anyon_tensor}.
The $m$ defects are placed on 3-cocyles, and at every volume involved in the defect, we replace the $\zz_2$-tensor by the odd $\zz_2$-tensor in Eq.~\eqref{eq:m_anyon_tensor}.

To construct the Floquet code, we take a 4-dimensional hypercubic lattice spanned by the four unit vectors $w$, $x$, $y$, $z$, and choose $t=w+x+y+z$ as the time direction.
The operators of the circuit are just individual $4$-index $\delta$-tensors at the faces, and $6$-index $\zz_2$-tensors at the volumes.
The diagonal $t$ direction allows for a natural interpretation of those tensors as operators by dividing their indices into inputs and outputs.
We have two operators,
\begin{equation}
\label{eq:3d_floquet_face_operator}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={1,0}, 2/p={0.4,0.4}, 3/p={1.4,0.4}}
\draw (0)--(1)--(3)--(2)--(0);
\end{tikzpicture}
\rightarrow
T_1\coloneqq
\begin{tikzpicture}
\atoms{delta}{0/}
\draw (0)--++(-45:0.6) (0)--++(-135:0.6) (0)--++(45:0.6) (0)--++(135:0.6);
\end{tikzpicture}\;,
\end{equation}
\begin{equation}
\label{eq:3d_floquet_volume_operator}
\begin{tikzpicture}
\atoms{vertex}{{0/lab={t=$\vca0$,p=-90:0.25},vca}, {1/p={0.8,0.8},lab={t=$\vcb{1a}$,p=0:0.3},vcb}, {2/p={0,0.5},lab={t=$\vcb{1b}$,p=90:0.3},vcb}, {3/p={0.8,1.3},lab={t=$\vcc{2a}$,p=90:0.3},vcc}}
\atoms{vertex}{{0x/p={-0.8,0.8},lab={t=$\vcb{1c}$,p=180:0.3},vcb}, {1x/p={0,1.6},lab={t=$\vcc{2b}$,p=-90:0.3},vcc}, {2x/p={-0.8,1.3},lab={t=$\vcc{2c}$,p=180:0.3},vcc}, {3x/p={0,2.1},lab={t=$\vcd3$,p=45:0.25},vcd}}
\draw[dashed] (0)--(2) (2x)--(2)--(3) (3)--(3x) (2x)--(3x);
\draw (0)--(1) (0)--(0x) (2x)--(0x)--(1x)--(1)--(3) (3)--(3x) (2x)--(3x) (1x)--(3x);
\end{tikzpicture}
\rightarrow
V_1\coloneqq
\begin{tikzpicture}
\atoms{z2}{0/}
\draw (0)--++(-0.5,-0.5) (0)--++(0,-0.5) (0)--++(0.5,-0.5) (0)--++(-0.5,0.5) (0)--++(0,0.5) (0)--++(0.5,0.5);
\end{tikzpicture}\;.
\end{equation}
The coloring of the vertices will be explained later.
$T_1$ is a projector onto the $+1$ eigenspace of $Z_0Z_1$, whereas $V_1$ is a projector onto the intersection of the $+1$ eigenspaces of $X_0X_1$ and $X_1X_2$.
Since both $T_1$ and $V_1$ are non-unitary, we turn them into instruments using additional operators which include defect segments.
In addition to $T_1$ at a face we define another operator $T_m$ which includes a line segment of $m$ defect.
To this end, we modify the lattice slightly by replacing each 4-valent face by a pair of 3-valent faces separated by a pillow-like volume, whose boundary is formed by those two faces only.
$T_m$ then consists of the pillow-like volume together with the two edges, where the pillow-like volume contains an $m$ anyon segment.
Combined, we obtain an isometry,
\begin{equation}
\label{eq:3d_floquet_t}
\mathbf T
\coloneqq
(T_1,T_m)
=
\begin{tikzpicture}
\atoms{z2}{0/}
\atoms{delta}{1/p={0.8,0}, 2/p={-0.8,0}}
\draw (0)--(1) (0)--(2) (1)--++(-90:0.4) (1)--++(90:0.4) (2)--++(-90:0.4) (2)--++(90:0.4);
\draw[classical] (0)--++(90:0.8);
\end{tikzpicture}\;,
\end{equation}
such that $I[\mathbf T]$ is a $Z_0Z_1$ measurement.

To turn $V_1$ into an instrument, we define three new operators,  $V_{1e}$, $V_{e1}$, and $V_{ee}$, corresponding to the absence or presence of two different $e$ defect segments.
To this end, we divide the cube into three volumes along two 2-valent faces $g$ and $f$.
We do this in such a way that the boundary of the cube in Eq.~\eqref{eq:3d_floquet_volume_operator} is divided into the three pairs of faces, each consisting in one input (bottom) and one output (top) face.
$V_{1e}$, $V_{e1}$, or $V_{ee}$ are then the operators with $e$ segments at $g$, $f$, or at both.
There are two ``natural'' ways to choose pairs of input and output faces at the boundary of the cube, either by rotating towards the right, or towards the left when looking from $0$ to $3$ in the cube in Eq.~\eqref{eq:3d_floquet_volume_operator}.
\footnote{Note that in order to define ``left'' and ``right'', we choose a fixed projection of the 4-dimensional hypercubic lattice onto 3-dimensional space along the $t$ direction.}
In order to later obtain a circuit consisting only of 2-qubit measurements on a fixed spatial lattice without intermediate swap gates, we make the following choice:
We first notice that there are four different levels of vertices in the 4-dimensional cubic lattice along the $t$ direction, which we label by $\vca0$, $\vcb1$, $\vcc2$, and $\vcd3$.
Accordingly, there are four levels of faces, $\vca0\vcb1\vcc2$, $\vcb1\vcc2\vcd3$, $\vcc2\vcd3\vca0$, and $\vcd3\vca0\vcb1$, and four levels of volumes, $\vca0\vcb1\vcc2\vcd3$, $\vcb1\vcc2\vcd3\vca0$, $\vcc2\vcd3\vca0\vcb1$, and $\vcd3\vca0\vcb1\vcc2$.
We choose to rotate right for $\vca0\vcb1\vcc2\vcd3$ and $\vcc2\vcd3\vca0\vcb1$ cubes, and rotate left for $\vcb1\vcc2\vcd3\vca0$ and $\vcd3\vca0\vcb1\vcc2$ cubes.
So for the example cube in Eq.~\eqref{eq:3d_floquet_volume_operator} we rotate right, yielding pairs of faces $(\vca0\vcb{1a}\vcc{2a}\vcb{1b},\vcb{1b}\vcc{2a}\vcd3\vcc{2c})$,  $(\vca0\vcb{1b}\vcc{2c}\vcb{1c},\vcb{1c}\vcc{2c}\vcd3\vcc{2b})$, and $(\vca0\vcb{1c}\vcc{2b}\vcb{1a},\vcb{1a}\vcc{2b}\vcd3\vcc{2a})$.
An according set of faces which divide the cube is given by $f\coloneqq \vca0\vcb{1a}\vcc{2a}\vcd3\vcc{2b}\vcb{1c}$ and $g\coloneqq \vca0\vcb{1c}\vcc{2b}\vcd3\vcc{2c}\vcb{1b}$.
The isometry formed by all versions of $V$ together then looks like
\begin{equation}
\label{eq:3d_floquet_volume_measurement}
\begin{multlined}
\mathbf V\coloneqq
(V_1,V_{e1},V_{1e},V_{ee})
\\
=
\begin{tikzpicture}
\atoms{hadamard}{h0/p={-0.7,0.5}, h1/p={0.7,0.5}}
\atoms{delta}{d0/p={-0.7,0},d1/p={0.7,0}}
\atoms{z2}{z0/p={-1.4,0},z1/,z2/p={1.4,0}}
\draw (z0)--(z1)--(z2) (z0)edge[ind=$\scriptstyle\vca0\vcb{1a}\vcc{2b}\vcb{1c}$]++(-90:0.4) (z0)edge[ind=$\scriptstyle\vcb{1a}\vcc{2a}\vcd{3}\vcc{2b}$]++(90:0.4) (z1)edge[ind=$\scriptstyle\vca0\vcb{1a}\vcc{2a}\vcb{1b}$]++(-90:0.4) (z1)edge[ind=$\scriptstyle\vcb{1b}\vcc{2a}\vcd{3}\vcc{2c}$]++(90:0.4) (z2)edge[ind=$\scriptstyle\vca0\vcb{1c}\vcc{2c}\vcb{1b}$]++(-90:0.4) (z2)edge[ind=$\scriptstyle\vcb{1c}\vcc{2b}\vcd{3}\vcc{2c}$]++(90:0.4);
\draw[classical] (d0)--(h0) (h0)edge[ind=$f$]++(90:0.4) (d1)--(h1) (h1)edge[ind=$g$]++(90:0.4);
\end{tikzpicture}\\
=
\begin{tikzpicture}
\atoms{hadamard}{h0/p={-0.7,0.5}, h1/p={0.7,1}}
\atoms{delta}{d0/p={-0.7,0},d1/p={0.7,0.5}}
\atoms{z2}{z0/p={-1.4,0},z1/, zx/p={0,0.5},z2/p={1.4,0.5}}
\draw (z0)--(d0)--(z1)--(zx)--(d1)--(z2) (z0)--++(-90:0.4) (z0)--++(90:0.4) (z1)--++(-90:0.4) (zx)--++(90:0.4) (z2)--++(-90:0.4) (z2)--++(90:0.4);
\draw[classical] (d0)--(h0) (h0)--++(90:0.4) (d1)--(h1) (h1)--++(90:0.4);
\end{tikzpicture}
\;,
\end{multlined}
\end{equation}
where the labels refer to the example in Eq.~\eqref{eq:3d_floquet_volume_operator}.
As shown, $\mathbf V$ can be split up, such that $I[\mathbf V]$ consists of two consecutive measurements $X_0X_1$ and $X_1X_2$.
This splitting could also be represented geometrically by dividing the cube by a further 2-valent face, without a potential $e$ segment.

In principle, the combinatorics of the circuit formed by the instruments $I[\mathbf T]$ and $I[\mathbf V]$ is fully specified by the 4-dimensional cellulation.
However, it is instructive to give a more conventional description of this circuit in terms of measurements acting on fixed qubits on a spatial lattice.
We start by decomposing the circuit into rounds of instruments which are applied in parallel.
As mentioned in the previous paragraph, there are $4$ different levels of faces and volumes, so the circuit consists in 8 rounds of instruments,
\begin{equation}
\label{eq:floquet3d_circuit}
\begin{multlined}
\rightarrow I[\mathbf T]_{\vca0\vcb1\vcc2} \rightarrow I[\mathbf V]_{\vca0\vcb1\vcc2\vcd3} \rightarrow I[\mathbf T]_{\vcb1\vcc2\vcd3}\rightarrow I[\mathbf V]_{\vcb1\vcc2\vcd3\vca0}\\
\rightarrow I[\mathbf T]_{\vcc2\vcd3\vca0} \rightarrow I[\mathbf V]_{\vcc2\vcd3\vca0\vcb1}\rightarrow I[\mathbf T]_{\vcd3\vca0\vcb1} \rightarrow I[\mathbf V]_{\vcd3\vca0\vcb1\vcc2}\rightarrow
\end{multlined}
\end{equation}
To get an appropriate spatial lattice, we simply project the 4-dimensional cubic lattice onto $3$-dimensional space along the $t=w+x+y+z$ axis.
To this end, we choose new basis vectors
\begin{equation}
\begin{gathered}
\overline x=\frac12 w+\frac12 x-\frac12 y-\frac12 z\;,\\
\overline y=\frac12 w-\frac12 x+\frac12 y-\frac12 z\;,\\
\overline z=\frac12 w-\frac12 x-\frac12 y+\frac12 z\;,
\end{gathered}
\end{equation}
orthogonal to $t$.
The projected $\vca0$ and $\vcc2$ vertices then form a cubic lattice $A$ with unit vectors $\overline x$, $\overline y$, and $\overline z$.
The $\vcb1$ and $\vcd3$ vertices form a second cubic lattice $B$ shifted by $\frac12(\overline x+\overline y+\overline z)$, such that the vertices of $A$ are the centers of the cubes of $B$ and vice versa.
Within $A$, $\vca0$ and $\vcc2$ vertices alternate in a checkerboard manner, and the same for $\vcb1$ and $\vcd3$ vertices within $B$.
The projected edges have length $\sqrt{\frac34}$ and connect each $B$ vertex with the $8$ corner vertices of the corresponding $A$ cube, and vice versa.
The edges of the $A$ and $B$ lattice themselves are not projected edges of the 4-dimensional cubic lattice.
The following depicts a section of the lattice with four layers of vertices in $\overline y$ direction, projected edges in gray, edges of $A$ and $B$ in black, and edges connecting vertices of the two back layers dotted:
\begin{equation}
\label{eq:4_colorable_triangulation}
\begin{tikzpicture}
\atoms{void}{coordsys/p={-2,1.6},x/p={2,0}, y/p={0,2}, s1/p={0.6,0.8}, s2/p={-1.2,-0.4}}
\draw (coordsys)edge[mark={arr,e},ind=$\overline x$]++(0:0.3) (coordsys)edge[mark={arr,e},ind=$\overline y$]++(40:0.3) (coordsys)edge[mark={arr,e},ind=$\overline z$]++(90:0.3);
\atoms{vertex}{{0/vca}, {1/p={x},vcc}, {2/p={$2*(x)$},vca}, {3/p={y},vcc}, {4/p={$(x)+(y)$},vca}, {5/p={$2*(x)+(y)$},vcc}, {6/p={$2*(y)$},vca}, {7/p={$(x)+2*(y)$},vcc}, {8/p={$2*(x)+2*(y)$},vca}}
\draw[densely dotted] (0)--(1)--(2) (3)--(4)--(5) (6)--(7)--(8) (0)--(3)--(6) (1)--(4)--(7) (2)--(5)--(8);
\atoms{vertex}{{0x/vcb, p={$(0)+(s1)$}}, {1x/vcd, p={$(1)+(s1)$}}, {2x/vcb, p={$(2)+(s1)$}}, {3x/vcd, p={$(3)+(s1)$}}, {4x/vcb, p={$(4)+(s1)$}}, {5x/vcd, p={$(5)+(s1)$}}, {6x/vcb, p={$(6)+(s1)$}}, {7x/vcd, p={$(7)+(s1)$}}, {8x/vcb, p={$(8)+(s1)$}}}
\draw[densely dotted,gray] (0x)--(0) (0x)--(1) (0x)--(3) (0x)--(4) (1x)--(1) (1x)--(2) (1x)--(4) (1x)--(5) (2x)--(2) (2x)--(5) (3x)--(3) (3x)--(4) (3x)--(6) (3x)--(7) (4x)--(4) (4x)--(5) (4x)--(7) (4x)--(8) (5x)--(5) (5x)--(8) (6x)--(6) (6x)--(7) (7x)--(7) (7x)--(8) (8x)--(8);
\draw[front,densely dotted] (0x)--(1x)--(2x) (3x)--(4x)--(5x) (6x)--(7x)--(8x) (0x)--(3x)--(6x) (1x)--(4x)--(7x) (2x)--(5x)--(8x);
\atoms{vertex}{{0y/p={$(0)+(s2)$},vcc}, {1y/p={$(1)+(s2)$},vca}, {2y/p={$(2)+(s2)$},vcc}, {3y/p={$(3)+(s2)$},vca}, {4y/p={$(4)+(s2)$},vcc}, {5y/p={$(5)+(s2)$},vca}, {6y/p={$(6)+(s2)$},vcc}, {7y/p={$(7)+(s2)$},vca}, {8y/p={$(8)+(s2)$},vcc}}
\draw[front] (0)--(0y) (1)--(1y) (2)--(2y) (3)--(3y) (4)--(4y) (5)--(5y) (6)--(6y) (7)--(7y) (8)--(8y);
\draw[gray,front] (0x)--(0y) (0x)--(1y) (0x)--(3y) (0x)--(4y) (1x)--(1y) (1x)--(2y) (1x)--(4y) (1x)--(5y) (2x)--(2y) (2x)--(5y) (3x)--(3y) (3x)--(4y) (3x)--(6y) (3x)--(7y) (4x)--(4y) (4x)--(5y) (4x)--(7y) (4x)--(8y) (5x)--(5y) (5x)--(8y) (6x)--(6y) (6y)--(7y) (7x)--(7y) (7x)--(8y) (8x)--(8y);
\draw[front] (0y)--(1y)--(2y) (3y)--(4y)--(5y) (6y)--(7y)--(8y) (0y)--(3y)--(6y) (1y)--(4y)--(7y) (2y)--(5y)--(8y);
\atoms{vertex}{{0z/vcd, p={$(0x)+(s2)$}}, {1z/vcb, p={$(1x)+(s2)$}}, {2z/vcd, p={$(2x)+(s2)$}}, {3z/vcb, p={$(3x)+(s2)$}}, {4z/vcd, p={$(4x)+(s2)$}}, {5z/vcb, p={$(5x)+(s2)$}}, {6z/vcd, p={$(6x)+(s2)$}}, {7z/vcb, p={$(7x)+(s2)$}}, {8z/vcd, p={$(8x)+(s2)$}}}
\draw[front] (0x)--(0z) (1x)--(1z) (2x)--(2z) (3x)--(3z) (4x)--(4z) (5x)--(5z) (6x)--(6z) (7x)--(7z) (8x)--(8z);
\draw[gray,front] (0z)--(0y) (0z)--(1y) (0z)--(3y) (0z)--(4y) (1z)--(1y) (1z)--(2y) (1z)--(4y) (1z)--(5y) (2z)--(2y) (2z)--(5y) (3z)--(3y) (3z)--(4y) (3z)--(6y) (3z)--(7y) (4z)--(4y) (4z)--(5y) (4z)--(7y) (4z)--(8y) (5z)--(5y) (5z)--(8y) (6z)--(6y) (6z)--(7y) (7z)--(7y) (7z)--(8y) (8z)--(8);
\draw[front] (0z)--(1z)--(2z) (3z)--(4z)--(5z) (6z)--(7z)--(8z) (0z)--(3z)--(6z) (1z)--(4z)--(7z) (2z)--(5z)--(8z);
\end{tikzpicture}\;.
\end{equation}
The edges of $A$ and $B$ together with all the projected edges define a triangulation where each tetrahedron has one $\vca0$, one $\vcb1$, one $\vcc2$, and one $\vcd3$ vertex.
The projections of spacetime faces are rhombi consisting of two triangles.
The projections of the spacetime cubes are (rhombic) cubes consisting of 6 tetrahedra, 3 left-handed and 3 right-handed ones.
If a cube is adjacent to a face, then one of the right-handed tetrahedra contains one of the triangles of the face.

As usual, qubits correspond to continued time-like strings of bonds in the tensor network/circuit diagram.
If we want to obtain a circuit with only 2-qubit measurements and no swap operations, then those strings are determined by how the input and output qubits are paired up in Eq.~\eqref{eq:3d_floquet_volume_measurement} and Eq.~\eqref{eq:3d_floquet_t}.
There is one such string of bonds for every tetrahedron $F$ which is right-handed relative to the vertex ordering $\vca0\vcb1\vcc2\vcd3$,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex}{{0/vca}, {1/vcb,p={1.5,0}}, {2/vcc,p={0.8,0.5}}, {3/vcd,p={0.75,1.2}}}
\draw[dashed] (0)--(2)--(1) (2)--(3);
\draw (0)--(1)--(3)--(0);
\end{tikzpicture}\;.
\end{equation}
Let $F_{i,i+1,i+2}$ be the spacetime face whose projection is spanned by the $(i,i+1)$ and $(i+1,i+2)$ edges of the tetrahedron, where all numbers are understood mod 4.
Let $F_{i,i+1,i+2,i+3}$ be the spacetime cube whose projection is spanned by the $(i,i+1)$, $(i+1,i+2)$, and $(i+2,i+3)$ edges of the tetrahedron.
Then, within a fixed $t$-period, the string of bonds is given by the following sequence of adjacent faces and volumes,
\begin{equation}
\begin{multlined}
F_{\vca0\vcb1\vcc2} - F_{\vca0\vcb1\vcc2\vcd3} - F_{\vcb1\vcc2\vcd3} - F_{\vcb1\vcc2\vcd3\vca0
} - F_{\vcc2\vcd3\vca0}
\\
 - F_{\vcc2\vcd3\vca0\vcb1} - F_{\vcd3\vca0\vcb1} - F_{\vcd3\vca0\vcb1\vcc2}-\;.
\end{multlined}
\end{equation}
To go from the face $F_{i,i+1,i+2}$ to the face $F_{i+1,i+2,i+3}$ inside the projection of the cube $F_{i,i+1,i+2,i+3}$, we have to either rotate left or right when looking in the direction $i\rightarrow i+3$.
Since the tetrahedron is right-handed relative to the orderings $\vca0\vcb1\vcc2\vcd3$ and $\vcc2\vcd3\vca0\vcb1$ but left-handed for $\vcb1\vcc2\vcd3\vca0$ and $\vcd3\vca0\vcb1\vcc2$, we rotate right for $i=0$ and $i=2$, and right for $i=1$ and $i=3$.
This fits our convention about how we divide the cubes at two faces $f$ and $g$, which has entered in Eq.~\eqref{eq:3d_floquet_volume_measurement}.

As we have seen, there is one qubit associated to every right-handed tetrahedron.
Each instrument $I[\mathbf T]$ at a spacetime face acts on the qubits at the two right-handed tetrahedra adjacent to the two triangles that are contained in the projection of the face.
Alternatively, those two right-handed tetrahedra are the ones adjacent to the diagonal $(i,i+2)$ edge of a $(i,i+1,i+2)$ face, which is an edge of the $A$ or $B$ cubic lattice.
Each instrument $I[\mathbf V]$ at a spacetime cube acts on the qubits at the three right-handed tetrahedra contained in the projection of the cube.
Alternatively, those two right-handed tetrahedra are the ones adjacent to the diagonal $(i+3,i)$ edge of a $(i,i+1,i+2,i+3)$ cube.

So in total we obtain the following code.
Consider two shifted cubic lattices $A$ and $B$ together with all length-$\sqrt{\frac34}$ edges connecting $A$ and $B$, defining a triangulation whose vertices are 4-colorable as $\vca0$, $\vcb1$, $\vcc2$, or $\vcd3$.
There is one qubit at every right-handed tetrahedron.
The sequence of measurements consists in 8 rounds,
\begin{equation}
\label{floquet30_measurements}
\begin{multlined}
ZZ_{\vca0\vcc2}\rightarrow (XX,XX)_{\vcd3\vca0}\rightarrow ZZ_{\vcb1\vcd3}\rightarrow (XX,XX)_{\vca0\vcb1}\\
\rightarrow
ZZ_{\vcc2\vca0}\rightarrow (XX,XX)_{\vcb1\vcc2}
\rightarrow ZZ_{\vcd3\vcb1}\\
\rightarrow (XX,XX)_{\vcc2\vcd3}\rightarrow\;.
\end{multlined}
\end{equation}
In each round we measure either $Z_0Z_1$ on the two adjacent right-handed tetrahedra adjacent to all edges of the specified type, or we measure $X_0X_1$ and $X_1X_2$ on the three right-handed tetrahedra adjacent to all edges of that type.
Note that the rounds 0 and 4 (numbered starting from 0), as well as 2 and 6 in Eq.~\eqref{floquet30_measurements} are identical.

This Floquet code can be generalized to arbitrary triangulations with 4-colored vertices.
In every round, we measure $Z_0Z_1$, $Z_1Z_2$, $\ldots$ $Z_{i-1}Z_i$ on the set of right-handed tetrahedra adjacent to the specified type of edges in the lattice, or the same for $X$ instead of $Z$.
The Poincar\'e dual to such a lattice has 4-colorable volumes and is used in the definition of the 3-dimensional color code \cite{Bombin2006}.
However, our code involves only half of the qubits.
The dual lattice of the triangulation depicted in Eq.~\eqref{eq:4_colorable_triangulation} is known as \emph{bitruncated cubic honeycomb} \cite{Wiki_bitrunc}.
The volumes are bitruncated cubes,
\begin{equation}
\begin{tikzpicture}
\atoms{void}{x/p={3,0}, y/p={1,1}, z/p={0,3}}
\atoms{void}{0/p={$0.25*(x)+0.5*(y)$}, 1/p={$0.75*(x)+0.5*(y)$}, 2/p={$(x)+0.25*(z)+0.5*(y)$}, 3/p={$(x)+0.75*(z)+0.5*(y)$}, 4/p={$0.75*(x)+0.5*(y)+(z)$}, 5/p={$0.25*(x)+0.5*(y)+(z)$}, 6/p={$0.75*(z)+0.5*(y)$}, 7/p={$0.25*(z)+0.5*(y)$}, 8/p={$0.5*(x)+0.25*(z)$}, 9/p={$0.75*(x)+0.5*(z)$}, 10/p={$0.5*(x)+0.75*(z)$}, 11/p={$0.25*(x)+0.5*(z)$}, 12/p={$0.5*(x)+0.25*(z)+(y)$}, 13/p={$0.75*(x)+0.5*(z)+(y)$}, 14/p={$0.5*(x)+0.75*(z)+(y)$}, 15/p={$0.25*(x)+0.5*(z)+(y)$}, 16/p={$0.5*(x)+0.25*(y)$}, 17/p={$(x)+0.5*(z)+0.25*(y)$}, 18/p={$(z)+0.5*(x)+0.25*(y)$}, 19/p={$0.5*(z)+0.25*(y)$}, 20/p={$0.5*(x)+0.75*(y)$}, 21/p={$(x)+0.5*(z)+0.75*(y)$}, 22/p={$(z)+0.5*(x)+0.75*(y)$}, 23/p={$0.5*(z)+0.75*(y)$}}
\fill[darkgreen,opacity=0.3] (12)--(13)--(14)--(15)--cycle (7)--(23)--(6)--(19)--cycle (0)--(16)--(1)--(20)--cycle;
\fill[red,opacity=0.3] (0)--(20)--(12)--(15)--(23)--(7)--cycle (13)--(21)--(3)--(4)--(22)--(14)--cycle;
\fill[blue,opacity=0.3] (23)--(15)--(14)--(22)--(5)--(6)--cycle (1)--(2)--(21)--(13)--(12)--(20)--cycle;
\fill[darkgreen,opacity=0.3] (2)--(21)--(3)--(17)--cycle (8)--(9)--(10)--(11)--cycle (5)--(18)--(4)--(22);
\fill[red,opacity=0.3] (1)--(2)--(17)--(9)--(8)--(16)--cycle (19)--(11)--(10)--(18)--(5)--(6)--cycle;
\fill[blue,opacity=0.3] (0)--(16)--(8)--(11)--(19)--(7)--cycle (9)--(17)--(3)--(4)--(18)--(10)--cycle;
\atoms{vertex}{0/p=0, 1/p=1, 17/p=17, 21/p=21, 8/p=8, 10/p=10, 12/p=12, 14/p=14, 5/p=5, 4/p=4, 19/p=19, 23/p=23}
\atoms{circ,tiny}{16/p=16, 20/p=20, 2/p=2, 3/p=3, 18/p=18, 22/p=22, 6/p=6, 7/p=7, 11/p=11, 9/p=9, 15/p=15, 13/p=13}
\draw[red] (0)--(16) (1)edge[dashed](20) (2)--(21) (3)--(17) (4)--(18) (5)--(22) (6)edge[dashed](23) (7)--(19) (9)--(10) (11)--(8) (12)edge[dashed](13) (14)edge[dashed](15);
\draw[blue] (16)--(1) (0)edge[dashed](20) (2)--(17) (3)--(21) (4)--(22) (5)--(18) (6)--(19) (7)edge[dashed](23) (8)--(9) (10)--(11) (13)edge[dashed](14) (15)edge[dashed](12);
\draw[darkgreen] (8)--(16) (9)--(17) (10)--(18) (11)--(19) (12)edge[dashed](20) (13)edge[dashed](21) (14)edge[dashed](22) (15)edge[dashed](23) (1)--(2) (3)--(4) (5)--(6) (7)--(0);
\end{tikzpicture}\;.
\end{equation}
The drawn volume is dual to a $\vcd3$ vertex.
The blue shaded 6-gon faces are dual to $\vcc2\vcd3$ edges, and the red shaded 6-gon faces to $\vcd3\vca0$ edges.
The green shaded 4-gon faces are dual to $\vcb1\vcd3$ edges.
The red, green, and blue edges are dual to $\vcb1\vcc2\vcd3$-triangles, $\vcc2\vcd3\vca0$-triangles, and $\vcd3\vca0\vcb1$-triangles, respectively.
The overall lattice also contains faces dual to $\vca0\vcb1$ edges, $\vcb1\vcc2$ edges and $\vca0\vcc2$ edges, as well as edges dual to $\vca0\vcb1\vcc2$ triangles, but none of those are contained in the boundary of the $\vcd3$ volume shown above.
There are qubits on all the full vertices, and none at the empty vertices.
The measurements in the dual lattice take place on the faces and involve the qubits at the vertices.
For example, the $ZZ_{\vcb1\vcd3}$ measurements take place simulteneously on all green 4-gon faces shown above.

Let us briefly look at the decoding procedure from Proposition~\ref{prop:path_integral_decoding} for the present code.
The spacetime syndrome measured by the noiseless circuit over some time $T\sim L$ consists of an $e$ 2-cycle and an $m$ 3-cocycle inside the 4-dimensional modified hypercubic lattice.
If there is noise, the spacetime syndrome can have boundaries, which are 0-dimensional (a 4-cocycle) for the $m$ part and 1-dimensional (a 1-cycle) for the $e$ part.
In this case we use our classical decoder $D$ to find a low-weight repair of the syndrome.
Then we close the repaired syndrome inside a space layer at time $T$.
To this end, we choose the repair of the $m$ syndrome such that its spatial boundary at time $T$ consists of a subset of $\vcd3\vca0\vcb1\vcc2\vcd3$ (modified) hypercubes.
This spatial boundary can be closed off with $m$ defects at a subset of $\vca0\vcb1\vcc2\vcd3$ cubes.
For each of those $\vca0\vcb1\vcc2\vcd3$ cubes, the correction is performed after the corresponding $I[\mathbf V]_{\vca0\vcb1\vcc2\vcd3}$ instrument by applying a single-qubit $X$ operator to one of the three involved qubits.
The $e$ syndrome is repaired such that its spatial boundary is a subset of the $\vca0\vcb1$ edges.
Then this spatial boundary is closed off with $e$ defects at all $\vca0\vcb1\vcc2$ faces.
For each of those $\vca0\vcb1\vcc2$ faces, the correction is performed after the corresponding $I[\mathbf V]_{\vca0\vcb1\vcc2}$ instrument by applying a single-qubit $Z$ operator to one of the two involved qubits.
Note that due to its 1-dimensional boundaries, the $e$ syndrome could also be corrected continuously using a local cellular automaton similar to \emph{Toom's rule} \cite{Kubica2018}.

\subsection{Floquet double-semion string-net code}
\label{sec:double_semion_code}
In this section we will give an example for a non-Pauli path integral code, which is based on the double-semion Turav-Viro/Dijkgraaf-Witten model \cite{Dijkgraaf1990,Turaev1992}, the state-sum version of the double-semion string-net model \cite{Levin2004,Hu2012}.
Note that there are in fact non-Pauli as well as Pauli stabilizer codes for this phase (and any Abelian non-chiral anyon model) \cite{Dauphinais2018,Magdalena2020,Ellison2021}.
Here, we present a non-Pauli and non-stabilizer code which is ``Floquet'' in the sense that the ordering of measurements is essential and the spacetime syndrome has anyon worldlines not moving in $t$ direction.
Apart from this, our code has some similarities to recent protocols for syndrome extraction for the non-Abelian double-Fibonacci string-net model presented in Ref.~\cite{Schotte2020}.
The goal here is not to produce a particularly practical code, but rather to demonstrate the applicability of our framework beyond the toric-code phase.

We consider a path integral defined on any $2+1$-dimensional triangulation with a branching structure, that is, a direction for all the edges which is acyclic around every triangle.
As for the toric code, the path integral is a sum over $\zz_2$-valued 1-cocycles $A$, but now there is a non-trivial action $(-1)^{A\cup A\cup A}$.
That is, the state sum has an additional weight,
\begin{equation}
\omega(a,b,c)=\omega_{a,b,c}=(-1)^{abc}\;,
\end{equation}
at every tetrahedron,
\begin{equation}
\label{eq:statesum_tetrahedron}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={-150:1}, 2/p={-30:1}, 3/p={90:1}}
\draw (0)edge[mark={arr,-}](1) (0)edge[mark={arr,-}, mark={slab=$c$,p=0.4}](2) (0)edge[mark={arr,-}](3) (1)edge[mark=arr](2) (2)edge[mark={arr,-}, mark={slab=$b$,r}](3) (1)edge[mark=arr, mark={slab=$a$}](3);
\end{tikzpicture}\;.
\end{equation}
The state sum can be written as a tensor network with one $\delta$-tensor at every edge, one 3-index $\zz_2$ tensor at every face, and one 3-index $\omega$ tensor at every tetrahedron.
This path integral is invariant under Pachner moves including the one depicted in Eq.~\eqref{eq:pachner_move_equation}.
The equations corresponding to this invariance are equivalent to the fact that $\omega$ is a $\zz_2$ group 3-cocycle.
The string-net picture of this model is obtained by considering space-only Poncar\'e dual lattices.

We can equip this path integral with anyon worldlines.
Geometrically, those worldlines are represented by sequences of cylinder-like 3-cells or \emph{tube segments} embedded into the triangulation.
The boundary of such a tube segment consists of two \emph{anyon 1-gons} (in red at the bottom and top) and one rectangle (wrapping around the side) which can be divided into two triangles,
\begin{equation}
\label{eq:anyon_segment}
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={0,1.4}}
\draw[mark={slab=$g$,r,p=0.75},mark={arr,p=0.4},looseness=3,anyon1gon] (0)to[out=0,in=0]++(0,0.5)to[out=180,in=180](0);
\draw[mark={arr,p=0.4},looseness=3,anyon1gon] (1)to[out=0,in=0]++(0,0.5)to[out=180,in=180](1);
\draw[mark={slab=$h$,r,p=0.7},mark={arr,p=0.7}] (0)--(1);
\draw[dashed, mark={arr,p=0.7},looseness=2.5] (0)to[out=30,in=-30]++(0,0.7)to[out=150,in=-150](1);
\end{tikzpicture}\;.
\end{equation}
There are further tube segments attached to the two anyon 1-gons, and ordinary tetrahedra attached to the two triangles.
There are no additional state-sum variables other than the group elements at each edge, but there is an additional state-sum weight
\begin{equation}
\rho_{g,h}
\end{equation}
at each tube segment with $\zz_2$ variables as in Eq.~\eqref{eq:anyon_segment}.
There are four types of anyons, $1$, $s$, $\bar s$, and $s\bar s$, and the associated weights are
\begin{equation}
\begin{gathered}
\rho^1_{g,h}=\delta_{g,0}\;,\\
\rho^s_{g,h}=\delta_{g,1} i^{h}\;,\\
\rho^{\bar s}_{g,h}=\delta_{g,1}(-i)^h\;,\\
\rho^{s\bar s}_{g,h}=\delta_{g,0} (-1)^h\;.
\end{gathered}
\end{equation}
The different $\rho^x$ are irreducible representations of the \emph{tube algebra} defined by $\omega$ \cite{Bullivant2019,Lan2013}.
For a review of defects in the path integral language used here, see Appendix~D of Ref.~\cite{Magdalena2023}.
The string-net analogue of this way of introducing anyons as explicit defects is given in Ref.~\cite{Hu2015}.

We now consider this path integral on a triangulation consisting of two cubic lattices $A$ and $B$ with unit vectors $x$, $y$, and $z$, shifted by relative to each other by $\frac12 x+\frac12 y+\frac12 z$.
Each tetrahedron is formed by one $A$ edge, one nearby $B$ edge, as well as four length-$\sqrt{\frac34}$-edges connecting $A$ vertices with nearby $B$ vertices.
So this is the same as the lattice depicted in Eq.~\eqref{eq:4_colorable_triangulation}, just that we color all $A$ vertices red and all $B$ vertices green.
The branching structure can be chosen such that for every directed edge with associated vector $ax+by+cz$, we have $a+b+c>0$.

We turn the path integral into a circuit of operators choosing $t=z$ as the time direction.
There are two kinds of operators in the circuit which correspond to different volumes as follows.
For every $t$ edge, there is an operator $T_1$ consisting of the four adjacent tetrahedra, acting on 8 qubits (here with coloring for a $t$ edge of $B$),
\begin{equation}
\begin{gathered}
\begin{tikzpicture}
\draw (-0.6,0.3)edge[mark={arr,e},ind=$x$]++(0:0.3) (-0.6,0.3)edge[mark={arr,e},ind=$y$]++(40:0.3) (-0.6,0.3)edge[mark={arr,e},ind=$t$]++(90:0.3);
\end{tikzpicture}\qquad
T_1\coloneqq
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0.5,1}, 3/p={2.1,1}}
\atoms{vertex,vcb}{m0/p={1,0.3}, m1/p={1,1.3}}
\draw[dashed] (2)edge[mark=arr](3) (m0)edge[mark=arr](1) (m0)edge[mark=arr](2) (m0)edge[mark=arr](3) (m0)edge[mark={arr,-}](0);
\draw[dotted] (m0)edge[mark=arr](m1);
\draw (0)edge[mark=arr](1) (1)edge[mark=arr](3) (0)edge[mark=arr](2) (m1)edge[mark={arr,-}](1) (m1)edge[mark={arr,-}](2) (m1)edge[mark=arr](3) (m1)edge[mark={arr,-}](0);
\end{tikzpicture}
\;,
\\
\begin{multlined}
T_1 \Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{vertex,vcb}{m/p={0.8,0.8}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](3) (3)edge[mark={slab=$\scriptstyle c$}](1) (1)edge[mark={slab=$\scriptstyle d$}](0) (m)edge[mark={slab=$\scriptstyle e$}](0) (m)edge[mark={slab=$\scriptstyle f$}](2) (m)edge[mark={slab=$\scriptstyle g$}](3) (m)edge[mark={slab=$\scriptstyle h$}](1);
\end{tikzpicture}
}
\\
=
\sum_y
\omega_{e,f,f+y}\omega_{f,f+y,g+y}\omega_{h,h+y,g+y}\omega_{e,h,h+y}\\
\pcoc \Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{vertex,vcb}{m/p={0.8,0.8}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](3) (3)edge[mark={slab=$\scriptstyle c$}](1) (1)edge[mark={slab=$\scriptstyle d$}](0) (m)edge[mark={slab=$\scriptstyle e+y$,p=0.4,sideoff=-0.1}](0) (m)edge[mark={slab=$\scriptstyle f+y$,p=0.4,sideoff=-0.1}](2) (m)edge[mark={slab=$\scriptstyle g+y$,p=0.4,sideoff=-0.1}](3) (m)edge[mark={slab=$\scriptstyle h+y$,p=0.4,sideoff=-0.1}](1);
\end{tikzpicture}
}
\;.
\end{multlined}
\end{gathered}
\end{equation}
$\pcoc$ acting on a triangle with edge labels $a$, $b$, and $c$ is the projector onto the \emph{cocycle subspace}, spanned by the configurations which fulfil $a+b=c$.
Here and in the following, we also use $\pcoc$ for the product of $\pcoc$ on all the triangles which are currently acted on.
As shown, $T_1$ contains the $\omega$-tensors of the involved tetrahedra, and the $\zz_2$-tensors at the internal and bottom faces.
The $\delta$-tensors at the edges of the lattice are split between the adjacent volumes.

For every $x$ or $y$ edge of $A$ or $B$ there is an operator $V_1$ consisting of the tetrahedron spanned by this edge and the $y$ or $x$ edge of $B$ or $A$ whose center is shifted by $\frac12 t$,
\begin{equation}
\label{eq:v1_definition}
\begin{gathered}
V_1\coloneqq
\begin{tikzpicture}
\atoms{vertex,vca}{1/p={1.2,0}, 3/p={1.5,0.8}}
\atoms{vertex,vcb}{m1/p={0.8,1}, m2/p={2,1}}
\draw[dashed] (1)edge[mark=arr](3) (m1)edge[mark=arr](3) (3)edge[mark=arr](m2);
\draw (1)edge[mark=arr](m1) (m1)edge[mark=arr](m2) (1)edge[mark=arr](m2);
\end{tikzpicture}\;,\\
V_1\Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{2/p={0.5,0.5}, 3/p={0.5,-0.5}}
\atoms{vertex,vcb}{0/, 1/p={1,0}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](1) (1)edge[mark={slab=$\scriptstyle c$}](3) (3)edge[mark={slab=$\scriptstyle d$}](0) (2)edge[mark={slab=$\scriptstyle e$}](3);
\end{tikzpicture}
}
=
\omega_{d,a,b} \pcoc
\Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{2/p={0.7,0.7}, 3/p={0.7,-0.7}}
\atoms{vertex,vcb}{0/, 1/p={1.4,0}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](1) (1)edge[mark={slab=$\scriptstyle c$}](3) (3)edge[mark={slab=$\scriptstyle d$}](0) (0)edge[mark={slab=$\scriptstyle e+d+b$}](1);
\end{tikzpicture}
}\;.
\end{gathered}
\end{equation}
Neither $T_1$ nor $V_1$ are unitary since we have
\begin{equation}
\label{eq:t_cocycle_restriction}
T_1 = \pcoc T_1=T_1\pcoc = \pcoc T_1\pcoc\;,
\end{equation}
and the same for $V_1$ instead of $T_1$.
So the support of $T_1$ and $V_1$ is contained in the cocycle subspace of the involved triangles.
Restricted to this cocycle subspace, $V_1$ is indeed unitary,
\begin{equation}
\label{eq:omega_unitarity}
V_1^\dagger V_1=
\pcoc
=
\begin{tikzpicture}
\atoms{vertex,vcb}{1/, 3/p={2,0}}
\atoms{vertex,vca}{m1/p={1.2,0.6}, m2/p={0.8,-0.6}}
\draw[dashed] (m2)edge[bend right,mark=arr](m1);
\draw (m2)edge[bend left,mark=arr](m1) (1)edge[mark=arr](m1) (1)edge[mark=arr](m2) (m1)edge[mark=arr](3) (m2)edge[mark=arr](3);
\end{tikzpicture}
\;.
\end{equation}
On the right, we have depicted the corresponding volume which arises from gluing the tetrahedron with a reflected copy.
\footnote{This is just the unitarity condition for the unitary fusion category defined by $\omega$.}
This is not the case for $T_1$, whose support is contained in but not equal to the cocycle subspace.
We will now show how to extend $T_1$ to an isometry which is fully supported on the cocycle subspace, and later extend both $T_1$ and $V_1$ to the full Hilbert space using a different method.
To this end, we slightly modify the spacetime lattice to incorporate anyon worldlines running along the $x+y+t$ direction.
We consider all the edges aligned with the $x+y-t$ direction.
We split every such edge into two edges separated by a 2-gon perpendicular to the $x+y+t$ direction.
Then we insert an anyon 1-gon into each such 2-gon, at the vertex with the smaller $t$ component, for example,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex,vca}{0/}
\atoms{vertex,vcb}{1/p=10:1.3}
\draw (0)edge[mark=arr](1);
\end{tikzpicture}
\rightarrow
\begin{tikzpicture}
\atoms{void}{0/,1/p=10:1.3}
\draw (0)edge[bend left=35,mark=arr](1) (0)edge[bend right=35,mark=arr](1);
\draw[anyon1gon,mark=arr] (1-c)to[out=160,in=100]++(-170:0.6)to[out=-80,in=-140]cycle;
\atoms{vertex,vca}{0x/p={0}}
\atoms{vertex,vcb}{1x/p={1}}
\end{tikzpicture}
\;.
\end{equation}
The $T_1$ volume then gets two anyon 1-gons at its boundary, which we connect using an anyon tube along the $x+y+t$ edge,
\begin{equation}
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={2,0}, 2/p={0.5,1.2}, 3/p={2.5,1.2}}
\atoms{vertex,vcb}{m0/p={1.2,0.4}, m1/p={1.2,1.5}}
\draw[dashed] (2)edge[mark=arr](3) (m0)edge[mark=arr](1) (m0)edge[mark=arr](2) (m0)edge[mark=arr](3) (m0)edge[bend left=20,mark={arr,-}](0) (m0)edge[bend right=40,mark={arr,-}](0);
\draw[dashed,anyon1gon,mark={arr,-}] (m0-c)to[out=-150,in=-80]++(-170:0.6)to[out=100,in=160]cycle;
\draw (0)edge[mark=arr](1) (1)edge[mark=arr](3) (0)edge[mark=arr](2) (m1)edge[mark={arr,-}](1) (m1)edge[mark={arr,-}](2) (m1)edge[mark={arr,-}](0) (m1)edge[out=0,in=140,mark=arr](3) (m1)edge[out=-40,in=-150,mark=arr](3);
\draw[anyon1gon,mark={arr,-}] (3-c)to[out=-155,in=-85]++(175:0.6)to[out=95,in=145]cycle;
\end{tikzpicture}\;.
\end{equation}
With this, we can replace $T_1$ by a collection of partial isometries $\mathbf T=(T_x)_{x\in \{1,s,\bar s,s\bar s\}}$,
\begin{equation}
\label{eq:anyon_isometry}
\begin{gathered}
T_x\coloneqq
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={2,0}, 2/p={0.5,1.2}, 3/p={2.5,1.2}}
\atoms{vertex,vcb}{m0/p={1.2,0.4}, m1/p={1.2,1.5}}
\draw[dashed] (2)--(3) (m0)--(1) (m0)--(2) (m0)--(3) (m0)to[bend left=20](0) (m0)to[bend right=40](0);
\draw[dashed,anyon1gon] (m0-c)to[out=-150,in=-80]++(-170:0.6)to[out=100,in=160]cycle;
\draw (0)--(1)--(3) (2)--(0) (m1)--(1) (m1)--(2) (m1)--(0) (m1)to[out=0,in=140](3) (m1)to[out=-40,in=-150](3);
\draw[anyon1gon] (3-c)to[out=-155,in=-85]++(175:0.6)to[out=95,in=145]cycle;
\node at (1.4,0.7){\textcolor{red}{$\rho^x$}};
\end{tikzpicture}\;,\\
\begin{multlined}
T_x \Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{vertex,vcb}{m/p={0.8,0.8}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](3) (3)edge[mark={slab=$\scriptstyle c$}](1) (1)edge[mark={slab=$\scriptstyle d$}](0) (m)edge[mark={slab=$\scriptstyle f$}](2) (m)edge[mark={slab=$\scriptstyle g$}](3) (m)edge[mark={slab=$\scriptstyle h$}](1) (m)edge[bend left,mark={slab=$\scriptstyle i$}](0) (m)edge[bend right,mark={slab=$\scriptstyle e$,r}](0);
\draw[anyon1gon,mark={slab=$\scriptstyle j$,r}] (m-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\end{tikzpicture}
}\\
=
\sum_y
\rho^x_{j,g}
\omega_{i,h,h+y} \omega_{h,h+y,g+y}\\
\omega_{e,f,f+j+y}\omega_{f,f+j+y,g+j+y}
\omega_{i+y,g+j+y,j}\omega_{e,g,j} \omega_{e,j,g}
\\
\pcoc
\Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{vertex,vcb}{m/p={0.8,0.8}}
\draw (0)edge[mark={slab=$\scriptstyle a$}](2) (2)edge[mark={slab=$\scriptstyle b$}](3) (3)edge[mark={slab=$\scriptstyle c$}](1) (1)edge[mark={slab=$\scriptstyle d$}](0) (m)edge[mark={slab=$\scriptstyle \substack{f+j\\+y}$,p=0.3,sideoff=-0.1}](2) (m)edge[mark={slab=$\scriptstyle i+y$,sideoff=-0.1,p=0.6}](0) (m)edge[mark={slab=$\scriptstyle h+y$,r,sideoff=-0.1,p=0.4}](1) (m)edge[bend left,mark={slab=$\scriptstyle \substack{g+j\\+y}$,sideoff=-0.1,p=0.3}](3) (m)edge[bend right,mark={slab=$\scriptstyle g+y$,r,sideoff=-0.1,p=0.3}](3);
\draw[anyon1gon,mark={slab=$\scriptstyle j$,r}] (3-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\end{tikzpicture}
}\;.
\end{multlined}
\end{gathered}
\end{equation}
Here we have used a cellulation of the volume with one anyon tube and 7 tetrahedra.
$\mathbf T$ is indeed an isometry when restricted to the cocycle subspace,%, and thus defines a measurement via 
\begin{equation}
\mathbf T^\dagger \mathbf T = \sum_x T_x^\dagger T_x =P_{\text{cocyc}}\;.
\end{equation}
In order to see this, we compute $T_x^\dagger T_x$ by gluing Eq.~\eqref{eq:anyon_isometry} with a time-reflected copy and using the topological invariance, yielding a projector,
\begin{equation}
\label{eq:anyon_projector}
T_x^\dagger T_x=
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={2,0}, 2/p={0.5,1.2}, 3/p={2.5,1.2}}
\atoms{vertex,vcb}{m0/p={1.2,0.4}, m1/p={1.2,1.5}}
\draw[dashed] (m0)--(1) (m0)--(2) (m0)--(3) (m0)to[bend left=20](0) (m0)to[bend right=40](0);
\draw[dashed,anyon1gon] (m0-c)to[out=-150,in=-80]++(-170:0.6)to[out=100,in=160]cycle;
\draw[dotted] (m0)--(m1);
\draw (0)--(1)--(3)--(2)--(0) (m1)--(1) (m1)--(2) (m1)--(3) (m1)to[bend left=40](0) (m1)to[bend right=20](0);
\draw[anyon1gon] (m1-c)to[out=-90,in=-30]++(-120:0.6)to[out=150,in=-140]cycle;
\end{tikzpicture}\;,
\end{equation}
where the bottom and top 1-gon are connected via a tube segment along the $t$ edge.
\footnote{This is a projector since gluing two copies of this volume stacked on top of each other yields the same volume, which corresponds to the equation $P^2=P$.}
Then we compute the sum over all tube segments,
\begin{equation}
\rho^1_{g,h}+\rho^s_{g,h}+\rho^{\bar s}_{g,h}+\rho^{s\bar s}_{g,h} = \delta_{h,0}\;.
\end{equation}
Setting $h$ to $0$ geometrically corresponds to removing the anyon tube and the $t$ edge in Eq.~\eqref{eq:anyon_projector}, and identifying the loop edges at the top and bottom.
So we obtain the following volume of solid-torus topology:
\begin{equation}
\mathbf T^\dagger \mathbf T
=
\sum_x T_x^\dagger T_x=
\begin{tikzpicture}
\atoms{vertex}{0/, 1/p={2,0}, 2/p={0.5,1.2}, 3/p={2.5,1.2}, m/p={1.2,0.6}}
\draw[dashed] (m)to[bend right=10](1) (m)to[bend left=10](2) (m)to[bend right=10](3) (m)to[out=-110,in=20](0) (m)to[out=180,in=80](0);
\draw (m-c)to[out=-170,in=135]++(-150:0.6)to[out=-45,in=-110]cycle;
\draw (0)--(1)--(3)--(2)--(0) (m)to[bend left=10](1) (m)to[bend right=10](2) (m)to[bend left=10](3) (m)to[out=-90,in=10](0) (m)to[out=-170,in=70](0);
\end{tikzpicture}
=
\pcoc\;.
\end{equation}
For the last equation we have used that this spacetime volume can be obtained from gluing one volume as in Eq.~\eqref{eq:omega_unitarity} for every pair of neighboring triangles.
With this, using $\mathbf T$ in Eq.~\eqref{eq:fixed_point_instrument} defines an instrument $I[\mathbf T]$ restricted to the cocycle subspace.

We will now discuss how to extend $I[\mathbf T]$ and $I[\mathbf V]$ to full instruments also outside the cocycle subspace.
The first step is to choose arbitrary extensions $\widetilde{\mathbf T}$ and $\widetilde{\mathbf V}$ to the full Hilbert space.
\footnote{In general, this might also involve enlarging the output dimension by adding new measurement outcomes. This is not necessary in the present case though.}
However, the circuit consisting of the extended instruments $I[\widetilde{\mathbf T}]$ and $I[\widetilde{\mathbf V}]$ clearly violates Definition~\ref{def:path_integral_code}.
This can be fixed by introducing a new channel $C$ to the circuit, with the following task:
$C$ measures whether the cocycle constraint is violated at any of the triangles, and maps back to the cocycle subspace if yes.
Roughly speaking, this works because (1) $\widetilde{\mathbf T}$ and $\widetilde{\mathbf V}$ still preserve the cocycle subspace,
\begin{equation}
\label{eq:cchannel_commutativity}
\begin{gathered}
\widetilde{T}_x\circ \pcoc = T_x = \pcoc\circ T_x\;,\\
\widetilde{V}_x\circ \pcoc = V_x = \pcoc\circ V_x\;,
\end{gathered}
\end{equation}
and (2) $\pcoc$ consists of the same triangle terms for each isometry.

Concretely, it suffices to apply a channel $C$ before every $I[\widetilde{\mathbf T}]$ instrument.
The space that $\widetilde{\mathbf T}$ acts on is given by
\begin{equation}
\label{eq:triangle_correction}
\begin{tikzpicture}
\atoms{void}{b/}
\atoms{vertex,vca}{a0/p={-1,-1}, a1/p={1,-1}, a2/p={-1,1}, a3/p={1,1}}
\draw (a0)edge[mark={slab=$a$,r}](a1) (a0)edge[mark={slab=$b$}](a2) (a1)edge[mark={slab=$c$,r}](a3) (a2)edge[mark={slab=$d$}](a3) (b)edge[mark={slab=$e$}](a3) (b)edge[mark={slab=$f$,r}](a1) (b)edge[mark={slab=$g$}](a2) (b)edge[bend left=35,mark={slab=$h$,p=0.4}](a0) (b)edge[bend right=35,mark={slab=$i$,r,p=0.4}](a0);
\draw[anyon1gon,mark={slab=$j$,r}] (b-c)to[out=-165,in=135]++(-135:0.8)to[out=-45,in=-105]cycle;
\atoms{vertex,vcb}{bx/p=b}
\end{tikzpicture}\;,
\end{equation}
and $C$ acts on that same space.
$C$ is the product of one 3-qubit channel $C^t$ for each of the 5 different triangles,
\begin{equation}
C^t_{c,e,f}\rightarrow C^t_{d,e,g}\rightarrow C^t_{f,a,h}\rightarrow C^t_{g,b,i}\rightarrow C^t_{h,i,j}\;.
\end{equation}
Each instrument $C^t$ acts on the qubits at the three edges of the triangle, as indicated by the labels which refer to Eq.~\eqref{eq:triangle_correction}.
The 3-qubit instrument $C^t_{a,b,c}$ is defined as follows.
First we measure $x=a+b+c\mod 2$, which is the same as a $Z_0Z_1Z_2$ measurement just that we label the outcome with $x\in \{0,1\}$ instead of $\pm 1$.
Then we apply a classically controlled operation $c\rightarrow c+x$, which is the same as a CNOT after turning the classical bit $x$ into a qubit.
In other words, $C^t_{a,b,c}$ fixes the cocycle condition by flipping the edge $c$, and $C$ pushes potential cocycle constraint violations into the anyon 1-gon.
It is easy to see that $C$ (1) maps everything into the cocycle subspace,
\begin{equation}
\label{eq:pcoc_cchannel1}
C=(\pcoc\otimes\pcoc)\circ C\;,\\
\end{equation}
and (2) acts as the identity inside the cocycle subspace,
\begin{equation}
\label{eq:pcoc_cchannel2}
C\circ(\pcoc\otimes\pcoc) = \pcoc\otimes \pcoc\;.
\end{equation}

With this, the complete QEC circuit consists of 6 rounds of channels/instruments.
First we apply $I[\widetilde{\mathbf T}]$ for every $t$ edge of $A$ whose center is within a fixed $xy$ plane of the $B$ lattice, and apply the according operator $C$ before that.
Then we apply $I[\widetilde{\mathbf V}]$ at all $x$ and all $y$ edges of $B$ inside this $xy$ plane.
We then shift the $xy$ plane by $\frac12 t$ and perform the same instruments with $A$ and $B$ exchanged.
In total we obtain
\begin{equation}
\label{eq:doublesemion_floquet_circuit}
\begin{multlined}
\rightarrow C_{At} \rightarrow  I[\widetilde{\mathbf T}]_{At} \rightarrow (I[\widetilde{\mathbf V}]_{Bx},I[\widetilde{\mathbf V}]_{By})\\
\rightarrow C_{Bt} \rightarrow  I[\widetilde{\mathbf T}]_{Bt} \rightarrow (I[\widetilde{\mathbf V}]_{Ax},I[\widetilde{\mathbf V}]_{Ay})\rightarrow\;.
\end{multlined}
\end{equation}
Let us now show that this circuit defines a valid path-integral QEC circuit according to Definition~\ref{def:path_integral_code}.
To this end, we use the tensor-network equations Eq.~\eqref{eq:pcoc_cchannel1}, Eq.~\eqref{eq:cchannel_commutativity}, and Eq.~\eqref{eq:pcoc_cchannel2} transform the circuit in Eq.~\eqref{eq:doublesemion_floquet_circuit} into the circuit
\begin{equation}
\label{eq:doublesemion_simple_circuit}
\begin{multlined}
\rightarrow I[\mathbf T]_{At} \rightarrow (I[\mathbf V]_{Bx},I[\mathbf V]_{By})\\
\rightarrow I[\mathbf T]_{Bt} \rightarrow (I[\mathbf V]_{Ax},I[\mathbf V]_{Ay})\rightarrow\;.
\end{multlined}
\end{equation}
Specifically, applying Eq.~\eqref{eq:pcoc_cchannel1} to all channels $C_{At}$/$C_{Bt}$ inserts $\pcoc$ on all triangles of the corresponding spatial cut of the lattice (here coloring like before $C_{Bt}$),
\begin{equation}
\begin{tikzpicture}
\clip (0.25,0.25)rectangle (3.25,2.75);
\foreach \x in {0,1,2,3,4}{
\foreach \y in {0,1,2,3}{
\atoms{vertex}{{a\x\y/vca,p={\x,\y}}, {b\x\y/vcb,p={\x+0.5,\y+0.5}}}
\atoms{void}{{a\x\y/p={\x,\y}}, {b\x\y/p={\x+0.5,\y+0.5}}}
}
}
\foreach[count=\xx from 1] \x in {0,1,2,3}{
\foreach[count=\yy from 1] \y in {0,1,2}{
\draw (a\x\y)--(a\xx\y) (a\x\y)--(a\x\yy) (b\x\y)--(a\xx\yy) (b\x\y)--(a\xx\y) (b\x\y)--(a\x\yy) (b\x\y)to[bend left=35](a\x\y) (b\x\y)to[bend right=35](a\x\y);
\draw[anyon1gon] (b\x\y-c)to[out=-165,in=135]++(-135:0.4)to[out=-45,in=-105]cycle;
}
}
\foreach \x in {0,1,2,3,4}{
\foreach \y in {0,1,2,3}{
\atoms{vertex}{{xa\x\y/vca,p={a\x\y}}, {xb\x\y/vcb,p={b\x\y}}}
}
}
\end{tikzpicture}\;.
\end{equation}
Then applying Eq.~\eqref{eq:cchannel_commutativity} moves $\pcoc$ to different spatial cuts.
Finally, applying Eq.~\eqref{eq:pcoc_cchannel2} removes all the channels $C_{Bt}$/$C_{At}$.
The remaining $\pcoc$ can be absorbed into the following $I[\mathbf T]_{Bt}$/$I[\mathbf T]_{At}$ using Eq.~\eqref{eq:t_cocycle_restriction}.
The transformation implies that the circuit in Eq.~\eqref{eq:doublesemion_floquet_circuit} is in the same exact phase as the circuit in Eq.~\eqref{eq:doublesemion_simple_circuit}.
Since for the circuit in Eq.~\eqref{eq:doublesemion_simple_circuit}, every spacetime syndrome corresponds to a fixed-point path integral with anyon worldlines, the circuit in Eq.~\eqref{eq:doublesemion_floquet_circuit} fulfils Definition~\ref{def:path_integral_code} as well.

Depending on how we map the circuit onto a fixed set of qubits, $I[\widetilde{\mathbf T}]$ acts on at least 10 qubits.
So in order to implement it in practice we should decompose it into smaller gates.
Surely, any gate can be written as a circuit using a small fixed universal gate set, but this circuit might be approximate and finding it might be hard for such a large operator.
However, a first decomposition can be obtained by decomposing the volume in Eq.~\eqref{eq:anyon_isometry} into tetrahedra or at least smaller volumes.
Let us give such a decomposition as a sequence of spatial lattices that we get from gluing those smaller volumes step by step,
\begin{equation}
\begin{multlined}
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{void}{m/p={0.8,0.8}}
\draw (0)edge[mark=arr](2) (2)edge[mark=arr](3) (1)edge[mark=arr](3) (0)edge[mark=arr](1) (m)edge[mark=arr](2) (m)edge[mark=arr](3) (m)edge[mark=arr](1) (m)edge[bend left,mark={arr,-}](0) (m)edge[bend right,mark={arr,-}](0);
\draw[anyon1gon,mark=arr] (m-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vcb}{m0/p=m}
\end{tikzpicture}
\rightarrow
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{void}{m/p={0.8,0.8}}
\draw (0)edge[mark=arr](2) (2)edge[mark=arr](3) (1)edge[mark=arr](3) (0)edge[mark=arr](1) (m)edge[mark=arr](3) (0)edge[bend right=40,mark=arr](3) (0)edge[bend left=40,mark=arr](3) (m)edge[bend left,mark={arr,-}](0) (m)edge[bend right,mark={arr,-}](0);
\draw[anyon1gon,mark=arr] (m-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vcb}{m0/p=m}
\end{tikzpicture}
\rightarrow
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\draw (0)edge[mark=arr](2) (2)edge[mark=arr](3) (1)edge[mark=arr](3) (0)edge[mark=arr](1) (0)edge[bend right,mark=arr](3) (0)edge[bend left,mark=arr](3);
\draw[anyon1gon,mark=arr] (3-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vca}{0x/p=0, 1x/p=1, 2x/p=2, 3x/p=3}
\end{tikzpicture}
\\
\rightarrow
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{void}{m/p={0.8,0.8}}
\draw (0)edge[mark=arr](2) (2)edge[mark=arr](3) (1)edge[mark=arr](3) (0)edge[mark=arr](1) (m)edge[mark={arr,-}](0) (0)edge[bend right,mark=arr](3) (0)edge[bend left,mark=arr](3) (m)edge[bend left,mark={arr}](3) (m)edge[bend right,mark={arr}](3);
\draw[anyon1gon,mark=arr] (3-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vcb}{m0/p=m}
\atoms{vertex,vca}{0x/p=0, 1x/p=1, 2x/p=2, 3x/p=3}
\end{tikzpicture}
\rightarrow
\begin{tikzpicture}
\atoms{void}{0/, 1/p={1.6,0}, 2/p={0,1.6}, 3/p={1.6,1.6}}
\atoms{void}{m/p={0.8,0.8}}
\draw (0)edge[mark=arr](2) (2)edge[mark=arr](3) (1)edge[mark=arr](3) (0)edge[mark=arr](1) (m)edge[mark={arr,-}](0) (m)edge[mark={arr,-}](1) (m)edge[mark={arr,-}](2) (m)edge[bend left,mark={arr}](3) (m)edge[bend right,mark={arr}](3);
\draw[anyon1gon,mark=arr] (3-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vcb}{m0/p=m}
\atoms{vertex,vca}{0x/p=0, 1x/p=1, 2x/p=2, 3x/p=3}
\end{tikzpicture}\;.
\end{multlined}
\end{equation}
In the first step we glue two tetrahedra, applying twice a 5-qubit operators $U_1$.
The same happens in the last step with an operator $R_1$.
$U_1$ and $R_1$ are the same as $V_1$ shown in Eq.~\eqref{eq:v1_definition} except that the involved edges have different directions.
In the second step, the volume we glue can be cellulated with an anyon tube together with two tetrahedra, defining an operator $S_x$ acting on 6 qubits,
\begin{equation}
\label{eq:s_definition}
\begin{multlined}
S_x
\Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{0/, 3/p={1.6,1.6}}
\atoms{void}{m/p={0.8,0.8}}
\draw (m)edge[mark=arr,mark={slab=$\scriptstyle a$}](3) (0)edge[bend right=40,mark=arr,mark={slab=$\scriptstyle b$,r}](3) (0)edge[bend left=40,mark=arr,mark={slab=$\scriptstyle c$}](3) (m)edge[bend left,mark={arr,-},mark={slab=$\scriptstyle d$,p=0.3,sideoff=-0.1}](0) (m)edge[bend right,mark={arr,-},mark={slab=$\scriptstyle e$,r,p=0.3}](0);
\draw[anyon1gon,mark=arr,mark={slab=$\scriptstyle f$,r}] (m-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vcb}{m0/p=m}
\end{tikzpicture}
}
=
\delta_{d+a,b}\delta_{e+a,c}
\\
\rho^x_{f,a}\omega_{e,f,a}\omega_{e,a,f}
\pcoc
\Ket{
\begin{tikzpicture}
\atoms{void}{0/, 3/p={1.6,1.6}}
\draw (0)edge[bend right,mark=arr,mark={slab=$\scriptstyle b$,r}](3) (0)edge[bend left,mark=arr,mark={slab=$\scriptstyle c$}](3);
\draw[anyon1gon,mark=arr,mark={slab=$\scriptstyle f$,r}] (3-c)to[out=-160,in=135]++(-135:0.5)to[out=-45,in=-110]cycle;
\atoms{vertex,vca}{0x/p=0, 3x/p=3}
\end{tikzpicture}
}\;.
\end{multlined}
\end{equation}
In the third step, we glue a tetrahedron at a single face, yielding a 6-qubit operator $W_1$,
\begin{equation}
\label{eq:w_definition}
\begin{multlined}
W_1
\Ket{
\begin{tikzpicture}
\atoms{vertex,vca}{1/p={-135:0.8}, 2/p={-10:0.8}, 3/p={100:0.8}}
\draw (1)edge[mark=arr,mark={slab=$\scriptstyle a$,r}](2) (1)edge[mark=arr,mark={slab=$\scriptstyle b$}](3) (2)edge[mark={arr,-},mark={slab=$\scriptstyle c$,r}](3);
\end{tikzpicture}
}
\\
=
\sum_y
\omega_{y,y+b,c}
\pcoc
\Ket{
\begin{tikzpicture}
\atoms{vertex,vcb}{0/}
\atoms{vertex,vca}{1/p={-135:1.2}, 2/p={-20:1.2}, 3/p={110:1.2}}
\draw (1)edge[mark=arr,mark={slab=$\scriptstyle a$,r}](2) (1)edge[mark=arr,mark={slab=$\scriptstyle b$}](3) (2)edge[mark={arr,-},mark={slab=$\scriptstyle c$,r}](3);
\draw (0)edge[mark={arr,-},mark={slab=$\scriptstyle y$,r}](1) (0)edge[mark={arr,p=0.6},mark={slab=$\scriptstyle y+a$,p=0.3,r,sideoff=-0.1}](2) (0)edge[mark=arr,mark={slab=$\scriptstyle y+b$,p=0.2,sideoff=-0.1}](3);
\end{tikzpicture}
}\;.
\end{multlined}
\end{equation}
As discussed before, we now arbitrarily extend $\mathbf U$, $\mathbf R$, $\mathbf S$, and $\mathbf W$ into isometries $\widetilde{\mathbf U}$, $\widetilde{\mathbf R}$, $\widetilde{\mathbf S}$, and $\widetilde{\mathbf W}$ supported on the full Hilbert space.
Then, we replace the instrument $I[\widetilde{\mathbf T}]$ by a sequence of up-to-6-qubit instruments
\begin{equation}
(I[\widetilde{\mathbf U}], I[\widetilde{\mathbf U}]) \rightarrow I[\widetilde{\mathbf S}] \rightarrow I[\widetilde{\mathbf W}]
\rightarrow (I[\widetilde{\mathbf R}], I[\widetilde{\mathbf R}])\;.
\end{equation}
To extend the operators, we essentially just remove the $\pcoc$ terms from the corresponding definitions.
This way, $V_1$ in Eq.~\eqref{eq:v1_definition} becomes a unitary
\begin{equation}
\widetilde V_1\ket{d,a,b,e} = \omega_{d,a,b} \ket{d,a,b,e+d+b}\;,
\end{equation}
acting trivially on the label $c$.
This unitary can be written as a circuit of controlled-$X$ and controlled-controlled-$Z$ gates,
\begin{equation}
\begin{tikzpicture}
\atoms{square,lab={t=$\omega$,p=0:0},yscale=1.5}{om/p={-0.6,0.45}}
\atoms{delta}{d0/p={1.4,1}, d1/p={0.7,1.4}, dx0/p={0,0.3}, dx1/p={0.7,0.45}, dx2/p={1.4,0.6}}
\atoms{z2}{z0/p={2.1,1}, z1/p={2.1,1.4}}
\draw (dx0)edge[ind=$a$](0,0) (dx1)edge[ind=$d$](0.7,0) (dx2)edge[ind=$b$](1.4,0) (z0)edge[ind=$e$](2.1,0) (z1)edge[ind=$\quad e+d+b$](2.1,1.8) (d1)edge[ind=$d$](0.7,1.8) (d0)edge[ind=$b$](1.4,1.8) (dx0)edge[ind=$a$](0,1.8);
\draw (z0)--(d0) (z1)--(d1) (d1)--(dx1) (d0)--(dx2) (z0)--(z1) (dx0)--([sy=-0.15]om-r) (dx1)--(om-r) (dx2)--([sy=0.15]om-r);
\draw[rc,dashed,gray] (-0.9,0.1)rectangle(1.6,0.8);
\node[gray] at (-1.35,0.45){$CCZ$};
\draw[rc,dashed,gray] (1.2,0.8)rectangle(2.3,1.2);
\node[gray] at (2.7,1){$CX$};
\end{tikzpicture}\;.
\end{equation}
$S_x$ in Eq.~\eqref{eq:s_definition} is a map from 6 to 3 qubits.
Since there are 4 anyons and thus 4 measurement results $x$, we need to measure one further qubit to turn $\mathbf S$ into an isometry on the full Hilbert space.
In order to fulfil Definition~\ref{def:path_integral_code}, the measurement outcome for this further qubit must be deterministic inside the cocycle subspace.
This can be done by measuring the cocycle constraint, e.g., on the $(a,c,e)$ triangle in Eq.~\eqref{eq:s_definition}.
Using $\omega_{e,f,a}\omega_{e,a,f}=1$ and $f=d+e$ inside the cocycle subspace, we obtain an isometry
\begin{equation}
\widetilde S_x\ket{c,e,d,a} = \rho^x_{d+e,a}\ket{c,c+e+a}\;,
\end{equation}
acting trivially on $b$ and $f$.
$\widetilde S_x$ be expressed as a circuit,
\begin{equation}
\begin{tikzpicture}
\atoms{delta}{d0/p={0.7,0.4}, d1/p={2.1,0.8}, d2/p={0,1.2}}
\atoms{z2}{z0/p={1.4,0.4}, z1/p={0.7,0.8}, z2/p={0.7,1.2}}
\atoms{square,lab={t=$\rho$,p=0:0}}{{rho/p={1.75,1.2},xscale=3}}
\draw[rc] (d0)--(z0) (d1)--(z1) (d2)--(z2) (d0)--(z1) (z1)--(z2) (z0)--([sx=-0.35]rho-b) (d1)--([sx=0.35]rho-b);
\draw (d2)edge[ind=$c$](0,0) (d0)edge[ind=$e$](0.7,0) (z0)edge[ind=$d$](1.4,0) (d1)edge[ind=$a$](2.1,0) (z2)edge[ind=$\scriptstyle c+e+a$](0.7,1.6) (d2)edge[ind=$c$](0,1.6) ([sx=-0.35]rho-t)edge[ind=$x_0$](1.4,1.6) ([sx=0.35]rho-t)edge[ind=$\hspace{1.5mm}x_1$](2.1,1.6);
\draw[dashed,gray,rc] (1.1,0.95)rectangle(2.4,1.45);
\node[gray] at (3.1,1.2){$CS\circ H_a$};
\end{tikzpicture}\;.
\end{equation}
Here we have split $x\rightarrow (x_0,x_1)$ into two qubits using $1\rightarrow (0,0)$, $s\rightarrow (1,0)$, $\bar s\rightarrow (1,1)$, and $s\bar s\rightarrow (0,1)$.
So the qubits labeled $x_0$, $x_1$, and $c+e+a$ are measured after applying the above isometry.
$\rho$ is a 2-qubit gate which in fact equals a Hadamard on the $a$ qubit followed by a controlled-$S$ gate.
The operator $W_1$ in Eq.~\eqref{eq:w_definition} becomes an isometry
\begin{equation}
\widetilde W_1\ket{a,b,c} = \sum_y \omega_{y,y+b,c} \ket{a,b,c,y,y+b,y+a}\;.
\end{equation}
$\widetilde W_1$ can be written as a circuit,
\begin{equation}
\begin{tikzpicture}
\atoms{square,lab={t=$\omega$,p=0:0},yscale=1.5}{om/p={4.8,1.45}}
\atoms{delta}{d0/p={0.7,0.4}, d1/p={1.4,1.2}, d2/p={3.5,0.4}, d3/p={3.5,0.8}, dx0/p={4.2,1.3}, dx1/p={3.5,1.45}, dx2/p={2.8,1.6}, dplus/p={3.5,0}}
\atoms{z2}{z0/p={2.1,0.4}, z1/p={2.8,1.2}, z2/p={2.8,0.4}, z3/p={2.1,0.8}, zp0/p={2.1,0}, zp1/p={2.8,0}}
\draw (dx0)edge[ind=$c$](4.2,1.9) (dx1)edge[ind=$y$](3.5,1.9) (dx2)edge[ind=$\scriptstyle b+y$](2.8,1.9) (d0)edge[ind=$a$](0.7,0) (d1)edge[ind=$b$](1.4,0) (z3)edge[ind=$\scriptstyle a+y$](2.1,1.9) (d0)edge[ind=$a$](0.7,1.9) (d1)edge[ind=$b$](1.4,1.9) (dx0)edge[ind=$c$](4.2,0);
\draw (dx0)--([sy=-0.15]om-l) (dx1)--(om-l) (dx2)--([sy=0.15]om-l) (d3)--(dx1) (z1)--(dx2) (d0)--(z0) (d1)--(z1) (d2)--(z2) (d3)--(z3) (zp0)--(z0) (z0)--(z3) (zp1)--(z2) (z2)--(z1) (dplus)--(d2) (d2)--(d3);
\draw[rc,dashed,gray] (1.9,-0.2)rectangle(2.3,0.2);
\node[gray] at (2.1,-0.4){$\ket0$};
\draw[rc,dashed,gray] (3.3,-0.2)rectangle(3.7,0.2);
\node[gray] at (3.5,-0.4){$\ket+$};
\end{tikzpicture}\;.
\end{equation}
We have thus decomposed our QEC process as a circuit of common 2 or 3-qubit gates.
For a practical implementation it might again be useful to write this circuit in terms of measurements and unitaries acting on qubits on a fixed spatial lattice.
This is straight-forward, but might involve auxiliary qubits and swap operations.

\section{Discussion and outlook}
\label{sec:outlook}
In this paper we have proposed a perspective on topological quantum error correction based on topological fixed-point path integrals.
Our approach provides a unified view on topological stabilizer, subsystem, and Floquet codes, as demonstrated in Section~\ref{sec:examples}.
In particular, we have seen that the stabilizer toric code, subsystem toric code, and CSS Floquet code can be considered the same code on different spacetime lattices.
The approach can also describe topological QEC codes which are not based on Pauli/Clifford operations as we have demonstrated in Section~\ref{sec:double_semion_code}.
As summarized in Definition~\ref{def:path_integral_code} and Proposition~\ref{prop:path_integral_decoding}, we have given a simple unified criterion for when a circuit of measurements forms a fault-tolerant topological error-correcting code.
Namely that, for every spacetime history of measurement outcomes, we obtain a topological fixed-point path integral including defects.

Our framework provides a way to systematically construct new codes.
To this end, we start with some known fixed-point path integral, and possibly apply some tensor-network equations to obtain another path integral in the same exact phase.
Then we interpret this path integral as a circuit of operators by setting a time direction.
Dressing every operator with segments of topological defects, we obtain a circuit of instruments with the desired properties.
We have demonstrated this at hand of two examples in Section~\ref{sec:new_examples}.
First, we have presented a Floquet version of the $3+1$-dimensional toric code, by considering the tensor-network path integral on a hypercubic lattice and traversing it in the $t=x+y+z+w$ direction.
The model has qubits living on the right-handed tetrahedra of a triangulation with 4-colored vertices.
The code cycles through 8 rounds, in each of which we perform 2-body measurements among the qubits adjacent to edges of a certain type.
Second, we have constructed a Floquet code based on the double-semion string net.
This code is not designed to be particularly practical for implementation, but is decomposed into a sequence of common 2 or 3-qubit gates.

While this paper was being finalized, Ref.~\cite{Bombin2023} appeared on the arXiv which proposes a similar perspective based on the $ZX$ calculus.
In this reference, it was independently recognized that the tensor-network diagrams for the stabilizer toric code and CSS Floquet code are the same, just traversed in a different direction.
In addition to this, our work provides a clear physical interpretation of the tensor networks as topological fixed-point path integrals including topological defects.
We also give a neat geometric interpretation of the phaseless $ZX$ diagrams as cellulations, the $ZX$ rules as topological invariance, and the \emph{Pauli webs} as volumes and vertices.
Our formalism is not limited to the $ZX$ calculus or stabilizer framework, but works for arbitrary tensor-network path integrals, as demonstrated in Section~\ref{sec:double_semion_code}.
\footnote{Even though any tensor can be written as a $ZX$ diagram, it can be beneficial to work with elementary operations which are not elementary $ZX$ tensors.}

The framework can be generalized in various directions.
First, topological state-sum path integrals do not cover all zero-correlation length path integrals, and similarily not all gapped phases.
Exemptions can be obtained from topological path integrals by inserting a rigid network of topological defects.
To this end, we choose some cubic ``superlattice'' with a potentially larger unit cell than the topological path integral.
Then (in 2+1 dimensions) we introduce domain walls at all superlattice faces, which meet at 1-dimensional defects along the edges, which in turn meet at the vertices.
Examples for this in 2+1 dimensions seem to yield topological path integrals again after choosing a larger unit cell, and thus correspond to a ``weak breaking of translation symmetry'', as we have seen in Section~\ref{sec:honeycomb_floquet}.
In 3+1 dimensions however, topological defect networks (without defects in time) can describe fracton phases \cite{Aasen2020}.
A Floquet code based on fracton phases was presented in \cite{Davydova2022}.

A second straight-forward generalization is to consider spacetime lattices which change with time.
By changing the topology of the spatial configuration, we obtain circuits which do not only fault-tolerantly store, but also process logical information.
Both storing and processing of logical information becomes much more versatile if we equip the topological path integral with boundaries, domain walls, or other sorts of interfaces and defects.
For example, we can then perform computation via braiding with anyons or via lattice surgery with boundaries.
So in total, topological defects can play three very different roles in our framework.
First, they are essential to create circuits of instruments from topological path integrals.
Second, they can be added to the overall spacetime topology to obtain more versatile ways of storing and processing logical information.
Third, they can be added to a rigid superlattice in a topological path integral in order to obtain path integrals for more general (fracton) gapped phases.

Another direction is to consider path integrals where the defects that we use for error correction (such as anyons) do not possess abelian fusion rules.
In this case the scheme of Proposition~\ref{prop:path_integral_decoding} outlined in Eq.~\eqref{eq:qec_circuit} cannot work, since there is not necessarily a unique way to perform a correction.
For example, consider a path integral QEC circuit based on the double-Fibonacci phase, and assume we measure the following spacetime syndrome on a torus,
\begin{equation}
\begin{tikzpicture}
\fill[cyan,opacity=0.2] (0.8,1)rectangle++(2,2);
\fill[cyan,opacity=0.2] (0,0)--++(0.8,1)--++(0,2)--++(-0.8,-1)--cycle;
\draw[cyan] (0.8,1)--++(0,2) (2.8,1)--++(0,2);
\fill[red,opacity=0.2] (0,0)--++(2,0)--++(0.8,1)--++(-2,0)--cycle;
\draw[thick] (2.4,1.2)to[out=180,in=-30]($(1.4,1.5)+(-30:0.2)$) (2.4,1.8)to[out=180,in=30]($(1.4,1.5)+(30:0.2)$) (0.4,1.2)to[out=0,in=-150]($(1.4,1.5)+(-150:0.2)$) (0.4,1.8)to[out=0,in=150]($(1.4,1.5)+(150:0.2)$);
\draw[red,dashed] (1.4,1.5)circle(0.2);
\fill[red,opacity=0.2] (0,2)--++(2,0)--++(0.8,1)--++(-2,0)--cycle;
\fill[cyan,opacity=0.2] (2,0)--++(0.8,1)--++(0,2)--++(-0.8,-1)--cycle;
\fill[cyan,opacity=0.2] (0,0)rectangle++(2,2);
\draw[cyan] (0,0)--++(0,2) (2,0)--++(0,2);
\end{tikzpicture}\;,
\end{equation}
with the left and right, as well as front and back identified.
There are two ways of fixing the syndrome inside the red dashed circle, namely
\begin{equation}
\begin{tikzpicture}
\draw[red,dashed] (0,0)circle(0.5);
\draw[thick] (-150:0.5)to[bend left=20](-30:0.5) (150:0.5)to[bend right=20](30:0.5);
\end{tikzpicture}
\;,\qquad
\begin{tikzpicture}
\draw[red,dashed] (0,0)circle(0.5);
\atoms{vertex}{0/p=180:0.2, 1/p=0:0.2}
\draw[thick] (0)--(1) (-150:0.5)--(0) (1)--(-30:0.5) (150:0.5)--(0) (1)--(30:0.5);
\end{tikzpicture}\;,
\end{equation}
which correspond to different logical operations acting on the ground space on a torus.
There is no way to find out which superposition of those logical operations will correctly undo the error which occured.
A decoding strategy that has been tested successfully is based on a hirachical decomposition of the lattice into \emph{colonies} \cite{Dauphinais2016,Schotte2022}.
A different strategy that might work is to ``continuously'' apply small corrections in every timestep instead of one large correction after a large time $T\sim L$.
That is, in every time step, we choose a new low-weight repair of the spacetime syndrome in all of its past.
Then we consider the set of string operators which could be used to close the repaired spacetime syndrome in a cohomologically trivial way inside the current spatial cut.
We pick a low (e.g., minimum) weight representative from this set.
Then, we apply only a single segment of this closing string operator near each of its endpoints.
Independent of the choice of classical decoder, it will be interesting to see whether and how our framework can be used to construct syndrome extraction circuits for arbitrary non-abelian phases.

Another very interesting question concerns chiral phases, that is, topological phases in $2+1$ dimensions whose anyon theory is described by a unitary modular tensor category which is not a Drinfeld center.
It is a common believe that chiral phases do not allow for exactly solvable fixed-point zero-correlation length descriptions, and no such descriptions are known to date.
Concretely, it has been shown that chiral phases do not admit commuting-projector Hamiltonian models \cite{Kapustin2019}.
However, there are indications that going from Hamiltonians to discrete path integrals might resolve this problem \cite{universal_liquid}.
In contrast to condensed matter physics, discrete path integrals (i.e., circuits) are the much more common in topological QEC.
Thus, it is natural to look there for candidates of chiral topological fixed-point path integrals.
Indeed, subsystem codes based on chiral topological phases exist.
Already more than a decade ago, Ref.~\cite{Bombin2009} presented a subsystem code which appears to be in a 3-fermion phase.
Recently, subsystem codes based on arbitrary (including chiral) abelian anyon theories have been constructed in Ref.~\cite{Ellison2022} using a mechanism of ``gauging out'' anyons.
A clear definition for the topological phase of a code can be obtained by applying our formalism in reverse direction.
To this end, we consider a history of measurement outcomes (usually $+1$ for Pauli codes) that does not require any correction, and take the path integral for this spacetime syndrome.
Applying this to chiral subsystem codes yields a discrete path integral for which we have good reasons to believe that it is in a chiral phase.
It will be very interesting to see whether those path integrals do genuinely represent chiral phases, and whether one can show their discrete topological invariance.

\subsubsection*{Acknowledgments}
I would like to thank Julio Magdalena de la Fuente, Alex Townsend-Teague, Alexander Nietner, Ansgar Burchards, Jens Eisert, Margarita Davydova, Shankar Balasubramanian, and David Aasen for helpful conversations and comments on the manuscript, and especially Markus Kesselring for fruitful discussions on 3-dimensional tessellations.
This work was supported by the DFG (CRC 183 project B01), the BMBF (RealistiQ, QSolid), the Munich Quantum Valley (K-8), and the BMWK (PlanQK).

\bibliography{path_integral_qec_refs}{}

\end{document}
