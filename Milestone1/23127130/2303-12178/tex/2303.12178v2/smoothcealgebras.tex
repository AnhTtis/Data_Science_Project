\section{Chekanov--Eliashberg dg-algebras for smooth Legendrians}
In this section, we first give a brief overview of the construction of the
Chekanov--Eliashberg dg-algebra for smooth Legendrians, the wrapped Floer
cohomology, and the surgery and cobordism maps.  This material follows
\cite{BEE12,EL17}, where details can be found.  We then compute the cohomology
of the Chekanov--Eliashberg dg-algebra in the boundary of a surface, which
finishes the proof of the surgery formula in dimension two.

\subsection{Smooth Chekanov--Eliashberg dg-algebras and wrapped Floer cohomology}
\label{ssec:smooth-ce}
Let $W$ be a Weinstein $2n$-manifold, with subcritical part $W_{0}$, and let
$\Lambda$ be a smooth Legendrian link of $(n-1)$-spheres living in the ideal
contact boundary $\partial W$ of $W$. Write $W_{\Lambda}$ for the Weinstein
manifold obtained by attaching critical Weinstein $n$-handles to $W$ at
$\Lambda$, and $C$ for the co-cores of the handles. We refer to \cite{CE12} for
details.  

\subsubsection{The Chekanov--Eliashberg dg-algebra} 
The Chekanov--Eliashberg dg-algebra $CE^{*}(\Lambda;W)$ of $\Lambda$ is the
semi-free dg-algebra generated by the Reeb chords of $\Lambda$, with one
idempotent for each component of $\Lambda$. We use cohomological grading and
define the degree of a chord $c$ of $\Lambda$ to be $|c|=-\text{CZ}( c )+1$,
where $\text{CZ}( c )$ is the Conley-Zehnder index. The differential $\partial
c$ is given by counting rigid (modulo translations along the $\R$-coordinate)
pseudo-holomorphic disks in the symplectization $\R\times \partial W$ of
the contact boundary $\partial W$, where the disk has boundary on the
cylindrical Lagrangian submanifold $\R \times \partial \Lambda$, taking $c$ as
input, which is the asymptotic Reeb chord at the positive end, and outputting a
word $c_{k}\ldots c_1$ of chords, which are the asymptotics at the negative
end. The disks are allowed to have anchors in $W$. An anchor in $W$ is an
interior puncture of the disk with a Reeb orbit
asymptotic at the negative end, along with an embedding of a rigid
pseudo-holomorphic punctured Riemann sphere $\C \to W$, such that the puncture
of the Riemann sphere converges the same Reeb orbit as the interior puncture of
the disk.  It follows from the dimension formula in \cite{CEL10} that
$|\partial|=1$. To see that $\partial^{2}=0$ one uses a standard
SFT-compactness argument by studying the $1$-dimensional moduli spaces of disks
taking $c$ as input and sees that they split at infinity into two-level
buildings of rigid disks corresponding to terms of $\partial^{2}$. See
\cite{EL17,Ekh19} for details. 

\subsubsection{Wrapped Floer cohomology}
The wrapped Floer cohomology of the co-cores $C$, denoted by $CW^{*}(
C;W_{\Lambda})$, is an $A_{\infty}$-algebra whose underlying module is freely
generated by the Reeb chords of the Legendrian $\partial C$ in the ideal
contact boundary $\partial W_{\Lambda}$, along with one self-intersection point
for each component of $C$. We here use the version of the wrapped Floer
cohomology without Hamiltonian from \cite[Appendix B]{EL17}.  The
self-intersections arise from choosing a system of parallel copies of $C$, see
\cite[Section 3.3]{EL17}.  The $A_{\infty}$-operations $\mu_{k}$ are defined as
follows. Write $\mu_{k} = \mu'_{k} + \mu_{k}''$ where $\mu'_{k}$ and
$\mu''_{k}$ are the components of $\mu_{k}$ that takes values in the
self-intersection point and Reeb chords, respectively. We define $\mu'$ on a
word $a_{k}\ldots a_1$ of generators of
$CW^{*}( C;W_{\Lambda})$ by counting rigid pseudo-holomorphic disks in
$W_{\Lambda}$ with boundary on $C$ taking $a_k \ldots a_1$ as input and
outputting one intersection point. We call these disks \emph{filling disks}.
Here the disk has positive asymptotics at the
Reeb chords $a_i$.  Strictly speaking, the count is performed for a
perturbation of $C$ which gives rise to a single self-intersection in the
interior of each component of $C$. If $C$ is embedded, then these are the only
self-intersection points. We define $\mu''$ by counting \emph{partial
holomorphic buildings}. These are buildings consisting of one \emph{primary
disk} in $\R\times \partial W_{\Lambda}$ with boundary on $\R \times \partial
C$ with some number of positive and negative punctures. The primary disk must
have at least two negative Reeb chord asymptotics (if it is a single strip,
then it is not of correct dimension). We call one of the negative punctures of
the primary disk the \emph{distinguished puncture} and consider it to be the
output of the building.  For each of the other negative punctures, the building
also has a \emph{secondary disk} in $W_\Lambda$ which has boundary on $C$, with
one puncture of the secondary disk converging to the corresponding output of
the primary disk. For a word $a_{k}\ldots a_1$ of generators of $CW^{*}(
C;W_{\Lambda})$ we then define $\mu_{k}''( a_{k}\ldots a_1 )$ by counting rigid
(modulo translation along the $\R$-coordinate for the primary disk) partial
holomorphic buildings, which have $a_{k}\ldots a_1$ as input, i.e. positive
asymptotics, when going counter-clockwise the around the entire building,
starting at the distinguished puncture.

\subsubsection{The surgery and cobordism maps}
The Chekanov--Eliashberg dg-algebra and the wrapped Floer cohomology are related
by the surgery formula of Bourgeois--Ekholm--Eliashberg \cite{BEE12} and
Ekholm--Lekili \cite{EL17}.

\begin{theorem}[\cite{BEE12,EL17}]
\label{res:surgery-map}
	There is an $A_{\infty}$-quasi-isomorphism	
	\[
		\Phi_{\Lambda}: CW^{*}( C;W_{\Lambda} ) \isomto CE^{*}( \Lambda;W ).
	\]
\end{theorem}
\begin{proof}
	For $n > 1$, this is \cite[Theorem 2]{EL17}. For $n=1$, it is a special
	case of \autoref{res:surgery-map-surface}
\end{proof}
The surgery map $\Phi_{\Lambda}$ is defined by considering the Weinstein
cobordism $W^{\circ}_{\Lambda} = (\R\times \partial W )_{\Lambda}$, obtained by
attaching Weinstein $n$-handles to the symplectization $\R\times \partial W$ at
$\Lambda$, where $\Lambda$ is viewed as living in the positive end of the
$\R\times \partial W$. The ends of the cobordism are then $\partial_{+}
W^{\circ}_{\Lambda} = \partial W_{\Lambda}$ and $\partial_{-}
W^{\circ}_{\Lambda} = \partial \Lambda$.  Each map
\[
	\Phi_{\Lambda}^{k}:CW^{*}( C;W_{\Lambda})^{\otimes k} \to CE^{*}( \Lambda;W )
	\quad k > 0
\]
of the $A_{\infty}$-homomorphism $\Phi_{\Lambda}$ is then defined by counting
rigid pseudo-holomorphic cobordism disks in $W_{\Lambda}^{\circ}$, as in
\autoref{fig:cobordism-disk}. For details, see \cite{EL17}.  
\begin{figure}[!htb]
    \centering
    \incfig{cobordism-disk}
    \caption{Example of a disk contributing to the output of
    $\Phi_{\Lambda}^{2}$. The black segments are boundary punctures converging to
    Reeb chords of $\Lambda$ and $\partial C$. The red and blue segments are
    mapped to to $C$ and $L$ respectively. The black dots are mapped to $C \cap
    L$.}
    \label{fig:cobordism-disk}
\end{figure}

\begin{remark}
Though not explicitly stated, it is clear from the proof given in \cite{EL17}
that when $n > 1$, the map is in fact an $A_{\infty}$-\emph{isomorphism}, at
least this can be assumed to hold when the maps is restricted to the generators
below any fixed action level. (The
final map is defined as a limit of such maps.) This is not true when $n=1$, the
problem being that the low dimension makes all Reeb chords degenerate. However,
it is still true that the map is a quasi-isomorphism, which we prove in 
\autoref{ssec:surgery-surfaces}.  
\end{remark}
There is a closely related result which we will call the cobordism formula.
Consider a subset $\Pi$ of the attaching spheres in $\Lambda$, and the
Chekanov--Eliashberg dg-algebra of $CE( \Lambda \setminus \Pi;W_{\Pi} )$ of the
remaining part of $\Lambda$ after attaching handles at $\Pi \subset \Lambda$.
Note that $\Lambda \setminus \Pi$ is considered as a Legendrian inside the
boundary of the Weinstein manifold $W_{\Pi}$.

\begin{theorem}{\cite[Theorem 5.1 when $n > 1$]{BEE12}}
\label{res:cobordism-map}
	Let $\Pi$ be a subset of the spheres in $\Lambda$.  Then there is a
	dg-algebra morphism
	\[
		\Psi_{\Pi}: CE^{*}( \Lambda \setminus \Pi ;W_{\Pi} ) \to 
		CE^{*}( \Lambda;W )
	\]
	which is a quasi-isomorphism onto the subalgebra $CE^{*}(
	\Lambda;W)[\Lambda \setminus \Pi,\Lambda \setminus \Pi]$, consisting of
	all word of Reeb chords whose initial and terminal vertices are both
	contained in $\Lambda \setminus \Pi$. 
\end{theorem}
Note that this theorem is true for all $n > 0$.  To define $\Psi_{\Pi}$, we
perform the same handle attachment on $\R\times \partial W$ as in the
construction of the surgery map, but this time only for the subset $\Pi$ of
components of $\Lambda$. This results in a cobordism $\partial
W_{\Pi}^{\circ}$, with $\partial^{+} W^{\circ}_{\Pi} = \partial W_{\Pi}$ and
$\partial_{-} W^{\circ}_{\Pi} = \partial W$.  We define an exact Lagrangian
cobordism $L = \bigcup_{i \in I} L_{i}$ inside $W^{\circ}_{\Pi}$, by letting
$L_{i} = \Lambda_{i} \times [0,1]$ for $\Lambda_{i} \in \Lambda \setminus \Pi$
and $L_{i} = \Lambda_{i}\times [0,1] \cup L_{\Lambda_i}$ for $\Lambda_{i} \in
\Pi$, where $L_{\Lambda_{i}}$ is the core of the handle attached at
$\Lambda_{i}$. We have $\partial_{-} L \subset \partial^{-} W^{\circ}_{\Pi}$
and $\partial_{+} L = \Lambda \setminus \Pi \subset \partial^{+}
W^{\circ}_{\Pi}$. We then define   
\[
	\Psi_{\Pi}: CE^{*}( \Lambda \setminus \Pi;W_{\Pi} ) \to CE^{*}( \Lambda;W ).
\] 
to be the standard Symplectic Field Theory cobordism map as defined in e.g
\cite{EGH00, Ekh08}.  Its action on a chord $c \in CE^{*}( \Lambda \setminus
\Pi;W_{\Pi} )$ is given by counting pseudo-holomorphic disks in
$W_{\Pi}^{\circ}$ with boundary on $L$, taking $c$ as input and which outputs a
word in $CE^{*}( \Lambda;W )$.

A complete proof of \autoref{res:cobordism-map} has yet to appear in the
literature in the case when $n > 1$, but the proof sketched in \cite{BEE12} is
similar to the proof of
\autoref{res:surgery-map} which is worked out in detail in \cite[Appendix
B]{EL17}\cite{Ekh19}. \autoref{res:cobordism-map} can also be reduced to
\autoref{res:surgery-map} using the following proposition.

\begin{proposition}
\label{res:commutative-square}
Up to homotopy, the following diagram of chain complexes commutes in homotopy.
(When $n = 1$ the diagram commutes on the chain level)
\[\begin{tikzcd}
	{CW^{*}(C \setminus C_\Pi;W_\Lambda)} & {CW^{*}(C;W_\Lambda)} \\
	{CE^{*}(\Lambda \setminus 
	\Pi;W_\Pi)} & {CE^{*}(\Lambda;W),}
	\arrow["{\Psi_{\Pi}}"', from=2-1, to=2-2]
	\arrow[hook,"\iota ", from=1-1, to=1-2]
	\arrow["{\Phi_{\Lambda \setminus \Pi}}"', from=1-1, to=2-1]
	\arrow["{\Phi_{\Lambda}}", from=1-2, to=2-2]
\end{tikzcd}\]
where $\iota$ is the inclusion of generators.
\end{proposition}
Note again that this is true for all $n > 0$.
\begin{proof}
	Each term of $\Phi_{\Lambda} \circ \iota$ corresponds to a disk in
	$W_{\Lambda}^{\circ}$ with boundary on $L$ and $C\setminus C_{\Pi}$,
	and each term of $\Psi_{\Pi} \circ \Phi_{\Lambda \setminus \Pi}$
	corresponds to a building consisting of one disk in $W_{\Lambda
	\setminus \Pi}^{\circ}$ with boundary on $L$ and $C\setminus C_{\Pi}$
	and several disks in $W_{\Pi}^{\circ}$ with boundary on $L$, see
	\autoref{fig:commutative-square}. These are in one-to-one
	correspondence by a standard SFT-stretching and gluing argument. More
	specifically, we stretch the neck around the contact type hypersurface
	$\partial W_{\Pi}$ inside $W_{\Lambda}$ where the latter cobordism is
	obtained by first attaching the handles in $\Pi$ and then attaching the
	handles in $\Lambda \setminus \Pi$. For $n=1$, we obtain a direct bijection 
	of the moduli spaces of disks and buildings contributing to
	$\Phi_{\Lambda} \circ \iota$ and $\Psi_{\Pi} \circ \Phi_{\Lambda
	\setminus \Pi}$ respectively, by gluing relevant the disks by an
	explicit concatenation along the Reeb chords. When $n > 1$ the argument
	is more involved because of two reasons. First, one can only arrange so
	that the surgery formula becomes a quasi-isomorphism below some finite
	action level, depending on choices of contact forms and complex
	structures on the contact manifold obtained by surgery; one must take a
	limit of forms and complex structures to the full quasi-isomorphism.
	Note that the Chekanov-Eliashberg algebra in the bottom left corner of
	the diagram also depends on these choices of structures. Second, we
	need to use an analytic gluing of the pseudoholomorphic discs in order
	to relate disks before and after stretching. We give a sketch of the
	argument here. First, we choose a sequence of almost complex structures
	$J_{k}$, stretching the neck. Any sequence of pseudo-holomorphic disks,
	with respect to the respective $J_{k}$, contributing to $\Phi_{\Lambda}
	\circ \iota$, and of bounded energy, degenerates into a building as
	illustrated to the right in \autoref{fig:commutative-square}, when $k
	\to \infty$. By choosing an action cutoff for the generators of
	$CW^{*}(C \setminus C_\Pi;W_\Lambda)$ we obtain a bound on the energy
	of the disks, and can thus conclude that for a sufficiently large $k$,
	we get the desired bijection of the moduli spaces. Thus, the diagram
	commutes below any given action level. Taking the categorical limit of
	the diagrams with respect to the inclusion maps from lower to higher
	action levels, we then obtain the desired result.
\begin{figure}[ht]
    \centering
    \incfig{commutative-square}
    \caption{Illustrated to the left is the type of disks contributing to
	    $\Phi \circ \iota$, and to the type of buildings contributing to
    	$\Psi_{\Pi} \circ \Phi_{\Lambda \setminus \Pi}$. The red segments map
	to $C \setminus C_{\Pi}$ and the blue segments map to $L$.}
    \label{fig:commutative-square}
\end{figure}

\end{proof}
\begin{proof}[Proof of \autoref{res:cobordism-map}]
	It is clear by construction of the wrapped Floer complex that the
	inclusion $\iota:CW^{*}( C \setminus C_{\Pi};W_{\Lambda} ) \to CW^{*}(
	C;W_{\Lambda} )$ is an isomorphism onto the subcomplex of all chords
	without endpoints on the co-cores $C_{\Pi}$ that correspond to the
	attaching spheres in $\Pi$.  The surgery maps in
	\autoref{res:commutative-square} are quasi-isomorphisms by
	\autoref{res:surgery-map} and will send any chord with endpoints on a
	given pair of co-cores to a sum of words of Reeb chords whose initial
	and terminal vertices both are located on the corresponding attaching
	spheres of $\Lambda$. It thus follows that $\Psi_{\Pi}$ is a
	quasi-isomorphism onto $CE^{*}( \Lambda;W )[\Lambda \setminus
	\Pi,\Lambda \setminus \Pi]$. 	
\end{proof}

\subsubsection{Removal of Legendrians with exact idempotents.}
The following is an algebraic lemma which we will make use of several times in
the subsequent sections. 
\begin{lemma}
\label{res:exact-removal}
	Let $A$ be a semi-free dg-algebra, whose underlying associative algebra
	is the path algebra of a quiver $Q$ with vertices $Q_0$ (the
	idempotents of $A$) and arrows $Q_1$ (the generators over the
	idempotent ring).  Suppose that there for a vertex $i \in Q_{0}$ exists
	an element $a \in Q_1$ that satisfies $\partial a = e_i$, where $e_i$
	is the idempotent of $i$, such that $a$ does not occur the differential
	of any other arrow. Let $I$ be the ideal generated by all arrows with
	source or target on $i$. Then the projection 
	\[
		A \to A \slash I
	\] 
	is a quasi-isomorphism.
\end{lemma}
\begin{proof}
	Since $A$ is an algebra over the idempotent ring, the differential will
	preserve the source and target of words. Therefore, $I$ is a chain
	complex, and we have a short exact sequence 
	\[ 
		0 \to I \to A \to A \slash I \to 0, 
	\] 
	of chain complexes.  Let $\partial$ be the differential on $I$. The
	dg-algebra has a double complex structure $\partial = \bar{\partial}_{a} +
	\partial_{a}$, where $\partial_{a}$ acts as $\partial$ on $a$ and
	vanishes on all other arrows, and $\bar{\partial}_{a} = \partial -
	\partial_{a}$. If one considers the spectral sequence arising from this
	double complex with the $\partial_{a}$-cohomology on the first page,
	one sees that it vanishes. The complex $I$ is thus exact and the result
	then follows by considering the long exact sequence in cohomology.
\end{proof}
\begin{remark}
	The special case in which we will use this is when $A = CE^{*}( \Lambda
	\cup \Pi;W )$ for some Legendrians $\Lambda$ and $\Pi$, and there is a
	Reeb chord $a$ such that $\partial a = e_{\Pi}$, which does not occur
	in the differential. Then $A \slash I$ is isomorphic to $CE^{*}(
	\Lambda ;W )$, and we thus have a quasi-isomorphism $CE^{*}( \Lambda
	\cup \Pi;W ) \isomto CE^{*}( \Lambda ;W )$.
\end{remark}

\subsection{The surgery formula for surfaces}
\label{ssec:surgery-surfaces}
As mentioned above, when $n=1$, i.e. when the contact manifold is
one-dimensional, one cannot perturb the Legendrian so that all Reeb chords are
non-degenerate.  It turns out that the bijection of the generators needed in
the argument for the proof of \autoref{res:surgery-map} when $n>1$ in
\cite{EL17} does not hold.  It is therefore necessary to consider the
cohomology of the algebras in more detail.  In order to stay consistent with
the next section, we here switch notation and denote the Weinstein manifold as
$V$ and the Legendrian in $\partial V$ as $\partial \Lambda$. 

We will also allow the Legendrian to consist of stops as well as $0$-spheres.
In this dimension that means that $\partial \Lambda$ is a finite set of points
in $\partial V$ that is partitioned into two-point $0$-spheres (the attaching
spheres of the one-handles) and one-point
stops. We then get a Weinstein sector $V_{\partial \Lambda}$ by attaching
Weinstein $1$-handles at the $0$-spheres and half-handles at the stops. The
stops should be thought of as singular Legendrian skeleta of 'degenerate'
one-point Weinstein hypersurfaces in $\partial V$. Through their respective
surgery formulas, the singular and smooth Chekanov--Eliashberg dg-algebras
correspond to wrapped and partially wrapped Floer cohomology, respectively.  In
higher dimensions they require separate treatments, the singular one being
defined in terms of the smooth one. However, when $n=1$ the theory for the
'singular' stops and the 'smooth'  $0$-spheres is essentially the same, and we
will prove the surgery formula as one theorem. Write $CE^{*}( \partial
\Lambda;V )$ for the Chekanov--Eliashberg dg-algebra of $\partial \Lambda$ and
$CW^{*}( C;V_{\partial \Lambda} )$ for the partially wrapped Floer cohomology
of the co-cores $C$ produced by the surgery. 
\begin{theorem}
\label{res:surgery-map-surface}
	Let $V$ be a Weinstein surface and $\partial \Lambda$ an embedded
	collection of $0$-spheres and points, as described above. There is an
	$A_{\infty}$-quasi-isomorphism
	\[
		\Phi_{\partial \Lambda} :CW^{*}( C;V_{\partial \Lambda} )
		\isomto
		CE^{*}( \partial \Lambda;V ).
	\] 
\end{theorem}

To prove this, we begin by giving a combinatorial description of $CE^{*}(
\partial \Lambda;V )$. The manifold $V$ is a surface, so $\partial V$ is a
disjoint union of copies of $\mathbb{S}^{1}$. There is one idempotent for each
$0$-sphere and stop. For each component of $\partial V$ we pick a base point
not in $\partial \Lambda$ and write $c_{ij}^{p}$ for the Reeb chord which
starts at $i \in \partial \Lambda$, ends at $j \in \partial \Lambda$, and
passes though the base point $p$ times.

\begin{proposition}
\label{res:zero-dim-diff}
	Let $n=1$. For a chord $c_{ij}^{p}$, let
	\[
		\partial_{0}( c_{ij}^{p} )  = \sum \pm c_{kj}^{l}c_{ik}^{p-l}
	\]
	with the sum taken over all $k$ and $l$ for which the chords on the
	right hand side exist. Let $\partial_{-1}( c_{ij}^{p} ) = e_{k}$ if
	$c_{ij}^{p}$ is a chord with $i=j$, $p=1$, and which lives in the
	boundary of a simply connected component of $V$, where $e_{k}$ is the
	corresponding idempotent of the component of $i$, and let
	$\partial_{-1}(c_{ij}^{p} )=0$ otherwise. The differential $\partial$
	of $CE^{*}( \partial \Lambda;V )$ is then given by $\partial =
	\partial_{0} + \partial_{-1}$, where each $\partial_{i}$ has been
	extended to the whole algebra by the Leibniz rule.
\end{proposition}
\begin{proof}
	The terms $\partial_{0}$ and $\partial_{-1}$ correspond to unanchored
	and anchored symplectization disks respectively, illustrated in
	\autoref{fig:ce-diff-symplectization-disks}.
\begin{figure}[H]
    \centering
    \incfig{ce-diff-symplectization-disks}
    \caption{The two types of symplectization disks contributing to $\partial$,
    with the unanchored disk to the right and the anchored disk to the left.
    The blue parts are the boundary segments of the disk which map to $\partial
    \Lambda \times \R$.}
    \label{fig:ce-diff-symplectization-disks}
\end{figure}
	Having more than one slit in the symplectization disk would result in
	it being non-rigid, and if an internal puncture were to wind more
	than once around the boundary, the anchor at the puncture would be
	non-rigid, as it would need to have a branch point.
\end{proof}

Note that $\partial_{0}$ is action preserving, while $\partial_{-1}$ is
strictly action decreasing, and that
$\partial_{0}^{2}=\partial_{-1}^{2}=\partial_{0}\circ \partial_{-1} =
\partial_{-1} \circ \partial_{0} = 0$. We will compute the
$\partial_{0}$-cohomology of $CE^{*}( \partial \Lambda;V)$, for which we need
some additional terminology. 

\begin{definition}
\label{def:short-chord-def}
	Given two Reeb chords $c_{ik}^{p}$ and $c_{kj}^{q}$ of $\partial
	\Lambda$ whose endpoint and starting point agree, their
	\emph{concatenation} is
	\[
		c_{kj}^{q} * c_{ik}^{p} := c_{ij}^{p+q}.
	\]
	A chord is called \emph{short} if it is not the concatenation of any
	other chords. We also consider the idempotents to be short chords.  Let
	$\bbc = c_{i_mj_m}^{p_m}\ldots c_{i_{1}j_{1}}^{p_{1}} \in A$ be a word
	of chords and let $l_1,\ldots,l_k$ be the subsequence $1,\ldots,m-1$ of
	all $l_{h}$ such that $j_{l_{h}}\neq i_{l_{h}+1}$. The \emph{total
	concatenation}, $\bbc_{\text{tc}}$, of $\bbc$ is the word
	\[
		\bbc_{\text{tc}}:=
		(c_{i_mj_m}^{p_m} * \ldots *
		c_{i_{l_{k}+1}j_{l_{k}+1}}^{p_{l_{k}+1}})
		\ldots
		(c_{i_{l_{h+1}}j_{l_{h+1}}}^{p_{l_{h+1}}} * \ldots *
		c_{i_{l_{h}}j_{l_{h}}}^{p_{l_h}})
		\ldots
		(c_{i_{l_{1}}j_{l_{1}}}^{p_{l_1}} * \ldots *
		c_{i_{1}j_{1}}^{p_{1}})
	\]
	i.e. the word obtained by concatenating all adjacent chords in $\bbc$
	whose respective starting point and endpoint agree. The \textit{total
	splitting}, $\bbc_{\text{ts}}$, of $\bbc$ is the unique word consisting
	only of short chords such that $(\bbc_{\text{ts}})_{\text{tc}} =
	\bbc_{\text{tc}}$, i.e. the word obtained by splitting the chords of
	$\bbc$ into two whenever they pass a point of $\partial \Lambda$. A
	word $\bbc$ is called \textit{unconcatable} if $\bbc=\bbc_{\text{tc}}$
	or if $\bbc = e_{i}$.
\end{definition}

\begin{lemma}
\label{res:short-chords-generate}
	The residue classes of the unconcatable words which only consist of
	short chords, i.e. words $\bbc$ with $\bbc = \bbc_{\textup{tc}} =
	\bbc_{\textup{ts}}$, form a basis of $H^{*}(CE( \partial
	\Lambda;V),\partial_{0})$.
\end{lemma}
\begin{proof}
	Let $\bbc$ be a word in $CE^{*}( \partial \Lambda;V )$, and let $C(
	\bbc )$ be the span of all words $\bbc'$ such that $\bbc_{\text{tc}}' =
	\bbc_{\text{tc}}$. Note that, as a complex, $(CE^{*}( \partial
	\Lambda;V ), \partial_{0})$ splits as a direct sum of the idempotents
	and the summands $C( \bbc )$ for all words $\bbc$ such that $\bbc =
	\bbc_{\text{ts}}$. Let $k$
	be the number of concatenation points of $\bbc_{\text{ts}}$ and note
	that $k=0$ if and only if $\bbc$ is an unconcatable word of short
	chords. In this case, $\partial_{0}$ vanishes on $C( \bbc ) =
	\text{Span}( \bbc )$. On the
	other hand, if $k > 0$, then one can readily compute that $C( \bbc )$
	is as a chain complex isomorphic to the tensor product of $k$ copies of
	the exact complex 
\[\begin{tikzcd}
		{0} & {\textbf{k}} & {\textbf{k}} & {0}  
		\arrow[from=1-1, to=1-2]
		\arrow["\sim",from=1-2, to=1-3]
		\arrow[from=1-3, to=1-4]
\end{tikzcd}\]
	and since we are working over a field, it then follows from the KÃ¼nneth
	formula that $C(\bbc)$ itself is exact. The result follows.
\end{proof}
	We next compute the cohomology of $CW^{*}( C;V_{\partial \Lambda} )$.

\begin{lemma}
\label{res:wrapped-floer-diff}
	Suppose that $n=1$ and let $C'$ be the set of all null-homotopic
	components of $C$.  By null-homotopy we mean a contraction of the
	component keeping the endpoints in $\partial V_{\partial \Lambda}$.
	Then the inclusion,
	\[
		CW^{*}( C \setminus C';V_{\partial \Lambda} ) \to 
		CW^{*}( C;V_{\partial \Lambda} ) 
	\] 
	is a quasi-isomorphism, and moreover, $\mu_{1}$ vanishes on $CW^{*}( C
	\setminus C';V_{\partial \Lambda} )$.
\end{lemma}
\begin{proof}
	If a component is null-homotopic, it will together with some segment of
	the boundary form a contractible loop, which bounds some simply
	connected subset of $V_{\partial \Lambda}$.  This boundary segment is a
	Reeb chord $c$ of $\partial C$. There is then by the Riemann mapping
	theorem a unique holomorphic disk which takes $c$ as input, and by
	definition of the differential this disk will output the
	self-intersection point corresponding to the null-homotopic component.
	The self-intersection points act as idempotents in $CW^{*}(
	C;V_{\partial \Lambda} )$, so it follows that the inclusion is a
	quasi-isomorphism.

	To show that $\mu_{1}$ vanishes on $CW^{*}( C \setminus C';V_{\partial
	\Lambda})$, we first note that there are no intersection points between
	the different cores, while the differential vanishes on the idempotents
	(which can be though of as the unique self-intersection points of a
	small push off).  If there is a Reeb chord $c$ such that $\mu_{1}'( c )
	\neq 0$, then $c$ must begin and end at the same component. Since the
	output is non-zero, there will be a filling disk taking $c$ as input
	which outputs an intersection point. This filling disk then gives rise
	to a null-homotopy of the component at which $c$ has its endpoints. On
	the other hand, if $\mu_{1}''( c ) \neq 0$, there will be a partial
	holomorphic building taking $c$ as input, which outputs some Reeb
	chord. In order for the primary disk of this building to be rigid, it
	must have one positive puncture and two negative punctures. The
	building must therefore have a secondary filling disk with a single
	puncture meeting one of the two negative punctures of the primary disk.
	This disk then induces a null-homotopy of one of the components which
	the input has an endpoint on. 
\end{proof}

We now have everything we need to prove the surgery formula.

\begin{proof}[Proof of \autoref{res:surgery-map-surface}]
Recall that an $A_{\infty}$-morphism consists of an infinite sequence of
morphisms $\Phi_{\partial \Lambda}^{i}$. This sequence of maps was defined in
\cite{EL17} by counting cobordism disks.  Since an $A_{\infty}$-morphism is a
quasi-isomorphism if and only if the chain map $\Phi_{\partial \Lambda}^{1}$ is
a quasi-isomorphism of complexes, we will in the following restrict our
attention to this map and denote it by $\Phi_{\partial \Lambda}$ for
simplicity.  We define the \emph{action} of a chord in the boundary of $V$,
$V_{\partial \Lambda}$, or $V_{\partial \Lambda}^{\circ}$ to be the integral of
the contact form along the chord. We define the \emph{limit action} of a chord
to be the limit of its action when the handles and half-handles are shrunk.
Chords at different stages of the shrinking process can be canonically
identified, so this is well-defined.  It follows from Stokes' theorem that this
limit action is a filtration that is respected by the differentials of $CW^{*}(
C;V_{\partial \Lambda} )$ and $CE^{*}(\partial \Lambda;V )$, and that
$\Phi_{\partial \Lambda}$ is filtration preserving.

We write $\Phi_{\partial \Lambda} = \Phi_{\partial \Lambda}' + \Phi_{\partial
\Lambda}''$, where for each chord $c \in CW^{*}( C;V_{\partial \Lambda} )$, the
term $\Phi_{\partial \Lambda}(c)'$ consists of the words in $\Phi_{\partial
\Lambda}( c )$ of limit action equal to that of $c$, and $\Phi_{\partial
\Lambda}''( c )$ consists of the words of strictly lower limit action. Again by
Stokes' theorem, $\Phi_{\partial \Lambda}'$ and $\Phi''_{\partial \Lambda}$ are
the parts of $\Phi_{\partial \Lambda}$ corresponding to unanchored and anchored
cobordism disks respectively. 

We will view $\Phi_{\partial \Lambda}'$ as going between the chain complexes
$CW^{*}( C;V_{\partial \Lambda} )$ and $CE^{*}(\partial \Lambda;V )$ equipped
with the limit action preserving part of their differentials. This limit action
preserving part vanishes for $CW^{*}( C;V_{\partial \Lambda} )$ and for
$CE^{*}(\partial \Lambda;V )$ it is the differential $\partial_{0}$ from above.
We will show that with respect to these differentials, $\Phi_{\partial
\Lambda}'$  is a quasi-isomorphism.

Let $u:D^{2}\setminus \{z_1,\ldots,z_k\} \to V_{\Lambda}^{\circ}$ be a rigid
unanchored cobordism disk, as in the definition of $\Phi_{\partial \Lambda}$.
We claim that no interior points of $D^{2}\setminus \{z_1,\ldots,z_k\}$ get
mapped to $L$. This is indeed the case: The curve $u$ will be a branched cover
and the rigidity of $u$ implies that there are no branch points. The preimage
$u^{-1}\mid_{\text{int} D^{2}}(L)$ of the curve will thus be a smoothly
embedded curve in $D^{2}$, which will then either be a closed loop, or have
endpoints at two of the negative punctures, as illustrated in
\autoref{fig:rigid-curve-preimage}.  
\begin{figure}[!htb]
    \centering
    \incfig{rigid-curve-preimage}
    \caption{The preimage of $L$ under $u\mid_{\text{int} D^{2}}$ will be a
	    smooth curve whose
	    components are either closed or have endpoints at two negative
	    punctures.}
    \label{fig:rigid-curve-preimage}
\end{figure}
The first situation is impossible as $u$ has no critical points and thus is a
locally injective immersion. The second situation is also impossible. This is
because the half-annuls region in \autoref{fig:rigid-curve-preimage} bounded by
the preimage curve and the boundary will have negative area by Stokes' theorem.
Thus, $u$ cannot map any interior points to $L$. 

We can therefore consider $u$ as a map to the surface $\widetilde{V}_{\partial
\Lambda}^{\circ}$ obtained from 'opening up' $V_{\partial \Lambda}^{\circ}$
along $L$ and inserting two boundary components. (Topologically this is the
same as removing a small open neighborhood of $L$.) The universal cover of
$\widetilde{V}_{\partial \Lambda}^{\circ}$ is a disjoint union of surfaces as
illustrated in the center of \autoref{fig:universal-cover}, either continuing
indefinitely, or ending at a half-handle as to the left or right in the figure.
Chords of $C$ correspond to segments of the upper component of the boundary,
and unconcatable words of short chords of $\Lambda$ correspond to segments of
the bottom component of the boundary, shown in the aforementioned image.  It
thus follows from the Riemann mapping theorem that $\Phi_{\partial \Lambda}'$
is a bijection from the set of Reeb chords on $C$ onto the set of unconcatable
words of short chords, and is hence a quasi-isomorphism by
\autoref{res:short-chords-generate}.

\begin{figure}[!htb]
    \centering
    \incfig{universal-cover}
    \caption{The universal cover of $\widetilde{V}_{\partial \Lambda}^{\circ}$
    	consists of a disjoint union of surfaces as in the center, either
    	continuing indefinitely, or stopping at half-handle as to the left and
    	right.}
    \label{fig:universal-cover}
\end{figure}

Finally, we consider the mapping cone  $\text{Cone}(\Phi_{\partial \Lambda})$
of $\Phi_{\partial \Lambda}$.  Since $\Phi_{\partial \Lambda}$ preserves the
filtration, $\text{Cone}(\Phi_{\partial \Lambda})$ inherits the limit action
filtration. Considering the spectral sequence arising from this filtration, one
sees that the first page is isomorphic to $\text{Cone}(\Phi_{\partial
\Lambda}')$. Since  $\Phi_{\partial \Lambda}'$ is a quasi-isomorphism, the
spectral sequence vanishes on the second page, making $\Phi_{\partial \Lambda}$
a quasi-isomorphism.
\end{proof}
	Using the above, we can now prove \autoref{res:zero-dim-leg-min-mod}
	from the introduction.  
\begin{proof}[Proof of \autoref{res:zero-dim-leg-min-mod}]
	The assumption that no co-core is null-homotopic guarantees that
	$\partial$ vanishes on the short chords and hence they are all cycles.
	If we then consider the inclusion of the chain complex of the
	unconcatable words of short chords into $CE^{*}(\partial \Lambda;V )$,
	this is by \autoref{res:short-chords-generate} a quasi-isomorphism on
	the action preserving level, and the differential is action decreasing,
	so it follows that it is a quasi-isomorphism onto the full chain
	complex (consider the mapping cone of the inclusion, filter by action,
	and take the spectral sequence of this filtration).  This shows that
	the unconcatable words of short chords form a basis of $H^{*}CE(
	\partial \Lambda;V )$. 	

	The multiplication is induced by the multiplication on $CE^{*}(
	\partial \Lambda;V )$, and comes from the boundary $\partial( c_2 *
	c_1)=c_2c_1 + \partial_{-1}( c_2 * c_1 )$, which is satisfied whenever
	$c_{2}$ and $c_{1}$ can be concatenated. Note that the second term
	indeed is a cycle, since $\partial_{-1}^{2} = 0$ holds and since
	$\partial_0( c_2c_1 ) = 0$ by the assumption that the $c_{i}$ are short
	chords. Since the differential of
	$CW^{*}( C;V_{\partial \Lambda} )$ is zero in view of
	\autoref{res:wrapped-floer-diff} (by the assumption that no co-cores
	are null-homotopic) the higher operations can be obtained using
	\autoref{res:surgery-map}. They have been  described combinatorially in
	\cite{HKK17}, and are also easy to see in our setup.  If one takes a
	filling disk and shrinks the handles, its input and output will
	converge to a word whose total concatenation goes once around the
	boundary of $V$. When the number of inputs of a partial holomorphic
	building is greater than two, the symplectization disk can only have
	one positive puncture, as it would otherwise be non-rigid.  There
	exists such a rigid unanchored symplectization disk taking a chord $c$
	as input and outputting a word $c_2c_1$ if and only if $c=c_2*c_1$.
	Since any handle attachment results in a space not homeomorphic to a
	disk, the symplectization disks do not have any anchors. Taken
	together, these observations give the desired result. See
	\autoref{fig:higher-operations}.
\begin{figure}[!htb]
    \centering
    \incfig{higher-operations}
    \caption{The partial holomorphic buildings contributing to the higher
    operations.}
    \label{fig:higher-operations}
\end{figure}

	Finally, the last statement follows from
	\autoref{res:wrapped-floer-diff} and \autoref{res:commutative-square}
	combined with the fact that the horizontal arrows in
	\autoref{res:commutative-square} are quasi-isomorphisms by
	\autoref{res:surgery-map}.
\end{proof}
