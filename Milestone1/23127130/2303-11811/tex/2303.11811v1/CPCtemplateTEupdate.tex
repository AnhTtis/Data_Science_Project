%% This template can be used to write a paper for
%% Computer Physics Communications using LaTeX.
%% For authors who want to write a computer program description,
%% an example Program Summary is included that only has to be
%% completed and which will give the correct layout in the
%% preprint and the journal.
%% The `elsarticle' style is used and more information on this style
%% can be found at 
%% http://www.elsevier.com/wps/find/authorsview.authors/elsarticle.
%%
%%
\documentclass[preprint,12pt]{elsarticle}

%% Use the option review to obtain double line spacing
%% \documentclass[preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times]{elsarticle}
%% \documentclass[final,1p,times,twocolumn]{elsarticle}
%% \documentclass[final,3p,times]{elsarticle}
%% \documentclass[final,3p,times,twocolumn]{elsarticle}
%% \documentclass[final,5p,times]{elsarticle}
%% \documentclass[final,5p,times,twocolumn]{elsarticle}

%% if you use PostScript figures in your article
%% use the graphics package for simple commands
%% \usepackage{graphics}
%% or use the graphicx package for more complicated commands
\usepackage{graphicx}
%% or use the epsfig package if you prefer to use the old commands
%% \usepackage{epsfig}

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}

\usepackage{amsmath}
\usepackage[acronym]{glossaries}
\usepackage{float}
\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
\usepackage{breqn}
\usepackage[hidelinks]{hyperref}
\usepackage{interval}
\usepackage{tikz}
\usetikzlibrary{patterns,shapes.arrows,calc,angles,quotes,babel,arrows,arrows.meta,shapes.geometric}
\usepackage[capitalise]{cleveref}
\usepackage{xurl}
\usepackage{uri}

\definecolor{matplotlibBlue}{HTML}{1f77b4} % blue from matplotlib color cycle
\definecolor{matplotlibOrange}{HTML}{ff7f0e} % orange from matplotlib color cycle
\definecolor{matplotlibGreen}{HTML}{2ca02c} % green from matplotlib color cycle
\definecolor{matplotlibRed}{HTML}{d62728} % red from matplotlib color cycle
\definecolor{matplotlibPurple}{HTML}{9467bd} % purple from matplotlib color cycle
\definecolor{matplotlibBrown}{HTML}{8c564b} % brown from matplotlib color cycle
\definecolor{matplotlibPink}{HTML}{e377c2} % pink from matplotlib color cycle
\definecolor{matplotlibGrey}{HTML}{7f7f7f} % grey from matplotlib color cycle
\definecolor{matplotlibYellow}{HTML}{bcbd22} % yellow from matplotlib color cycle

\tikzstyle{kernel} = [rectangle, 
minimum width=3cm, 
minimum height=1cm, 
text centered, 
text width=3cm, 
draw=black]

\tikzstyle{syncSweep} = [rectangle, 
minimum width=3cm, 
minimum height=1cm, 
text centered, 
text width=3cm, 
draw=black, 
fill=matplotlibBlue!50]

\tikzstyle{syncKernel} = [rectangle, 
minimum width=3cm, 
minimum height=1cm, 
text centered, 
text width=3cm, 
draw=black, 
fill=matplotlibOrange!50]

\tikzstyle{hybridKernel} = [rectangle, 
minimum width=3cm, 
minimum height=1cm, 
text centered, 
text width=3cm, 
draw=black, 
fill=matplotlibGreen!50]

\tikzstyle{decision} = [diamond, 
minimum width=3cm, 
minimum height=1cm, 
text centered, 
draw=black]
\tikzstyle{arrow} = [thick,->,>=stealth]

\newcommand{\walberla}{\textsc{waLBerla}}

%% The amsthm package provides extended theorem environments
%% \usepackage{amsthm}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers after \end{frontmatter}.
%% \usepackage{lineno}

%% natbib.sty is loaded by default. However, natbib options can be
%% provided with \biboptions{...} command. Following options are
%% valid:

%%   round  -  round parentheses are used (default)
%%   square -  square brackets are used   [option]
%%   curly  -  curly braces are used      {option}
%%   angle  -  angle brackets are used    <option>
%%   semicolon  -  multiple citations separated by semi-colon
%%   colon  - same as semicolon, an earlier confusion
%%   comma  -  separated by comma
%%   numbers-  selects numerical citations
%%   super  -  numerical citations as superscripts
%%   sort   -  sorts multiple citations according to order in ref. list
%%   sort&compress   -  like sort, but also compresses numerical citations
%%   compress - compresses without sorting
%%
%% \biboptions{comma,round}

% \biboptions{}

%% This list environment is used for the references in the
%% Program Summary
%%
%\newcounter{bla}
%\newenvironment{refnummer}{%
%\list{[\arabic{bla}]}%
%{\usecounter{bla}%
% \setlength{\itemindent}{0pt}%
% \setlength{\topsep}{0pt}%
% \setlength{\itemsep}{0pt}%
% \setlength{\labelsep}{2pt}%
% \setlength{\listparindent}{0pt}%
% \settowidth{\labelwidth}{[9]}%
% \setlength{\leftmargin}{\labelwidth}%
% \addtolength{\leftmargin}{\labelsep}%
% \setlength{\rightmargin}{0pt}}}
% {\endlist}

\journal{Computer Physics Communications}

\begin{document}

\begin{frontmatter}

%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for the associated footnote;
%% use the fnref command within \author or \address for footnotes;
%% use the fntext command for the associated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for the associated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%%
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \address{Address\fnref{label3}}
%% \fntext[label3]{}

\title{Efficient and scalable hybrid fluid-particle simulations with geometrically resolved particles on heterogeneous CPU-GPU architectures}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{<author name>}
%% \address[label1]{<address>}
%% \address[label2]{<address>}

\author[a]{Samuel Kemmler\corref{author}}
\author[a]{Christoph Rettinger}
\author[a]{Harald Köstler}

\cortext[author] {Corresponding author.\\\textit{E-mail addresses:} samuel.kemmler@fau.de (S. Kemmler), christoph.rettinger@fau.de (C. Rettinger), harald.koestler@fau.de (H. Köstler)}
\address[a]{Chair for System Simulation, Friedrich-Alexander-Universität Erlangen-Nürnberg, Cauerstraße 11, 91058 Erlangen, Germany}

\newacronym{lbm}{LBM}{Lattice Boltzmann Method}
\newacronym{dem}{DEM}{Discrete Element Method}
\newacronym{cpu}{CPU}{Central Processing Unit}
\newacronym{gpu}{GPU}{Graphics Processing Unit}
\newacronym{psm}{PSM}{Partially Saturated Cells Method}
\newacronym{mem}{MEM}{Momentum Exchange Method}
\newacronym{pdfs}{PDFs}{Particle Distribution Functions}
\newacronym{cfd}{CFD}{Computational Fluid Dynamics}
\newacronym{simd}{SIMD}{Single Instruction, Multiple Data}
\newacronym{bc}{BC}{Boundary Condition}
\newacronym{srt}{SRT}{Single Relaxation Time}
\newacronym{pd}{PD}{Particle Dynamics}

\begin{abstract}
% Context
In recent years, it has become increasingly popular to accelerate numerical simulations using \gls{gpu}s.
% Problem motivation
In multiphysics simulations, the various combined methodologies may have distinctly different computational characteristics. Therefore, the best-suited hardware architecture can differ between the simulation components. Furthermore, not all coupled software frameworks may support all hardware. These issues predestinate or even force hybrid implementations, i.e., different simulation components running on different hardware.
% Solution description
We introduce a hybrid coupled fluid-particle implementation with geometrically resolved particles. The simulation utilizes \gls{gpu}s for the fluid dynamics, whereas the particle simulation runs on \gls{cpu}s. We examine the performance of two contrasting cases of a fluidized bed simulation on a heterogeneous supercomputer.
% Results
The hybrid overhead (i.e., the \gls{cpu}-\gls{gpu} communication) is negligible. The fluid simulation shows good performance utilizing nearly the entire memory bandwidth. Still, the \gls{gpu} run time accounts for most of the total time. The parallel efficiency in a weak scaling benchmark for 1024 A100 \gls{gpu}s is up to 71\%. Frequent \gls{cpu}-\gls{cpu} communications occurring in the particle simulation are the leading cause of the decrease in parallel efficiency.
% Conclusion
The results show that hybrid implementations are promising for large-scale multiphysics simulations on heterogeneous supercomputers.
\end{abstract}

\begin{keyword}
%% keywords here, in the form: keyword \sep keyword
Hybrid implementation\sep~High-performance computing\sep~Particulate flow\sep~Lattice Boltzmann method\sep~Discrete element method
\end{keyword}
\glsresetall
\end{frontmatter}

%%
%% Start line numbering here if you want
%%
% \linenumbers

%% main text
\input{src/01-introduction}
\input{src/02-methods}
\input{src/03-implementation}
\input{src/04-performance}
\input{src/05-conclusion}

\section*{Declaration of competing interest}
The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.

\section*{Data availability}
Data is available on Zenodo: \doi{10.5281/zenodo.7752954}.

\section*{Acknowledgements}
The authors gratefully acknowledge the Gauss Centre for Supercomputing e.V. (\url{www.gauss-centre.eu}) for funding this project by providing computing time on the GCS Supercomputer JUWELS at Jülich Supercomputing Centre (JSC).\newline
The authors gratefully acknowledge the scientific support and HPC resources provided by the Erlangen National High Performance Computing Center (NHR@FAU) of the Friedrich-Alexander-Universität Erlangen-Nürnberg (FAU). The hardware is funded by the German Research Foundation (DFG).

\section*{Funding}
The authors thank the Deutsche Forschungsgemeinschaft (DFG, German Research
Foundation) for funding the project 433735254. The DFG had no direct involvement in this paper.

% chktex-file 8
\section*{Author ORCIDs}
S.\ Kemmler, \url{https://orcid.org/0000-0002-9631-7349};
C.\ Rettinger, \url{https://orcid.org/0000-0002-0605-3731};
H.\ Köstler, \url{https://orcid.org/0000-0002-6992-2690};

\section*{Author contributions}
S.\ Kemmler: Conceptualization, Methodology, Software, Validation, Formal analysis, Investigation, Data Curation, Writing - Original Draft, Visualization, Project administration;
C.\ Rettinger: Conceptualization, Writing - Review and Editing;
H.\ Köstler: Resources, Writing - Review and Editing, Supervision, Funding acquisition;

%% The Appendices part is started with the command \appendix;
%% appendix sections are then done as normal sections
%% \appendix

%% \section{}
%% \label{}

%% References
%%
%% Following citation commands can be used in the body text:
%% Usage of \cite is as follows:
%%   \cite{key}         ==>>  [#]
%%   \cite[chap. 2]{key} ==>> [#, chap. 2]
%%

%% References with bibTeX database:

\bibliographystyle{elsarticle-num}
\bibliography{MyLibrary.bib}

%% Authors are advised to submit their bibtex database files. They are
%% requested to list a bibtex style file in the manuscript if they do
%% not want to use elsarticle-num.bst.

%% References without bibTeX database:

% \begin{thebibliography}{00}

%% \bibitem must have the following form:
%%   \bibitem{key}...
%%

% \bibitem{}

% \end{thebibliography}


\end{document}

%%
%% End of file
