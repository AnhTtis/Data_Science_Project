\pgfplotsset{/pgfplots/horizontal line legend/.style={legend image code/.code={\draw[very thick] (0cm,0cm)-- (.35cm,0cm);},},}

\begin{tikzpicture}
    \begin{axis} [ybar,
    ylabel=Time per time step / ms,
    symbolic x coords={PSM, comm, mapping, setU, redF, PD, other},
    xtick={PSM, comm, mapping, setU, redF, PD, other},
    xticklabel style={text height=2ex},
    legend style={at={(0.55,0.8)},anchor=east},
    legend cell align={left},
    grid, width=0.9*\textwidth, height=0.4*\textheight]
    \addplot [draw=matplotlibBlue,fill=matplotlibBlue!50, postaction={pattern=north east lines}, pattern color=black] coordinates {
        (PSM,24.78315357)
        (redF,4.912856478)
        (mapping,3.210133870259481)
        (setU,1.485454394)
        (PD,1.8600000000000003)
        (other,3.5557743957405172)
        (comm,0.10502729200000001)
    };
    \addplot [draw=matplotlibOrange,fill=matplotlibOrange!50, postaction={pattern=north east lines}, pattern color=black] coordinates {
        (PSM,31.901119082)
        (redF,18.391524202)
        (mapping,5.8220524171656685)
        (setU,2.792142046)
        (PD,41.96)
        (other,7.24992760483435)
        (comm,0.381234648)
        
    };
    \addplot[black,horizontal line legend,sharp plot,update limits=false,very thick] coordinates { ([normalized]-0.4,17.4) ([normalized]0.4,17.4) };
    \legend{Dilute case, Dense case, LBM roofline $T_\min$}
    \end{axis}
\end{tikzpicture}
