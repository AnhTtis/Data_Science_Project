\section{Numerical methods}\label{numerical_methods}
Generally, fully resolved coupled fluid-particle simulations consist of three modules: fluid dynamics, particle physics, and fluid-particle coupling. In this section, we introduce the background of the methods based on the work of~\citet{rettingerComparativeStudyFluidparticle2017, rettingerEfficientFourwayCoupled2022}.
\cref{fig:psm_sketch} illustrates coupled fluid-particle simulations using the \gls{psm}, as it will be explained in the upcoming sections.
\begin{figure}
  \centering
  \input{figures/psm_sketch.tex}
  \caption{
        Two-dimensional sketch of coupled fluid-particle simulations using the \gls{psm}
    }\label{fig:psm_sketch}
\end{figure}

\subsection{Lattice Boltzmann method}
We use the \gls{lbm} with the D3Q19 lattice model for the hydrodynamics simulation, an alternative to conventional Navier-Stokes solvers~\citep[][]{krugerLatticeBoltzmannMethod2017}.
We evolve 19 \gls{pdfs} $f_q$ with $q\in \{0,\ldots,18\}$ for every cell of a three-dimensional cartesian lattice. Each $f_q$ is associated with a lattice velocity $\boldsymbol{c}_q$.
The underlying update rule is based on the Boltzmann equation, typically split into the streaming and collision steps.
The cell-local collision relaxes the \gls{pdfs} towards a thermodynamic equilibrium.
The streaming propagates the post-collision \gls{pdfs} $\widetilde{f_q}$ to neighboring cells.
The collision step for the lattice cell $\boldsymbol{x}$ at time step $t$ is defined as
\begin{equation}
  \widetilde{f_q}(\boldsymbol{x},t)=f_q(\boldsymbol{x},t)+C_q(\boldsymbol{x},t)+F_q(\boldsymbol{x},t),
  \label{collision}
\end{equation}
with $C_q$ being the collision operator and $F_q$ the forcing operator. The streaming step
\begin{equation}
  f_q(\boldsymbol{x}+\boldsymbol{c}_q\varDelta t,t+\varDelta t)=\widetilde{f_q}(\boldsymbol{x},t)
\end{equation}
distributes the \gls{pdfs} to neighboring cells. $\varDelta t$ is the time step size, which is typically 1 in the context of the \gls{lbm}. Although recent studies have used more elaborate collision operators in the context of the \gls{psm}~\citep[][]{wangImprovedCouplingTime2018}, the \gls{srt} model (also known as the BGK model~\citep[][]{qianLatticeBGKModels1992}) is still commonly applied in the context of the \gls{psm}, which we will introduce in the following. It relaxes the \gls{pdfs} towards their equilibrium using a single relaxation time $\tau$
\begin{equation}
  C_q^{\text{SRT}}(\boldsymbol{x},t)=\frac{\varDelta t}{\tau}(f_q^{\text{eq}}(\rho_{\text{f}},\boldsymbol{U}_{\text{f}})-f_q(\boldsymbol{x},t)).
  \label{srt_collision}
\end{equation}
The relaxation time $\tau$ is linked to the kinematic fluid viscosity $\nu$ by
\begin{equation}
  \nu=(\tau-\varDelta t/2)c_{\text{s}}^2.
\end{equation}
The equilibrium is defined as
\begin{dmath}
  f_q^{\text{eq}}(\rho_{\text{f}},\boldsymbol{U}_{\text{f}})=w_q\left(\rho_{\text{f}}+\rho_0 \left( \frac{\boldsymbol{c}_q \cdot \boldsymbol{U}_{\text{f}}}{c_{\text{s}}^2} + \frac{{(\boldsymbol{c}_q \cdot \boldsymbol{U}_{\text{f}})}^2}{2c_{\text{s}}^4} \\- \frac{\boldsymbol{U}_{\text{f}} \cdot \boldsymbol{U}_{\text{f}}}{2c_{\text{s}}^2} \right)\right)
\end{dmath}
for incompressible flows~\citep[][]{heLatticeBoltzmannModel1997} with $\rho_0=1$, the lattice weights $w_q$~\citep[][]{qianLatticeBGKModels1992}, and the lattice speed of sound $c_{\text{s}}=1/\sqrt{3}$. The cell-local quantities
\begin{equation}
  \rho_{\text{f}}(\boldsymbol{x},t)=\sum_q f_q(\boldsymbol{x},t),
\end{equation}
\begin{equation}
  \boldsymbol{U}_{\text{f}}(\boldsymbol{x},t)=\frac{1}{\rho_0}\sum_q f_q(\boldsymbol{x},t)\boldsymbol{c}_q+\frac{\varDelta t}{2\rho_0}\boldsymbol{f}^{\text{ext}}
\end{equation}
are calculated based on the moments of the \gls{pdfs}.
The forcing operator
\begin{equation}
  F_q(\boldsymbol{x},t)=\varDelta t w_q \left[\frac{\boldsymbol{c}_q-\boldsymbol{U}_{\text{f}}}{c_{\text{s}}^2} + \frac{\boldsymbol{c}_q\cdot\boldsymbol{U}_{\text{f}}}{c_{\text{s}}^4} \cdot\boldsymbol{c}_q\right]\cdot\boldsymbol{f}^{\text{ext}}
\end{equation}
can incorporate external forces using the constant force density $\boldsymbol{f}^{\text{ext}}$~\citep[][]{laddLatticeBoltzmannSimulationsParticleFluid2001}.

\subsection{Particle dynamics}
The behavior of the particles is modeled using the \gls{dem}~\citep[][]{cundallDiscreteNumericalModel1979}. The total force $\boldsymbol{F}_{\text{p},i}$ acting on a particle $i$ consists of the following modules
\begin{equation}
  \boldsymbol{F}_{\text{p},i}=\boldsymbol{F}_{\text{p},i}^{\text{col}}+\boldsymbol{F}_{\text{p},i}^{\text{hyd}}+\boldsymbol{F}_{\text{p},i}^{\text{ext}}.
\end{equation}
In addition to the hydrodynamic force $\boldsymbol{F}_{\text{p},i}^{\text{hyd}}$ and external forces $\boldsymbol{F}_{\text{p},i}^{\text{ext}}$ (e.g., gravity), the particle interactions exert forces $\boldsymbol{F}_{\text{p},i}^{\text{col}}$ on each other due to collisions. The equations of motion have to be integrated to simulate the particle movements.

\subsubsection{Particle interactions using the discrete element method}
The collision between particle $i$ and $j$ is modeled using a linear spring-dashpot model. The collision force $\boldsymbol{F}_{\text{p},i}^{\text{col}}$ and torque $\boldsymbol{T}_{\text{p},i}^{\text{col}}$ on particle $i$ are computed as
\begin{equation}
  \boldsymbol{F}_{\text{p},i}^{\text{col}}=\sum_{j,j \neq i}(\boldsymbol{F}_{ij,\text{n}}^{\text{col}}+\boldsymbol{F}_{ij,\text{t}}^{\text{col}}),
\end{equation}
\begin{equation}
  \boldsymbol{T}_{\text{p},i}^{\text{col}}=\sum_{j,j \neq i}(\boldsymbol{x}_{ij}^{\text{cp}}-\boldsymbol{x}_{\text{p},i})\times \boldsymbol{F}_{ij,\text{t}}^{\text{col}},
\end{equation}
where the normal part of the collision force $\boldsymbol{F}_{ij,\text{n}}^{\text{col}}$ acting on particle $i$ with position $\boldsymbol{x}_{\text{p},i}$ is computed as
\begin{equation}
  \boldsymbol{F}_{ij,\text{n}}^{\text{col}}=-k_{\text{n}}\delta_{ij,\text{n}}\boldsymbol{n}_{ij}-d_{\text{n}}\boldsymbol{U}_{ij,\text{n}}^{\text{cp}}.
\end{equation}
Here, $k_{\text{n}}$ and $d_{\text{n}}$ are the normal stiffness and damping coefficients, $\boldsymbol{n}_{ij}$ the normal vector, $\delta_{ij,\text{n}}$ is the penetration depth and $\boldsymbol{U}_{ij,\text{n}}^{\text{cp}}$ is the normal component of the relative velocity of the surface of the particle at the contact point $\boldsymbol{x}_{ij}^{\text{cp}}$.
The tangential part of the collision force
\begin{equation}
  \boldsymbol{F}_{ij,\text{t}}^{\text{col}}=-k_{\text{t}}\boldsymbol{\delta}_{ij,\text{t}}-d_{\text{t}}\boldsymbol{U}_{ij,\text{t}}^{\text{cp}}
\end{equation}
uses the tangential stiffness and damping coefficients $k_{\text{t}}$ and $d_{\text{t}}$ and $\boldsymbol{U}_{ij,\text{t}}^{\text{cp}}$ is the tangential component of the relative velocity of the surface of the particle at the contact point.
\begin{equation}
  \boldsymbol{\delta}_{ij,\text{t}}=\int_{t_i}^{t} \boldsymbol{U}_{ij,\text{t}}^{\text{cp}}(t')\text{d}t'
  \label{history_information}
\end{equation}
is the accumulated relative tangential motion between two particles where $t_i$ is the time step of the impact. For more details, see \citet{rettingerEfficientFourwayCoupled2022}.

%\begin{equation}
%  k_n=\frac{m_{ij,\text{eff}}(\pi^2+\ln^2e_{\text{dry}})}{T_C^2},
%\end{equation}
%
%\begin{equation}
%  d_n=-\frac{2*m_{ij,\text{eff}}\ln^2e_{\text{dry}}}{T_C},
%\end{equation}
%
%with the effective mass:
%
%\begin{equation}
%  m_{ij,eff}=\begin{cases}
%    \frac{m_{p,i}m_{p,j}}{m_{p,i}+m_{p,j}}, &\text{sphere-sphere}\\
%    m_{p,i}, &\text{sphere-wall}
%    \end{cases}
%\end{equation}

%We omit the explanation of the tangential part $\boldsymbol{F}_{ij,t}^{\text{col}}$ as the procedure is similar to $\boldsymbol{F}_{ij,n}^{\text{col}}$.

\subsubsection{Integration of the particle properties}\label{integration}
We update the particle's position and velocity by solving the Newton-Euler equations of motion using the Velocity Verlet integrator:
\begin{equation}
  \boldsymbol{x}_{\text{p},i}(t+\varDelta t_{\text{p}})=\boldsymbol{x}_{\text{p},i}(t)+\varDelta t_{\text{p}}\boldsymbol{U}_{\text{p},i}(t)+\frac{\varDelta t_{\text{p}}^2}{2m_{\text{p},i}}\boldsymbol{F}_{\text{p},i}(t),
  \label{pre_force_integration}
\end{equation}
\begin{dmath}
  \boldsymbol{U}_{\text{p},i}(t+\varDelta t_{\text{p}})=\boldsymbol{U}_{\text{p},i}(t)+\frac{\varDelta t_{\text{p}}}{2m_{\text{p},i}}(\boldsymbol{F}_{\text{p},i}(t)\\+\boldsymbol{F}_{\text{p},i}(t + \varDelta t_{\text{p}})),
  \label{post_force_integration}
\end{dmath}
where $m_{\text{p},i}$ is the mass of the particle $i$. $\boldsymbol{x}_{\text{p},i}(t+\varDelta t_{\text{p}})$ is computed at the beginning of each particle time step using the old force. Then, the new force $\boldsymbol{F}_{\text{p},i}(t + \varDelta t_{\text{p}})$ is computed using the updated position. At the end of the time step, the particle velocity $\boldsymbol{U}_{\text{p},i}(t+\varDelta t_{\text{p}})$ is computed using the updated force. Updating the angular velocity is done analogously.

\subsection{Fully resolved fluid-particle coupling method}\label{psm}
The task of the coupling is to perform momentum exchange between the fluid and the solid phase. % Prominent examples are the momentum exchange method~\cite{laddNumericalSimulationsParticulate1994}, the \gls{psm}~\cite{nobleLatticeBoltzmannMethodPartially1998} and the immersed boundary method~\cite{fengImmersedBoundarylatticeBoltzmann2004}.
We use the \gls{psm} for the fully resolved fluid-particle coupling~\citep[][]{nobleLatticeBoltzmannMethodPartially1998}. It modifies the \gls{lbm} collision step from \cref{collision} by introducing the solid volume fraction $B(\boldsymbol{x},t)$ resulting in
\begin{equation}
  \widetilde{f_q}(\boldsymbol{x},t)=f_q(\boldsymbol{x},t)+C_q^{\text{PSM}}(\boldsymbol{x},t)+(1-B(\boldsymbol{x},t))F_q(\boldsymbol{x},t),
  \label{psm_equation}
\end{equation}
where $B(\boldsymbol{x},t)$ is the fraction of the fluid cell $\boldsymbol{x}$ being (partly) covered by one or more particles. \cref{particle_mapping} explains this solid volume fraction computation in detail. The modified collision operator $C_q^{\text{PSM}}$ used in \cref{psm_equation} is defined as
\begin{dmath}
  C_q^{\text{PSM}}(\boldsymbol{x},t)=(1-B(\boldsymbol{x},t))C_q^{\text{SRT}}(\boldsymbol{x},t)\\+\sum_{I} B_i(\boldsymbol{x},t)C_{q,i}^{\text{solid}}(\boldsymbol{x},t).
\end{dmath}
$C_q^{\text{SRT}}$ is the \gls{lbm} collision operator described in \cref{srt_collision}. $B(\boldsymbol{x},t)$ is the sum over the individual overlap fractions $B_i(\boldsymbol{x},t)$ of all particles $I$. If $B(\boldsymbol{x},t) > 1$, it is normalized to 1. This situation can occur if colliding particles are allowed to overlap during contact. Then a single fluid cell can even be entirely covered by two particles, i.e., $B(\boldsymbol{x},t) = 2$.
The solid collision operator
\begin{dmath}
  C_{q,i}^{\text{solid}}(\boldsymbol{x},t)=[f_{\bar{q}}(\boldsymbol{x},t)-f_{\bar{q}}^{\text{eq}}(\rho_{\text{f}},\boldsymbol{U}_{\text{f}})]-[f_q(\boldsymbol{x},t)\\-f_q^{\text{eq}}(\rho_{\text{f}},\boldsymbol{U}_{\text{p},i}(\boldsymbol{x},t))]
\end{dmath}
acts when particles intersect with a cell.
There exist different variants of the solid collision operator.
$f_{\bar{q}}$ corresponds to the inverse lattice velocity of $f_q$.\newline
$\boldsymbol{U}_{\text{p},i}(\boldsymbol{x},t)$ is the velocity of particle $i$ evaluated at the cell center $\boldsymbol{x}$ and is computed as
\begin{equation}
  \boldsymbol{U}_{\text{p},i}(\boldsymbol{x}_i,t)=\boldsymbol{U}_{\text{p},i}(t)+\boldsymbol{\Omega}_{\text{p},i}(t) \times (\boldsymbol{x}_i-\boldsymbol{x}_{\text{p},i}(t)),
  \label{vel_at_cell_center}
\end{equation}
with the translational particle velocity $\boldsymbol{U}_{\text{p},i}(t)$, the rotational particle velocity ${\boldsymbol{\Omega}}_{\text{p},i}(t)$ and the particle center of gravity $\boldsymbol{x}_{\text{p},i}(t)$. $\boldsymbol{x}_i$ are the cell centers of all cells intersecting with the particle.\newline
So far, we have only considered the influence of the particles on the fluid. However, the fluid also influences the particles through hydrodynamic forces. We compute the force $\boldsymbol{F}_{\text{p},i}^{\text{fp}}(t)$ and torque $\boldsymbol{T}_{\text{p},i}^{\text{fp}}(t)$ exerted by the fluid on particle $i$ as
\begin{equation}
  \boldsymbol{F}_{\text{p},i}^{\text{fp}}(t)=\frac{{(\varDelta x)}^3}{\varDelta t}\sum_{\boldsymbol{x_i}}[B_i(\boldsymbol{x}_i,t)\sum_q (C_{q,i}^{\text{solid}}(\boldsymbol{x}_i,t)\boldsymbol{c}_{\bar{q}})],
  \label{hydrodynamic_force}
\end{equation}
\begin{dmath}
  \boldsymbol{T}_{\text{p},i}^{\text{fp}}(t)=\frac{{(\varDelta x)}^3}{\varDelta t}\sum_{\boldsymbol{x_i}}[B_i(\boldsymbol{x}_i,t)(\boldsymbol{x}_i-\boldsymbol{x}_{\text{p},i})\\\times\sum_q (C_{q,i}^{\text{solid}}(\boldsymbol{x}_i,t)\boldsymbol{c}_{\bar{q}})].\label{hydrodynamic_torque}
\end{dmath}

\subsubsection{Lubrication correction}\label{lubrication_correction}
The lubrication force and torque act on two particles approaching each other.
The two particles squeeze out the fluid inside the gap, which exerts a force in the opposite direction of the relative motion.
However, this effect would only be covered correctly by the fluid-particle coupling for a very fine grid resolution which is computationally too expensive.
As the lubrication force has a significant influence, we compute lubrication correction force terms to compensate for the inability of the coupling method to represent these forces correctly.
We compute lubrication correction terms due to normal- and tangential translations and rotations.
Therefore, the total hydrodynamic force $\boldsymbol{F}_{\text{p},i}^{\text{hyd}}$ and torque $\boldsymbol{T}_{\text{p},i}^{\text{hyd}}$ is a sum of the force from the fully resolved fluid-particle coupling method (\cref{psm}), and the lubrication correction
\begin{equation}
  \boldsymbol{F}_{\text{p},i}^{\text{hyd}}=\boldsymbol{F}_{\text{p},i}^{\text{fp}}+\boldsymbol{F}_{\text{p},i}^{\text{lub,cor}},
\end{equation}
\begin{equation}
  \boldsymbol{T}_{\text{p},i}^{\text{hyd}}=\boldsymbol{T}_{\text{p},i}^{\text{fp}}+\boldsymbol{T}_{\text{p},i}^{\text{lub,cor}}.
\end{equation}
For details on how to compute the lubrication correction, see~\citet{rettingerEfficientFourwayCoupled2022}.

%For two particles $i$ and $j$ with radii $R_{p,i}$ and $R_{p,j}$, the lubrication correction for the normal translation on particle i can be computed as follows:
%
%\begin{equation}
%  \boldsymbol{F}_{ij,n}^{\text{lub,cor}}=-6 \pi \mu_f R_{p,i}^2 \lambda (\delta_{ij,n},\delta_{n,\text{cut}}^{\text{lub}})\frac{\kappa_r^2}{{(1+\kappa_r)}^2}(\frac{1}{\delta_n^{\text{lub}}}-\frac{1}{\delta_{n,\text{cut}}^{\text{lub}}})\boldsymbol{u}_{ij,n},
%\end{equation}
%
%with the fluid viscosity $\mu_f$, the radius ratio $\kappa_r=R_{p,j}/R_{p,i}$ and the normal relative particle velocity $\boldsymbol{u}_{ij,n}$ and the step function:
%
%\begin{equation}
%  \lambda(\delta_{ij,n},\delta_{\text{cut}}^{\text{lub}})=\begin{cases}
%    1, &0<\delta_{ij,n}<\delta_{\text{cut}}^{\text{lub}},\\%TODO: mÃ¼sste es hier nicht auch \delta_{n,\text{cut}}^{\text{lub}} sein?
%    0, &\text{otherwise},
%    \end{cases}
%\end{equation}
%
%which disables the lubrication correction if the gap size $\delta_{ij,n}$ is smaller than $\delta_{\text{cut}}^{\text{lub}}$. The constrainted gap size $\delta_n^{\text{lub}%}$ is defined as: 
%
%\begin{equation}
%  \delta_n^{\text{lub}}=\max(\delta_{ij,n},\delta_{n,\min}^{\text{lub}}).
%\end{equation}
%
%It enforces the constrained gap size to be bigger than $\delta_{n,\min}^{\text{lub}}$, which avoids a division by 0. Since the lubrication correction forces and torques due to tangential translation and rotation are similar, we omit their description. For more details, see~\cite{rettingerEfficientFourwayCoupled2022}.
%

\subsubsection{Particle mapping}\label{particle_mapping}
A coupled fluid-particle simulation using the \gls{psm} requires the computation of the solid volume fraction $B_i(\boldsymbol{x},t)$ (\cref{psm}), i.e., the fraction of a fluid cell $\boldsymbol{x}$ being (partly) covered by a particle $i$. We restrict ourselves to spherical particles. \citet{jonesFastComputationAccurate2017} tackle the problem that, in general, no unique analytical solution exists to compute this overlapping fraction for spheres and cells/cubes. They propose a linear approximation derived from the analytical solution for a specific cell orientation relative to the particle surface. Grid cells with the dimensionless edge size 1 (as it is typically the case for the \gls{lbm}) are assumed in the following.
\begin{figure}
  \centering
  \input{figures/linear_approximation.tex}
  \caption{
        The linear approximation yields the analytical solution for the blue cells. The particle is represented by the orange circle. Note that the grid is coarsened for better clarity.
    }\label{fig:linear_approximation}
\end{figure}
In \cref{fig:linear_approximation}, the overlap fraction $\epsilon$ between the upper blue lattice cell and the orange particle is computed as
\begin{equation}
  \epsilon=V_i=V_a-V_b=V_a-(D+r-1/2),
\end{equation}
where $V_a$ is the union of $V_i$ and $V_b$. $D$ is the distance from the cell center to the sphere surface (negative if the cell center lies inside the sphere). There is a cell-particle overlap if $\epsilon \in \interval[open left]{0}{1}$. We can reformulate this as
\begin{equation}
  \epsilon=V_a-(D+r-1/2)=-D+f(r),
\end{equation}
where $f(r)=V_a-r+1/2$ only depends on the particle radius $r$ and therefore is constant for each particle respectively.
$V_a$ is computed as
\begin{dmath}
  V_a=\int_{-1/2}^{1/2}\int_{-1/2}^{1/2} \sqrt{r^2-x^2-y^2} \text{d}x \text{d}y= (1/12-r^2)\tan^{-1} (\frac{\frac{1}{2}\sqrt{{r^2}-1/2}}{1/2-r^2})+\frac{1}{3}\sqrt{{r^2}-1/2}\\
  + (r^2- 1/12)\tan^{-1} (\frac{1/2}{\sqrt{{r^2}-1/2}})\\-\frac{4}{3}r^3\tan^{-1} (\frac{1/4}{r\sqrt{{r^2}-1/2}}).
\end{dmath}
This approximation yields accurate results also for arbitrary cell orientations and is more computationally efficient than contemporary techniques like sub-division sampling \citep[][]{jonesFastComputationAccurate2017}.
