\small
\caption{\small D3DP Training 
}
\label{alg:train}
\algcomment{\fontsize{7.2pt}{0em}\selectfont \texttt{\emph{alpha\_cumprod}(t)}: cumulative product of $\alpha_i$, \ie, $\prod_{i=1}^t \alpha_i$
}
\definecolor{codeblue}{rgb}{0.25,0.5,0.5}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codekw}{RGB}{207,33,46}
\lstset{
  backgroundcolor=\color{white},
  basicstyle=\fontsize{7.5pt}{7.5pt}\ttfamily\selectfont,
  columns=fullflexible,
  breaklines=true,
  captionpos=b,
  commentstyle=\fontsize{7.5pt}{7.5pt}\color{codegreen},
  keywordstyle=\fontsize{7.5pt}{7.5pt}\color{codekw},
  escapechar={|}, 
}
\begin{lstlisting}[language=python, aboveskip=3pt, belowskip=3pt, emph={alpha_cumprod},emphstyle={\emph}]
def training_loss(2dp, 3dp_gt, T):
  # 2dp: [B, N, J, 2], 3dp_gt: [B, N, J, 3]
  # T: maximum number of timesteps
  # B: batch size, N: frame count, J: joint count

  # Signal scaling
  3dp_gt = 3dp_gt * scale  

  # Corrupt 3dp_gt
  t = randint(0, T)|~~~~~~~~~~~~~|# timestep
  noise = normal(mean=0, std=1)  # noise: [B, N, J, 3]
  alpha_cp = alpha_cumprod(t)
  3dp_crpt = sqrt(|~~~~|alpha_cp) * 3dp_gt + 
              |~~|sqrt(1 - alpha_cp) * noise

  # Denoise using a 3d pose estimator as backbone
  3dp_pred = denoiser(3dp_crpt, 2dp, t)

  # Set regression loss
  loss = MSE(3dp_pred, 3dp_gt)
  
  return loss
\end{lstlisting}