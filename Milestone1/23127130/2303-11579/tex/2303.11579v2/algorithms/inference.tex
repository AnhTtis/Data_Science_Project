\small
\caption{\small D3DP Inference 
}
\label{alg:sample}
\algcomment{\fontsize{7.2pt}{0em}\selectfont \texttt{\emph{linespace}}: generate evenly spaced values
}
\definecolor{codeblue}{rgb}{0.25,0.5,0.5}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codekw}{rgb}{0.85, 0.18, 0.50}
\lstset{
  backgroundcolor=\color{white},
  basicstyle=\fontsize{7.5pt}{7.5pt}\ttfamily\selectfont,
  columns=fullflexible,
  breaklines=true,
  captionpos=b,
  commentstyle=\fontsize{7.5pt}{7.5pt}\color{codegreen},
  keywordstyle=\fontsize{7.5pt}{7.5pt}\color{codekw},
  escapechar={|}, 
  escapeinside={<@}{@>}
}

%\setlength{\belowcaptionskip}{-10pt}
\begin{lstlisting}[language=python, aboveskip=3pt, belowskip=3pt, emph={linespace},emphstyle={\emph}]
def inference(2dp, T, K, H):
  # 2dp: [B, N, J, 2], T: maximum number of timesteps
  # K, H: number of iterations and hypotheses
  
  # Initialize noisy 3d poses: [B, H, N, J, 3] 
  3dp_t = normal(mean=0, std=1)

  # Sample timesteps uniformly
  times = reversed(linespace(0, T, K + 1))
  
  # [(T*(1-k/K), T*(1-(k+1)/K))], k = 0,...,K-1
  time_pairs = list(zip(times[:-1], times[1:])

  for t_now, t_next in zip(time_pairs):   
    # Predict 3dp_0 from 3dp_t
    3dp_0 = denoiser(3dp_t, 2dp, t_now)

    # Diffusion flipping
    # Data augmentation using horizontal flipping
    if augment:
      2dp_hf = horiz_flipping(2dp)
      3dp_t_hf = horiz_flipping(3dp_t)
      3dp_0_hf = denoiser(3dp_t_hf, 2dp_hf, t_now)
      3dp_0 = (3dp_0 + horiz_flipping(3dp_0_hf)) / 2
    
    # Estimate 3dp_t at t_next
    3dp_t = ddim_step(3dp_t, 3dp_0, t_now, t_next)
    
  return 3dp_0
\end{lstlisting}


%\vspace{-10pt}
%<@\textcolor{codekw}{}

% latex
% \small
% \caption{\small D3DP Inference 
% }
% \label{alg:sample}
% \algcomment{\fontsize{7.2pt}{0em}\selectfont \texttt{linespace}: generate evenly spaced values
% }
% \definecolor{codeblue}{rgb}{0.25,0.5,0.5}
% \definecolor{codegreen}{rgb}{0,0.6,0}
% \definecolor{codekw}{rgb}{0.85, 0.18, 0.50}
% \lstset{
%   backgroundcolor=\color{white},
%   basicstyle=\fontsize{7.5pt}{7.5pt}\ttfamily\selectfont,
%   columns=fullflexible,
%   breaklines=true,
%   captionpos=b,
%   commentstyle=\fontsize{7.5pt}{7.5pt}\color{codegreen},
%   keywordstyle=\fontsize{7.5pt}{7.5pt}\color{codekw},
%   escapechar={|}, 
% }
% \begin{lstlisting}[language=python]
% def infer(pose_2d, K, T):

%   # data augmentation using horizontal flipping
%   pose_2d_flip = flipping(pose_2d)
%   return 0
% \end{lstlisting}

%\linespread{0.5}
