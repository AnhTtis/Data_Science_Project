
\documentclass{article} % For LaTeX2e
\usepackage{iclr2023/iclr2023_conference,times}

% Optional math commands from https://github.com/goodfeli/dlbook_notation.
\input{math_commands.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%     packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{packages.tex}

\let\labelindent\relax
% 
\usepackage{enumitem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%     newcommands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% utils
\makeatletter
\newcommand{\printfnsymbol}[1]{%
  \textsuperscript{\@fnsymbol{#1}}%
}

\newcommand{\ycReb}[1]{\textcolor{black}{{#1}}}
\newcommand{\ycCITE}[1]{\textcolor{cyan}{[CITE: {#1}]}}
\newcommand{\ycREF}[1]{\textcolor{blue}{[REFER: {#1}]}}
\newcommand{\ycMOD}[1]{\textcolor{green}{ycMOD: #1}}
\newcommand{\ycSUG}[1]{\textcolor{magenta}{ycSUGGEST: #1}}
\newcommand{\hongyi}[1]{\textcolor{black}{#1}}
\newcommand{\fix}{\marginpar{FIX}}
\newcommand{\new}{\marginpar{NEW}}


\newcommand{\netName}{LEAP\xspace}

\newcommand{\st}{\mathbf{s}_t}
\newcommand{\stp}{\mathbf{s}_{t+1}}
\newcommand{\stpp}{\mathbf{s}_{t+2}}
\newcommand{\at}{\mathbf{a}_t}
\newcommand{\atp}{\mathbf{a}_{t+1}}
\newcommand{\atpp}{\mathbf{a}_{t+2}}
\newcommand{\bs}{\mathbf{s}}
\newcommand{\ba}{\mathbf{a}}
\newcommand{\br}{\mathbf{r}}
\newcommand{\bz}{\mathbf{z}}
\newcommand{\bx}{\mathbf{x}}
\newcommand{\btau}[1]{\bm{\tau}^{#1}}
%\newcommand{\btau}[1][{}]{\bm{\tau}^{#1}}
\newcommand{\opt}{\mathcal{O}}
\newcommand{\bopt}{\bm{\mathcal{O}}}
\newcommand\undermat[2]{%
  \makebox[0pt][l]{$\smash{\underbrace{\phantom{%
    \begin{matrix}#2\end{matrix}}}_{\text{$#1$}}}$}#2}
\def\NoNumber#1{{\def\alglinenumber##1{}\STATE #1}\addtocounter{ALG@line}{-1}}
\def\x{\mathbf{x}}
\newcommand{\expect}[2]{\mathbb{E}_{#1} \left[ #2 \right] }
\newcommand{\te}[1]{\texttt{#1}}

\newcommand{\Hrz}{T}
\newcommand{\DataNum}{M}
\newcommand{\IterNum}{N}
\newcommand{\idSet}{I}

\newcommand{\enModel}{E}
\newcommand{\mParam}{\theta}
\input{macros.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%     Get started
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Planning with \hongyi{Sequence} Models through Iterative Energy Minimization}

% Authors must not appear in the submitted version. They should be hidden
% as long as the \iclrfinalcopy macro remains commented out below.
% Non-anonymous submissions will be rejected without review.

\author{
\qquad Hongyi Chen\thanks{\fontsize{6}{7} denotes equal contribution. Correspondence to \texttt{hchen657@gatech.edu},\texttt{ yilundu@mit.edu}, \texttt{yychen2019@gatech.edu}}\;\;\printfnsymbol{2}, ~Yilun Du \printfnsymbol{1}\printfnsymbol{3}, ~Yiye Chen\printfnsymbol{1}\printfnsymbol{2}, ~Joshua Tenenbaum\printfnsymbol{3}, ~Patricio Vela\printfnsymbol{2}\\
\qquad\qquad~Georgia Institute of Technology\printfnsymbol{2}\qquad ~Massachusetts Institute of Technology\printfnsymbol{3}\\
}

% The \author macro works with any number of authors. There are two commands
% used to separate the names and addresses of multiple authors: \And and \AND.
%
% Using \And between authors leaves it to \LaTeX{} to determine where to break
% the lines. Using \AND forces a linebreak at that point. So, if \LaTeX{}
% puts 3 of 4 authors names on the first line, and the last on the second
% line, try using \AND instead of \And before the third author name.


%\iclrfinalcopy % Uncomment for camera-ready version, but NOT for submission.
\begin{document}


\maketitle

\begin{abstract}
Recent works have shown that \hongyi{sequence} modeling can be effectively used to train reinforcement learning (RL) policies.  
However, the success of applying existing sequence models to planning, 
in which we wish to obtain a trajectory of actions to reach some goal,
is less straightforward. 
The typical autoregressive generation procedures of \hongyi{sequence} models preclude sequential refinement of earlier steps, which limits the effectiveness of a predicted plan. 
In this paper, we suggest an approach towards integrating planning with \hongyi{sequence} models based on the idea of iterative energy minimization, and illustrate how such a procedure leads to improved RL performance across different tasks.
We train a masked language model to capture an implicit energy function over trajectories of actions, 
and formulate planning as finding a trajectory of actions with minimum energy. 
We illustrate how this procedure enables improved performance over recent approaches across BabyAI and Atari environments. 
We further demonstrate unique benefits of our iterative optimization procedure,
involving new task generalization, test-time constraints adaptation, and the ability to compose plans together. Project website: \href{https://hychen-naza.github.io/projects/LEAP/index.html}{https://hychen-naza.github.io/projects/LEAP}.

% enabling us to generalize to harder tasks at test time, as well as to adapt to novel test-time constraints.

% effective online task adaptation and generalization to harder tasks at test time. 

% Many previous works integrate reinforcement learning (RL) with widely used language models for generic sequence modeling tasks. However, existing approaches typically rely on

% But usually they rely on autoregressive decoding which prevents iterative refinement and planning and often have poor long-horizon accuracy due to compounding errors. In this paper, we present a principled approach towards iterative planning with language model based on the idea of energy minimization. We adopt masked language modeling as our energy models and draw action samples from the masked locations conditioned on the surrounding context. The iterative refining process will reject the action samples with high energy values according to the energy model and optimized the planned action sequence. 

% We validate the effectiveness of the proposed framework on sequence decision making problems including Atari, Babyai and Graph-walking that involve reward-sparse tasks and high-dimensional observation inputs. Moreover, we explore its unusual and useful properties in test-time flexibility and generalization.

\end{abstract}

%%%% introduction
\input{intro}

%%%% related works
\input{rlt}

%%%% method
\input{method}
\input{properties}

%%%% experiments
\input{exp}

\input{expBaby}
\input{figs/figBaby_full}
\input{figs/figAnls_Baby}



\input{expAtari}
% \input{figs/figAnls_Atari}
\input{figs/atari_results_figTab}
% \input{figs/suboptimal}




%%%% experiments
\input{discussion}




%%%% Conclusion
\input{con}

\begin{comment}

\subsection{Footnotes}

Indicate footnotes with a number\footnote{Sample of the first footnote} in the
text. Place the footnotes at the bottom of the page on which they appear.
Precede the footnote with a horizontal rule of 2~inches
(12~picas).\footnote{Sample of the second footnote}

\subsection{Figures}

All artwork must be neat, clean, and legible. Lines should be dark
enough for purposes of reproduction; art work should not be
hand-drawn. The figure number and caption always appear after the
figure. Place one line space before the figure caption, and one line
space after the figure. The figure caption is lower case (except for
first word and proper nouns); figures are numbered consecutively.

Make sure the figure caption does not get separated from the figure.
Leave sufficient space to avoid splitting the figure and figure caption.

You may use color figures.
However, it is best for the
figure captions and the paper body to make sense if the paper is printed
either in black/white or in color.
\begin{figure}[h]
\begin{center}
%\framebox[4.0in]{$\;$}
\fbox{\rule[-.5cm]{0cm}{4cm} \rule[-.5cm]{4cm}{0cm}}
\end{center}
\caption{Sample figure caption.}
\end{figure}

\subsection{Tables}

All tables must be centered, neat, clean and legible. Do not use hand-drawn
tables. The table number and title always appear before the table. See
Table~\ref{sample-table}.

Place one line space before the table title, one line space after the table
title, and one line space after the table. The table title must be lower case
(except for first word and proper nouns); tables are numbered consecutively.

In an attempt to encourage standardized notation, we have included the
notation file from the textbook, \textit{Deep Learning}
\cite{goodfellow2016deep} available at
\url{https://github.com/goodfeli/dlbook_notation/}.  Use of this style
is not required and can be disabled by commenting out
\texttt{math\_commands.tex}.


\centerline{\bf Numbers and Arrays}
\bgroup
\def\arraystretch{1.5}
\begin{tabular}{p{1in}p{3.25in}}
$\displaystyle a$ & A scalar (integer or real)\\
$\displaystyle \va$ & A vector\\
$\displaystyle \mA$ & A matrix\\
$\displaystyle \tA$ & A tensor\\
$\displaystyle \mI_n$ & Identity matrix with $n$ rows and $n$ columns\\
$\displaystyle \mI$ & Identity matrix with dimensionality implied by context\\
$\displaystyle \ve^{(i)}$ & Standard basis vector $[0,\dots,0,1,0,\dots,0]$ with a 1 at position $i$\\
$\displaystyle \text{diag}(\va)$ & A square, diagonal matrix with diagonal entries given by $\va$\\
$\displaystyle \ra$ & A scalar random variable\\
$\displaystyle \rva$ & A vector-valued random variable\\
$\displaystyle \rmA$ & A matrix-valued random variable\\
\end{tabular}
\egroup
\vspace{0.25cm}

\centerline{\bf Sets and Graphs}
\bgroup
\def\arraystretch{1.5}

\begin{tabular}{p{1.25in}p{3.25in}}
$\displaystyle \sA$ & A set\\
$\displaystyle \R$ & The set of real numbers \\
$\displaystyle \{0, 1\}$ & The set containing 0 and 1 \\
$\displaystyle \{0, 1, \dots, n \}$ & The set of all integers between $0$ and $n$\\
$\displaystyle [a, b]$ & The real interval including $a$ and $b$\\
$\displaystyle (a, b]$ & The real interval excluding $a$ but including $b$\\
$\displaystyle \sA \backslash \sB$ & Set subtraction, i.e., the set containing the elements of $\sA$ that are not in $\sB$\\
$\displaystyle \gG$ & A graph\\
$\displaystyle \parents_\gG(\ervx_i)$ & The parents of $\ervx_i$ in $\gG$
\end{tabular}
\vspace{0.25cm}


\centerline{\bf Indexing}
\bgroup
\def\arraystretch{1.5}

\begin{tabular}{p{1.25in}p{3.25in}}
$\displaystyle \eva_i$ & Element $i$ of vector $\va$, with indexing starting at 1 \\
$\displaystyle \eva_{-i}$ & All elements of vector $\va$ except for element $i$ \\
$\displaystyle \emA_{i,j}$ & Element $i, j$ of matrix $\mA$ \\
$\displaystyle \mA_{i, :}$ & Row $i$ of matrix $\mA$ \\
$\displaystyle \mA_{:, i}$ & Column $i$ of matrix $\mA$ \\
$\displaystyle \etA_{i, j, k}$ & Element $(i, j, k)$ of a 3-D tensor $\tA$\\
$\displaystyle \tA_{:, :, i}$ & 2-D slice of a 3-D tensor\\
$\displaystyle \erva_i$ & Element $i$ of the random vector $\rva$ \\
\end{tabular}
\egroup
\vspace{0.25cm}

\end{comment}

\bibliography{iclr2023_conference}
\bibliographystyle{iclr2023/iclr2023_conference}

% \section{Appendix

\newpage

\input{app}



\end{document}
