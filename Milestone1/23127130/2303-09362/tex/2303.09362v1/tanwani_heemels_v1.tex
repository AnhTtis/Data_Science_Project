\documentclass[journal]{IEEEtran}

%\documentclass[9pt,technote]{IEEEtran}
 

\usepackage[cmex10]{amsmath}
\usepackage{amsthm}
\usepackage{mathrsfs}
\usepackage{empheq}
\usepackage{tikz}

\usepackage{amssymb}
\usepackage{txfonts}
\let\labelindent\relax
\usepackage{enumitem}
\usepackage{dsfont,citesort}
%\usepackage[usenames, dvipsnames]{color} 
\usepackage{tikz}
\usetikzlibrary{automata, positioning}
\usepackage{subfig,enumerate}
\usepackage{mathtools}
\allowdisplaybreaks
\setlength{\parskip}{1ex}


%======================================================
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
%\theoremstyle{remark}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{objective}[theorem]{Objective}
\newtheorem{prob}[theorem]{Problem}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{convention}[theorem]{Convention}


%=================================================

%\numberwithin{equation}{section}
%=================================================
%\newcommand{\subN}{N_1}
%\newcommand{\ree}{\mathbb{R}}
%\newcommand{\Real}{\mathbb{R}}
%\newcommand{\Nat}{\mathbb{N}}
%\newcommand{\nat}{\mathbb{N}}
%\newcommand{\Mc}{\mathcal{M}_c}
%\newcommand{\Md}{\mathcal{M}_d}
%
%\newcommand{\cN}{{\mathcal N}}
\newcommand{\cC}{{\mathcal C}}
\newcommand{\cE}{{\mathcal E}}
\newcommand{\cK}{{\mathcal K}}
\newcommand{\cS}{{\mathcal S}}
\newcommand{\R}{\mathbb{R}}
%\newcommand{\cV}{{\mathcal V}}
%\newcommand{\cK}{{\mathcal K}}
%\newcommand{\cG}{{\mathcal G}}
%\newcommand{\cH}{{\mathcal H}}
%\newcommand{\cA}{{\mathcal A}}
%\newcommand{\miet}{\underline{T}}


\include{commands}


\allowdisplaybreaks

%==============================================================================

\usepackage{url}

\hyphenation{}


\begin{document}

\title{Well-posedness of Partially and Oblique Projected Dynamical Systems}

\author{ W.P.M.H. Heemels and A. Tanwani  %
            %} %

\thanks{Maurice Heemels is with the Control Systems Technology Group, Department of Mechanical Engineering, Eindhoven University of Technology, P. O. Box 513, 5600 MB Eindhoven, The Netherlands. Email: \texttt{m.heemels@tue.nl}}
\thanks{{Aneel Tanwani is with CNRS -- LAAS, University of Toulouse, CNRS, Toulouse.}}
\thanks{Maurice Heemels is supported by the ERC Advanced Grant PROACTHIS.}%%
}



\maketitle

\begin{abstract}
\end{abstract}
	

\begin{IEEEkeywords}
	Extended PDS, sweeping process, hybrid integrator, 
\end{IEEEkeywords}

\IEEEpeerreviewmaketitle


%=============================================================================
\section{HIGS}
The general form of the hybrid integrator, extending the description of HIGS in \cite{DeeSha_AUT21a}, is mathematically formulated as the scalar-state switched nonlinear system 
\begin{subequations}\label{eq:H}
    \begin{empheq}[left={\mathcal{H}:\empheqlbrace\,}]{align}
      \dot{x}_h  &= f(x_h,e),\hphantom{k_hz} \textup{ if } \left(e, u, \dot{e}\right) \in \mathcal{F}_1, \label{eq:H2_integrator_mode}\\
{x}_h &= k_h e,\hphantom{f(x_h,z)} \textup{ if } \left(e, u, \dot{e}\right) \in \mathcal{F}_2,\label{eq:H2_gain_mode}\\
u &= x_h,
    \end{empheq}
\end{subequations}
with state $x_h(t)\in\mathbb{R}$, input $e(t)\in\mathbb{R}$, output $u(t) \in \mathbb{R}$  at time $t \in \mathbb{R}_{\geq 0}$, and where $f: \mathbb{R} \times \mathbb{R} \to \mathbb{R}$ is a nonlinear function. Here,  $\dot{e}$ denotes the time-derivative. The flow sets $\mathcal{F}_1$ and $\mathcal{F}_2$ dictating the active mode in \eqref{eq:H} are given by
\begin{subequations}\label{eq:Fsets}
\begin{align}
\mathcal{F}_1 & := \left\{(e,u,\dot{e}) \in \mathbb{R}^3 \mid  e u   \geq \frac{u^2}{k_h} \wedge (e,u,\dot{e})\not \in \mathcal{F}_2 \right\}, \label{eq:F1}\\
\mathcal{F}_2 & := \left\{(e,u,\dot{e}) \in \mathbb{R}^3 \mid u = k_h e \wedge f(x_h,e)e > k_h \dot{e} e  \right\} \label{eq:F2}
\end{align}
\end{subequations}
of which the union forms the $[0,k_h]$-sector defined as
\begin{equation}\label{eq:F}
\mathcal{F} := \mathcal{F}_1 \cup \mathcal{F}_2 = \left\{(e,u,\dot{e}) \in \mathbb{R}^3 \mid eu \geq \frac{u^2}{k_h}, \dot{e} \in \mathbb{R}\right\}.
\end{equation}
The sets $\mathcal{F}_1$ and $\mathcal{F}_2$ in \eqref{eq:Fsets} define regions where $\mathcal{H}$ operates in either a \emph{dynamic mode} or a \emph{static mode}. The {dynamic} mode is referred to as `integrator-mode', since, essentially, the state value $x_h$ is obtained from integration. The {static} mode is soemtimes referred to as `gain-mode'. Note that the definition of the set $\mathcal{F}$ in \eqref{eq:F} shows the input-output pair $(z,u)$ of the hybrid integrator in \eqref{eq:H} to have an equivalent sign at all times, which may benefit transient properties of a closed-loop system. For a further motivation of the sets in \eqref{eq:Fsets}, along with a visualization, the reader is referred to \cite[Section 3]{DeeSha_AUT21a}. 

Note that \eqref{eq:H2_gain_mode} is in the form of a (differential) algebraic equation. We could replace this by an ODE, which then turns
\eqref{eq:H}
into \begin{subequations}\label{eq:H'}
    \begin{empheq}[left={\mathcal{H}:\empheqlbrace\,}]{align}
      \dot{x}_h  &= f(x_h,e),\hphantom{k_hz} \textup{ if } \left(e, u, \dot{e}\right) \in \mathcal{F}_1, \label{eq:H2_integrator_mode'}\\
\dot {x}_h &= k_h \dot e,\hphantom{f(x_h,z)} \textup{ if } \left(e, u, \dot{e}\right) \in \mathcal{F}_2,\label{eq:H2_gain_mode'}\\
u &= x_h,
    \end{empheq}
\end{subequations}
directly revealing also the dependence of the right-hand sides on $\dot e$ (in the gain mode).

Concerning the vector field in \eqref{eq:H2_integrator_mode}, the following assumptions are made.

\begin{assumption}\label{ass:0}
The function $f$ in \eqref{eq:H} satisfies $f(0,0) = 0$, and $f(0,e)e \geq 0$ for all $e \in \mathbb{R}$. 
\end{assumption}


\section{Open-loop formulation of projection-based controllers: HIGS as sweeping process}

\subsection{Sweeping process}
Let us first consider the classical HIGS in which $f(x_h,e)=e$. We can write this as the {\em sweeping process} [REF], where we use  that the normal cone for a given set $K\subseteq \ree^n$ at  $x\in K$ is defined as  \begin{equation}
    N_K(x) = \{ s \in \ree^n \mid \langle s \mid k-x \rangle \leq 0 \text{ for all } k \in K\}.
\end{equation} 
In case $x\not\in K$ then $N_K(x)$ is defined as the empty set.

We assume $e$ is given as a function of time.

\begin{subequations} \label{eq:sp}
\begin{eqnarray}
 \dot{x}_h  & \in &  \underbrace{f(x_h,e(t))}_{\bar f(x_h,t)} - N_{\bar S(t)}(x_h)  \label{eq:sp1}  \\
 x_h(t) & \in & \bar S(t)\label{eq:sp2}
\end{eqnarray}
\end{subequations}
%{\bf MAURICE: when we take $f$ more general we get $\dot{x}_h  =  f(x_h,e(t)) - N_{\bar S(t)}(x_h)$ -- does this fall in standard Sweeping process literature too -- well-posedness, etc. ??? maybe immediately generalise to first order projection elements [FOPE] and more. 
%}
with
\begin{equation}
\bar S(t) = \{ x_h \in \ree \mid (e(t),x_h) \in S \}
\end{equation}
and $S$ is the sector corresponding to $\mathcal{F}$ defined by 
\begin{equation}
 S=   \left\{(e,u) \in \mathbb{R}^2 \mid eu \geq \frac{u^2}{k_h}\right\}.
\end{equation}

\subsection{Equivalence of HIGS and SP}

Indeed, note that 
\begin{equation}
    \bar S(t) = \begin{cases}
        [0, k_h e(t)], & \text{when } e(t) \geq 0,\\
         [k_h e(t),0], & \text{when } e(t) \leq 0,
    \end{cases}
\end{equation}
which are convex sets (in fact, closed intervals of the real line) for each $t$. 

Note that 
\[d_{Haus}(\bar S(t_1), \bar S(t_2)) \leq k_h |e(t_1)-e(t_2)|\]
for all $t_1, t_2$ [check!]. So, by imposing an AC condition on $e$ we get the required regularity on the set $\bar S$. 

Solutions are guaranteed now to \eqref{eq:sp} by [Edmond, Thibault].


Observe that for $x\in [a,b]$ and when $a<b$
\begin{equation}
N_{[a,b]}(x) = \begin{cases}
    \{0\}, & \text{ when } x \in (a,b,) \\ 
     \ree_{\leq 0}, & \text{ when } x =a, \\ 
      \ree_{\geq 0}, & \text{ when } x =b.
\end{cases}
\end{equation}
Moreover when $a=b$, we get $N_{[a,a]}(x)= \ree$ for $x=a$.





{\bf MAURICE: Maybe we should prove existence to the first HIGS formulation and use uniqueness of solutions of the NC formulation/SP: suppose $f$ is locally Lipschitz , then take two solutions to SP $x, \tilde x$, then 
\[
    d/dt |x(t) - \tilde x (t)|^2 \leq
     2 L |x(t) - \tilde x (t)|^2 
\]
as normal cone is monotone. So uniqueness of solutions. 
a solution to HIGS is a solutions to SP/NC so if we can prove existence of solutions to HIGS -- e.g. with arguments later via Krasovskii??? maybe we can apply them in open -loop, we show that HIGS is a sweeping process}


{\bf Maurice we do not get right away that the formuled sweeping process model with the normal cone is equal to the MODEL of HIGS above -- only the ``slow/lazy'' solution matches the HIGS formulation - -some work needed to clarify this !!! Note that also taking the minimal norm/projection on Normal cone of the right-hand side in \eqref{eq:sp1} is not helping! There is no way how a $\dot e$  gets in this by just looking at the right-hand sides and doing calculus on that [see some calculus below], it is really a consequence of the solution satisfying \eqref{eq:sp2} as well and hence $\dot x_h$ somehow has to lie in the tangent cone! This result on PDS - normal cone equivalence is for constant constraint sets, I guess, see \cite{BROGLIATO2006,heemelsorl}}

Take the case $e(t) >0$ and thus $\bar S(t) =  [0, k_h e(t)]$ and take $x_h = k_h e(t)$ (so on the boundary), and $N_{\bar S(t)}(x_h)=\ree_{\geq 0}$ in this case. Hence, \eqref{eq:sp1} reads $\dot x_h \in f - \ree_{\geq 0}$. By  now taking the minimal norm solution of the r.h.s. for $f=e$ we do get $\dot e$ in. So, this is not a "static" property of the r.h.s., but it is due to the fact that \eqref{eq:sp2} has to hold and thus some viability/tangent cone condition  kicks in due to time-varying nature of $\bar S$ , i.e. $\dot x_h \leq k_h \dot e(t)$ has to hold, and this dynamic condition is going to be important [somehow this is a tangent cone condition to $S$, which appears in Section III]. I guess a minimal norm solution kicks in under this constraint! hence, the time-varying nature of $\bar S$ (and loosely speaking the "derivative" of the set, related to $\dot e$) plays a role! I will start digging in the works that you mentioned of Thibault and your observer paper, etc. 

BTW: I do believe the sweeping process formulation \eqref{eq:sp} and the HIGS-based formulations \eqref{eq:H} or \eqref{eq:H'} have the same solutions!!!!!!!! only we need to find the proper setting to connect the two!! 

\subsection{Well-posedness}

As shown above, first some work needed to embed the HIGS equations \eqref{eq:H} or \eqref{eq:H'} in an appropriate  mathematical (sweeping process framework). If accomplished, then following questions arise:


\begin{itemize}
    \item Can we rely on classical results for well-posedness? Locally AC inputs give local existence and uniqueness?
    \item global existence of solutions?
    \item consistency of a time-stepping scheme? how does the particular time-stepping scheme look if we translate it from classical literature?
    \item we could also directly make the step in the projection-based controller to state $x_h \in \ree^{n_h}$ and put the sector constraint on its input-output pair! see below
\end{itemize}

\section{Direct Closed-loop formulations of projection-based controllers:  ePDS}

Plant (+ smooth controller part) and projection-based controller (with state $x_h$

\begin{eqnarray*}
\dot{x}_p & = & f_p(x_p, u, w) = f_p(x_p, g_h(x_h), w); \ e = g_p(x_p)\\
\dot{x}_h &= & f_h(x_h, g_p(x_p));  \ u = g_h(x_h)
\end{eqnarray*} 

We write this as 
\begin{equation}
\dot x = F(x,w) 
\end{equation}



Then

\begin{equation}
\dot x = \Pi_{S,E}(x,F(x,w)) 
\end{equation}
with
$n=n_p+n_h$
\begin{equation}
 S=   \left\{x\in \mathbb{R}^n \mid e = g_p(x_p), u = g_h(x_x), eu \geq \frac{u^2}{k_h}\right\}.
\end{equation}

\begin{equation}
    E = [0\  I]^\top
\end{equation}

\begin{equation} \label{piSE1}
\Pi_{S,E}(x,v) = \argmin_{w \in T_S(x), w - v \in \im E} \|w-v\| 
\end{equation}

This is a mathematical framework that fits and we can show that this leads to the description \eqref{eq:H'} [with $f=e$] in closed loop with the plant dynamics. See \cite{DeeSha_AUT21a} [using a PWL modelling formalism]. Also here we obtain global existence of solutions w.r.t. bounded {\em piecewise Bohl} inputs (including forward completeness), using lexicographic orderings of derivatives in Taylor expansions. 

Note that with respect to classical PDS there are essential differences:
\begin{itemize}
\item projection is not complete in the sense that only some directions (not all) can be used to keep the state in the constraint set $S$
\item using a non-convex constraint set $S$ (note as opposed to setup in Section II, this is now a constant set, not dependent on time).
\end{itemize}

In case all the states can be altered/projected, $S$ is convex and no inputs are present, we recover as a special case of the above framework the classical PDS. 

\subsection{HIGS special case}

{ Maybe first for HIGS or at least the FOPE -- with $u=x_h$ and $n_h=1$}

\begin{itemize}
    \item is the ePDS formulation well-posed in the sense that projection operator is well defined? see some conditions below that are needed. Assumption 2.
    \item existence / uniqueness of solutions, see \cite{DeeSha_AUT21a} for piecewise Bohl inputs. 
    \item {\bf MAURICE can this be written as an interconnection of sweeping process and smooth nonlinear $x_p$ dynamics?, i.e. is the "direct closed-loop formulation" here "similar"/same to using the HIGS/FOPE interconnected with smooth system $\rightarrow$ can we use 2nd order sweeping processes here???? This might work -- we typically use a relative degree assumptions, i.e. the external disturbance $w$ is not directly present in $e=g_p(x_p)$. so, at least relative degree 1. We can even assume relative degree 2, if this helps! } 
\end{itemize}
Regarding the latter item: I would expect something like 
\begin{subequations} \label{eq:2sp}
\begin{eqnarray}
\dot{x}_p & = & = f_p(x_p, g_h(x_h), w); \\
\dot{x}_h &= & f_h(x_h, g_p(x_p))-N_{\tilde S(g_p(x_p))}(x_h), 
\end{eqnarray} 
\end{subequations}
where 
\begin{equation}
\tilde S(g_p(x_p)) = \{ x_h \in \ree \mid (g_p(x_p),x_h) \in S \}
\end{equation}
with $S$ the sector-like set defined before. {\bf Does this fit directly the state-dependent 2nd order sweeping process formulation? } Does this connect to your observer design paper with Bernard and Christophe? 

Can we use this prove existence (and maybe uniqueness) of solutions for Lebesgue measurable or AC external disturbance inputs? 

And what about time-stepping schemes with consistence?


\subsection{General case}
What about the general case ($n_h >1$) ? same questions as above. 

\subsection{State-dependent norms?}

\begin{equation} \label{piSE2}
\Pi_{S,E}(x,v) = \argmin_{w \in T_S(x), w - v \in \im E} \|w-v\|_{P(x)}
\end{equation}
with $P(x) \succ 0$ or  maybe even $E(x)$? See Hauswirth paper where they look at what they call oblique PDS -- full projection but metric $ \|\cdot\|_{P(x)}$ in projection operator state-dependent. Connection to that work?

\subsection{Well-posedness}

can we prove existence/uniqueness of solutions? what are natural classes of inputs?

I have been working on a viability/aubin/cellina type of approach, good to connect to that! 

Viability condition for regularized dynamics $\dot x =\text{Kras}(\Pi)$ (we apply regularization to get osc properties) is  $\text{Kras}(\Pi) \cap T_s \neq \emptyset$. Moreover, every solution to the regularized dynamics has to satisfy $\dot x = \text{Kras}(\Pi) \cap T_s$. To show that this is a solution to the original (non-regularized) dynamics, it would be sufficient to show

\[ \text{Kras}(\Pi) \cap T_s = \Pi \]

Does this hold?

In general it is not true that 

\[ \text{Kras}(\Pi) = F -N_S \]
{\bf We found examples for $e=x_h=u=0$ and $\dot e>0$ but fortunately these are isolated points in time. In fact, this is caused by $x\mapsto T_S(x)$ not being lower semicontinuous!!! maybe nice to add an example illustrating this! }

This would lead to the question if $\text{Kras}(\Pi) \cap T_s = \Pi $ is connected to take the slowest solutions in the normal cone DI? same line of reasoning, would be great to connect those -- where Aubin meets Moreau? 

\section{Toulouse 20230203}

\newcommand{\E}{{\cal E}}

\subsection{Time-invariant case}

Let $K$ be a convex polyhedral set given  and a linear subspace ${\cal E}=\im E$ where $E\in \ree^{n\times n_E}$ is a matrix with full column rank. Moreover, we assume

\begin{assumption} \label{ass3} The set $K\subseteq \ree^n$ and ${\cal E}$ satisfy
\begin{itemize}
\item $K=\{x \in \ree^n \mid Hx \geq b\}$ for some matrix $H\in \ree{n_H \times n} $ {\bf MH: rank condition on active constraints?} and vector $b\in \ree^n$
\item ${\cal E} +T_K(x) = \ree^n$ for all $x\in K$ (in case $K$ is pointed convex cone, then $\E+K=\ree^n$, equivalent - nice to have a more general condition on $K$)
\end{itemize}
\end{assumption}

\begin{equation} \label{piSE2}
\Pi_{K,\E}(x,v) = \argmin_{w \in T_K(x), w - v \in \E} \|w-v\| 
\end{equation}

Under Assumption~\ref{ass3} $\{\w \in T_K(x) \mid w - v \in \E\}$ is nonempty, closed and convex. According to the closest point theorem [Luenberger] there is a unique minimizer, so the projection operator above is well-defined.

\begin{equation} \label{eq:epdsK}
\dot x = \Pi_{K,{\E}}(x,f(x)) =: F(x)
\end{equation}

\begin{assumption}
    $f$ is a continuous mapping in $x$ .
\end{assumption}

Active constraint index set $J(x):=\{ i \mid H_ix=b_i\}$. Then $T_K(x) = \{v \mid H_J v \geq 0\}$. For convenience we introduce $T_J:=\{v \mid H_J v \geq 0\}$ for $J\subseteq \{1, \ldots, n_N\}.$

{\bf MH: [we can probably extend all of this $K$ given by mapping $H(x) \geq 0$.] using $grad H_i$ }

Consider the Krasovskii regularisation of \eqref{eq:epdsK} given by 

\begin{equation} \label{eq:kras}
    \dot x \in \cap_{\delta >0} \overline{\textup{con}}F(B(x,\delta)) =: K_F(x)
\end{equation}
Above, $\overline{\textup{con}}(M)$ denotes the closed convex hull of the set $M$, in other words, the smallest closed convex set containing $M$.




\begin{proposition} \label{prop:kras}
If $f$ is continuous and Assumption~\ref{ass3} holds, then the Krasovskii regularization of $F$ at $x\in K$ is equal to 
\begin{equation}
    K_F(x) = \textup{con}\{P_{T_J,\E}(f(x))\mid J \subset J(x)\}
\end{equation}
\end{proposition}

{\bf MH: this result reveals the lower semicontinuity of $x \mapsto T_K(x)$ through the $J\subset J(x)$ -- this property will be crucial in generalizing the result to general convex or even prox regular sets. However, this requires to find some useful extension of this proposition characterising the Krasovskii regularisation
\begin{equation}
    K_F(x) \subseteq (? = ?) \overline{\textup{con}}\bigcup\{P_{T,\E}(f(x))\mid T_K(x)\subset T, \ T \textup{closed, convex cone}\}
\end{equation}
would this hold, at least with $\subseteq$? due to lsc of $T_K(x)$ all nearby $T_K(y)$ with $y\in B(x,\delta)$ satisfy $T_K(x) \subseteq T_K(y)+ eps$ ("loosely speaking").
In fact, this can be used to generalize all the stuff below! }

\begin{theorem} \label{thm.kras=pds}
    Assume that $f$ is continuous and Assumption~\ref{ass3} holds. Then for all $x\in K$ it holds that 
    \begin{equation}
        K_F(x) \cap T_K(x) = \{F(x)\} =  \{\Pi_{K,{\E}}(x,f(x)) \}
    \end{equation}
\end{theorem}
\begin{proof}
    It is obvious that the inclusion $\supseteq$ holds as $\Pi_{K,{\E}}(x,f(x))$ clearly belongs to both  $T_K(x)$  and  $K_F(x)$ (cf.~\eqref{eq:kras}). So, let us consider the reversed inclusion $\subseteq$. Thereto, let $v\in  K_F(x) \cap T_K(x)$. Based on Proposition~\ref{prop:kras}, $v\in K_F(x) $ can be written as 
    \[ v= \sum_{J \subseteq J(x)} \lambda_J P_{T_J,\E}(f(x))\]
    with $\lambda_J \geq 0$, for $J \subset J(x)$, and $\sum_{J \subset J(x)} \lambda_J=1$. Let us consider
    \begin{multline}
        |v-f(x)| = |\sum_{J \subset J(x)} \lambda_J P_{T_J,\E}(f(x))-f(x)| = \\
        |\sum_{J \subseteq J(x)} \lambda_J P_{T_J,\E}(f(x))-\sum_{J \subset J(x)} \lambda_J  f(x)| \leq\\
        \sum_{J \subseteq J(x)} \lambda_J |P_{T_J,\E}(f(x)) - f(x)| \leq \\
        \sum_{J \subseteq J(x)} \lambda_J |P_{\underbrace{T_{J(x)}}_{T_K(x)},\E}(f(x)) - f(x)| = \\ |P_{T_J(x),\E}(f(x)) - f(x)|= |\Pi_{K,{\E}}(x,f(x))-f(x)|
    \end{multline}
where we used in the second inequality that 
$|P_{T_J,\E}(f(x)) - f(x)| \leq |P_{T_{J(x)},\E}(f(x)) - f(x) | $
as $T_{J(x)} \subseteq T_J$. 
Moreover, by definition of $P_{T_J,\E}$ it holds that $P_{T_J,\E}(f(x)) - f(x) \in \E$ for each $J\subset J(x)$ and thus also 
\[  \sum_{J \subseteq J(x)} \lambda_J (P_{T_J,\E}(f(x)) - f(x)) =  \underbrace{\sum_{J \subseteq J(x)} \lambda_J P_{T_J,\E}(f(x))}_{=v} - f(x) \in \E \]
due to $\E$ being a linear subspace. Since $v\in T_K(x)$ and $v-f(x) \in \E$, and $|P_{T_{J(x)},\E}(f(x)) - f(x) |$ is the shortest distance along $\E$ between $T_J(x)= T_K(x)$ and $f(x)$, i.e., 
\[\Pi_{K,\E}(x,f(x)) = \argmin_{w \in T_K(x), w - f(x) \in \E} \|w-f(x)\|\]
it must hold that 
\[|v-f(x)| = |\Pi_{K,{\E}}(x,f(x))-f(x)|\]
 and thus $v$ must be the unique  closest point in $T_K(x)$ to $v$ along $\E$ and thus $v=\Pi_{K,{\E}}(x,f(x)) $, thereby proving the result. 
\end{proof} 

\begin{theorem}
    Assume that $f$ is continuous and Assumption~\ref{ass3} holds. Then for every initial condition $x(t_0)=x_0 \in K$ there exists $T>0$ and an AC solution $x:[0,T] \rightarrow K$ to \eqref{eq:epdsK}. {MH: under boundedness/growth conditions this should also be extended to global existence of solutions.}
\end{theorem}
\begin{proof}
    Lemma 5.16 in [Goebel, sanfelice, teel book] show that $K_F$ is outer semicontinous and in case $F$ locally bounded then $K_F$ locally bounded. Moreover, $K_F$ takes closed and convex setvalues and for all $x\in K$ there is an open  neighborhood $U$ of $x$ such that for all $y\in U\cap K$ it holds that $K_F(y) \cap T_K(y) \neq \emptyset$ (as it contains $\Pi_{K,\E}(y, f(y))$). According to Lemma 5.26 (b) [goebel, sanfelice, teel] [maybe better to refer to original Aubin source to, on viability theory] the corresponding viability conditions are satisfied implying that the Krasovskii regularization \eqref{eq:kras} has a solution $x$. Hence, this solution $x$  satisfies $x(t)\in K$ for all $t\in [O,T]$, it holds that $\dot x(t) \in T_K(x(t))$, almost everywhere, see Lemma 5.26 (a) [goebel, sanfelice, teel]. Hence, it holds a.e. that
    \begin{equation} \label{aux1} \dot x(t) \in K_F(x(t)) \cap T_K(x(t))\end{equation}
    Invoking Theorem~\ref{thm.kras=pds} shows that $x$ is now a solution to \eqref{eq:epdsK} as the right-hand side of \eqref{aux1} is contained of a single element being equal to the right-hand side of \eqref{eq:epdsK} are equal. 
\end{proof}

{\bf MH
Interestingly, this is an alternative way to prove existence of solutions to (ordinary) PDS using Krasovskii regularisation and viability theory contrasting other proofs building on Skoroghod problem [nagurney and zhang], plus other proofs -- henry? who proved existence of solutions to PDS and how -- of course viability results also build on time-stepping proofs... so maybe deep down the same?}

\subsection{Time-varying case}

\[\dot x = f(x,t)\]

$f$ continuous in $x,t$

\begin{equation} \label{eq:epdsK}
\dot x = \Pi_{K,{\E}}(x,f(x,t)) =: F(x,t)
\end{equation}

can we take $\bar K = \{ (x,t) \mid x \in K \}$ still polyhedral convex set and $\bar \E = \bar E \times \{0\} $ (not allowed to project in $t$ direction). Define $\bar f(x,t) = (f(x,t),1)$). Is, with $\xi = (x,t)$, 
\begin{equation} \label{eq:epdsK}
\dot x = \Pi_{K,{\E}}(x,f(x,t)) =: F(x,t)
\end{equation}
"same" as
\begin{equation} \label{eq:epdsK}
\dot \xi = \Pi_{\bar K,\bar {\E}}(\xi,\bar f(\xi)) =: \bar F(\xi)
\end{equation}
$\bar f$ is continuous in $\xi$. so for continuous inputs we are good and we can concatenate to go to piecewise continuous. 

\subsection{Further extensions}
Possible extensions
\begin{itemize}
\item prox regular sets $K$
\item what if $\E=\E(x)$ can depend on $x$ but in a continuous way...
\item what if we do not use Euclidean norm $|\cdot|$ but state-dependent norms $|\cdot|_{P(x)}$ a la Hauswirth, with $P(x)$ positive definite and continuous in $x$, see details and motivation in Hauswirth's papers
\item time-varying $K(t)$??? maybe the embedding approach with $\dot t=1$ solves this already ;-)
\end{itemize}

\section{Beyond convexity and prox regularity: What about sector sets}

In control theory often sector sets are of interest, see lure... etc etc. 

\begin{assumption} \label{ass1} The set $S\subseteq \ree^n$ and $E \in \ree^{n\times n_E}$ satisfy
\begin{itemize}
\item $S=  K \cup -K$ in which $K$ is a convex polyhedral cone given by $K =\pos G + \im H$ in which the matrix $[G\ H]$ is square and has rank $n$
\item  $K\cap -K =\im G$ 
\item $E$ full column rank
\item $\im E \cap S = \{0\}$ and thus $S + \im E = \ree^n$ 
\end{itemize}
\end{assumption}

How can the above ideas be used to prove existence of solutions to 

\begin{equation} \label{pds2}
\dot x = \Pi_{S,E}(x,f(x))
\end{equation}
with 
\begin{equation} \label{piSE}
\Pi_{S,E}(x,v) = \argmin_{w \in T_S(x), w - v \in \im E} \|w-v\| 
\end{equation}
for $x\in S$ and $v\in \ree^n$. 

\section{Aneel 20230204}

{\bf MH: I start with simpler setup here, to see if we can make that work and then let us see if we generalize}

suppose after a possible coordinate transformation we get:

\begin{eqnarray*}
\dot{x} & = & g(x, u) ; \ e = x_n\\
\dot u &= & h(u, e)
\end{eqnarray*} 

$\xi = (x,u)$ and then above reads $\dot \xi = f(\xi)$. 

\begin{equation}
 S=   \left\{\xi\in \mathbb{R}^{n+1} \mid  eu \geq \frac{u^2}{k_h}\right\}.
\end{equation}

Denote for convenience the 2d sector as $\bar S$, i.e.

\begin{equation}
    \bar S=   \left\{ (e,u)\in \mathbb{R}^{2} \mid  eu \geq \frac{u^2}{k_h}\right\}.
\end{equation}


\begin{equation}
    T_S(\xi) = \ree^{n-1} \times T_{\bar S}(e,u)
\end{equation}


\begin{assumption}
   $ h(0,0)=0$
\end{assumption}

\begin{equation}
    \E = \textup{Im} [0\  1]^\top
\end{equation}

\begin{equation} \label{eq:epdsK}
\dot \xi = \Pi_{S,{\E}}(\xi,f(\xi)) =: F(\xi)
\end{equation}

In fact, 
\begin{equation} \label{eq:epdsK}
\dot \xi = \begin{cases}
    \Pi_{K,{\E}}(\xi,f(\xi)), & \text{ when } \xi \in K\setminus -K\\
    \Pi_{-K,{\E}}(\xi,f(\xi)), & \text{ when } \xi \in -K\setminus K \\
    f(\xi), & \text{ when } \xi \in -K\cap  K 
\end{cases}
\end{equation}
The latter follows from the fact that $f_h(0,0)=0$ and therefore $f(\xi)\in T_S(\xi)$.
{\bf MH: when generalizing to general 2d sectors this will differ}

Although $K_f \cap T_S \neq \Pi$ here, we can still exploit the results in the preceding section to establish existence of solutions here. 

\begin{theorem}
    An AC solutions exists locally for each initial state $\xi_0 \in S$, i.e. on $[0,T]$ for some small positive $T$.
\end{theorem}

\begin{proof} {\bf MH: sketch for now}
Apply Krasovskii regularisation to $\dot \xi = F(\xi)$ and observe that $K_F(\xi) \cap T_S(\xi)\neq \emptyset$ for all $\xi \in S$. Hence, the local viability assumption is satisfied and we can establish for any initial state the existence of an AC solution $\xi:[0,T] \rightarrow S$ to $\dot x\in K_F(\xi)$. Clearly, due to the necessity of the viability condition, we obtain that the solution satisfies a.e. 
\[ \dot \xi \in K_F(\xi) \cap T_S(\xi)\]. 
Interestingly, for all times $t\in [0,T]$ for which $\xi(t) \not \in K\cap -K$, we can use the results in the proceeding section that lead for these $t$ to
\begin{equation} \label{aux4} K_F(\xi(t)) \cap T_S(\xi(t)) = \Pi_{S,\E}(\xi(t), f(\xi(t)))\end{equation}. 
In fact, for each such $t$ there is due to closedness of $K\cap -K$  and $\xi$ being continuous, some $\epsilon_t>0$ such that this must hold on $[t,t+\epsilon_t]$
Hence, we only have to consider the times where $\xi(t)  \in K\cap -K$, i.e. $(e(t),u(t))=(0,0)$.
We will differentiate two subcases: (i) $\dot e(t) \neq 0$ and (ii) $\dot e(t) = 0$.

{\bf maybe consider only times where $\xi$ differentiable}

Subcase (i): without loss of generality, let us assume $\dot e(t) > 0$. Note that $\dot e = g_n(x,u) $ which [{\bf some properties of $g_n$ so that from AC $x,u$ we can conclude continuous $\dot e$}]. Hence, we have that there is an $\epsilon_t$ and an $\eta>0$ such that $\dot e(\theta) \geq \eta $ for $\theta \in [t,t+\varepsilon_t]$. Hence, we have that $e(t)=0$, but $e(\theta)\geq \eta (\theta- t)>0$ for $\theta \in [t,t+\epsilon_t]$. Hence, the point where $e$ is zero is an isolated point (measure zero set), and for $ \theta \in (t,t+\epsilon_t]$ $\xi(t) \in K \setminus -K$, for which 
    \eqref{aux4} holds (with $t=\theta$). 

    Subcase (ii) $\dot e(t) = 0$. Hence, we have that  $\dot e(t) = g_n(x(t),u(t)) =0$ and $\dot u(t) = h(0,0)=0$. Note that $(\dot e(t),\dot u(t)) \in T_{\bar S}(0,0)$. 
    The Krasovskii regularization \erqef{eq:kras}, recalled here for convenience, 
    \begin{equation} 
    \dot x \in \cap_{\delta >0} \overline{\textup{con}}F(B(x,\delta)) =: K_F(x)
\end{equation}
$F(\xi) = (g_1(\xi),.. g_{n-1}(\xi),\Pi_{[0 1]^\top, \bar S}((e,u), (g_n, h))$

{\bf Can we express this krasovskii regularization as we did before with polyhedral sets??? that would be helpful, I guess we can do it!!! }

So  $K_F(\xi) = (g_1(\xi),.. g_{n-1}(\xi)) \times \textup{con}\{P_{T_J,\E}((g_n,h))\mid J ...)\}$ where $T_J$ are appropriate tangent cones of points nearby $(e,u)=0$  and $(g_n,h)=0$. Hence, $K_F(\xi) = \{(g_1(\xi),.. g_{n-1}(\xi), 0,0)\} = \Pi_{S,\E}(\xi, f(\xi))$. 

    Hence, in this case we have that for almost all $t\in [0,T]$ 
    

\[ \dot \xi(t)= \Pi_{S,\E}(\xi(t), f(\xi(t))) \]

there establishing that $\xi$ is indeed an AC solution to the original pPDS. 
\end{proof}

{\bf MH: let us find a good name for partially projected dynamical systems -- is partial projection a good term? as opposed to oblique projection - used by hauswirth, although oblique projections as they are classically defined are possibly closer to partial projection ;-)}

\begin{corollary}
    under lipschitz like bounds, we can prove global existence, i.e. on $[0,\infty)$ solutions
\end{corollary}
\begin{proof}
    concatenate, using lipschitz like bounds to avoid finite escape times. 
\end{proof}

\begin{corollary}
case of continuous inputs 
\end{corollary}
\begin{proof}
    embed $t$ in it $\dot t=1$ and then for continuous input
\end{proof}

\begin{corollary}
    piecewise continuous inputs, make global results
\end{corollary}
\begin{proof}
    use previous corollary and concatenate, indicating that at continuities of $w$ you still are in the set $S$! so you can continue with a local solution, and as long as finite escape times are avoided we should be fine
\end{proof}

\vspace{2cm}

\section{Toulouse 20230208}

\subsection{Introduction}

\subsection{Preliminaries on oblique projected dynamical systems}

maybe first normal PDS and then e/o PDS

\subsection{Projection-based controllers}
Consider the general nonlinear single-input single-output (SISO) plant given by 
\begin{subequations}
\begin{eqnarray}
\dot{x} & = & g(x, u) \\
e &= & r(x)
\end{eqnarray} 
\end{subequations}
with state $x\in \ree^n$, control input $u\in \ree$ and output $e\in \ree$. 

We will control this by a projection-based controller for which the unprojected dynamics are given by 
\begin{subequations}
\begin{eqnarray}
\dot{z} &= & h(z,e)\\
u &= & z_1
\end{eqnarray} 
\end{subequations}
with state $z\in \ree^m$, controller output $u\in \ree$ and controller input $e\in \ree$. Note that the controller output equation $u=z_1$ can be realizes under very mild assumptions by a coordinate transformation in case $u=s(z)$ for a function $s: \ree^m \rightarrow \ree$. {\bf to be added mild condition or reference!}
We assume that all the maps $g$, $r$ and $h$ are assumed to be continuous. Moreover, $r$ is assumed to be continuously differentiable.  {\bf check actual needs after proofs!}


The projection will take place only on controller states $z$ and the dynamics, as we cannot change the plant states and dynamics as they adhere to physical laws, resulting in an oblique or partial projection operation with the goal to keep the input-output pair $(e,u)$ in a sectorset 
\begin{equation}
 S=   \left\{(e,u)\in \mathbb{R}^2 \mid  (u-k_1e)(u-k_2e) \leq 0 \right\}, 
\end{equation}
where $k_1, k_1 \in \ree$ with $k_1<k_2$.
We can write $S$ also as the union of two polyhedral cones
\begin{equation}
    S= K \cup -K
\end{equation}
with
\[ K=   \left\{(e,u)\in S \mid e \geq 0 \right\} = \left\{(e,u)\in \ree^2 \mid u \geq k_1 e \text{ and } u \leq k_2 e \right\}. \]

To write the closed-loop system description we introduce the state $\xi=(x,z) \in \ree^{n+m}$, the constraint set $S$ on the level of the states $\xi$ as 
\begin{equation}
 {\cal S}=   \left\{\xi=(x,z)\in \mathbb{R}^{n+m} \mid e=r(x),\ u = z_1,\ (e,u)\in S \right\}, 
\end{equation}
and the projection subspace as 
\begin{equation}
    \E = \textup{Im}\begin{bmatrix} O_n \\ I_m \end{bmatrix}.
\end{equation}
Note that we can also write $\cS = \cK \cup -\cK $
with $\cK :=\left\{\xi=(x,z)\in \mathbb{R}^{n+m} \mid (e,u) \in K \right\}$. 

The closed-loop dynamics can now be written as 
\begin{equation} \label{eq:cloop}
    \dot \xi = \Pi_{{\cal S},\E}(\xi,f(\xi)) := F(\xi)
\end{equation}
with $f$ denoting the unprojected closed-loop dynamics given by 
\begin{equation}
    f(\xi) = (g(x, z_1),h(z,r(x))). 
\end{equation}

[for simplicity without external input $w$, but we can aim for embedding time $\dot t=1$ at end again. ]

The oblique projection operator is defined here as {\bf maybe better to put this in preliminaries of paper, where we introduce shortly oblique PDS}
\begin{equation} \label{piSE1}
\Pi_{{\cal S},\E}(x,f) = \argmin_{v \in T_{\cal S}(x), f - v \in \E} \|f-v\| 
\end{equation}

This is a mathematical framework that fits and we can show that this leads to the description \eqref{eq:H'} [with $f=e$] in closed loop with the plant dynamics. See \cite{DeeSha_AUT21a} [using a PWL modelling formalism]. 


\subsection{Main results}

\begin{theorem} \label{thm:pbc}
    For each initial state $\xi_0 \in S$ there exists an AC solutions locally, i.e., there is a $T>0$ such that $\xi:[0,T]\rightarrow \ree^{n+m}$ with $\xi(0)=\xi_0$ is a solution to \eqref{eq:cloop}.
\end{theorem}

In the proof of Theorem~\ref{thm:pbc}, we use the  the Krasovskii regularisation of \eqref{eq:cloop} given by 
\begin{equation} \label{eq:kras}
    \dot x \in \cap_{\delta >0} \overline{\textup{con}}F(B(x,\delta)) =: K_F(x)
\end{equation}
Above, $\overline{\textup{con}}(M)$ denotes the closed convex hull of the set $M$, in other words, the smallest closed convex set containing $M$. {\bf Hauswirth had the $\overline{\textup{con}}$ outside of the intersection, might be easier, but if we go to explicit expressions of Krasovskii regularisations anyhow, then it does not matter
}

{\bf I think we can generally write under continuity of $f$:}
\begin{equation} \label{eq:kras}
    K_F(\xi) = \overline{\textup{con}} P_{\limsup_{\bar \xi \rightarrow \xi}T_{{\cal S}}(\bar \xi),\E}(f(\xi))
\end{equation}
{\color{red}
\[
K_F(\xi) = \overline{\rm con} \limsup_{\bar \xi \to \xi} P_{T_S(\bar \xi),\cE} (f(\xi))
\]
}

or the alike

\begin{proposition} \label{prop:kras_cloop}
The Krasovskii regularization of $F$ at $\xi\in {\cal S}$ is equal to  {\bf to be completed:}
\begin{equation}
    K_F(x) = \textup{con}\{P_{T_J,\E}(f(x))\mid J \subset J(x)\}
\end{equation}
\end{proposition}
\begin{proof}
    note that $f$ continuous. 
\end{proof}


\subsection{Proof of Theorem~\ref{thm:pbc}}

{\bf MH: sketch for now}
The Krasovskii regularisation $K_F$ is outer semicontinuous and takes non-empty convex closed setvalues. Moreover, observe that $K_F(\xi) \cap T_S(\xi)\neq \emptyset$ for all $\xi \in S$ as $\Pi_{{\cal S},\E}(\xi,f(\xi))$ is contained in the intersection. Hence, the local viability assumption [Aubin, Goebel, sanfelice, teel book] is satisfied and we can establish for any initial state the existence of an AC solution $\xi:[0,T] \rightarrow S$ to $\dot \xi\in K_F(\xi)$ for some $T>0$. Clearly, due to the necessity of the viability condition, we obtain that the solution satisfies for almost all times $t\in [0,T]$ that 
\[ \dot \xi \in K_F(\xi) \cap T_{\cal S}(\xi).\] 
Interestingly, for all times $t\in [0,T]$ for which $\xi(t) \not \in K\cap -K$, we can use the results in the proceeding section as 
\begin{equation}
    \Pi_{{\cal S},\E}(\xi,f(\xi)) = \Pi_{{\cal K},\E}(\xi,f(\xi))
\end{equation}
in a neighbourhood of $\xi \in \cK \setminus -\cK$ (and similarly for $\xi \in -\cK \setminus \cK$). 
Hence,  for almost all $t$ with $\xi(t) \not \in K\cap -K$ (and due to continuity of $\xi$ and closedness of $K\cap -K$, there is $\epsilon_t$ such that for $\tau \in [t,t+\epsilon_t)$, we have $\xi(\tau) \not \in K\cap -K$) 
\begin{equation} \label{aux4c} K_F(\xi(t)) \cap T_S(\xi(t)) = \Pi_{S,\E}(\xi(t), f(\xi(t))).\end{equation} {\bf there is a small issue here as the results in previous section are such that ${\cal K}+\E =\ree^n$, which is not the case here ... so requires a small adaptation, but not a serious one}. 
Hence, we only have to consider the times where $\xi(t)  \in K\cap -K$, i.e. $(e(t),u(t))=(0,0)$.
We will consider two cases: 
\begin{enumerate}[(i)]
    \item $\dot e(t) \neq 0$, and
    \item $\dot e(t) = 0$
\end{enumerate}


{\bf maybe consider only times where $\xi$ differentiable}

Case (i): without loss of generality, let us assume $\dot e(t) > 0$ (when $\dot e(t) < 0$ the arguments are similar). Note that $\dot e = \frac{dr}{dx}(x) g(x,z_1)$, which is a continuous function of time along solution $\xi$ (as $r$ continuously differentiable and $\xi$ continuous). Hence,  there is an $\epsilon_t$ and an $\eta>0$ such that $\dot e(\tau) \geq \eta $ for $\tau \in [t,t+\varepsilon_t]$. Hence, we have that $e(t)=0$, but $e(\tau)\geq \eta (\tau- t)>0$ for $\tau \in [t,t+\epsilon_t]$. Hence, the time $t$ where $e$ is zero is an isolated point (measure zero set) in this case, and for $ \tau \in [t,t+\epsilon_t]$ $\xi(t) \in \cK \setminus -\cK$, for which 
    \eqref{aux4c} holds (with $t=\tau$). 

Case (ii) $\dot e(t) = \frac{dr}{dx}(x(t)) g(x(t),z_1(t))= 0$. Note that $(\dot e(t),\dot u(t)) \in T_{\bar S}(0,0)$ [{\bf to check: almost everywhere?]}. 

Useful identity: $\xi=(x,z)$ $v=(v_x,v_z)$
\begin{equation} \label{eq:tangentconelowdim}
    (v_x,v_z) \in T_{\cS}(\xi) \Leftrightarrow (\frac{dr}{dx}(x) v_x , v_{z,1})  \in T_{S}(r(x),z_1).
\end{equation}
{\bf [obvious? proof?]}

\begin{lemma} The Krasovskii regularization can be written as 
\begin{equation}
    K_F(\xi) = \{g(x,z_1)\} \times Z_1(\xi) \times \{\bar{h}(\xi)\} 
\end{equation}
for some osc mapping $Z_1: \cS \rightarrow \ree$ and $\bar{h}(\xi):=(h_2(z,r(x)),\ldots, h_m(z,r(x)))$
\end{lemma}
\begin{proof} 
To prove this result, observe that 
\begin{align*}
 & \Pi_{{\cal S},\E}(\xi,f(\xi)) =  \\ 
  & =  \argmin_{v \in T_{\cal S}(\xi), f(\xi)-v \in \E} \|f(\xi)-v\|  \\
   &= \argmin_{v=(v_x,v_z) \in T_{\cal S}(\xi), v_x=g(x,z_1)} \|h(z,r(x))-v_z\|  \\ 
    &=  \argmin_{v=(g(x,z_1),v_z) \in T_{\cal S}(\xi)} \|h(z,r(x))-v_z\|  \\ 
     & \stackrel{\eqref{eq:tangentconelowdim}}{=}  \argmin_{v=(g(x,z_1),v_z), (\frac{dr}{dx}(x) g(x,z_1), v_{z,1})  \in T_{S}(r(x),z_1)} \|h(z,r(x))-v_z\|  \\ 
      &= \argmin_{v=(g(x,z_1),v_{z,1},\bar h(z,r)), (\frac{dr}{dx}(x) g(x,z_1), v_{z,1})  \in T_{S}(r(x),z_1)} \|h_1(z,r(x))-v_{z,1}\|.
\end{align*} 
Hence, this shows that 
\[\Pi_{{\cal S},\E}(\xi,f(\xi)) = (g(x,z_1),v_{z,1}^*,\bar h(z,r))\]
with
\[v_{z,1}^* = \argmin_{v_{z,1}, (\frac{dr}{dx}(x) g(x,z_1), v_{z,1})  \in T_{S}(r(x),z_1)} \|h_1(z,r(x))-v_{z,1}\|.\]
From this the result ({\bf hopefully ;-)}) follows
\end{proof}
{\bf so lemma above is needed to be able to transfer all reasoning to the 2d sectorset $S$ instead of the $n+m$d set $\cS$}

We will use this lemma for case (ii), where $(r(x),z_1)=(0,0)$ and thus $T_{S}(r(x),z_1)=S$. Moreover $\dot e(t)= \frac{dr}{dx}(x(t)) g(x(t),z_1(t))=0$. It follows from the lemma that
\begin{equation}
    K_F(\xi) = \textup{con}\{f(\xi),(g(x,z_1),0,\bar h(z,r))\}
\end{equation}

We either have $f(\xi) = (g(x,z_1),0,\bar h(z,r))$ in which case  $K_F(\xi)$ is a singleton set and thus must be equal to $\{\Pi_{{\cal S},\E}(\xi,f(\xi))\}$ (as this one is guaranteed to lie in $K_F(\xi)$), or $f(\xi) \neq (g(x,z_1),0,\bar h(z,r))$. In the latter case $f(\xi) \not\in T_{\cal S}(\xi)$ and since $T_{\cal S}(\xi)$ is a cone also $\alpha f(\xi)\not\in T_{\cal S}(\xi)$ for $\alpha >0$, it follows that  
\begin{equation}
    K_F(\xi) \cap T_{\cal S}(\xi)= \{(g(x,z_1),0,\bar h(z,r))\}= \{\Pi_{{\cal S},\E}(\xi,f(\xi))\}
\end{equation}

    Hence, in this case we have that for almost all $t\in [0,T]$ 
    

\[ \dot \xi(t)= \Pi_{S,\E}(\xi(t), f(\xi(t))) \]

there establishing that $\xi$ is indeed an AC solution to the original pPDS. 

\begin{figure}[!h]
\centering
\includegraphics[width=7cm]{KintTnotPi}
\caption{Due to the absence of convexity/prox regularity, we do not have that $K_F(\xi) \cap T_\cS(\xi) = \{\Pi_{\cS,\E}(\xi, f(\xi))\}$. This is due to the tangent cone lacking a lower semicontinuity property (in the set $\cK \cap -\cK$.)}
\end{figure}

\subsection{Corollaries}

\vspace{2cm}

\begin{corollary}
    under lipschitz like bounds, we can prove global existence, i.e. on $[0,\infty)$ solutions
\end{corollary}
\begin{proof}
    concatenate, using lipschitz like bounds to avoid finite escape times. 
\end{proof}

\begin{corollary}
case of continuous inputs 
\end{corollary}
\begin{proof}
    embed $t$ in it $\dot t=1$ and then for continuous input
\end{proof}

\begin{corollary}
    piecewise continuous inputs, make global results
\end{corollary}
\begin{proof}
    use previous corollary and concatenate, indicating that at continuities of $w$ you still are in the set $S$! so you can continue with a local solution, and as long as finite escape times are avoided we should be fine
\end{proof}
\vspace{4cm}
\section{Toulouse 20230206}

\subsection{Extended PDS: Different facets of minimum norm formulation}

The objective of this section is to write several analogues of extended PDS vector field which are similar to some known modeling formalism in the literature.

For given functions $h_i:\R^n \to \R$, $i=1,\dots,m$, we take $S$ to be of the following form:
\[
S:= \{ x\in \R^n \, \vert \, h_i(x) \ge 0\}.
\]
The functions $h_i$, $i=1,\dots,m$ are smooth and that $\nabla h_i$ does not vanish in a neighborhood of $\{x \in \R^n \, \vert \, h_i(x) = 0\}$. For all $x \in \R^n$, we define the set of active constraints at $x$ by
\[
J(x) = \{ i \in \{1,\dots,m\} ; h_i(x) \le 0 \}
\]
The tangent cone to $S$ at $x$ is given by
\[
T_S(x) = \{v \in R^n \, \vert \, \langle \nabla h_i(x), v \rangle \ge 0, i \in J(x)\}
\]
and for $x \in S$, the normal cone is defined as 
\[
N_S(x) = \left\{\sum_{i \in J(x)} \lambda_i \nabla h_i(x), \lambda_i \le 0 \right\}
\]
For a vector $f \in \R^n$, and a matrix $E$ with $\cE= {\rm im} \, E$, we consider
\[
\Pi_{S,E}(x,f) = \argmin_{v \in T_S(x), v-f \in \cE} \| v - f\|
\]
We will now rewrite $\Pi_{S,E}(x,f)$ in terms of complementarity relations involving $T_S(x)$ and $N_S(x)$.
\begin{figure}[!h]
\centering
\includegraphics[height=5cm]{orthInterp.pdf}
\caption{Orthogonality between $v^*=\Pi_{S,E}(x,f)$ and $\eta^*$, where $\eta^*$ satisfies $v^* - f = E\eta^*$.}
\end{figure}
KintTnotPi
Need to show that optimality (of minimum norm problem) implies cone-complementarity relations.


\vspace{2cm}
{\bf MAURICE: some stuff below, not relevant now. Just kept it, we might see use of it - copy paste then}
 
\section{Preliminaries and classical PDS}

\subsection{Preliminary definitions} 

polyhedral set : given by the intersection of a finite number of closed half-spaces

Let $G= [g_1 \ g_2 \ldots g_{m}] \in \ree^{n \times m}$ and $g_i$, $i=1,2,\ldots, m$ are the columns of $G$. Then $\pos G$ is the convex cone consisting of all positive combinations of the columns of $G$ given by 
\[\pos G = \{ \sum_{i=1}^m \alpha_i g_i \mid \alpha_i \geq 0 i=1,2,\ldots, m \} \]



$T_K(x)$ tangent cone [give definition 5.1.1]
when $K$ closed convex cone we have $T_K(x) = \cl \bigcup_{t>0} \frac{K-x}{t}$ (see Remark 5.2.2. in [Uru] III). In fact, it holds due to convexity that for $x\in K$
\begin{equation}
\label{eq:mon}
 \frac{K-x}{t_2}\subseteq\frac{K-x}{t_1} \text{ when } 0< t_1 \leq t_2\end{equation}




projection on a set $S$

\begin{equation}
P_S(x) = \argmin_{s \in S} \|s-x\| 
\end{equation}


\subsection{Project dynamical systems} \label{subsec:PDS}

To introduce the ``classical'' projected dynamical systems (PDSs), consider a differential equation given by 
\begin{equation}
\dot x(t) = f(x(t))
\end{equation}
in which $x(t)\in \ree^n$ denotes the state at time $t\in \ree_{\geq 0}$. There is a restriction on the state $x$ in the sense that $x(t)$ has to remain inside a set $S\subseteq \ree^n$, which in PDS is ensured by redirecting the vector field at the boundary of $S$. Formally, PDS are given for a continuous vector field $f: \ree^n \rightarrow f$ and set $S\subseteq \ree^n$ (with further additional conditions) by 
\begin{equation} \label{pds1}
\dot x = \Pi_{S}(x,f(x))
\end{equation}
with 
\begin{equation} \label{PiS}
\Pi_{S}(x,v) = \argmin_{w \in T_S(x)} \|w-v\| 
\end{equation}
for $x\in S$ and $v\in \ree^n$. 


An equivalent characterisation of $\Pi_{S}(x,v)$, see [Hiriart-Urr, prop. 5.3.5 ], is 
\begin{equation} \label{PiS_lim}
\Pi_{S}(x,v) = \lim_{\delta \downarrow 0} \frac{P_S(x+\delta v)-x}{\delta}
\end{equation}
when $S$ is a closed convex non-empty set. In fact, in many works on PDS [XXX] this definition is adopted. 


%%[maybe also give the inward normal cone equivalent]

\section{Extended projected dynamical systems}

\subsection{Model representation}

Let set $S\subseteq \ree^n$ be given such that $S$ is a non-empty closed convex set, on which we impose additional conditions later to obtain a well-posed system. We are interested in dynamical systems 
\begin{equation} \label{eq:f} 
\dot x(t) = f(x(t))
\end{equation}
in which the state of the system has to reside inside the set $S$. In classical PDS, as recalled in  Subsection~\ref{subsec:PDS}, the latter is ensured by ``projecting'' the vector field on the (tangent cone of the) set $S$, cf.~\eqref{pds1} and \eqref{PiS}. This projection is along all possible directions of the state in the sense that it just takes the vector 
$\Pi_{S}(x,v) \in T_S(x)$ that is ``closest" to $v$ irrespective of the direction $\Pi_{S}(x,v)-v$. So, it is allowed to alter the complete vector field and thus the velocities of all the states  $x$  in \eqref{eq:f}. Clearly, if  \eqref{eq:f} is a closed-loop system in the sense of an interconnection of a physical plant and a controller (and thus the state $x$ consists of physical plant states $x_p$ and controller states $x_c$), one cannot project in all directions. Indeed, the physical state dynamics cannot be modified by straightforward projection. It is only possible to "project" the controller ($x_c$-)dynamics and possibly a part of the plant states $x_p$-dynamics in which the control input appears explicitly. For an example on the HIGS, see Section XXX below. Hence, in contrast to PDS, we only have limited directions in order to ``correct '' the vector field $f(x)$ at the boundary. To formalize, this we model the  ``correction / projection" direction by the image of a matrix $E \in \ree^{n\times n_E}$, which is assumed to have full column rank. Formally, we get 


\begin{equation} \label{pds2}
\dot x = \Pi_{S,E}(x,f(x))
\end{equation}
with 
\begin{equation} \label{piSE}
\Pi_{S,E}(x,v) = \argmin_{w \in T_S(x), w - v \in \im E} \|w-v\| 
\end{equation}
for $x\in S$ and $v\in \ree^n$. 

Hence, the projection $\Pi$ projects the direction $v$ at $x\in S$ onto the set of admissible velocities (tangent cone) along $\im E$ in such a way that the correction $w-v$ is minimal in norm. For these systems, we coin the term {\em extended Projected Dynamical Systems} (ePDS), as they include the classical PDS \eqref{pds1} as a special case by taking $\im E=\ree^n$.


\subsection{Well-posed projection operator $\Pi_{S,E}$ }

Clearly, we have to show that the introduced projection $ \Pi_{S,E}(x,v)$ is well-defined in the sense that it provides a unique outcome for each $x\in S$ and each $v\in \ree^n$. As in the case of classical PDS, this requires conditions on the set $S$ and, in this case, also on $E$. Although we envision that we can work under more general conditions, for the sake of setting the scene in this paper and inspired by the application of the HIGS, we focus on the setting below. Future work includes relaxing these conditions. 

\begin{assumption} \label{ass1} The set $S\subseteq \ree^n$ and $E \in \ree^{n\times n_E}$ satisfy
\begin{itemize}
\item $S=  K \cup -K$ in which $K$ is a convex polyhedral cone given by $K =\pos G + \im H$ in which the matrix $[G\ H]$ is square and has rank $n$
\item  $K\cap -K =\im G$ 
\item $E$ full column rank
\item $\im E \cap S = \{0\}$ and thus $S + \im E = \ree^n$ 
\end{itemize}
\end{assumption}

Note that $K$ can also be written as 
\begin{equation}
\{ x\in \ree^n \mid Fx \geq 0 \}
\end{equation}
for some matrix $F\in \ree^{n_f \times n}$ (which we assume to be of full rank)

We are particularly interested in this setup as it can describe {\em sector conditions} as are used in reset controllers and the HIGS, e.g. describing that input and output of a controller must have the same sign, and also appear in circle and Popov criteria for the analysis of Lur'e type of systems, see e.g. [Khalil, Yakubovic]

To prove the well-posedness of \eqref{piSE} observe first that 

\begin{equation} \label{TSx}
T_S(x) = \begin{cases} 
T_K(x), & \text{ when } x\in K\setminus -K\\
K\cup - K, & \text{ when } x\in K \cap -K\\
-T_K(x), & \text{ when } x\in -K\setminus K
\end{cases}
\end{equation}

[add expression of $T_K(x) = \{w \in \ree^n \mid F_{I(x)} w \geq 0 \} $ where $I(x) = \{ i \in \{1,2,\ldots, n_f\} \mid F_i x =0\}$ the set of active constraints at $x$

Note that we can rewrite \eqref{piSE} as

\begin{equation} \label{piSE2}
\Pi_{S,E}(x,v) = v + E \eta^*(x,v)
\end{equation}
with 
\begin{equation} \label{piSE2a}
 \eta^*(x,v) = \argmin_{\eta \in \Lambda(x,v)} \|E\eta\|
\end{equation}
and
\begin{equation} \label{piSE2b}
\Lambda(x,v) = \{ \eta \in \ree^{n_E}\mid  v+E\eta \in T_S(x)\}
\end{equation}

\begin{lemma} \label{lem:wp}
Under Assumption~\ref{ass1}, it holds for each $x\in S$ and each $v\in \ree^n$  that $\Lambda(x,v)$ is a non-empty  closed polyhedral set. 
\end{lemma}
\begin{proof} Let $x\in S$ and  $v\in \ree^n$ be given. First note that due to $S+ \im E = \ree^n$ it follows that $\Lambda(x,v) $ is non-empty. 

Clearly, when $x\not\in K \cap -K$ it follows that $T_S(x)$, as given in \eqref{TSx}, is a closed polyhedral cone and then also $\Lambda(x,v) $ is a polyhedral set. 
 So, let us turn our attention to $x\not\in K \cap -K$ in which $T_S(x)=K\cup K$ and thus $\Lambda(x,v) = \{ \eta \in \ree^{n_E}\mid  v+E\eta \in K\cup -K\}$. 

\underline{Claim}: $v+ E\eta \in K$ and $v+ E\bar \eta \in -K$ implies that $\eta = \bar \eta$. 

Note that the Claim would show that if there is $\eta$ with $v+ E\eta \in K$ then $\Lambda(x,v)  = \{ \eta \in \ree^{n_E}\mid  v+E\eta \in K\}$ (as any $\eta$ in $\{ \eta \in \ree^{n_E}\mid  v+E\eta \in -K\}$ would also be contained in $ \{ \eta \in \ree^{n_E}\mid  v+E\eta \in K\}$, and similarly if there is $\bar \eta$ with $v+ E\bar \eta \in -K$ then $\Lambda(x,v)  = \{ \eta \in \ree^{n_E}\mid  v+E\eta \in -K\}$. As the sets $ \{ \eta \in \ree^{n_E}\mid  v+E\eta \in  K\}$  and $ \{ \eta \in \ree^{n_E}\mid  v+E\eta \in - K\}$   are both closed polyhedral sets, so is $\Lambda(x,v) $.

To prove the claim, observe that due to $K$ being a convex cone and $-v- E\bar \eta \in K$, we get that 
\[ E(\eta - \bar \eta) = (v+ E\eta) -v- E\bar \eta \in K\]
Since $\im E\cap S = \{0\}$ and $E$ full column rank, this shows that $\eta=\bar \eta$ and the result follows. 
\end{proof}

Due to the constraint set of \eqref{piSE2a} being a closed polyhedral set, and the square of the cost function of \eqref{piSE2} is $\eta^\top E^\top E \eta$ is a quadratic positive definite function (as $E$ full column rank), a unique minimizer exists, showing the well-posedness of  \eqref{piSE2} and thus  \eqref{piSE}. 

\begin{remark}
In case $x(0) \not\in S$, we can use $x(0+) = P_{S,E}(x(0))$ to reset the state to a state inside $S$. Note that this reset only occurs at the initial time and not afterwards, as the state never leaves $S$ for time $t>0$. 
\end{remark}

\section{Connecting to alternative PDS representations}

As already indicated in Subsection~\ref{sec:pds}, there is an equivalence between the definitions \eqref{piS} and \eqref{PiS_lim} under certain conditions on the set $S$. In this section, the objective to establish a similar equivalence for ePDS. 

To do so, let us first introduce
\begin{equation}
P_{S,E}(x) = \argmin_{s \in S, s-x\in \im E} \|s-x\| 
\end{equation}

Clearly, we can rewrite \eqref{piSE} as 
\begin{equation}
P_{S,E}(x) = \argmin_{s\in C_x} \|s-x\| \text{ with } C_x :=\{s \in S \mid  s-x\in \im E \}
\end{equation}
Note that, although this formulation resembles  \eqref{piS}, the set $C_x=S \cap (x + \im E)$ is dependent on $x$, which is not the case in \eqref{piS}. Observe that $C_x$ is a non-empty closed and convex set, as can be seen from a similar reasoning as in the proof of Lemma~\ref{lem:wp}. In fact, this yields that  $C_x$ is equal to $\{s\in K \mid s-x \in \im E\}$ or  $\{s\in -K \mid s-x \in \im E\}$ due to the following implication:

\[ \left. \begin{array}{c} s-x\in \im E, \ s\in K \\\bar s-x\in \im E, \ \bar s\in K \end{array} \right\} \text{ imply } s = \bar s \]

Hence, $P_{S,E}(x) =  P_{K,E}(x)$ (if $x\in K+\im E$) or  $P_{S,E}(x) =  P_{-K,E}(x)$ (if $x\in -K + \im E)$ and thus $P_{S,E}(x) $ gives a unique outcome, see, e.g., the reasoning on page 116 of [Uru]. Note that based on Theorem 3.3.1 in [Uru] and using the previous observation, we have that $P_{S,E}(x) $ is characterised by the following {\em variational inequalities}: $s_x$ is equal to $P_{S,E}(x)$ if and only if 
\begin{equation} \label{eq:VI}
\langle x -s_x, s- s_x \rangle \leq 0 \text{ for all } s\in S \cap (x + \im E)
\end{equation}

In line with \eqref{PiS_lim} for classical PDS, we consider also 

\begin{equation}
\tilde \Pi_{S,E}(x,v) = \lim_{\delta \downarrow 0} \frac{P_{S,E}(x+\delta v)-x}{\delta}
\end{equation}


\begin{theorem}
Assumption~\ref{ass1}, it holds that
 $\tilde \Pi_{S,E}(x,v) =  \Pi_{S,E}(x,v)$ for all $x\in S$ and $v\in \ree^n$
\end{theorem}
\begin{proof}
Following the arguments of the proof of Prop. 5.3.5 in [Uru], we can obtain that $\frac{P_{S,E}(x+\delta v)-x}{\delta}$ is equal to $P_{\frac{S-x}{\delta},E}(v)$. 
Indeed, using the variational inequalities characterisation of projections, we have that \eqref{eq:VI} for $s_\delta:= P_{S,E}(x+\delta v)$ gives that 
\[ \langle x + \delta v-s_\delta, s- s_\delta \rangle \leq 0 \text{ for all } s\in S, \ s-(x+\delta v) \in \im E \]
Hence, straightforward algebraic manipulations give  for $\delta > 0$ that
\[ \langle v -  \frac{s_\delta-x}{\delta},  \frac{s-x}{\delta} -  \frac{s_\delta-x}{\delta} \rangle \leq 0 \text{ for all } s\in S, \ s-(x+\delta v) \in \im E \]
and thus 
\[ \langle v - \tilde s,  \tilde s -  \frac{s_\delta-x}{\delta} \rangle \leq 0 \text{ for all } \tilde s\in \frac{S-x}{\delta}, \ \tilde s- v \in \im E \]
where we took $\tilde s = \frac{s-x}{\delta}$.  From this we conclude indeed that $\frac{P_{S,E}(x+\delta v)-x}{\delta} =  \frac{s_\delta-x}{\delta} = P_{\frac{S-x}{\delta},E}(v)$

Now we use that $T_S(x) = \lim_{\delta \downarrow 0} \frac{S-x}{\delta}$ (and the monotonicity of $\delta \mapsto \frac{S-x}{\delta}$ as in \eqref{eq:mon})  together with the fact that $ \frac{S-x}{\delta}$ and the  limit $T_S(x)$  are (the union of) convex closed sets, that  $\tilde \Pi_{S,E}(x,v) = P_{T_S(x),E}(v) =\Pi_{S,E}(x,v)$. 
%First of all, note that $\tilde \Pi_{S,E}(x,v) = \lim_{\delta \downarrow 0} \frac{P_{S,E}(x+\delta v)-x}{\delta} \in T_S(x)$ by definition of the tangent cone as $P_{S,E}(x+\delta v) \in S$ for all $\delta$. Moreover, note that $\tilde \Pi_{S,E}(x,v)-v =  \lim_{\delta \downarrow 0} \frac{P_{S,E}(x+\delta v)-(x + \delta v)}{\delta} \in \im E$ due to $P_{S,E}(x+\delta v)-(x + \delta v) \in \im E$ by definition of $P_{S,E}$ and closedness of $\im E$. Hence,$\tilde \Pi_{S,E}(x,v)$ in the feasible set of the minimization problem corresponding to \eqref{PiSE}. 
\end{proof}





%
%
\bibliographystyle{siam}
\bibliography{refr,bib_nahs_v3}


\end{document}


