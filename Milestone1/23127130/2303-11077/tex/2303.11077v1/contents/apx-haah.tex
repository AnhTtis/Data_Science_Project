\section{Haah's Construction of QSP Polynomials}
\label{apx:haah-construction}

Here we briefly review the Quantum Signal Processing technique, in its Laurent-polynomial formulation. We suggest~\cite{martynGrandUnificationQuantum2021, haahProductDecompositionPeriodic2019, chaoFindingAnglesQuantum2020} for a more comprehensive discussion on the topic. Given an arbitrary unitary $W$, consider the following matrix:
\begin{align*}
    \Tilde{W} = \begin{bmatrix}
        W & 0 \\
        0 & W^\dag
    \end{bmatrix} .
\end{align*}
This corresponds to a circuit that applies $W$ or its inverse $W^\dag$, depending on the state of a control qubit. If we feed an eigenstate $\ket{\theta}$ with associated eigenvalue $w = e^{i\theta}$, by a phase kickback the control qubit undergoes a unitary transformation of the form
\begin{align*}
    \Tilde{w} = \begin{bmatrix}
        w & 0 \\ 0 & w^{-1}
    \end{bmatrix} .
\end{align*}
This is the idea behind a technique called \emph{qubitization}~\cite{lowHamiltonianSimulationQubitization2019}, where one can apply Quantum Signal Processing polynomials simultaneously on all the eigenvalues of a unitary given as a black-box (in our case $W$), giving birth to the so-called \emph{quantum eigenvalue transform}. From now on we consider $w$ as an arbitrary unitary eigenvalue, and we want to understand which transformations can be realized. One can see that a unitary of the form
\begin{align}
    \label{eq:haah-primitive-decomposition}
    U(\Tilde{w}) = Q_n \cdot \Tilde{w} \cdot Q_n^\dag \cdots Q_1 \cdot \Tilde{w} \cdot Q_1^\dag \cdot Q_0
\end{align}
gives a $2$-by-$2$ matrix of \emph{Laurent polynomials} (or equivalently, a Laurent polynomial with $2$-by-$2$ matrices as coefficients), and the maximum degree of this polynomial is $n$. Roughly speaking, we construct a circuit where the $Q_i$'s act on the control qubit and $\Tilde{w}$ is replaced with the controlled unitary $\Tilde{W}$. We are mainly interested in two sub-algebras of the matrices above.
\begin{definition}
    The \emph{Haah algebra} $H$ is the sub-algebra of the ring of Laurent polynomials over $2$-by-$2$ complex matrices of the form
    \begin{align*}
        a(\Tilde{w}) + b(\Tilde{w}) \cdot iX + c(\Tilde{w}) \cdot iY + d(\Tilde{w}) \cdot iZ
    \end{align*}
    where $a, b, c, d$ are polynomials with real coefficients.
\end{definition}
\noindent In other words, the Haah algebra is the polynomial ring $H \simeq \R[iX, iZ, \Tilde{w}]$. An important sub-algebra of the Haah algebra, which is also the most interesting one for practical implementations is the \emph{Low algebra}.
\begin{definition}
    The \emph{Low algebra} $L$ is the sub-algebra of the ring of Laurent polynomials over $2$-by-$2$ complex matrices of the form
    \begin{align*}
        a(\Tilde{w}) + b(\Tilde{w}) \cdot iX
    \end{align*}
    where $a, b$ are Laurent polynomials with real coefficients.
\end{definition}
\noindent Analogously as before we have $L \simeq \R[iX, \Tilde{w}]$.

\begin{theorem}[Haah~\cite{haahProductDecompositionPeriodic2019}]
    \label{thm:haah-construction}
    An element $U(w) \in H$ that is unitary and has definite parity (i.e.\ $a, b, c, d$ are either all even or all odd Laurent polynomials) is always decomposable as in (\ref{eq:haah-primitive-decomposition}), in a unique way (up to global phase).

    Furthermore, if $U(w) \in L$ then all $Q_i \in L$. In particular, they will be $X$-rotations.
\end{theorem}
\noindent The Low algebra is useful exactly because it is practical, as we only have to define the phases of the $X$-rotations. The decomposition using the Low algebra thus simply reduces to the $W_z$-convention of the traditional formulation of the QSP~\cite{lowMethodologyResonantEquiangular2016,martynGrandUnificationQuantum2021}. On the other hand, while Low algebra only allows the implementation of Laurent polynomials with real coefficients, Haah algebra can even represent polynomials with complex coefficients.

In applications, we are usually interested in a single transformation of the unitary, i.e., given $\Tilde{W}$ we would like to implement $f(W)$ for some Laurent polynomial $f$ that satisfies $|f|^2 \le 1$ on the unit circle. In order to do this we need an element $F(\Tilde{w})$ of the Haah algebra containing $f$ as a particular entry, which determines the initial state and the state to post-select on the control qubit. Here we will only use the top-left entry, $f(w) = \bra{0} F(\Tilde{w}) \ket{0}$, i.e.\ we will start and post-select $\ket{0}$. The question now is whether we can find the polynomials $a, b, c, d$ such that we obtain $f$ in the top-left entry.






\iffalse
\begin{theorem}[Haah~\cite{haahProductDecompositionPeriodic2019}]
    \label{thm:haah-construction}
    Let $F(t) : U(1) \rightarrow SU(2)$ be a Laurent polynomial of degree $n$ with definite parity. Such function can be decomposed into a product of $n$ single-qubit unitaries of the form
    \begin{align*}
        E_{P_i}(t) = t P_i + t^{-1} (\id - P_i) = Q_i
        \begin{bmatrix}
            t & 0 \\
            0 & t^{-1}
        \end{bmatrix} Q_i^{\dag}.
    \end{align*}
    where $P_i$ is a rank-1 matrix, and $Q_i \ketbra{0}{0} Q_i^\dag = P_i$.
\end{theorem}
This result by Haah gives a simple and general construction implementing Quantum Signal Processing polynomials: in particular, the diagonal matrix above can be seen as the phase kickback induced by the application of a controlled unitary
\begin{align*}
    \Tilde{W} = \begin{bmatrix}
        W & 0 \\
        0 & W^\dag
    \end{bmatrix}
\end{align*}
when we apply an eigenstate associated with eigenvalue $t$. This technique is called qubitization~\cite{lowHamiltonianSimulationQubitization2019, haahProductDecompositionPeriodic2019}, and a nice exposition of this circuit decomposition can be found in~\cite{chaoFindingAnglesQuantum2020}. In applications, one generally wants to implement a polynomial $f(t) : U(1) \rightarrow \C$, given as a particular entry of the $2$-by-$2$ unitary matrix, so that we can implement $f(W)$. Hence, our next question is about how we can embed our desired polynomial $f(t)$ into a $SU(2)$-valued polynomial as defined in Theorem~\ref{thm:haah-construction}, and which conditions on $f$ are necessary and/or sufficient in order for this embedding to be possible.

An important observation made by Haah is that an element $F$ of $SU(2)$ can be rewritten as a real linear combination
\begin{align*}
    F = a \id + b i X + c i Y + d i Z
\end{align*}
with $a^2 + b^2 + c^2 + d^2 = 1$. In particular, if $F(t)$ is such that $F(t) \in SU(2)$ for $t \in U(1)$, then $a(t), b(t), c(t), d(t)$ can be seen as polynomials taking real values on the same domain. This structure was called \emph{Haah algebra}~\cite{chaoFindingAnglesQuantum2020}.

If we restrict this algebra to the so-called \emph{Low sub-algebra} (i.e.\ $c \equiv d \equiv 0$), there are already results telling us that a class of functions can be achieved.

\begin{theorem}[Completion]
    Let $a(t)$ be such that $a^2(t)$ is reciprocal, has real coefficients and satisfies $a^2(t) < 1$ for every $t \in U(1)$. There exists a polynomial $b(t)$ such that:
    \begin{align*}
        a(t) \cdot \id + b(t) \cdot i X \in SU(2)
    \end{align*}
    for every $t \in U(1)$.
\end{theorem}

\begin{proof}
    In other words we need to satisfy the condition $a(t) \cdot a^*(t) + b(t) \cdot b^*(t) \equiv 1$, or
    \begin{align}
        \label{eq:low-completion-su-condition}
        b(t) \cdot b^*(t) = 1 - a(t) \cdot a(1/t) = 1 - a^2(t)
    \end{align}
    The first equality comes from the fact that $a$ has real coefficients, while the second one is guaranteed by reciprocity. No roots can lie on the unit circle by hypothesis, therefore all of its roots must be either inside or outside of the unit circle. Moreover, by reciprocity, if $a^2(t) = 1$ implies $a^2(1/t) = 1$. Let $\mathcal{D}$ be the multiset of the roots of $1 - a^2$ within the unit circle. Therefore, our polynomial can be rewritten as:
    \begin{align}
        \label{eq:low-completion-decomposition}
        1 - a^2(t) = \alpha \prod_{r \in \mathcal{D}} (t - r) (1/t - r)
    \end{align}
    where $\alpha$ is some proportionality constant. Reality of the coefficients also imply that the roots $r$ in Eq. (\ref{eq:low-completion-decomposition}) either are real, or come in complex conjugate pairs. Moreover, one can see that
    \begin{align*}
        1 - a^2(1) = \alpha \prod_{r \in \mathcal{D}} (1 - r)^2
    \end{align*}
    and, since $\mathcal{D}$ is closed under complex conjugation, we can conclude that the product is real and positive, implying that $\alpha$ is real and positive as well. If we take, for example
    \begin{align*}
        b(t) = \sqrt{\alpha} \prod_{r \in \mathcal{D}} (t - r)
    \end{align*}
    one can see that this has real coefficients as well, and $b(t) \cdot b^*(t) = b(t) \cdot b(1/t)$ satisfies Eq. (\ref{eq:low-completion-su-condition}).
\end{proof}
Let us remark an important fact about the condition on the reciprocity of $a^2(t)$: $a^2$ being reciprocal with real coefficients means that either $a(t)$ is also reciprocal (with real coefficients), or anti-reciprocal (with imaginary coefficients). The first case comes from a cosine series, while the second case is yielded by a sine series. Similar (but not equivalent) to the original QSP constraints, the function $\theta \mapsto a(e^{i \theta})$ has to be of definite parity for this completion to succeed. On the other hand, it is worth highlighting that the constraint $a^2(t) < 1$ is never a problem in applications, as we can always multiply all the coefficients of the polynomial by a constant $c < 1$, incurring only a multiplicative constant on the failure probability, which can be easily re-amplified.

We now try to give a more general completion procedure, including polynomials with complex coefficients.
\fi

\begin{theorem}[Haah's completion~\cite{haahProductDecompositionPeriodic2019}, restated]
    \label{thm:haah-completion}
    Given real-valued polynomials $a(w), d(w) : U(1) \rightarrow \R$, let 
    $$f(w) = a(w) + i d(w)$$
    be a function such that the polynomial $|f|^2 = a^2 + d^2$ is reciprocal (i.e.\ $|f(w)|^2 = |f(w^{-1})|^2$), has real coefficients and satisfies $|f(w)|^2 < 1$ on the unit circle.
    There exist polynomials $b(w), c(w)$ such that
    \begin{align*}
        a(\Tilde{w}) + b(\Tilde{w}) \cdot iX + c(\Tilde{w}) \cdot iY + d(\Tilde{w}) \cdot iZ \in SU(2)
    \end{align*}
    for every $t \in U(1)$.
\end{theorem}
Note that, with the given construction, $f(w)$ is present on the top-left corner of the matrix, while the bottom-right entry contains $(f(w^{-1}))^*$.
\begin{proof}
    On the unit circle, this translates to the condition
    \begin{align*}
        a^2(w) + b^2(w) + c^2(w) + d^2(w) \equiv 1.
    \end{align*}
    The polynomial $p(w) = 1 - a^2(w) - d^2(w)$ has degree $n' \le 2n$ (in Laurent polynomials leading terms could cancel out). Moreover, by the conditions on $|f|^2$, it has real coefficients, all its roots are outside the unit circle, and by reciprocity for any root $r$ also $1/r$ is a root. Therefore, using $\mathcal{D}$ to denote the multiset of roots within the unit circle, the expression becomes
    \begin{align}
        \label{eq:haah-construction-roots}
        p(t) = \alpha \prod_{r \in \mathcal{D}} (w - r) (1/w - r)
    \end{align}
    for some proportionality constant $\alpha$. Keep in mind that $|\mathcal{D}| = n'$. Let us now define
    \begin{align*}
        e(w) := w^{-\lfloor n'/2 \rfloor} \prod_{r \in \mathcal{D}} (w - r) \ .
    \end{align*}
    In this way, $\alpha \cdot e(w) \cdot e(1/w) = p(w)$. Note that the factor in front of the product is used to â€˜center' the exponents of $e(w)$, so that its degree is $\lceil n'/2 \rceil \le n$. This however, does not affect the equality we just stated.
    Plugging $t = 1$ in Eq.\ (\ref{eq:haah-construction-roots}) gives real and positive expressions on both sides (complex roots cannot not give negative contributions, since they all come in complex conjugate pairs, by reality of the coefficients). Hence we conclude that $\alpha$ is positive.
    \begin{align*}
        p(t) & = \alpha \cdot e(w) \cdot e(1/w) \\
        & = \left( \frac{e(w) + e(1/w)}{2} \sqrt{\alpha} \right)^2 + \left( \frac{e(w) - e(1/w)}{2i} \sqrt{\alpha} \right)^2 \ ,
    \end{align*}
    and we can choose the two expressions in the tuples as $b(w), c(w)$, for example. They will have both degree $\le \lceil n'/2 \rceil \le n$.
\end{proof}
It is interesting to remark that the reciprocity of $|f(w)|^2$ implies the reciprocity of $a^2(w) + d^2(w)$. Under this assumption, we have that $a^2$ is reciprocal if and only if $d^2$ is reciprocal. If the square of a polynomial is reciprocal with real coefficients, then the original polynomial is either reciprocal itself with real coefficients (cosine transform), or anti-reciprocal with imaginary coefficients (sine transform). On the other hand, if $a^2$ is not reciprocal, then in order to maintain reciprocity of the sum we need $a^2(w) = d^2(1/w)$, or simply $a(w) = \pm d(1/w)$. In this last case, $a(w)$ and $d(w)$ do not need to have real nor imaginary coefficients as long as they are real-valued for any $w \in U(1)$. Also as pointed out by Haah, (anti-)reciprocity is not a severe restriction, since any function can be decomposed into a sum of reciprocal and anti-reciprocal components, which can be implemented separately and then summed using a circuit like in Figure~\ref{fig:block-encoding-sum-circuit}, incurring on at most a constant factor on the failure probability.