\documentclass[conference]{IEEEtran}
\usepackage{times}

% numbers option provides compact numerical references in the text. 
\usepackage[numbers]{natbib}
\usepackage{multicol}
\usepackage[bookmarks=true]{hyperref}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{tabularx}
\usepackage[dvipsnames]{xcolor}
\usepackage[pdftex]{graphicx}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{subcaption}
\usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\textcolor{OliveGreen}{\ding{51}}}
\newcommand{\xmark}{\textcolor{Maroon}{\ding{55}}}%
\usepackage{lipsum}

\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}
\usepackage[noend]{algpseudocode}
\usepackage[ruled,vlined, linesnumbered, noend]{algorithm2e}
\include{language-macros.tex}

\newcommand{\jon}[1]{\textcolor{blue}{jon: #1}}
\newcommand{\guy}[1]{\textcolor{blue}{guy: #1}}

\pdfinfo{
   /Author (Ameesh Shah, Jon DeCastro, John Gideon, Beyazit Yalcinkaya, Guy Rosman, Sanjit A. Seshia)
   /Title  (Specification-Guided Data Aggregation for Semantically Aware Imitation Learning)
   /CreationDate (D:20101201120000)
   /Subject (Imitation Learning)
   /Keywords (Environment Generation, Imitation Learning, Formal Methods, Sampling Methods)
}

\begin{document}

% paper title
\title{Specification-Guided Data Aggregation for Semantically Aware Imitation Learning}

% You will get a Paper-ID when submitting a pdf file to the conference system
% \author{Author Names Omitted for Anonymous Review. Paper-ID 180}

% \author{\authorblockN{Ameesh Shah}
% \authorblockA{UC Berkeley}
% \and
% \authorblockN{Jon DeCastro}
% \authorblockA{Toyota Research Institute}
% \and
% \authorblockN{James Kirk\\ and Montgomery Scott}
% \authorblockA{Starfleet Academy\\
% San Francisco, California 96678-2391\\
% Telephone: (800) 555--1212\\
% Fax: (888) 555--1212}}


% avoiding spaces at the end of the author lines is not a problem with
% conference papers because we don't use \thanks or \IEEEmembership


% for over three affiliations, or if they all won't fit within the width
% of the page, use this alternative format:
% 
\author{\authorblockN{Ameesh Shah\authorrefmark{1},
Jon DeCastro\authorrefmark{2},
John Gideon\authorrefmark{2}, 
Beyazit Yalcinkaya\authorrefmark{1},
Guy Rosman\authorrefmark{2},
Sanjit A. Seshia\authorrefmark{1}}
\authorblockA{\authorrefmark{1}UC Berkeley \authorrefmark{2}Toyota Research Institute}
\authorblockA{Correspondence to: \texttt{ameesh@berkeley.edu} }}



\maketitle

\begin{abstract}
Advancements in simulation and formal methods-guided \textit{environment sampling} have enabled the rigorous evaluation of machine learning models in a number of safety-critical scenarios, such as autonomous driving. 
%Less well studied is the application of these environment sampling techniques towards improving the performance of learned models themselves. 
Application of these environment sampling techniques towards improving the learned models themselves has yet to be fully exploited. 
% Training imitation learning agents under these environments, however, could lead to inaccurate models, as they are subjected to biased environments while training. 
% as the models are trained with environment samples that fail to probe more specific and subtle behaviors of these models.
In this work, we introduce a novel method for improving imitation-learned models in a \textit{semantically aware} fashion by leveraging specification-guided sampling techniques as a means of aggregating expert data in new environments. Specifically, we create a set of formal specifications as a means of partitioning the space of possible environments into semantically similar regions, and identify elements of this partition where our learned imitation behaves most differently from the expert. We then aggregate expert data on environments in these identified regions, leading to more accurate imitation of the expert's behavior semantics. 
%We collect additional expert data in environments that belong to these regions and use it to train an imitation that more accurately imitates an expert in semantically meaningful, but often uncommon scenarios.
%Our approach leads to a learned model that more accurately imitates an expert, especially in semantically meaningful but uncommon scenarios.
We instantiate our approach in a series of experiments in the CARLA driving simulator, and demonstrate that our approach leads to models that are more accurate than those learned with other environment sampling methods.
%, and systematically sample from different elements of our partition to improve the accuracy of an expert imitation. Specifically, we 
% In this work, we integrate environment sampling methods into a data-aggregation loop to improve the performance of imitation learning models. We do so by constructing a set of formal specifications from a user-provided set of properties, and using this set to sample environments that lead to drastically different behaviors between our expert and learned imitation.
% In this work, we construct a set of formal specifications from a user-provided set of properties and use this set to sample environments for imitation learning. This leads to drastically different behaviors between our expert and learned imitation.
% These environment samples are used in the next round of expert data collection, and we re-train on the aggregated data to reduce the observed difference in behavior. 

% Advancements in simulation and formal methods-guided \textit{environment sampling} have enabled the rigorous evaluation of machine learning models in a number of safety critical scenarios, such as autonomous driving. 
% Less well studied is the application of these environment sampling techniques towards improving the performance of learned models themselves. 
% In this work, we introduce a method that leverages \textit{formal specifications} as a semantic partition of the space of possible environments, and systematically sample from different elements of this partition to improve the accuracy of an expert imitation. Specifically, we use our partition to identify environments that lead to semantically different behaviors between the expert and our learned model, and collect expert data in those environments via a data-aggregation loop.
% We instantiate our approach in a series of experiments in the CARLA driving simulator, and demonstrate that our approach leads to models that are comparatively more accurate than those learned with other environment sampling methods.

\end{abstract}

\IEEEpeerreviewmaketitle
\section{Introduction}
% This demo file is intended to serve as a ``starter file" for the
% Robotics: Science and Systems conference papers produced under \LaTeX\
% using IEEEtran.cls version 1.7a and later.
\input{introduction}
% Story outline:
% \begin{enumerate}
%     \item Motivation: we want to accurately model human behavior - training autonomous agents (AA) or robots in simulation requires having highly accurate models of human behavior in those simulations as well, especially in safety-critical domains like Autonomous Vehicles (AV).
%     \item We often turn to imitation learning (IL) as a general, easy-to-use solution for modeling humans or other agents where we don't have other signals (like a ground truth reward function, or a set of features over which we can infer a reward function like in IRL.) however, imitation learned agents still fail unpredictably when they see observations out of their training distribution - a classic and well observed problem
%     \item A number of efforts have worked on this problem. Notably, DAgger \cite{dagger} and many of its follow-up works have tried to switch operation between an IL-learned AA and a human expert in order to collect more human data on potentially out-of-distribution states that the AA may have gotten itself into. However, there could exist observations that neither the AA or the human expects that appear during deployment and weren't seen during training. This necessitates methods to find the correct environmental conditions that will in turn lead to observations that are diverse and important to us. Such methods are particularly important in domains like safe autonomy, where a collected dataset may not contain safety-critical environment conditions.
%     \item We hypothesize that leveraging controllable environments (i.e. simulators) to sample diverse environmental conditions and collect the corresponding data from an expert will lead to a more accurate imitation model.
%     \item More specifically, we advocate for the use of \textit{formal specifications} as an approach to describing the diversity outcomes that can result from a learned policy interacting with its environment. More precisely, we transform an initial set of \textit{properties of interest} with respect to agent behavior into a set of boolean logical formulae. This set of formulae characterizes the \textit{entire} space of agent outcomes and can be used to guide a principled sampling of environment conditions to lead to the satisfaction of certain specifications.
%     % For example, in the context of AVs, a user might specify properties that require an AV to stay within certain speed bounds, avoid collisions, and remain in its lane. This specification provides us the methodology to obtain diverse and important data - we'd like to find the correct environment conditions that cause this property to fail in \textit{all} possible ways. 
%     \item Our work demonstrates the effectiveness of guiding data aggregation with formal specifications. We assume access to an initial dataset, and user-provided set of boolean properties. We train an initial IL model on the provided dataset, and deploy it in a simulated environment. We then sample parameters of the simulated environment in order to collect as diverse a set of agent outcomes as possible, and record the environment conditions that induced those outcomes. Those parameters can then be used in a subsequent round of data collection to collect more diverse and valuable data.
% \end{enumerate}

\section{Related Work}

\input{related}

\section{Methodology}

\input{problem}

% \subsection{Subsection Heading Here}
% Subsection text here.

% \subsubsection{Subsubsection Heading Here}
% Subsubsection text here.
\section{Experimental Setup}

\input{experiment}



% Please make sure to include \verb!natbib.sty! and to use the
% \verb!plainnat.bst! bibliography style. \verb!natbib! provides additional
% citation commands, most usefully \verb!\citet!. For example, rather than the
% awkward construction 

% {\small
% \begin{verbatim}
% \cite{kalman1960new} demonstrated...
% \end{verbatim}
% }

% \noindent
% rendered as ``\cite{kalman1960new} demonstrated...,''
% or the
% inconvenient 

% {\small
% \begin{verbatim}
% Kalman \cite{kalman1960new} 
% demonstrated...
% \end{verbatim}
% }

% \noindent
% rendered as 
% ``Kalman \cite{kalman1960new} demonstrated...'', 
% one can
% write 

% {\small
% \begin{verbatim}
% \citet{kalman1960new} demonstrated... 
% \end{verbatim}
% }
% \noindent
% which renders as ``\citet{kalman1960new} demonstrated...'' and is 
% both easy to write and much easier to read.
  
% \subsection{RSS Hyperlinks}

% This year, we would like to use the ability of PDF viewers to interpret
% hyperlinks, specifically to allow each reference in the bibliography to be a
% link to an online version of the reference. 
% As an example, if you were to cite ``Passive Dynamic Walking''
% \cite{McGeer01041990}, the entry in the bibtex would read:

% {\small
% \begin{verbatim}
% @article{McGeer01041990,
%   author = {McGeer, Tad}, 
%   title = {\href{http://ijr.sagepub.com/content/9/2/62.abstract}{Passive Dynamic Walking}}, 
%   volume = {9}, 
%   number = {2}, 
%   pages = {62-82}, 
%   year = {1990}, 
%   doi = {10.1177/027836499000900206}, 
%   URL = {http://ijr.sagepub.com/content/9/2/62.abstract}, 
%   eprint = {http://ijr.sagepub.com/content/9/2/62.full.pdf+html}, 
%   journal = {The International Journal of Robotics Research}
% }
% \end{verbatim}
% }
% \noindent
% and the entry in the compiled PDF would look like:

% \def\tmplabel#1{[#1]}

% \begin{enumerate}
% \item[\tmplabel{1}] Tad McGeer. \href{http://ijr.sagepub.com/content/9/2/62.abstract}{Passive Dynamic
% Walking}. {\em The International Journal of Robotics Research}, 9(2):62--82,
% 1990.
% \end{enumerate}
% %
% where the title of the article is a link that takes you to the article on IJRR's website. 


% Linking cited articles will not always be possible, especially for
% older articles. There are also often several versions of papers
% online: authors are free to decide what to use as the link destination
% yet we strongly encourage to link to archival or publisher sites
% (such as IEEE Xplore or Sage Journals).  We encourage all authors to use this feature to
% the extent possible.

\section{Conclusion} 
\label{sec:conclusion}

\input{conclusion}

% for double-blind review, the ack below should be added only after submission (for sharing with TRI)
\section*{Acknowledgments}
Toyota Research Institute provided funds to support this work. A. Shah is supported by the Office of Naval Research under an NDSEG Fellowship.

%% Use plainnat to work nicely with natbib. 
\clearpage

\bibliographystyle{plainnat}
\bibliography{references}
\clearpage

\section*{Appendix}
\input{appendix}
\end{document}


