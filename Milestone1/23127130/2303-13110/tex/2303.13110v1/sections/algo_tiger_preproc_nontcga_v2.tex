\begin{algorithm*}
    \caption{TIGER pre-processing step for non-TCGA samples}
    \label{alg:nontcga_preproc}
    \begin{algorithmic}[1]
        \State \textbf{Input} $\mathcal{D}_{nonTCGA}$ \Comment{Non-TCGA dataset}
        \State \textbf{Output} $\mathcal{D}_{proc}$ \Comment{Pre-processed dataset}
        \State $\mathcal{D}_{proc} \gets [\hspace{0.25em}] $
        \State $Sz_c$, $Sz_t$ $\gets$ 128, 512  \Comment{Cell and tissue patch sizes, respectively}
        \ForAll{$(img, mask, bboxes)$ \textbf{in} $\mathcal{D}_{nonTCGA}$} \Comment{Looping over perfectly overlapping cell-tissue images}
            \State $H$, $W$ $\gets$ Size($img$) \Comment{Image dimension}
            \If{$H > 1024$ and $W > 1024$} \Comment{Consider only large samples}
                \ForAll{$(i_t,j_t) \in  [0..H_t/Sz_t]\times[0..W_t/Sz_t]$} \Comment{Tissue 2D patch loop}
                        \State $y_t, x_t \gets i_t \cdot Sz_t,  j_t \cdot Sz_t$ \Comment{Define top-left coordinates of the tissue patch}
                        \State $img_t \gets$ Crop($img$, ($y_t,x_t$), $Sz_t$) \Comment{Cropping tissue patch}
                        \State $mask_t \gets$ Crop($mask$, ($y_t,x_t$), $Sz_t$)
                        \State $resImg_t \gets$ Resize($img_t$, ($Sz_c$, $Sz_c$))  \Comment{Matching tissue to cell size}
                        \State $resMask_t \gets$ Resize($mask_t$, ($Sz_c$, $Sz_c$))
                        \ForAll{$(i_c,j_c) \in [0..Sz_t/Sz_c] \times [0..Sz_t/Sz_c]$} \Comment{Cell 2D sub-patch loop}
                                \State $y_c, x_c \gets i_c \cdot Sz_c, j_c \cdot Sz_c$ \Comment{Define cell patch coordinates}
                                \State $img_c \gets$ Crop($img_t$, ($y_c,x_c$), $Sz_t$) \Comment{Cropping cell sub-patch in tissue patch}
                                \State $bboxInPatch \gets$ FilterBboxes($bboxes, y_c + y_t, x_c + y_t, Sz_c$) \Comment{Removing bboxes off the cell sub-patch}
                                \State AppendTo($\mathcal{D}_{proc}$, ($img_c$, $bboxes_c$, $resImg_t$, $resMask_t$)) \Comment{Save sample in pre-processed dataset}
                        \EndFor
                \EndFor
            \EndIf
        \EndFor
    \end{algorithmic}
\end{algorithm*}
