

\tikzset {_25jhuad2o/.code = {\pgfsetadditionalshadetransform{ \pgftransformshift{\pgfpoint{202.5 bp } { -312 bp }  }  \pgftransformscale{3 }  }}}
\pgfdeclareradialshading{_ogp9xau3h}{\pgfpoint{-72bp}{104bp}}{rgb(0bp)=(1,1,1);
rgb(0bp)=(1,1,1);
rgb(25bp)=(0.96,0.42,0.42);
rgb(400bp)=(0.96,0.42,0.42)}
\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

%Straight Lines [id:da2616387176331003] 
\draw    (510,235) -- (510,260) -- (335,260) -- (335,222) ;
\draw [shift={(335,220)}, rotate = 90] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Rounded Rect [id:dp03613153038029404] 
% \draw  [fill={rgb, 255:red, 235; green, 16; blue, 16 }  ,fill opacity=0.14 ][dash pattern={on 3.75pt off 3pt on 7.5pt off 1.5pt}] (260,149.79) .. controls (260,133.89) and (272.89,120.99) .. (288.8,120.99) -- (566.2,120.99) .. controls (582.11,120.99) and (595,133.89) .. (595,149.79) -- (595,236.2) .. controls (595,252.11) and (582.11,265) .. (566.2,265) -- (288.8,265) .. controls (272.89,265) and (260,252.11) .. (260,236.2) -- cycle ;

%Rounded Rect [id:dp03613153038029404] 
\path  [shading=_ogp9xau3h,_25jhuad2o] (260,149.79) .. controls (260,133.89) and (272.89,120.99) .. (288.8,120.99) -- (561.5,120.99) .. controls (577.41,120.99) and (590.3,133.89) .. (590.3,149.79) -- (590.3,236.2) .. controls (590.3,252.11) and (577.41,265) .. (561.5,265) -- (288.8,265) .. controls (272.89,265) and (260,252.11) .. (260,236.2) -- cycle ; % for fading 
 \draw  [dash pattern={on 3.75pt off 3pt on 7.5pt off 1.5pt}] (260,149.79) .. controls (260,133.89) and (272.89,120.99) .. (288.8,120.99) -- (561.5,120.99) .. controls (577.41,120.99) and (590.3,133.89) .. (590.3,149.79) -- (590.3,236.2) .. controls (590.3,252.11) and (577.41,265) .. (561.5,265) -- (288.8,265) .. controls (272.89,265) and (260,252.11) .. (260,236.2) -- cycle ; % for border 

%Straight Lines [id:da23275540808963835] 
\draw    (240,190) -- (278,190) ;
\draw [shift={(280,190)}, rotate = 180] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Straight Lines [id:da9749785415808208] 
% \draw    (560,190) -- (600,190) -- (600,270) -- (60,270) -- (60,200) ;
% \draw [shift={(60,198)}, rotate = 90] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Rounded Rect [id:dp2623862612122092] 
\draw  [fill={rgb, 255:red, 74; green, 158; blue, 235 }  ,fill opacity=0.36 ] (105,172) .. controls (105,165.37) and (110.37,160) .. (117,160) -- (178,160) .. controls (184.63,160) and (190,165.37) .. (190,172) -- (190,208) .. controls (190,214.63) and (184.63,220) .. (178,220) -- (117,220) .. controls (110.37,220) and (105,214.63) .. (105,208) -- cycle ;
%Straight Lines [id:da1323253286278716] 
\draw    (413,190) -- (443,189.62) ;
\draw [shift={(445,189.6)}, rotate = 179.28] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Rounded Rect [id:dp6772219692433397] 
\draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (444.44,163.48) .. controls (444.44,153.27) and (452.71,145) .. (462.92,145) -- (556.52,145) .. controls (566.73,145) and (575,153.27) .. (575,163.48) -- (575,218.92) .. controls (575,229.12) and (566.73,237.4) .. (556.52,237.4) -- (462.92,237.4) .. controls (452.71,237.4) and (444.44,229.12) .. (444.44,218.92) -- cycle ;
%Image [id:dp5927465087734418] 
\draw (513.38,178.25) node  {\includegraphics[width=50.06pt,height=49.87pt]{Crazyflie_drone.png}};
%Rounded Rect [id:dp46301952582184014] 
\draw  [fill={rgb, 255:red, 49; green, 229; blue, 59 }  ,fill opacity=0.52 ] (280,164) .. controls (280,156.27) and (286.27,150) .. (294,150) -- (399.85,150) .. controls (407.58,150) and (413.85,156.27) .. (413.85,164) -- (413.85,206) .. controls (413.85,213.73) and (407.58,220) .. (399.85,220) -- (294,220) .. controls (286.27,220) and (280,213.73) .. (280,206) -- cycle ;
%Flowchart: Summing Junction [id:dp44986075936476055] 
\draw   (50,189.67) .. controls (50,185.06) and (54.48,181.33) .. (60,181.33) .. controls (65.52,181.33) and (70,185.06) .. (70,189.67) .. controls (70,194.27) and (65.52,198) .. (60,198) .. controls (54.48,198) and (50,194.27) .. (50,189.67) -- cycle ; \draw   (52.93,183.77) -- (67.07,195.56) ; \draw   (67.07,183.77) -- (52.93,195.56) ;
%Straight Lines [id:da6120790539388008] 
\draw    (70,190) -- (103,190) ;
\draw [shift={(105,190)}, rotate = 180] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Straight Lines [id:da2340316175226833] 
\draw    (100,105) -- (60,105) -- (60,179.33) ;
\draw [shift={(60,181.33)}, rotate = 270] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Straight Lines [id:da9262836240357497] 
\draw    (100,110) -- (80,110) -- (80,140) -- (230,140) -- (230,178) ;
\draw [shift={(230,180)}, rotate = 270] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Flowchart: Summing Junction [id:dp8587789605483882] 
\draw   (220,188.33) .. controls (220,183.73) and (224.48,180) .. (230,180) .. controls (235.52,180) and (240,183.73) .. (240,188.33) .. controls (240,192.94) and (235.52,196.67) .. (230,196.67) .. controls (224.48,196.67) and (220,192.94) .. (220,188.33) -- cycle ; \draw   (222.93,182.44) -- (237.07,194.23) ; \draw   (237.07,182.44) -- (222.93,194.23) ;
%Straight Lines [id:da43661758355446967] 
\draw    (190,190) -- (218,190) ;
\draw [shift={(220,190)}, rotate = 180] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;

%Straight Lines [id:da9749785415808208] 
\draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ]   (617,197.93) -- (616.8,269.65) -- (60,270) -- (60,200) ;
\draw [shift={(60,198)}, rotate = 90] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Straight Lines [id:da8082469647828903] 
\draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ]   (617.3,142.15) -- (617.02,179.27) ;
\draw [shift={(617,181.27)}, rotate = 270.44] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Flowchart: Summing Junction [id:dp18346415057708998] 
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ] (607,189.6) .. controls (607,185) and (611.48,181.27) .. (617,181.27) .. controls (622.52,181.27) and (627,185) .. (627,189.6) .. controls (627,194.2) and (622.52,197.93) .. (617,197.93) .. controls (611.48,197.93) and (607,194.2) .. (607,189.6) -- cycle ; \draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ] (609.93,183.71) -- (624.07,195.49) ; \draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ] (624.07,183.71) -- (609.93,195.49) ;
%Straight Lines [id:da46851956344157064] 
\draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ]   (575,190) -- (605,189.62) ;
\draw [shift={(607,189.6)}, rotate = 179.28] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
%Straight Lines [id:da7636600154227515] 
\draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ]   (510,237.37) -- (510,260) -- (355,260) -- (355,222) ;
\draw [shift={(355,220)}, rotate = 90] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=1 ][line width=0.75]    (10.93,-3.29) .. controls (6.95,-1.4) and (3.31,-0.3) .. (0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;



% Text Node
% \draw (572,104) node [anchor=north west][inner sep=0.75pt]    {\eqref{eq:linearized_drone}};
% Text Node
\draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ]  (97,97) -- (172,97) -- (172,122) -- (97,122) -- cycle  ;
\draw (134.5,109.5) node   [align=left] {reference };
% Text Node
\draw (156,258) node  [font=\small]  {$\boldsymbol{x}_{k} =[ x_{k} ,\dot{x}_{k} ,y_{k} ,\dot{y}_{k} ,z_{k} ,\dot{z}_{k}]^{\top }$};
% Text Node
\draw (343,202) node  [font=\large]  {$\boldsymbol{u}_{k} =\boldsymbol\varphi _{\psi }(\boldsymbol{v}_{k})$ \eqref{eq:linearization_d}};
% Text Node
\draw (250.5,179) node    {$\boldsymbol{v}_{k}$};
% Text Node
\draw (430,176) node    {$\boldsymbol{u}_{k}$};
% Text Node
\draw (285,152) node [anchor=north west][inner sep=0.75pt]  [font=\large] [align=left] {\begin{minipage}[lt]{86.41pt}\setlength\topsep{0pt}
\begin{center}
Flatness-based\\input mapping
\end{center}

\end{minipage}};
% Text Node
\draw (492,214.89) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{u}_{k} \in \mathcal{U}$};
% Text Node
\draw (454,122) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {Nonlinear dynamics \\in state/input space};
% Text Node
\draw (261,97) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {Linear dynamics\\in the flat output space};
% Text Node
\draw (386,239.94) node [anchor=north west][inner sep=0.75pt]    {$\psi $};
% Text Node
\draw (146,182) node  [font=\large] [align=left] {\begin{minipage}[lt]{61.2pt}\setlength\topsep{0pt}
\begin{center}
Robust \\MPC
\end{center}

\end{minipage}};
% Text Node
\draw (520.5,205) node  [font=\large] [align=left] {System \eqref{eq:sys0} };
% Text Node
\draw (202,204) node    {$\tilde{\boldsymbol{v}}_k$};
% Text Node
\draw (200.5,129) node    {$\boldsymbol{v}_{k}^{ref}$};
% Text Node
\draw (75.5,91) node    {$\boldsymbol{x}_{k}^{ref}$};
% Text Node
\draw (134,201.4) node [anchor=north west][inner sep=0.75pt]    {\eqref{eq:v_rmpc}};
% Text Node
\draw (376,102.4) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{x}_{k+1} =A_{d} \bx_{k} +B_{d} \bv_{k},\bv_k\in\mathcal{V}_c $ \eqref{eq:linearized_drone}};
% Text Node
\draw (90.79,178.94) node    {$\tilde{\boldsymbol{x}}_{k}$};
% Text Node
\draw (61,206) node [anchor=north west][inner sep=0.75pt]   [align=left] {+};
% Text Node
\draw (64,168) node [anchor=north west][inner sep=0.75pt]  [font=\large] [align=left] {\mbox{-}};
% Text Node
\draw (201,174) node [anchor=north west][inner sep=0.75pt]   [align=left] {+};
% Text Node
\draw (216,161) node [anchor=north west][inner sep=0.75pt]   [align=left] {+};
% Text Node
% \draw (386,192.4) node [anchor=north west][inner sep=0.75pt]    {\eqref{eq:linearization_d}};

% Text Node
\draw (606,143) node    {$\bw$};
% Text Node
\draw (602.3,163.5) node [anchor=north west][inner sep=0.75pt]  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,opacity=1 ] [align=left] {+};
% Text Node
\draw (595.3,195) node [anchor=north west][inner sep=0.75pt]  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,opacity=1 ] [align=left] {+};

\end{tikzpicture}
