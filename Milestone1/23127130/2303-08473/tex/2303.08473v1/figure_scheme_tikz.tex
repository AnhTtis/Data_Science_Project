\begin{figure*}[t!]
\centering
\begin{tikzpicture}

\definecolor{color_road}{RGB}{84,0,84}
\definecolor{color_car}{RGB}{0,0,148}
\definecolor{color_sidewalk}{RGB}{254,36,242}
\definecolor{color_building}{RGB}{73,73,73}
\definecolor{color_sky}{RGB}{73,135,188}

\def\colorLayout{red!5}
\def\colorImageBlue{rgb:blue,5;green,2.5;white,5}
\def\colorImageDark{green!50}
\def\colorImage{green!5}

\tikzstyle{node} = [rectangle, minimum size=1cm, text centered, draw=black!50]
\tikzstyle{sg} = [rectangle, rounded corners, fill=black!0]
\tikzstyle{layer} = [rectangle, minimum size=20mm, draw=black!20]
\tikzstyle{encoder} = [trapezium, text centered, draw=black]
\tikzstyle{vector} = [rectangle, minimum width=0.5cm, text centered]
% \tikzstyle{mask} = [trapezium, text centered, draw=black]
\tikzstyle{mask} = [matrix, text centered]

\node(node2) [sg, xshift=0cm]
{\includegraphics[width=20mm]{images/271_sg.png}};

% \node(node1) [node, xshift=0cm, yshift=-3.0cm]
% {\includegraphics[width=20mm]{images/render.png}};
\node(node1) [canvas is zy plane at x=0.0, yshift=-3cm]
{\includegraphics[width=30mm]{images/0000012401.png}};
%{\includegraphics[width=30mm]{images/01743.png}};


\pic[shift={(2.25,0,0)}] at (node2) {Box={name=enc11, caption=, fill=gray, opacity=0.5,height=8,width=1,depth=8}};
\pic[shift={(0.25,0,0)}] at (enc11-east) {Box={name=enc12, caption=, fill=gray, opacity=0.5,height=6,width=1,depth=6}};

\pic[shift={(0.5,0,0)}] at (enc12-east) {Box={name=z1, caption=, fill=color_sidewalk, opacity=0.9, draw=color_sidewalk, height=1,width=3,depth=1}};
\pic[shift={(0.5,0.4,0)}] at (enc12-east) {Box={name=z2, caption=, fill=color_building, opacity=0.9, height=1,width=3,depth=1}};
\pic[shift={(0.5,-0.4,0)}] at (enc12-east) {Box={name=z3, caption=, fill=color_car, opacity=0.9, height=1, width=3, depth=1}};
\pic[shift={(0.5,0.8,0)}] at (enc12-east) {Box={name=z4, caption=, fill=color_sky, opacity=0.9, height=1, width=3, depth=1}};
\pic[shift={(0.5,-0.8,0)}] at (enc12-east) {Box={name=z4, caption=, fill=color_road, opacity=0.9, height=1, width=3, depth=1}};

%DECODER 1

\pic[shift={(1.5,0,0)}] at (enc12-east) {Box={name=dec11, caption=, fill=\colorImageBlue,opacity=0.5,height=6,width=1,depth=6}};
\pic[shift={(0.25,0,0)}] at (dec11-east) {Box={name=dec12, caption=, fill=\colorImageBlue,opacity=0.5,height=8,width=1,depth=8}};

%LOSSES

\node(node80) [rectangle, fill=\colorImageBlue, opacity=0.1, rounded corners, minimum height=6.5cm, minimum width=3cm, xshift=7.5cm, yshift=-1.5cm] {};

\node(node81) [canvas is zy plane at x=7.5, yshift=-3cm]
{\includegraphics[width=30mm]{images/semantic_map.png}};

%OUTPUT 1

\node(node9) [layer, canvas is zy plane at x=7.0]
{\includegraphics[width=30mm]{images/sky_mask.png}};
\node(node10) [layer, canvas is zy plane at x=7.25]
{\includegraphics[width=30mm]{images/building_mask.png}};
\node(node11) [layer, canvas is zy plane at x=7.5]
{\includegraphics[width=30mm]{images/sidewalk_mask.png}};
\node(node12) [layer, canvas is zy plane at x=7.75]
{\includegraphics[width=30mm]{images/car_mask.png}};
\node(node13) [layer, canvas is zy plane at x=8.0]
{\includegraphics[width=30mm]{images/road_mask.png}};

%NETWORK 2

\pic[shift={(2.25,0,0)}] at (node13) {Box={name=enc21, caption=, fill=\colorImageBlue,opacity=0.5,height=8,width=1,depth=8}};
\pic[shift={(0.25,0,0)}] at (enc21-east) {Box={name=enc22, caption=, fill=\colorImageBlue,opacity=0.5,height=6,width=1,depth=6}};
\pic[shift={(0.25,0,0)}] at (enc22-east) {Box={name=enc23, caption=, fill=\colorImageBlue,opacity=0.5,height=4,width=1,depth=4}};

\pic[shift={(0.25,0,0)}] at (enc23-east) {Box={name=dec21, caption=, fill=\colorImageDark,opacity=0.5,height=6,width=1,depth=6}};
\pic[shift={(0.25,0,0)}] at (dec21-east) {Box={name=dec22, caption=, fill=\colorImageDark, height=8,width=1,depth=8}};

%LOSS 2

\node(node160) [rectangle, fill=\colorImage, rounded corners, minimum height=6.5cm, minimum width=3cm, xshift=15.0cm, yshift=-1.5cm] {};

\node(node15) [canvas is zy plane at x=15.0]
{\includegraphics[width=30mm]{images/271_image.png}};

\node(node16) [canvas is zy plane at x=15.0, yshift=-3cm]
{\includegraphics[width=30mm]{images/aachen_000157_000019.png}};

% EDGES

\draw[->, draw=black!50] (node1.north) -- (node2.south);

\draw[->, draw=black!50] ([xshift=0.75cm]node1.center) -- ([xshift=-0.75cm]node81.center);
\draw[->, draw=black!50] (node2.east) -- ([xshift=-0.5cm]enc11-west);

\draw[->, draw=black!50] (dec12-east) -- ([xshift=-0.75cm]node9.center);

\draw[->, draw=black!50] ([xshift=0.75cm]node13.center) -- ([xshift=-0.5cm]enc21-west);
\draw[->, draw=black!50] (dec22-east) -- ([xshift=-0.75cm]node15.center);


% \node(n_i)[xshift=1.0cm, yshift=-1.5cm]{$\{n_i,e_{i,j}\}$};

\node(P)[xshift=3.0cm, yshift=-1.5cm]{$P$};
\node(G)[xshift=11.0cm, yshift=-1.5cm]{$G$};

% \node(x)[xshift=14.5cm, yshift=1.0cm]{$x$};

\node(G)[xshift=8.5cm, yshift=-4.5cm]{$\mathcal{L}_{SG}$};
\node(G)[xshift=16.0cm, yshift=-4.5cm]{$\mathcal{L}_{TS}$};

\node(x)[xshift=6.5cm,yshift=1.0cm]{$b_i, m_i$};
\node(x)[xshift=6.5cm,yshift=-2.5cm]{$\hat{b}_i, \hat{m}_i$};
\node(x)[xshift=14.0cm,yshift=0.5cm]{$x$};
\node(x)[xshift=14.0cm,yshift=-2.5cm]{$\hat{x}$};

\end{tikzpicture}
\caption{Overview of the network with graph processor $P$, traffic scene generator $G$, and loss functions $\mathcal{L}_{SG}$ and $\mathcal{L}_{TS}$.}\label{fig:scheme}
\end{figure*}
