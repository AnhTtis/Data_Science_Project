\section{Proof of chain rule}
 \secl{chain-proof}
We assume that the function $f$ is smooth, and a Taylor expansion is valid:
\beq
f(x) = f_0 + f_1x +f_2x^2+f_3 x^3 + f_4 x^4+\ldots
\eeq
Therefore $F_{ij}$ can be rewritten as 
\beq
\wt f_{ij} = f_0 + f_1 \Ham_{ij} +f_2 \Ham_{ii'} \Ham_{i'j}+f_3  \Ham_{ii'} \Ham_{i'i''}\Ham_{i''j}+
%f_4  \Ham_{ii'} \Ham_{i'i''}\Ham_{i''i'''}\Ham_{i'''j}+
\ldots
\eeq
Here we assume that $i,i',i'',\ldots,j$ all belong to the same subspace (A or B)
Which will be valid in any gauge that does not mix the subspaces.
Therefore, using the product rule we can easily take the generalized derivative
\begin{multline}
\wt f_{ij}^{:a} = f_1 \Ham^{:a}_{ij} +f_2 \left( \Ham_{ii'}^{:a} \Ham_{i'j}+ \Ham_{ii'} \Ham_{i'j}^{:a} \right)\\
    +f_3 \left(  \Ham_{ii'}^{:a} \Ham_{i'i''}\Ham_{i''j}+\Ham_{ii'} \Ham_{i'i''}^{:a}\Ham_{i''j}+\Ham_{ii'} \Ham_{i'i''}\Ham_{i''j}^{:a}\right)\\
%+f_4 \left(   \Ham_{ii'}^{:a} \Ham_{i'i''}\Ham_{i''i'''}\Ham_{i'''j}  +\Ham_{ii'} \Ham_{i'i''}^{:a}\Ham_{i''i'''}\Ham_{i'''j} + \Ham_{ii'} \Ham_{i'i''}\Ham_{i''i'''}^{:a}\Ham_{i'''j} +\Ham_{ii'} \Ham_{i'i''}\Ham_{i''i'''}\Ham_{i'''j}^{:a}   \right) 
+ \ldots
\end{multline}
Which in the Hamiltonian gauge is simplified to
\begin{multline}
    \wt f_{ij}^{:a} = \Ham^{:a}_{ij} \bigl[ f_1+ f_2(\varepsilon_i+\varepsilon_j)+f_3(\varepsilon_i^2+\varepsilon_i\varepsilon_j+\varepsilon_j^2)
%+f_4(E_i^3+E_i^2E_j+E_iE_j^2+E_j^3)   
    +\ldots  \bigr] 
\end{multline}
In case $\varepsilon_j=\varepsilon_j=\varepsilon$ it reduces to 
\begin{equation}
    \wt f_{ij}^{:a} =\Ham^{:a}_{ij} \bigl[ f_1+ 2f_2 \varepsilon+ 3f_3 \varepsilon^2+\ldots \bigr] = \Ham^{:a}_{ij} \frac{df(\varepsilon)}{d\varepsilon}
\eql{chainrule-degen}
\end{equation}
Now, if $\varepsilon_i\neq \varepsilon_j$, we can multiply and divide by $\varepsilon_i-\varepsilon_j$ and get 
\begin{multline}
\wt f_{ij}^{:a} = \Ham^{:a}_{ij} \cdot \tfrac{ f_1(\varepsilon_i-\varepsilon_j)+ f_2(\varepsilon_i^2+\varepsilon_j^2)+ f_3(\varepsilon_i^3-\varepsilon_j^3) +\ldots }{\varepsilon_i-\varepsilon_j}  = \\
= \Ham^{:a}_{ij} \cdot \tfrac{f(\varepsilon_i) - f(\varepsilon_j)}{\varepsilon_i-\varepsilon_j} 
\eql{chainrule-nondegen}
\end{multline}
Note, that in the limit $\varepsilon_i\to \varepsilon_j$ \eqref{eq:chainrule-nondegen} reduces to \eqref{eq:chainrule-degen}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "pap"
%%% End:
