\begin{figure}
  \tikzset{declare function = { xpos(\x) =
    \x==101?0:(\x==104?1:(\x==105?2:(\x==106?3:(\x==107?4:(
    \x==112?5:(\x==113?6:(\x==114?7:(\x==116?8:(\x==124?9:nan)))))))));}}
  \newcommand\addlayer[2]{% {#1 tool}{#2 layer}
    \addplot[style={#2,fill=#2,mark=none}] table[
      x expr={xpos(\thisrow{swc})},
      y expr={\thisrow{#2}/\thisrow{flagged}*100},
      col sep=comma
    ] {figure_agreement_#1.csv};\label{style:#1:#2}
  }
  \newcommand\addtool[2]{% {#1 tool}{#2 label}
    \nextgroupplot[ylabel = #2]
    \addlayer{#1}{one}
    \addlayer{#1}{two}
    \addlayer{#1}{three}
    \addlayer{#1}{more}
  }
  \centering
  \begin{tikzpicture}[font={\sffamily}]
    \begin{groupplot}[
      group style={
          group name=agreement_analysis,
          group size=1 by 10,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          vertical sep=6pt
      },
      ybar stacked,
      footnotesize,
      width= 0.75*\textwidth,
      height=3.1cm,
      xmin=-0.5, xmax=9.5,
      ymin=0, ymax=100,
      unbounded coords=jump,
      % y filter/.expression={y<1.0 ? nan : y},
      major x tick style = transparent,
      ymajorgrids = true,
      scaled ticks=false,
      xtick={0,1,...,9},
      xticklabels={101, 104, 105, 106, 107, 112, 113, 114, 116, 124},
      x tick label style={rotate=90,anchor=east,font={\sffamily\scriptsize}},
      ytick={0,20,...,100},
      yticklabels={0, 20, 40, 60, 60, 100},
      y tick label style={font={\sffamily\scriptsize}},
      axis x line*=bottom,
      axis y line*=left,
      ylabel near ticks, 
      tickpos=left,
      ytick align=outside,
      xtick align=outside,
      legend style={
          at={(0.5,1.25)},anchor=north,
          legend columns=-1,
          draw=none,
          fill=none
      }
    ]
    \addtool{conkas}{Conkas}
    \addtool{ethainter}{Ethainter}
    \addtool{ethor}{eThor}
    \addtool{madmax}{MadMax}
    \addtool{maian}{Maian}
    \addtool{mythril}{Mythril}
    \addtool{osiris}{Osiris}
    \addtool{pakala}{Pakala}
    \addtool{securify}{Securify}
    \addtool{teether}{teEther}
    \end{groupplot}
  \end{tikzpicture}  
  \caption{Agreement of the tools' judgment on the SWC classes. Each bar shows the proportion of weaknesses identified by one \ref*{style:mythril:one}, two \ref*{style:mythril:two}, three \ref*{style:mythril:three}, and four or more \ref*{style:mythril:more} tools.}
  \label{fig:agreement}
\end{figure}
