\documentclass[10pt,journal,compsoc]{IEEEtran}
\ifCLASSOPTIONcompsoc
\usepackage[nocompress]{cite}
\else
\usepackage{cite}
\fi
\ifCLASSINFOpdf
\else
\fi

% NOTE: PDF hyperlink and bookmark features are not required in IEEE

\usepackage{booktabs,multirow}
\usepackage{graphicx}  

% NOTE: PDF hyperlink and bookmark features are not required in IEEE
\newcommand\MYhyperrefoptions{
bookmarks=true,bookmarksnumbered=true,
pdfpagemode={UseOutlines},
plainpages=false,pdfpagelabels=true,
colorlinks=true,linkcolor={black},
citecolor={black},urlcolor={black},
pdftitle={A survey on test-time adaptation},%<!CHANGE!
pdfsubject={A survey on test-time adaptation},%<!CHANGE!
pdfauthor={Jian Liang},%<!CHANGE!
pdfkeywords={test-time adaptation}}%<^!CHANGE!

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
\usepackage{color,colortbl}
\definecolor{blush}{rgb}{0.87, 0.36, 0.51}
\usepackage[colorlinks,citecolor=green]{hyperref}

\usepackage{amsmath}
\usepackage{amssymb}
\definecolor{bblue}{rgb}{0.36, 0.51, 0.87}
\definecolor{ggray}{rgb}{0.88, 0.87, 0.87}
\newcolumntype{a}{>{\columncolor{ggray}}c}

% Support for easy cross-referencing
\usepackage[capitalize]{cleveref}
\crefname{section}{Sec.}{Secs.}
\Crefname{section}{Section}{Sections}
\Crefname{table}{Table}{Tables}
\crefname{table}{Tab.}{Tabs.}

\usepackage{bbm}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
%\newenvironment{proof}{proof}[section]
%\newenvironment{proof}{\paragraph{\emph{Proof}:}}{\hfill$\square$}
\usepackage[dvipsnames, svgnames, x11names]{xcolor}
\usepackage{dsfont}

\usepackage{amsthm}
\usepackage{cancel}
% \makeatletter
% \def\@endtheorem{\endtrivlist}
% \makeatother
\theoremstyle{definition}
\newtheorem{definition}{Definition}

\makeatletter
\def\eg{\emph{e.g.}}
\def\ie{\emph{i.e.}}
\def\etal{\emph{et al.}}
\def\etc{\emph{etc.}}
\def\wrt{w.r.t.}
\def\aka{\emph{a.k.a.}}
\def\wrt{\emph{w.r.t. }}
\def\cf{\emph{cf.}} % compare
\def\vs{\emph{v.s. }}
\makeatother

\newcommand{\method}[1]{\noindent \textbf{#1.}}

\usepackage{makecell}

\usepackage{subfigure}

\begin{document}
\title{A Comprehensive Survey on Test-Time Adaptation under Distribution Shifts}
\author{Jian Liang,~\IEEEmembership{Member,~IEEE,}
Ran He,~\IEEEmembership{Senior Member,~IEEE,}
and Tieniu Tan,~\IEEEmembership{Fellow,~IEEE}
\IEEEcompsocitemizethanks{
\IEEEcompsocthanksitem The authors are with the State Key Laboratory of Multimodal Artificial Intelligence Systems and Center for Research on Intelligent Perception and Computing, Institute of Automation, Chinese Academy of Sciences.
\IEEEcompsocthanksitem Ran He is also with the School of Artificial Intelligence, University of Chinese Academy of Sciences.
% and School of Information Science and Technology, ShanghaiTech University.
\IEEEcompsocthanksitem Tieniu Tan is also with Nanjing University, China.
\IEEEcompsocthanksitem E-mail: liangjian92@gmail.com, \{rhe, tnt\}@nlpr.ia.ac.cn.}
}
\markboth{}
{Liang \MakeLowercase{\textit{et al.}}: A Comprehensive Survey on Test-Time Adaptation under Distribution Shifts}

\IEEEtitleabstractindextext{%
\begin{abstract}
Machine learning methods strive to acquire a robust model during training that can generalize well to test samples, even under distribution shifts.
However, these methods often suffer from a performance drop due to unknown test distributions.
Test-time adaptation (TTA), an emerging paradigm, has the potential to adapt a pre-trained model to unlabeled data during testing, before making predictions.
Recent progress in this paradigm highlights the significant benefits of utilizing unlabeled data for training self-adapted models prior to inference.
In this survey, we divide TTA into several distinct categories, namely, test-time (source-free) domain adaptation, test-time batch adaptation, online test-time adaptation, and test-time prior adaptation.
For each category, we provide a comprehensive taxonomy of advanced algorithms, followed by a discussion of different learning scenarios. 
Furthermore, we analyze relevant applications of TTA and discuss open challenges and promising areas for future research.
A comprehensive list of TTA methods can be found at \url{https://github.com/tim-learn/awesome-test-time-adaptation}.
\end{abstract}

% Note that keywords are not normally used for peerreview papers.
\begin{IEEEkeywords}
test-time adaptation, source-free domain adaptation, test-time training, continual test-time adaptation, prior adaptation
\end{IEEEkeywords}}

\maketitle\IEEEdisplaynontitleabstractindextext
\IEEEpeerreviewmaketitle

\ifCLASSOPTIONcompsoc
\IEEEraisesectionheading{\section{Introduction}\label{sec:introduction}}
\else
\section{Introduction}
\label{sec:introduction}
\fi
	
\IEEEPARstart{T}{raditional} machine learning methods assume that the training and test data are drawn independently and identically (i.i.d.) from the same distribution \cite{quinonero2008dataset}.
However, when the test distribution (target) differs from the training distribution (source), we face the problem of \emph{distribution shifts}.
Such a shift poses significant challenges for machine learning systems deployed in the wild, such as images captured by different cameras \cite{saenko2010adapting}, road scenes of different cities \cite{chen2017no}, and imaging devices in different hospitals \cite{liu2022source}.
As a result, the research community has developed a variety of generalization or adaptation techniques to improve model robustness against distribution shifts. 
For instance, \emph{domain generalization} (DG) \cite{zhou2022dg} aims to learn a model using data from one or multiple source domains that can generalize well to any out-of-distribution target domain. 
On the other hand, \emph{domain adaptation} (DA) \cite{kouw2019review} follows the transductive learning principle to leverage knowledge from a labeled source domain to an unlabeled target domain.

This survey primarily focuses on \emph{test-time adaptation} (TTA), which involves adapting a pre-trained model from the source domain to unlabeled data in the target domain before making predictions \cite{liang2020we,sun2020test,wang2021tent,iwasawa2021test}. 
While DG operates solely during the training phase, TTA has the advantage of being able to access test data from the target domain during the test phase. 
This enables TTA to enhance recognition performance through adaptation with the available test data.
Additionally, DA typically necessitates access to both labeled data from the source domain and (unlabeled) data from the target domain simultaneously, which can be prohibitive in privacy-sensitive applications such as medical data.
In contrast, TTA only requires access to the pre-trained model from the source domain, making it a secure and practical alternative solution.

\begin{figure}[tbp]
\centering
\includegraphics[trim={0.05cm 0.55cm 0.1cm 0.15cm},clip, width=0.47\textwidth]{task.png}
\caption{The test-time adaptation (TTA) paradigm aims to adapt the pre-trained model to various types of unlabeled test data, including single mini-batch, streaming data, or an entire dataset, before making predictions. During the adaptation process, either the model or the input data can be altered to improve performance.}
\label{fig:task}
\vspace{-10pt}
\end{figure}

Based on the characteristics of the test data \footnote{In this survey, we use the terms ``test data" and ``target data" interchangeably to refer to the data used for adaptation at test time.}, TTA methods can be categorized into three distinct cases in Fig.~\ref{fig:task}: \emph{test-time domain adaptation}, \emph{test-time batch adaptation} (TTBA), and \emph{online test-time adaptation} (OTTA).
For better illustration, let us assume that we have $m$ unlabeled mini-batches $\{b_1, \cdots, b_m\}$ at test time.
Firstly, test-time domain adaptation, also known as source-free domain adaptation (SFDA) \cite{liang2020we, kundu2020universal, li2020model}, utilizes all $m$ test batches for multi-epoch adaptation before generating final predictions. 
Secondly, TTBA individually adapts the pre-trained model to one \footnote{Such a single sample adaptation corresponds to a batch size of 1.} or a few instances \cite{sun2020test,schneider2020improving,zhang2022memo}.
That is to say, the predictions of each mini-batch are independent of the predictions for the other mini-batches.
Thirdly, OTTA adapts the pre-trained model to the target data $\{b_1, \cdots, b_m\}$ in an online manner, where each mini-batch can only be observed once.
However, knowledge learned from previously seen mini-batches can facilitate adaptation to the current mini-batch.
It is worth noting that OTTA methods can be applied to SFDA with multiple epochs, and TTBA methods can be applied to OTTA with the assumption of knowledge reuse.
While most existing TTA methods focus on addressing data shift (\eg, covariate shift \cite{quinonero2008dataset}), we also investigate the label shift scenario within the TTA framework, referred to as \emph{test-time prior adaptation} (TTPA) \cite{latinne2001adjusting,royer2015classifier}.
An illustrative example of label shift is medical diagnosis discussed in \cite{lipton2018detecting}, where disease prevalences can vary significantly at different times of the year.
Nonetheless, existing TTA studies have often misused terms due to a lack of comprehensive understanding of the relationships among these sub-problems.

In this survey, we for the first time define the broad concept of \emph{test-time adaptation} and view the four aforementioned topics (\ie, SFDA, TTBA, OTTA, and TTPA) as its special cases.
Subsequently, we thoroughly review the advanced algorithms for each of these topics and summarize a variety of applications related to TTA.
Our contributions can be summarized into three following aspects.
\begin{enumerate}
\item To our knowledge, this is the first survey that provides a systematic overview of four distinct topics under the broad test-time adaptation paradigm, including source-free domain adaptation (SFDA, Sec.~\ref{sec:sfda}), test-time batch adaptation (TTBA, Sec.~\ref{sec:ttba}), online test-time adaptation (OTTA, Sec.~\ref{sec:otta}), and test-time prior adaptation (TTPA, Sec.~\ref{sec:ttpa}).
\item We propose a novel taxonomy of existing methods and provide a clear definition for each topic. 
We hope this survey will help readers develop a better understanding of the advancements in each topic.
\item We analyze various applications related to the TTA paradigm in Sec.~\ref{sec:application}, and provide an outlook of recent emerging trends and open problems in Sec.~\ref{sec:future} to shed light on future research directions.
\end{enumerate}

\method{Comparison with previous surveys} 
Our survey is related to other surveys on domain adaptation \cite{csurka2017comprehensive,kouw2019review,wilson2020survey}, and prior adaptation \cite{sipka2022hitchhiker}.
However, our specific focus is on test-time learning with distribution shifts.
Recently, two surveys have been published on source-free domain adaptation \cite{fang2023source,yu2023comprehensive}, which is only a particular topic of test-time adaptation discussed in our survey.
Even for the specific topic, we provide a new taxonomy that covers more related papers.
Another survey \cite{liu2021data} considers SFDA as a problem of data-free knowledge transfer, which shares some overlap with our survey.
However, our survey differs in that it unifies SFDA and other related problems from the perspective of model adaptation under distribution shifts, which is a novel and pivotal contribution to the transfer learning field.

\section{Related Research Topics}
\label{sec:related}
\input{sec1-related}

\section{Source-Free Domain Adaptation}
\label{sec:sfda}
\input{sec2-sfda}

\section{Test-Time Batch Adaptation}
\label{sec:ttba}
\input{sec3-ttba}

\section{Online Test-Time Adaptation}
\label{sec:otta}
\input{sec4-otta}

\section{Test-Time Prior Adaptation}
\label{sec:ttpa}
\input{sec5-ttpa}

\section{Applications} %  Applications of Test-Time Adaptation
\label{sec:application}
\input{sec6-application}
 
\section{Emerging Trends and Open Challenges}
\label{sec:future}
\input{sec7-future}
 
\section{Conclusion}
Learning to adapt a pre-trained model to unlabeled data under distribution shifts is an emerging and critical problem in the field of machine learning. 
This survey provides a comprehensive review of four related topics: source-free domain adaptation, test-time batch adaptation, online test-time adaptation, and test-time prior adaptation.
These topics are unified as a broad learning paradigm of test-time adaptation.
For each topic, we first introduce its history and definition, followed by a new taxonomy of advanced algorithms.
Additionally, we provide a review of applications related to test-time adaptation, as well as an outlook of emerging research trends and open problems. 
We believe that this survey will assist both newcomers and experienced researchers in better understanding the current state of research in test-time adaptation under distribution shifts.

% use section* for acknowledgment
\ifCLASSOPTIONcompsoc
% The Computer Society usually uses the plural form
\section*{Acknowledgments}
\else
% regular IEEE prefers the singular form
\section*{Acknowledgment}
\fi
The authors would like to thank Lijun Sheng and Dapeng Hu for their valuable discussions and contributions to this work.
Discussions, comments, and questions are all welcomed in \url{https://github.com/tim-learn/awesome-test-time-adaptation}.

% Can use something like this to put references on a page
% by themselves when using endfloat and the captionsoff option.
\ifCLASSOPTIONcaptionsoff
\newpage
\fi

\bibliographystyle{IEEEtran}
\bibliography{my,methods_1,methods_2,methods_3}

\vfill
	
\end{document}