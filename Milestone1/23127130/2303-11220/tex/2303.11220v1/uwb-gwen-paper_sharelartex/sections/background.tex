% !TeX root = ../main.tex

\section{Background \& Related Work}\label{sec:background}
\noindent This section gives an introduction to \ac{uwb}, the available hardware, applications, and how 3D printing can be used to allow reproducible measurements.
According to the IEEE standards, \ac{uwb} defines two modes: \ac{hrp} and \ac{lrp}. In our work, we focus on \ac{uwb} \ac{hrp} as it is the only mode supported by smartphones and used for \ac{pkes} systems in cars.  

\subsection{UWB HRP Mode}\label{sec:background_uwb_hrp}
Most systems that are currently deployed use the \ac{uwb} \ac{hrp} mode that has been first defined in 802.15.4a--2007\cite{ieee802154-2007}.
Over the years, this mode has been integrated into the main standard, and it has been extended at last by 802.15.4--2020 and 802.15.4z. While 802.15.4--2020 added new data rates and \acp{prf}, 802.15.4z added additional security mechanisms that should protect ranging measurements against external attacks (see \cref{sec:background_uwb_security}). 
We explain the distinctive features of \ac{uwb}, how to use it for ranging and locating devices, and its security properties. 

\subsubsection{Physical Layer}
The discussed \ac{uwb} systems are pulse-based communication systems. On the physical layer, these systems send out short electromagnetic pulses instead of longer sine waves. These pulses have sharp edges to the maximum amplitude and a total duration of \SIrange[]{0.74}{2}{\nano\second}~\cite{IEEEStd8022020}.
An example of such a pulse is visible in \cref{fig:uwb_pulse}.
\begin{figure}[!t]
    \centering

    \fontsize{4}{4}\selectfont        
    \includegraphics[width=.8\linewidth]{figures/UWB_Pulse.pdf}
    
    \caption{Recommended time domain mask for the UWB HRP PHY pulse~\cite{IEEEStandardLowRate2020z}.}\label{fig:uwb_pulse}
\end{figure}
These sharp pulses allow accurate detection of the \ac{toa} of the signal at the receiver.
The U1 chipset in Apple's devices has a clock that allows a theoretical resolution of \SI{1}{\pico\second}\footnote{Retrieved from reverse-engineering iOS.}. Chipsets from Decawave offer up to \SI{15.65}{\pico\second}~\cite[p.32]{qorvoinc.DW3000DEVICEDRIVER2019}. 

\ac{uwb} \ac{hrp} supports 15 different channels with different bandwidths between \SI{499.2}{\mega\hertz} and \SI{1354.92}{\mega\hertz}. Complex channels, formed by prepending a specific preamble to each frame, allow concurrent transmissions on the same channel~\cite{IEEEStd8022020}. 

The \ac{hrp} mode defines three mean \ac{prf} at \SI{3.9}{\mega\hertz}, \SI{15.6}{\mega\hertz} and \SI{62.40}{\mega\hertz}. All devices that we were testing used \SI{62.40}{\mega\hertz}. Higher \acs{prf} achieve higher data rates and faster ranging. 
The \ac{uwb} standard IEEE 802.15.4--2020 also defines an \ac{lrp} mode which uses a lower \ac{prf} and a different security paradigm. We do not cover the details of this mode in this paper. There is currently no smartphone that supports \ac{lrp}.  

\input{figures/tikz/dstwr.tex}
\subsubsection{Ranging mechanisms}\label{sec:background_uwb_ranging}
To perform ranging, the \ac{uwb} \ac{hrp} transceivers use \ac{tof} based distance measurements. 
By measuring the time it took the signal to travel from the transmitter to the receiver, it is possible to calculate the distance between both devices. To remove the necessity of clock-synchronization between both devices, a \ac{twr} mechanism is used. 
\Ac{ds-twr} is used to directly correct clock drifts and to ensure that both devices have a measurement result available.
The \ac{ds-twr} is depicted in \cref{fig:seq_ds_twr} and works as follows:
The initiator starts by sending a poll message to the responder. The responder responds and also transmits the reply delay ($T_{\text{reply}_1}$) to the initiator.
The initiator now sends a second poll message and transmits its reply delay ($T_{\text{reply}_2}$) and overall roundtrip time for the first message exchange ($T_{\text{round}_1}$) to the responder. The responder now calculates the final distance by using \cref{eq:dist_ds}. In a last (optional) message, the responder transmits the measured distance ($d$) or the second roundtrip time ($T_{\text{round}_2}$). 

\begin{equation}
    \label{eq:dist_ds}
    d=\frac{T_{\text{round}_1} * T_{\text{round}_2} - T_{\text{reply}_1} * T_{\text{reply}_2}}{T_{\text{round}_1} + T_{\text{round}_2} + T_{\text{round}_1} + T_{\text{round}_2}}*c
\end{equation}  


\subsubsection{Security Properties}\label{sec:background_uwb_security}

Earlier versions of \ac{uwb} \ac{hrp} in 802.15.4 did not have any security properties. The physical layer definitions were only supplemented by a simple MAC layer without any protection of ranging measurements against malicious interference. 

This allowed severe attacks against \ac{uwb} if used for ranging and localization. By listening to the \ac{uwb} channel, an attacker can easily identify the used preamble, which starts every \ac{uwb} frame. The early detection of the preamble allows an attacker to send frames with the same preamble earlier and thus reduce the measured distance~\cite{fluryEffectivenessDistancedecreasingAttacks2010}. Even sending static \ac{uwb} pulses at a fixed interval to interfere with any surrounding ranging measurements caused distance reduction and enlargement attacks~\cite{poturalskiCicadaAttackDegradation2010}. 

%The amendment integrated first security properties in \ac{hrp} mode that should protect against attacks on ranging. This standard was also the first that standardized the ranging mechanisms in \cref{sec:background_uwb_ranging}. 

The current standard amendment IEEE 802.15.4z introduced a new protection mechanism against physical layer attacks~\cite{IEEEStandardLowRate2020z}. 
Each \ac{uwb} \ac{hrp} frame now contains a \ac{sts}. The \ac{sts} is a cryptographically secured sequence of pulses that is derived from a pseudo-random generator and a shared secret between the initiator and responder. Both devices in a ranging session will only accept frames that contain an expected \ac{sts} and the location of the \ac{sts} in the frame is used to derive accurate and secured timestamps. 

An attacker that tries to reduce the measured distance by sending a packet with the same preamble on the same channel earlier does not succeed, because the \ac{sts} changes with every frame and cannot be known in advance by an attacker. The receiver simply discards the frame. Previous research has shown that a distance reduction is still possible, but only at a low success rate (see \cref{sec:related_work})~\cite{279984}. 


\subsection{Available Hardware}

We briefly introduce the available consumer hardware for \ac{uwb} \ac{hrp} devices in this section. There are currently three main manufacturers of chipsets in smartphones: Apple, NPX, and Qorvo. \Cref{tab:available_uwb} gives an overview of available hardware. 

The iPhone 11 in 2019 was the first mass-market smartphone that integrated a \ac{uwb} \ac{hrp} chip to perform ranging~\cite{U1ChipIPhone2019}. The previously released Bespoon phone has only been a public prototype, which is no longer on sale~\cite{stmicroelectronicsn.v.HISTORYUWB2020}. The Apple U1 \ac{uwb} chip has been deployed to a number of devices: iPhone, Apple Watch, AirTag, and HomePod mini. The iPhone is the only device that has a multi-antenna \ac{uwb} chip allowing \ac{aoa} measurements.  

Samsung was the second manufacturer which integrated \ac{uwb} in their high-end Galaxy Note, Plus and Ultra lines~\cite{samsungelectronicsincSamsungUnveilsFive2020}. They integrated the NXP SR100T chips into their Galaxy smartphones. The Samsung SmartTag+ integrates a precision finding feature leveraged by \ac{uwb} and the NXP SR040 chip. 
While the SR100T chip also integrates \ac{aoa} by using multiple antennas, the SR040 chip only uses one antenna and is designed for low-cost systems~\cite{nxpsemiconductorsSR040UltraWidebandTransceiver2021}. 

The Google Pixel 6 Pro was the first to introduce \ac{uwb} to Google's phones. This phone implements a \ac{uwb} chipset from Qorvo. The chipset is based on the DWM3000 family of chips~\cite{qorvoinc.QorvoDeliversUltraWideband}. The Pixel 6 Pro also supports \ac{aoa} measurements. 

All chipsets are compliant with the open IEEE 802.15.4z standard and the proprietary \ac{fira} and  \ac{ccc} standards. This allows theoretically wide interoperability between these chips. However, due to limited software support, Android and iOS smartphones are not able to interoperate, yet~\cite{NearbyInteractionApple}.
In this work, we focus on smartphones with \ac{uwb} support: The Apple iPhone (11 and newer), Samsung Galaxy smartphones (S21 Ultra and newer), and Google Pixel (6 Pro and newer).   


\begin{table*}[]
    \begin{minipage}{\textwidth}
        \caption{Commercially available UWB chips evaluated in this work}\label{tab:available_uwb}
        \begin{tabularx}{\linewidth}{llllll}
            \toprule
        Device               & Chipset      & No. Antennas & Supported Standards              & Accuracy\footnote{As stated by chip manufacturer~\cite{mobileknowledgeMKUWBKit,qorvoinc.DW3000DataSheet2020}} & Channel    \\
            \midrule
            
        Apple devices         & Apple U1     & $1-3$            & IEEE 802.15.4z, FiRa\footnote{\label{fira}FiRa Consortium~\cite{FiRaConsortium}}, CCC\footnote{\label{ccc}Car Connectivity Consortium~\cite{CarConnectivityConsortiuma}}, ANI\footnote{\label{ani}Apple Nearby Interaction~\cite{NearbyInteractionApple}}  & -         & 5, 9       \\

        Samsung Galaxy smartphones & NXP SR100T    & 3           & IEEE 802.15.4z, FiRa\footnoteref{fira}, CCC\footnoteref{ccc} &   $\pm$\SI{10}{\centi\metre}       & 5, 6, 8, 9          \\
        
        Google Pixel Pro     & Qorvo DW3720 & 2            & IEEE 802.15.4z, FiRa\footnoteref{fira}, CCC\footnoteref{ccc}        & $\pm$\SI{10}{\centi\metre}  & 5, 6       \\

        Qorvo DWM3000EVB     & DW3110       & 1            & IEEE 802.15.4z, FiRa\footnoteref{fira}, CCC\footnoteref{ccc}, ANI\footnoteref{ani}   & $\pm$\SI{10}{\centi\metre}  & 5, 6       \\

        \bottomrule

        \end{tabularx}
\end{minipage}
\end{table*}


\subsection{Applications}
Smartphones with \ac{uwb} have a few applications in which the technology is used to provide an extra layer of security or positional awareness. We present major applications that are already deployed. 

% car key
The Digital Key 3.0 allows hands-free keyless access using distance measurements of \ac{uwb} in combination with Bluetooth Low Energy to check whether an authorized person is near the vehicle~\cite{CarConnectivityConsortium}. The vehicle unlocks automatically and can be started when the person sits inside (\ac{pkes}). At the time of writing only iPhones support \ac{uwb} car keys, while the Google Pixel offers support for \ac{nfc}-based car keys. 

% ING Mobile payments 
NXP and the ING bank announced that they will work on supporting \ac{uwb} on Samsung smartphones to use it for payments to nearby users. \Ac{uwb} is intended as an extra security layer and omits the need to exchange bank account numbers before sending a payment~\cite{inggroupPointPay2022,nxpsemiconductorsNXPCollaboratesING}.

% Precision finding tag
\Ac{uwb}-tags are already widespread and allow the tracking of personal belongings.
These tags are usually not much bigger than a coin, have an integrated power-saving \ac{uwb} chip and can therefore run for several months on one charge. The precision finding feature uses \ac{uwb} to measure the distance and the \ac{aoa} to the missing tracker and shows that on the user's smartphone~\cite{NearbyInteractionApple,samsungelectronicsincIntroducingNewGalaxy2021,appleinc.FindYourKeys2022}.

% Smart home / Iot 
Several smart home and \ac{iot} applications would benefit from the application of \ac{uwb}. A smart door lock with \ac{uwb} would increase the security over a \ac{ble}-based version. In November 2022, Samsung announced plans for an aforesaid smart lock~\cite{shaikSamsungWalletGets2022}. 
Presence detection of people in a room could be leveraged to control lighting and heating based on personal preferences. To the best of our knowledge, no smart home devices with \ac{uwb} are available on the consumer market. 


\subsection{Related Work}\label{sec:related_work}

Many works focus on indoor-localization techniques based on \ac{uwb}~\cite{niculescuEnergyefficientPreciseUWBbased2022,flueratoruHighAccuracyRangingLocalization2022, caoDistributedTDMAMobile2021, fengKalmanFilterBasedIntegrationIMU2020}.
Our work focuses on consumer smartphones, their \ac{uwb} ranging accuracy, reliability, and the security implications that inaccurate measurements can have. Therefore, the related work can be separated into two areas, the general \ac{uwb} accuracy and the security analyses of the \ac{uwb} protocols. To the best of our knowledge, we are the first to evaluate and compare the \ac{uwb} ranging accuracy of consumer smartphones. 

\subsubsection{Ranging accuracy}

Related work in this area mainly concentrates on the evaluation of available development kits for \ac{uwb} hardware. Between 2015 and 2017, after the first \ac{uwb} chipsets became available, the first evaluations on ranging accuracy and performance have been conducted~\cite{malajnerUWBRangingAccuracy2015,jimenezComparingDecawaveBespoon2016,jimenezruizComparingUbisenseBeSpoon2017}. During that time only the \ac{uwb} \ac{hrp} mode was available, and it was lacking any security measures. All devices evaluated during this time are no longer compatible with current \ac{uwb} standards.
In 2020, after the release of IEEE 802.15.4z with \ac{lrp} and the \ac{sts} to secure \ac{hrp} measurements, studies have started to compare \ac{lrp} and \ac{hrp} in terms of energy consumption~\cite{flueratoruEnergyConsumptionRanging2020}. 
Works in 2022 also evaluate the accuracy of the DW3000 chipsets from Qorvo in development kits, like the DWM3000EVB~\cite{tiemannExperimentalEvaluationIEEE2022a,flueratoruHighAccuracyRangingLocalization2022,juranHandsOnExperienceUWB2022}.
The DW3000 has also been compared to \ac{lrp} devices~\cite{flueratoruHighAccuracyRangingLocalization2022}. In 2022, researchers discovered that the default DW1000 antenna has an uneven radiation pattern and the researchers evaluated the ranging error from several angles by using unmanned aerial vehicles \cite{niculescuEnergyefficientPreciseUWBbased2022}. 
We compared several works with our result in~\cref{ssec:comparison_related_work}. 

\subsubsection{UWB Security}
IEEE 802.15.4z \ac{hrp} mode has been evaluated for its security and the first attacks on it have been discovered. Previous work analyses the theoretical potential for multipath effects that could cause a distance reduction attack~\cite{singhSecurityAnalysisIEEE2021a}. Since no open-source implementations are available, a simulated \ac{hrp} receiver according to the standard has been implemented and evaluated. Follow-up work has confirmed that the theoretical attack also works on devices that integrated Apple's U1 \ac{uwb} chip~\cite{279984}. Practical distance reductions of several meters have been possible by using a DWM3000 \ac{uwb} sending frames with low power and the same preamble at the same time as the other \ac{uwb} transmitter.
The success rate of the attack was less than \SI{5}{\percent}. Hence, it shows that the applied security measures are not sufficient to stop all attacks. 

