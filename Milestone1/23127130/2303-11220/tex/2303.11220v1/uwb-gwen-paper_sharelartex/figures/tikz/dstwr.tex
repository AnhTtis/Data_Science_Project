% !TeX root = ../../main.tex

\begin{figure}[!t]
    \centering
    \begin{sequencediagram}
        \renewcommand\unitfactor{0.4}
        \newthread[gray][0]{i}{Initiator}
        \newthread[gray][3]{r}{Responder}
        
        \mess[1]{i}{poll}{r};
        \node[anchor=east] (t0) at (mess from) {};
        \node[anchor=west] (t1) at (mess to) {};

        \postlevel
        \mess[1]{r}{response, \color{seemoo_organge}$T_{\text{reply}_1}$}{i};
        \node[anchor=west] (t2) at (mess from) {};
        \node[anchor=east] (t3) at (mess to) {};

        \postlevel
        \mess[1]{i}{\color{seemoo_organge}$T_{\text{round}_1}, T_{\text{reply}_2}$}{r};
        \node[anchor=east] (t4) at (mess from) {};
        \node[anchor=west] (t5) at (mess to) {};

        \begin{scope}[]
            \mess[1]{r}{\color{seemoo_organge}$d$ or $T_{\text{round}_2}$}{i};
        \end{scope}

        \draw[decorate,decoration = {brace}] ($(t1.center)- (-0.1,0)$) -- ($(t2.center)- (-0.1,0)$)
        node [align=center,midway,anchor=west] {$T_{\text{reply}_1}$};

        \draw[decorate,decoration = {brace}] ($(t3.center)- (0.1,0)$) -- ($(t0.center)- (0.1,0)$)
        node [align=center,midway,anchor=east] {$T_{\text{round}_1}$};

        \draw[decorate,decoration = {brace}] ($(t2.center)- (-0.1,0)$) -- ($(t5.center)- (-0.1,0)$)
        node [align=center,midway,anchor=west] {$T_{\text{round}_2}$};

        \draw[decorate,decoration = {brace}] ($(t4.center)- (0.1,0)$) -- ($(t3.center)- (0.1,0)$)
        node [align=center,midway,anchor=east] {$T_{\text{reply}_2}$};

    \end{sequencediagram}
    \caption{Message exchange diagram of Double Sided - Two Way Ranging. After the third message the responder is able to calculate the distance using \Cref{eq:dist_ds}. Elements in organge are optional.}\label{fig:seq_ds_twr}
\end{figure}