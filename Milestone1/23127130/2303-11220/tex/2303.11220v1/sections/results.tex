% !TeX root = ../main.tex

\definecolor{DW3000}{HTML}{293462}
\definecolor{Pixel}{HTML}{F24C4C}
\definecolor{Galaxy}{HTML}{EC9B3B}
\definecolor{iPhone}{HTML}{F7D716}
\newcommand\polarscale{0.66}
\newcommand\linescale{1.0}
\newcommand\subfigtextwidth{0.32\textwidth}

\ifsubmission{}
\else
\printinunitsof{in}\prntlen\textwidth
\fi 

% \input{tables/all_device_stats.tex}

\section{Measurement Results}\label{sec:results}
\noindent 
% 3 locations * 5 device combinations * 2 distances - 2 failed measurements on Pixel 6 Pro  = 28
In total, we conducted $28$ measurement series at three environments using four different devices. 
All \ac{uwb} capable smartphones have been evaluated at two different distances: \SI{5}{\metre} and \SI{0.5}{\metre}. 
We conducted the same measurements using the Qorvo DWM3000EVB as a reference. 
Measurements with larger distances were mostly not possible, since all smartphones fail to measure if the antennas are not directed at each other. 
All \acp{dut} have been placed on \ac{gwen} as described in \cref{sec:experimental_setup}. 
\ac{gwen} performed a \SI{360}{\degree} base rotation ($\theta$) and a \SI{180}{\degree} arm rotation ($\phi$) using a step size of \SI{10}{\degree}. At each position, a minimum of $10$ distance measurements have been recorded.
In this section, we state our measurement results, draw general statistics about each \ac{dut}, and take a look at each location to compare how devices behave differently depending on their environment.  

\subsection{Maximum distance}
In an initial measurement, we evaluated the maximum measurable distance of all smartphones in our test set. We used an outside location that has no obstructions.
The results are listed in \cref{tab:max_distance_uwb}. The iPhone is able to continuously measure the longest distance. We identified that the maximum is artificially limited to about \SI{40}{\meter} on the iPhone and \SI{23}{\meter} on the Samsung Galaxy S21 Ultra. In our evaluation, the measurements stopped at exactly that distance. 
The Google Pixel performed the worst here, and it was not possible to get reliable measurements at larger distances. The distance does not seem to be limited artificially.

\begin{table}
    \centering
    \caption{Maximum distance possible to measure with \ac{uwb}-enabled smartphones.}\label{tab:max_distance_uwb}
    \begin{tabular}[]{lr}
        \toprule
        Smartphone & Distance (m) \\ 
        \midrule
        Apple iPhone 12 Pro & 40.0 \\
        Samsung Galaxy S21 Ultra & 23.0 \\ 
        Google Pixel 6 Pro & 11.6 \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Overall results}

\begin{figure}[!t]
    \includegraphics[width=\columnwidth]{figures/boxplots.pdf}
    \caption{Distances measured outside, in a lab environment, and in a parking garage. The true distance (\SI{5}{\meter}) is marked in the plot along with the expected accuracy of $\pm$\SI{10}{\centi\metre}. The box plots show quartiles, median, and outliers. The violin plots show a kernel density estimate of the measurements.}\label{fig:violin}
\end{figure}

\begin{figure*}
    \captionsetup[subfigure]{justification=centering}
    \centering
    \begin{subfigure}[t]{\subfigtextwidth}
        \centering
        % \scalebox{\linescale}{\input{figures/eval/devices/accuracy.pgf}}
        \includegraphics{figures/eval/devices/accuracy.pdf}
        \caption{Accuracy}\label{fig:accuracy}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{\subfigtextwidth}
        \centering
        \includegraphics{figures/eval/devices/mae.pdf}
        % \scalebox{\linescale}{\input{figures/eval/devices/mae.pgf}}
        \caption{Mean absolute error (MAE) with standard deviation (SD)}\label{fig:mae}
    \end{subfigure}
    \hfill
    % \begin{subfigure}[b]{\subfigtextwidth}
    %     \centering
    %     % \scalebox{\linescale}{\input{figures/eval/devices/sd.pgf}}
    %     \includegraphics{figures/eval/devices/sd.pdf}
    %     \caption{Mean standard deviation}\label{fig:sd}
    % \end{subfigure}
    % \hfill
    \begin{subfigure}[t]{\subfigtextwidth}
        \centering
        % \scalebox{\linescale}{\input{figures/eval/devices/failed_measurements.pgf}}
        \includegraphics{figures/eval/devices/failed_measurements.pdf}
        \caption{Failed measurement positions}\label{fig:failed_measurements}
    \end{subfigure}
    \hfill

    \caption{ Statistical data of all measurements performed on the
         {\color{DW3000} \rule{3pt}{9pt}  DW3000}, {\color{Pixel} \rule{3pt}{9pt} Google Pixel 6 }, {\color{Galaxy} \rule{3pt}{9pt} Samsung S21 Ultra}, and {\color{iPhone} \rule{3pt}{9pt} iPhone 12 Pro}. Failed measurements are excluded. }

\end{figure*}

\Cref{fig:violin} plots the results of all measurements conducted at a \SI{5}{\metre} distance. The plot is a combination of a violin plot and a box plot. 
We can see that most measurements are in proximity to the expected distance. 
%The median distance is within our defined accuracy range for most measurements. Only in the Lab environment, we can see certain outliers, like the iPhone at \SI{5}{\meter} distance and the DW3000 at \SI{0.5}{\meter} distance. 
Interestingly, the \acp{dut} have shown large maximum errors. The Samsung Galaxy reduced the distance by up to \SI{5}{\meter}, the Apple iPhone, and the Google Pixel by up to \SI{3}{\meter}. %These large reductions can be problematic if the implementation of \ac{pke} system only needs one successful reduction to trigger an unlock action. 

To evaluate the accuracy we define a range of $\pm$\SI{10}{\centi\meter} the actual distance as accurate. An error of $\pm$\SI{10}{\centi\meter} is advertised by chip manufacturers~\cite{qorvoinc.DW3000DataSheet2020,amosenseco.ltdAmotechSR040Module2021}. %All measurements in this range are counted as accurate. 
Since the antenna is in the intersection of the rotation axes, movements of \ac{gwen} did not alter the distance. In \cref{fig:violin} the accuracy range is marked in gray. 
\Cref{fig:accuracy} shows the percentage of accurate measurements. The accuracy ranges between $20\%$ and $60\%$. Depending on the environment and distance, for a given device it can vary by up to $50\text{pp}$. % pp = percentage points


Although the maximum errors can be large, \cref{fig:mae} shows that the \ac{mae} is less than \SI{20}{\centi\metre}, while the mean \ac{sd} is below \SI{25}{\centi\metre} for each measurement series. \Cref{fig:failed_measurements} plots the percentage of failed measurements. A failed measurement is a position ($\theta$ \& $\phi$) of \ac{gwen} at which less than $10$ measurements were recorded in $\SI{30}{\second}$. A high failure rate translates into an unreliable \ac{uwb} system. 

\Cref{fig:polar_all} shows a polar plot of a full base rotation ($\theta \in [\SI{0}{\degree},\SI{350}{\degree}]$) with the arm position fixed at $\phi = \SI{90}{\degree}$. The remote device is placed at the angle of $\theta = \SI{0}{\degree}$ at a distance of \SI{5}{\meter}. This plot corresponds to the setup shown in \cref{fig:GWEn_setup_top_view}.  



\begin{figure*}[!t]
    \captionsetup[subfigure]{justification=centering}
    \centering

    \begin{subfigure}[t]{\subfigtextwidth}
        \centering 
        \scalebox{\polarscale}{\input{figures/eval/devices/polar_plots/polar_90_Outside_5.pgf}}
        \caption{\textbf{Outdoor}}\label{fig:outdoor_polar}
    \end{subfigure}
    \hfill 
    \begin{subfigure}[t]\subfigtextwidth
        \centering 
        \scalebox{\polarscale}{\input{figures/eval/devices/polar_plots/polar_90_Lab_5.pgf}}
        \caption{\textbf{Lab}}\label{fig:lab_polar}
    \end{subfigure}
    \hfill 
    \begin{subfigure}[t]\subfigtextwidth
        \centering 
        \scalebox{\polarscale}{\input{figures/eval/devices/polar_plots/polar_90_Car_5.pgf}}
        \caption{\textbf{Car parking garage}}\label{fig:car_polar}
    \end{subfigure}

    \caption{Mean Measurements at $\SI{5}{\meter}$ distance with one full base rotation ($\theta \in [\SI{0}{\degree},\SI{350}{\degree}]$). Arm position is fixed to $\phi=\SI{90}{\degree}$}\label{fig:polar_all}

\end{figure*}


\subsection{Outside}

% \begin{figure*}
%     \centering
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \scalebox{0.57}{\input{figures/eval/devices/Graphs/outside/Google Pixel 6/Google Pixel 6_Samsung S21 Ultra_Outside_5m_2022-10-11_11-05-44/plot_sbar_sinv/polar_90_.pgf}}
%         \caption{Pixel 6 Pro}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \scalebox{0.57}{\input{figures/eval/devices/Graphs/outside/Samsung S21 Ultra/Samsung S21 Ultra_Samsung S21 Ultra_Outside_5m_2022-10-06_14-56-09/plot_sbar_sinv/polar_90_.pgf}}
%         \caption{Galaxy S21 Ultra}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \scalebox{0.57}{\input{figures/eval/devices/Graphs/outside/iPhone_iPhone/iPhone_12_pro_iPhone_12_mini_Outside_5m_2022-06-28_11-41-05/plot_sbar_sinv/polar_90_.pgf}}
%         \caption{iPhone 12 Pro}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \scalebox{0.57}{\input{figures/eval/devices/Graphs/outside/DW3000_DW3000/DW3000_DW3000_Outside_5m_2022-05-25_12-23-58/plot_sbar_sinv/polar_90_.pgf}}
%         \caption{DW3000}
%     \end{subfigure}
%     \caption{Outdoor measurements at \SI{5}{\metre} distance. One full base rotation of \ac{gwen} and arm position at \SI{90}{\degree}.}
% \end{figure*}


This section covers our measurements conducted outside, on soil ground without any obstructions that could reflect the measurements. 
Missing surfaces to reflect the signals influence the measurements. At larger distances, the signals that are directed away from the remote device, do not reach it or the \ac{dut} cannot receive signals while the antenna is directed away from the remote device. 

\paragraph*{Accuracy} 
For most devices, the measurements outside resulted in the highest percentage of accurate measurements. This likely stems from the minimal interference and lack of obstacles that could have produced reflections. As visible in \cref{fig:outdoor_polar} there is a correlation between the base position and the accuracy. 
Overall the Google Pixel 6 Pro had the best accuracy, followed by the DW3000, which created clearly visible outliers at several positions. 

\paragraph*{Measurement error}
The \ac{mae} and \ac{sd} of most devices are low and close to the goal of \SI{10}{\centi\meter}. Only the iPhone has a largely increased \ac{sd} of \SI{23}{\centi\meter} at the \SI{5}{\meter} distance. All other devices produce similar results. 
Moreover, the Google Pixel and the iPhone also produced outliers of up to \SI{-3}{\meter}. Previous research~\cite{singhSecurityAnalysisIEEE2021a} expected these failures only in a multipath environment, but our measurements show that they can also occur without reflections. 

\paragraph*{Reliability}
% Accuracy + Failure rate. e.g. Samsung is more accurate at 5m because it fails more often. 
Interestingly, we can see very large failure rates on all smartphones at a distance of \SI{5}{\meter}. By rotating the base ($\theta$) of \ac{gwen} the \ac{dut}'s antenna will point away from the remote device when $\theta \in [90, 270]$. The signals are no longer strong enough to reach both devices. The effect is the strongest, when the arm is at $\phi = \SI{90}{\degree}$ and the phone internals are shielding the \ac{uwb} antenna. 
In \Cref{fig:outdoor_polar} failed measurements are not plotted. 
The Google Pixel is the most unreliable here and fails to measure at \SI{37.8}{\percent} of all positions. 
At the \SI{0.5}{\meter} distance this effect was not visible. 
The DWM3000 has an exposed antenna and therefore does not fail to receive signals at any position. 



\subsection{Lab}

In this section, we cover the results of the measurements conducted in our lab. This location had the most surfaces and reflecting areas, i.e., whiteboards and screens, in our measurement series.
This resulted in very good reliability but reduced accuracy. 

\paragraph*{Accuracy}
Depending on the distance and the device, the accuracy in this environment varies a lot. The DW3000 has an accuracy of \SI{20.8}{\percent} at \SI{0.5}{\meter}, while the Samsung reaches \SI{56.4}{\percent}. \Cref{fig:lab_polar} shows how the accuracy on all smartphones is worse when $\theta \in [90,270]$. Most outliers are distance enlargements due to longer paths caused by reflections of the signals. Only the Samsung Smartphone measured reduced distances of \SI{0.0}{\meter} and \SI{0.03}{\meter}. 

\paragraph*{Measurement error}
The Apple iPhone has the largest \ac{mae} of \SI{19.9}{\centi\meter}, which is also visible in \cref{fig:lab_polar}. The iPhone may select the wrong first path and therefore, increase or even decrease the measured distance. 
This behavior also aligns with a previously presented attack on Apple's U1 \ac{uwb} chip, which has shown that the iPhone can be tricked into accepting an attacker's pulse as the first path and, therefore, producing shortened distance measurements~\cite{279984}. 

However, this error is only present at larger distances. The same characteristic that blocked the signals outside, is now resulting in increased errors. 

\paragraph*{Reliability}
The strong multipath effects in this environment result in fewer failed measurements (see \cref{fig:failed_measurements}). The Google Pixel has the highest failure rate of \SI{1}{\percent} all other devices are able to measure reliably at all positions.
At \SI{0.5}{\meter} all devices measured reliably. 


\subsection{Parking garage}

The public parking garage had over twenty cars on one level. The results of these measurements are presented in this section. The remote devices were placed next to a parked car. As always, both devices were placed in \ac{los}. Multipath effects occur in this environment, but they are less common than in the lab environment. 

\paragraph*{Accuracy}
The overall accuracy of all smartphones increased compared to the lab environment. The Google Pixel performs best at \SI{5}{\meter} reaching an accuracy of \SI{71.9}{\percent}. All other devices performed similarly and were accurate in \SI{50}{\percent} of the measurements. For \SI{0.5}{\meter} the iPhone is the most accurate with \SI{76.5}{\percent} of accurate measurements. 

\paragraph*{Measurement error}
The measurement error of all devices is less than \SI{14}{\centi\meter} in an environment where this technology is already deployed in a \ac{pke} system for modern cars. Additionally, we did not measure large negative outliers on any device. 
All smartphones produced distance enlargements and Samsung Galaxy measured a distance of up to \SI{+2.79}{\meter}. 

\paragraph*{Reliability}
The reliability in this environment is good, with less than \SI{10}{\percent} of failed measurements on any device and distance. Since the garage had a concrete roof, concrete floor and many cars around, the reflections of the \ac{uwb} signal were able to reach the remote device.
Similar to the outside environment, the smartphone internals block the signal transmission and the environment did not provide enough reflections to allow for multipath transmissions. 
In practice, this means, that smartphones might need several attempts to measure the distance to a car from a larger distance, but should not fail.
 
In \cref{fig:car_polar} we can see fewer failed ranging measurements as in the outdoor environment. 
At base rotations of  $\theta \in [\SI{100}{\degree}, \SI{230}{\degree}]$, several measurements failed. Similarly to the outside environment, the smartphone internals block the signal transmission and the environment did not provide enough reflections to allow for multipath transmissions. 
 

\subsection{Influence of the remote device}\label{ssec:different_remote_device}

As mentioned in \cref{ssec:dev_conf}, the iPhone and Android smartphones are not compatible to perform \ac{uwb} distance ranging with each other. Fortunately, Android devices from different manufacturers are compatible, and we, therefore, performed all measurements of the Google Pixel as a \ac{dut} also with a Samsung Galaxy as the remote device. 

Unfortunately, we were not able to measure with a Google Pixel as a remote device in the outdoor environment. This was supposed to be our last measurement series, but the phones were not able to connect at all over \ac{uwb}. A software reset of the devices did not result in any change. Therefore, our outside measurements of the Google Pixel purely use a Samsung Galaxy as the remote device. 

We measured a consistent improvement in all areas when using the Samsung Galaxy as the remote device. 
The measurements failed less often and the accuracy increased by $5\text{pp}$  to $10\text{pp}$. The \ac{mae} is slightly worse in this setting and outliers were similar. The remote device has an influence on the overall measurement performance. The Samsung Galaxy might have a stronger antenna, and therefore, reduces the failure rate. 



