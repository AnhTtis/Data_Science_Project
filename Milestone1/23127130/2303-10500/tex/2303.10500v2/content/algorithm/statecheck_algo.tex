\begin{algorithm}[!h]
\caption{Proving that a state vector update is valid}\label{pseudo_code_valid}
\begin{algorithmic}[!h]
\Procedure{StateChange}{}
\State $v_{curr} \gets \text{Currnent state vector}$
\State $v_{next} \gets \text{New state vector}$
\State $A \gets [\textit{nothing};3] $
\For{$i\textbf{ in }0..\textit{len}(T)$}
\State \textbf{assert} $v_{curr}[i] <= 2$
\State \textbf{assert} $v_{next}[i] <= 2$
\EndFor
%\State pos $\gets 0$
\State \textit{changeCount} $\gets 0$
\For{$i\textbf{ in } 0..\textit{len}(T)$}
\If{$v_{next} == v_{curr}$} \textbf{continue}
\ElsIf{$v_{curr} == 1 \textbf{ and } v_{next} == 2$} 
\State $A[\textit{changeCount}] \gets [-1, i]$
\ElsIf{$v_{curr} == 0 \textbf{ and } v_{next} == 1$} 
\State $A[\textit{changeCount}] \gets [1, i]$
\Else
\State $A[\textit{changeCount}] \gets [-1, -1]$
\EndIf

\State $\textit{changeCount} \gets \textit{changeCount}+1$
\EndFor

%------- CONSTRUCT A END -------
\State \textbf{assert } \textit{changeCount} $\leq 3$
\If{\textit{changeCount} $== 0$}
\State \textbf{return true}
\EndIf
\State \textit{result} $\gets \textbf{false}$
\For{$i\textbf{ in } 0..W$}
\State \textit{allPairMatch} $\gets \textbf{true}$
\For{$j\textbf{ in } 0..3$}
\State \textit{pariFound} $\gets \textbf{false}$
\For{$k\textbf{ in } 0..3$}
\If{$A[k][0] == P[i][j][0] \textbf{ and } A[k][1] == P[i][j][1]$}
\State \textit{pariFound} $\gets \textbf{true}$
\EndIf
\EndFor
\If{$!$\textit{pariFound}}
\State \textit{allPairMatch} $\gets \textbf{false}$
\State \textbf{continue}
\EndIf
\EndFor
\If{$\textit{allPairMatch}$}
\State \textit{result}$\gets\textbf{ true}$
\EndIf
\EndFor
%------- COMPARE P END -------
\State \textit{// Testing for parallel gateway ends}
\If{\textit{changeCount} $== 1$}
\State \textit{ParallelTest}($A$)
\EndIf


%------- PARALLEL TEST --------
%------- END -------
\State \textbf{return} \textit{result}
\EndProcedure
\end{algorithmic}
\end{algorithm}