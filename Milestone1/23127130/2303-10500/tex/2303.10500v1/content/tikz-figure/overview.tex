\begin{figure}
    \centering
    \begin{tikzpicture}[font=\sffamily,line width=0.03cm,line width=0.02cm, scale=0.70,every node/.style={scale=0.70}]
            
        \node[event] (start1) {};
        \node[task,right=0.5cm of start1,fill=green!30!white] (act) {\tiny A};
        \draw[-{Stealth[inset=0pt]}] (start1) -- (act);
	    \node[intermediate event,right=0.5cm of act,fill=green!30!white] (imt) {\tiny \faEnvelope};
	    \draw[-{Stealth[inset=0pt]}] (act) -- (imt);
	    \node[end event,right=0.5cm of imt](end1){};
	    \draw[-{Stealth[inset=0pt]}] (imt) -- (end1);
	    \node[minimum width=6.5cm,minimum height=2cm,draw,rectangle,fit=(imt) (act) (start1) (end1)](b){};
        \node[rotate=90,draw,rectangle,left=0.2cm of b,xshift=1cm,yshift=-\pgflinewidth*4,minimum width=2cm] (p){\tiny Participant 1};
        
        \node[intermediate event,below=1.5cm of imt,fill=orange!50!white] (imc) {\tiny\faEnvelope[regular]};
        \node[task,left=0.5cm of imc,fill=green!30!white] (act2) {\tiny B};
        \draw[-{Stealth[inset=0pt]}] (act2) -- (imc);
        \node[event,left=0.5cm of act2] (start2) {};
        \draw[-{Stealth[inset=0pt]}] (start2) -- (act2);
	    \node[end event,right=0.5cm of imc](end2){};
	    \draw[-{Stealth[inset=0pt]}] (imc) -- (end2);
	    \node[minimum width=6.5cm,minimum height=2cm,draw,rectangle,fit=(imc) (act2) (start2) (end2)](p2){};
	    \node[rotate=90,draw,rectangle,left=0.2cm of p2,xshift=1cm,yshift=-\pgflinewidth*4,minimum width=2cm] (p2l){\tiny Participant 2};
	        
	   \draw[-{Stealth[open,inset=0pt]},dashed] (imt) -- (imc); 
	   \node[draw,circle,minimum size=0.1cm,inner sep=0pt, outer sep=0pt] at (imt.south) {};
	   
	   \node[draw,cloud,fit=(b) (p2) (p2l) (p), aspect=1.6,cloud puffs = 16,minimum width=10cm,minimum height=9cm] (cloud) {};
	   
	   
	   	\node[rectangle,draw,minimum width= 3cm,minimum height=1.5cm,below=0.75 of cloud,xshift=-1.5cm](sc){Smart contract};
	    \node[rectangle,draw,minimum width= 3cm,minimum height=1.5cm,right=0cm of sc,xshift=-\pgflinewidth,align=center](c){hash(state)\\encrypt(state)};
	    \draw[-{Stealth[inset=0pt]},dashed] (c.north) +(0.5,-0.3) -- (cloud);
	    \node[below=0.1cm of c,xshift=0.6cm] (bc){Blockchain};
	    \node[draw,rectangle,fit=(c) (sc) (bc),minimum width=7cm,minimum height=2.5cm]{};
	    
	    \node[draw,semicircle,below=2.25cm of bc,minimum size=0.5cm,inner sep=0pt, outer sep=0pt,xshift=-7cm] (p1b){};
	    \node[draw,circle,below=of bc,minimum size=0.5cm,inner sep=0pt, outer sep=0pt,above=0cm of p1b] (p1h){};
	    \node[below=0.5cm of p1h]{Participant 1};
	    
	    \node[draw,semicircle,below=2.25cm of bc,minimum size=0.5cm,inner sep=0pt, outer sep=0pt,xshift=2cm] (p2b){};
	    \node[draw,circle,below=of bc,minimum size=0.5cm,inner sep=0pt, outer sep=0pt,above=0cm of p2b] (p2h){};
	    \node[below=0.5cm of p2h]{Participant 2};
	    
	    \node[right=2.8125 cm of p1b] (msg) {\huge\faEnvelope[regular]};
	    \node[below=0.25cm of msg,align=center]{DB,IPFS\\Email,IM,...};
	    
	    \draw[-{Stealth[inset=0pt]}] (p1b) to node[below,draw,circle,yshift=-0.1cm] {1.} (msg);
	    \draw[-{Stealth[inset=0pt]}] (msg) to (p2b);
	    
	    \draw[->,bend angle=25, bend left] (p1h) to node[right,align=right,yshift=-0.6cm]{update: hash(state)\\encrypt(state)\\ prove: "I'm next" \\Commit to hash(M)} node[above,draw,circle,yshift=0.45cm]{2.} (sc);
	    \draw[->,bend angle=25, bend left] (c) to node[left,align=right,yshift=-0.4cm]{Check Message M} node[above,draw,circle,xshift=0.4cm]{3.}  (p2h);
    %\node[draw,cloud,fit=(a) (b)] {};
    \end{tikzpicture}
    \caption{Overview of the zkWF protocol}
    \label{fig:basic_update}
\end{figure}
