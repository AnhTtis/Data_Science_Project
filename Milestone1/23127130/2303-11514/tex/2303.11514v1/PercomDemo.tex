\documentclass[10pt, conference, compsocconf]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{xurl}
\usepackage{subcaption}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Service-based Trajectory Planning in Multi-Drone Skyway Networks}

\author{\IEEEauthorblockN{Sarah Bradley\IEEEauthorrefmark{1},
Albertus Alvin Janitra\IEEEauthorrefmark{2}, Babar Shahzaad\IEEEauthorrefmark{3},
Balsam Alkouz\IEEEauthorrefmark{4},
Athman \\Bouguettaya\IEEEauthorrefmark{5}, and
Abdallah Lakhdari\IEEEauthorrefmark{6}}
\IEEEauthorblockA{School of Computer Science,
The University of Sydney\\
Australia\\
Email: \IEEEauthorrefmark{1}sbra0523@uni.sydney.edu.au,
\IEEEauthorrefmark{2}ajan8924@uni.sydney.edu.au,
\IEEEauthorrefmark{3}babar.shahzaad@sydney.edu.au,\\
\IEEEauthorrefmark{4}balsam.alkouz@sydney.edu.au,
\IEEEauthorrefmark{5}athman.bouguettaya@sydney.edu.au,
\IEEEauthorrefmark{6}abdallah.lakhdari@sydney.edu.au
}}

% \author{\IEEEauthorblockN{Xijing Liu}
% \IEEEauthorblockA{\textit{School of Computer Science} \\
% \textit{The University of Sydney}\\
% Australia \\
% xliu4593@uni.sydney.edu.au}

% \and
% \IEEEauthorblockN{Kevin Lam}
% \IEEEauthorblockA{\textit{School of Computer Science} \\
% \textit{The University of Sydney}\\
% Australia \\
% lamkevin042@gmail.com}

% \and
% \IEEEauthorblockN{Balsam Alkouz}
% \IEEEauthorblockA{\textit{School of Computer Science} \\
% \textit{The University of Sydney}\\
% Australia \\
% balsam.alkouz@sydney.edu.au}

% \and
% \IEEEauthorblockN{Babar Shahzaad}
% \IEEEauthorblockA{\textit{School of Computer Science} \\
% \textit{The University of Sydney}\\
%  Australia \\
% babar.shahzaad@sydney.edu.au}

% \and
% \IEEEauthorblockN{Athman Bouguettaya}
% \IEEEauthorblockA{\textit{School of Computer Science} \\
% \textit{The University of Sydney}\\
% Australia \\
% athman.bouguettaya@sydney.edu.au}
% }

\maketitle

\begin{abstract}
We present a demonstration of service-based trajectory planning for a drone delivery system in a multi-drone skyway network. We conduct several experiments using Crazyflie drones to collect the drone's position data, wind speed and direction, and wind effects on voltage consumption rates. The experiments are run for a varying number of recharging stations, wind speed, and wind direction in a multi-drone skyway network. \\ Demo: \url{https://youtu.be/zEwqdtEmmiw}  
\end{abstract}

\begin{IEEEkeywords}
Drone Delivery, Flight Trajectory, Drone Service, Multi-Drone Skyway Network.
\end{IEEEkeywords}

\section{Introduction}

Drones are a specific type of unmanned aerial vehicles that fly \textit{autonomously} with full network connectivity capabilities \cite{8119717}. This connectivity enables drones to operate \textit{safely} and provide a multitude of civilian applications on large scales \cite{9885785}. Examples of these applications include geographic mapping and surveying, disaster management, and delivery of packages \cite{shakhatreh2019unmanned}. The \textit{ubiquity} of drones in the sky has prompted an increasing interest of several logistics companies such as Amazon, Wing, and Flytrex to use drones for package delivery \cite{alkouz2022density}. Drones provide \textit{faster, safer, contactless}, and \textit{resilient} delivery solutions \cite{10016378}. However, drones have \textit{inherent constraints} on battery capacity, flight range, and payload capacity \cite{10.1145/3460418.3479289}. These constraints hinder the full potential utilization of drones in dynamic environments \cite{alkouz2021service}. The deployment of a \textit{multi-drone skyway network} addresses these constraints and enables a robust service delivery in a dynamic environment with shared airspace \cite{wang2017integrating,9590339,wang2009web}. A multi-drone skyway network is constructed by linking a set of skyway segments where nodes are the rooftops of high-rise buildings \cite{liu2022constraint}. We concurrently use these rooftops both as recharging stations and delivery targets (Fig. \ref{skyway}).

\begin{figure}[t]
\centering
\includegraphics[width=0.75\linewidth]{Figures/fig1.jpg}
% \vspace{-0.4 cm}
\caption{Multi-Drone Skyway Network}
\label{skyway}
\vspace{-0.6 cm}
\end{figure}

This demo presents a novel \textit{service-based trajectory planning} for the provisioning of drone delivery in a multi-drone skyway network. Our service-based trajectory planning considers the recharging constraints of drones during the delivery operation. In this respect, these drones may need to wait for recharging pad availability if they share the \textit{same station}. This wait for recharging pad availability directly impacts the overall delivery time \cite{shahzaad2019constraint,shahzaad2021top}. Wireless recharging pads at intermediate stations enable and support long-distance deliveries \cite{jermaine2021demo}. We collect a multi-drone dataset under a \textit{range of parameters} where the drones wait for the recharging pad availability to be recharged. The parameters recorded in this dataset include the impact of varying wind conditions on the drone's battery consumption. We believe this dataset constitutes a valuable resource for understanding the drone's \textit{battery consumption behavior} and planning the \textit{time-optimal deliveries}.


% \begin{figure*}[t]

% \minipage{0.32\textwidth}
%   \includegraphics[width=\linewidth]{Figures/3Dmodel.png}
%   \caption{3D Model of City CBD}\label{3d}
% \endminipage\hfill
% \minipage{0.32\textwidth}
%   \includegraphics[width=\linewidth, height=3.8cm]{Figures/Coordinates.png}
%   \caption{Single Station Flight Path}
% \label{flightpath1}
% \endminipage\hfill
% \minipage{0.32\textwidth}%
%   \includegraphics[width=\linewidth, height=3.8cm]{Figures/xy2intermediate.png}
% \caption{Two Stations Flight Path}
% \label{flightpath2}
% \endminipage
% % \minipage{0.32\textwidth}
% %   \includegraphics[width=\linewidth]{Figures/ChargingCurve.png}
% % \vspace{-0.4 cm}
% % \caption{Voltage Over Time While recharging with Wireless Charger}
% % \label{voltageCharging}
% % \endminipage
% \end{figure*}

% \begin{figure*}[!htb]

% \minipage{0.32\textwidth}
%   \includegraphics[width=\linewidth]{Figures/fig6,1.png}
%   \caption{Drone Flight Path with 1 recharging Node}
% \label{flightpathCN1}
% \endminipage\hfill
% \minipage{0.32\textwidth}%
%   \includegraphics[width=\linewidth]{Figures/fig6,2.png}
% \caption{Drone Flight Path with 2 recharging Node}
% \label{flightpathCN2}
% \endminipage\hfill
% \minipage{0.32\textwidth}
%   \includegraphics[width=\linewidth]{Figures/fig6,3.png}
% \vspace{-0.4 cm}
% \caption{Voltage Over Time While recharging with Wireless Charger}
% \label{flightpathCN3}
% \endminipage
% \vspace{-0.4 cm}
% \end{figure*}


\begin{figure}[h]
  \centering
  \includegraphics[width=0.78\linewidth]{Figures/3Dmodel.png}
  \caption{3D Model of City CBD}\label{3d}
\vspace{-0.4 cm}
\end{figure}

\begin{figure}[t]
\centering
  \includegraphics[width=0.8\linewidth, height= 5.5cm]{Figures/Coordinates.png}
  \caption{Single Station Flight Path}
\label{flightpath1}
\vspace{-0.4 cm}
\end{figure}

\section{Demo Setup}

% We gather data on various drone parameters under the considered intrinsic and extrinsic factors with a focus on the impact of wind on battery consumption rates and the implementation of intermediate recharging nodes in a shared skyway network. 

We use three Crazyflie 2.1 nano-quadcopter drones by Bitcraze in a 3D model of the City CBD as an indoor testbed to mimic a multi-drone skyway network (Fig. \ref{3d}). Two HTC Vive base stations are used that employ infrared laser technology to calculate the coordinates of each drone. A fan with adjustable speed is used to simulate the wind conditions. Two NORDMÃ„RKE wireless chargers\footnote{\url{https://www.ikea.com/au/en/p/nordmaerke-wireless-charger-white-cork-90478064/}} are utilized for wireless recharging of drones at the intermediate stations.

% \vspace{-0.2 cm}
% \subsection{Software Components}

% \subsubsection{\textbf{Skyway Network}}
% \label{lineofsight}
% We construct a skyway network using the (x, y, z) coordinates of the building rooftops. The skyway network takes into account the drone flying regulations, including flying within LoS and avoiding no-fly zones. The LoS is defined as a \emph{direct line segment} between any two building rooftops having no barrier in between. We develop a LoS algorithm to compute the LoS paths between building rooftops considering no-fly zones. The no-fly zones are usually defined by aviation authorities for security and public safety, e.g., CASA in Australia\footnote{https://www.casa.gov.au/drones/drone-rules/flying-near-emergencies-and-public-spaces}. We specify seven no-fly zones where drones are not permitted to fly (as shown in Fig. \ref{skyway}).

% The LoS algorithm detects barriers (i.e., intersecting buildings) between any two nodes (i.e., building rooftops) to form a skyway path between them.

% We first construct a rectangular polygon to represent a path between any two nodes taking into account the drone width. Then, we discover and mark all nodes intersecting with the rectangular polygon considering only the xy-plane. The initial two steps are used to reduce the search space and computation cost by selecting only feasible nodes. We then construct a right angle triangle between any two buildings using their heights which are represented by z-axis (as shown in Fig. \ref{los}). The yellow circled nodes indicate nodes which intersect with the rectangular polygon considering their z-axis. The nodes above than the right angle triangle obstruct the LoS path (e.g., node A in this scenario). While the nodes below or within the right angle triangle do not obstruct the LoS path (e.g., node B and node C). We define a LoS-based straight path between any two nodes if no node obstructs the path. This process continues until all possible LoS paths are computed and connected to form the skyway network.


\section{Data Collection}

We use Crazyflie Python API for data collection with the settings of single and two intermediate recharging stations. We performed 70 flights from which 35 flights with a \textit{single station} (Fig. \ref{flightpath1}) and 35 with \textit{two stations} (Fig. \ref{flightpath2}). Each drone records the following data points with a timestamp of 100 ms during its flight: (x, y, z) coordinates, roll, pitch, yaw, voltage, relative wind direction, travel distance, and waiting time at a recharging station.
% The term 'node' refers to the location of a tower in the 3D Sydney CBD model. 
% Additionally, we track the change in voltage of all three drones while recharging on a wireless recharging pad from low voltage (3.2 volts) to full voltage (greater than 4.15 volts).
%  We consider a number of operational parameters (wind speeds, wind directions, skyway segments, initial voltage) to fly each drone.
The data collected from the experiments are organized in CSV files by the number of recharging nodes, path, wind speeds, wind direction, and drone. %\footnote{\url{https://bit.ly/3ObYMOm}}.
The drones are labeled as E3, E5, and E7 based on the last two characters in their unique radio addresses. Additionally, we track the change in voltage of all three drones while recharging on a wireless recharging pad from low voltage (3.2 volts) to full voltage (greater than 4.15 volts). We consider a number of operational parameters (wind speeds, wind directions, skyway segments, initial voltage) to fly each drone.

% Data collection is done using Crazyflie Python API, which logs data every 100 ms on timestamps, current 3D coordinate estimates, roll, pitch, yaw, and battery voltage.


% \begin{figure}[ht]
% \centering
% \includegraphics[width=0.9\linewidth]{Figures/network copy.jpg}
% \vspace{-0.4 cm}
% \caption{A Skyway Network with No-fly Zones}
% \label{motivitaing}
% \vspace{-0.6 cm}
% \end{figure}

\subsection{Varying Number of Recharging Stations}
\label{path composition}
This section describes three drones operating simultaneously in a skyway network with a single and two stations.
% (\ref{flightpath1}). We also record the effects of wind on drone battery consumption under different wind conditions.
\subsection{Single Recharging Station}
In the case of a single recharging station, each drone starts from a unique source node, flies to an intermediate recharging station, and finally moves to a unique destination node (Fig. \ref{flightpath1}). Fig. \ref{flightpath1} shows the flight paths with 1 intermediate recharging station, with the cluster at (0.6, 0.3) as the intermediate recharging node. The drones fly to the intermediate recharging node in order of closest to farthest from the intermediate node. The order of the drones is decided autonomously during the experiment, using the drone's coordinates to calculate their distance from the intermediate node. Upon arriving at the intermediate node, a drone recharges until reaching a threshold of 4.15 volts. After recharging, the next drone flies to the intermediate node, while the first drone flies to its destination node. We conduct this experiment with five path sets (a total of 5 paths for each drone, 15 paths in total). Each path is tested under different wind conditions of no wind, 6.1 km/h wind, and 7.6 km/h wind. Each test is conducted under three different wind directions based on the fan's location, including North, South, and East winds relative to the City's 3D model. 
% (should we include a diagram showing the fan's location relative to the 3D model?)

\begin{figure}[t]
\centering
  \includegraphics[width=0.8\linewidth, height= 5.5cm]{Figures/xy2intermediate.png}
\caption{Two Stations Flight Path}
\label{flightpath2}
\vspace{-0.4 cm}
\end{figure}

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/Coordinates.png}
% \vspace{-0.4 cm}
% \caption{Drone Flight Path with 1 recharging Node}
% \label{flightpath1}
% \end{figure}

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/xy2intermediate.png}
% \vspace{-0.4 cm}
% \caption{Drone Flight Path with 2 recharging Node}
% \label{flightpath2}
% \end{figure}

\begin{figure*}[t]
  \centering
  \begin{subfigure}[t]{0.5\linewidth}
    \includegraphics[width=\linewidth]{Figures/fig6,1.png}
  \vspace{-0.4cm}
   \caption{}\label{rectangle-diagram}
  \end{subfigure}\hfill
  \begin{subfigure}[t]{0.5\linewidth}
    \includegraphics[width=\linewidth]{Figures/fig6,2.png}
  \vspace{-0.4cm}
   \caption{}\label{triangle-diagram}
  \end{subfigure}
  \begin{subfigure}[t]{0.5\linewidth}
    \includegraphics[width=\linewidth]{Figures/fig6,3.png}
  \vspace{-0.4cm}
    \caption{}\label{line-diagram}
  \end{subfigure}
  \caption{Wind Speed and Direction Impact on Voltage Consumption}
  \label{fig:voltage}
  \vspace{-0.4cm}
\end{figure*}

\subsection{Two Recharging Stations}

In the case of two recharging stations, a drone progresses to one of the two intermediate recharging nodes and travels to its final destination node after recharging (Fig. \ref{flightpath2}). Fig. \ref{flightpath2} shows the flight paths with 2 intermediate recharging nodes with the clusters at (0.0, 0.5) and (0.7, 0.4) representing the two intermediate recharging nodes. We record the effects of wind on drone battery consumption. As there are two intermediate recharging nodes (A and B), the drone closest to intermediate recharging node A flies to A, and the drone closest to intermediate recharging node B flies to B. The intermediate recharging node allocated to each drone, and the order in which the drones fly, are decided autonomously at run time. This decision is made using our nearest first algorithm, which calculates the distances of each drone from the intermediate nodes and sends real-time instructions to the drones for the next node. When the first drone reaches a voltage of 4.15, it progresses to its destination node. This progression triggers the third drone to fly to the next available recharging station. We conduct this experiment with five similar path sets similar to the single recharging station. Each path has unique start, intermediate, and destination nodes for each drone. We use similar wind conditions and wind directions to test each path. We observe certain deviations from a straight line path due to occasional delays in calibrating the drone's positioning system.

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/ChargingCurve.png}
% \vspace{-0.4 cm}
% \caption{Voltage Over Time While recharging with Wireless Charger}
% \label{voltageCharging}
% \end{figure}

% \subsection{Data}
% We performed a total of 70 flights from which 35 flights are conducted with a single intermediate recharging node (Fig. \ref{flightpath1}) and 35 with 2 intermediate recharging nodes (Fig. \ref{flightpath2}). We consider a number of operational parameters (wind speeds, wind directions, skyway segments, initial voltage) to fly each drone. The data collected from the experiments is recorded in CSV files which are organized by number of recharging nodes, path, wind speeds, wind direction, and drone. The drones are labeled as E3, E5 and E7 based on last two characters in their unique radio addresses. 
% Additionally, we record the changing voltage for each drone over time.
% as it charged on a wireless recharging pad to plot the wireless recharging curve of the drone. 

% \begin{figure*}[!ht]
% \includegraphics[width=0.9\linewidth]{Figures/3by2.png}
% \vspace{-0.4 cm}
% \caption{Voltage Fluctuations Relative to Wind Direction and Speed}
% \label{voltageFluctuations}
% \end{figure*}


\section{Results}

Fig. \ref{fig:voltage} shows the voltage over time during the drone flight from one node to another. Each plot shows the same skyway segment traversed by a drone under three different wind conditions: no wind, 6.1 km/h wind, and 7.6 km/h wind. The overall contour of voltage for each segment is similar within each plot. However, the segments under \textit{windy conditions} show a more \textit{irregular contour}. This irregularity could be due to the wind effects that require a drone to consume extra power to stay on the correct path.
%It could also be from the wind destabilizing the drone, requiring the drone to need an extra battery to remain level.
This extra power drain and the added turbulence to the drone with no wind tend to start at a higher voltage on average and maintain a higher voltage throughout the segment.
%This is most likely due to drones requiring more energy to maintain their position under windy conditions.
The variations are also due to the different relative wind directions \cite{shahzaad2022drone}. For example, a drone flying into the \textit{headwind} requires more power than a drone flying in the same direction as the wind (i.e., \textit{tailwind}) \cite{lee2022autonomous}. Therefore, we observe that wind 2 consumes more voltage compared to wind 1 in Fig. \ref{rectangle-diagram} and wind 1 consumes more voltage than wind 2 in Figs \ref{triangle-diagram} and \ref{line-diagram}. This increase in voltage consumption is due to the change in wind direction that affects the lifting force of the drone.
% Therefore, we consider these flight parameters for service-based trajectory planning of drones.

% Figure \ref{voltageCharging} shows the recharging curve of the drones on a wireless charger over time. The Crazyflie drones utilise a Qi recharging deck for wireless recharging.  

% Figure \ref{chargingPlot1} and  Figure \ref{chargingPlot2} show how initial voltage affects the total duration each charger spent recharging during the whole flight. Figure  \ref{chargingPlot1} shows this comparison for flights with 1 charger as an intermediate node, while Figure \ref{chargingPlot2} shows the same comparison for flights with 2 chargers as 2 intermediate nodes. The plots appear to follow a negative exponential curve. This is congruent to our observations while conducting tests that tests where the drones were above 4.10 volts were more efficient in completing their journeys. Tests where drones initial voltage were below 4.10 would take markedly longer to reach their destination. This is because each drone took longer to charge, resulting in all other drones losing battery while on standby, therefore making each drone start from a lower initial voltage upon reaching the recharging station. It is for this reason we believe it is important for the Crazyflie drones to have a minimum initial voltage of 4.10, and that frequent recharging increases the efficiency of flights in which there is a shared recharging node.

% There is a lower bound of recharging duration for each flight in both  figures. This is because during the experiment we set a minimum waiting duration at a recharging node of 5 seconds for safety purposes. 

% \begin{figure}[ht]
% \vspace{-0.4 cm}
% \includegraphics[width=0.9\linewidth]{Figures/1inter.png}
% \vspace{-0.4 cm}
% \caption{Total recharging Time Relative to Initial Voltage with 1 Intermediate Node}
% \label{chargingPlot1}
% \end{figure}

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/2inter.png}
% \vspace{-0.4 cm}
% \caption{Total recharging Time Relative to Initial Voltage with 2 Intermediate Node}
% \label{chargingPlot2}
% \end{figure}

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/VoltageOverTime.png}
% \vspace{-0.4 cm}
% \caption{Voltage Over Time with 1 Intermediate recharging Node}
% \label{voltageTime1}
% \end{figure}

% \begin{figure}[ht]
% \includegraphics[width=0.9\linewidth]{Figures/2chargingnodes.png}
% \vspace{-0.4 cm}
% \caption{Voltage Over Time with 2 Intermediate recharging Node}
% \label{voltageTime2}
% \end{figure}

% Figure \ref{voltageTime1} shows the changing voltage over time for all three drones during a single test with 1 intermediate recharging node. When the drones are flying their voltage drops to the range of approximately 3.2 to 3.9 as energy is being consumed. When the drones land their voltage increases to a range of approximately 3.9 to 4.2. Through this graph it can be shown the overall decreasing voltage during a drones flight, and steady increase upon landing at a recharging station. As shown in the graph, E7 is the first to fly, landing at the recharging station. Upon reaching the 4.15 threshold it leaves the recharging station, triggering drone E3 to fly to the recharging station. Drone E3 recharges up until its voltage is 4.15, triggering it to travel to its final destination, and drone E5 traveling to the recharging station. Once E5 has charged to 4.15 volts, it travels to its final destination and the test is complete. The drones did not start at the exact same voltage due to the variability in voltage measurements. A similar graph has been provided in Figure \ref{voltageTime2}, showing the voltage over time for a test conducted with 2 intermediate recharging nodes. 

% Figure \ref{voltageFluctuations} shows the voltage over time during which the drone was flying from one node to another node. Each plot shows the same skyway segment traversed by a drone under three different wind conditions of no wind, wind speed of approximately 6.1km/ph, and 7.6km/ph. As shown by the graphs, the overall contour of voltage for each segment is similar within each plot, however the segments flown under windy conditions show a more erratic contour. This could be due to the wind the drone in an opposing direction causing the drone to require extra battery to stay on the correct path. It could also be from the wind destabilising the drone, requiring the drone to need extra battery to remain level. This extra battery drain, as well as the added turbulence to the drone  with no wind tend to start at a higher voltage on average and maintain a higher voltage throughout the segment. This is most likely due to drones requiring more energy to maintain their position under windy conditions. The variation between the graphs is also due to the differing relative wind directions, as a drone flying into wind (headwind) would require more power than a drone flying in the same direction as the wind (tailwind). 

% % In the first figure, it looks like the higher the initial voltage is the less difference there is in total recharging time. In the second figure, those differences in gradients between different initial voltage does not really emerge until the voltage is around 4.09 or above

\section {Demonstration Requirements}
This demonstration will present service-based trajectory planning in multi-drone skyway networks. The Crazyflie drones will use the HTC Vive base stations to locate themselves in an indoor drone testbed. The drones will be recharged using wireless pads to serve long-distance service delivery. We will show a pre-recorded video of this demonstration during the conference, which is available at \url{https://youtu.be/zEwqdtEmmiw}. The indoor drone testbed is very large in size and features a safety net for drones, as shown in the video. Therefore, we plan to do a live stream for the demonstration with one of our authors from our drone lab. We will use our laptops for this live stream. However, it will require a standard booth setup at the conference venue. A screen projector is preferable to help in presenting a better live stream.



\section*{Acknowledgment}

This research was partly made possible by LE220100078 grant from the Australian Research Council. The statements made herein are solely the responsibility of the authors.

\bibliographystyle{IEEEtran}  
\bibliography{percom} 

\end{document}
