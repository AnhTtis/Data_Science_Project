\documentclass[10pt,twocolumn,letterpaper]{article}

%%%%%%%%% PAPER TYPE  - PLEASE UPDATE FOR FINAL VERSION
\usepackage[pagenumbers]{cvpr} % To force page numbers, e.g. for an arXiv version

% Include other packages here, before hyperref.
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{xspace}
\usepackage{nicematrix}

\usepackage[pagebackref,breaklinks,colorlinks]{hyperref}


% Support for easy cross-referencing
\usepackage[capitalize]{cleveref}
\crefname{section}{Sec.}{Secs.}
\Crefname{section}{Section}{Sections}
\Crefname{table}{Table}{Tables}
\crefname{table}{Tab.}{Tabs.}

\usepackage{sg-macros}
\newcommand{\dataset}{IAW\xspace}

%%%%%%%%% RESET LABEL NUMBER
\setcounter{figure}{6}
\setcounter{table}{2}
\setcounter{equation}{14}

\begin{document}

%%%%%%%%% TITLE
\title{Aligning Step-by-Step Instructional Diagrams to Video Demonstrations Supplementary Material}

\author{
Jiahao Zhang$^{1,}$\thanks{Supported by an ANU-MERL PhD scholarship agreement.}\quad
Anoop Cherian$^{2}$\quad
Yanbin Liu$^{1}$\\
Yizhak Ben-Shabat$^{1,3,}$\thanks{Supported by Marie Sklodowska-Curie grant agreement No.~893465.}\quad
Cristian Rodriguez$^{4}$\quad
Stephen Gould$^{1,}$\thanks{Supported by an ARC Future Fellowship No.~FT200100421.}\\
$^1$The Australian National University,
$^2$Mitsubishi Electric Research Labs\\
$^3$Technion Israel Institute of Technology,
$^4$The Australian Institute for Machine Learning\\
{\tt\small $^1$\{first.last\}@anu.edu.au}
{\tt\small $^2$cherian@merl.com}
{\tt\small $^3$sitzikbs@gmail.com}
{\tt\small $^4$crodriguezop@gmail.com}\\
{\tt\small \href{https://davidzhang73.github.io/en/publication/zhang-cvpr-2023/}{https://davidzhang73.github.io/en/publication/zhang-cvpr-2023/}}
}

\maketitle

\appendix

\section{IAW Dataset Statistics}

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.85\linewidth]{img/relation.pdf}
    \caption{Entity Relationship (ER) Diagram of entities defined for the IAW dataset.}
    \label{fig:er}
\end{figure}

We defined several entities to describe the hierarchical structure of Ikea Assembly in the Wild (IAW) dataset as demonstrated in~\cref{fig:er}.
In terms of the instructional assembly manuals, we have categories, furniture, manuals, pages and steps.
As for videos, there are videos, actions, video segments (10s) and clips (64 frames 2.133s).
A matching is made between a step in the manual and an action from the video, which is a one-to-one relation.
The relation between step and page is many (0..n)-to-one, because a page may contain other information instead of an instructional diagram.
Besides the above two, the rest are all many (1..n)-to-one relation.
It is worth noting that one piece of furniture may correspond to multiple manuals, and we concatenate the manuals according to the assembly order.

In terms of the data collection, we first crawled all manuals under the category \textit{Furniture} from Ikea official website.
We manually found all related assembly videos from YouTube, split the PDF manual into pages and cropped out every individual step diagram. 
With the above information, we out-sourced video to diagram alignment tasks to Amazon Mechanical Turker platform.
The alignments were then audited and refined carefully.
Final statistics are shown in \cref{tbl:manual} and \cref{tbl:video}.

\begin{table}[ht]
    \setlength\extrarowheight{0.5pt}
    \caption{Statistics of assembly manuals categorized by each furniture category.}
    \resizebox{\linewidth}{!}{
        \begin{tabular}{ l c c c c c }
            \toprule
            Category
            & \#furniture
            & \#manuals
            & \#pages
            & \#steps
            \\\midrule
            Beds
            & 33
            & 37
            & 769
            & 823
            \\
            Bookcases \& shelving units
            & 55
            & 61
            & 961
            & 1152
            \\
            Cabinets \& cupboards
            & 28
            & 36
            & 851
            & 920
            \\
            Chairs
            & 74
            & 77
            & 632
            & 884
            \\
            Chests of drawers \& drawer units
            & 35
            & 50
            & 1288
            & 1194
            \\
            Children's furniture
            & 5
            & 5
            & 80
            & 84
            \\
            Furniture sets
            & 2
            & 2
            & 11
            & 20
            \\
            Gaming furniture
            & 1
            & 1
            & 32
            & 24
            \\
            Outdoor furniture
            & 11
            & 11
            & 79
            & 88
            \\
            Sofas
            & 28
            & 31
            & 500
            & 540
            \\
            TV \& media furniture
            & 11
            & 11
            & 321
            & 300
            \\
            Tables \& desks
            & 117
            & 119
            & 2129
            & 1947
            \\
            Trolleys
            & 3
            & 3
            & 48
            & 40
            \\
            Wardrobes
            & 17
            & 17
            & 562
            & 552
            \\\midrule
            Total
            & 420
            & 461
            & 8263
            & 8568
            \\
            Per Category Median
            & 22.5
            & 24.0
            & 531.0
            & 546.0
            \\
            Per Category Average
            & 30.0
            & 32.9
            & 590.2
            & 612.0
            \\\bottomrule
        \end{tabular}
    }
    \label{tbl:manual}
\end{table}

\begin{table}[ht]
    \setlength\extrarowheight{2pt}
    \caption{Statistics of assembly videos categorized by each furniture category. Annotated duration denotes the total duration of video segments that have labels.}
    \resizebox{\linewidth}{!}{
        \begin{tabular}{ m{20ex} c c c c c }
            \toprule
            Category
            & \#videos
            & \#actions
            & Duration
            & Annotated Duration
            \\\midrule
            Beds
            & 86
            & 1554
            & 16h:43m:00s
            & 10h:50m:59s
            \\
            Bookcases \& shelving units
            & 128
            & 1636
            & 21h:23m:55s
            & 12h:42m:08s
            \\
            Cabinets \& cupboards
            & 49
            & 1082
            & 11h:29m:12s
            & 07h:12m:38s
            \\
            Chairs
            & 185
            & 1478
            & 21h:22m:27s
            & 11h:44m:13s
            \\
            Chests of drawers \& drawer units
            & 113
            & 2891
            & 30h:51m:36s
            & 20h:40m:37s
            \\
            Children's furniture
            & 7
            & 52
            & 01h:14m:37s
            & 00h:32m:27s
            \\
            Furniture sets
            & 3
            & 15
            & 00h:17m:19s
            & 00h:02m:36s
            \\
            Gaming furniture
            & 1
            & 31
            & 00h:00m:56s
            & 00h:00m:42s
            \\
            Outdoor furniture
            & 11
            & 72
            & 01h:25m:08s
            & 00h:37m:57s
            \\
            Sofas
            & 83
            & 1285
            & 15h:08m:20s
            & 08h:44m:44s
            \\
            TV \& media furniture
            & 36
            & 749
            & 07h:41m:47s
            & 05h:31m:39s
            \\
            Tables \& desks
            & 266
            & 3947
            & 47h:07m:37s
            & 29h:26m:20s
            \\
            Trolleys
            & 8
            & 79
            & 00h:51m:59s
            & 00h:34m:14s
            \\
            Wardrobes
            & 31
            & 812
            & 07h:29m:12s
            & 05h:02m:30s
            \\\midrule
            Total
            & 1007
            & 15683
            & 183h:07m:05s
            & 113h:43m:48s
            \\
            Per Category Median
            & 42.5
            & 947.0
            & 09h:35m:29s
            & 06h:22m:08s
            \\
            Per Category Average
            & 71.9
            & 1120.2
            & 13h:04m:47s
            & 08h:07m:24s
            \\\bottomrule
        \end{tabular}
    }
    \label{tbl:video}
\end{table}

The distributions of video duration and the number of actions per video are shown in the boxplot below~(\cref{fig:boxplot}).

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{img/video_boxplot.pdf}
    \caption{Distribution of video duration and the number of actions per video. Video duration: (max: 4763, min: 40, mean: 655, median: 520); Number of actions: (max: 63, min: 1, mean: 16, median: 12)}
    \label{fig:boxplot}
\end{figure}

\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.49\linewidth}
        \includegraphics[width=\linewidth]{img/video_people_count_pie.pdf}
        \caption{How many people are involved during assembling.}
        \label{fig:video_people_count}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
        \includegraphics[width=\linewidth]{img/video_person_view_pie.pdf}
        \caption{Is it first-person view, third-person view or both occurred.}
        \label{fig:video_person_view}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
        \includegraphics[width=\linewidth]{img/video_is_fixed_pie.pdf}
        \caption{Is the camera fixed, not-fixed or both occurred.}
        \label{fig:video_is_fixed}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
        \includegraphics[width=\linewidth]{img/video_is_indoor_pie.pdf}
        \caption{Is the assembly happened indoor or outdoor.}
        \label{fig:video_is_indoor}
    \end{subfigure}
    \caption{Proportion of the four attributes.}
    \label{fig:video_collect}
\end{figure}

As shown in~\cref{fig:video_collect}, we manually attached four attributes for each video.
When splitting the IAW dataset into train, validation and test splits, a greedy algorithm is used to balance the distribution in each split w.r.t. four attributes as shown in~\cref{fig:split}.
Concretely, the greedy algorithm traverses each furniture. If a furniture contains only one video, then the video is added to train split; if two videos, then one for train and one for test; if more than two videos, one for test, one for validation and put all the rest into the train split. 
We try every possible assignments of videos in this situation, and select the one that minimises the distribution difference between the split and the entire dataset. 
In this way, we can ensure that there is no shared video between train and validation or test split and all manuals are fed to the model during training. 
The final split statistics are shown in the~\cref{tbl:split}.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.95\linewidth]{img/attribute.pdf}
    \caption{Balanced distribution of four attributes in each split comparing with the entire dataset (all).}
    \label{fig:split}
\end{figure}

\begin{table}[t]
    \centering
    \small
    \begin{tabular}{ l c c c c }
        \toprule
        & Train
        & Validation
        & Test
        \\\midrule
        \#furniture
        & 420
        & 138
        & 226
        \\
        \#videos
        & 643
        & 138
        & 226
        \\
        \#actions
        & 9925
        & 2221
        & 3537
        \\
        \#video segments
        & 30876
        & 6871
        & 11103
        \\
        \bottomrule
    \end{tabular}
    \caption{Split Statistics.}
    \label{tbl:split}
\end{table}

\textbf{We will release the dataset including video URLs and full annotations on publication of this paper.} 
In addition, we will also make public the tool we used for annotating and the supporting infrastructures we developed for Amazon Mechanical Turker. 


\section{Experimental Results}

In this section, we provide more experimental results both quantitatively and qualitatively to demonstrate the effectiveness of our method. 

\subsection{Quantitative Results}

\input{tbl/sprf}

\input{tbl/bs}

\input{tbl/losses_ot}

\textbf{Sinusoidal Progress Rate Feature (SPRF).} 
Firstly, we conducted ablation experiments on Positional Embedding (PE) proposed by~\cite{radford2021learning}. 
The original PE is used to represent the order information for words in a sentence of arbitrary length.
In our task, we need to align two different progress rates with different scales, so we manually set length for PE to be 100, and sample positional embeddings from it.
We tried to replace the proposed SPRF with either adding (denoted as ``PE Add'') the positional embedding or concatenating (denoted as ``PE Concat'') to the feature. 
As shown in the~\cref{tbl:sprf}, both variants of position embedding are inferior to our baseline. 
Secondly, we tried to modify the overall architecture so that the SPRF locates after the final linear layer and before the loss (denoted as ``SPRF After''), to make the progress rate information applied directly on the contrastive loss.
This modification, however, failed to outperform the proposed architecture. 
We conjecture that it is because the vision and progress rate features can be better fused through a fully connected layer. 
Besides that, we removed sinusoidal transform (denoted as ``PRF'') and also found the performance dropped. 
Converting progress rate feature into sinusoidal space is intuitive because we are using cosine similarity for distance calculation. 

\begin{figure}[t]
    \centering
    \includegraphics[width=\linewidth]{img/duplications.pdf}
    \caption{Duplication statistics in a batch w.r.t different batch sizes.}
    \label{fig:duplications}
\end{figure}

\textbf{Batch Size.} Batch size is important for contrastive learning, since the larger batch size leads to more negative samples, hence the stronger supervision signal. 
However, in this task, it failed to increase performance when we enlarge the batch size.
We suspect it is due to the fact that there are semantic collisions or duplications (\cref{fig:duplications}) because there are multiple segments for each action. 
As shown in our ablation study~(\cref{tbl:bs}), all the metrics of both CLIP and A3 drops as batch size increases. 
But A3 has a relatively slower rate of decline compared with CLIP.
Due to the GPU memory constraints, we didn't report results for batch size $>$256.

\textbf{Post Process.} 
We use optimal transport for post-process and the results in \cref{tbl:losses_ot} show that OT improves performance for most cases. 
In particular, for the loss combination D1, it outperforms the one without OT (Tab. 2 in the main paper) by almost 3\%. 
And it is worth noting that compared with B3, Loss C plays a positive role in terms of the performance. 

\subsection{Qualitative Results}

In this section, we show sixteen selected examples: eight for successful alignments and another eight for failure cases. 

Moreover, three video examples are attached in the zip file demonstrating the result of our work. We encourage readers to watch the attached videos for a better understanding of our method and dataset. 

\begin{figure*}[ht]
    \centering
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/00339416_36T-ytb8EhM_1_4_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=36T-ytb8EhM}{36T-ytb8EhM} and an Ikea furniture manual \href{https://www.ikea.com/au/en/search/products/?q=00339416}{00339416}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/00352573_aPJF36W93wE_30_21_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=aPJF36W93wE}{aPJF36W93wE} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/byas-tv-bench-high-gloss-white-00352573/}{00352573}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/10351568_Lji-ZnRLPBQ_1_4_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=Lji-ZnRLPBQ}{Lji-ZnRLPBQ} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/billy-bookcase-white-10351568/}{10351568}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/10355415_n7ZlhsVKnuY_0_7_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=n7ZlhsVKnuY}{n7ZlhsVKnuY} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/brimnes-chest-of-3-drawers-white-frosted-glass-10355415/}{10355415}.}
    \end{subfigure}
    \caption{Eight success examples (4/8).}
    \label{fig:examples1}
\end{figure*}

\setcounter{figure}{5}

\begin{figure*}[ht]
    \centering
    \begin{subfigure}{0.86\linewidth}
        \addtocounter{subfigure}{4}
        \includegraphics[width=\linewidth]{img/20351879_G3LS_4PRlEs_1_4_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=G3LS_4PRlEs}{G3LS\_4PRlEs} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/kallax-insert-with-2-drawers-white-20351879/}{20351879}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/30353566_mr92aJSM2hM_9_14_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=mr92aJSM2hM}{mr92aJSM2hM} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/lack-tv-bench-black-30353566/}{30353566}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/40351883_jthbbffqPlg_3_6_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=jthbbffqPlg}{jthbbffqPlg} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/kallax-shelving-unit-white-40351883/}{40351883}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/50355687_uZ7zGH4Y-sM_16_17_0_True_True.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=n7ZlhsVKnuY}{n7ZlhsVKnuY} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/hemnes-chest-of-2-drawers-white-stain-50355687/}{50355687}.}
    \end{subfigure}
    \caption{Eight success examples (8/8).}
    \label{fig:examples2}
\end{figure*}

\begin{figure*}[ht]
    \centering
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/s79282252_TWVmJ3f1U8A_5_7_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=TWVmJ3f1U8A}{TWVmJ3f1U8A} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/bekant-desk-sit-stand-white-stained-oak-veneer-white-s79282252/}{s79282252}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/s69424469_CM-n5RaTtOw_7_11_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=CM-n5RaTtOw}{CM-n5RaTtOw} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/flintan-office-chair-with-armrests-black-s69424469/}{s69424469}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/s09009572_u-2oTXnp48c_5_6_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=u-2oTXnp48c}{u-2oTXnp48c} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/tarva-bed-frame-pine-luroey-s09009572/}{s09009572}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/s19395841_NXNxUE6XsF4_9_8_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=NXNxUE6XsF4}{NXNxUE6XsF4} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/poaeng-rocking-chair-white-stained-oak-veneer-skiftebo-dark-grey-s19395841/}{s19395841}.}
    \end{subfigure}
    \caption{Eight failure cases (4/8).}
    \label{fig:examples3}
\end{figure*}

\setcounter{figure}{6}

\begin{figure*}[ht]
    \centering
    \begin{subfigure}{0.86\linewidth}
        \addtocounter{subfigure}{4}
        \includegraphics[width=\linewidth]{img/90365793_IUI8AQYTB0k_7_8_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=IUI8AQYTB0k}{IUI8AQYTB0k} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/norberg-wall-mounted-drop-leaf-table-white-90365793/}{90365793}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/80458759_hFA07VckvOk_6_10_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=hFA07VckvOk}{hFA07VckvOk} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/grimsbu-bed-frame-grey-80458759/}{80458759}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/80494540_DSD9jawiz7o_11_12_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=DSD9jawiz7o}{DSD9jawiz7o} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/jaervfjaellet-office-chair-with-armrests-glose-black-80494540/}{80494540}.}
    \end{subfigure}
    \begin{subfigure}{0.86\linewidth}
        \includegraphics[width=\linewidth]{img/60409939_T6sQN6FtaDQ_7_10_0_False_False.png}
        \caption{Alignment between a clip from YouTube video \href{https://www.youtube.com/watch?v=T6sQN6FtaDQ}{T6sQN6FtaDQ} and an Ikea furniture manual \href{https://www.ikea.com/au/en/p/kallax-shelving-unit-white-60409939/}{60409939}.}
    \end{subfigure}
    \caption{Eight failure cases (8/8).} 
    \label{fig:examples4}
\end{figure*}

% \section{Limitations}

%%%%%%%%% REFERENCES
{\small
\bibliographystyle{ieee_fullname}
\bibliography{supplementary}
}

\end{document}
