\vspace{-1em}
\paragraph{Construction of Probability Density Function.}
Due to aiming at building arbitrary surfaces, we first introduce the difference between rendering watertight and open surfaces. 
The first difference is the rendering of back-faces. The state-of-the-art watertight surface reconstruction approaches~\cite{wang2021neus,dvr, yariv2020idr} only render the front faces of the surface and ignores the back faces. 
% In volume rendering~\cite{wang2021neus}, the 3D query points with surface normals pointing toward the ray direction share zero-weights; in surface rendering~\cite{dvr, yariv2020idr}, the renderer only triggers the rendering when the ray enters the surface from outside to inside. 
Such a scheme would fail for open surfaces: as shown in Figure~\ref{fig:render_bothsides} (L), the back camera receives an empty rendering of the open surface. While, we render each surface point with ray intersections, as shown in Figure~\ref{fig:render_bothsides} (R).

\input{Figure/render_bothside/render_bothsides}


% The ignorance is safe as the surfaces have already been rendered when the ray entered the surface from outside to inside.
%\weikai{This sentence is very confusing.}

% \brandon{The logic is not reasonable between this and the above paragraph. In above, we talk about rendering both sides; it is about intersections but has nothing related with SDF. More smooth transition needed here.} 
The second difference is the definition of ``inside" and ``outside", which do not exist for non-watertight surfaces. Therefore, we leverage the local surface normal to determine the sign of the distance as in 3PSDF~\cite{chen_2022_3psdf}. For a local region around a surface, we use positive normal direction as pseudo ``outside" with positive-signed distance, and vice versa. 
% \xiaoxu{For points outside the local region around any surface,  
% the SDF still form a continuous field. The SDF of these points will not be rendered in the training stage and will not be exported in the testing stage because of low validity probability.}.
% \weikai{This paragraph is very difficult to understand. We should write from a higher level -- as pointed out by Brandon: SDF only need to render outside surface while open surface needs to render both sides. Use some figures to help explain.}

% A ray can directly exit the surface from the “pseudo” inside to the “pseudo” outside without entering the “pseudo” inside. In order to render all the surfaces, we render each valid surface point if the ray enters the surface from the “pseudo” outside to the “pseudo” inside, and render each valid surface point if the ray exits the surface from the “pseudo” inside to the “pseudo” outside. 
%\brandon{This paragraph is confusing. I think we should explain in such order: 1) We use SDF for open surface; 2) give definitions of "pseudo" inside/outside; 3) explain that in some views, only "pseudo" inside of open surfaces are visible; 4) therefore, we cannot ignore pseudo inside points.} \xiaoxu{Revised}

We expect that the rendering behaves the same when the ray crosses a surface from either direction. 
The state-of-the-art volume rendering work, NeuS~\cite{wang2021neus}, uses logistic density distribution $\phi_{s}(f(\textbf{p}))$, also known as the derivative of the sigmoid mapping function
${\Phi}_\mathbf{s}\left(f(\textbf{p})\right)$, as the probability density function. 
However, it is not applicable in our scenario -- for surfaces with opposite normal directions, $\Phi_{s}\left(f(\textbf{p})\right)$ will lead to different density values as $\Phi_{s}\left(f(\textbf{p})\right)\neq\Phi_{s}\left(-f(\textbf{p})\right)$.
%However, ${\Phi}_\mathbf{s}\left(f(\textbf{p})\right)$ does not meet our requirement: since $\Phi_{s}\left(f(\textbf{p})\right)\neq\Phi_{s}\left(-f(\textbf{p})\right)$, for surfaces with different normal directions, $\Phi_{s}\left(x\right)$ will lead to different density values.

%\brandon{I revised this part, but I feel use $f(p)$ may be better than x, as later equations use $f(p)$. Use different notations for SDF definition may lead to confusion.}\xiaoxu{Revised}

{
We therefore modify the SDF value by flipping its sign in the regions where the SDF value increases along the camera ray. The probability density function is defined as
\begin{equation}
\sigma(\pt) = \phi_{s}(-Sign(\mathbf{v}\cdot\mathbf{n})f(\pt)),
\vspace{-0.5em}
\end{equation}
}
% We therefore introduce a sign adjustment function
% \vspace{-0.5em}
% \begin{equation}
% \gamma(\pt)\ =\ -Sign(cos(\mathbf{v},\mathbf{n})) \in \{-1, 1\}
% \vspace{-0.5em}
% \end{equation}

\noindent where $\mathbf{v}$ is the unit direction vector of the ray and $\mathbf{n}$ is the gradient of the signed distance function. Such definition assures the same rendering behaviors when ray enters the surface from either direction. 

% For any query points $\pt_1$, $\pt_2$ with opposite normals directions and $f\left(\pt_1\right)=-f\left(\pt_2\right)$, we have
% \vspace{-0.5em}
% \begin{equation}
% \left\{
% \begin{array}{lr}
%     \Phi_{s}\left(f(\pt_{1})\cdot\gamma(\pt_{1})\right)
%     =
%     \Phi_{s}\left(f(\pt_{2})\cdot\gamma(\pt_{2}))\right)\\
%     \phi_{s}\left(f(\pt_{1})\cdot\gamma(\pt_{1}))\right)
%     =
%     \phi_{s}\left(f(\pt_{2})\cdot\gamma(\pt_{2}))\right)
% \end{array}
% \right.
% \label{equ:equal_with_gamma}
% \vspace{-0.5em}
% \end{equation}

% Such definition assures the same rendering behaviors when ray enters the surface from either direction. Then our probability density function is defined as $\phi_{s}\left(f(\pt)\cdot\gamma(\pt)\right)$.

% \weikai{We should explain what does the $Sign(.)$ function return. Based on the explanation below, $\gamma(\pt)$ simply returns the opposite sign of the dot product between $\mathbf{V}$ and $\mathbf{n}$?}

% When the ray enters the surface from the “pseudo” outside to the “pseudo” inside, we have $\gamma(\pt)=1$
% $$\mathbf{n}\cdot\mathbf{v}<0\Longrightarrow\gamma(\pt)=-Sign(cos(\mathbf{v}, \mathbf{n})) = 1.$$ 

% When the ray exits the surface from the “pseudo” inside to the “pseudo” outside, we have
% $$\mathbf{n}\cdot\mathbf{v}>0\Longrightarrow\gamma(\pt)=-Sign(cos(\mathbf{v}, \mathbf{n})) = -1.$$ 
% %\brandon{We need careful proof of the differentiable property. This issue was challenged before in CAS' paper.}

% For any query points $\pt_1$, $\pt_2$ with opposite normals directions and $f\left(\pt_1\right)=-f\left(\pt_2\right)$, we have
% \begin{equation}
% \left\{
% \begin{array}{lr}
%     \Phi_{s}\left(f(\pt_{1})\cdot\gamma(\pt_{1})\right)
%     =
%     \Phi_{s}\left(f(\pt_{2})\cdot\gamma(\pt_{2}))\right)\\
%     \phi_{s}\left(f(\pt_{1})\cdot\gamma(\pt_{1}))\right)
%     =
%     \phi_{s}\left(f(\pt_{2})\cdot\gamma(\pt_{2}))\right)
% \end{array}
% \right.
% \label{equ:equal_with_gamma}
% \end{equation}

% % \brandon{No definitions what $\Phi$ and $\phi$ mean.}
% Such definition assures the same rendering behaviors when ray enters the surface from the “pseudo” outside to the “pseudo” inside or the opposite. 

% Then we taking
% $\phi_{s}\left(f(\pt)\cdot\gamma(\pt)\right)$
% as the mapping function from the signed distance field to the probability density field.
%\weikai{The previous context is discussing about the sigmoid function itself. Why we use the derivative of the sigmoid function as the mapping function in the end? Also, the symbol $\Phi$ and $\phi$ are the same symbol just with different cases. Make sure we use two different symbols.}