\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb,amsfonts,amsthm,enumerate}
\usepackage{eucal}
\usepackage{xcolor}
\usepackage{lscape}
\usepackage{tikz}
\usepackage{environ}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usetikzlibrary{positioning, backgrounds}

\begin{document}

The next example shows how to apply the density based method applies in higher dimension. The key point is that the quadratic form must be well chosen.

Let $G$ be an $m\times m$ graph, represented by a symmetric adjacency matrix $J$ consisting of only zeros and ones. We will define a data set of size $N$ in $\mathbb{R}^m$ by taking $N$ random simulations of the Ising model associated to $E$, defined as follows: for every discrete vector $\sigma \in \{1,-1\}^m$, define the Hamiltonian energy by
\begin{equation}
\label{eq:isingham}
    H(\sigma)=-\sum_{i,j}
J_{i,j} \sigma_i \sigma_j
\end{equation}
We then fix a temperature parameter
$\beta>0$ and seek to approximate the 
Boltzmann distribution
\begin{equation}
    \label{eq:boltzmann}
P_{\beta}(\sigma)=\frac{1}{Z_{\beta}}
e^{-\beta H(\sigma)},\quad
Z_\beta = e^{-\beta H(\sigma)}.
\end{equation}

The data set is then produced by running the single-flip Metropolis algorithm for a large enough number of steps per site (we chose about 40000) to obtain a data set 
\[\mathcal{D}_{J,\beta,N}=
\{\sigma^1,...,\sigma^N\}
\subset \mathbb{R}^m,\] 
by interpretting the
spin states $\sigma$ as real vectors in
$\mathbb{R}^m$.
We generated $\mathcal{D}_{J,\beta,N}$ for three different graphs $J$ shown in Figure \ref{fig:isinggraphs}: an interval consisting of 30 sites, a circle with 30 sites, and a graph with three flares of length 14 each coming from the center, for a total of 43 vertices. For every one we chose $\beta=3.0$, and $N=20000$. 

\begin{figure}
\centering
 \input{tikz/ising/isinggraphs1}

 \centering
 \input{tikz/ising/isinggraphs2}
    \caption{Top row: three different graphs used to simulate the Ising model, namely an interval, a circle, and flares. Second row: A typical data point with $\pm 1$ represented by white and black, and the same point after diffusion, i.e. multiplication by
    $\exp(-tL)$ for $t=10$.}
    \label{fig:isinggraphs}
\end{figure}

We then blend using the Laplacian matrix.
An example of the result is shown in Figure %\ref{fig:isingblend}.
 %\input{tikz/ising/isinggraphs2}

\begin{figure}
    \centering
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingint1}
\end{subfigure}
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingcirc1}
\end{subfigure}
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingflares1}
\end{subfigure}

\centering
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingint2}
\end{subfigure}
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingcirc2}
\end{subfigure}
\begin{subfigure}[b]{.3\textwidth}
\input{tikz/ising/isingflares2}
\end{subfigure}
\end{figure}

\end{document}
