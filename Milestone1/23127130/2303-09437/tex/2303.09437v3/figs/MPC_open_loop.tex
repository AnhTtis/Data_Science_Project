\definecolor{myblue}{rgb}{0.20, 0.6, 0.78}
\definecolor{mygreen}{rgb}{0.2,0.8,0.2}
\definecolor{myred}{rgb}{0.5,0,0}
\definecolor{myorange}{rgb}{1,0.6,0.07}
\definecolor{mygrey}{rgb}{0.5,0.5,0.5}

 \begin{figure*}[htb!]
    \centering
    \begin{tikzpicture}
    \begin{groupplot}[
        legend columns=3,
        legend style={
    	font=\tiny},
        group style=
            {columns=4, horizontal sep=1.3cm}
        ]
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% ----------------------- 1
    \nextgroupplot[
    title style={yshift=-3.2cm},
    title=(a),
    xmin= 0, xmax = 38,
    ymin= 0, ymax = 12,
    enlargelimits=false,
    clip=true,
    grid=major,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    ylabel = {Outdoor temperature},
    xlabel={Time step $t$},
    ylabel style={at={(axis description cs:-0.05,0.5)}},
    xlabel style={at={(axis description cs:0.5,-0.1)}},
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]
    
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % \pgfplotstableread[col sep =comma]{data/model_compare_sp2.dat}{\datt}
    
    % outdoor temperature
    \addplot+ [thick,mark=*,mygreen,mark options={solid, mygreen, scale=1}] table [x={t}, y={w2}] {\dat}; 
        % \addplot+ [thick,mark=*, mark options={fill=white, scale=0.75,line width = 0.1pt},mygrey] table [x={t}, y={y_val}] {\dat}; 
    \addlegendentry{Outdoor temperature }

    % legend: Solar radiation 
    \addlegendimage{thick,mark=*,myorange,mark options={solid, myorange, scale=1}}
    \addlegendentry{Solar radiation } 
    
    %%% ----------------------- 2
    \nextgroupplot[
    title style={yshift=-3.2cm},
    title=(b),
    xmin= 0, xmax = 38,
    ymin= 15, ymax = 23,
    enlargelimits=false,
    clip=true,
    grid=major,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    ylabel = {Indoor temperature},
    xlabel={Time step $t$},
    ylabel style={at={(axis description cs:-0.05,0.5)}},
    xlabel style={at={(axis description cs:0.5,-0.1)}},
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Indoor temperature
    \addplot+ [thick,mark=*,myred,mark options={solid, myred, scale=1}] table [x={t}, y={y1}] {\dat}; 
    \addlegendentry{Indoor temperature}
    % legend: Solar input
    \addlegendimage{thick,mark=*,myblue,mark options={solid, myblue, scale=1}}
    \addlegendentry{Input}  
     % Reference
    \addplot+ [thick,mark=none,myred, dashed, mark options={solid, myred, scale=1}] table [x={t}, y={ref}] {\dat}; 
    \addlegendentry{Output reference}   
    % legend: u max
    \addlegendimage{thick,mark=none,mygreen, solid, mark options={solid, myblue, scale=1}}
    \addlegendentry{Maximal input}

    %%% ----------------------- 3
    \nextgroupplot[
    title style={yshift=-3.2cm},
    title=(c),
    xmin= 0, xmax = 38,
    ymin= 15, ymax = 23,
    enlargelimits=false,
    clip=true,
    grid=major,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    ylabel = {Indoor temperature},
    xlabel={Time step $t$},
    ylabel style={at={(axis description cs:-0.05,0.5)}},
    xlabel style={at={(axis description cs:0.5,-0.1)}},
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Indoor temperature
    \addplot+ [thick,mark=*,myred,mark options={solid, myred, scale=1}] table [x={t}, y={y2}] {\dat}; 
    \addlegendentry{Indoor temperature}
    % legend: Solar input
    \addlegendimage{thick,mark=*,myblue,mark options={solid, myblue, scale=1}}
    \addlegendentry{Input}  
     % Reference
    \addplot+ [thick,mark=none,myred, dashed, mark options={solid, myred, scale=1}] table [x={t}, y={ref}] {\dat}; 
    \addlegendentry{Output reference}   
    % legend: u max
    \addlegendimage{thick,mark=none,myblue, dashed, mark options={solid, myblue, scale=1}}
    \addlegendentry{Maximal input}

    %%% ----------------------- 4
    \nextgroupplot[
    title style={yshift=-3.2cm},
    title=(d),
    xmin= 0, xmax = 38,
    ymin= 15, ymax = 23,
    enlargelimits=false,
    clip=true,
    grid=major,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    ylabel = {Indoor temperature},
    xlabel={Time step $t$},
    ylabel style={at={(axis description cs:-0.05,0.5)}},
    xlabel style={at={(axis description cs:0.5,-0.1)}},
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Indoor temperature
    \addplot+ [thick,mark=*,myred,mark options={solid, myred, scale=1}] table [x={t}, y={y3}] {\dat}; 
    \addlegendentry{Indoor temperature}
    % legend: Solar input
    \addlegendimage{thick,mark=*,myblue,mark options={solid, myblue, scale=1}}
    \addlegendentry{Input}  
     % Reference
    \addplot+ [thick,mark=none,myred, dashed, mark options={solid, myred, scale=1}] table [x={t}, y={ref}] {\dat}; 
    \addlegendentry{Output reference}   
    % legend: u max
    \addlegendimage{thick,mark=none,myblue, dashed, mark options={solid, myblue, scale=1}}
    \addlegendentry{Maximal input}    


    
    \end{groupplot}
    
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 % right y axis
 %%% ----------------------- 1
    \begin{groupplot}[  
        legend columns=3,
        legend style={
    	font=\tiny},
        group style=
            {columns=4, horizontal sep=1.3cm}]
    \nextgroupplot[        
    axis y line*=right,
    axis x line=none,
    xmin= 0, xmax = 38,
    ymin= 0, ymax = 0.4,
    ylabel = {Solar radiation},
    ylabel style={at={(axis description cs:1.12,0.5)}},  
    enlargelimits=false,
    clip=true,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }  ]

    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    
    % Solar radiation 
    \addplot+ [thick,mark=*,myorange,mark options={solid, myorange, scale=1}] table [x={t}, y expr=\thisrow{w1}*0.001] {\dat};
        
    %%% ----------------------- 2
    \nextgroupplot[
    axis y line*=right,
    axis x line=none,
    xmin= 0, xmax = 38,
    ymin= 0, ymax = 16,   
    ylabel = {Input},
    ylabel style={at={(axis description cs:1.05,0.5)}},      
    enlargelimits=false,
    clip=true,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]  
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Input
    \addplot+ [thick,mark=*,myblue,mark options={solid, myblue, scale=1}] table [x={t}, y={u1}] {\dat};   
    % legend: u max
    \addplot+ [thick,mark=none,myblue,dashed,mark options={solid, myblue, scale=1}] table [x={t}, y expr= 6 ] {\dat};        
    
     %%% ----------------------- 3
    \nextgroupplot[
    axis y line*=right,
    axis x line=none,
    xmin= 0, xmax = 38,
    ymin= 0, ymax = 16,   
    ylabel = {Input},
    ylabel style={at={(axis description cs:1.05,0.5)}},      
    enlargelimits=false,
    clip=true,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]  
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Input
    \addplot+ [thick,mark=*,myblue,mark options={solid, myblue, scale=1}] table [x={t}, y={u2}] {\dat};   
    % legend: u max
    \addplot+ [thick,mark=none,myblue,dashed,mark options={solid, myblue, scale=1}] table [x={t}, y expr= 6 ] {\dat}; 

    %%% ----------------------- 4
    \nextgroupplot[
    axis y line*=right,
    axis x line=none,
    xmin= 0, xmax = 38,
    ymin= 0, ymax = 16,   
    ylabel = {Input},
    ylabel style={at={(axis description cs:1.05,0.5)}},      
    enlargelimits=false,
    clip=true,
    mark size=0.5pt,
    width=.25\linewidth,
    height=0.2\linewidth,
    legend columns=2,
    label style={font=\tiny}, %\tiny
    ticklabel style = {font=\tiny},
    legend style={
    	font=\tiny, %\tiny,
    	draw=none,
		at={(0.5,1.03)},
        anchor=south
    }    
    ]  
    \pgfplotstableread[col sep = comma]{figs/MPC_open_loop_1.dat}{\dat}
    % Input
    \addplot+ [thick,mark=*,myblue,mark options={solid, myblue, scale=1}] table [x={t}, y={u3}] {\dat};   
    % legend: u max
    \addplot+ [thick,mark=none,myblue,dashed,mark options={solid, myblue, scale=1}] table [x={t}, y expr= 6 ] {\dat}; 
    
    
    \end{groupplot}
    \end{tikzpicture}
    \caption{Open-loop solution of MPC. (a) Weather condition; (b) Prediction by filtered data; (c) Prediction by raw data without splitting; (b) Prediction by raw data with splitting} %$du_i := u_i - \hat{u}_i$
    \label{fig:MPC_open_loop}  
 \end{figure*}