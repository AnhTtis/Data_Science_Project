In this section, we show the performance evaluation of the communication paradigms under study. The parameters set for the simulations are given in Table~\ref{tab:params}\footnote{In the Table, $\nu$ is the speed of light}, if not otherwise specified.
The scenario is tested through Monte Carlo simulations.
With respect to the scenario described in Sect.~\ref{sec:model}, we consider that the \gls{bs} and \gls{ris} positions $\mb{x}_b$ and $\mb{x}_r=(0,0,0)\T$ are kept fixed, while the \gls{ue} position, $\mb{x}_u$, changes at every simulation according to a uniform distribution having limits $(-D/2, 0, 0)\T$ and $(D/2, D, -D)\T$. In this section, when referring to average performance, we implicitly assume averaging over different \gls{ue} positions and noise realizations.
The \gls{dc} channel coefficients are evaluated considering the \gls{los} component of $\mb{h}_d$ and $\mb{g}_d$ following the model of~\cite[Sect. II]{albanese2022marisa}. Note that the \gls{ris}-\gls{obcc} uses a different operating frequency and bandwidth w.r.t. the \gls{dc} ones, while, for the \gls{ibcc}, we have $f_r = f_d$ and $B_r =  5 B_d$. In any case, the \gls{ue}-\gls{cc} has operating frequency $f_u = f_d$ and bandwidth $B_u = 5 B_d$.
The overall frame duration $\tau$ set reflects the coherence time of the channel: a low $\tau$ represents a high mobility environment with low coherence time, and vice versa. The \gls{tti} duration is set according to the half of the subframe duration in the \gls{ofdm} 5G NR standard~\cite{3gpp:rel15}.
For the \gls{oce} paradigm, the channel estimation codebook $\mc{C}\oce$ is designed from the \gls{dft}, as described in Sect.~\ref{sec:communication-paradigms:oce}. For the sake of simplicity, the same configurations are used in the beam sweeping codebook $\mc{C}\bsw$. In particular, the codebook used by the \gls{bsw} with flexible frame structure is $\mc{C}\bsw^\mathrm{fle} = \mc{C}\oce$, while the one used by the \gls{bsw} with fixed frame structure uses one every three configurations, to take advantage of the possible lower overhead.
In the following, we divide the results into two parts: the evaluation of the paradigms performance under error-free \glspl{cc}, and the investigation of the impact of \glspl{cc} reliability.

\begin{table}[t]
    \centering
    \caption{Simulation parameters.}
    \footnotesize
    \begin{tabular}{lcc|lcc}
    \toprule
    % Parameter & Symbol & Value & Parameter & Symbol & Value \\ \midrule
    \multicolumn{3}{c}{\textbf{Scenario}} & \multicolumn{3}{c}{\textbf{Communication}} \\ \midrule
    Scenario side & $D$ & $20$~m & \gls{dc} frequency & $f_d$ & 3 GHz\\  
    BS position & $\mb{x}_b$ & $(25, 5, 5)\T$~m & Bandwidth of \gls{dc} & $B_d$ & $180$~kHz\\
    RIS element spacing & $d$ & $\nu / f_d / 2$ & \gls{ue} transmit power & $\rho_u$, $\rho_b$ & 24 \\
    Number of RIS elements & $N$ & 100 & \gls{ue}/\gls{ris} noise power & $\sigma_u^2, \sigma_r^2$ & $-94$~dBm\\
    \midrule     
     \multicolumn{3}{c}{\textbf{Paradigms}} & \multicolumn{3}{c}{\textbf{Control packet content}} \\ 
     \midrule     
     Codebooks cardinality & $C\oce$, $C\bsw^\mathrm{fix}$, $C\bsw^\mathrm{fle}$  & $N$, $\lceil N/3 \rceil$, $N$ &  ID bits & $b^\mathrm{ID}$ & 8\\
     Overall frame duration & $\tau$ & [10, 200] ms & \glspl{tti} bits & $b^\mathrm{frame}$ & 16\\
     \gls{tti} duration & $T$ & 0.5 ms & Guard period bits & $b^\mathrm{guard}$ & 16\\
     Guard period & $\tau_s$ & 50 $\mu$s & Configuration selection bits & $b^\mathrm{conf}$ & 8\\
     Pilot sequence length & $p$ & 1 &  \gls{se} table bits & $b^\mathrm{SE}$ & 6\\
     \gls{ce} duration in \glspl{tti} & $A$ & 5 & \gls{ris} quantization level bits& $b^\mathrm{quant}$ & 2\\     
     \bottomrule
    \end{tabular}
    \label{tab:params}
\end{table}

\subsection{Paradigms performance (error-free \glspl{cc})}

\begin{figure}[thb]
    \centering
    \input{tikz/cdf_snr}
    \caption{\gls{cdf} of the actual and estimated \gls{snr} for the communication paradigms under study.}
    \label{fig:snrcdf}
\end{figure}

Fig.~\ref{fig:snrcdf} shows the \gls{cdf} of the actual and estimated \gls{snr} to give some insight on the impact of the possible algorithm errors. From the figure, it can be inferred that the impact of the noise on the \gls{snr} estimation is generally negligible for the \gls{oce} paradigm. This finding is justified by the fact that the power of the noise influencing the measurement is proportional to $1/C\oce$, where $C\oce \ge N$ as described in Section~\ref{sec:communication-paradigms:oce}. On the other hand, when employing the \gls{bsw} paradigm, the measurement of the \gls{snr} is done separately per each configuration employed, and the resulting noise has a higher impact on the estimation. Moreover, we can also observe that the \gls{snr} of the \gls{bsw} extends to very low values, while the minimum target \gls{kpi} needs to be set to provide a non-negligible and supportable \gls{se} (at least higher than -13 dB to have the minimum \gls{se} of the 5G NR standard of $0.0586$~\cite[Table 5.1.3.1-3]{3gpp:nr}). Therefore, whatever reasonable target \gls{kpi} is chosen will result in a relatively high outage probability. To summarize, the \gls{oce} paradigm is inherently more robust to algorithmic errors than the \gls{bsw} paradigm.

To provide a fair comparison between the paradigms, we evaluate the optimal target \gls{snr} $\gamma_0$ used as relevant \gls{kpi} for the \gls{bsw} paradigm. 
Fig.~\ref{fig:kpi} shows the average goodput $R$ achieved as a function of the target \gls{snr}, under different kinds of \gls{cc} and for different values of $\tau$. We note that the optimal $\gamma_0$ depends on the frame structure chosen while it does not depend on the kind of \gls{cc}, the latter influencing slightly the achievable goodput under the same target \gls{snr}. Moreover, the duration $\tau$ influences negligibly the optimal $\gamma_0$ in the flexible structure, being approx. 13.8 dB for $\tau=30$ ms and approx. 12.4 dB for $\tau=90$ ms for the flexible frame structure, while approx. 10.9 dB for any value of $\tau$ for the fixed frame structure.
%Note that the rate of the \gls{bsw} fixed structure with \gls{ibcc} is null when $\tau=7.5$ ms because the \gls{cc} added overhead prevents the Payload phase to happen before the end of the frame.
We remark that the selection of the target \gls{kpi} is also scenario dependent, and hence this procedure should be performed during the deployment of the \gls{ris}.
% For the fixed frame structure, increasing the frame duration increases the goodput, but the optimal $\gamma_0$ is not influenced, because the overhead time for this scheme is fixed by the cardinality of the beam sweeping codebook $C\bsw$ (see eq.~\eqref{eq:algorithmic-time}). On the other hand, the optimal $\gamma_0$ is a function of the overall frame duration: the higher the target \gls{snr}, the higher the \gls{se} of the communication, but also the algorithmic time tends to increase. Hence, when the frame duration is low, keep $\gamma_0$ low is beneficial, reducing as much as possible the overhead time, being the major source of performance degradation; when, the frame duration is high, an higher value of $\gamma_0$ is helpful, because an higher communication \gls{se} impacts more than the increased overhead.

\begin{figure}[thb]
    \centering
    \input{tikz/rate_vs_gamma0}
    \vspace{-0.3cm}
    \caption{Analysis of the target \gls{snr} for the \gls{bsw} paradigm. Note the different scale in Fig.~\ref{fig:kpi:a}.}
    \label{fig:kpi}
    \vspace{-0.3cm}
\end{figure}

Using the optimal target \gls{snr}, we now compare the performance of the communication paradigms. %in Fig.~\ref{fig:goodput}.
Fig.~\ref{fig:goodput:a} shows the average goodput as a function of the overall frame duration. Again, the impact of the kind of \gls{cc} on the average goodput is negligible. The main advantage of the \gls{bsw} approach is the possibility of providing a non-null transmission rate even in presence of a lower coherence block ($< 60$ ms), while the \gls{oce} needs a longer time horizon to obtain the \gls{csi} and perform the Payload phase ($\ge 60$ ms). On the other hand, as long as the time horizon is sufficiently long ($\tau \ge 75$ ms), the \gls{oce} paradigm outperforms the \gls{bsw} ones.
In Fig.~\ref{fig:goodput:b}, we show the \gls{cdf} of the goodput for $\tau = 60$ ms. For this frame duration, the kind of \gls{cc} influences the performance of the \gls{oce} paradigm, while its impact is less predominant on the \gls{bsw} performance. As expected, the \gls{ibcc} provides worse performance due to its increased overhead. Nevertheless, remark that for the \gls{bsw} approximately half of the transmissions has null goodput because of algorithmic errors, while the \gls{oce} provide a non-null goodput for all values, corroborating the results of Fig.~\ref{fig:snrcdf}.

\begin{figure}[bth]
    \centering
    \input{tikz/rate}    
    \vspace{-0.3cm}
    \caption{Analysis of the goodput performance.}
    \label{fig:goodput}
     \vspace{-0.5cm}
\end{figure}

\subsection{Impact of the \glspl{cc} reliability}
Fig.~\ref{fig:utility} shows the average utility~\eqref{eq:utility} as a function of the erroneous control probability $1 - p_\mathrm{cc}$, for $\tau = 60$ ms and for both kinds of \gls{cc}. The results of the transmission paradigms are in line with the one presented in Fig.~\ref{fig:goodput}. The \gls{cc} reliability influences significantly the performance when $1 - p_\mathrm{cc} \le 0.05$, \emph{i.e.}, $p_\mathrm{cc} \le 0.95$. 
%
\begin{figure}[htb]
    \centering
    \input{tikz/utility_tau60.0} 
    \vspace{-0.3cm}
    \caption{Analysis of the utility function vs. erroneous control probability.}
    \label{fig:utility}
    \vspace{-0.3cm}
\end{figure}
%
To consider a conservative case, we set a target reliability to be $\bar{p}_\mathrm{cc} = 0.99$, and we study the minimum average \glspl{snr} $\lambda_u$ and $\lambda_r$ providing such reliability following the control packet content given in Table~\ref{tab:params}. Fig.~\ref{fig:reliability:a} shows the achieved $p_\mathrm{cc}$ for the \gls{obcc} as a function of $\lambda_u$ only, according to the assumption of error-free \gls{ris}-\gls{cc} in the \gls{obcc} case. With this kind of \gls{cc}, the probabilities of correct control achieved by \gls{oce} and \gls{bsw} have negligible differences, and a $\bar{\lambda}_u = 10.5$ dB is enough to provide the target correct control probability in both cases. Fig.~\ref{fig:reliability:b} shows the $p_\mathrm{cc}$ as a heatmap function of $\lambda_r$ and $\lambda_u$ for the \gls{ibcc} case. Note that only the region of $\lambda_u$ and $\lambda_r$ providing at least the target $\bar{p}_\mathrm{cc}$ is colored, while the white part of the heatmap represents the \glspl{snr} values not satisfying the target reliability. The minimum value of $\lambda_r$ and $\lambda_u$ needed are also given in the figure. It is worth noting that the \gls{oce} needs higher \glspl{snr} than \gls{bsw} due to the higher information content of the control packet of the former. Finally, we remark that the performance provided by the \glspl{cc} should be accounted for \emph{simultaneously} to achieve the desired control reliability.

\begin{figure}[htb]
    \centering
    \input{tikz/reliability} 
    \vspace{-0.3cm}
    \caption{Impact of the \gls{cc} \gls{snr} to the reliability.}
    \label{fig:reliability}
    \vspace{-0.3cm}
\end{figure}