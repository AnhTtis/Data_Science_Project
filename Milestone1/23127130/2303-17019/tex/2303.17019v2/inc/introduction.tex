\def\secstatus{finished}

\section{Introduction}
\label{sec:intro}

%
Plasma disruptions and their mitigation strategies have been one of
the most active research areas in tokamak fusion in recent
years. Studying runaway electrons, which are a major cause for
intolerable machine damages by tokamak disruptions, is of great
interest.  The runaway electrons are typically considered in the
guiding center formulation, which has been averaged over the
gyromotion. The resulting model is a relativistic
Fokker--Planck--Boltzmann model when both small-angle and large-angle
Coulomb collisions are accounted for.  For more details on the
physics, see the recent review
papers~\cite{boozer-pop-2015,breizman2019physics} and references therein.

One of the main interests in studying the runaway electrons is to
understand the impact of different collisions (large-angle,
small-angle, etc.) and radiation damping under the dominant electric
field along the magnetic field direction.  The competition between
parallel electric field acceleration and collisional/radiative drag
sets the advective term, albeit in momentum space of the relativistic
drift-kinetic equation, while the collisional energy diffusion and
pitch-angle scattering appear in the form of diffusion operators in
energy and pitch of the momentum space. There is a natural time-scale
separation between the advective and diffusive time scales, with the
latter much longer than the former at suprathermal energy.  Therefore
it is critical to step over the advective scale due to parallel
electric field acceleration of the runaway electrons and study the
collision or diffusion scale. As a result, implicit time stepping is
typically used.

The existing work based on a continuous representation
of distribution functions includes conservative finite difference and
finite volume schemes~\cite{GuoMcDevittTang2017, stahl2017norse,
hesslow2018effect, daniel2020fully}. They typically solve the
distribution function in the 2D momentum space.  Several
numerical challenges are associated with this model. First, the advection
due to the parallel electric field is dominant in  most  of the
domain, but the diffusion coefficient is nonuniform and becomes larger
when getting close to the thermal velocity. Since we are generally
interested in the impact of collisions, a desired algorithm should
step over the fast advection time scale. Second, the distribution
function becomes very anisotropic in pitch and has a nontrivial fat (in energy) tail as
time evolves, which is commonly referred to a ``runaway tail.''  A
corresponding treatment in meshing is necessary to resolve the
highly anisotropic (in pitch) tail. Third, the distribution function can span over 10 or more orders of
magnitude. An accurate numerical algorithm is needed to resolve such a
large range of values.  This work  addresses all these
issues.  For the first issue, we will rely on implicit time stepping,
nonlinear solvers, and algebraic multigrid preconditioners. The second
issue will be resolved through developing an adaptive mesh refinement (AMR) capability, which is a
major focus of the current work. The third issue will be resolved
through the accurate numerical schemes in both space and time as well
as a modeling choice to chop off a large portion of a Maxwellian close
to the thermal velocity.
%

%
In both fluid and kinetic models, AMR plays a key role in fusion
device modeling because of localized interesting structures such as
thin current sheets, plasmoids, and very anisotropic
distributions. Many of the previous related studies focus on fluid
plasma models such as extended magnetohydrodynamics (MHD) or its
equilibrium (see, e.g.,~\cite{strauss1998adaptive, philip2008implicit,
baty2019finmhd, peng2020adaptive, tang2022adaptive} and the references
therein), while there are only a limited number of studies for
continuous kinetic simulations~\cite{hittinger2013block,
adams2017landau, wettervik2017relativistic}.  \editBOne{}{ In the
broader context of statistical physics for a variety of applications,
AMR has found usage in improving the computational efficiency since it
``allows resolving important regions of phase space where the
particles are present and reduce the number of cells in the regions
with no particles.''\cite{arslanbekov2013kinetic}.  In
Ref.~\cite{kolobov2019boltzmann}, a 1D1V electron kinetic solver with
AMR was explicitly demonstrated for the thermal electron runaway
acceleration, also known as Dreicer acceleration, in what amounts to
be an electrostatic glow discharge for low-temperature plasma
generation.  The prospective advantage of AMR in mesh-base kinetic
solvers, as pointed out in these previous work, holds even greater
promise and importance in the current problem of Ohmic-to-runaway
current conversion in a magnetized plasma.  This is because the strong
energy dependence of plasma collisionality introduces a distinct set
of numerical challenges that AMR must be tailored to overcome in this
paper.  First, the energy range of the electrons can easily span 6--7
orders of magnitude between thermal electrons (eVs) and the runaway tail ($>$ MeV),
which produces huge variations in plasma collisionality.  Second,
extreme anisotropy in the momentum space, in the electron pitch $\xi,$
is increasingly aggravated for higher electron energies.  Third, the
runaway tail distribution, which is the quantity of interest for this
type of problems, can be 12 orders of magnitude, or more, lower than
the bulk electron density, but the resolution of this tail is critical to
evaluate the primary runaway seeds for the follow-up avalanche
growth.  Much of our considerations in AMR adaptation strategy,
spatial and temporal discretization, and the necessary implicit
solvers for vastly varying plasma collisionality as a function of
electron energy, is geared toward overcoming these extreme numerical
challenges.}

One of the most important pieces in any of those AMR algorithms is an
indicator to determine where to refine and coarsen the mesh. There are
two types of AMR indicators in the literature: error-estimator-based
and feature-based. For instance, an indicator based on the features in
the current and vorticity is proposed in the adaptive MHD
solver~\cite{philip2008implicit}, while a weighted sum of several
finite element error estimators is used as the indicator for the same
resistive MHD system in~\cite{tang2022adaptive}. Other common
error-estimator-based approaches for finite difference/finite volume
include Richardson extrapolation~\cite{berger1989local}, solution
smoothness via derivatives~\cite{Constantinescu_A2008a}, and
goal-oriented strategies~\cite{offermans2022error}. These probe
certain aspects of the solution error but can become expensive if one
considers \editAll{less}{} frequent regridding.
%
%
Another common issue is that the AMR indicators are based on the
present solution, which results in adaptive meshes being lagged
compared with features of interest because regridding often
happens every ten or more time steps.
For another class of problems in wave propagation, explicit time stepping is
computationally attractive; and in this explicit case one time step with
explicit Euler can be taken \cite{GuoCheng17} to approximate mesh refinement
one time step in the future.
%
In this work, where we focus on implicit time stepping, we explore several
different types of AMR indicators and propose predicting these AMR indicators
for multiple time steps.

%
\editAll{}{
The computational challenges of solving for the runaway electron distribution
from relativistic Fokker--Planck and Fokker--Planck--Boltzmann
equations---despite being linear partial differential equations (PDEs)---are:
(i) the ability to resolve the dynamically evolving runaway distribution both
near the runaway vortex regime and at a parallel electric field that is
significantly beyond the onset of the runaway vortex;
(ii) the solution being a small but positive function that varies 10--20 orders of
magnitude in momentum space;
(iii) the competing effects of advection- and diffusion-dominated regimes that
are shifting throughout the momentum space.
}

%
\editAll{}{
Challenges (i) and (ii) are addressed with an AMR discretization to resolve
the dynamical structure of the electron distribution in momentum space; while
(iii) is tackled with an algorithmically scalable solver for implicit time
stepping on the AMR discretization.
}
\editAll{}{Specifically}, we develop adaptive, scalable, fully implicit solvers
for a time-dependent relativistic drift-kinetic Fokker--Planck--Boltzmann model in
the momentum space.  The octree-based AMR
package {\tt p4est}~\cite{BursteddeWilcoxGhattas11}
is used as the basic framework to provide a parallel dynamic AMR
algorithm.
The numerical schemes are based on conservative finite difference or
finite volume algorithms, such as, the QUICK and MUSCL schemes
%
%
\cite{LeVeque02, Toro09, Leonard79}.  The solvers are
developed under the {\tt PETSc} framework \cite{petsc-user-ref}, and
our focus is fully implicit time stepping, nonlinear solvers, and
preconditioning strategies.  Diagonally implicit
Runge--Kutta (DIRK)~\cite{alexander1977diagonally} or explicit first-stage singly diagonally implicit Runge--Kutta (ESDIRK)
integrators \cite{giraldo2013implicit} %
are chosen. The nonlinear solver is based on a Jacobian-free
Newton--Krylov (JFNK) method \cite{knoll2004jacobian}, which is
preconditioned by a finite difference coloring Jacobian and
hypre's algebraic multigrid preconditioner \cite{hypre,
FalgoutYang02}.  While developing the adapative solvers, we present and analyze
several feature-based AMR indicators for the distribution function.
We further propose predicting these AMR indicators for multiple time steps, which
can be done at a fraction of the computational cost when reducing the original
advection--diffusion PDE to a pure-advection PDE.  We quantify the benefits of
predictive AMR on the resolution of distribution functions and we describe the
limitations when trading off computational costs for accuracy; this will be
done with extensive numerical experiments.
\editOne{}{
We demonstrate the robustness of our numerical solvers and preconditioners for
the computationally challenging runaway electron models within a simulation with
dynamic AMR.  We achieve problem-robust and algorithmically scalable methods.
Additionally, we document the possibilities and limitations for parallel
scalability, where the existence of limitations is inherent to any implicit scheme.
}

%
The rest of the paper is organized as follows.
%
Section~\ref{sec:governing-eqns} gives an overview of the relativistic
Fokker--Planck--Boltzmann model. The discussions focus on the forms of the
collision operator, synchrotron radiation, and the full equation in
the momentum space.
%
Section~\ref{sec:amr} describes \editTwo{AMR algorithms and several AMR
indicators}{the key contributions related to AMR algorithms}.
In particular, a prediction approach for AMR indicators is proposed.
%
Section~\ref{sec:solver} presents the details of \editTwo{the}{further key
contributions: the robust and algorithmically scalable} numerical schemes and
their implementation in our code framework.
%
Section~\ref{sec:setup} focuses on the experimental setup and reproducibility.
We describe several manufactured solutions for accuracy tests and some details
on computational environments.  We also discuss the impact of the field and
knock-on collision operators.
%
Section~\ref{sec:results} presents several numerical examples, which include
\editTwo{both algorithmic and}{algorithmic scalability, parallel scalability,
and a} physics study.
%
The conclusions and discussion of future work are given in
Section~\ref{sec:conclusion}.

