% Mathematical symbols and operators
%
% Author: Johann Rudi

% adjoint like
%\newcommand{\trans}{\top}
%\newcommand{\trans}{\intercal}
\newcommand{\trans}{\mathsf{T}}
\newcommand{\transpose}{^{\trans}}
\newcommand{\adjoint}{^{\ast}}
\newcommand{\dual}{^{\prime}}
\newcommand{\perpendicular}{^{\perp}}

% derivatives
\newcommand{\gradient}{\nabla}
\newcommand{\symgradient}{\nabla_{\!\mathrm{s}}}
\newcommand{\divergence}{\nabla\cdot}
\newcommand{\symdivergence}{\nabla_{\!\mathrm{s}}\cdot}
\newcommand{\totalderivative}{D}
\newcommand{\Laplace}{\Delta}

\newcommand{\partd}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}}
\newcommand{\partddd}[2]{\frac{\partial^3 #1}{\partial {#2}^3}}
\newcommand{\totald}[1]{\frac{\totalderivative #1}{\totalderivative t}}
\newcommand{\timed}[1]{\frac{\mathrm{d} #1}{\mathrm{d} t}}

% integration
\newcommand{\intd}{\,\mathrm{d}}
\newcommand{\indicatorfnc}{{\chi\smash[t]{\mathstrut}}}

% norms, floor/ceil
\newcommand{\abs}[1]{\left\lvert#1\right\rvert}
\newcommand{\magn}[1]{\left\lvert#1\right\rvert}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\ceil}[1]{\lceil#1\rceil}
\newcommand{\floor}[1]{\lfloor#1\rfloor}

% linear forms, inner products, duality pairings
\newcommand{\linearform}[2]{#1 \mspace{-2mu} \left(#2\right)}
\newcommand{\bilinearform}[3]{#1 \mspace{-2mu} \left(#2\mathbin{,}#3\right)}
\newcommand{\innerprod}[2]{\left(#1\mathbin{,}#2\right)}
\newcommand{\vecprod}[2]{\left\langle#1\mathbin{,}#2\right\rangle}
\newcommand{\dualprod}[4]{\left\langle#1\mathbin{,}#2\right\rangle_{#3\times#4}}

% function spaces
\newcommand{\Lebesgue}[1]{\ensuremath{ L^{#1} }}
\newcommand{\Lone}{\Lebesgue{1}}
\newcommand{\Ltwo}{\Lebesgue{2}}
\newcommand{\Linf}{\Lebesgue{\infty}}
\newcommand{\LL}{\Ltwo}
\newcommand{\Sobolev}[1]{\ensuremath{ H^{#1} }}

% Landau 'O' and 'o' notation
\newcommand{\LandauO}{\ensuremath{\mathcal{O}}}
\newcommand{\Landauo}{\ensuremath{\mathcal{o}}}

% 'log' type operators
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\diam}{diam}
\DeclareMathOperator{\e}{e}
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\erfc}{erf\mspace{1mu}c}
\DeclareMathOperator{\Id}{Id}
\DeclareMathOperator{\im}{i}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\vecspan}{span}
\DeclareMathOperator{\dynamicratio}{DR}

% 'lim' type operators
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\esssup}{ess\,sup}
\DeclareMathOperator*{\essinf}{ess\,inf}

% range and kernel
\DeclareMathOperator{\range}{Ran}
\DeclareMathOperator{\kernel}{Ker}

% sets
\newcommand{\set}[1]{\ensuremath{\mathbb{#1}}}
\newcommand{\N}{\set{N}}
\newcommand{\I}{\set{I}}
\newcommand{\setP}{\set{P}}
\newcommand{\Q}{\set{Q}}
\newcommand{\R}{\set{R}}
\newcommand{\Z}{\set{Z}}

% bold variables, vectors and matrices
\newcommand{\boldvar}[1]{\ensuremath{\boldsymbol{#1}}}
\newcommand{\boldvec}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\mat}[1]{\boldvec{#1}}
\ifdefined\vec
  \renewcommand{\vec}[1]{\boldvec{#1}}
\else
  \newcommand{\vec}[1]{\boldvec{#1}}
\fi

\newcommand{\be}{\boldvar{e}}
\newcommand{\bn}{\boldvar{n}}
\newcommand{\bT}{\boldvar{T}}
\newcommand{\bx}{\boldvar{x}}
\newcommand{\bzero}{\boldvar{0}}

\newcommand{\unitvec}{\vec{e}}
\newcommand{\zerovec}{\vec{0}}
\newcommand{\onevec}{\vec{1}}
\newcommand{\IdMat}{\mat{I}}
\newcommand{\ZeroMat}{\mat{0}}
\newcommand{\OneMat}{\mat{1}}

% punctuation at the end of equations
\newcommand{\eqcomma}{,} %{\,,}
\newcommand{\eqperiod}{.} %{\,.}

% about `~`
\newcommand{\about}{\ensuremath{\sim}}

% fluid dynamics
\newcommand{\timesym}{t}
\newcommand{\temp}{T}
\newcommand{\density}{\rho}
\newcommand{\vel}{\boldvar{u}}
\newcommand{\press}{p}

\newcommand{\visc}{\mu}
\newcommand{\bulkvisc}{\lambda}
\newcommand{\Peclet}{P\mspace{-1mu}e}

\newcommand{\strainrate}{\dot{\varepsilon}}
\newcommand{\strainratetensor}{\dot{\boldvar{\varepsilon}}}
\newcommand{\stress}{\sigma}
\newcommand{\stresstensor}{\boldvar{\sigma}}
\newcommand{\viscstress}{\tau}
\newcommand{\viscstresstensor}{\boldvar{\tau}}

\newcommand{\invII}[1]{#1_{\textrm{\textsc{ii}}}} %{#1_{I{\!}I}}
\newcommand{\strainrateinvII}{\invII{\strainrate}}
\newcommand{\viscstressinvII}{\invII{\viscstress}}

\newcommand{\rhsvel}{\boldvar{f}}
\newcommand{\rhspress}{g}

% thermodynamics
\newcommand{\vol}{v}
\newcommand{\heat}{q}

\newcommand{\conduct}{k}

\newcommand{\thermalexpan}{\alpha}
\newcommand{\thermalexpanref}{{\bar\alpha}}
\newcommand{\isothermalcompress}{{\chi\smash[t]{\mathstrut}}_{\temp}}
\newcommand{\isothermalcompressrep}{{\chi\smash[t]{\mathstrut}}_{\temp_{r}}}
\newcommand{\isothermalcompressref}{{{\bar\chi}\smash[t]{\mathstrut}}_{\temp}}

\newcommand{\specificheatconstvol}{c_{\vol}}
\newcommand{\specificheatconstvolrep}{c_{\vol_{r}}}
\newcommand{\specificheatconstvolref}{{\bar c}_{\vol}}
\newcommand{\specificheatconstpress}{c_{\press}}
\newcommand{\specificheatconstpressrep}{c_{\press_{r}}}
\newcommand{\specificheatconstpressref}{{\bar c}_{\press}}

\newcommand{\thermaldiffus}{\kappa}

\newcommand{\intheatproduction}{H}

% mantle flow physics
\newcommand{\BoundarySurf}{\Gamma_{\mathrm{surf}}}
\newcommand{\BoundaryCore}{\Gamma_{\mathrm{core}}}

\newcommand{\plateagemin}{\timesym_{\mathrm{pl,min}}}
\newcommand{\plateageback}{\timesym_{\mathrm{pl,back}}}

\newcommand{\viscmin}{\visc_{\mathrm{min}}}
\newcommand{\viscmax}{\visc_{\mathrm{max}}}
\newcommand{\visclit}{\visc_{\mathrm{lit}}}
\newcommand{\viscast}{\visc_{\mathrm{ast}}}
\newcommand{\viscUM}{\visc_{\textsc{um}}}
\newcommand{\viscLM}{\visc_{\textsc{lm}}}
\newcommand{\visctemp}{a}
\newcommand{\visctempof}[1]{\visctemp\left(#1\right)}
\newcommand{\visctempfactor}{c_{a}}
\newcommand{\visctempfactorLM}{c_{a_{\textsc{lm}}}}
\newcommand{\visctempfactorUM}{c_{a_{\textsc{um}}}}
\newcommand{\viscscalfactorLM}{c_{\textsc{lm}}}
\newcommand{\viscscalfactorUM}{c_{\textsc{um}}}
\newcommand{\activationenergy}{E_{a}}
\newcommand{\activationenergyLM}{E_{a,\textsc{lm}}}
\newcommand{\activationenergyUM}{E_{a,\textsc{um}}}

\newcommand{\weak}{w}
\newcommand{\weakof}[1]{\weak\left(#1\right)}
\newcommand{\weakmin}{w_{\mathrm{min}}}
\newcommand{\weakind}{{\chi\smash[t]{\mathstrut}}}

\newcommand{\stressexp}{n}
\newcommand{\viscstressyield}{\viscstress_{\mathrm{yield}}}
\newcommand{\strainrateshift}{d}

\newcommand{\gravity}{g}
\newcommand{\Prandtl}{P\mspace{-1mu}r}
\newcommand{\Rayleigh}{R\mspace{-1mu}a} % old: \mathrm{Ra}

% infinite-dimensional Stokes system
\newcommand{\FncSpVel}{\Sobolev{1}(\Omega)^{d}}
\newcommand{\FncSpVelBc}{\Sobolev{1}_{0,\bn}(\Omega)^{d}}
\newcommand{\FncSpPress}{\Lebesgue{2}(\Omega)}
\newcommand{\FncSpPressMean}{\Lebesgue{2}(\Omega)/\R}
\newcommand{\FncSpVelGrad}{\Lebesgue{2}(\Omega)^{d \times d}}
\newcommand{\FncSpVelDual}{\Sobolev{-1}(\Omega)^{d}}
\newcommand{\FncSpPressHiReg}{\Sobolev{2}(\Omega)}
\newcommand{\FncSpPressHiRegDual}{\Sobolev{-2}(\Omega)}

\newcommand{\gradvel}{\nabla_{\!\vel}}
\newcommand{\divvel}{\nabla_{\!\vel}\cdot}
\newcommand{\gradpress}{\nabla_{\!\press}}

\newcommand{\ViscStressOp}{A}
\newcommand{\GradOp}{B\adjoint}
\newcommand{\DivOp}{B}
\newcommand{\GradOpExt}{B\adjoint} %{\hat{B}\adjoint}
\newcommand{\DivOpExt}{B} %{\hat{B}}
\newcommand{\SchurOp}{S}
\newcommand{\PressPoissonOp}{K} %{\hat{K}}
\newcommand{\ViscStressApproxOp}{\tilde{\ViscStressOp}}
\newcommand{\SchurApproxOp}{\tilde{\SchurOp}}

\newcommand{\ViscStressApproxOpId}{\tilde{\ViscStressOp}_{1}}
\newcommand{\ViscStressApproxOpVisc}{\tilde{\ViscStressOp}_{1/\visc}}
\newcommand{\ViscStressApproxOpBFBT}{\tilde{\ViscStressOp}_{\mathrm{BFBT}}}
\newcommand{\ViscStressApproxOpWBFBT}{\tilde{\ViscStressOp}_{\mathrm{w\text{-}BFBT}}}
\newcommand{\SchurApproxOpId}{\tilde{\SchurOp}_{1}}
\newcommand{\SchurApproxOpVisc}{\tilde{\SchurOp}_{1/\visc}}
\newcommand{\SchurApproxOpBFBT}{\tilde{\SchurOp}_{\mathrm{BFBT}}}
\newcommand{\SchurApproxOpWBFBT}{\tilde{\SchurOp}_{\mathrm{w\text{-}BFBT}}}

\newcommand{\bfbtweight}{w}
\newcommand{\bfbtweightleft}{\bfbtweight_{l}}
\newcommand{\bfbtweightright}{\bfbtweight_{r}}

% discrete Stokes system
\newcommand{\discrQ}[1]{\ensuremath{ \Q_{#1} }}
\newcommand{\discrP}[1]{\ensuremath{ \setP_{#1} }}
\newcommand{\discrPdisc}[1]{\ensuremath{ \setP_{#1}^{\mathrm{disc}} }}
\newcommand{\discrQdisc}[1]{\ensuremath{ \Q_{#1}^{\mathrm{disc}} }}
\newcommand{\discrPbubble}[1]{\ensuremath{ \setP_{#1}^{\mathrm{bubble}} }}
\newcommand{\discrQPdisc}[2]{\ensuremath{ \discrQ{#1}\times\discrPdisc{#2} }}
\newcommand{\discrQQdisc}[2]{\ensuremath{ \discrQ{#1}\times\discrQdisc{#2} }}
\newcommand{\discrQQ}[2]{\ensuremath{ \discrQ{#1}\times\discrQ{#2} }}
\newcommand{\discrPP}[2]{\ensuremath{ \discrP{#1}\times\discrP{#2} }}
\newcommand{\discrPbubblePdisc}[2]{\ensuremath{ \discrPbubble{#1}\times\discrPdisc{#2} }}

\newcommand{\velvec}{\vec{u}}
\newcommand{\pressvec}{\vec{p}}
\newcommand{\rhsvelvec}{\vec{f}}
\newcommand{\rhspressvec}{\vec{g}}
\newcommand{\rotvec}{\vec{r}}

\newcommand{\ViscStressMat}{\mat{A}}
\newcommand{\GradMat}{\mat{B}\transpose}
\newcommand{\DivMat}{\mat{B}}
\newcommand{\SchurMat}{\mat{S}}
\newcommand{\ViscStressPcMat}{\tilde{\ViscStressMat}}
\newcommand{\SchurPcMat}{\tilde{\SchurMat}}

\newcommand{\MassMat}{\mat{M}}
\newcommand{\MassLumpMat}{\tilde{\mat{M}}}
\newcommand{\VelMassMat}{\MassMat_{\vel}}
\newcommand{\VelMassLumpMat}{\MassLumpMat_{\vel}}
\newcommand{\PressMassMat}{\MassMat_{\press}}
\newcommand{\PressMassLumpMat}{\MassLumpMat_{\press}}

\newcommand{\BfbtScalLeftMat}{\mat{C}}
\newcommand{\BfbtScalRightMat}{\mat{D}}
\newcommand{\WbfbtScalLeftMat}{\BfbtScalLeftMat_{\bfbtweightleft}}
\newcommand{\WbfbtScalRightMat}{\BfbtScalRightMat_{\bfbtweightright}}
\newcommand{\PressPoissonMat}{\mat{K}}
\newcommand{\PressPoissonLeftMat}{\PressPoissonMat_{l}}
\newcommand{\PressPoissonRightMat}{\PressPoissonMat_{r}}
\newcommand{\PressPoissonPcMat}{\tilde{\PressPoissonMat}}
\newcommand{\PressPoissonLeftPcMat}{\PressPoissonPcMat_{l}}
\newcommand{\PressPoissonRightPcMat}{\PressPoissonPcMat_{r}}

% variational formulation of Stokes system
\newcommand{\veltest}{\boldvar{v}}
\newcommand{\presstest}{q}
\newcommand{\velbasis}{\boldvar{\phi}}
\newcommand{\pressbasis}{\psi}

% 1st order variation of Stokes system
\newcommand{\velvar}{\hat{\vel}}
\newcommand{\pressvar}{\hat{\press}}
\newcommand{\residualmom}{\boldvar{r}_{\mathrm{mom}}}
\newcommand{\residualmass}{r_{\mathrm{mass}}}
\newcommand{\residualmomsub}[1]{\boldvar{r}_{\mathrm{mom}#1}}
\newcommand{\residualmasssub}[1]{r_{\mathrm{mass}#1}}

\newcommand{\velvarvec}{\hat{\velvec}}
\newcommand{\pressvarvec}{\hat{\pressvec}}
\newcommand{\residualmomvec}{\vec{r}_{\mathrm{mom}}}
\newcommand{\residualmassvec}{\vec{r}_{\mathrm{mass}}}

% Newton linearization
\newcommand{\srdual}{\boldvar{S}}

%
% Inversion & uncertainty quantification
%

\newcommand{\nparam}{{n_{m}}}
\newcommand{\nobs}{{n_{d}}}
\newcommand{\noise}{\vec{e}_{\mathrm{noise}}}

% parameters
\newcommand{\FncSpParam}{X}
\newcommand{\param}{m}
\newcommand{\incrparam}{\tilde\param}
\newcommand{\varincrparam}{\hat\param}
\newcommand{\paramprior}{\param_{\mathrm{pr}}}
\newcommand{\parammap}{\param_{\mathrm{MAP}}}

\newcommand{\paramvec}{\vec{\param}}
\newcommand{\paramvecmap}{\vec{\param}_{\mathrm{MAP}}}
\newcommand{\paramglovec}{\vec{\param}_{\mathrm{glo}}}
\newcommand{\paramweakvec}{\vec{\param}_{\mathrm{weak}}}
\newcommand{\parampriorvec}{\paramvec_{\mathrm{pr}}}
\newcommand{\parammapvec}{\paramvec_{\mathrm{MAP}}}

% observations and data
\newcommand{\FncSpObs}{Y}
\newcommand{\data}{d}
\newcommand{\datatrue}{\data_{\mathrm{true}}}

\newcommand{\datavec}{\vec{d}}
\newcommand{\datatruevec}{\datavec_{\mathrm{true}}}
%\newcommand{\obs}{\data_{\mathrm{obs}}}
%\newcommand{\obsmap}{\vec{f}}

\newcommand{\ObsOp}{\mathcal{F}}
\newcommand{\ObsOpDeriv}{\boldvar{F}}
\newcommand{\ObsOpJacobian}{\mat{F}}

% probability density functions
\newcommand{\pdf}{\pi}
\newcommand{\pdfcond}[2]{\pdf\left(#1\mid#2\right)}
\newcommand{\pdfprior}{\pdf_{\mathrm{pr}}}
\newcommand{\pdfpost}{\pdf_{\mathrm{post}}}
\newcommand{\pdflike}{\pdf_{\mathrm{like}}}
\newcommand{\pdflikecond}[2]{\pdf_{\mathrm{like}}\left(#1\mid#2\right)}

%
\newcommand{\varisymbol}[1]{\tilde#1}
\newcommand{\variisymbol}[1]{\hat#1}
\newcommand{\VarI}[2]{\delta_{#1}[#2](\varisymbol#1)}
\newcommand{\VarII}[2]{\delta_{#1}[#2](\variisymbol#1)}
\newcommand{\VarVarII}[3]{\delta_{#1}\delta_{#2}[#3]%
                            (\varisymbol#2)(\variisymbol#1)}
\newcommand{\fwd}{u}
\newcommand{\adj}{v}
\newcommand{\incrfwd}{\varisymbol\fwd}
\newcommand{\incradj}{\varisymbol\adj}
\newcommand{\varincrfwd}{\variisymbol\fwd}
\newcommand{\varincradj}{\variisymbol\adj}
\newcommand{\fwdrhs}{f}

\newcommand{\FncSpForward}{V}
\newcommand{\FncSpAdjoint}{V}
\newcommand{\FncSpForwardDual}{\FncSpForward^\prime}
\newcommand{\ForwardOp}{\ensuremath{\mathcal{A}}}
\newcommand{\ObjectiveMAP}{\ensuremath{\mathcal{J}}}

\newcommand{\LagrangianGrad}{\ensuremath{\mathcal{L}_g}}
\newcommand{\LagrangianHess}{\ensuremath{\mathcal{L}_H}}

% Gaussians
\newcommand{\NormalDistrib}{\mathcal{N}}
\newcommand{\CovOp}{\mathscr{C}}
\newcommand{\CovMat}{\mat{\Gamma}}

\newcommand{\CovOpPrior}{\CovOp_\mathrm{pr}}
\newcommand{\CovMatPrior}{\CovMat_\mathrm{pr}}
\newcommand{\CovOpNoise}{\CovOp_\mathrm{noise}}
\newcommand{\CovMatNoise}{\CovMat_\mathrm{noise}}
\newcommand{\CovOpPost}{\CovOp_\mathrm{post}}
\newcommand{\CovMatPost}{\CovMat_\mathrm{post}}

%
\newcommand{\ParamGradientOp}{\ensuremath{\mathcal{G}}}
\newcommand{\ParamHessianOp}{\ensuremath{\mathcal{H}}}
\newcommand{\HessianMisfit}{\mat{H}_\mathrm{misfit}}

%
% Iterative methods
%

\newcommand{\PC}[1]{\tilde{#1}^{-1}}
\newcommand{\IterProc}{\mathcal{I}}
\newcommand{\ErrorOp}{\mathcal{E}}

\newcommand{\MG}{M\mspace{-1mu}G}

%
% Implementation
%

% parallelization
\newcommand{\mpisize}{\ensuremath{n_{\mathrm{mpi}}}}
\newcommand{\ompsize}{\ensuremath{n_{\mathrm{omp}}}}

% MG, general
\newcommand{\MGlevel}{\ensuremath{l}}
\newcommand{\MGnLevels}{\ensuremath{L}}

% GMG
\newcommand{\GMGlevel}{\ensuremath{\MGlevel_{\textsc{gmg}}}}
\newcommand{\GMGnLevels}{\ensuremath{\MGnLevels_{\textsc{gmg}}}}
\newcommand{\GMGnDgNodesPerProc}{\ensuremath{n_{p}}}
\newcommand{\GMGnDgNodesPerProcMin}{\ensuremath{n_{p,\mathrm{min}}}}
\newcommand{\GMGnDofCoarse}{\ensuremath{N_{\MGnLevels-1}}}

% AMG
\newcommand{\AMGlevel}{\ensuremath{\MGlevel_{\textsc{amg}}}}
\newcommand{\AMGnLevels}{\ensuremath{\MGnLevels_{\textsc{amg}}}}
\newcommand{\AMGnDofPerProc}{\ensuremath{m_{p}}}
\newcommand{\AMGnDofCoarse}{\ensuremath{M_{\MGnLevels-1}}}
\newcommand{\AMGnProcMax}{\ensuremath{P_{\textsc{amg}}}}
\newcommand{\AMGmemPerDof}{\ensuremath{c_{\textsc{dof}}}}
\newcommand{\AMGnzzPerLevel}{\ensuremath{D}}
\newcommand{\AMGnzzPerDof}{\ensuremath{d}}
\newcommand{\AMGdofReduction}[2]{\ensuremath{r_{#1 \rightarrow #2}}}
\newcommand{\AMGnzzIncrease}[2]{\ensuremath{f_{#1 \rightarrow #2}}}

% architecture
\newcommand{\archMaxMemPerProc}{\ensuremath{b_{\mathrm{max}}}}

