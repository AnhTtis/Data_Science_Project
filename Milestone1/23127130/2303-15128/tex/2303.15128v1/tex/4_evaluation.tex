%!TEX root = ../main.tex

\section{Discovery Capabilities and Performance}
\label{sec:eval}
We evaluate the performance of the proposed solution compared to the unchanged SOME/IP SD protocol.
Therefore, we first compare the service discovery capabilities showing differences in communication schemes and security mechanisms.
Then, we evaluate the performance of our prototype implementation in terms of discovery and subscription latency.

\begin{table*}
    \caption{Feature comparison between the SOME/IP SD protocol and the proposed approach based on DNSSEC and DANE.}
    \label{tab:comparison}
    \centering
    \normalsize
    \setlength{\tabcolsep}{7pt}        % distance between table columns
    % \renewcommand{\arraystretch}{1.3}  % distance between rows
    \begin{tabularx}{\linewidth}{p{4.2cm} L L} \toprule
        \textbf{Feature} & \textbf{SOME/IP SD} (and related work) & \textbf{SD w/ DNSSEC and DANE}~(our~approach)\\
        \midrule
        Standard commission & 
        AUTOSAR~\cite{aspsJR21,assdJR21} & 
        IETF~\cite{RFC-2535,RFC-6698,sbnsbpJR22}\\ 

        \addlinespace[7pt]

        Introduction and deployment &
        Basic support in AUTOSAR since Nov. 2016, deployment in production vehicles just starting &
        DNSSEC first standardized in 1997, over 15 years of global deployment and operational experience\\
        
        \addlinespace[7pt]

        Target environment &
        Developed for local in-vehicle network &
        Hardened for global Internet deployment\\

        \addlinespace[7pt]

        Service discovery scheme & 
        Multicast \codeword{find}/\codeword{offer} messages &
        Unicast DNS \codeword{query}/\codeword{response} \\

        \addlinespace[7pt]

        Endpoint detail distribution &
        Provided initiated \codeword{offer} messages with the service runtime location &
        Consumer requested DNSSEC-signed SVCB records with pre-defined endpoint information \\

        \addlinespace[7pt]

        Authentication scheme &
        None by default, challenge-response~\cite{irrsvssvJR20,zlkkassJR21}, central authorization server~\cite{zlkkassJR21,myzzcascJR22} &
        Challenge-response during subscription \\ 

        \addlinespace[7pt]

        Certificate distribution &
        Pre-deployed public certificates on all participating nodes~\cite{irrsvssvJR20,zlkkassJR21,myzzcascJR22} &
        Consumer requested public certificates from DNSSEC-signed TLSA records \\

        \addlinespace[7pt]

        Certificate update procedure &
        No automated mechanism, requires simultaneous update of all cients and servers in workshop or OTA~\cite{irrsvssvJR20,zlkkassJR21} &
        Established mechanism for certificate management, including update and revocation\\

        \bottomrule
    \end{tabularx}
\end{table*}

\subsection{Key Features and Implications}\label{sec:discussion}

Table~\ref{tab:comparison} summarizes differences in key features between the proposed approach using DNSSEC and DANE, and the \ac{SOME/IP} \ac{SD} protocol.
\ac{SOME/IP} was initially released in 2016 as a module in the AUTOSAR platform and targets local in-vehicle networks.
\ac{DNSSEC} and \ac{DANE} are defined in RFCs by the IETF.
Our approach with \ac{DNSSEC} and \ac{DANE} leverages this technology with over 15 years of global deployment and operational experience on the Internet.
With this we gain the benefits of a tried, resilient and security hardened infrastructure.

The \ac{SOME/IP} \ac{SD} uses group communication, whereas the \ac{DNS} uses unicasts.
For \ac{DNS}-based discovery, this implies that multiple clients of the same server must all query the \ac{DNS} resolver separately, while with \ac{SOME/IP} \ac{SD}, a publisher can inform subscribers with a single multicast \codeword{offer}, reducing the network load.
An evaluation in a realistic automotive setup with a large number of services would show whether our approach introduces significant performance penalties, but we leave that open for future work.

Endpoint discovery in the \ac{SOME/IP} \ac{SD} uses \codeword{offer} messages initiated by the publisher, while with \ac{DNS}, the consumer queries the resolver directly.
This means that publishers can provide endpoint information during runtime with \ac{SOME/IP} \ac{SD}, but the \ac{DNS} resolver is not aware of the service runtime location.
This requires predefined IP addresses and ports for all service instances in \ac{DNS} records, which should be the same for all vehicles. 
However, this is not a problem within a local network where the IP addresses can be freely selected.
In turn, the \ac{DNS} records can be verified along the \ac{DNSSEC} trust chain, which is not possible for the endpoint information provided by the publisher.
This prevents malicious services to \codeword{offer} false endpoint information, for which there is no protection with \ac{SOME/IP} \ac{SD}.

There are no service authentication means in \ac{SOME/IP} \ac{SD} by default.
Previous work proposed using the public \ac{CA} model~\cite{irrsvssvJR20,zlkkassJR21} or a custom key management center~\cite{myzzcascJR22} to ensure the authenticity of public certificates pre-deployed on each node in an additional challenge-response handshake.
Our approach exploits the \ac{DNSSEC} and \ac{DANE} mechanisms as an established standard to ensure implicit certificate and service information authenticity through the \ac{DNSSEC} trust chain.
We integrate a challenge-response mechanism similar to the \ac{TLS} handshake into the \ac{SOME/IP} subscription process ensuring endpoint authenticity.
With this, we have to perform additional lookups in the \ac{DNS} to retrieve the certificate and the service information from an in-vehicle \ac{DNSSEC} resolver. 
In our benchmark, we evaluate the discovery latency showing that the certificate lookups do not introduce a significant overhead. 

A vital advantage in using \ac{DNSSEC} and \ac{DANE} mechanisms are the well-established certificate management procedures.
Easy online updates are performed by adding new records to the \ac{DNS} for the new version of the app and new keys on the publisher node can be deployed with a new version of the application.
This ensures that older versions can still use the old certificates while the already updated applications can use the new certificates.
In contrast, pre-deployed keys must be updated on every client and server node.
In case of certificate changes that also affect the private keys, the private key in question must be updated, both for pre-deployed certificates with SOME/IP and for certificates in TLSA records.

Previous work investigated attack vectors on the \ac{SOME/IP} {SD} protocol, such as \ac{MITM} attacks exploiting \codeword{offer} messages~\cite{zlkkassJR21}.
Our consumer-triggered discovery approach with known IP addresses from the \ac{DNS} is not affected by the identified attacks, although an attacker using ARP and IP spoofing could act as a malicious proxy altering the messages when no encryption or signature is used.
We assume that the local \ac{DNS} resolver is only accessible from the in-vehicle network and therefore not easily manipulated, which also prevents potential \ac{DoS} attacks from the outside.
Even if the uplink of the \ac{DNS} is jammed, the in-vehicle network communication can still operate.
However, if the vehicle is operated for an extended period of time without an Internet connection, the authenticity of the service cannot be guaranteed, as the certificates could expire or be revoked in the meantime.
\acp{SPOF} can be faced by replicating the local \ac{DNS} resolver as well as the external \ac{DNSSEC} server.

\begin{figure*}[t]
    \centering
    \begin{minipage}[t]{.485\textwidth}
        \input{tex/tikz-drawings/plot-discovery-latency.tex}
    \end{minipage}%
    \hspace{12pt}%
    \begin{minipage}[t]{.485\textwidth}
        \input{tex/tikz-drawings/plot-subscription-latency.tex}
    \end{minipage}%
\end{figure*}

\subsection{Evaluation Setup}
We measure the service discovery and subscription latency and the cost of the cryptographic operations.
We do not directly compare our solutions to~\cite{irrsvssvJR20,zlkkassJR21,myzzcascJR22} since we do not have access to their implementations, but we use similar cryptographic operations for authentication.
Compared to pre-deployed certificates~(cf.~\cite{irrsvssvJR20,zlkkassJR21}), the \ac{DNS} resolver is introduced as an additional instance~(cf.~\cite{zlkkassJR21,myzzcascJR22}) with \ac{DNSSEC} and the data authenticity is outsourced to the~\ac{DNSSEC}.
In doing so, we compare four different solutions, all of which are implemented based on the \textit{vsomeip}\cite{vsomeip-git} stack:
\begin{enumerate}
    \item \textbf{SOME/IP SD:} An unaltered \textit{vsomeip} implementation that we use as a baseline.
    \item \textbf{DNSSEC}: A \ac{DNSSEC} augmented \textit{vsomeip} that replaces the original \codeword{offer}/\codeword{find} procedure with our \ac{DNSSEC}-based consumer-triggered discovery.
    \item \textbf{DNSSEC w/ DANE} An authentication approach based on the \ac{DNSSEC} discovery implementation that uses \ac{DANE} records to retrieve the publisher certificate, and our challenge-response mechanism during the subscription phase to authenticate the publisher.
    \item \textbf{SOME/IP SD w/ AUTH}: An authenticated approach returning to the original \ac{SOME/IP} \ac{SD} without any \ac{DNS} operations that uses pre-deployed certificates and our challenge-response mechanism to authenticate the publisher.
\end{enumerate}

Our evaluation setup consists of three nodes for a client, a server and a DNSSEC resolver, which are arranged as shown in Figure~\ref{fig:someipsddnsmod}.
All nodes run on the same host system (CPU: AMD FX-8350 with 8 cores at 4Ghz, RAM: 16GB) in separate containers (\textit{Docker}: 20.10.22) connected via the Docker virtual bridge network.

The server and client containers run on a Linux OS with the \ac{SOME/IP} stack, and libraries for \ac{DNS} lookups and cryptography 
(\textit{Ubuntu}: 18.04.6 LTS, 
\textit{vsomeip}~\cite{vsomeip-git}: 3.1.20.3, 
\textit{Crypto++}~\cite{cryptopp-website}: 8.7.0, 
\textit{Crypto++ PEM Pack}: 8.2).
The \ac{DNSSEC} resolver runs on a Linux OS (\textit{Ubuntu}: 22.04.1 LTS, \textit{Unbound}: 1.17.0).

The DNS entries for the SVCB and TLSA records of the publisher service are already in the cache of the DNSSEC resolver and validated along the trust chain, as would be the case in an automotive deployment. 

As \ac{SOME/IP} uses group communication for service discovery, it applies common practices for scattering multicast communication to reduce the load on the network and hosts.
For example, responses can be delayed collecting multiple requests and answer them in a single response, and a random initial delay prevents all \acp{ECU} from flooding the network by sending discovery messages at the same time.
Since we compare it to standard \ac{DNS} discovery via unicast queries, which does not include any of such delays, we turn off the request-response delay in \textit{vsomeip} to get comparable results.
Moreover, we only look at the connection of one server and client, for which these mechanisms are not needed. 
However, the startup phases of \ac{SOME/IP} \ac{SD} remain unchanged, and thus a random initial delay between \SI{10}{\milli\second} and \SI{100}{\milli\second} delays the startup of the discovery phase.

\subsection{Discovery and Subscription Latency Benchmark}
Our benchmark evaluates the latencies of the discovery, subscription, and cryptographic operations. 
For each of the four compared solutions, we collect fifty samples with timestamps indicating the beginning and end of different phases to calculate the latency based on the difference between these timestamps.
Figure~\ref{fig:someipsd} and Figure~\ref{fig:someipsdaugdns} show the sequences of the consumer-triggered discovery and publish-subscribe phases for the \ac{SOME/IP} \ac{SD} and the \ac{DNS} discovery, respectively.

Figure~\ref{fig:sdlatency} shows the consumer-triggered discovery latency of all four different solutions.
Here, we measure the time that elapses from the completion of the initialization of the client until the result of the service discovery is available.
Since the measured interval for the discovery does not include authentication operations, the latency of the solutions with publisher authentication are expected to be the same as without publisher authentication.
The \ac{DNS} discovery latencies are between \SI{4}{\milli\second} and \SI{6}{\milli\second}.
Both \ac{SOME/IP} \ac{SD} variants have a latency between \SI{13}{\milli\second} and \SI{103}{\milli\second} due to the random initial delay between \SI{10}{\milli\second} and \SI{100}{\milli\second}.
Without an initial delay, the latency of the \ac{SOME/IP} \ac{SD} would be similar to that of the \ac{DNS} discovery.

Figure~\ref{fig:sublatency} shows the subscription latency of the four candidates.
We measure the time that elapses between the sending of the first subscription message and the completion of the connection setup, including the verification of the publisher signature in the authenticated approaches.
The solutions without publisher authentication have a latency under \SI{1}{\milli\second}.
With publisher authentication the latency is between \SI{4}{\milli\second} and \SI{9}{\milli\second}.
In detail, signing the nonce at the publisher takes between \SI{3}{\milli\second} and \SI{7}{\milli\second}, verifying the signature at the client side is below \SI{2}{\milli\second}.
The trade-off in using our challenge-response scheme results in a maximum delay of \SI{8}{\milli\second}.

Considering the overall discovery and subscription latency the publisher authentication does not have a significant impact on the latency, for which the multicast scattering is the most notable delay.
\ac{DNSSEC} and \ac{DANE} enable publisher authenticity without a large performance penalty even compared to authentication with pre-deployed certificates.
We achieve this by querying the TLSA record at the same time as we initiate the subscription.
However, the latency of the TLSA \codeword{response} containing the certificate depends on the link to the \ac{DNS} server.
This could impact the results when the DNS \codeword{query} takes longer than the subscription handshake.
Here, an evaluation with an Ethernet-connected \ac{DNS} server would be interesting to see the impact of the latency.
In addition, the performance for a larger number of services should be analyzed to determine scalability with \ac{DNS} discovery compared to \ac{SOME/IP} \ac{SD} in a realistic automotive network.
