\makeatletter
\def\qedmath{%
   \relax\ifmmode
      \@badmath
   \else
      \begin{trivlist}%
         \@beginparpenalty\predisplaypenalty
         \@endparpenalty\postdisplaypenalty
         \item[]\leavevmode
         \hbox to\linewidth\bgroup\relax\hfil$\displaystyle
            \bgroup
            \fi
            }
            \def\endqedmath{%
            \relax\ifmmode
            \egroup $\hfil \egroup\\[-\baselineskip]
         \hbox{}\hfill\llap{\phantom{0}\qed}
      \end{trivlist}
   \else
      \@badmath
   \fi
}
\def\qedflmath{\relax \ifmmode \@badmath
   \else\begin{trivlist}%
         \@beginparpenalty\predisplaypenalty
         \@endparpenalty\postdisplaypenalty
         \item[]\leavevmode \hb@xt@\linewidth\bgroup $\m@th\displaystyle %
            \hskip\mathindent\bgroup
            \fi}
            \def\endqedflmath{\relax\ifmmode
            \egroup $%
         \egroup \\[-\baselineskip]\hskip\linewidth\llap{\qed}
      \end{trivlist}%
   \else \@badmath
   \fi}
\makeatother

\newcommand{\todo}[1]{\textcolor{red}{\textbf{[TODO: #1]}}}
\newcommand{\cd}[1]{\textcolor{blue}{[CD: #1]}}
\newcommand{\meng}[1]{\textcolor{green}{[Meng: #1]}}
\newcommand{\weixin}[1]{\textcolor{purple}{[Weixin: #1]}}
\newcommand{\yijun}[1]{\textcolor{red}{[Yijun: #1]}}
\newcommand{\hanliang}[1]{\textcolor{orange}{[Hanliang: #1]}}
\definecolor{gold}{RGB}{218,165,32}

\newcommand{\name}{\textsc{Crown}\xspace}
\newcommand{\crust}{\texttt{c2rust}\xspace}


\newcommand{\boxptr}[1][]{
   \ifthenelse{ \equal{#1}{} }
      {\lstinline{Box}}
      {\lstinline{Box<{#1}>}}
}

\newcommand{\rawmut}[1][]{
   \ifthenelse{ \equal{#1}{} }
      {\lstinline{*mut}}
      {\lstinline{*mut {#1}}}
}

\newcommand{\rawconst}[1][]{
   \ifthenelse{ \equal{#1}{} }
      {\lstinline{*const}}
      {\lstinline{*const {#1}}}
}

\newcommand{\mutref}[1][]{
   \ifthenelse{ \equal{#1}{} }
      {\lstinline{&mut}}
      {\lstinline{&mut {#1}}}
}

\newcommand{\constref}[1][]{
   \ifthenelse{ \equal{#1}{} }
      {\lstinline{&}}
      {\lstinline{& {#1}}}
}

\newcommand{\optionboxptr}[1]{
   \lstinline{Option<Box<#1>>}
}

\newcommand{\optionmutref}[1]{
   \lstinline{Option<&mut #1>}
}

\newcommand{\optionconstref}[1]{
   \lstinline{Option<&#1>}
}


\newcommand{\mi}[1]{\ensuremath{\mathit{#1}}}
\newcommand{\mr}[1]{\ensuremath{\mathrm{#1}}}
\newcommand{\ms}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\mt}[1]{\ensuremath{\mathtt{#1}}}
\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}

\newcommand{\foreignWord}[1]{#1}

\newcommand{\eg}{\foreignWord{e.g.}}
\newcommand{\ie}{\foreignWord{i.e.}}
\newcommand{\cf}{\foreignWord{cf.}}
\newcommand{\etal}{\foreignWord{et al.}}
\newcommand{\wrt}{{w.r.t.}}



\newcommand{\Gl}{\lambda}
\newcommand{\Ga}{\alpha}
\newcommand{\Gb}{\beta}
\newcommand{\Gk}{\kappa}
\newcommand{\Gr}{\rho}
\newcommand{\Gs}{\sigma}
\newcommand{\GS}{\Sigma}
\newcommand{\Gt}{\tau}
\newcommand{\Gth}{\theta}
\newcommand{\GTH}{\Theta}
\newcommand{\GTh}{\Theta}
\newcommand{\Gg}{\gamma}
\newcommand{\GG}{\Gamma}
\newcommand{\Gd}{\delta}
\newcommand{\GD}{\Delta}

\newcommand{\x}{\times}
\newcommand{\ox}{\otimes}

\newenvironment{tarray}[2][c]{%
\settowidth{\dimen1}{${} = {}$}%
   \setlength{\arraycolsep}{0.125\dimen1}
   \hspace{-0.125\dimen1}\array[#1]{#2}\relax
}
{%
   \endarray\hspace{-0.125\dimen1}
}
\newcommand{\bb}{\tarray{lllll}}
\newcommand{\bbc}{\tarray{c}}
\newcommand{\bbt}{\tarray[t]{lllll}}
\newcommand{\bbb}{\tarray[b]{lllll}}
\newcommand{\ee}{\endtarray}

\newcommand{\from}{\leftarrow}
\newcommand{\To}[0]{\Rightarrow}
\newcommand{\From}{\Leftarrow}

\newcommand{\bba}{\alignedat{8}}
\newcommand{\bbat}{\alignedat[t]{8}}
\newcommand{\eea}{\endalignedat}

\newcommand{\APPEND}{\mathbin{+\!+}}

\newcommand{\DOLLAR}{\ensuremath{\mathbin{\texttt{\$}}}}
\newcommand{\key}[1]{\ensuremath{\mathbf{#1}}} %
\newcommand{\api}[1]{\ensuremath{\mathsf{#1}}} %

\newcommand{\DATA}{\key{data}}
\newcommand{\TYPE}{\key{type}}
\newcommand{\WHERE}{\key{where}}
\newcommand{\CASE}{\key{case}}
\newcommand{\CASEEX}[3]{\CASE~#1~\OF #2 \bbt #3 \ee}

\newcommand{\WITH}{\key{with}}
\newcommand{\RECONCILED}{\key{reconciled}}
\newcommand{\BY}{\key{by}}
\newcommand{\OF}{\key{of}}
\newcommand{\DO}{\key{do}}
\newcommand{\LET}{\key{let}}
\newcommand{\IN}{\key{in}}

\newcommand{\dontcare}{%
   \settowidth{\dimen2}{v}%
   \hspace{0.05\dimen2}\rule{0.9\dimen2}{0.5pt}\hspace{0.05\dimen2}}
\newcommand{\A}{\;}

\newcommand{\IF}{\key{if}}
\newcommand{\THEN}{\key{then}}
\newcommand{\ELSE}{\key{else}}
\newcommand{\shortequals}{%
   {\rlap{\rule[0.14em]{.25em}{0.5pt}}{\rule[0.34em]{.25em}{0.5pt}}}
}

\newcommand{\doubleequals}{\ensuremath{\mathrel{%
         \shortequals\,\shortequals}}}
\newcommand{\ndoubleequals}{%
   \ensuremath{\not\expandafter\doubleequals}}

\newcommand{\LCOMMENT}[1]{\texttt{-{}-}~\text{#1}}
\newcommand{\COMMENT}[1]{\texttt{\{-}~\text{#1}~\texttt{-\}}}

\makeatletter
\newcounter{pe@nocounter}
\newcommand{\peano}[1]{%
   \setcounter{pe@nocounter}{#1}
   \pe@no}
\newcommand{\pe@no}{%
   \ifnum\value{pe@nocounter}>1
      \addtocounter{pe@nocounter}{-1}%
      \con{S} \A (\expandafter\pe@no)%
   \else%
      \ifnum\value{pe@nocounter}>0%
         \con{S} \A \con{Z}%
      \else%
         \con{Z}%
      \fi%
   \fi%
}

\newcommand{\con}[1]{\ms{#1}}
\newcommand{\var}[1]{\mi{#1}}

\newcommand{\str}[1]{\texttt{"#1"}}
\newcommand{\chr}[1]{\texttt{'#1'}}

\newcommand{\lub}{\curlyvee}

\newcommand{\V}[1]{\overline{#1}}
\newcommand{\Size}[1]{\lvert{#1}\rvert}

\newcommand{\fv}{\mathrm{fv}}
\newcommand{\dom}{\mathrm{dom}}

\definecolor{bxcolor}{rgb}{0.05,0.15,0.76}

\makeatletter
\newif\ifbxgrayed@ut
\newcommand{\grayout}{\bxgrayed@uttrue\color{gray}}
\newcommand{\grayoutend}{\bxgrayed@utfalse}

\newcommand{\bxcolor}{\ifbxgrayed@ut\color{gray}\else\color{bxcolor}\fi}
\newcommand{\textbxcolor}[1]{\ifbxgrayed@ut\textcolor{gray}{#1}\else\textcolor{bxcolor}{#1}\fi}

\newcommand{\bx}[1]{{\bxcolor\underline{#1}}}
\newcommand{\BX}[1]{{\bxcolor\mathbf{B}{#1}}}
\newcommand{\LIFTU}[1]{{{\bxcolor!}#1}}

\makeatother

\newcommand{\bxkey}[1]{\bx{\key{#1}}}
\newcommand{\bxcon}[1]{\bx{\con{#1}}}
\newcommand{\bxop}[1]{\mathbin{\bx{#1}}}

\newcommand{\bxtup}[1]{\bx{(}#1\bx{)}}

\newcommand{\BCASE}{\bxkey{case}}
\newcommand{\BLET}{\bxkey{let}}
\newcommand{\BIN}{\bxkey{in}}
\newcommand{\BOF}{\bxkey{of}}
\newcommand{\BWITH}{\bxkey{with}}
\newcommand{\BBY}{\bxkey{by}}


\newcommand{\ninfer}[3]{\infer{#2}{#3}\,\text{(\rname{#1})}}
\newcommand{\rname}[1]{\textsc{#1}}

\newcommand{\GET}{\mathit{get}}
\newcommand{\PUT}{\mathit{put}}

\newcommand{\evalU}{\Downarrow}
\newcommand{\evalB}{\Leftarrow}
\newcommand{\evalF}{\Rightarrow}

\newcommand{\EvalRelU}[2]{#1 \evalU #2}
\newcommand{\EvalRelF}[3]{#1 \vdash_\mathrm{G} #2 \evalF #3}
\newcommand{\EvalRelB}[4]{#1 \vdash_\mathrm{P} #2 \evalB #3 \dashv #4}

\newcommand{\sem}[1]{\llbracket#1\rrbracket}

\newcommand{\ExSet}{\mathcal{E}}
