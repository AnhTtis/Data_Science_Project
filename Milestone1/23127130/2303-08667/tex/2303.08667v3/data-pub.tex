%
%
%
%
%

\documentclass[fleqn,10pt]{wlscirep}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lineno}
%

\input{sections/package-imports}
\input{sections/commands-settings}
\input{sections/nomenclature}
\input{sections/tikzStuff}
\input{sections/dateTimeStuff}

%

%
\title{ZTBus: A Large Dataset of Time-Resolved City Bus Driving Missions}

\author[1,$\dag$,*]{Fabio Widmer}
\author[1,$\dag$]{Andreas Ritter}
\author[1]{Christopher H.\ Onder}
\affil[1]{ETH Zurich, Institute for Dynamic Systems and Control, Zurich, 8092, Switzerland}

\affil[*]{Corresponding author: Fabio Widmer (fawidmer@idsc.mavt.ethz.ch)}
\affil[$\dag$]{These authors contributed equally to this work}

\begin{abstract}
%
This paper presents the \ac{ZTBus} dataset, which consists of data recorded during driving missions of electric city buses in Zurich, Switzerland.
The data was collected over several years on two trolley buses as part of multiple research projects.
It involves more than a thousand missions across all seasons, each mission usually covering a full day of operation.
The \ac{ZTBus} dataset contains detailed information on the vehicle's power demand, propulsion system, odometry, global position, ambient temperature, door openings, number of passengers, dispatch patterns within the public transportation network, etc.
All signals are synchronized in time and include an absolute timestamp in tabular form.
The dataset can be used as a foundation for a variety of studies and analyses.
For example, the data can serve as a basis for simulations to estimate the performance of different public transit vehicle types, or to evaluate and optimize control strategies of hybrid electric vehicles.
Furthermore, numerous influencing factors on vehicle operation, such as traffic, passenger volume, etc., can be analyzed in detail.
%
\end{abstract}
\begin{document}

\flushbottom
\maketitle

\thispagestyle{empty}

\section*{Background \& Summary}
%
Public transportation is an effective solution for reducing traffic in growing cities.
It significantly reduces the number of vehicles on the road, resulting in less congestion, shorter travel times, minimal ecological footprint, and reduced overall energy consumption.
In the near future, the need for such efficient urban transportation systems is likely to increase, as an estimated two-thirds of the world's population is expected to live in cities by 2050\cite{UN:2014pe}.

%
In this context, detailed driving and operational data are of great value to assist cities and transportation operators in making informed decisions on the vehicles' ideal propulsion technology and charging strategy for the respective public transportation network.
Furthermore, for the development and tuning of intelligent vehicle state estimation algorithms or energy management strategies, time-resolved data of the traction system is necessary for both the vehicle manufacturers and the research community.
%
While there are publicly available datasets describing urban traffic conditions and human mobility\cite{Mon:2022jd,Huang:2019eg,Feng:2019dh}, as well as time-series data of personal cars\cite{Oh:2022jj,Zhang:2022sy,Calearo:2021px} or taxis\cite{Piorkowski:2009cm}, publicly available time-series data of urban transit buses is lacking.

%
The goal of this publication is to fill this gap by presenting the \ac{ZTBus} dataset \cite{ZTBus}, which is composed of data recorded throughout the course of the projects \SwissTrolleyPlus\cite{Ritter:2019en} and ISOTHERM\cite{Widmer:2023yp}, both of which were collaborations between industry partners and public research institutions and were financially supported by the \ac{SFOE}.
The dataset covers more than a thousand driving missions of two trolley buses that were in operation between \datetime{2019-04}{} and \datetime{2022-12}{}.
It consists of detailed time series that represent the power demand, propulsion system, odometry, global position, ambient temperature, door openings, number of passengers, and the dispatch patterns within the public transportation network of the two vehicles.
The time series are provided in a synchronized form and are sampled every second.
Aggregated quantities for each of the missions are provided in a metadata table.
A schematic overview of the data acquisition and curation procedure, which is explained in greater detail below, is shown in \cref{fig:acquisition}.
\Cref{fig:meta-fig} presents the full extent of the dataset.

\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{img/method/data-pub-method-overview.drawio.pdf}
\caption{Data acquisition and curation.
Signals from three different sources, i.e., the \glsfmtfirst{VCU}, the \glsfmtfirst{GNSS} antenna, and the passenger counting system, are used in the definition of the driving missions.
Various filtering steps are added to reject erroneous and unrepresentative data.
Finally, time synchronization and sampling are performed to present the data in a tabular format.
}
\label{fig:acquisition}
\end{figure}

\begin{figure}
\centering
\input{img/meta-fig/meta-fig}
\caption{Visualization of the extent of the \glsfmtshort{ZTBus} dataset \cite{ZTBus}, which includes a total of \totNumberOfMissions driving missions over the period of over 3.5 years between \datetime{2019-04}{} and \datetime{2022-12}{}.
}
\label{fig:meta-fig}
\end{figure}

This data offers the potential to be used in a broad variety of fields.
For example, the time-resolved \ac{GNSS} data can be combined with odometry signals, such as the wheel speeds and the steering angle, and processed using sensor fusion approaches.
Such algorithms can significantly improve the raw pose estimates provided by the \ac{GNSS} sensor, and facilitate the use of dead reckoning approaches in case of momentary signal outage.
Additionally, the large amount of data on a set of given routes is suitable for the examination of algorithms for trajectory filtering and map matching in machine learning contexts.

Machine learning may also be utilized to predict various influence factors in public transportation, such as the number of passengers that travel a certain distance at a given time, the traffic levels on specific roads and at specific times of the day, or the expected speed profiles of the vehicles in the near future or in general on certain road segments.

Finally, the aggregated data enables the examination of long-term correlations such as the impact of COVID-19 mitigation measures on passenger numbers, the effect of weather conditions on energy consumption, etc.

The dataset presented in this manuscript has been used in several of our own publications in the context of the research activities mentioned above:
\begin{enumerate-inline}
\item The position, odometry, and velocity data served to develop and evaluate a real-time incremental graph construction algorithm\cite{Ritter:2021ex}.
\item Time-resolved speed, torque, and braking pressure signals were used for the development of the model-based vehicle mass and road grade estimation method\cite{Ritter:2021aa}.
\item The spatio-temporal nature of the power request signal was used to quantify the relation between grid and battery energy usage on certain road segments, which then served to derive a stochastic model predictive control approach\cite{Ritter:2021bb}.
\item The optimal design and control of a thermal energy buffer in an electric city bus was studied based on the passenger loads, velocity and elevation profiles\cite{Widmer:2022xt}.
\item A set of 16 representative all-day driving missions served to optimize the bus operation in terms of managing battery degradation throughout the vehicle lifetime\cite{Widmer:2023yf}.
\item Hourly-averaged data was used to conduct a large-scale sensitivity analysis of the thermal comfort systems, allowing a comparison of various \ac{HVAC} systems\cite{Widmer:2023rj}.
\end{enumerate-inline}

%

\section*{Methods}

\subsection*{Data Collection}

The \ac{ZTBus} dataset \cite{ZTBus} was recorded on two trolley buses during regular operation by \ac{VBZ}.
Both are \enquote{HESS lighTram\textregistered{} 19 DC} buses, which are single-articulated, have an overall length of about \SI{19}{\meter}, a curb weight of about \SI{19}{\tonne}, and a maximum passenger capacity of about 160.
They are equipped with traction batteries, which allow them to run for a few kilometers without the overhead power grid.
The dataset covers the operation of the buses on various bus routes in Zurich's public transportation network, which are visualized in \cref{fig:routes-overview}.

\begin{figure}
\centering
\input{img/routes-overview/routes-overview.tex}
\caption{Path of the nine bus routes covered by the dataset.
The route data is publicly available \cite{gtfs}.
Map data \copyright{}2023 Google.
}
\label{fig:routes-overview}
\end{figure}

The data included in the \ac{ZTBus} dataset \cite{ZTBus} originates from the three systems described below and schematically shown in \cref{fig:acquisition}.
It is recorded via onboard logging systems specifically developed for that purpose.

\begin{enumerate}
\item The majority of the data is provided by the \ac{VCU} to which the raw measurement data is directly transmitted via multiple \ac{CAN} buses from the various vehicle components.
As this data is used during the normal operation of the bus, these signals are always available if the attached logging system works as intended.

\item The data related to the global positioning of the vehicles is provided by a \ac{GNSS} antenna mounted on their roofs.
The \ac{GNSS} data may be temporarily unavailable if no reliable connection to the satellites can be established, which may be the case, e.g., during bad weather, between tall buildings, or in underpasses.

\item The passenger counts are estimated via onboard infrared-based passenger counting systems that transmit their estimates to the public transportation operator's server computer via the local cellular network.
This data is then automatically synchronized and augmented with the data from the \ac{ITCS}, i.e., the corresponding bus route number and stop names.
We refer to this combined data as \enquote{\acs{ITCS} data}.
\end{enumerate}

The data is organized in \enquote{driving missions}, which we define as the entire period from the moment the bus is switched on until the moment it is switched off.

\subsection*{Selection of Data Records}

To ensure that the dataset meets the requisite integrity and quality standards, we include only those records that represent complete driving missions during regular public transportation operation.
For example, we reject test drives, short trips within depots, and missions that are completely missing any data from the three systems described above.
The details of this selection step are described in the section on technical validation below.

\subsection*{Processing}

We aim to reduce the processing of data to a minimum.
In particular, instead of applying sophisticated filtering and smoothing techniques, we publish the raw measurement data received from the sensory devices, which allows its use for the development or tuning of such smoothing and filtering algorithms as well.
The processing steps that were nevertheless considered necessary and were carried out are as follows:

\begin{itemize}
\item On our vehicles, the most accurate indicator of the vehicle speed is provided by the rotational speed sensors mounted on the motor shafts.
As we aim to present our data in a manner that is independent of the vehicle's specific drivetrain, we use an estimate of the \enquote{compound} transmission ratio \transmissionRatio to convert the rotational speed measurements \motorSpeed to the longitudinal vehicle speed \speed:
\begin{linenomath*}
\begin{equation}
\speed = \frac{\motorSpeed}{\transmissionRatio} \,.
\label{eq:speed}
\end{equation}
\end{linenomath*}
The compound transmission ratio thus combines the effects of the transmission, final drive, and wheel radius.
For estimating \transmissionRatio, we analyze measurement data of perfectly straight driving sections, where the traveled distance according to filtered \ac{GNSS} data is compared to the total angle covered by the electric machine.
Note that we use the rotational speed measurements of the motor at the middle axle for the calculation of the travel speed in \cref{eq:speed}.
That way, errors induced due to offtracking during tight turns are minimized.
The estimated transmission ratio is also used to calculate the traction force
\begin{linenomath*}
\begin{equation}
\tractionForce = \transmissionRatio \cdot \tractionTorque \,,
\label{eq:torque}
\end{equation}
\end{linenomath*}
where \tractionTorque represents the total torque provided by the electric machines.
Since the vehicle acceleration in city buses is generally low so as to allow for a comfortable ride even for standing passengers, our experience shows that the error induced by tire slip is typically negligible.

\item To focus on the valuable information recorded between the initial departure and the final arrival of each driving mission, we discard any data recorded more than \SI{1}{\minute} before and more than \SI{1}{\minute} after the actual driving.

\item When combining numbers of passengers (estimated by the on-board infrared-based counting systems) with bus route and stop names (provided by the \ac{ITCS}), some inconsistencies are filtered out by the public transportation operator.
For example, trips are discarded if the total number of passengers boarding differs too much from the total number of passengers alighting throughout one trip, or if a recorded trip cannot be uniquely matched to a trip in the \ac{ITCS} database.
To exclude any remaining erroneous \ac{ITCS} data, which may occur, for instance, when stops are skipped, we use the locations of the reported stops according to publicly available \ac{GTFS} data \cite{gtfs} and compare them to the location estimates provided by the \ac{GNSS} sensors.
If the locations are farther than \SI{100}{\meter} apart for at least three stops in a row, the \ac{ITCS} data associated with these stops is discarded.

\item Finally, the data from the three different sources introduced above, i.e., the \ac{VCU}, \ac{GNSS}, and the \ac{ITCS}, is synchronized and resampled.
For this purpose, we first generate a new date-time vector in \ac{UTC} with a uniform sampling period of \SI{1}{\second} covering the time window highlighted above.
The signals are then mapped to this time vector as follows:
\begin{itemize}
\item The \ac{ITCS} data is only given at discrete time events approximately matching the moments the bus is leaving a stop.
As the processing of the raw data is to be kept to a minimum, the \ac{ITCS} data is not interpolated.
Instead, the nearest sample times of the new date-time vector are identified and the discrete values are mapped accordingly.

\item All binary (status) signals are interpreted as piecewise constant signals and are thus resampled via previous neighbor interpolation.

\item All other signals are linearly interpolated.
\end{itemize}
\end{itemize}

\section*{Data Records}

The \ac{ZTBus} dataset is published on the repository for publications and research data of ETH Zurich \cite{ZTBus}.
It is organized in two different types of \ac{CSV} text files, the first of which describes the \totNumberOfMissions individual driving missions, while the second contains metadata of all driving missions.

The names of the files that describe the individual driving missions are based on the vehicle identification number (either 183 or 208) and the time period in which the data was collected.
For example, the data collected on the bus numbered 183 between \datetime{2019-10-16}{02:52:43} and \datetime{2019-10-16}{07:10:12}, both given in \ac{UTC}, is available in the following file:
\begin{quote}
\verb|B183_2019-10-16_02-52-43_2019-10-16_07-10-12.csv|
\end{quote}
The metadata describing all driving missions is provided as \verb|metaData.csv|.

\subsection*{Detailed Description of the Time-Resolved Measurement Data}

The \ac{ZTBus} dataset \cite{ZTBus} consists of \totNumberOfMissions driving missions, each of which is described in a separate \ac{CSV} file.
All files have the same structure and format, where the first row contains the headers of the corresponding columns and the remaining rows describe the set of data samples recorded at a specific moment in time.
This time index is represented in the first column as absolute \ac{UTC} time, expressed according to ISO 8601.

The columns are described in \cref{tab:missions}, where \NaN represents unavailable data, unless specified otherwise.

\begin{table}
\centering
\scriptsize
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|l|l|c|p{10cm}|}
\hline
\rowcolor{table-header-color}
\textbf{Column name} & \textbf{Data type} & \textbf{Unit} & \textbf{Description} \\\hline
\verb|time_iso| & datetime && The absolute UTC time, expressed according to ISO 8601.
\\\hline

\verb|time_unix| & integer & \SI{}{\second} & The Unix timestamp, i.e., the number of seconds passed since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|electric_powerDemand| & float & \SI{}{\watt} & The overall electric power demand of the vehicle.
The values include the power demand of the traction motors (which can be negative during recuperation phases) and all auxiliary power consumers like \ac{HVAC}, air compressor, lighting, infotainment systems, etc.
\\\hline

\verb|gnss_altitude| &float & \SI{}{\meter} & The altitude above sea level measured by the \ac{GNSS} sensor.
\\\hline

\verb|gnss_course| &float & \SI{}{\radian} & The course (heading) provided by the \ac{GNSS} sensor.
Traveling north is represented by a course of \SI{0}{\radian} or \SI[parse-numbers=false]{\text{$2 \pi$}}{\radian}.
Traveling east is represented by a value of \SI[parse-numbers=false]{\text{$\sfrac{\pi}{2}$}}{\radian}.
When the bus is not moving, this estimate is held constant by the \ac{GNSS} sensor on bus 183 and set to zero on bus 208.
\\\hline

\verb|gnss_latitude| & float & \SI{}{\radian} & The latitude on WGS~84 measured by the \ac{GNSS} sensor.
\\\hline

\verb|gnss_longitude| & float & \SI{}{\radian} & The longitude on WGS~84 measured by the \ac{GNSS} sensor.
\\\hline

\verb|itcs_busRoute| & string && The \ac{VBZ} bus route name, provided by the \ac{ITCS}.
For unavailable data, we use a dash (\enquote{--}).
\\\hline

\verb|itcs_numberOfPassengers| & float & -- & The estimated number of passengers on the bus, measured with infrared-based passenger counting systems.
\\\hline

\verb|itcs_stopName| & string && The name of the bus stop served, provided by the \ac{ITCS}.
For unavailable data, we use a dash (\enquote{--}).
\\\hline

\verb|odometry_articulationAngle| & float & \SI{}{\radian} & The angle of the pivoting joint (articulation).
A positive angle is observed in a right turn.
\\\hline

\verb|odometry_steeringAngle| & float & \SI{}{\radian} & The angle of the front wheels relative to the vehicle body.
A positive angle is observed in a left turn.
\\\hline

\verb|odometry_vehicleSpeed| & float & \SI{}{\meter\per\second} & The vehicle speed.
This value is based on the rotational velocity of the drive shaft of the middle axis and a compound transmission ratio according to \cref{eq:speed}.
\\\hline

\verb|odometry_wheelSpeed_fl| & float & \SI{}{\meter\per\second} & The wheel speed of the front left wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_fr| & float & \SI{}{\meter\per\second} & The wheel speed of the front right wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_ml| & float & \SI{}{\meter\per\second} & The wheel speed of the middle left wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_mr| & float & \SI{}{\meter\per\second} & The wheel speed of the middle right wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_rl| & float & \SI{}{\meter\per\second} & The wheel speed of the rear left wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_rr| & float & \SI{}{\meter\per\second} & The wheel speed of the rear right wheel, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|status_doorIsOpen| & boolean && A binary flag indicating whether at least one door is open.
\\\hline

\verb|status_gridIsAvailable| & boolean && A binary flag indicating whether the current collector of the trolley bus is connected to the overhead grid.
\\\hline

\verb|status_haltBrakeIsActive| & boolean && A binary flag indicating whether the halt brake is active.
This brake is automatically activated whenever the bus stands still.
\\\hline

\verb|status_parkBrakeIsActive| & boolean && A binary flag indicating whether the park brake is active.
This fail-safe brake works also if the vehicle is not powered.
It can be manually activated by the driver, e.g., for longer standstill periods.
\\\hline

\verb|temperature_ambient| & float & \SI{}{\kelvin} & The measured ambient temperature.
The temperature sensor is located behind the front bumper.
Due to the sensor resolution, it is only available in increments of \SI{1}{\kelvin}.
\\\hline

\verb|traction_brakePressure| & float & \SI{}{\pascal} & The mean pressure in the friction braking lines.
\\\hline

\verb|traction_tractionForce| & float & \SI{}{\newton} & An estimate of the overall traction force provided by the two traction motors.
These values are based on an estimate of the traction torque provided by the two traction motors and a compound transmission ratio according to \cref{eq:torque}.
\\\hline
\end{tabular}
\caption{Column descriptions of the driving mission tables.
The unit column is left blank for non-numeric data types.
}
\label{tab:missions}
\end{table}

\subsection*{Detailed Description of the Metadata}

The metadata of the driving missions is tabulated as described in \cref{tab:metadata}.
The first row contains the headers of the corresponding columns.
The remaining rows contain metadata of the driving missions, indexed via the corresponding file name in the first column.

\begin{table}
\centering
\scriptsize
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|l|l|c|p{10cm}|}
\hline
\rowcolor{table-header-color}
\textbf{Column name} & \textbf{Data type} & \textbf{Unit} & \textbf{Description} \\\hline
\verb|name| & string && The name of the data file represented by the corresponding row of the metadata table.
\\\hline

\verb|busNumber| & integer & -- & The number of the bus on which the data was recorded (183 or 208).
\\\hline

\verb|startTime_iso| & datetime && The absolute \ac{UTC} time of the start of the driving mission, expressed according to ISO 8601.
\\\hline

\verb|startTime_unix| & integer & \SI{}{\second} & The Unix timestamp of the start of the driving mission, in seconds since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|endTime_iso| & datetime && The absolute \ac{UTC} time of the end of the driving mission, expressed according to ISO 8601.
\\\hline

\verb|endTime_unix| & integer & \SI{}{\second} & The Unix timestamp of the end of the driving mission, in seconds since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|drivenDistance| & float & \SI{}{\meter} & The distance covered during the entire driving mission.
This value is calculated via trapezoidal integration of the time series \verb|odometry_vehicleSpeed|.
\\\hline

\verb|busRoute| & string && The most frequently occurring value of the time series \verb|itcs_busRoute|.
\\\hline

\verb|energyConsumption| & float & \SI{}{\joule} & The overall electric energy consumption of the vehicle during the entire driving mission.
This value is calculated via trapezoidal integration of the time series \verb|electric_powerDemand|.
\\\hline

\verb|itcs_numberOfPassengers_mean| & float & -- & The average number of passengers in the bus, i.e., the mean value of the time series \verb|itcs_numberOfPassengers|, where \NaN values are omitted.
\\\hline

\verb|itcs_numberOfPassengers_min| & float & -- & The minimum number of passengers in the bus, i.e., the minimum value of the time series \verb|itcs_numberOfPassengers|, where \NaN values are omitted.
\\\hline

\verb|itcs_numberOfPassengers_max| & float & -- & The maximum number of passengers in the bus, i.e., the maximum value of the time series \verb|itcs_numberOfPassengers|, where \NaN values are omitted.
\\\hline

\verb|status_gridIsAvailable_mean| & float & -- & The fraction of time the bus is connected to the overhead grid, i.e., the mean value of the time series \verb|status_gridIsAvailable|.
\\\hline

\verb|temperature_ambient_mean| & float & \SI{}{\kelvin} & The average ambient temperature, i.e., the mean value of the time series \verb|temperature_ambient|, where \NaN values are omitted.
\\\hline

\verb|temperature_ambient_min| & float & \SI{}{\kelvin} & The minimum ambient temperature, i.e., the minimum value of the time series \verb|temperature_ambient|, where \NaN values are omitted.
\\\hline

\verb|temperature_ambient_max| & float & \SI{}{\kelvin} & The maximum ambient temperature, i.e., the maximum value of the time series \verb|temperature_ambient|, where \NaN values are omitted.
\\\hline
\end{tabular}
\caption{Column descriptions of the metadata table.
The unit column is left blank for non-numeric data types.
}
\label{tab:metadata}
\end{table}

\section*{Technical Validation}

In this section, we explain the various measures we have taken to ensure the requisite integrity and quality of the \ac{ZTBus} dataset \cite{ZTBus}.
In particular, we have developed the following selection criteria.
\begin{itemize}
\item We start by considering only records without any known issues in the logging toolchain, i.e., issues such as erroneous timestamps, or bugs in any of the involved software components.
For this initial selection, we additionally reject records with corrupt file contents.
Furthermore, we only consider records that span a time interval of at least \SI{1}{\hour} each, as all shorter records do not represent any regular public transportation operation.
This initial selection contains a total of 2046 missions.
%
%
%
\item We reject missions where either \ac{VCU}, \ac{GNSS}, or \ac{ITCS} data is unavailable throughout the entire mission, which reduces the dataset by 189 missions.
%
%
%
\item If we detect a gap of at least \SI{10}{\second} in any of the \ac{VCU} data, we reject the data of the entire mission, as this hints at a potential issue either in the logging toolchain or with the onboard clock.
Such a gap is detected in 13 missions.
%
\item During normal operation, the bus is expected to be at a standstill for some time at both the beginning and the end of each record.
If this is not the case, parts of the logging toolchain may have failed to start in time or might have terminated unexpectedly.
Thus, we reject 152 missions, where the bus operation does not meet this standstill criterion.
%
\item In some of the records, the bus is found to be not driving at all.
This might happen, for instance, if the bus is started during maintenance work.
As such records do not represent a regular public transportation operation, they are rejected.
This reduces the dataset by 42 missions.
%
\item To exclude any test drives and short missions to, from, or within a depot, we require each driving mission to last at least \SI{3}{\hour}.
This reduces the dataset by 211 missions.
%
\item During regular operation on the trolley bus routes covered in this dataset, no prolonged standstills are to be expected.
Therefore, we filter all missions with any standstill time of more than \SI{30}{\minute}.
This reduces the dataset by 30 missions.
%
\end{itemize}
%

The selection criteria listed above were established iteratively over the years that we have been working on the data.
We believe that these simple criteria are adequate to consistently remove all data records that are contaminated due to software malfunction or that are not representative of a regular public transportation operation, such as drives within a garage or to a workshop.
In the following two subsections, we provide some visualizations of the data in the \ac{ZTBus} dataset \cite{ZTBus}.
These visualizations offer valuable insights into the dataset's contents and quality.
Additionally, they help identify anomalies and outliers, thus guiding the determination of the data selection steps discussed above.

\subsection*{Time Series Inspection}

Throughout the activities within our research projects\cite{Ritter:2019en,Widmer:2023yp}, we visually analyzed hundreds of time windows that are similar to the one shown in \cref{fig:fast-timescale}.
Such visualizations reveal, for example, the consistency of the wheel speed signals w.r.t.\ the steering and articulation angles.
In particular, a left turn is evident at around second 40, with a negative articulation angle and a positive steering angle, according to the definitions given in \cref{tab:missions}.
Accordingly, as expected in a left turn, the right front wheel turns slightly faster than the left.

\begin{figure}
\centering
\input{img/fast-timescale/fast-timescale.tex}
\caption{Detailed view on example time series recorded in the morning of \datetime{2021-03-07}{} on bus numbered 183 on route~72 of \glsfmtshort{VBZ}.}
\label{fig:fast-timescale}
\end{figure}

A slightly coarser time scale is used in \cref{fig:stops}, which visualizes the proper synchronization of the \ac{VCU} signals with the \ac{ITCS} signals.
This figure shows that the times at which the stop names and the passenger counts are reported correspond to the times at which the bus departs from the respective stops.

\begin{figure}
\centering
\input{img/stops/stops.tex}
\caption{Exemplary \glsfmtshort{ITCS} data aligned with the speed profile recorded in the morning of \datetime{2021-03-07}{} on the bus numbered 183 on route~72 of \glsfmtshort{VBZ}.
The names of the bus stops are shown above the graph.
The areas shaded in gray indicate that at least one door is open.
}
\label{fig:stops}
\end{figure}

Some signals are best visualized over the course of the daily operation of a bus, as exemplified in \cref{fig:slow-timescale}.
The repetitive nature of the driving profile is clearly observable in both the pronounced elevation profile of the depicted bus route~72 and the passenger volume.
The measured ambient temperature indicates on the one hand that the bus started its mission directly from a depot whose temperature lies significantly above the outside temperature, and on the other hand that the thermal inertia experienced by the sensor is quite significant due to its placement behind bodywork.
Due to the sensor resolution, the temperature is only available in increments of \SI{1}{\kelvin}.
However, as a result of the linear interpolation used during processing, the dataset may contain single temperature values between these increments.

\begin{figure}
\centering
\input{img/slow-timescale/slow-timescale.tex} 
\caption{Example time series recorded throughout the day on \datetime{2021-03-07}{} on the bus numbered~183 on \glsfmtshort{VBZ} route~72.}
\label{fig:slow-timescale}
\end{figure}

The \ac{GNSS} data deliberately was not modified and is provided as raw data, except for the linear interpolation necessary for time synchronization.
Therefore, the data might be noisy or imprecise in some locations or may be missing completely during certain time windows.
Hence, for certain types of applications, such data may have to be excluded or pre-processed by applying dedicated smoothing or filtering algorithms.
Conversely, incomplete and imprecise data can be used as valuable training or validation data, e.g., for dead-reckoning and map-matching algorithms.
Anyways, the \ac{GNSS} data is mostly of good quality, as the exemplary visualization in \cref{fig:geo-plot} clearly shows.
Despite the complicated installation of the overhead infrastructure and the footbridges around the crossing depicted, the quality of the raw measurements is by far sufficient to determine which roads were taken.

\begin{figure}
\centering
\input{img/geo-plot/geo-plot.tex}
\caption{Example \glsfmtshort{GNSS} trajectories of 7 outbound and return trips each, recorded on \datetime{2021-03-07}{} around Bucheggplatz in Zurich, Switzerland.
The square is an important transportation hub in the center of Zurich, connecting two tram routes, two bus routes, and three trolley bus routes.
Map data \copyright{}2023 Google.}
\label{fig:geo-plot}
\end{figure}

\subsection*{Statistical Analysis}

In order verify and validate the integrity of the individual signals, we perform a rudimentary statistical analysis on the large amount of collected data.
In particular, we examine a multitude of histograms, three of which exemplified in \cref{fig:histograms}.
Such an analysis of the respective minimum, mean, and maximum values of all driving missions lends itself to detect anomalies and outliers relatively quickly.
These visualizations were a helpful tool in the development of the selection criteria mentioned above.

An inspection of the three histograms shown in \cref{fig:histograms} reveals that the vehicle speed is slightly negative in some situations.
This typically occurs when the vehicle is starting or stopping.
From experience, we also know that the average speed of a transit bus in Zurich is around \SI{15}{\kilo\meter\per\hour}, while the maximum speed rarely exceeds \SI{65}{\kilo\meter\per\hour}.
These facts are well represented and confirmed in the dataset.
The distinct peaks shown in the maximum and minimum power demand levels are mainly due to the combined power capacity of the two electric motors of the buses, which is around \SI{320}{kW} for both negative and positive values.
Assuming some auxiliary power consumption in the range of \SIrange{20}{30}{kW}, these power limits perfectly explain the peaks observed at around $\SI{-300}{kW}$ and \SI{350}{kW}, respectively.
The average power demand is in the range of \SIrange{15}{35}{\kilo\watt}, which corresponds to the expected range of \SIrange{1.5}{2.0}{\kilo\watt\hour\per\kilo\meter} for transit buses driving at the mean vehicle speed mentioned above.
Finally, the distribution of the number of passenger shows that the average occupation ranges between 10 and 30 people.
On most missions, the vehicle is both empty and about half full at least once.

\begin{figure}
\centering
\includegraphics{img/histograms/fig8-histograms}
\cprotect\caption{Example histograms granting a representative overview of all data values contained in the dataset.
Each of the three categories \enquote{min}, \enquote{mean}, and \enquote{max} refers to the corresponding values of all driving missions, visualized as a histogram.
For example, the data values shown for the minimum vehicle speed are the smallest values of \verb|odometry_vehicleSpeed| of each driving mission.
To increase the clarity of the graph, the scale of the y-axes changes above the indicated discontinuities.
}
\label{fig:histograms}
\end{figure}

\section*{Usage Notes}

All files of the \ac{ZTBus} dataset \cite{ZTBus} described in this paper are provided in the \ac{CSV} format using UTF-8 encoding.
No special tools are necessary to load or interpret this data and most data processing tools can seamlessly work with data in this format.
For convenience, sample Matlab code is provided along with the dataset to recreate the figures shown in this paper.
This code can serve as a starting point for numerous new analyses.

\section*{Code availability}

The code used to collect, store, filter, and synchronize the data is not published, as it can only be used with the raw data recorded on the specific prototype vehicles, which contains partly proprietary data.
As large portions of the code deal with engineering challenges, such as translating data between formats used in different programming languages, ensuring compatibility between software versions, and performing operations in our custom log data base, we do not expect it to be interesting to the readers or useful for any other applications.
Instead we directly explain the relevant processing and filtering steps in the respective sections above.

As mentioned above, no specific code is necessary to load or interpret the \ac{ZTBus} dataset \cite{ZTBus}.
However, for convenience, the sample Matlab code provided allows to load some parts of the data and recreate most of the figures shown in this manuscript.
The code has been developed with Matlab version 9.12 (R2022a) and does not require any specialized toolboxes.
It is distributed under the \ac{GPLv3} alongside the \ac{ZTBus} dataset \cite{ZTBus}.

\bibliography{bibliography}

\section*{Acknowledgments}

This work was supported by the \ac{SFOE} (contract numbers SI/501321-01 and SI/501979-01) and the industrial partners Carrosserie HESS AG and \ac{VBZ}.

\section*{Author contributions statement}

F.W.\ and A.R.\ developed the methodology and software, curated, analyzed, and visualized the data, and wrote the original draft.
C.O.\ was responsible for funding acquisition and supervision.
All authors reviewed the manuscript. 

\section*{Competing interests}

The authors declare no competing interests.

\end{document}