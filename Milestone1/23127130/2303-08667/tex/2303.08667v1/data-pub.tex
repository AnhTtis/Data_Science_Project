%
%
%
%
%

\documentclass[fleqn,10pt]{wlscirep}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lineno}
%

%
\usepackage{csquotes} %
\usepackage{siunitx}
\usepackage{xspace}
\usepackage[capitalise]{cleveref}
\usepackage{multirow}
\usepackage{ifthen}
\usepackage{colortbl} %
\usepackage{xfrac} %
\usepackage{placeins} %
\usepackage{cprotect} %
\usepackage{url}
\urlstyle{same}

%

\newlist{enumerate-inline}{enumerate*}{1} %
\setlist*[enumerate-inline,1]{label=\arabic*)}

\sisetup{
per-mode=fraction,
fraction-function=\sfrac, %
}
\DeclareSIUnit\bar{bar} %

\definecolor{table-header-color}{HTML}{f7ae72}
\definecolor{plot-color1}{HTML}{185bad}%
\definecolor{plot-color2}{HTML}{f47157}%

\definecolor{hist-color1}{rgb}{0.00000,0.44700,0.74100}%
\definecolor{hist-color2}{rgb}{0.85000,0.32500,0.09800}%
\definecolor{hist-color3}{rgb}{0.92900,0.69400,0.12500}%


\newcommand{\plotWidth}{150mm}
\newcommand{\plotHeight}{32mm}
\newcommand{\legendOpacity}[1]{fill=white, fill opacity=#1, draw opacity=1, text opacity=1}

\newcommand{\SwissTrolleyPlus}{\guillemotleft Swiss\-Trolley plus\guillemotright\xspace}
\newcommand{\NaN}{\texttt{NaN}\xspace}
\newcommand{\totNumberOfMissions}{\num{1394}\xspace}

\input{sections/nomenclature}
\input{sections/tikzStuff}
\input{sections/dateTimeStuff}

%

%
\title{ZTBus: A Dataset of 1000+ Complete, Second-Resolved Driving Missions of Inner-City Transit Buses}

\author[1,$\dag$,*]{Fabio Widmer}
\author[1,$\dag$]{Andreas Ritter}
\author[1]{Christopher H.\ Onder}
\affil[1]{ETH Zurich, Institute for Dynamic Systems and Control, Zurich, 8092, Switzerland}

\affil[*]{Corresponding author: Fabio Widmer (fawidmer@idsc.mavt.ethz.ch)}
\affil[$\dag$]{These authors contributed equally to this work}

\begin{abstract}
%
This paper presents the \ac{ZTBus} dataset, which consists of recorded driving missions of electric city buses in Zurich, Switzerland.
The data was collected over several years on two trolley buses as part of multiple research projects.
It includes more than a thousand missions throughout all seasons, each usually covering a full day of real operation.
The \ac{ZTBus} dataset contains detailed information on the vehicle's power demand, propulsion system, odometry, global position, ambient temperature, door openings, number of passengers, dispatch patterns within the public transportation network, etc.
All signals are synchronized in time and are provided with an absolute timestamp in tabular form.
The dataset can be used as a foundation for a variety of studies and analyses.
For example, the data can serve as a basis for simulations to estimate the performance of different public transit vehicle types, or to evaluate and optimize control strategies of hybrid electric vehicles.
Furthermore, numerous influencing factors on vehicle operation, such as traffic, passenger volume, etc., can be analyzed in detail.
%
\end{abstract}
\begin{document}

\flushbottom
\maketitle

\thispagestyle{empty}

\section*{Background \& Summary}
%
Public transportation is an effective solution for reducing traffic in growing cities.
It significantly reduces the number of vehicles on the road, resulting in less congestion, shorter travel times, minimal ecological footprint, and reduced overall energy consumption.
The need for such efficient urban transportation systems is likely to increase, as an estimated two-thirds of the world's population is expected to live in cities by 2050\cite{UN:2014pe}.

%
In this context, detailed driving and operational data are of great value to assist cities and transportation operators in making informed decisions on the vehicles' ideal propulsion technology and charging strategy for the respective public transportation network.
Furthermore, during the development and tuning of intelligent vehicle state estimation algorithms or energy management strategies, time-resolved data of the traction system is necessary for both vehicle manufacturers and the research community.
%
While there are publicly available datasets describing urban traffic conditions and human mobility\cite{Mon:2022jd,Huang:2019eg,Feng:2019dh}, time-series data of personal cars\cite{Oh:2022jj,Zhang:2022sy,Calearo:2021px} or taxis\cite{Piorkowski:2009cm}, publicly available time-series data of urban transit buses is lacking.

%
The goal of this publication is to fill this gap by presenting the \ac{ZTBus} dataset, which is composed of data recorded throughout the course of the projects \SwissTrolleyPlus\cite{Ritter:2019en} and ISOTHERM\cite{Widmer:2023yp}, both of which were collaborations between industry partners and public research institutions that are financially supported by the \ac{SFOE}.
The dataset covers more than a thousand driving missions of two trolley buses that were in operation between \datetime{2019-04}{} and \datetime{2022-12}{}.
It consists of detailed time series that represent the power demand, propulsion system, odometry, global position, ambient temperature, door openings, number of passengers, and the dispatch patterns within the public transportation network of the two vehicles.
The time series are provided in a synchronized form and are sampled every second.
Aggregated quantities for each of the missions are provided in a metadata table.
A schematic overview of the data acquisition and curation procedure, which is explained in greater detail below, is shown in \cref{fig:acquisition}.
\Cref{fig:meta-fig} presents the full extent of the dataset.

\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{img/method/data-pub-method-overview.drawio.pdf}
\caption{Data acquisition and curation.
Signals from thee different sources, i.e., the \ac{VCU}, the \ac{GNSS} antenna, and the passenger counting system, are used in the definition of the driving missions.
Various filtering steps are added to reject erroneous and unrepresentative data.
Finally, time synchronization and sampling is performed to present the data in a tabular format.
}
\label{fig:acquisition}
\end{figure}

\begin{figure}
\centering
\input{img/meta-fig/meta-fig}
\caption{Visualization of the extent of the \ac{ZTBus} dataset, which includes a total of \totNumberOfMissions driving missions over the period of over 3.5 years between \datetime{2019-04}{} and \datetime{2022-12}{}.
}
\label{fig:meta-fig}
\end{figure}

This data offers the potential to be used in a broad variety of fields.
For example, the time-resolved \ac{GNSS} data can be used in combination with odometry signals, such as the wheel speeds and the steering angle, by means of sensor fusion approaches.
Such algorithms can significantly improve the raw pose estimates provided by the \ac{GNSS} sensor, and allow dead reckoning approaches to deal with momentary signal outage.
Additionally, the large amount of data on a set of given routes allows for the examination of algorithms for trajectory filtering and map matching in machine learning contexts.

Machine learning may also be utilized to predict various influence factors in public transportation, such as the number of passengers that travel a certain distance at a given time, the traffic levels on specific roads and at specific times of the day, or the expected speed profiles of the vehicles in the near future or in general on certain road segments.

Finally, the aggregated data enables the examination of long-term correlations such as the impact of COVID-19 mitigation measures on passenger numbers, the effect of weather conditions on energy consumption, etc.

The dataset presented in this manuscript has been used in several of our own publications in the context of the research activities mentioned above:
\begin{enumerate-inline}
\item The position, odometry, and velocity data served to develop and evaluate a real-time incremental graph construction algorithm\cite{Ritter:2021ex}.
\item Time-resolved speed, torque, and braking pressure signals were used for the development of the model-based vehicle mass and road grade estimation method\cite{Ritter:2021aa}.
\item The spatio-temporal nature of the power request signal was used to quantify the relation between grid and battery energy usage on certain road segments, which then served to derive a stochastic model predictive control approach\cite{Ritter:2021bb}.
\item The optimal design and control of a thermal energy buffer in an electric city bus was studied based on the passenger loads, velocity and elevation profiles\cite{Widmer:2022xt}.
\item A set of 16 representative all-day driving missions served to optimize the battery degradation throughout the vehicle lifetime\cite{Widmer:2023yf}.
\item Hourly-averaged data was used to conduct a large-scale sensitivity analysis of the thermal comfort systems, allowing a comparison of various \ac{HVAC} systems\cite{Widmer:2023rj}.
\end{enumerate-inline}

%

\section*{Methods}

\subsection*{Data Collection}

The \ac{ZTBus} dataset was recorded on two trolley buses during regular operation by \ac{VBZ} on various bus routes in Zurich's public transportation network.
Both buses are single-articulated, have an overall length of about \SI{19}{\meter}, a curb weight of about \SI{19}{\tonne}, and a maximum passenger capacity of about 160.
They are equipped with traction batteries, which allow them to run for a few kilometers without the overhead power grid.

Onboard logging systems developed for that purpose allow us to record various data streams, which originate from the three different systems as follows:

\begin{enumerate}
\item The majority of the data is provided by the \ac{VCU} to which the raw measurement data is directly transmitted via multiple \ac{CAN} buses from the various vehicle components.
As this data is used during the normal operation of the bus, these signals are always available if the attached logging system works as intended.

\item The data related to the global positioning of the vehicles is provided by a \ac{GNSS} antenna mounted on their roofs.
The \ac{GNSS} data may be temporarily unavailable if no reliable connection to the satellites can be established, which may be the case during bad weather, between tall buildings, or in underpasses, for instance.

\item The passenger counts are estimated by onboard infrared-based passenger counting systems that transmit their estimates to the public transportation operator's server computer via the local cellular network.
This data is then automatically synchronized and augmented with the data from the \ac{ITCS}, i.e., the corresponding bus route number and stop names.
We refer to this combined data as \enquote{\acs{ITCS} data}.
\end{enumerate}

The data is organized in \enquote{driving missions}, which we define as the entire period from the moment the bus is switched on until the moment it is switched off.

\subsection*{Selection of Data Records}

To make sure the dataset is of high quality, we include only those records that represent complete driving missions in regular public transport operation.
For example, we reject test drives, short trips within depots, and missions that are completely missing any data of the three systems.
The details of this selection step are described in the section on technical validation below.

\subsection*{Processing}

We aim to reduce the processing of data to a minimum.
In particular, instead of applying sophisticated filtering and smoothing techniques, we publish the raw measurement data received from the sensory devices, which allows its use also for the development or tuning of such algorithms.
The processing steps that were nevertheless considered necessary and were carried out are listed as follows:

\begin{itemize}
\item On our vehicles, the most accurate indicator of the vehicle speed is provided by the rotational speed sensors mounted on the motor shafts.
As we aim to present our data in a manner that is independent of the specific drivetrain used, we use an estimate of the \enquote{compound} transmission ratio \transmissionRatio to convert the rotational speed measurements \motorSpeed to the longitudinal vehicle speed \speed:
\begin{linenomath*}
\begin{equation}
\speed = \frac{\motorSpeed}{\transmissionRatio} \,.
\label{eq:speed}
\end{equation}
\end{linenomath*}
The compound transmission ratio thus combines the effects of the transmission, final drive, and wheel radius.
For estimating \transmissionRatio, we analyze measurement data of perfectly straight driving sections, where the traveled distance according to filtered \ac{GNSS} data is compared to the total angle covered by the electric machine.
The value thus obtained is also used to calculate the traction force
\begin{linenomath*}
\begin{equation}
\tractionForce = \transmissionRatio \cdot \tractionTorque \,,
\label{eq:torque}
\end{equation}
\end{linenomath*}
where \tractionTorque represents the total torque provided by the electric machines.

\item To focus on the valuable information recorded between the initial departure and the final arrival of each driving mission, we discard any data recorded more than \SI{1}{\minute} before and more than \SI{1}{\minute} after the actual driving.

\item Finally, the data from the three different sources introduced above, i.e, the \ac{VCU}, \ac{GNSS}, and the \ac{ITCS}, is synchronized and resampled.
For this purpose, we first generate a new date-time vector in \ac{UTC} with a uniform sampling period of \SI{1}{\second} covering the time window identified above.
The signals are then mapped to this time vector as follows:
\begin{itemize}
\item The \ac{ITCS} data is only given at discrete time events approximately matching the moments the bus is leaving a stop.
As the interpretation of the raw data is to be kept to a minimum, the \ac{ITCS} data is not interpolated.
Instead, the nearest sample times of the new date-time vector are found and the discrete values are mapped accordingly.

\item All binary (status) signals are interpreted as piecewise constant signals and are thus resampled via previous neighbor interpolation.

\item All other signals are linearly interpolated.
\end{itemize}
\end{itemize}

\section*{Data Records}

The \ac{ZTBus} dataset is organized in two different types of \ac{CSV} text files, the first of which describes the \totNumberOfMissions individual driving missions, while the second contains metadata of all driving missions.

The names of the files that describe the individual driving missions are based on the vehicle identification number (either 183 or 208) and the time period in which the data was collected.
For example, the data collected on the bus numbered 183 between \datetime{2019-10-16}{02:52:43} and \datetime{2019-10-16}{07:10:12}, both given in \ac{UTC}, is available in the following file:
\begin{quote}
\verb|B183_2019-10-16_02-52-43_2019-10-16_07-10-12.csv|
\end{quote}
The metadata describing all driving missions is provided as \verb|metaData.csv|.

All files are published at the repository for publications and research data of ETH Zurich and are available at \url{https://doi.org/10.3929/ethz-b-000600108}.

\subsection*{Detailed Description of the Time-Resolved Measurement Data}

The \ac{ZTBus} dataset consists of \totNumberOfMissions driving missions, each of which is described in a separate \ac{CSV} file.
All files have the same structure and format, where the first row contains the headers of the corresponding columns and the remaining rows describe the set of data samples recorded at a specific moment in time.
This time index is represented in the first column as absolute \ac{UTC} time, expressed according to ISO 8601.

The columns are described in \cref{tab:missions}, where \NaN represents unavailable data, unless specified otherwise.

\begin{table}
\centering
\scriptsize
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|p{4cm}|p{12cm}|}
\hline
\rowcolor{table-header-color}
\textbf{Column} & \textbf{Description} \\\hline
\verb|time| & The absolute UTC time, expressed according to ISO 8601.
\\\hline

\verb|timestamp| & The Unix timestamp, i.e., the number of seconds passed since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|electric_powerDemand| & The overall electric power demand of the vehicle in watts.
The values include the power demand of the traction motors (which can be negative during recuperation phases) and all auxiliary power consumers like \ac{HVAC}, air compressor, lighting, infotainment systems, etc.
\\\hline

\verb|gnss_altitude| & The altitude measured by the \ac{GNSS} sensor, in meters above sea level.
\\\hline

\verb|gnss_course| & The course (heading) provided by the \ac{GNSS} sensor, in radians.
Traveling towards north is represented by a course of \SI{0}{\radian} or \SI[parse-numbers=false]{\text{$2 \pi$}}{\radian}.
Traveling towards the east is represented by a value of \SI[parse-numbers=false]{\text{$\sfrac{\pi}{2}$}}{\radian}.
When the bus is not moving, this estimate is held constant by the \ac{GNSS} sensor on bus 183 and set to zero on bus 208.
\\\hline

\verb|gnss_latitude| & The latitude on WGS~84 measured by the \ac{GNSS} sensor, in radians.
\\\hline

\verb|gnss_longitude| & The longitude on WGS~84 measured by the \ac{GNSS} sensor, in radians.
\\\hline

\verb|itcs_busRoute| & The \ac{VBZ} bus route name, provided by the \ac{ITCS}.
For unavailable data, we use a dash (\enquote{--}).
\\\hline

\verb|itcs_numberOfPassengers| & The estimated number of passengers on board of the bus, measured with infrared-based passenger counting systems.
\\\hline

\verb|itcs_stopName| & The name of the bus stop served, provided by the \ac{ITCS}.
For unavailable data, we use a dash (\enquote{--}).
\\\hline

\verb|odometry_articulationAngle| & The angle of the pivoting joint (articulation), in radians.
A positive angle is observed in a left turn.
\\\hline

\verb|odometry_steeringAngle| & The angle of the front wheels relative to the vehicle body, in radians.
A positive angle is observed in a right turn.
\\\hline

\verb|odometry_vehicleSpeed| & The vehicle speed, in meters per second.
This value is based on the rotational velocity of the drive shaft of the middle axis and a compound transmission ratio according to \cref{eq:speed}.
\\\hline

\verb|odometry_wheelSpeed_fl| & The wheel speed of the front left wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_fr| & The wheel speed of the front right wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_ml| & The wheel speed of the middle left wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_mr| & The wheel speed of the middle right wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_rl| & The wheel speed of the rear left wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|odometry_wheelSpeed_rr| & The wheel speed of the rear right wheel, in meters per second, measured using a wheel encoder.
Due to the nature of the measurement, it is not reliable below approximately \SI{1.5}{\meter\per\second}.
\\\hline

\verb|status_doorIsOpen| & A binary flag indicating whether at least one door is open.
\\\hline

\verb|status_gridIsAvailable| & A binary flag indicating whether the current collector of the trolley bus is connected to the overhead grid.
\\\hline

\verb|status_haltBrakeIsActive| & A binary flag indicating whether the halt brake is active.
This brake is automatically activated whenever the bus stands still.
\\\hline

\verb|status_parkBrakeIsActive| & A binary flag indicating whether the park brake is active.
This fail-safe brake works also if the vehicle is not powered.
It can be manually activated by the driver, e.g., for longer standstill periods.
\\\hline

\verb|temperature_ambient| & The measured ambient temperature, in kelvin.
The temperature sensor is located behind the front bumper.
Due to the sensor resolution, it is only available in increments of \SI{1}{\kelvin}.
\\\hline

\verb|traction_brakePressure| & The mean pressure in the friction braking lines, in pascal.
\\\hline

\verb|traction_tractionForce| & An estimate of the overall traction force provided by the two traction motors, in newton.
These values are based on an estimate of the traction torque provided by the two traction motors and a compound transmission ratio according to \cref{eq:torque}.
\\\hline
\end{tabular}
\caption{Column descriptions of the driving mission tables.}
\label{tab:missions}
\end{table}


\subsection*{Detailed Description of the Metadata}

The metadata of the driving missions is tabulated as described in \cref{tab:metadata}.
The first row contains the headers of the corresponding columns.
The remaining rows contain metadata of the driving missions, indexed via the corresponding file name in the first column.

\begin{table}[p]
\centering
\scriptsize
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|p{4cm}|p{12cm}|}
\hline
\rowcolor{table-header-color}
\textbf{Column} & \textbf{Description} \\\hline
\verb|name| & The name of the data file represented by the corresponding row of the metadata table.
\\\hline

\verb|busNumber| & The number of the bus on which the data was recorded (183 or 208).
\\\hline

\verb|startTime| & The absolute \ac{UTC} time of the start of the driving mission, expressed according to ISO 8601.
\\\hline

\verb|startTimestamp| & The Unix timestamp of the start of the driving mission, in seconds since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|endTime| & The absolute \ac{UTC} time of the end of the driving mission, expressed according to ISO 8601.
\\\hline

\verb|endTimestamp| & The Unix timestamp of the end of the driving mission, in seconds since \datetime{}{00:00:00} \ac{UTC} on \datetime{1970-01-01}{}.
\\\hline

\verb|drivenDistance| & The distance covered during the entire driving mission, in meters.
This value is calculated via trapezoidal integration of the time series \verb|odometry_vehicleSpeed|.
\\\hline

\verb|busRoute| & The most occurring value of the time series \verb|itcs_busRoute|.
\\\hline

\verb|energyConsumption| & The overall electric energy consumption of the vehicle on the entire driving mission, in joules.
This value is calculated via trapezoidal integration of the time series \verb|electric_powerDemand|.
\\\hline

\verb|meanNumberOfPassengers| & The average number of passengers in the bus, i.e., the mean value of the time series \verb|itcs_numberOfPassengers|, where \NaN values are omitted.
\\\hline

\verb|meanAmbientTemperature| & The average ambient temperature in kelvin, i.e., the mean value of the time series \verb|temperature_ambient|, where \NaN values are omitted.
\\\hline
\end{tabular}
\caption{Column descriptions of the metadata table.}
\label{tab:metadata}
\end{table}

\section*{Technical Validation}

In this section, we explain the various measures we have taken and the types of data visualization that we have conducted to ensure a high quality of the \ac{ZTBus} dataset.
In particular, we iteratively developed a few simple selection criteria that are able to consistently remove all data records that contain any artifacts of software malfunction or that are not representative of a regular public transportation operation, such as drives within a garage or to a workshop.

For instance, with respect to the logging toolchain, our criteria include a comparison of the transmission frequency of the \ac{CAN} messages with the respective expected values, a verification of the timestamps of the messages, and sanity checks for the physical dimensions.
To exclude any test drives and short trips to, from, or within a depot, we require each driving mission to last at least \SI{3}{\hour} and not to report any standstill time of more than \SI{30}{\minute}.
Furthermore, each mission must begin and end with the vehicle at standstill and both \ac{GNSS} and \ac{ITCS} data must be at least partially available.

The remaining data quality inspection is grouped into three further aspects, which are addressed below.

\begin{figure}[p]
\centering
\input{img/fast-timescale/fast-timescale.tex}
\caption{Detailed view on example time series recorded in the morning of \datetime{2021-03-07}{} on bus numbered 183 on route~72 of \acs{VBZ}.}
\label{fig:fast-timescale}
\end{figure}

\subsection*{Time Series Inspection}

Throughout the activities within our research projects\cite{Ritter:2019en,Widmer:2023yp}, we visually analyzed hundreds of time windows that are similar to the one shown in \cref{fig:fast-timescale}.
Such visualizations reveal, for example, the consistency of the wheel speed signals w.r.t.\ the steering and articulation angles.
In particular, a left turn is evident at around second 40, with a positive articulation angle and a negative steering angle, according to the definitions given in \cref{tab:missions}.
Accordingly, as expected in a left turn, the right front wheel turns slightly faster than the left.

A slightly coarser time scale is used in \cref{fig:stops}, which visualizes the proper synchronization of the \ac{VCU} signals with the \ac{ITCS} signals.
This figure shows that the times at which the stop names and the passenger counts are reported correspond to the times at which the bus departs from the respective stops.

\begin{figure}
\centering
\input{img/stops/stops.tex}
\caption{Exemplary \ac{ITCS} data aligned with the speed profile recorded in the morning of \datetime{2021-03-07}{} on the bus numbered 183 on route~72 of \acs{VBZ}.
The names of the bus stops are shown on top of the graph.
The areas shaded in gray indicate that at least one door is open.
}
\label{fig:stops}
\end{figure}

Some signals are best visualized over the course of the daily operation of a bus, as exemplified in \cref{fig:slow-timescale}.
The repetitive nature of the driving profile is clearly observable in both the pronounced elevation profile of the depicted bus route~72 and the passenger volume.
The ambient temperature measured on the one hand indicates that the bus started its mission directly from a depot whose temperature lies significantly above the outside temperature, while on the other hand the thermal inertia experienced by the sensor shows to be quite significant due to its placement behind bodywork.
Due to the sensor resolution, the temperature is only available in increments of \SI{1}{\celsius}.
However, as a result of the linear interpolation used, the dataset may contain single temperature values between these increments.

\begin{figure}
\centering
\input{img/slow-timescale/slow-timescale.tex} 
\caption{Example time series recorded throughout the day on \datetime{2021-03-07}{} on the bus numbered~183 on \acs{VBZ} route~72.}
\label{fig:slow-timescale}
\end{figure}

The \ac{GNSS} data deliberately was not modified and is provided as raw data, except for the linear interpolation necessary for time synchronization.
Therefore, the data might be noisy or imprecise in some locations or may be missing completely during certain time windows.
On the one hand, for certain types of applications, such data may have to be excluded or pre-processed by applying dedicated smoothing or filtering algorithms.
On the other hand, incomplete and imprecise data can be used as valuable training or validation data for dead-reckoning and map-matching algorithms, for instance.
However, the \ac{GNSS} data is mostly of good quality, as the exemplary visualization in \cref{fig:geo-plot} clearly shows.
Despite the complicated installation of the overhead infrastructure and the footbridges around the crossing depicted, the quality of the raw measurements is by far sufficient to determine which roads were taken.

\begin{figure}
\centering
\input{img/geo-plot/geo-plot.tex}
\caption{Example \ac{GNSS} trajectories of 7 outbound and return trips each, recorded on \datetime{2021-03-07}{} around Bucheggplatz in Zurich, Switzerland.
The square is an important transportation hub in the center of Zurich, connecting two tram routes, two bus routes, and three trolley bus routes.
Map data \copyright{}2022 Google.}
\label{fig:geo-plot}
\end{figure}

\subsection*{Statistical Analysis}

In order to check the plausibility of the individual signals in view of the large amount of data, we examine a multitude of histograms, three of which are exemplarily shown in \cref{fig:histograms}.
Such an analysis of the respective minimum, mean, and maximum values of all driving missions allows to detect anomalies and outliers relatively quickly.
These visualizations were a helpful tool in the development of the selection criteria mentioned above.

An inspection of the three histograms shown in \cref{fig:histograms} reveals that the vehicle speed is slightly negative in some situations, which typically occurs when the vehicle is starting or stopping.
From experience, we also know that the average speed of a transit bus in Zurich is around \SI{15}{\kilo\meter\per\hour}, while the maximum speed rarely exceeds \SI{65}{\kilo\meter\per\hour}, which is well represented in the dataset.
The distinct peaks shown in maximum and minimum power demand levels are mainly due to the power capability of the two electric motors of the buses, which is around \SI{320}{kW} for both negative and positive values.
Assuming some auxiliary power consumption in the range of \SIrange{20}{30}{kW}, these power limits perfectly explain the peaks observed at around $\SI{-300}{kW}$ and \SI{350}{kW}, respectively.
The average power demand is in the range of \SIrange{15}{35}{\kilo\watt}, which corresponds to the expected range of \SIrange{1.5}{2.0}{\kilo\watt\hour\per\kilo\meter} for transit buses driving at the mean vehicle speed mentioned above.
Finally, the distribution of the number of passenger shows that the average occupation ranges between 10 and 30 people.
On most missions, the vehicle is both empty and about half full at least once.

\begin{figure}
\centering
\includegraphics{img/histograms/img-histograms}
\cprotect\caption{Example histograms granting a representative overview of all data values contained in the dataset.
Each of the three categories \enquote{min}, \enquote{mean}, and \enquote{max} refers to the corresponding values of all driving missions, visualized as a histogram.
For example, the data values shown for the minimum vehicle speed are the smallest values of \verb|odometry_vehicleSpeed| of each driving mission.
To increase the clarity of the graph, the scale of the y-axes changes above the indicated discontinuities.
}
\label{fig:histograms}
\end{figure}

\subsection*{Consistency Checks}

As part of the process of matching numbers of passengers estimated by the on-board infrared-based counting systems with bus route and stop names provided by the \ac{ITCS}, major inconsistencies are already filtered out by the public transportation operator.
For example, trips are discarded if the total number of passengers boarding differs too much from the total number of passengers alighting throughout one trip, or if a recorded trip cannot be uniquely matched to a trip in the \ac{ITCS} database.
To exclude any remaining erroneous \ac{ITCS} data, which may occur when stops are skipped, for instance, we use the locations of the reported stops according to publicly available \ac{GTFS} data and compare them to the location estimates provided by the \ac{GNSS} sensors.
If the locations are farther than \SI{100}{\meter} apart for at least three stops in a row, the \ac{ITCS} data is discarded.
Of course, this comparison is only possible if both \ac{ITCS} and \ac{GNSS} data are available, which is not always the case.

\section*{Usage Notes}

All files of the \ac{ZTBus} dataset described in this paper are provided in the \ac{CSV} format using UTF-8 encoding.
No special tools are necessary to load or interpret this data and most data processing tools can seamlessly work with data in this format.
For convenience, sample Matlab code is provided along with the dataset to recreate the figures shown in this paper.
This code can serve as a starting point for numerous new analyses.

\section*{Code availability}

The code used to collect, store, filter, and synchronize the data is not published, as it is partly proprietary and generally very specific to the application described.
We thus do not expect it to be useful for any other applications.

As mentioned above, no specific code is necessary to load or interpret the \ac{ZTBus} dataset.
However, for convenience, the sample Matlab code provided allows to load some parts of the data and recreate all figures shown in this manuscript except for the histograms shown in \cref{fig:histograms}.
The code has been developed with Matlab version 9.12 (R2022a) and does not require any specialized toolboxes.
It can be found in the data repository of ETH Zurich at \url{https://doi.org/10.3929/ethz-b-000600108}.

\bibliography{bibliography}

\section*{Acknowledgments}

This work was supported by the \ac{SFOE} (contract numbers SI/501321-01 and SI/501979-01) and the industrial partners Carrosserie HESS AG and \ac{VBZ}.

\section*{Author contributions statement}

F.W.\ and A.R.\ developed the methodology and software, curated, analyzed, and visualized the data, and wrote the original draft.
C.O.\ was responsible for funding acquisition and supervision.
All authors reviewed the manuscript. 

\section*{Competing interests}

The authors declare no competing interests.

\end{document}