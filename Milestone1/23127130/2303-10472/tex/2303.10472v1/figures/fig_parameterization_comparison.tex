
\tikzset{subcaptionstyle/.style={
    text width=2in,yshift=-3mm, align=center,anchor=north
}}

\begin{tikzpicture}[%
    /pgfplots/set layers,
    spy using outlines={circle, magnification=3, connect spies}%
  ]
  \begin{axis}[
      legend style={
        legend image post style={scale=0.5},
        at={(0.5,1.6)},
        anchor=north,
        legend cell align=left,
        line width=0.8pt,
        draw=none % Unterdr√ºcke Box
      },
      tuftelike, 
      axis line style = thick,
      every tick/.style={black,thick},
      %axis lines = left,
      %grids=both,
      ymode  = log,
      xmin   = 1,
      xmax   = 1000,
      xtick  = {1, 500, 1000},
      %
      xlabel style={yshift=-0.8ex},
      %
      ymin   = 1e+4,
      ymax   = 1e+7,
      %
      xlabel = {Iteration},
      tick label style={font=\small},  
      ylabel = {\(\mathbb{E}\norm{\rvvg}^2_2\)},
      height = 4cm,
      width  = 4.3cm,
      axis on top,
    ]
    \addplot[color1, thick, mark=none] table[x=t, y=squareroot, mark=none] {data/replay_airfoil.csv};
    \addlegendentry{\scriptsize{Matrix square root}};

    \addplot[color2, thick, mark=none] table[x=t, y=linearcholesky, mark=none] {data/replay_airfoil.csv};
    \addlegendentry{\scriptsize{Cholesky \(\phi(x) = x\)}};

    %\addplot[color3, thick,  mark=none] table[x=t, y=expcholesky, mark=none] {data/replay_airfoil.csv};
    %\addlegendentry{\scriptsize{Cholesky \(\phi(x) = \exp\left(x\right)\)}};

    \addplot[color4, thick, mark=none] table[x=t, y=softpluscholesky, mark=none] {data/replay_airfoil.csv};
    \addlegendentry{\scriptsize{Cholesky \(\phi(x) = \mathrm{softplus}\left(x\right)\)}};

    % Square Root
    \addplot [name path=squarerootl, fill=none, draw=none, forget plot] table [x=t, y=squarerootl] {data/replay_airfoil.csv} \closedcycle;
    \addplot [name path=squarerootu, fill=none, draw=none, forget plot] table [x=t, y=squarerootu] {data/replay_airfoil.csv} \closedcycle;
    \addplot[color1!30] fill between[of=squarerootu and squarerootl];

    % Cholesky Linear
    \addplot [name path=linearcholeskyl, fill=none, draw=none, forget plot] table [x=t, y=linearcholeskyl] {data/replay_airfoil.csv} \closedcycle;
    \addplot [name path=linearcholeskyu, fill=none, draw=none, forget plot] table [x=t, y=linearcholeskyu] {data/replay_airfoil.csv} \closedcycle;
    \addplot[color2!40] fill between[of=linearcholeskyu and linearcholeskyl];

    % Cholesky Exp
%%     \addplot [name path=expcholeskyl, fill=none, draw=none, forget plot] table [x=t, y=expcholeskyl] {data/replay_airfoil.csv} \closedcycle;
%%     \addplot [name path=expcholeskyu, fill=none, draw=none, forget plot] table [x=t, y=expcholeskyu] {data/replay_airfoil.csv} \closedcycle;
%%     \addplot[color3!40] fill between[of=expcholeskyu and expcholeskyl];

    % Cholesky Softplus
    \addplot [name path=softpluscholeskyl, fill=none, draw=none, forget plot] table [x=t, y=softpluscholeskyl] {data/replay_airfoil.csv} \closedcycle;
    \addplot [name path=softpluscholeskyu, fill=none, draw=none, forget plot] table [x=t, y=softpluscholeskyu] {data/replay_airfoil.csv} \closedcycle;
    \addplot[color4!40] fill between[of=softpluscholeskyu and softpluscholeskyl];

    \coordinate (spypoint)     at (axis cs:280,1e+6);
    \coordinate (magnifyglass) at (axis cs:800,1.5e+6);
    \begin{scope}
      \spy [black, size=1.5cm] on (spypoint) in node[fill=white] at (magnifyglass);
    \end{scope}
  \end{axis}
\end{tikzpicture}
