
\begin{theoremEnd}[\theoremproofoption,category=upperboundtheoremklform]{theorem}\label{thm:gradient_upper_bound_kl}
  Let \(\rvvg_{M}\) be an \(M\)-sample estimator of the gradient of the ELBO in KL-regularized form (\cref{def:kl_form}). 
  Also, assume that
%
  \begin{itemize}[leftmargin=3em]
    \vspace{-1.5ex}
    \setlength\itemsep{0ex}
    \item \(f_{\mathrm{KL}}\) is \(L_{\mathrm{KL}}\)-smooth,
    \item \(f_{\mathrm{KL}}\) is \(\mu_{\mathrm{KL}}\)-quadratically growing,
    \vspace{-1.5ex}
  \end{itemize}
  %
  and~\cref{assumption:q,assumption:phi_lipschitz} hold.
  Then, the gradient variance is bounded above as
  {%
  \setlength{\belowdisplayskip}{1ex} \setlength{\belowdisplayshortskip}{1ex}%
  \setlength{\abovedisplayskip}{1ex} \setlength{\abovedisplayshortskip}{1ex}%
  \begin{align*}
    \mathbb{E}\norm{\rvvg_{M}}_2^2
    &\leq
    \frac{2 L^2_{\mathrm{KL}}}{\mu_{\mathrm{KL}} M} C\left(d, \kappa\right) \left( F\left(\vlambda\right) - F^* \right)
    + \norm{ \nabla F\left(\vlambda\right) }_2^2
    \qquad\qquad
    \\
    &\quad+ \frac{2 L^2_{\mathrm{KL}}}{\mu_{\mathrm{KL}} M} C\left(d, \kappa\right) \left( F^* - f_{\mathrm{KL}}^*\right),
  \end{align*}
  }%
  where
  {%
  \setlength{\belowdisplayskip}{1ex} \setlength{\belowdisplayshortskip}{1ex}%
  \setlength{\abovedisplayskip}{1ex} \setlength{\abovedisplayshortskip}{1ex}%
  \begin{alignat*}{2}
    C\left(d, \kappa\right) &= 2 \kappa \sqrt{d} + 1 &&\;\text{for mean-field,} \\
    C\left(d, \kappa\right) &= d + \kappa          &&\;\text{for the Cholesky and matrix square root,}
  \end{alignat*}
  }%
  \(F^* = \inf_{\vlambda \in \mathbb{R}^p} F\left(\vlambda\right)\), and \(f_{\mathrm{KL}}^* = \inf_{\vzeta \in \mathbb{R}^d} f\left(\zeta\right)\).
\end{theoremEnd}
\vspace{-1ex}
\begin{proofEnd}
  This proof uses the smoothness of \(f_{\mathrm{KL}}\) instead of \(f_{\mathrm{H}}\).
  That is,
  \begin{align}
    \mathbb{E} \norm{
      \nabla f_{\mathrm{KL}}\left(\vt_{\vlambda}\left(\rvvu\right)\right)
    }_2^2 
    &=
    \mathbb{E} {\lVert
      \nabla f_{\mathrm{KL}}\left(\vt_{\vlambda}\left(\rvvu\right)\right)
      -
      \nabla f_{\mathrm{KL}}\left( \bar{\vzeta}_{\mathrm{KL}} \right)
    \rVert}_2^2 
    \nonumber
\shortintertext{applying \cref{eq:thm_upper_bound_smoothness},}
    &\leq
    L^2_{\mathrm{KL}} \,
    \mathbb{E} {\lVert
    \vt_{\vlambda}\left(\rvvu\right)
    -
    \bar{\vzeta}_{\mathrm{KL}}
    \rVert}_2^2, \label{eq:thm3_kl_smoothness}
  \end{align}
  where \(\bar{\vzeta}_{\mathrm{KL}}\) is a stationary point of \(f_{\mathrm{KL}}\).

  Substituting \cref{eq:thm3_kl_smoothness} in \cref{eq:thm1_parameter_suboptimality_unified},
  \begin{alignat}{2}
    &\mathbb{E}\norm{\nabla_{\vlambda} f_{\mathrm{KL}}\left(\vt_{\vlambda}\left(\rvvu\right)\right)}_2^2 
    \nonumber
    \\
    &\;\leq
    L^2_{\mathrm{KL}} C\left(d, \kappa\right) \mathbb{E} {\Vert \vt_{\vlambda}\left(\rvvu\right) - \bar{\vzeta}_{\mathrm{KL}} \rVert}_2^2,
    \nonumber
\shortintertext{and by applying \cref{eq:thm_upper_bound_f_quadratic} for \(f_{\mathrm{KL}}\),}
    &\;=
    \frac{2 L^2_{\mathrm{KL}} }{\mu_{\mathrm{KL}}} C\left(d, \kappa\right) \left( F\left(\vlambda\right) - F^*  \right) 
    + \frac{2 L^2_{\mathrm{KL}} }{\mu_{\mathrm{KL}}} C\left(d, \kappa\right)
    \left(
      F^* - f^*_{\text{KL}}
    \right).
    \nonumber
  \end{alignat}
  Plugging this to \cref{thm:gradient_variance_general_upper_bound} proves the result.
\end{proofEnd}

%%% Local Variables:
%%% TeX-master: "main"
%%% End:
