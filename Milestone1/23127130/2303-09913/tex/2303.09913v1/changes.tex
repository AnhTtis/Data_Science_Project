%DIF 1c1
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL mainPRE-ACCEPT.tex   Tue Mar 14 16:01:46 2023
%DIF ADD main.tex             Tue Mar 14 16:14:09 2023
%DIF < \documentclass[conference]{IEEEtran}
%DIF -------
\documentclass[sigconf]{acmart} %DIF > 
%DIF -------
%\documentclass[letterpaper, 10 pt, conference]{ieeeconf} 
%DIF 3c3
%DIF < \IEEEoverridecommandlockouts
%DIF -------
%\IEEEoverridecommandlockouts %DIF > 
%DIF -------

% \documentclass[runningheads]{llncs}

% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{url}
%DIF 9-10c9-10
%DIF < \usepackage{cite}
%DIF < \usepackage{amsmath,amssymb,amsfonts}
%DIF -------
% \usepackage{cite} %DIF > 
\usepackage{amsmath,amsfonts} %DIF > 
%DIF -------
\usepackage{accents}
% \usepackage{algorithmic}
\usepackage[linesnumbered,ruled]{algorithm2e}
\usepackage[noend]{algpseudocode}
% \usepackage[nottoc]{tocbibind}
% \usepackage{diagbox}
\usepackage{graphicx}
\usepackage{textcomp}
%DIF 19-20c19-20
%DIF < \usepackage[table,xcdraw]{xcolor}
%DIF < \usepackage{xcolor}
%DIF -------
%\usepackage[table,xcdraw]{xcolor} %DIF > 
%\usepackage{xcolor} %DIF > 
%DIF -------
\usepackage{comment}
\usepackage{multicol,multirow}
\usepackage[T1]{fontenc}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\usepackage{todonotes}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{subfig}
\newsavebox{\measurebox}
%\usepackage[disable]{todonotes}
\usepackage{threeparttable}
\usepackage[font=small]{caption} 
\usepackage{enumitem}
% \setlist[itemize]{align=left,left=-10pt..-5em}
% \usepackage[hang,flushmargin]{footmisc}
% \usepackage{lipsum}

%One must be careful when importing hyperref. Usually, it has to be the last package to be imported, but there might be some exceptions to this rule.
\usepackage{hyperref}
\hypersetup{
    colorlinks=false
}

\def\UrlBreaks{\do\/\do-}

\makeatletter
\newcommand{\algorithmfootnote}[2][\footnotesize]{%
  \let\old@algocf@finish\@algocf@finish% Store algorithm finish macro
  \def\@algocf@finish{\old@algocf@finish% Update finish macro to insert "footnote"
    \leavevmode\rlap{\begin{minipage}{\linewidth}
    #1#2
    \end{minipage}}%
  }%
}
\makeatother

\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
 %DIF > 
%% %DIF > 
%% \BibTeX command to typeset BibTeX logo in the docs %DIF > 
\AtBeginDocument{% %DIF > 
  \providecommand\BibTeX{{% %DIF > 
    Bib\TeX}}} %DIF > 
 %DIF > 
%% Rights management information.  This information is sent to you %DIF > 
%% when you complete the rights form.  These commands have SAMPLE %DIF > 
%% values in them; it is your responsibility as an author to replace %DIF > 
%% the commands and values with those provided to you when you %DIF > 
%% complete the rights form. %DIF > 
\setcopyright{acmcopyright} %DIF > 
\copyrightyear{2023} %DIF > 
\acmYear{2023} %DIF > 
\acmDOI{XX.XXXX/XXXXXXX.XXXXXXX} %DIF > 
 %DIF > 
%% These commands are for a PROCEEDINGS abstract or paper. %DIF > 
\acmConference[CHASE '23]{EEE/ACM international conference on Connected Health: Applications, Systems and Engineering Technologies}{June 21-23, %DIF > 
  2023}{Orlando, FL} %DIF > 
%% %DIF > 
%%  Uncomment \acmBooktitle if the title of the proceedings is different %DIF > 
%%  from ``Proceedings of ...''! %DIF > 
%% %DIF > 
%%\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection, %DIF > 
%%  June 03--05, 2018, Woodstock, NY} %DIF > 
\acmPrice{15.00} %DIF > 
\acmISBN{978-1-4503-XXXX-X/18/06} %DIF > 
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFaddtex}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdeltex}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
\providecommand{\DIFmodbegin}{} %DIF PREAMBLE
\providecommand{\DIFmodend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
%DIF HYPERREF PREAMBLE %DIF PREAMBLE
\providecommand{\DIFadd}[1]{\texorpdfstring{\DIFaddtex{#1}}{#1}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{\texorpdfstring{\DIFdeltex{#1}}{}} %DIF PREAMBLE
\newcommand{\DIFscaledelfig}{0.5}
%DIF HIGHLIGHTGRAPHICS PREAMBLE %DIF PREAMBLE
\RequirePackage{settobox} %DIF PREAMBLE
\RequirePackage{letltxmacro} %DIF PREAMBLE
\newsavebox{\DIFdelgraphicsbox} %DIF PREAMBLE
\newlength{\DIFdelgraphicswidth} %DIF PREAMBLE
\newlength{\DIFdelgraphicsheight} %DIF PREAMBLE
% store original definition of \includegraphics %DIF PREAMBLE
\LetLtxMacro{\DIFOincludegraphics}{\includegraphics} %DIF PREAMBLE
\newcommand{\DIFaddincludegraphics}[2][]{{\color{blue}\fbox{\DIFOincludegraphics[#1]{#2}}}} %DIF PREAMBLE
\newcommand{\DIFdelincludegraphics}[2][]{% %DIF PREAMBLE
\sbox{\DIFdelgraphicsbox}{\DIFOincludegraphics[#1]{#2}}% %DIF PREAMBLE
\settoboxwidth{\DIFdelgraphicswidth}{\DIFdelgraphicsbox} %DIF PREAMBLE
\settoboxtotalheight{\DIFdelgraphicsheight}{\DIFdelgraphicsbox} %DIF PREAMBLE
\scalebox{\DIFscaledelfig}{% %DIF PREAMBLE
\parbox[b]{\DIFdelgraphicswidth}{\usebox{\DIFdelgraphicsbox}\\[-\baselineskip] \rule{\DIFdelgraphicswidth}{0em}}\llap{\resizebox{\DIFdelgraphicswidth}{\DIFdelgraphicsheight}{% %DIF PREAMBLE
\setlength{\unitlength}{\DIFdelgraphicswidth}% %DIF PREAMBLE
\begin{picture}(1,1)% %DIF PREAMBLE
\thicklines\linethickness{2pt} %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\framebox(1,1){}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\line( 1,1){1}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,1){\line(1,-1){1}}}% %DIF PREAMBLE
\end{picture}% %DIF PREAMBLE
}\hspace*{3pt}}} %DIF PREAMBLE
} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbegin}{\DIFaddbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddend}{\DIFaddend} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbegin}{\DIFdelbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelend}{\DIFdelend} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbegin}{\DIFOaddbegin \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbegin}{\DIFOdelbegin \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbeginFL}{\DIFaddbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddendFL}{\DIFaddendFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbeginFL}{\DIFdelbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelendFL}{\DIFdelendFL} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbeginFL}{\DIFOaddbeginFL \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbeginFL}{\DIFOdelbeginFL \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}
\DIFdelbegin %DIFDELCMD < \bstctlcite{IEEEexample:BSTcontrol}
%DIFDELCMD < %%%
\DIFdelend %DIF > \bstctlcite{IEEEexample:BSTcontrol}

\DIFdelbegin %DIFDELCMD < \title{%%%
\DIFdelend \DIFaddbegin \title[short title]{\DIFadd{Short: }\DIFaddend Basal-Adjust: Trend Prediction Alerts and Adjusted Basal Rates for Hyperglycemia Prevention}

\DIFdelbegin %DIFDELCMD < \author{Short Paper}
%DIFDELCMD < \begin{comment}%DIFDELCMD < 
%DIFDELCMD < \author{Chloe Smith\\
%DIFDELCMD < % }
%DIFDELCMD < % \authorrunning{F. Author et al.} 
%DIFDELCMD < % First names are abbreviated in the running head.
%DIFDELCMD < % If there are more than two authors, 'et al.' is used.
%DIFDELCMD < %
%DIFDELCMD < 
%DIFDELCMD < % \institute
%DIFDELCMD < { University of Virginia, Charlottesville, VA 22904, USA %\\
%DIFDELCMD < \email
%DIFDELCMD < %Department of Electrical and Computer Engineering,
%DIFDELCMD < {\{cas8ds\}@virginia.edu}\\
%DIFDELCMD < 
%DIFDELCMD < 
%DIFDELCMD < 
%DIFDELCMD < }
%DIFDELCMD < }
%DIFDELCMD < \end{comment}
%DIFDELCMD < %%%
\DIFdelend %DIF >  \author{Short Paper}
\DIFaddbegin \begin{comment}
\author{\\
% }
% \authorrunning{F. Author et al.} 
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%

% \institute
{ University of Virginia, Charlottesville, VA 22904, USA %\\
\email
%Department of Electrical and Computer Engineering,
{\{cas8ds\}@virginia.edu}\\



}
}
\end{comment}
\DIFaddend 

\DIFdelbegin %DIFDELCMD < \maketitle
%DIFDELCMD < \thispagestyle{plain}
%DIFDELCMD < \pagestyle{plain}
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \author{\DIFadd{Chloe Smith}}
%DIF >  \authornotemark[1]
\email{cas8ds@virginia.edu}
\affiliation{%
  \institution{University of Virginia}
  \city{Charlottesville}
  \state{Virginia}
  \country{USA}
  \postcode{22904}
  }
\DIFaddend 


\DIFaddbegin \author{\DIFadd{Maxfield Kouzel}}
%DIF >  \authornotemark[1]
\email{mak3zaa@virginia.edu}
\affiliation{%
  \institution{University of Virginia}
  \city{Charlottesville}
  \state{Virginia}
  \country{USA}
  \postcode{22904}
}


\author{\DIFadd{Xugui Zhou}}
%DIF >  \authornotemark[1]
\email{xugui@virginia.edu}
\affiliation{%
  \institution{University of Virginia}
  \city{Charlottesville}
  \state{Virginia}
  \country{USA}
  \postcode{22904}
}

\author{\DIFadd{Homa Alemzadeh}}
%DIF >  \authornotemark[1]
\email{ha4d@virginia.edu}
\affiliation{%
  \institution{University of Virginia}
  \city{Charlottesville}
  \state{Virginia}
  \country{USA}
  \postcode{22904}
}


\DIFaddend \begin{abstract} 
Significant advancements in type 1 diabetes treatment have been made in the development of state-of-the-art Artificial Pancreas Systems (APS). However, lapses currently exist in the timely treatment of unsafe blood glucose (BG) levels, especially in the case of rebound hyperglycemia. We propose a machine learning (ML) method for predictive BG scenario categorization that outputs messages alerting the patient to upcoming BG trends \DIFdelbegin \DIFdel{in order }\DIFdelend to allow for earlier, educated treatment. 
In addition to standard notifications of predicted hypoglycemia and hyperglycemia, we introduce BG scenario-specific alert messages and the preliminary steps towards precise \DIFdelbegin \DIFdel{increased basal rate }\DIFdelend \DIFaddbegin \DIFadd{basal }\DIFaddend suggestions for prevention of rebound hyperglycemia.
%As part of this method, we introduce carbohydrate input in a state of hypoglycemia as a parameter to determine increase basal insulin rates to be precisely recommended in our messages when a safe state is recovered in order to prevent rebound hyperglycemia. 
Experimental evaluation on the DCLP3 clinical dataset achieves >98\% accuracy and >79\% precision for predicting rebound high events for patient alerts.
\end{abstract}
%on a realistic closed-loop APS testbed using simulated data, an actual clinical dataset, and one participant's data

\DIFdelbegin %DIFDELCMD < \begin{IEEEkeywords}
%DIFDELCMD < %%%
%\DIFdel{safety, cyber-physical systems, medical device, wearable systems, body sensor networks.
%%DIFDELCMD < \end{IEEEkeywords}
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \ccsdesc[500]{Computer systems organization~Dependable and fault-tolerant system; Embedded and cyber-physical systems}
\ccsdesc{Applied computing~Life and medical sciences}
\ccsdesc[100]{Computing Methodologies~Machine learning; Modeling and simulation}
\DIFaddend 

\DIFaddbegin \keywords{
Safety, Cyber-Physical Systems, Medical Device, Wearable Systems, Body Sensor Networks.}

\maketitle
\thispagestyle{plain}
\pagestyle{plain}

\DIFaddend % \vspace{-2em}
\section{Introduction}
%para 1
% millions of people are suffering from Type I diabetes. APS is one of the effective treatments, however, often makes over- or under-adjustments of the BG and insulin amount, causing hypoglycemia to hyperglycemia rebound ...

%para 2
%DIF <  limitations of current work: (1) only use the nighttime data \cite{Taisa2020, Dutta2018,dsn2021zhou,zhou2023knowsafe} (2) without meals input
%DIF >  limitations of current work: (1) only use the nighttime data \cite{Taisa2020, Dutta2018,zhou2021data,zhou2023knowsafe} (2) without meals input

%para 3
% we propose a novel framework that encodes the carb info into an attention layer and considers its impact on the weights of each neuron at the different periods after taking a meal for better prediction of future BG sequences. The encoded carb info is stored as a short memory in the NN that indicated whether additional insulin adjustment is required using a binary output layer according to the BG sequence prediction. 
%experiments on the UVA-Padova simulator and an actual dataset from xx patients 

Patients with type 1 \DIFdelbegin \DIFdel{Diabetes are tasked with the monitoring and treatment of }\DIFdelend \DIFaddbegin \DIFadd{diabetes monitor and treat }\DIFaddend their BG levels, as their pancreases do not \DIFdelbegin \DIFdel{successfully }\DIFdelend produce the required levels of insulin. 
\DIFdelbegin \DIFdel{Great strides have been made in the management of type 1 Diabetes in the last 50 years, and in particular the development of wearable insulin pumps and Continuous Glucose Monitors (CGM) \mbox{%DIFAUXCMD
\cite{pumpHist}}\hskip0pt%DIFAUXCMD
,\mbox{%DIFAUXCMD
\cite{cgmHist}}\hskip0pt%DIFAUXCMD
. }\DIFdelend %DIF > Great strides have been made in the management of type 1 Diabetes in the last 50 years, and in particular, the development of wearable insulin pumps and Continuous Glucose Monitors (CGM) \cite{pumpHist},\cite{cgmHist}. 
Recent diabetes management research largely focuses on the development of \DIFdelbegin \DIFdel{closed-loop }\DIFdelend APS that combine insulin pump and CGM technology \cite{closedSupport}. One \DIFdelbegin \DIFdel{large task at hand }\DIFdelend \DIFaddbegin \DIFadd{present task }\DIFaddend is the improvement of APS controllers \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{study1}}\hskip0pt%DIFAUXCMD
, \mbox{%DIFAUXCMD
\cite{study2}}\hskip0pt%DIFAUXCMD
,\mbox{%DIFAUXCMD
\cite{study3} }\hskip0pt%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{study1,study2,study3} }\hskip0pt%DIFAUXCMD
or monitors \mbox{%DIFAUXCMD
\cite{zhou2021data,zhou2023hybrid,zhou2022robustness} }\hskip0pt%DIFAUXCMD
}\DIFaddend to detect and prevent \DIFdelbegin \DIFdel{cases of }\DIFdelend hyperglycemia \cite{hyper} and hypoglycemia \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{hypo} }\hskip0pt%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{mayolow}}\hskip0pt%DIFAUXCMD
, }\DIFaddend which in mild cases can cause blurred vision, \DIFdelbegin \DIFdel{difficulty concentrating, weakness or drowsiness}\DIFdelend \DIFaddbegin \DIFadd{weakness or confusion}\DIFaddend , and in extreme cases result in \DIFdelbegin \DIFdel{a }\DIFdelend coma or even death. \DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \DIFadd{An assurance case has been developed to verify the safety of ML-enabled APS \mbox{%DIFAUXCMD
\cite{bagheri2022towards}
}\hskip0pt%DIFAUXCMD
. }\DIFaddend %Several studies have focused on addressing various lapses in this process \cite{study1}, \cite{study2},\cite{study3}. 
%One such lapse is in rebound highs/lows \cite{reboundCGM}. 
 \DIFdelbegin \DIFdel{One of the limitations of the existing APS is in addressing the }\DIFdelend \DIFaddbegin \DIFadd{Existing APS doesn't fully address }\DIFaddend rebound highs/lows \cite{reboundCGM}.   
These are typical scenarios for \DIFdelbegin \DIFdel{patients with }\DIFdelend type 1 diabetes \DIFdelbegin \DIFdel{where after having treated }\DIFdelend \DIFaddbegin \DIFadd{patients where after treating }\DIFaddend an episode of \DIFdelbegin \DIFdel{hypoglycemia, their BG levelsincrease beyond }\DIFdelend \DIFaddbegin \DIFadd{out-of-range BG levels, BG shifts through }\DIFaddend the target range \DIFdelbegin \DIFdel{into a range of hyperglycemia ("rebound high"). Similarly, it is not uncommon for patients, after having treated hyperglycemia, to fall past the safe range into unsafe hypoglycemia ("rebound low "). 
Current BG prediction models and APS can }\DIFdelend \DIFaddbegin \DIFadd{to the opposite unsafe range (i.e., low to high or vice versa). 
%DIF > Similarly, it is not uncommon for patients, after having treated hyperglycemia, to fall past the safe range into unsafe hypoglycemia ("rebound low"). 
Current APS }\DIFaddend alert users about \DIFdelbegin \DIFdel{the rebound highs/lows}\DIFdelend \DIFaddbegin \DIFadd{upcoming trends}\DIFaddend , but they neglect to take or advise precise treatment\DIFdelbegin \DIFdel{actions}\DIFdelend .
%Hypoglycemia in a mild case can cause "blurred vision, difficulty concentrating, confused thinking, slurred speech, numbness, and drowsiness" among other symptoms. If hypoglycemia persists, it can cause "seizures, coma, and very rarely death" \cite{hypo}. Hyperglycemia commonly causes frequent urination, increase thirst, blurred vision, and feeling weak or unusually tired. In extreme cases, it can cause ketoacidosis, which can result in a coma or even death \cite{hyper}.

%In this paper, we discuss two causes of concern that, when addressed, can decrease the time out of the safe BG range.
In this paper, we propose methods for the prediction and prevention of rebound \DIFdelbegin \DIFdel{hyperglycemia }\DIFdelend \DIFaddbegin \DIFadd{highs }\DIFaddend which can be integrated with \DIFdelbegin \DIFdel{the existing APS applications }\DIFdelend \DIFaddbegin \DIFadd{existing APS }\DIFaddend to address the two following \DIFdelbegin \DIFdel{rebound }\DIFdelend concerns.
%\begin{itemize}
%    \item {
\DIFdelbegin \DIFdel{The first is the concern that patients with type 1 diabetes in the safe range }\DIFdelend \DIFaddbegin \DIFadd{First, patients }\DIFaddend may take action too late to prevent BG levels outside \DIFdelbegin \DIFdel{of }\DIFdelend the safe range. 
%For instance, if the CGM is currently reading a BG level in range (e.g., 140 mg/dL), the patient may not know when to consume carbs and/or glucose if at all, even if the BG level is indicated to be decreasing. By the time the patient is made aware of BG being low, the BG is already in the state of hypoglycemia or close to it. 
To address this case, we propose a predictive alert mechanism that uses an ML algorithm to estimate BG levels an hour \DIFdelbegin \DIFdel{in advance}\DIFdelend \DIFaddbegin \DIFadd{prior}\DIFaddend , categorizes BG trends into one of the several BG scenarios \DIFdelbegin \DIFdel{, and outputs messages alerting }\DIFdelend \DIFaddbegin \DIFadd{(e.g., }\textit{\DIFadd{rebound high}}\DIFadd{), and alerts }\DIFaddend the user of both general high/low BG levels and specific rebound scenarios.
%[decide if we want treatment suggestion as well. Most diabetics would know what to do with this existing message I would hope, but we could add "consider eating some carbs" if we want] 
Since carbohydrate \DIFaddbegin \DIFadd{(carb, CHO) }\DIFaddend ingestion takes time to affect BG levels, \DIFdelbegin \DIFdel{and insulin takes even longer to do so}\DIFdelend \DIFaddbegin \DIFadd{insulin even more}\DIFaddend , earlier action can mitigate unsafe BG levels \DIFdelbegin \DIFdel{. This will not only help prevent rebounds, but can also help }\DIFdelend \DIFaddbegin \DIFadd{and help users }\DIFaddend stay within the safe range. %those in the safe range to stay within it.
%}
%\item{

\DIFdelbegin \DIFdel{The second concern is of the over-correction of }\DIFdelend \DIFaddbegin \DIFadd{Second, }\DIFaddend low BG levels \DIFdelbegin \DIFdel{. In addition to the generation of predictive BG alerts mentioned above, we }\DIFdelend \DIFaddbegin \DIFadd{may be over-corrected. We }\DIFaddend introduce a method to recommend increases in basal \DIFdelbegin \DIFdel{rate administered by the insulin pump by a threshold }\DIFdelend \DIFaddbegin \DIFadd{injections given via insulin pump }\DIFaddend when BG has shifted to the safe range, based on \DIFdelbegin \DIFdel{carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{carb }\DIFaddend input entered when BG was \DIFdelbegin \DIFdel{below the safe range}\DIFdelend \DIFaddbegin \DIFadd{low}\DIFaddend . This adjusted basal output \DIFdelbegin \DIFdel{acts as a "carb carry-over" for earlier
carbohydrate inputs to account }\DIFdelend \DIFaddbegin \DIFadd{accounts for earlier
carb inputs once }\DIFaddend in the safe range, preventing a \DIFdelbegin \DIFdel{reactionary hyperglycemia episode from occurringafter experiencing hypoglycemia}\DIFdelend \DIFaddbegin \DIFadd{rebound high from occurring}\DIFaddend .
%}
%\end{itemize}
Addressing \DIFdelbegin \DIFdel{the issues of not foreseeing future BG trends and not carrying-over insulin that accounts for carbs after hypoglycemia both }\DIFdelend \DIFaddbegin \DIFadd{these two concerns }\DIFaddend help to attain in-range BG values. %for patients with type 1 diabetes.
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend Our contributions are as follows: 
\begin{enumerate}
    \item Predictive \DIFdelbegin \DIFdel{blood sugar alert mechanism with scenario-specific language }\DIFdelend \DIFaddbegin \DIFadd{alert mechanism }\DIFaddend based on an ML prediction model for BG \DIFdelbegin \DIFdel{scenario categorization }\DIFdelend \DIFaddbegin \DIFadd{scenario-specific categorization and messaging
    }\DIFaddend \item Preliminary steps towards developing a \DIFdelbegin \DIFdel{carry-over carb input method for increased basal rate }\DIFdelend \DIFaddbegin \DIFadd{method for delayed increased basal }\DIFaddend recommendations to patients for preventing hyperglycemia \DIFaddbegin \DIFadd{based on prior carb intake
    }\DIFaddend \item Evaluation using a realistic testbed's simulated \DIFdelbegin \DIFdel{data }\DIFdelend and actual patient data
\end{enumerate}

%\section{Random notes -- ignore! Thanks}
%Suspension of basal insulin to avoid hypoglycemia in type 1 diabetes treated with insulin pump - https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4285755/
%\\
%Evidence That Hyperglycemia After Recovery From Hypoglycemia Worsens Endothelial Function and Increases Oxidative Stress and Inflammation in Healthy Control Subjects and Subjects With type 1 Diabetes - https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3478543/
%\\
%: Ask UVA Endocrinologists about rebound high -- done
%\\Our main contributions are as follows: 
%\\1) Carry-over carb input method for hypoglycemia
%\\2) ML blood sugar prediction method
%\\3) an app to alert user to Carry-over carb and critical blood sugar predictions
%\\4) Quantitative simulation and qualitative in-person evaluation

\section{Background}
\textbf{Artificial Pancreas Systems:}
\begin{figure}
        \centering
    \includegraphics[scale=.38]{Figures/APS picture-5.png} \\
        \caption{Artificial Pancreas System}
        \label{fig:APS}
        \vspace{-1.5em}
    \end{figure}
As shown in Figure \ref{fig:APS}, APS are closed-loop systems that \DIFdelbegin \DIFdel{mimic the work of the pancreas to control blood sugar }\DIFdelend \DIFaddbegin \DIFadd{control BG }\DIFaddend levels using three devices: (i) a CGM that detects BG levels, (ii) a controller that intakes \DIFdelbegin \DIFdel{BG levels from the CGM (and at times external }\DIFdelend \DIFaddbegin \DIFadd{these BG levels (and }\DIFaddend user input, such as \DIFdelbegin \DIFdel{carbohydrate input}\DIFdelend \DIFaddbegin \DIFadd{carbs}\DIFaddend ) and determines insulin pump instructions (\DIFdelbegin \DIFdel{insulin dose)based on the inputs}\DIFdelend \DIFaddbegin \DIFadd{dose)}\DIFaddend , and (iii) an insulin pump which \DIFdelbegin \DIFdel{delivers insulin into the body based on the instructions from the controller}\DIFdelend \DIFaddbegin \DIFadd{injects instructed insulin doses}\DIFaddend . %This link between the body, CGM, controller, and insulin pump injecting back into the body causes the APS to be referred to as a \emph{Closed Loop System}. 
\DIFdelbegin \DIFdel{In this paper, we focus on the APS that allows for standard carbohydrate input. Users can also interact with the system by changing BG levels through }\DIFdelend \DIFaddbegin \DIFadd{We focus on APS that allow for standard carb input. BG levels are also impacted by }\DIFaddend temporary basal rate adjustments (e.g., for exercise), extended boluses (e.g., for \DIFdelbegin \DIFdel{fat-heavy }\DIFdelend \DIFaddbegin \DIFadd{fat-rich }\DIFaddend meals), or consuming \DIFdelbegin \DIFdel{carbohydrates }\DIFdelend \DIFaddbegin \DIFadd{carbs }\DIFaddend (e.g., \DIFdelbegin \DIFdel{in treating }\DIFdelend \DIFaddbegin \DIFadd{for }\DIFaddend low BG).

\DIFaddbegin \textbf{\DIFadd{Basal: }}
\DIFadd{Basal is an insulin injection often taken at a small, hourly rate to mimic a pancreas' gradual release to prevent high BG.
%DIF > \textbf{Bolus: }
%DIF > A bolus is an injection of insulin taken to combat high BG, oftentimes taken shortly before a meal as a measure to prevent hyperglycemia .
}

\DIFaddend \textbf{BG Safe Ranges: }
The safe range\DIFdelbegin \DIFdel{for BG levels is defined to be between }\DIFdelend \DIFaddbegin \DIFadd{, in which no negative symptoms exist, is defined between BG levels }\DIFaddend 70 and 180 $mg/dL$. \DIFdelbegin \DIFdel{BG values within this range are considered safe since they do not cause unpleasant symptoms or health risks. }\DIFdelend %that occur outside of the specified range. 
\emph{Hypoglycemia} refers to \DIFdelbegin \DIFdel{the cases in which BG levels are }\DIFdelend \DIFaddbegin \DIFadd{BG levels }\DIFaddend below 70 $mg/dL$, and \emph{hyperglycemia} refers to \DIFdelbegin \DIFdel{the cases where BG levels are }\DIFdelend \DIFaddbegin \DIFadd{BG levels }\DIFaddend above 180 $mg/dL$.

\textbf{Over-correction of Low BG: }
Over-correction of low BG occurs when consumption of \DIFdelbegin \DIFdel{carbohydrates }\DIFdelend \DIFaddbegin \DIFadd{carbs }\DIFaddend is beyond what is required to draw BG levels up from hypoglycemia to the safe range. 
%For example, if a patient with type 1 Diabetes has hypoglycemia at the start of a meal containing more carbohydrates than is needed to treat the hypoglycemia and does not carefully track BG level changes and administer insulin appropriately, an over-correction of low BG is likely to occur, resulting in hyperglycemia.
%For example, it is not uncommon for a patient with type 1 Diabetes to have a dip in BG before a meal. Yet, as the patient may receive an alert that their BG is below range soon before a meal and BG takes roughly 15-20 minutes to rise to a safe level, it is a notable case to consider the consumption of carbohydrates above what is required to raise BG from hypoglycemia (such as would be found in a typical meal). In this case, the insulin pump would be reticent to inject insulin for the whole carbohydrate intake (rightly so) as a safety precaution, since insulin lowers BG and the patient is currently in a state of hypoglycemia in this scenario. Yet, with the excessive ingestion of carbohydrates, it is common for this overcorrection to cause a spike in BG following the recovery of the safe state.
\DIFdelbegin \DIFdel{When a patient with type 1 diabetes experiences hypoglycemia, also called "low blood sugar," proper treatment involves raising }\DIFdelend \DIFaddbegin \DIFadd{In cases of hypoglycemia, treatment raises }\DIFaddend BG levels by consuming \DIFaddbegin \DIFadd{a set number of }\DIFaddend fast-acting \DIFdelbegin \DIFdel{carbohydrates (around 15-20 grams of sugary substances, such as glucose tablets or juice) and then waiting for a short period of time (typically about 15 minutes) \mbox{%DIFAUXCMD
\cite{mayolow}}\hskip0pt%DIFAUXCMD
. Afterwards, if BG levels remain below range, then the aforementioned treatment  is repeated. Once the BG is }\DIFdelend \DIFaddbegin \DIFadd{carbs in set intervals until BG is }\DIFaddend back in range \DIFdelbegin \DIFdel{, the patient consumes a portion of protein and longer-acting carbohydrates 
in order to prevent the BG from dropping back down into the low range. This dosing of carbohydrates in the case of hypoglycemia }\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{mayolow}}\hskip0pt%DIFAUXCMD
. This }\DIFaddend is less precise than a correction insulin dose for \DIFdelbegin \DIFdel{high blood sugar}\DIFdelend \DIFaddbegin \DIFadd{hyperglycemia}\DIFaddend , which is calculated \DIFdelbegin \DIFdel{based on the exact BG level
%DIF < . This makes it easier to incorrectly dose 
(although incorrect insulin dosing is also a problem \mbox{%DIFAUXCMD
\cite{smartPump}}\hskip0pt%DIFAUXCMD
)}\DIFdelend \DIFaddbegin \DIFadd{rather than set}\DIFaddend .
In addition, \DIFdelbegin \DIFdel{hypoglycemia at the start of meals can lead to the consumption of more carbohydrates than is }\DIFdelend \DIFaddbegin \DIFadd{meals often possess more carbs than are }\DIFaddend needed to treat \DIFdelbegin \DIFdel{the hypoglycemia, but }\DIFdelend \DIFaddbegin \DIFadd{hypoglycemia, and }\DIFaddend insulin dosing to \DIFdelbegin \DIFdel{counter them when in a state of hypoglycemia }\DIFdelend \DIFaddbegin \DIFadd{account for excess carbs when in this state }\DIFaddend can be risky.
%DIF > When a patient with type 1 diabetes experiences hypoglycemia, "low blood sugar," proper treatment involves raising BG levels by consuming fast-acting carbs (around 15-20 grams of sugary substances, such as glucose tablets) and then waiting for a set period of time (typically about 15 minutes) \cite{mayolow}. Afterwards, if BG levels remain below range, then the aforementioned treatment is repeated. Once BG is in range, the patient eats a portion of protein and longer-acting carbs 
%DIF > in order to prevent BG from dropping back into the low range.
%DIF > This dosing of carbs in the case of hypoglycemia is less precise than a correction insulin dose for high blood sugar, which is calculated based on the exact BG level
%DIF > . This makes it easier to incorrectly dose 
%DIF > (although incorrect insulin dosing is also a problem \cite{smartPump}). In addition, hypoglycemia at the start of meals can lead to the consumption of more carbs than is needed to treat the hypoglycemia, but insulin dosing to counter them when in a state of hypoglycemia can be risky.

\textbf{Rebound High/Low: }
\DIFdelbegin \DIFdel{When an over-correction of carbohydrates lifts the BG above the safe range rather than settling within the safe range, it is referred to as a }\DIFdelend \DIFaddbegin \DIFadd{Rebound hyperglycemia, or }\DIFaddend "\DIFdelbegin \DIFdel{rebound high.}\DIFdelend \DIFaddbegin \DIFadd{a rebound high,}\DIFaddend " \DIFdelbegin \DIFdel{Rebound hyperglycemia }\DIFdelend is defined in previous works as a "series of sensor glucose values (SGVs) >180 $mg/dL$ starting within two hours of an antecedent SGV <70 $mg/dL$" \cite{reboundCGM}. \DIFaddbegin \DIFadd{We define a rebound low as the reverse, a series of sensor glucose values (SGVs) <70 $mg/dL$ starting within two hours of an antecedent SGV <180 $mg/dL$. }\DIFaddend %In our system, 2 hours is equivalent to 24 APS timesteps.
%The term "rebound high" can become messy in the literature, as the same term is at 
\DIFdelbegin \DIFdel{The term }\DIFdelend "\DIFdelbegin \DIFdel{rebound }\DIFdelend \DIFaddbegin \DIFadd{Rebound }\DIFaddend high" \DIFdelbegin \DIFdel{is at times also used in the literature to }\DIFdelend \DIFaddbegin \DIFadd{can also }\DIFaddend refer to the Somogyi effect \cite{Somogyi}\DIFdelbegin \DIFdel{.
}\DIFdelend \DIFaddbegin \DIFadd{, 
}\DIFaddend %, which is itself often confused with the Dawn Phenomenon. The Dawn Phenomenon refers to a natural hormone release that increases in blood sugar in the morning while asleep. The Somogyi effect also occurs in the morning, but it is an increase in blood sugar that comes as a rebound from low blood sugar overnight, typically caused by natural hormone releases as an attempt to raise BG levels \cite{defDawnSomogyi}.
\DIFdelbegin \DIFdel{The Somogyi effect is }\DIFdelend an increase in blood sugar \DIFdelbegin \DIFdel{that comes }\DIFdelend in the morning as a \DIFdelbegin \DIFdel{rebound }\DIFdelend \DIFaddbegin \DIFadd{"rebound" }\DIFaddend from low blood sugar overnight, typically caused by natural hormone releases \DIFdelbegin \DIFdel{as an attempt to raise BG levels }\DIFdelend \cite{defDawnSomogyi}.
Although the Somogyi effect \emph{is} a rebound high, %However, in this study, when we refer to "rebound highs," we are not talking specifically about the rebounds that occur without intervention. We are speaking of rebound highs that occur from over-correction of hypoglycemia which then causes a spike in blood sugar.
%However, 
in this paper, we refer to "rebound highs" that occur due to over-correction of low BG\DIFdelbegin \DIFdel{causing a spike in blood sugar}\DIFdelend , and not the rebounds that occur without intervention. 

\section{Related Work}
%Type 1 Diabetes has been a target area of research for years, and thus there is a large body of related works from which we highlight the main categories that this paper builds upon.

%\begin{itemize}
%\item{
\textbf{Predictive BG Alerts:} \DIFdelbegin \DIFdel{Great strides have been made in predictive BG monitoring and notification in recent years. Some of the most popular manufacturers of medical devices for the management of }\DIFdelend \DIFaddbegin \DIFadd{In recent years, popular }\DIFaddend type 1 \DIFdelbegin \DIFdel{Diabetes }\DIFdelend \DIFaddbegin \DIFadd{diabetes management device manufacturers }\DIFaddend have rolled out predictive BG messages. \DIFdelbegin \DIFdel{For instance, }\DIFdelend Medtronic's Guardian Connect System 
\DIFdelbegin \DIFdel{reports to be able to }\DIFdelend \DIFaddbegin \DIFadd{claims to }\DIFaddend predict BG 10-60 minutes in advance and \DIFdelbegin \DIFdel{to notify the patient in order to inform preemptive treatment decisions }\DIFdelend \DIFaddbegin \DIFadd{inform the patient of preemptive treatments }\DIFaddend \cite{fdaGuardian}. 
%ML-based prediction
\DIFdelbegin \DIFdel{Recent advancement in }\DIFdelend \DIFaddbegin \DIFadd{New }\DIFaddend data-driven technologies 
\DIFdelbegin \DIFdel{has also promoted research works that can }\DIFdelend %DIF > has 
\DIFaddbegin \DIFadd{can also }\DIFaddend predict BG accurately for a maximum \DIFdelbegin \DIFdel{period }\DIFdelend of 2 hours in \DIFdelbegin \DIFdel{the future }\DIFdelend \DIFaddbegin \DIFadd{advance }\DIFaddend \cite{Taisa2020,Dutta2018}. However, these \DIFdelbegin \DIFdel{works primarily focus on BG prediction at nighttime without considering }\DIFdelend \DIFaddbegin \DIFadd{do not consider }\DIFaddend more complex scenarios, such as multiple variate meal inputs \DIFaddbegin \DIFadd{outside of night hours}\DIFaddend . %zhou2023knowsafe
\DIFdelbegin \DIFdel{In addition, they do not recognize and refer to common scenarios (such as }\DIFdelend \DIFaddbegin \DIFadd{They also lack precise treatment advice and labeled scenarios (e.g., }\DIFaddend "rebound high")\DIFdelbegin \DIFdel{beyond general hyperglycemia and hypoglycemia 
alerts and lack precise treatment advice.
}\DIFdelend \DIFaddbegin \DIFadd{.
%DIF > do not recognize and refer to common scenarios (such as "rebound high") beyond general hyperglycemia and hypoglycemia alerts and lack precise treatment advice. 
}\DIFaddend %In addition, though they seem to be fairly proficient at predictive notification, another limitation of them that we sought to address in our study was sorting various scenarios with the common language of "rebound high" or "rebound low" when on the outside of the range on either end and predicting to swap to the other. Though this sort of adjustment is small, it is helpful to progress the notifications to recognize and use language for scenarios that are common and used in the language of both endocrinologists and lay patients with type 1 diabetes. A third limitation we address is the lack of precise treatment advice. We sought to provide insulin dosage suggestions based on carbohydrate input in the case of a predicted rebound high.
%}

%\item{
\textbf{Rebound Hyperglycemia:}
\DIFdelbegin \DIFdel{A large focus }\DIFdelend \DIFaddbegin \DIFadd{Much }\DIFaddend of our work \DIFdelbegin \DIFdel{is rebound hyperglycemiacases}\DIFdelend \DIFaddbegin \DIFadd{focuses on rebound hyperglycemia}\DIFaddend . A very recent study \DIFdelbegin \DIFdel{on this topic evaluates using predictive BG alerts to prevent rebound hyperglycemia events \mbox{%DIFAUXCMD
\cite{reboundCGM}}\hskip0pt%DIFAUXCMD
. The study utilized existing predictive alerts that notify patients of predicted hyperglycemia and hypoglycemia in general. With this system in place, they evaluated the impact of the predictive systems on preventing cases of specifically rebound hyperglycemia within participants}\DIFdelend \DIFaddbegin \DIFadd{evaluates the impact of existing nonspecific predictive alerts to notify patients and prevent cases of rebound hyperglycemia \mbox{%DIFAUXCMD
\cite{reboundCGM}}\hskip0pt%DIFAUXCMD
}\DIFaddend .
However, \DIFdelbegin \DIFdel{there are similar limitations }\DIFdelend \DIFaddbegin \DIFadd{similar limitations exist }\DIFaddend in this rebound-focused work\DIFdelbegin \DIFdel{that we address}\DIFdelend .
%\begin{enumerate}
    %\item{
    \DIFdelbegin \DIFdel{First, this study also }\DIFdelend \DIFaddbegin \DIFadd{This study }\DIFaddend did not use alerts that specifically recognize \DIFdelbegin \DIFdel{the case of rebound highsand/or use that language in the predictive alerts .%DIF < }
    %DIF < \item {
    Second, alerts that simply notify the user of predicted out-of-range BG values require the user to create treatment actions without }\DIFdelend \DIFaddbegin \DIFadd{rebound highs, and the alerts did not provide }\DIFaddend direct recommendations of insulin amounts.
    %DIF < and we use them in our own study, they act as calls to action for the user to give treatment based on the alert information. This creates a limitation of relying on user action when it is not needed.
    %DIF > \item {
    %DIF > Second, alerts that simply notify the user of predicted out-of-range BG values require the user to create treatment actions without direct recommendations of insulin amounts. %and we use them in our own study, they act as calls to action for the user to give treatment based on the alert information. This creates a limitation of relying on user action when it is not needed.
    %\\There is research on giving automatic corrective insulin doses for high blood sugar \cite{smartPump}, but an automated increase in basal insulin rate or automatic extended bolus insulin dose once back in safe range based on carbs entered while in a state of hypoglycemia is largely missing from this discussion.}
    %}

    \DIFdelbegin \DIFdel{In order to address the limitationsof existing works}\DIFdelend \DIFaddbegin \DIFadd{To address such limitations}\DIFaddend , we propose a BG prediction model that \DIFdelbegin \DIFdel{produces messages by acknowledging specific 
    scenarios by name and recommending a precise increased insulin in the case of }\DIFdelend \DIFaddbegin \DIFadd{provides specific 
    scenario alerts and gives precise insulin recommendations for }\DIFaddend a rebound high.
    %DIF < \end{enumerate}
%DIF < }
%DIF < \end{itemize}

\section{Methods}
\begin{figure}[t!]
    \centering
\includegraphics[scale=.45]{Figures/Fig2RememberBolus.png} \\
    \caption{Overall Design of Rebound High Evaluation Module}
    \label{fig:reboundHighArch}
    \vspace{-1.5em}
\end{figure}
We propose to supplement the existing APS controllers with mechanisms for preventing rebound hyperglycemia events. 
As shown in Figure \ref{fig:reboundHighArch}, our proposed Rebound High Evaluation module is designed using
%A preliminary survey, 
ML-based APS state prediction, a recommended increased basal insulin to \DIFdelbegin \DIFdel{carry-over prior carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{address carb }\DIFaddend input, and response alert message generation to assist patients in the detection and mitigation of rebound highs. %which can be integrated with the existing APS controllers to assist patients in 

\begin{comment}
\subsection{Preliminary Survey}A preliminary survey was sent to ~10 participants to gain a general understanding of hypoglycemia treatment and rebound highs in the experience of actual
patients. The survey involved three demographic questions and eight questions about responding to and predicting out-of-range BG levels.
\end{comment}

\subsection{ML Model for Blood Sugar Prediction}\label{workflowdata}
\begin{figure}[b!]
    \vspace{-2em}
    \centering
\includegraphics[scale=.2]{Figures/FigEncodeDecode-6.png} \\
    \caption{ML Model for Blood Sugar Prediction}
    \label{fig:encodeDecode}
\end{figure}
\DIFaddbegin 

\DIFaddend To forecast future BG levels and detect \DIFdelbegin \DIFdel{future BG }\DIFdelend trends, we design an encoder-decoder ML model with an attention layer \DIFdelbegin \DIFdel{that takes in a sequence of APS states , where each }\DIFdelend \DIFaddbegin \DIFadd{given APS states as input that outputs expected BG values (see Figure \ref{fig:encodeDecode}). Each }\DIFaddend state contains BG, insulin dosage, insulin on board (IOB), and \DIFdelbegin \DIFdel{carbohydrates, and outputs expected BG values (see Figure \ref{fig:encodeDecode})}\DIFdelend \DIFaddbegin \DIFadd{carbs}\DIFaddend . The encoder generates a deep representation of the sequence of input states that the decoder uses to initialize its internal state as it predicts the BG value for the next timestep using the current APS state.
\DIFaddbegin 

\DIFadd{We chose this architecture due to its success in sequence generation tasks \mbox{%DIFAUXCMD
\cite{hochreiter1997, BahdanauAttn}}\hskip0pt%DIFAUXCMD
.
Unlike other blood glucose prediction models that give a single estimate of BG at a fixed prediction horizon (e.g. 30 or 60 minutes), the encoder-decoder model generates a full sequence of BG predictions up to and including the prediction horizon where each previous prediction is factored into the next prediction autoregressively. This allows for the detection of the earliest possible occurrence of an adverse event, such as a rebound high. 
}

\DIFadd{The attention layer has also been shown to help the decoder process the information learned by the encoder during prediction by amplifying relevant features, suppressing unimportant ones, and improving performance of encoder-decoder models in a variety of application scenarios \mbox{%DIFAUXCMD
\cite{BahdanauAttn, Zhu2022, Muralidhar2019}}\hskip0pt%DIFAUXCMD
. Finally, it followed to use a recurrent neural network as the underlying layer in the encoder and decoder because the APS data has temporal order, so we chose the LSTM to retain past information over longer input sequences.
}



\DIFaddend The following equations describe the flow of information through the model:
%DIF < \vspace{-1em}
%DIF < {%\scriptsize
\DIFdelbegin \begin{align*}
    \DIFdel{h_{enc} }&\DIFdel{= Encoder(X_{[t-n+1, t]}) }\\
    \DIFdel{s_{t'+1} }&\DIFdel{= (h_{t'+1}, z_{t'+1}) = LSTM(x_{t'}, s_{t'}, c_{t'+1}) }\\
    \DIFdel{c_{t'+1} }&\DIFdel{= A \cdot h_{enc} }\\
    \DIFdel{A }&\DIFdel{= \text{softmax}\left( w_v \cdot \text{tanh} ( W_q h_{t'} + W_k h_{enc} ) \right) }\\
    \DIFdel{\widehat{bg}_{t'+1} }&\DIFdel{= f(h_{t'+1})
}\end{align*}%DIFAUXCMD
\DIFdelend \DIFaddbegin \begin{align}
    \DIFadd{h_{enc} }&\DIFadd{= Encoder(X_{[t-n+1, t]}) }\\
    \DIFadd{s_{t'+1} }&\DIFadd{= (h_{t'+1}, z_{t'+1}) = LSTM(x_{t'}, s_{t'}, c_{t'+1}) }\\
    \DIFadd{c_{t'+1} }&\DIFadd{= A \cdot h_{enc} }\\
    \DIFadd{A }&\DIFadd{= \text{softmax}\left( w_v \cdot \text{tanh} ( W_q h_{t'} + W_k h_{enc} ) \right) }\\
    \DIFadd{\widehat{bg}_{t'+1} }&\DIFadd{= f(h_{t'+1})
}\end{align}\DIFaddend 
%}%
\noindent where $X_{[t-n+1, t]}$ is the past $n$ APS states, and $h_{enc}$ represents the input learned by the encoder for all timesteps. In the decoder, \DIFaddbegin \DIFadd{described by the final four equations (2)-(5), }\DIFaddend $x_{t'}$ is the projected APS state for future time $t'$, $s_{t'}$ is the decoder's internal state \DIFdelbegin \DIFdel{composed of }\DIFdelend \DIFaddbegin \DIFadd{with }\DIFaddend a hidden state $h_{t'}$ and a cell state $z_{t'}$, and $c_{t'}$ is the context vector generated by the attention layer using the attention weight matrix $A$. The decoder's hidden state $h_{t'}$ is passed through a feedforward neural network, $f$, to generate the predicted BG value, $\widehat{bg}$. The decoder calculates $s_{t'}$ for $t' \in [t+1, t+m]$, where $m$ is the length of BG predictions. $W_q$, $W_k$, and $w_v$ are weights tuned in the attention layer.

The attention layer within the decoder calculates how much the decoder should weigh each part of the input data (i.e.\DIFaddbegin \DIFadd{, }\DIFaddend how much attention it should give) and uses a feedforward neural network to generate attention weights \cite{BahdanauAttn}. \DIFdelbegin \DIFdel{In order to }\DIFdelend \DIFaddbegin \DIFadd{To }\DIFaddend help the model learn the delayed action of \DIFdelbegin \DIFdel{carbohydrates on BG}\DIFdelend \DIFaddbegin \DIFadd{carbs on BG, }\DIFaddend which needs 15-30 minutes to start impacting BG \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{30min}}\hskip0pt%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{30min, freeman2009}}\hskip0pt%DIFAUXCMD
}\DIFaddend , we customize the attention layer to increase the attention weight for input states 30 minutes after a \DIFdelbegin \DIFdel{carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{carb }\DIFaddend input by 10\%. \DIFaddbegin \DIFadd{Forcing the model to focus on these states should help it learn  to account for the physiological delay that the meal carbs take to affect BG. 
}\DIFaddend %to focus the model's attention on more physiologically relevant parts of the input.   
\subsection{Recommended \DIFaddbegin \DIFadd{Increased }\DIFaddend Basal \DIFdelbegin \DIFdel{Increase }\DIFdelend for Carb Carry-over}
We propose a method to find \DIFdelbegin \DIFdel{a basal rate percent increase threshold for when carbohydrates }\DIFdelend \DIFaddbegin \DIFadd{basal increase when carbs }\DIFaddend are entered into the APS \DIFdelbegin \DIFdel{controller by the patient while 
BG is below the safe range}\DIFdelend \DIFaddbegin \DIFadd{while 
hypoglycemic}\DIFaddend . We calculate an \DIFdelbegin \DIFdel{increase }\DIFdelend \DIFaddbegin \DIFadd{increased }\DIFaddend basal (IB) using the existing \DIFdelbegin \DIFdel{carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{carb }\DIFaddend input data in the Basal-Bolus controller (typically used for meal bolus generation). We then recommend the IB to be applied once the BG level has returned to a safe range.

% There exists an increase bolus such that if the increase bolus is injected (given carbohydrates?), then from current time until 24 timesteps (2 hours) from now, BG will be in range
Specifically, our goal is to find a new, corrected basal \DIFdelbegin \DIFdel{rate }\DIFdelend $IB$ that is $\delta$ units of insulin greater than the current basal rate, $r_t$, for time $t$ such that all predicted BG values \DIFdelbegin \DIFdel{within the hour $BG_{[t,t+12]}$ }\DIFdelend \DIFaddbegin \DIFadd{once the target range is entered, $t_{tr}$, }\DIFaddend are in range \DIFdelbegin \DIFdel{: 
}\DIFdelend \DIFaddbegin \DIFadd{within the next hour $BG_{[t_{tr},t_{tr}+12]}$: 
}\DIFaddend \begin{equation}
    IB = r_t + \delta \Rightarrow 70 < BG\DIFdelbegin \DIFdel{_{[t,t+12]} }\DIFdelend \DIFaddbegin \DIFadd{_{[t_{tr},t+12-t_{tr}]} }\DIFaddend < 180
    % \exists {IB} \ni Inj(IB) \rightarrow (i = t, ..., t+24 | 70 < x_i < 180)
\end{equation}

%As a simple solution, we can use fixed $\delta$s (0.0, 0.2, 0.4, ... 3.8, 4.0). 
\DIFdelbegin \DIFdel{We set an optimization problem that minimizes timesteps outside of the BG safe range by running in the prediction model using a set of fixed  $\delta$s to find an optimal $\delta$ among them. We then add this $\delta$ value to the normal basal rate to find an $IB$ to be suggested in the alert message.
}\DIFdelend %DIF > We set an optimization problem that minimizes timesteps outside of the BG safe range by running in the prediction model using a set of fixed  $\delta$s to find an optimal among them. We then add this $\delta$ to the normal basal rate to find an $IB$ to be suggested in the alert.
%Where $Inj()$ is to inject, $i$ is an APS timestep, $t$ is current time, and $x_t$ is predicted BG at time $t$
\DIFdelbegin \DIFdel{Solving this optimization problem }\DIFdelend \DIFaddbegin \DIFadd{Optimizing }\DIFaddend for the most accurate IB is the subject of future work and beyond the scope of this paper. For this paper, we used domain knowledge and heuristics to add some fixed $\delta$ values for \DIFdelbegin \DIFdel{the ideal value }\DIFdelend \DIFaddbegin \DIFadd{an ideal }\DIFaddend to be found among them \DIFaddbegin \DIFadd{via optimization that minimizes timesteps outside of the BG safe range in predictions}\DIFaddend . 
%Future work will implement an optimization of IB.
%A solution to this problem involves... which is the subject of future work and beyond the scope of this paper.
\subsection{Rebound High Evaluation and Alert Generation}
\begin{table*}[]
    \centering
    \caption{Rebound High Alert System Performance Metrics}
    \vspace{-0.5em}
    \begin{tabular}{c|c|c}
        &\textbf{BG Scenario} & \textbf{Alert Message} \\
        \hline
        1 & $((x_{p} > 180)\wedge(t=p-24,...,p|x_t \not < 70)$ & "Your blood sugar is predicted to increase to 180 mg/dL in the next hour. \\
        2 & $((x_{p} > 180)\wedge(t=p-24,...,p|x_t < 70)$ & You are predicted to have a rebound high in the next hour.  \DIFdelbeginFL \DIFdelFL{Increase basal }\DIFdelendFL \\
        &&  \DIFdelbeginFL \DIFdelFL{rate to }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Give a temp basal of }\DIFaddendFL $IB$ \DIFdelbeginFL \DIFdelFL{for a period }\DIFdelendFL once you are back in range.  \\
        3 & $((x_{p} < 70)\wedge(t=p-24,...,p|x_t \not > 180)$ & Your blood sugar is predicted to decrease to 70 $mg/dL$ in the next hour.  \\
        4 & $((x_{p} < 70)\wedge(t= p-24,...,p|x_t > 180)$ & "You are \DIFdelbeginFL \DIFdelFL{expected }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{predicted }\DIFaddendFL to have a rebound low in the next hour. \DIFdelbeginFL \DIFdelFL{Consider suspending }%DIFDELCMD < \\
%DIFDELCMD <         && %%%
\DIFdelFL{insulin for a period}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Suspend insulin temporarily}\DIFaddendFL ." \\
        5 & else & - no message - \\
        \vspace{1em}
    \end{tabular}

    $x_t$ represents predicted BG level at a given timestep $t$, $p$ is the most up-to-date predicted timestep, $IB$ is the calculated Increased Basal value.
    \label{tab:alert_messages}
    \vspace{-1em}
\end{table*}
% how model is used for rebound high detection
The \DIFaddbegin \DIFadd{prediction model's }\DIFaddend forecasted BG sequence \DIFdelbegin \DIFdel{from the prediction model }\DIFdelend can be used to detect hyperglycemia, hypoglycemia, and rebound events in advance. Predicted \DIFdelbegin \DIFdel{BG }\DIFdelend and past BG states are categorized to output appropriate alert messages as shown in Table \ref{tab:alert_messages}.
If BG is predicted to be \DIFdelbegin \DIFdel{above range without having been below range in the past hour (row }\DIFdelend \DIFaddbegin \DIFadd{out of range without being a rebound (rows }\DIFaddend 1\DIFdelbegin \DIFdel{), or BG is predicted to be below range without having been above range in the past hour (row }\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend 3), then general alerts \DIFdelbegin \DIFdel{such as those in the existing models \mbox{%DIFAUXCMD
\cite{fdaGuardian} }\hskip0pt%DIFAUXCMD
}\DIFdelend are issued.
%If the model is set to make BG predictions for the next hour, a rebound high can be anticipated up to 1 hour beforehand by checking whether any of the expected BG levels are hyperglycemic when after a recent hypoglycemic BG value.
%In the case that a BG is predicted to be out of range (70 mg/dL to 180 mg/dL), a message will be generated to notify the patient of the predicted BG value and the estimated time, as seen in \ref{tab:alert_messages}. A typical prediction horizon 12 timesteps from the current state, where each time step is 5 minutes, resulting in prediction up to 60 minutes before the occurrence of an adverse event. This means that we can generate alerts to warn users to take preventative action well before their BG levels become abnormal. Messages have the format of Your blood sugar is predicted to (increase/decrease) to (70 $mg/dL$/180 $mg/dL$) in 60 minutes. 
%Similar message of general high/low predictions, as output by our classifying ML method, exist in current models \cite{fdaGuardian}
%However, in addition to these notifications of general high and low BG alerts (as is commonplace), we have included messages more tailored to the situations of rebound highs and lows. For instance, the message "You are predicted to have a rebound high in the next hour. Please increase basal rate by XXx\% for additional carbs once you are back in range." followed by a message once back in range reminding the patient to increase basal by a suggested amount for excess carbohydrates.
If \DIFdelbegin \DIFdel{BG is predicted to be }\DIFdelend \DIFaddbegin \DIFadd{predicted BG is }\DIFaddend high within two hours of being \DIFdelbegin \DIFdel{below range }\DIFdelend \DIFaddbegin \DIFadd{low }\DIFaddend (row 2), then a rebound high alert with recommended IB is issued.
If \DIFdelbegin \DIFdel{BG is predicted to be }\DIFdelend \DIFaddbegin \DIFadd{predicted BG is }\DIFaddend low within two hours of being \DIFdelbegin \DIFdel{above range }\DIFdelend \DIFaddbegin \DIFadd{high }\DIFaddend (row 4), then a rebound low alert with recommended basal suspension is issued.
These messages include scenario-specific language for the rebound cases \DIFdelbegin \DIFdel{, and they provide specific action }\DIFdelend \DIFaddbegin \DIFadd{and provide specific }\DIFaddend suggestions.


% we may need to formally define the problem and ML structure as we did in the KnowsSafe paper
%\textbf{Problem Statement:}
We specifically define the following contextual conditional event to trigger an alert for a rebound high:
%over a combined of input BG trace $BG_{[t-n+1, t]}$ and output BG trace $BG_{[t+1, t+m]}$: 

\vspace{-1em}
% \begin{align}
{%\scriptsize
%Given that current BG is below 70, the probablility of a rebound high is the probablility that predicted BG will be above 180 within 24 steps of the low
%P(RH|x_{c} > 180)= P((x_{t} < 70 | (c - 24) < t < c))
%\begin{equation}    
%P(RH|x_c < 70) = P(x_t > 180 | t = c,...,c+24)
%\end{equation}
}%

\begin{equation}    
%y_t = P(\exists k \in [0. 24]: x_{t_{c}+24-k}>24 |x_{t_{c}-k}<70)
% \Scale[0.8]{y_t = P(\exists l, h \in [t-12,t+12]: l < h \hspace{0.5mm} \wedge \hspace{0.5mm} BG_{l}<70 \hspace{0.5mm} \wedge \hspace{0.5mm} BG_{h}>180)}
%\Scale[0.9]{y_t = P(\exists t \ni t-12<l<h<t+12: BG_{l}<70 \wedge BG_{h}>180)}
\DIFdelbegin %DIFDELCMD < \Scale[0.9]{y_t = P(\exists t-12<l<h<t+12: BG_{l}<70 \wedge BG_{h}>180)}
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \Scale[0.99]{y_t = P(\exists t-12<l\leq t < h\leq t+12: BG_{l}<70 \wedge BG_{h}>180)}
\DIFaddend %
% {y_t = P(\exists l, h \in [0,12]: BG_{t-l}<70 \hspace{0.5mm} \wedge \hspace{0.5mm} BG_{t+h}>180)}
\end{equation}
%\begin{equation}    
% RH \Leftrightarrow \exists t_l, t_h \in [t-n+1, t+m] \text{s.t.} t_l < t_u \wedge BG_{t_u} < 70 \wedge BG_{t_h} > 180
%y_t = P(\exists l, h \in [0,24]: BG_{u}>180 |BG_{l}<70)
%\end{equation}
% \begin{equation}
% \label{eq:ml-model}
% \begin{split}
%     % x_{t} &= (x_{1}(t),x_{2}(t),...,x_{m}(t))^T \\ 
%     x_{t} &= (x_{1_{t}},x_{2_{t}},...,x_{n_{t}}) \\
%    % 
%     y_{t} &= p(\exists t'\in [t,t_{e}]: x_{t'} \in {\mathcal{X}}_{h}|x_{t},u_{t})
% \end{split}
% \end{equation}
\noindent where $t$ is the current time and $l$, $h$ are APS timesteps. An alert triggers \DIFdelbegin \DIFdel{whenever }\DIFdelend \DIFaddbegin \DIFadd{when }\DIFaddend $y_t \ge 0.5$. $BG$ is the sequence of \DIFdelbegin \DIFdel{blood glucose }\DIFdelend \DIFaddbegin \DIFadd{BG }\DIFaddend values over 2 hours: (1) observed \DIFdelbegin \DIFdel{BG }\DIFdelend values within the previous hour and (2) predicted \DIFdelbegin \DIFdel{BG }\DIFdelend values for the next hour from the prediction model. This allows for the detection of rebound highs up to 1 hour in advance.
%The prediction model takes in the first hour of BG values as input and predicts the next hour of BG values as output, allowing for detection of rebound highs up to 1 hour in advance.
%\noindent Where $k$ and $t$ are APS timesteps, $t_c$ is current time, $BG$ indicates measured BG, and $x$ represents predicted BG at a given time
%where $RH$ is a rebound high event, $c$ represents current time, $t$ indicates timesteps, $BG$ indicated measured BG, and $x$ represents predicted BG to detect rebound highs.



% we also need to define rebound high/low more apparently as well as its labelling method.
% how we label rebound highs
%A rebound hyperglycemia occurs in when the BG level exceeds 180 mg/dL after being below 70 mg/dL within 2 hours (24 APS timesteps) prior. 

%  I think we could have an overall struct figure of our design in the beginning and then present each section in the similar workflow in the graph.

%\subsection{Predictive Critical BG Alerts:} moved above
\begin{comment}
{\emph{Carb Entry Checker:} 
    %In the "Any clarification/notes about early questions/responses?" the only note left was "Not the best diabetic at remembering to dose."
    For a patient to manage their type 1 diabetes well, it is critical for them to give insulin doses for the amount of carbohydrates they consume. Yet, the failures in dosing appropriately have been widely reported \cite{doseprob1, doseprob3}, with the general conclusion that "Adherence to insulin therapy is generally poor" \cite{doseprob2}. Though patients can set reminders to dose on devices such as phones, with varying mealtimes this is not entirely effective. There are two options for carb reminders in this proposed application:
    \\\begin{enumerate}
    \item {A very general and simplistic method can exist to generate warning messages when blood sugar readings from the CGM increase have increased more than 10 mg/dL within 4 CGM time steps (20 minutes). Of course, this would be an unnecessary message in the case of raising blood sugar apart from a meal, such as routinely occurs during exercise.
    \item A more precise measurements can be found in state-of-the-art meal detection studies. For example, in an earlier work, a simulation-based explanation of meal detection is proposed which is able to detect a meal an average of 27 minutes into the meal within 1 g of carbohydrates consumed \cite{mealDetect}. In order to add this to an app it would have to be partnered with one of these algorithms, made similarly from scratch, or found as an open-source version.
    \\The message at a time when a meal has been detected would be structured like this: "Your blood sugar is increasing rapidly. Please check that you have entered all carbs." If using a more precise algorithm, it could even recommend a predicted carb count, or even inject an insulin dose automatically. This alert would act as a safety net for missing insulin doses.
    %\\It is very pertinent to the discussion surrounding the prevention of rebound hyperglycemia. As in the survey, all participants indicated that when they noticed low blood sugar at the start of the meal they would eat immediately after treating with glucose, and 66.7\% indicated that they typically waited until they were back in range to give insulin for their meal, combined with the facts that the main CGMs on the market today do not notify the patient when their blood sugar is back in range and there has been evidence of missing insulin doses within the treatment of type 1 diabetes among patients, a reminder alert to give insulin for carbs consumed once BG values are increasing could clearly decrease the number of times that a patient forgets to give insulin for an over-correction of low BG.
    }
    \end{enumerate}}
\emph{General Carb entry reminders:} This element of the app is the least complex, but in the same vein of it being critical for patients with type 1 diabetes to have carbs accounted for in their systems, we envision the app having regular reminds several times in a day at common meal (and potentially snack) times.

This feature existing within the same app as the carb entry checker makes sense since they are so closely related, and it can prevent hyperglycemia through patients having support to build carb-entering habits.
%\end{itemize}
\end{comment}


\section{Experimental Evaluation}
\subsection{Datasets}
\begin{figure}
        \centering
    \includegraphics[scale=.45]{Figures/FigEvalGenRemember.png} \\
        \caption{Experimental Evaluation with Realistic Testbeds and Datasets}
        \label{eval}
        \vspace{-2em}
    \end{figure}
As shown in Fig. \ref{eval}, %our closed-loop APS testbed uses the Basal-Bolus controller with UVA-Padova Type I Diabetes Simulation. 
we use three different datasets for developing and evaluating our models, including (i) simulation data generated from a closed-loop APS testbed, (ii) a dataset collected from diabetes patients in a clinical trial, and (iii) APS data collected from one patient with type 1 diabetes. 

% Simulation data description
\textbf{Simulation Data:} The first dataset we used was generated using the UVA/Padova Type I Diabetes Simulator integrated with an open-source APS controller (Basal-Bolus) \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{zhou2022design}}\hskip0pt%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{zhou2022design,zhou2021data}}\hskip0pt%DIFAUXCMD
}\DIFaddend . 
The simulator uses an Ordinary Differential \DIFdelbegin \DIFdel{Equation (ODE)-based }\DIFdelend \DIFaddbegin \DIFadd{Equation-based }\DIFaddend patient model that updates using insulin received from the pump and pre-scheduled meals. The pump insulin is determined by the controller, which sets basal rates based on the virtual patient's profile and assigns boluses after a meal. CGM readings are taken from the true patient subcutaneous BG with simulated noise. This simulates a closed-loop APS system, and meals can be scheduled to occur at any simulation time\DIFdelbegin \DIFdel{\ref{eval}}\DIFdelend .

For 10 adult virtual patients, we chose 6 initial BG values each from 80 to 180 and ran 75 simulations at each initial value. In each simulation, the data interacts with the controller for 145 timesteps (12 hours + initial state)\DIFdelbegin \DIFdel{, with each timestep in the simulation representing }\DIFdelend \DIFaddbegin \DIFadd{. Each timestep represented }\DIFaddend 5 minutes in the actual APS. Each simulation had a meal of a random size between 30 and 100 grams of \DIFdelbegin \DIFdel{carbohydrates }\DIFdelend \DIFaddbegin \DIFadd{carbs }\DIFaddend after the first hour. This yielded 65,250 samples per patient \DIFdelbegin \DIFdel{, }\DIFdelend or roughly 7.5 months of data.


% Clinical trail data description
\textbf{Clinical Trial Data:} We also used DCLP3, a publicly-available clinical trial dataset with \DIFdelbegin \DIFdel{6 months of }\DIFdelend CGM and insulin pump data for each participant \cite{DCLP3-dataset}. We chose 5 patients with at least 6 months of data\DIFdelbegin \DIFdel{to use}\DIFdelend .

% Chloe's data
\textbf{Participant Data:} We also used 5 days of APS data (BG and insulin) retrieved from a patient with type 1 diabetes participating in our research. Because this is not enough data to train the model alone, we used transfer learning with testbed simulation data to supplement model learning.
%by training the model on data from 5 different virtual patients from the UVA/Padova simulator, then fine tuning the model using part of the participant data, and finally evaluating the model on the rest of the participant data.
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin {\bfseries\small \Text\par}
\DIFaddend \subsection{Labeling and Model Training}
\DIFaddbegin \DIFadd{During evaluation, the encoder was composed of 1 LSTM layer and the decoder was composed of the attention layer, 1 LSTM layer, and 2 dense layers (both with linear activation). Each LSTM layer and the attention layer had hidden dimension of 64, the first dense layer had hidden dimension of 32, and the final had 1. Training was conducted used the Adam optimizer with learning rate 1e-3 for 10 epochs for Simulation data and 20 epochs for DCLP3 data.
}

\DIFaddend For the Simulation and DCLP3 Clinical Trial datasets, we split the data for each patient into train and test sets using an 80/20 split. For participant data, we used the same 80/20 split, but we first trained the model on data from 5 different virtual patients from the UVA/Padova simulator and then fine tuned the model with a low learning rate \DIFaddbegin \DIFadd{of 1e-5 }\DIFaddend to the participant train data. The model was trained using teacher forcing and mean squared error (MSE) loss. 

Because \DIFdelbegin \DIFdel{carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{carb }\DIFaddend inputs from meals are recorded as one large input regardless of consumption rate, we assumed a casual eating rate of 5 CHO g/min and split the \DIFdelbegin \DIFdel{carbohydrates }\DIFdelend \DIFaddbegin \DIFadd{carbs }\DIFaddend from the meal across multiple timesteps. For example, if a meal of 60 g of CHO was recorded \DIFdelbegin \DIFdel{a }\DIFdelend \DIFaddbegin \DIFadd{at }\DIFaddend timestep $t$, we split this into 25 g at $t$, 25 g at $t+1$, and 10 g at $t+2$. This eating rate is an approximation across different patients and different food types and is meant to help the model learn by increasing the number of inputs where the CHO value is non-zero.

To determine frequency of rebound highs in each dataset, we traversed \DIFdelbegin \DIFdel{through the dataset sorted by time}\DIFdelend \DIFaddbegin \DIFadd{the dataset chronologically}\DIFaddend ,  keeping track of the most recent BG level below 70 $mg/dL$. For each CGM measurement above 180 $mg/dL$ \DIFdelbegin \DIFdel{, we checked whether it was }\DIFdelend \DIFaddbegin \DIFadd{and }\DIFaddend within 2 hours (24 timesteps) of the most recent BG sample below 70 $mg/dL$, \DIFdelbegin \DIFdel{and if it was, it was labeled as }\DIFdelend \DIFaddbegin \DIFadd{we labeled }\DIFaddend a rebound high and \DIFaddbegin \DIFadd{reset }\DIFaddend the <70 sample \DIFdelbegin \DIFdel{was reset }\DIFdelend to prevent double counting.

The model monitor generates a rebound high alert whenever a \DIFdelbegin \DIFdel{high BG level follows a low BG level }\DIFdelend \DIFaddbegin \DIFadd{hyperglycemia follows hypoglycemia }\DIFaddend in the combined sequence of input and predicted BG values. To test the \DIFdelbegin \DIFdel{ability of the modelto generate an alert when necessary}\DIFdelend \DIFaddbegin \DIFadd{model's ability to generate
fitting alerts}\DIFaddend , we used the test data from the regression task. If the combined sequence of input and true BG values contained a rebound high, then the combined sequence of input and predicted BG values should also contain a rebound high. Otherwise, the alert would not be triggered. Therefore, we could use the regression test data to evaluate the accuracy of rebound high alerts as well. 

\subsection{Results}
% results
The accuracy of \DIFaddbegin \DIFadd{the }\DIFaddend BG regression model on each patient is shown in Table \ref{reg_results}. In general, the root mean squared error (RMSE) of the model is higher on clinical trial patient data than simulated data \DIFdelbegin \DIFdel{because the clinical trial data suffers from }\DIFdelend \DIFaddbegin \DIFadd{due to }\DIFaddend missing records of 
\DIFdelbegin \DIFdel{carbohydrate meals}\DIFdelend \DIFaddbegin \DIFadd{carbs}\DIFaddend , time inconsistencies, and minor physiological effects \DIFdelbegin \DIFdel{not accounted for in the simulation's patient model. During the simulation of virtual patients, we could record both CGM measurements and the patient's actual subcutaneous BG levels that the CGM samples, allowing us to determine }\DIFdelend \DIFaddbegin \DIFadd{absent from the simulation. We could determine virtual patient }\DIFaddend simulation sensor error by calculating the RMSE between \DIFaddbegin \DIFadd{both the }\DIFaddend CGM measurements and \DIFaddbegin \DIFadd{true }\DIFaddend subcutaneous BG levels. \DIFdelbegin \DIFdel{This CGM RMSE provides a target for model performance, because }\DIFdelend \DIFaddbegin \DIFadd{Since }\DIFaddend the model learns from CGM data and cannot reduce \DIFdelbegin \DIFdel{this }\DIFdelend \DIFaddbegin \DIFadd{the }\DIFaddend random noise on its own\DIFaddbegin \DIFadd{, the CGM RMSE provides a target for model performance}\DIFaddend . We do not have a similar estimate for clinical trial data because we do not know the patients' true internal states. % Prediction accuracy for the BG Regression is shown in Table \ref{reg_results}.

\DIFaddbegin \DIFadd{In Table \ref{tab:comp_results}, we compare our approach with a carb focusing attention layer to the same model without carb focusing (i.e., regular attention) and the same without attention (i.e., encoder outputs directly to the decoder LSTM) for a subset of 5 virtual patients and DCLP3 patients each. Including the attention layer improved the model's RMSE on test data for all but one DCLP3 patient. Incorporating carb focusing improved model performance in all but two patients (virtual 2 and DCLP3 6). This may indicate their bodies process carbs quickly, meaning attention should not be delayed to states after 30 minutes from the meal start. We also evaluated the model performance on participant data without transfer learning and measured an RMSE of 35.609, higher than transfer learning's 31.213.
}

\DIFaddend % \subsection{Simulation Evaluation}
\DIFdelbegin \DIFdel{The number of rebound high events in eachdataset is shown in Figure \ref{fig:rebound_high_hist}. }\DIFdelend %DIF > The number of rebound high events in each dataset is shown in Figure \ref{fig:rebound_high_hist}. 
Rebound highs are much more frequent in real patient data, as all but one DCLP3 patient had over 90 rebound highs in 6 months and the participant had 3 in 5 days, while simulated patients only had 3-12 in 225 days\DIFdelbegin \DIFdel{of simulation}\DIFdelend . 
\begin{table}[t!]
    %\vspace{-2em}
    \centering
    \caption{Prediction Accuracy for BG Regression}
    \begin{tabular}{c c c c c c c}
         \multicolumn{2}{c}{\textbf{Patient ID}} & \textbf{RMSE} & \textbf{CGM RMSE} & \multicolumn{2}{c}{\textbf{Patient ID}} & \textbf{RMSE} \\
        \hline

        \parbox[t]{10mm}{\multirow{10}{*}{UVA Sim.}} & 1 & 11.808 & 11.011 & \parbox[t]{10mm}{\multirow{5}{*}{DCLP3}} & 3 & 27.750\\
         & 2 & 13.539 & 11.061 && 4 & 28.546\\
         & 3 & 14.166 & 11.148 && 5 & 17.988\\
         & 4 & 12.043 & 11.105 && 6 & 32.718\\
         & 5 & 14.010 & 11.114 && 7 & 38.050\\ \cline{5-7}
         & 6 & 12.342 & 11.027 & Participant & P & 31.213\\
         & 7 & 13.338 & 11.020 \\
         & 8 & 11.875 & 10.982 \\
         & 9 & 12.390 & 11.039 \\
    \end{tabular}
    \label{tab:reg_results}
    \label{reg_results}
    \vspace{-1.5em}
\end{table}
\begin{comment}
\begin{table}[t!]
    %\vspace{-2em}
    \centering
    \caption{Prediction Accuracy for BG Regression}
    \begin{tabular}{c c c c}
         \multicolumn{2}{c}{\textbf{Patient ID}} & \textbf{RMSE} & \textbf{CGM RMSE} \\
        \hline
        \parbox[t]{10mm}{\multirow{10}{*}{UVA Sim.}} & 1 & 11.808 & 11.011 \\
         & 2 & 13.539 & 11.061 \\
         & 3 & 14.166 & 11.148 \\
         & 4 & 12.043 & 11.105 \\
         & 5 & 14.010 & 11.114 \\ 
         & 6 & 12.342 & 11.027 \\
         & 7 & 13.338 & 11.020 \\
         & 8 & 11.875 & 10.982 \\
         & 9 & 12.390 & 11.039 \\
         & 10 & 14.748 & 11.129 \vspace{1mm}\\ \hline
         \parbox[t]{10mm}{\multirow{5}{*}{DCLP3}} & 3 & 27.750 & - \\
         & 4 & 28.546 & - \\
         & 5 & 17.988 & - \\
         & 6 & 32.718 & - \\
         & 7 & 38.050 & - \\ \hline
         Participant & P & 31.213 & - 
    \end{tabular}
    \label{tab:reg_results}
    \label{reg_results}
    \vspace{-1.5em}
\end{table}
\end{comment}
\DIFdelbegin \DIFdel{Because the DCLP3 patients had far more rebound high events}\DIFdelend \DIFaddbegin \DIFadd{For this reason}\DIFaddend , we use \DIFdelbegin \DIFdel{these }\DIFdelend \DIFaddbegin \DIFadd{the }\DIFaddend patients to evaluate the rebound high alert system, as shown in Table \ref{tab:alert_metrics}. One \DIFdelbegin \DIFdel{of the }\DIFdelend DCLP3 \DIFdelbegin \DIFdel{patients (number }\DIFdelend \DIFaddbegin \DIFadd{patient, }\DIFaddend 5\DIFdelbegin \DIFdel{) did not have the same high number of rebound highs as the others, and ended up having }\DIFdelend \DIFaddbegin \DIFadd{, had }\DIFaddend no rebound highs in the test data\DIFdelbegin \DIFdel{to trigger an alert, and was therefore }\DIFdelend \DIFaddbegin \DIFadd{, so it was }\DIFaddend omitted. The model performed with >98\% accuracy and >79\% precision for all DCLP3 patients, but \DIFdelbegin \DIFdel{suffered from }\DIFdelend \DIFaddbegin \DIFadd{had }\DIFaddend a low recall score, indicating that false negatives were too frequent \DIFdelbegin \DIFdel{and may be a consequence of the model's poorer performance on clinical trial data}\DIFdelend \DIFaddbegin \DIFadd{(likely due
to lack of volatile BG traces in training data)}\DIFaddend .

%DIF > Analysis showed the data traces on which the ML model performed poorly were characterized by meals with high CHO content, large insulin fluctuations, and hyperglycemia, which are conditions associated with rebound highs. While the model predicts BG trends well when in range, the model struggles with volatile traces with higher than normal change in BG, likely due to an lack of examples of these scenarios in training data because they are less frequent.
\DIFaddbegin 

\DIFaddend %Using simulation data as detailed previously \ref{workflowdata}, we achieved Xxx\% accuracy and Xxx\% timeliness in Xxx runs.
%get our data, (transfer learning on my data), train the model, evaluate on test

%\subsubsection{Participant Data}
%In the participant data (trained using UVA/Padova Type I Diabetes Simulator and tuned on some of the participant data \ref{workflowdata}), we found 3 rebound high events in ~5 days of data.
%This resulted in Xxx\% accuracy and Xxx\% timeliness.


\DIFaddbegin \begin{table}[t!]
    %DIF > \vspace{-2em}
    \centering
    \caption{\DIFaddFL{RMSE Comparison of Model Performance with and without Carb Focusing and Attention}}
    \begin{tabular}{c c c c c c c}
        \multicolumn{2}{c}{\textbf{Patient ID}} & \textbf{\DIFaddFL{Our Approach}} & \textbf{\DIFaddFL{No Carb Focus}} & \textbf{\DIFaddFL{No Attention}} \\
        \hline

        \parbox[t]{10mm}{\multirow{5}{*}{UVA Sim.}} & \DIFaddFL{1 }& \textbf{\DIFaddFL{11.808}} & \DIFaddFL{17.860 }& \DIFaddFL{13.438 }\\
         & \DIFaddFL{2 }& \DIFaddFL{13.539 }& \textbf{\DIFaddFL{12.229}} & \DIFaddFL{32.228 }\\
         & \DIFaddFL{3 }& \textbf{\DIFaddFL{14.166}} & \DIFaddFL{21.616 }& \DIFaddFL{14.329}\\
         & \DIFaddFL{4 }& \textbf{\DIFaddFL{12.043}} & \DIFaddFL{23.589 }& \DIFaddFL{70.644}\\
         & \DIFaddFL{5 }& \textbf{\DIFaddFL{14.010}} & \DIFaddFL{16.381 }& \DIFaddFL{14.350}\\
         \parbox[t]{10mm}{\multirow{5}{*}{DCLP3}} & \DIFaddFL{3 }& \textbf{\DIFaddFL{27.750}} & \DIFaddFL{31.105 }& \DIFaddFL{33.790}\\
         & \DIFaddFL{4 }& \DIFaddFL{28.546 }& \DIFaddFL{29.310 }& \textbf{\DIFaddFL{27.133}}\\
         & \DIFaddFL{5 }& \textbf{\DIFaddFL{17.988}} & \DIFaddFL{18.140 }& \DIFaddFL{18.119}\\
         & \DIFaddFL{6 }& \DIFaddFL{32.718 }& \textbf{\DIFaddFL{27.882}} & \DIFaddFL{28.580}\\
         & \DIFaddFL{7 }& \textbf{\DIFaddFL{38.050}} & \DIFaddFL{66.761 }& \DIFaddFL{60.748}\\

    \end{tabular}
    \label{tab:comp_results}
    \vspace{-1.5em}
\end{table}


\DIFaddend \begin{table}[h!]
    \caption{Rebound High Alert System Performance Metrics}
    \resizebox{\columnwidth}{!}{%
    \begin{tabular}{c|c|c|c|c|c}
        \textbf{DCLP3} & \textbf{Rebound High} & \textbf{Accuracy} & \textbf{Precision} & \textbf{Recall} & \textbf{F1 Score} \\
        \textbf{Patient}&\textbf{Alerts to Issue}&&&& \\
        \hline
        3 & 148 & 98.3 & 96.0 & 21.7 & 35.4 \\
        4 & 221 & 99.1 & 79.4 & 36.5 & 50.0 \\
        6 & 231 & 98.8 & 89.9 & 46.3 & 61.1 \\
        7 & 221 & 98.6 & 96.9 & 28.5 & 44.1 \\
    \end{tabular}
    }
    \label{tab:alert_metrics}
    \vspace{-1.5em}
\end{table}

\begin{comment}
\subsection{Initial Survey}

The commonplace of rebound hyperglycemia is supported by the survey responses of a survey we sent to ~10 patients with type 1 diabetes. When asked to select on a scale from "Never" to "Very Often" with the statement "After I have low blood sugar, I have a rebound high blood sugar" all of them answered in a mid range but one who selected "Very often." When asked the same in regards to the statement "After I have a high blood sugar, I have a rebound low blood sugar" all of them answered in a mid range.

All participants indicated that "If [they] realize [they] have low blood sugar at the start of a meal," they will still eat the meal before their blood sugar returns to safe range. Two-thirds stated that in the case of being low at a mealtime, they would wait until they are back in range to give insulin for the meal. Of the participants who indicated waiting until they were back in range, 74.96\% said they would give a full injection for the carbohydrates eaten, whereas the remaining 25.04\% give a partial insulin injection for the carbohydrates eaten. This section of the survey gives support for our carry-over carb method and application reminders for when the user is back in range, since all of the participants indicated over correcting for their hypoglycemia at mealtimes, and the majority wait until they are back in range to give any insulin. This leaves room for error, since current CGMs do not typically alert users when they are back in range.

Two-thirds of participants indicated that they don't feel low blood sugar symptoms until they are in the low range (they start feeling symptoms at 70 $mg/dL$ or below), and 83.3\% indicated that they don't begin to feel high BG symptoms until they are in high range (they start feeling symptoms at 180 $mg/dL$ or above). This gives support for rebound high predictive alerts and our carry-over carb method to prevent the rebound highs. 
\end{comment}

\section{Conclusion and Future Work}
This paper proposes \DIFdelbegin \DIFdel{extending the APS controllers with capabilities for the prediction and prevention of rebound hyperglycemia events. We present an }\DIFdelend \DIFaddbegin \DIFadd{expanding the capacities of APS  controllers to predict and prevent rebound highs. Our }\DIFaddend ML BG prediction method \DIFdelbegin \DIFdel{that outputs trending alert messages using scenario-specific language to refer to rebound highs along with suggested increased bolus }\DIFdelend \DIFaddbegin \DIFadd{provides scenario-specific alert messages and suggests increased basal }\DIFaddend thresholds based on \DIFdelbegin \DIFdel{carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{carb }\DIFaddend input in cases\DIFdelbegin \DIFdel{of hypoglycemia when a rebound high is predicted}\DIFdelend . Experimental results show \DIFdelbegin \DIFdel{that the proposed method achieves }\DIFdelend >98\% accuracy and >79\% precision for all DCLP3 patients.

Future work will \DIFdelbegin \DIFdel{involve the optimization and automation of carbohydrate carry-over bolus increases since our process has the limitations of heuristicsand requiring unnecessary user action. 
In addition, future work will involve calculating more exact carbohydrate }\DIFdelend \DIFaddbegin \DIFadd{optimize away from heuristics, automatically apply $IB$ rates, and calculate more exact carb }\DIFaddend intake recommendations in the \DIFdelbegin \DIFdel{cases of hypoglycemia and the }\DIFdelend case of rebound lows \DIFaddbegin \DIFadd{beyond general insulin suspension.
}\DIFaddend %In addition, we conducted a small survey surrounding habits of out of range BG prediction and treatment, which supported the need for study. We also 
%future work includes the proposal, creation, and evaluation of an application or feature set to be added to an existing controller in order to synthesize our prediction and alert system with carbohydrate entry reminders (both reminders at set time intervals and detected reminders based on meal prediction). 
\DIFdelbegin \DIFdel{We will also focus on the integration of the proposed rebound evaluation module with carbohydrate entry reminders on an existing APS controller and evaluation using patient feedback. 
}\DIFdelend %DIF > %%%%%We will also focus on the integration of the proposed rebound evaluation module with carb entry reminders on an existing APS controller and evaluation using patient feedback. 
%In addition, future work will involve calculating more exact carbohydrate intake recommendations in the cases of hypoglycemia and the case of rebound lows, similarly to how we calculated IB in this paper.

\DIFdelbegin %DIFDELCMD < \begin{figure}[t!]
%DIFDELCMD <     \vspace{-0.5em}
%DIFDELCMD <     \centering
%DIFDELCMD <     \includegraphics[scale=0.45]{Figures/rebound_high_histogram.png}
%DIFDELCMD <     \vspace{-0.2em}
%DIFDELCMD <     %%%
%DIFDELCMD < \caption{%
{%DIFAUXCMD
\DIFdelFL{Rebound High Count Across Patients}}
    %DIFAUXCMD
%DIFDELCMD < \label{fig:rebound_high_hist}
%DIFDELCMD <     \vspace{-1em}
%DIFDELCMD < \end{figure}
%DIFDELCMD < %%%
\DIFdelend %DIF > \begin{figure}[t!]
 %DIF >    \vspace{-0.5em}
  %DIF >   \centering
   %DIF >  \includegraphics[scale=0.45]{Figures/rebound_high_histogram.png}
    %DIF > \vspace{-0.2em}
    %DIF > \caption{Rebound High Count Across Patients}
    %DIF > \label{fig:rebound_high_hist}
    %DIF > \vspace{-1em}
%DIF > \end{figure}

%As we have proposed an app that will synthesize several of our ideas, in the future a creation of the app and a study of its effects would be a good step forward. An extended research study on both the app once created as well as the carry-over carb method using real-time participants could prove very useful. Finally, an automation of the carry-over insulin increase rather than a reminder for patient action would eliminate unnecessary patient action in the instance of predicted rebound high.

\DIFdelbegin %DIFDELCMD < \begin{comment}%DIFDELCMD < 
%DIFDELCMD < 
%DIFDELCMD < % \vspace{-1em}
%DIFDELCMD < \section*{Acknowledgment}
%DIFDELCMD < \vspace{-0.75em}
%DIFDELCMD < This material is based upon work supported by the National Science Foundation (NSF) under Grant No. 1748737.
%DIFDELCMD < \end{comment}
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \begin{comment}

% \vspace{-1em}
\section*{Acknowledgment}
% \vspace{-0.75em}
This material is based upon work supported by the National Science Foundation (NSF) under Grant No. 1748737.
\end{comment}
\DIFaddend 

%DIF < This work was supported by a grant from the U.S. National Science Foundation (No. 1748737) and a research innovation award from the University of Virginia.
%DIF <  %This work was partially supported by a grant from the U.S. National Science Foundation (Award No. 1748737) and a SEAS research innovation award from the University of Virginia, School of Engineering and Applied Science (SEAS).
%DIF <  \vspace{-1.5em}
\DIFdelbegin %DIFDELCMD < \bibliographystyle{IEEEtran}
%DIFDELCMD < \bibliography{main.bib}
%DIFDELCMD < %%%
\DIFdelend %DIF > % The next two lines define the bibliography style to be used, and
%DIF > % the bibliography file.
\DIFaddbegin \bibliographystyle{ACM-Reference-Format}
\bibliography{main}

\DIFaddend %%TC:endignore
% \input{appendix.tex}
\end{document}

