\section{Experiments}
\label{sec:experiments}
We evaluate the proposed models on the arrival trajectories to KJFK.
We trained the models on the flight tracks and procedures for all the runways except for 13L. Then, the performance of the models \textcolor{blue}{is} validated using 13L data.
This makes an approximately 90--10 training-test split of our data. 
To construct the input vectors as described in Section \ref{subsec:input vector construction}, we set the input length to 150 for the final approach segment and 350 for the radar vector segment.

\subsection{Model Selection}
\label{subsec:model_selection}

% \soyeonstrike{Prior to training, we determine the numbers of Gaussian components and the rank for each Gaussian covariance matrix. To evaluate the cluster performance with different numbers of Gaussian components, we use the silhouette score, a measure of how well a data point is matched to its own cluster (cohesion) compared to the other clusters (separation). The silhouette coefficient for one data point $i$ is defined as}


The number of clusters is an important hyper-parameter for clustering algorithms including the GMM.
To determine the number of clusters, i.e. Gaussian components in GMMs, we evaluate the cluster performance of our models with different numbers of Gaussian components using the silhouette method.
The silhouette method selects the number of clusters by finding the number that maximizes the silhouette score, i.e. the average of silhouette coefficients over all data points in the entire dataset.
A silhouette coefficient measures how well a data point is matched to its own cluster (cohesion) versus to the other clusters (separation) \cite{rousseeuw1987silhouettes}.
The silhouette coefficient for the $i$th data point is
\begin{align}
s(i) = \frac{b(i)-a(i)}{\max \{ a(i), b(i) \} }
\end{align}
where $a(i)$ is the mean intra-cluster distance (i.e., mean Euclidean distance to the other points in the same cluster) and $b(i)$ is the mean nearest-cluster distance (i.e., mean Euclidean distance to the points in the closest cluster).
The value of $s(i)$ ranges from $-1$ to $+1$, where a higher value indicates that $i$ is well matched to its cluster while poorly to its neighboring cluster. 
If most points have high values, the data points are appropriately clustered.


The silhouette method has several advantages for optimizing the number of clusters. 
It provides an exact solution whereas other methods including the elbow method have to rely on heuristics. 
The silhouette method also quantifies the clustering performance better, as it evaluates both intra-cluster and inter-cluster distances. A good clustering can be characterized by high inter-cluster distance and low intra-cluster distance. \deleted{There are other possible heuristics, which include the Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC); however, for the aforementioned reasons we use the silhouette method in this work \cite{assess_components2000}.} \added{The silhouette score is illustrated here primarily due to its simplicity compared to heuristic ``elbow'' methods. There are many other possible ways to choose the number of clusters, such as the Akaike Information Criterion (AIC) and the Bayesian Information Criterion (BIC) \cite{assess_components2000}. AIC and BIC tend to give similar results as the silhouette score.}

We select the number of Gaussian components that maximize the silhouette score.
% \soyeonstrike{(i.e., the mean silhouette coefficient over all data points of the entire dataset.)}
Fig. \ref{fig:silhouette_iap_vector} shows the silhouette scores with different numbers of Gaussian components for the final approach model and radar vector model.
The final approach model has the highest score of 0.5432 with two Gaussian components, and the radar vector model has the highest score of 0.4937 with six Gaussian components.
\begin{figure}[bt!]
\centering
\setlength\figureheight{5.5cm}
\setlength\figurewidth{9cm}
\input{figures/silhouette_iap_vector.tex}
\caption{Number of Gaussian components vs. silhouette scores.}
\label{fig:silhouette_iap_vector}
\end{figure}

% \soyeonstrike{Using the resulting numbers of Gaussian components, 
% we determine the optimal rank for each Gaussian covariance matrix (i.e., the rank that maximizes the log-likelihod) as described in Section} \ref{subsec:low-rank approximation}.

Once we determine the numbers of Gaussian components, we optimize the ranks for the low-rank approximations of the covariance matrices 
as described in Section \ref{subsec:low-rank approximation}.
Fig. \ref{fig:low_rank_approximation_iap_vector} shows the log-likelihood with different numbers of principal components (PCs) for the final approach model and the radar vector model.
As a result, the 452-dimensional input data of the final approach model can be best represented with 82 PCs, and the 1052-dimensional input data of the radar vector model can be best represented with 241 PCs.
\begin{figure}[bt!]
    \centering
    \subfigure[Final approach model]{
    \setlength\figureheight{5cm}
    \setlength\figurewidth{8cm}
    \input{figures/PPCA_IAP}}
    \subfigure[Radar vector model]{
    \setlength\figureheight{5cm}
    \setlength\figurewidth{8cm}
    \input{figures/PPCA_vector}}
    \caption{Number of principal components (PC) vs. log-likelihood.}
    \label{fig:low_rank_approximation_iap_vector}
\end{figure}


\subsection{Model Validation and Generalization}
\label{subsec:experiment_single_trajectory_model}
With the optimized parameters, we train the single trajectory model and generate synthetic trajectories from the trained model
as described in Section \ref{sec:single trajectory model}.
Fig. \ref{fig:jfk_13L_hist_org} and Fig. \ref{fig:jfk_13L_hist_syn} show 2D log-histograms of 1,200 actual trajectories and 1,000 synthetic trajectories arriving at KJFK 13L.
As in Fig. \ref{fig:jfk_04R_orginal_paths}, the radar vector procedures and the IAP are indicated in blue dotted lines and a white dashed line with orange edges, respectively.
From the generated trajectories, we observe that the model can learn the general behavior of aircraft with respect to the procedure, but not the distinctive patterns of each individual procedure.
This is because after our model obtains the deviation trajectories with different procedures, it merges all of them into a single dataset for each segment.
\begin{figure}[bt!]
    \centering
    \subfigure[Actual trajectories]{
    \setlength\figureheight{6.7cm}
    \setlength\figurewidth{6.7cm}
    \input{figures/jfk_13L_original_hist_1200.tex}
    \label{fig:jfk_13L_hist_org}}
    \subfigure[Synthetic trajectories]{
    \setlength\figureheight{6.7cm}
    \setlength\figurewidth{6.7cm}
    \input{figures/jfk_13L_synthetic_hist_1000.tex}
    \label{fig:jfk_13L_hist_syn}}
    \caption{Log-histograms of arrival tracks to KJFK 13L and associated flight procedures.}
    \label{fig:jfk_13L_org_syn}
\end{figure}

To investigate how well the proposed model generalizes to a new environment, we generated synthetic trajectories given Charlotte Douglas Airport (KCLT) runway 36C arrival procedures using the model trained with KJFK data.
Fig. \ref{fig:clt_36C_hist_org} shows a density plot of one month of actual arrivals to KCLT 36C in 2016.
Fig. \ref{fig:clt_36C_hist_syn} is a density plot of 1,000 synthetic trajectories generated by sampling the deviation trajectories from our model and re-constructing the position trajectories with the given flight procedures.
Again, the radar vector procedures and the IAP are indicated in blue dotted lines and a white dashed line with orange edges, respectively.

From the two histograms, we see that some traffic patterns in the actual trajectory set do not appear in the synthetic trajectory set.
Part of the reason is because some trajectories do not appear to follow any of the procedures. 
For example, in Fig. \ref{fig:clt_36C_hist_org}, there is no standard procedure for those trajectories approaching from the northwest, passing north of the airport, and joining the downwind leg on the east side.
Another reason is that the two environments are extremely different.
The radar vector procedures and the actual trajectories of KCLT are mostly straight with only some parts curved, while
those of KJFK do not have straight segments. 
Also, the KJFK trajectories have greater variability in their early arrival stages, while the variability of KCLT trajectories depends on the procedure.
Thus, the synthetic trajectories in Fig. \ref{fig:clt_36C_hist_syn} are more representative of KJFK traffic than KCLT traffic.
\begin{figure}[tb]
    \centering
    \subfigure[Actual trajectories]{
        \setlength\figureheight{7cm}
        \setlength\figurewidth{7cm}
        \input{figures/clt_36C_original_hist.tex}
        \label{fig:clt_36C_hist_org}}
    \subfigure[Synthetic trajectories]{
        \setlength\figureheight{7cm}
        \setlength\figurewidth{7cm}
        \input{figures/clt_36C_synthetic_hist_500.tex}
        \label{fig:clt_36C_hist_syn}}
  \caption{Log-histograms of arrival tracks to KCLT 36C and RNAV standard arrival procedures.
  }
\end{figure}

We also provide quantitative analyses on the single trajectory model in the next section, along with the multiple trajectory model.


\subsection{Analyses on Multiple Trajectory Scenarios}
To evaluate the performance of the single and multiple trajectory models, we experiment with both models on traffic scenarios where three aircraft arrive at KJFK 13L with inter-arrival times of less than 180 seconds.
As described in Section \ref{sec:multiple trajectory model}, we train a pairwise trajectory model for each combination of two procedures and generate synthetic trajectory sets of three aircraft.
We also generate synthetic trajectory sets using the single trajectory model. 
This is done by generating each trajectory independently and then connecting the trajectory data points through the inter-arrival time variables.

\begin{figure*}[tb!]
    \centering
    \subfigure[xEast. $D_{JS}$: 0.0119 (multiple), 0.0245 (single)]{
        \label{fig:hist_x_coords}
        \input{figures/hist_x}}
    \hspace*{1em}%
    \subfigure[yNorth. $D_{JS}$: 0.0446 (multiple), 0.0166 (single)]{
        \label{fig:hist_y_coords}
        \input{figures/hist_y}}
    \vspace*{1em}%
    \hspace*{0.8em}%
    \subfigure[horizontal speed. $D_{JS}$: 0.0147 (multiple), 0.0650 (single)]{
        \label{fig:hist_speed}
        \input{figures/hist_hor_speed}}
    \hspace*{1em}%
    \subfigure[distance to the closest aircraft. $D_{JS}$: 0.0307 (multiple), 0.0261 (single)]{
        \label{fig:hist_encounter}
        \input{figures/hist_encounter}}
    \caption{Distributions of position coordinates, horizontal speed, and distance to the closest aircraft (actual vs. synthetic--multiple vs. synthetic--single trajectories of KJFK 13L).}
    \label{fig:result-hist}
\end{figure*}

Fig. \ref{fig:result-hist} shows the empirical distributions of the position coordinates, horizontal speed, and distance to the closest aircraft, for the actual dataset and the synthetic datasets from each model.
From Fig. \ref{fig:hist_speed} and \ref{fig:hist_encounter}, we observe for both variables that the synthetic distribution from the multiple trajectory model (synthetic--multiple) is more concentrated near its mode than the one from the single trajectory model (synthetic--single).
This result is probable because the multiple model not only learns individual trajectories but also the pairwise relations between them. 
%Thus, the degree of freedom of individual trajectory is not high compared to a trajectory generated from the single model.

We observe from the figures that the synthetic trajectory sets have much higher densities than the actual dataset at lower speeds and ranges.
In practice, most aircraft cannot maintain $100$ knots, which is why the actual dataset has minimal density in this range. 
Also, it is specified in FAA Order JO 7110.65Y \cite{FAAorderATC} that the separation minimum between two IFR aircraft flying below FL$290$ within $40$ miles from the radar antenna is $3$ miles horizontally and $1,000$ feet vertically.
The invalid outputs may occur from the fact that our models do not directly learn the aircraft trajectories, but learn the deviations and then re-construct the trajectories.

To measure the similarity between the actual distribution and each of the synthetic distributions,
we use the Jensen--Shannon divergence $(D_{JS})$, which is a symmetric and smoothed variation of the Kullback--Leibler divergence $(D_{KL})$ \cite{lin1991divergence}.
The $D_{JS}$ between two empirical distributions $P$ and $Q$ is defined as
\begin{align}
    \begin{split}
        D_{JS}(P, Q) &= \frac{1}{2} \Big( D_{KL}(P, M) + D_{KL}(Q, M) \Big)\\
        &= \frac{1}{2}\sum_{x_i} \Big( P(x_i) \log \frac{P(x_i)}{M(x_i)} + Q(x_i) \log \frac{Q(x_i)}{M(x_i)} \Big)
    \end{split}
\end{align}
where ${M = (P+Q)/2}$. The output is bounded by $0$ and $1$.

\begin{table}[ht]
\centering
\caption{$D_{JS}$ between actual distribution, distribution of synthetic trajectories (single model) and distribution of synthetic trajectories (multiple model)\label{tab:djs}}
\begin{tabular}{@{}lrr@{}} \hline
\textbf{Variable} & \textbf{$D_{JS}$ Single} & \textbf{$D_{JS}$ Multiple} \\ \hline
X-coordinate (NM) & 0.0245 &  0.0119 \\ 
Y-coordinate (NM) & 0.0166 & 0.0446 \\ 
Horizontal speed (Knots) &  0.0650 &  0.0147 \\ 
Distance to closest aircraft (NM) & 0.0261 & 0.0307 \\ \hline
\end{tabular}
\end{table}

Table \ref{tab:djs} presents the $D_{JS}$ between the actual distribution and each of the synthetic distributions for different variables (See Fig. \ref{fig:result-hist} for a visualization of the distributions).
We find that the multiple model outperforms the single model in terms of horizontal speed, not only because the multiple model has lower $D_{JS}$ but the single model outputs speeds that are too high or too low.
For the closest distance, the single model has \textcolor{blue}{a }slightly lower JS divergence.
What is more important, however, is the loss of separation that occurs whenever the separation minima are breached.
We counted the number of times when the distance to the closest aircraft goes below $3$ miles within the 1,000 trajectory sets generated using each model.
It turns out that loss of separation occurred $781$ times when using the single model, and $482$ times when using the multiple model.
These results indicate that the multiple model performs better, or at least comparably than the single model in terms of both similarity and safety. We note that an explicit collision avoidance model can be added on top of this nominal trajectory model to prevent actual collisions in simulation.

Fig. \ref{fig:multi_trajs_generation_sets} shows two sample three-trajectory sets generated using the multiple model\textcolor{blue}{s.}
Along each trajectory, the dots indicate the current positions and the ticks indicate previous positions at each minute.
For example, the ${-1}$ ticks indicate the locations of the three aircraft one minute ago.
For the first set shown in Fig. \ref{fig:multi_trajs_generation_set1}, the model successfully generated the trajectories, satisfying the horizontal and vertical separation requirements.
After the second AC gets close to the first AC, it makes a detour and reduces speed to maintain the horizontal and vertical separation from the first AC.
For the second set shown in Fig. \ref{fig:multi_trajs_generation_set2}, on the other hand, loss of separation occurred between the first AC and the second AC at ${t=-2}$.
Besides, at the current time step, the second AC and the third AC overlap in the top view.
Although the two ACs are maintaining the vertical separation minimum, in practice, the air traffic controllers do not want to see overlapping tracks from their radar control screen.
A plausible reason for this undesirable output is the configuration of the procedures.
As with all the other experiments, each trajectory follows one of the procedures for KFJK 13L shown in Fig. \ref{fig:jfk_13L_org_syn}.
We can see that the procedures themselves overlap with each other.
Thus, the synthetic trajectories for KJFK 13L arrivals are likely to overlap or fail in separation even if our models separate them based on their inter-arrival times. %\todo{would it be helpful to have stronger takeaways about results here?}
We could use some heuristics to solve this problem or experiment on another environment such as KCLT 36C where the procedures do not overlap. For now, we will leave these for future work.

\begin{figure*}[bt!]
    \centering
    \subfigure[First example set.]{
    \includegraphics[width=7.1in]{figures/gen_three_trajs_set1_t=560.pdf}
    \label{fig:multi_trajs_generation_set1}}
    \subfigure[Second example set.]{
    \includegraphics[width=7.1in]{figures/gen_three_trajs_set2_t=240.pdf}
    \label{fig:multi_trajs_generation_set2}}
    \caption{Example sets of three trajectories generated based on the multiple trajectory model. Top view (left column) and side views from north and east (right column).}
    \label{fig:multi_trajs_generation_sets}
\end{figure*}

To visualize the behavior of multiple trajectories over time, we developed a dynamic simulation tool embedded with Google Maps.
The source code for the experiments and a simulation demo are publicly available at \\
https://github.com/sisl/terminal\_airspace\_modeling.
