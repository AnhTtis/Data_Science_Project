\section{SOS Programs }
\label{sec:crash_sos}

This section poses finite-dimensional \ac{SOS} tightenings to the infinite-dimensional crash-safety programs. 

We will require a strengthening of assumption A1:
\begin{itemize}
    \item[A5] The sets $(X, X_u, X_0, [0, T], Z, \Omega)$ are all Archimedean \ac{BSA} sets and the dynamics $f(t, x, w)$ are polynomial.
\end{itemize}

\subsection{Standard Crash-Safety}

For a given degree $d$, define $\tilde{d} = d + \floor{\deg f/2}$ as the dynamics degree of $f(t, x, w)$. The degree-$d$ \ac{SOS} tightening of program \eqref{eq:crash_cont} is
\begin{subequations}
\label{eq:crash_sos}
\begin{align}
    q^*_d = & \max_{\gamma \in \R, \ v} \ \gamma \label{eq:crash_sos_obj}& & \\
    & v(0, x, z) - \gamma  \in \Sigma[X_0 \times Z]_{\leq d}\label{eq:crash_sos_0} \\
    & z - v(t, x, z) \in \Sigma[[0, T] \times X_u \times Z]_{\leq d}\label{eq:crash_sos_p} \\
    & \Lie_{f} v(t, x, z, w) \in \Sigma_{\tilde{d}}[[0, T] \times X \times \Omega]\label{eq:crash_sos_lie}\\
    & v(t,x,z) \in \R [t, x, z]_{\leq 2d}.\label{eq:crash_sos_v}& &
\end{align}
\end{subequations} 

We need to prove boundeness of \eqref{eq:crash_meas} in order to prove convergence of \eqref{eq:crash_sos}.

\begin{lem}
\label{lem:crash_meas_bounded}
All measures $(\mu_0, \mu_u, \mu)$ in \eqref{eq:crash_meas} are bounded under A1-A5.
\end{lem}
\begin{proof}
We will use the sufficient condition that a measure is bounded if it has finite mass and its support set is compact.
All support sets are compact by assumption A1.
    The measure $\mu_0$ has mass 1 by \eqref{eq:crash_meas_prob}. Substitution of $v(t, x, z) = 1$ into \eqref{eq:crash_meas_flow} results in $\inp{1}{\mu_u} = \inp{1}{\mu_0} = 1$, and applying $v(t,x, z)=t$ yields $\inp{1}{\mu} = \inp{t}{\mu_u} \leq T$.
\end{proof}




\begin{thm}
Under assumptions A1-A5, then the sequence of bounds $q^*_d$ will converge as $\lim_{d\rightarrow \infty} q^*_d = Q^*$ to the optimum of \eqref{eq:crash_traj}. 
\end{thm}
\begin{proof}
This convergence will occur by Corollary 8 of \cite{tacchi2022convergence}, along with convergence in Theorem \ref{thm:same_crash_meas}, boundedness of measures in \ref{lem:crash_meas_bounded}, the infinite-dimensional strong duality Theorem \ref{thm:crash_duality}, and strong duality between their finite-dimensional \ac{SDP} truncations  \cite[Arguments from Theorem 4]{henrion2013convex}.
\end{proof}



\subsection{Robust Crash-Safety}

We now apply the robust counterpart from \eqref{eq:crash_robust_lie} to \eqref{eq:crash_cont} in order to form \iac{SOS} program for the $L_\infty$ data-driven scenario. Define $\tilde{d} = d + \max_{\ell\in0..L}{\floor{\deg f_\ell/2}}$ as the dynamics degree of \eqref{eq:dynamics_affine_true}. The $L_\infty$-bounded data-driven robust crash-safety \ac{SOS} tightening at degree $d$ is
\begin{subequations}
\label{eq:crash_sos_robust}
\begin{align}
    \tilde{q}^*_d = & \max_{\gamma \in \R, \ v} \ \gamma \label{eq:crash_sos_robust_obj}& & \\
    & v(0, x, z) - \gamma  \in \Sigma_{d}[X_0 \times Z]\label{eq:crash_sos_robust_0} \\
    & z - v(t, x, z) \in \Sigma_d[[0, T] \times X_u \times Z] \label{eq:crash_sos_robust_p} \\
    & \Lie_{f_0} v - (z \1 - h)^T\zeta^+ - (z \1 + h)^T \zeta^-  \nonumber \\
    & \qquad \qquad \in \Sigma_{\tilde{d}}[[0, T] \times X \times Z]\label{eq:crash_sos_robust_lie}\\
    & \forall \ell=1..\ell:\\
    & \qquad \textrm{coeff}_{txz}((\Gamma^+)_\ell(\zeta^+-\zeta^-) + f_\ell \cdot \nabla_x v)=0 & &  \nonumber\\
    & v(t,x,z) \in \R [t, x, z]_{\leq 2d}.\label{eq:crash_sos_robust_v}& & \\
    & \forall j=1..2nT: \label{eq:crash_sos_robust_zeta}\ \\
    & \qquad \zeta^+_j, \zeta^-_j \in \Sigma[[0, T] \times X \times Z]_{\leq \tilde{d}-1}. & & \nonumber
\end{align}
\end{subequations}

\begin{thm}
    Under assumptions A1-A5 and assuming $L_\infty$ noise structure, the sequence of optimal values from \eqref{eq:crash_sos_robust} will converge as $\lim_{d\rightarrow\infty} \tilde{q}_d^* =Q^*$.
\end{thm}
\begin{proof}
    The Lie constraint may be robustified by Theorem \eqref{thm:crash_robust_lie}. The \ac{SOS} program in \eqref{eq:crash_sos_robust} will converge to a strict version of \eqref{eq:crash_cont} by Theorem 4.4 of \cite{miller2023robustcounterpart} under the polynomial $v$ restriction. Strictness is not overly restrictive when performing smooth approximations, as shown in the proof of Proposition 5 in \cite{jones2021polynomial}.
\end{proof}

\begin{rmk}
The degree of $\zeta^\pm$ in \eqref{eq:crash_sos_robust_zeta} is set  to $2(\tilde{d}-1)$ so as to ensure that $\deg z\1^T \zeta^\pm = 2\tilde{d}-1 \leq 2\tilde{d}$ in \eqref{eq:crash_sos_robust_lie}.
\end{rmk}


\subsection{Computational Complexity}
Program \eqref{eq:crash_sos} has three \ac{WSOS} constraints, leading to Gram matrices of maximal size $\binom{n+1+d}{d}, \ \binom{n+2+d}{d}, \ \binom{n+L+2+\tilde{d}}{\tilde{d}}$ \cite{lasserre2009moments, miller2022eiv_short}. The performance of \acp{SDP} derived from \eqref{eq:crash_sos} is dominated by the largest size $\ \binom{n+L+2+\tilde{d}}{\tilde{d}}$ and scales as $(n+L+2)^{6 \tilde{d}}$ or $\tilde{d}^{4(n+L+2)}$ (per-iteration complexity of interior point methods moment-\ac{SOS}).

The robustified program in \eqref{eq:crash_sos_robust} breaks up the Lie constraint's maximal-size Gram matrix dimension $\binom{n+L+2+\tilde{d}}{\tilde{d}}$ into one matrix of size $\binom{n+2+\tilde{d}}{\tilde{d}}$ \eqref{eq:crash_sos_robust_lie} and $2nT$ Gram matrices of size $\binom{n+1+\tilde{d}}{\tilde{d}}$ \eqref{eq:crash_sos_robust_zeta}.


\begin{rmk}
The nonredundant face identification method of \cite{caron1989degenerate} requires caution when attempting to reduce complexity of \eqref{eq:crash_sos_robust}. Faces of $W$ that are active at $z_1$ may no longer be active at $z_2 \geq z_1$ or vice versa \cite{loechner1997parameterized}. A bound on \eqref{eq:crash_sos_robust} computed using a subset of faces (constraints) in $\mathcal{D}$ will necessarily be lower than using all faces. This conservatism can be reduced while still eliminating faces by taking the union of active faces of the polytopes in $w$ from $Aw + e \in K$ in \eqref{eq:lin_robust_strict} at a set of values $z \in (0, J_{\max}]$.
\end{rmk}