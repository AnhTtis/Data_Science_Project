%!TEX root = ../../main.tex
\section{Proof of Theorem~\ref{theorem:causalExtensibleModels-CC-RA-RC}}
\label{app:causalExtensible}

\causalExtensibleModels*

\begin{proof}
	%$\co$ a commit order that witness this property and $e$ a $\so \cup \wro$-maximal event.
Let $I$ be an isolation level in $\{\CC, \RA, \RC\}$. We show that any commit order $\co$ justifying that a history $h$ is $I$-consistent can also be used to justify that a causal extension $\hist'$ of a $(\so \cup \wro)^*$-maximal pending transaction $t$ in $h$ with an event $e$ is $I$-consistent as well.
We consider a causal extension $\hist'$ where if $e$ is a read event, then it reads from the last transaction $t_w$ in $\co$ such that $t_w$ writes $\mathit{var}(e)$ and $(t_w, t) \in (\so \cup \wro)^+$.
%$\co$-maximal transaction that writes $x$ and $(t, \trans{h}{e}) \in (\so \cup \wro)^+$âˆ«
%Let us show that for every non-total consistent history $h$, $\co$ a commit order that witness this property and $e$ a $\so \cup \wro$-maximal event there exists a causal extension of $h$ and $e$. For doing so, we will show that there exists a commit order $\co'$ for $h$ that is also a commit order for a causal extension of $h$. During the following, let us call 
Assume by contradiction that this is not the case. Let $\phi_{\CC}(h', t', e') = t' \ (\so \cup \wro)^+ \ \trans{h'}{e'}$, $\phi_{\RA}(h',t', e') = t' \ (\so \cup \wro) \ \trans{h'}{e'}$ and $\phi_{\RC}(h',t', e') = t' \ (\wro \circ \po) \ e'$ be sub-formulas of the axioms defining the corresponding isolation level. Then, 
%
%On one hand, if $e$ is a $\ibegin$ event, let $\co' = \co \cup \{\langle t, \tr(e) \rangle, t \in h\}$ and if $e$ is either a $\iwrite$ or an $\iend$ event, let simply $\co' = \co$. On the other hand, if $e$ is a read event that reads $x$, let $t$ the $\co$-maximum transaction that writes $x$ and $(t, \trans{h}{e}) \in (\so \cup \wro)^+$; and let's pick $\co' = \co$. Either way, let us call $h' = h \oplus e$ or $h' = h \oplus \wro(t, e)$.
%As $\co'\restriction_{h} = \co$, it is clearly a commit order for $h$. Moreover, if it does not witness $\mathcal{I}$-consistency for $h'$, 
%
$\hist'$ contains transactions $t_1, t_2, t_3$  such that $t_2$ writes some variable $x$, $t_3$ contains some read event $e'$, $(t_1, e') \in \wro_x$ and $\phi_{I}(h', t_2, e')$ but $(t_1, t_2) \in \co$. The assumption concerning $\co$ implies that the extended transaction $t$ is one of $t_1, t_2, t_3$ (otherwise, $\co$ would not be a ``valid'' commit order for $\hist$). Since $t$ is $(\so \cup \wro)^+$-maximal in $\hist$, we have that $t\not\in \{t_1,t_2\}$. If 
%Firstly, as $h'$ is an extension of $h$ and $\mathcal{I}$ is prefix-closed, if $\trans{h}{e}$ is not equal to any of them, $\co$ would not witness $I$-consistency for $h$. As $\trans{h}{e}$ is $\so \cup \wro$-maximal, $t_1 \neq \trans{h}{e} \neq t_2$. Moreover, 
$e$ is \emph{not} a read event, or if $e$ is a read event different from $e'$, then $t \neq t_3$, as $t_1$, $t_2$ and $t_3$ would satisfy the same constraints in $h$, which is impossible by the hypothesis. Otherwise, if $e=e'$, then this contradicts the choice we made for the transaction $t_w$ that $e$ reads from. Since $(t_1, t_2) \in \co$ and $t_2$ writes $\mathit{var}(e)$, it means that $t_w=t_1$ is not maximal w.r.t. $\co$ among transactions that write $\mathit{var}(e)$ and precede $t$ in $(\so \cup \wro)^+$. Both cases lead to a contradiction, which implies that $\hist'$ is $I$-consistent, and therefore the theorem holds.
% $t$ cannot be $t_1$ as it is the $\co$-maximum history among those that write $x$ and $\trans{h}{e}$ causally depends on. In addition, $\trans{h}{e}$ cannot be $t_2$ as that would mean $\co$ does not witness $\mathcal{I}$-completeness. And analogously, as $\trans{h}{w}$ is neither of them, those transactions cannot exists, otherwise $h$ would not be $\mathcal{I}$-consistent. Succinctly, $h'$ is $\mathcal{I}$-consistent.
\end{proof}