\iffalse
\section{Appendix to Section \ref{sec:CCB-IV}}

\subsection{Uncertainty Quantification}

\begin{theorem}\label{thm:uncertainty quantification IV}
Suppose $Y=h^*(X)+\epsilon$ and $Z$ is an instrumental variable.
Let $\hat{h}$ be the estimator minimizing the empirical norm $L_n(h)$ as $\hat{h}=\argmin_{h\in\cH} L_n(h)$
Let $CR$ be the confidence region defined as $\text{CR}=\{h\in\cH: L_n(h)-L_n(\hat(h)) \lesssim \xi^2\}$.
Then the following conclusions holds
\begin{itemize}
    \item $h^* \in \text{CR}$
    \item $\forall h\in\text{CI}$, $\E\left[\E[h(x)-h^*(X)|Z]^2\right] \lesssim \xi^2$
\end{itemize}
\end{theorem}
\begin{proof}
Combining lemma \ref{lem:h* in CR IV} and lemma \ref{lem:MSE conditioned on IV} proves the theorem.
\end{proof}

\begin{lemma}\label{lem:h* in CR IV}
Let $h^*$ and $\text{CR}$ be defined in Theorem \ref{thm:uncertainty quantification IV}. Then $h^*\in\text{CR}$
\end{lemma}
\begin{proof}
We prove the lemma by showing with probability at least $1-\delta$, $L_n(h^*) \lesssim \xi^2$ holds and $L_n(\hat{h}) \gtrsim -\xi^2$ holds.

\textbf{Upper bound of $L_n(h^*) \lesssim \xi^2$:}
Let $\phi_n(h,g)$ and $\phi(h,g)$ be defined as
\begin{equation*}
    \left\{
    \begin{aligned}
    & \phi_n(h,g) = \frac{1}{n}\sum_{i=1}^n(h(x_i)-y_i)g(z_i) \\
    & \phi(h,g) = \E[(h(X)-Y)g(Z)]
    \end{aligned}
    \right.
\end{equation*}
By Lemma \ref{lem:diff between phi_n and phi IV}, we have
\begin{align}\label{eqn:L_n(h*) 1 IV}
    L_n(h^*) = &~ \sup_{g\in\cG}\{\phi_n(h^*, g) - \frac{1}{2}\|g\|_{2,n}^2\} \notag\\
    \le &~ \sup_{g\in\cG}\{\phi(h^*,g)-\frac{1}{2}\|g\|_{2,n}^2+C_1(\xi\|g\|_2+\xi^2)\}
\end{align}
By Lemma \ref{lem:diff between g_2,n and g_2 IV}, we have $-\|g\|_{2,n}^2 \le -\frac{1}{2}\|g\|_2^2 + \xi^2$. Hence
\begin{align}\label{eqn:L_n(h*) 2 IV}
    \eqref{eqn:L_n(h*) 1 IV} \le &~ \sup_{g\in\cG}\{\phi(h^*,g)-\frac{1}{4}\|g\|_{2,n}^2+ C_1\xi\|g\|_2 + (C_1+\frac{1}{2})\xi^2 \}
\end{align}
Notice that $-a\|g\|_{2,n}^2 + b\|g\|_{2,n}$ is quadratic in $\|g\|_{2,n}$ and thus $-a\|g\|_{2,n}^2 + b\|g\|_{2,n} \le \frac{b^2}{4a}$.
Therefore \eqref{eqn:L_n(h*) 2 IV} can be upper bounded by
\begin{align}\label{eqn:L_n(h*) 3 IV}
    \eqref{eqn:L_n(h*) 2 IV} \le & ~ \sup_{g\in\cG}\left\{\phi(h^*,g)+\frac{C_1^2\xi^2}{4\cdot\frac{1}{4}}+(C_1+\frac{1}{2})\xi^2\right\} \notag\\
    = & ~ \sup_{g\in \cG}\left\{\phi(h^*,g)+(C_1^2+C_1+\frac{1}{2})\xi^2\right\}
\end{align}
Recall that we assume $Z$ is an instrumental variable and $Y=h^*(X)+\epsilon$, thus
\begin{align*}
    \phi(h^*,g) = &~ \E[(h^*(X)-Y)g(Z)] \\
    = &~ \E[\E[h^*(X)-Y)|Z]g(Z)] \\
    = &~ 0
\end{align*}
Therefore let $C_2 = C_1^2+C_1+\frac{1}{2}$ and we have for $L_n(h^*)$
\begin{align}\label{eqn:L_n(h*) 4 IV}
    L_n(h^*) ~ \le ~ \eqref{eqn:L_n(h*) 3 IV} ~ \le ~ (C_1^2+C_1+\frac{1}{2})\xi^2 ~ = ~ C_2\xi^2
\end{align}


\textbf{Lower bound of $L_n(\hat{h}) \gtrsim -\xi^2$:} By the definition of $L_n(\hat{h})$, we have
\begin{align}\label{eqn: L_n(hat h) 1 IV}
    L_n(\hat{h}) =&~ \sup_{g\in\cG}\left\{\frac{1}{n}\sum_{i=1}^n(\hat{h}(x_i)-y_i)g(z_i)-\frac{1}{2n}\sum_{i=1}^n g(z_i)^2\right\} \notag \\
    = &~ \sup_{g\in\cG}\left\{\frac{1}{n}\sum_{i=1}^n(\hat{h}(x_i)-y_i)g(z_i) - \frac{1}{n}\sum_{i=1}^n(h^*(x_i)-y_i)g(z_i) +  \frac{1}{n}\sum_{i=1}^n(h^*(x_i)-y_i)g(z_i) - \frac{1}{2n}\sum_{i=1}^n g(z_i)^2\right\} \notag \\
    = &~ \sup_{g\in\cG} \left\{\left(\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right) + \left(\phi_n(h^*,g)+\frac{1}{2}\|g\|_{2,n}^2\right)\right\}
\end{align}
Notice that for all $g\in\cG$, we have $\phi_n(h^*,g)+\frac{1}{2}\|g\|_{2,n}^2 \ge \inf_{g'\in\cG}\{\phi_n(h^*,g')+\frac{1}{2}\|g'\|_{2,n}^2\}$.
Hence
\begin{align}\label{eqn: L_n(hat h) 2 IV}
    \eqref{eqn: L_n(hat h) 1 IV} \ge &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2 + \inf_{g'\in\cG}\left\{\phi_n(h^*,g')+\frac{1}{2}\|g'\|_{2,n}^2\right\}\right\} \notag \\
    = &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\}  + \inf_{g'\in\cG}\left\{\phi_n(h^*,g')+\frac{1}{2}\|g'\|_{2,n}^2\right\}  \notag \\
    = &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\}  -  \sup_{g\in\cG}\left\{-\phi_n(h^*,g)-\frac{1}{2}\|g\|_{2,n}^2\right\} \notag \\
    = &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\}  -  \sup_{g\in\cG}\left\{\phi_n(h^*,-g)-\frac{1}{2}\|-g\|_{2,n}^2\right\}
\end{align}
As we assume $\cG$ is symmetric, $\sup_{g\in\cG} \{F(-g)\} = \sup_{g\in\cG}\{F(g)\}$ for any functional $F:\cG\rightarrow \RR$.
Thus
\begin{align}\label{eqn: L_n(hat h) 3 IV}
    \eqref{eqn: L_n(hat h) 2 IV} = &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\}  -  \sup_{g\in\cG}\left\{\phi_n(h^*,g)-\frac{1}{2}\|g\|_{2,n}^2\right\} \notag \\
    = &~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\}  -  L_n(h^*)
\end{align}
As shown above in \eqref{eqn:L_n(h*) 4 IV}, $L_n(h^*) \le C_2\xi^2$ holds.
Hence
\begin{align}\label{eqn:L_n(hat h) 4 IV}
    \eqref{eqn: L_n(hat h) 3 IV} \ge & ~ \sup_{g\in\cG} \left\{\phi_n(\hat{h},g)-\phi_n(h^*,g)-\|g\|_{2,n}^2\right\} - C_2\xi^2
\end{align}
\end{proof}

\begin{lemma}\label{lem:diff between phi_n and phi IV}
There exsits a constant $C_1 > 0$ such that with probability at least $1-\delta$, $\forall g\in\cG$, $|\phi_n(h^*,g)-\phi(h^*,g)|\le C_1(\xi\|g\|_2+\xi^2)$ holds.
\end{lemma}
\begin{proof}
\end{proof}

\begin{lemma}\label{lem:diff between g_2,n and g_2 IV}
With probability at least $1-\delta$, $\forall g\in\cG$, $|\|g\|_{2,n}^2-\|g\|_2^2|\le\frac{1}{2}\|g\|_2^2+\xi^2$
\end{lemma}
\begin{proof}
\end{proof}

\begin{lemma}\label{lem:MSE conditioned on IV}
\end{lemma}
\begin{proof}
\end{proof}

\fi