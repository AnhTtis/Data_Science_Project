%revision started  August 10, 2023
\section{Proof of Theorem \ref{th:main}}
\label{se:proofs}
\subsection{Alexandroff's Theorem}
Our next task is now to show how to reduce the theorem for $\TCMSOL$ to Theorem \ref{th:SB} of Section \ref{se:SB}.
Besides using Theorem \ref{th:SB} we use several classical facts about finite topologies, taken from \cite{may2003finite}.

First we state a bijection theorem. 

\begin{theorem}[Alexandroff, 1931]
\label{th:1931}
There are 
bijections $\alpha$ and $\alpha'$ 
between finite topologies and finite quasi-orders
and vice versa. Furthermore, they are the inverses of each other.
\end{theorem}

\begin{proof}
Let $\cT =(X, \cU, E)$ be a finite topology. For $x \in X$ define $U_x$ to be intersection of all open sets
which contain $x$. The sets $U_x$ form a basis for $\cU$.
Define a relation $\leq_{\cU}$ on the set $X$ by $x \leq_{\cU} y$
if $x \in U_y$ or, equivalently, $U_x \subseteq U_y$ . Write $x <_{\cU} y$ if the inclusion is proper.
The relation $\leq_{\cU}$ is transitive and reflexive, 
hence it defines for each $\cU$ a unique quasi-order $\leq_{\cU}$.
We define $\alpha(\cT) = (X, \leq_{\cU})$. 

Conversely, let $(X, \leq)$ be a quasi-order. The sets $U_x = \{ y \in X: y \leq x \}$ 
form a basis for a topology $\cU_{\leq}$.
We define $\alpha'((X, \leq)) = (X, \cU_{\leq})$. 
\end{proof}




\subsection{Translation schemes}
The maps $\alpha$ and $\alpha'$ from Theorem \ref{th:1931}  are actually definable in $\MSOL$ and $\TMSOL$ respectively
by translation schemes as defined below.
This is needed to construct an algorithm which translates a formula $\theta$ of $\TCMSOL$ 
into a formula $\theta^{\sharp}$ of $\CMSOL$ over quasi-orders such that 
for every finite quasi-order $\mathfrak{O}$
$$
\alpha'(\mathfrak{Q}) \models \theta \text{ iff } \mathfrak{Q} \models \theta^{\sharp}.
$$
\begin{conclusion}
The number of finite topolologies on a set with $n$ elements which satisfy $\theta$ equals the number of
finite quasi-orders on a set with $n$ elements which satisfy $\theta^{\sharp}$.
\end{conclusion}

We first show the definability of $\alpha$.
Let $\cT =(X, \cU, E)$ be a finite topology.
We want to define inside $\cT$ a quasi-order $\cQ =(X, \leq)$.
For this we exhibit two formulas $\phi(x)$ and $\phi_{\leq}(x,y)$ in $\TMSOL$ which 
form a translation scheme $\Phi =( \phi(x), \phi_{\leq}(x,y))$. 

With $\Phi$ we associate two maps. $\Phi^{\star}$ and $\Phi^{\sharp}$.
$\Phi^{\star}$ maps finite topological spaces into quasi-orders, and
$\Phi^{\sharp}$ maps formulas of $\CMSOL$ into formulas of $\TCMSOL$.
Let $\cT$ a finite topology and $\theta$ a formula of $\CMSOL$ for quasi-orders.
These two maps satisfy the following:
$$
\Phi^{\star}(\cT) \models \theta \text{  iff  }
\cT \models \Phi^{\sharp}(\theta)
$$
and
$$
\alpha(\cT) = \Phi^{\star}(\cT).
$$

For $\alpha'$ we proceed similarily.
Let $\cQ$ be a quasi-order.
We want to define inside $\cQ$ a finite topology using formulas
of $\CMSOL$ given by 
$$
\Psi = (\psi(x), \psi_{open}(U), U(x))
$$
\begin{itemize}
\item
$\psi(x):= x=x$ defines the universe of the topology.
\item
$\psi_{basic}(x, U): = (U(x) \wedge  
(\forall y  (U(y)  \leftrightarrow y \leq x)
)$
defines the basic open sets.
\item
$\psi_{open}(U):= \forall z 
%(U(z) \leftrightarrow   \exists V \exists y V(y) ( \psi_{basic}(y, W) \wedge W(z))$ 
(U(z) \leftrightarrow   \exists V \exists y ( \psi_{basic}(y, V) \wedge V(z))$ 
says that $U$ is a union of basic open sets.
\end{itemize}


With $\Psi$ we associate two maps. $\Psi^{\star}$ and $\Psi^{\sharp}$.
$\Psi^{\star}$ maps finite quasi-orders into finite topologies, and
$\Psi^{\sharp}$ maps formulas of $\TCMSOL$ into formulas of $\CMSOL$.
Let $\cQ$ a finite quasi-order and $\theta$ a formula of $\TCMSOL$.
These two maps satisfy the following:
$$
\Psi^{\star}(\cT) \models \theta \text{  iff  }
\cT \models \Psi^{\sharp}(\theta)
$$
and
$$
\alpha'(\cQ) = \Psi^{\star}(\cQ).
$$

$\Psi^{\sharp}$ is defined inductively.

The atomic formulas of $\TCMSOL$ are
$E(x,U)$, which is translated as $\psi_{open}(U) \wedge U(x)$, and $U(x)$,
which is translated by $U(x)$.
The translations commute with the boolean oeprations and quantifications of $\TCMSOL$.



Let $U_x$ be the intersection of all open sets $U$ which contain $x$.

This can be expressed in $\TFOL$ by the formula
$\phi_{U_x}(x,U)$ from the previous section.
%$$
%\phi_{U_x}(x,U): 
%E(x,U) \leftrightarrow 
%\left[ 
%\forall V (E(x,V) \rightarrow 
%( \forall z E(z, U)  \rightarrow E(z, V))
%\right]
%$$
Now $x \leq y$ can be defined by $U_x \subseteq U_y$, which be expressed as
$$
\phi_{\leq}(x,y):
\forall z  
\left[
\exists U (E(z, U) \wedge \phi_{U_x}(x,U))
\rightarrow
\exists V (E(z, V) \wedge \phi_{U_x}(y,V))
\right]
$$
The translation scheme $\Phi = (x=x, \phi_{\leq}(x,y))$ consists of two formulas.
The first is a tautology in the free variable $x$ and defines the new universe, which in this case is also $X$. 
The second formula, $\phi_{\leq}(x,y))$ defines the quasi-order.

$\Phi$ induces to maps, $\Phi^{\star}$ which maps finite topologies onto quasi-orders over the same universe,
and $\Phi^{\sharp}$, which maps $\CMSOL$-formulas into $\TCMSOL$-formulas, by replacing each occurrence
of $x_1 \leq x_2$ by $\phi_{\leq}(x_1,x_2)$.

\begin{lemma}
$\alpha(\cT) = \Phi^{\star}(\cT)$.
\end{lemma}

In the other direction, let $ \cQ =(X, \leq)$ be a finite quasi-order.
We want to define inside $\cQ$ a topology $\cT =(X, \cU, E)$.
We actually define a structure
$$
\cT' =(X, P(X), \cU, \cB, E, E_{top}, E_{basis})
$$ 
where $P(A)$ is the powerset of $A$, and $\cB$ is a minimal basis
for the topolgy $\cU$.
$E,  E_{top}, E_{basis}$ are the membership relations for elements of $X$ and $P(A), \cU, \cB$ respectively.

Again $X$ can be defined by $x=x$, and $P(A)$ can be defined by $\phi_{set}(X): \forall x (X(x) \leftrightarrow X(x))$,
or, for that matter, by any appropriate tautology in one free variable.

The non-empty basic sets are defined by 
%$$ \cB = \{ B \in P(X): \forall y (y \in B \leftrightarrow \exists x  (y\leq x)\}.$$
$$ \cB = \{ B \in P(X): \exists x \forall y (y \in B \leftrightarrow (y\leq x)\}.$$
Hence we put
%$$\phi_{basis}(B)(y,B): \exists y (B(y) \leftrightarrow \exists x  (y\leq x).$$
%$$\phi_{basis}(B): \forall y (E(y, B) \leftrightarrow \exists x  (y\leq x).$$ 
$$\phi_{basis}(B): \exists x \forall y (E(y, B) \leftrightarrow (y\leq x).$$ 

Then the non-empty open sets are defined by
$$ \cU = \{ U \in P(X): \forall x  (x\in U \leftrightarrow (\exists B \in \cB (x \in B \wedge B \subseteq U))) \}.$$
Hence we put
$$\phi_{top}(U): \forall x  (E(x,U) \leftrightarrow  (\exists B \in \cB (x \in B \wedge B \subseteq U))).$$
%(\exists y \exists B (B(y) \wedge (\forall z (B(z) \rightarrow U(z)))).$$
The translation scheme is now defined by
$$\Psi  = ( x=x, \phi_{set}(X), \phi_{top}(U), \phi_{basis}(B), X(x) ).$$ 

$\Psi$ induces to maps, $\Psi^{\star}$, which maps finite quasi-order onto topologies over the same
underlying set. and $\Psi^{\sharp}$, which transforms $\TCMSOL$-formulas 
%into $\TCMSOL$-formulas,
by replacing each occurrence of $E(x, X), E(x, U), E(x,B)$ by its definitions.

\begin{lemma}
$\alpha'(\cQ) = \Psi(\cQ)$.
\end{lemma}
%Â§Recall that $\alpha$ is the bijection between finite topologies and quasi-orders from Theorem \ref{th:1931}.
\begin{theorem}
\label{th:trans}
The translation schemes $\Phi$ and $\Psi$ satisfy the following:
\begin{enumerate}[(i)]
\item
$\Phi^{\star}(\cT)= \alpha(\cT)$ and
$\Psi^{\star}(\cQ)= \alpha'(\cQ)$; 
\item
for every 
%$\theta \in \CMSOL^h$ 
$\theta \in \CMSOL$ 
and very finite quasi-order $\cQ$,
$$\alpha(\cT) = \cQ \models \theta  \text{  iff   }  \cT \models \Phi^{\sharp}(\theta).$$
\item
for every 
%$\sigma \in \TCMSOL^h$ 
$\sigma \in \TCMSOL$ 
and very finite topology $\cT$,
$$\alpha'(\cQ) = \cT \models \sigma  \text{  iff   } \cQ \models \Psi^{\sharp}(\sigma).$$
\end{enumerate}
\end{theorem}

%\begin{theorem}[E. Fischer and J.A. Makowsky, 2022]
\begin{theorem}[\cite{fischer2022extensions}]
\label{th:FiMa}
Let $\theta(a_1, \ldots, a_r)$ be a sentence in 
%$\CMSOL^h$
$\CMSOL$
 with $r$ constant symbols, 
and let $S(n)= S_{\theta(a_1, \ldots, a_r)}(n)$ be the number of relations $R \subseteq [n]^2$,
such that 
$$([n], R, (a_1, \ldots, a_r)) \models \theta(a_1, \ldots, a_r).$$ 
%$([n], R, (a_1, \ldots, a_r)) \models \theta(a_1, \ldots, a_r)$. 
In both cases, where the constant symbols are
hard-wired or not, $S$ is MC-finite.
\end{theorem}

Let $\sigma(a_1, \ldots, a_r)$ be a sentence in 
%$\TCMSOL^h$ 
$\TCMSOL$ 
with $r$ constant symbols, 
and let $S^t(n)= S^t_{\sigma(a_1, \ldots, a_r)}(n)$ be the number of topologies on $[n]$
such that 
$$([n], \cU, \, (a_1, \ldots, a_r)) \models \sigma(a_1, \ldots, a_r).$$ 
and let $\hat{S}^t(n)= S^t_{\neg \sigma(a_1, \ldots, a_r)}(n)$ be the number of topologies on $[n]$
such that 
$$([n], \cU, \, (a_1, \ldots, a_r)) \models \neg \sigma(a_1, \ldots, a_r).$$ 
\begin{theorem}
\label{th:main-1}
In both cases, whether the constant symbols are
hard-wired or not, 
\begin{enumerate}[(i)]
\item
$S^t(n)$ 
and
$\hat{S}^t(n)$ 
are MC-finite, but 
\item
at least one of them is not C-finite.
\end{enumerate}
\end{theorem}

%\begin{proof}
%\end{proof}
