\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[legalpaper, margin=1in]{geometry}

\usepackage{times}
\usepackage{epsfig}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tabularx} 
\usepackage{mathtools} 
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{booktabs}
\usepackage{authblk}
\usepackage{tikz-cd}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
%\usepackage{algorithmic}

\newcommand{\FR}[1]{{\color{olive}{\textbf{FR:} #1 }}}
\newcommand{\MB}[1]{{\color{purple}{\textbf{MB:} #1 }}}


\newtheorem{innercustomgeneric}{\customgenericname}
\providecommand{\customgenericname}{}
\newcommand{\newcustomtheorem}[2]{%
  \newenvironment{#1}[1]
  {%
   \renewcommand\customgenericname{#2}%
   \renewcommand\theinnercustomgeneric{##1}%
   \innercustomgeneric
  }
  {\endinnercustomgeneric}
}

\newcustomtheorem{customtheorem}{Theorem}
\newcustomtheorem{customproposition}{Proposition}
\newcustomtheorem{customlemma}{Lemma}
\newcustomtheorem{customcorollary}{Corollary}

% Include other packages here, before hyperref.

% If you comment hyperref and then uncomment it, you should delete
% egpaper.aux before re-running latex.  (Or just hit 'q' on the first latex
% run, let it finish, and you should be clear).
\usepackage[pagebackref=true,breaklinks=true,letterpaper=true,colorlinks,bookmarks=false]{hyperref}

\include{StartingPackage}

%\include{StartingPackage}
% \iccvfinalcopy % *** Uncomment this line for the final submission

%\def\iccvPaperID{12433} % *** Enter the ICCV Paper ID here
%\def\httilde{\mbox{\tt\raisebox{-.5ex}{\symbol{126}}}}

% Pages are numbered in submission mode, and unnumbered in camera-ready
%\ificcvfinal\pagestyle{empty}\fi


\begin{document}
%%%%%%%%% TITLE
\title{Compatibility of Fundamental Matrices for Complete Viewing Graphs}
\author[1]{Martin Bråtelund}
\author[2]{Felix Rydell}
\affil[1]{University of Oslo, Oslo, Norway}
\affil[2]{KTH Royal Institute of Technology, Stockholm, Sweden}

\maketitle


\begin{abstract}
This paper studies the problem of recovering cameras from a set of fundamental matrices. A set of fundamental matrices is said to be compatible if a set of cameras exists for which they are the fundamental matrices. We focus on the complete graph, where fundamental matrices for each pair of cameras are given. Previous work has established necessary and sufficient conditions for compatibility as rank and eigenvalue conditions on the $n$-view fundamental matrix obtained by concatenating the individual fundamental matrices. In this work, we show that the eigenvalue condition is redundant. We provide explicit homogeneous polynomials that describe necessary and sufficient conditions for compatibility in terms of the fundamental matrices and their epipoles. In this direction, we find that quadruple-wise compatibility is enough to ensure global compatibility for any number of cameras. We demonstrate that for four cameras, compatibility is generically described by triple-wise conditions and one additional equation involving all fundamental matrices. 
\end{abstract}

%%%%%%%%% BODY TEXT
\section{Introduction} 
The problem of finding camera matrices that correspond to a given set of fundamental matrices is crucial in 3D reconstructions from 2D images. Typically, multiview structure-from-motion pipelines start by estimating fundamental matrices from point correspondences, with early methods for such estimations dating back to the 1990s and new methods still being developed today \cite{torr1995motion,xu1996epipolar,torr1997development,ranftl2018deep}. However, these methods usually only estimate a subset of all possible fundamental matrices between cameras. To describe this incomplete set of fundamental matrices, viewing graphs are often used \cite{levi2003viewing}.


In this paper, we focus on understanding the conditions under which a reconstruction of $n$ cameras can be obtained given complete knowledge of ${n\choose 2}$ fundamental matrices. Here, a \emph{camera} refers to any full-rank $3\times 4$ matrix, and the \emph{fundamental matrix} of two full-rank $3\times 4$ cameras $P_1$ and $P_2$ with distinct kernels is a $3\times 3$ rank-two matrix that describes all point correspondences between them. For any given rank-two $3\times 3$ matrix $F^{12}$, there is a unique pair of cameras $P_1$ and $P_2$ for which $F^{12}$ is the fundamental matrix up to global projective transformation. However, for a set of ${n\choose 2}$ rank-two $3\times 3$ matrices $F^{ij}$, where $n>2$, it is not always guaranteed that there exist cameras $P_1,\ldots,P_n$ for which $F^{ij}$ is the fundamental matrix of $P_i$ and $P_j$ for each $i,j$. We say that the set ${F^{ij}}$ is \emph{compatible}, following the notation of \cite{Hartley2004}, if such cameras do exist. Note that some recent literature uses the term \emph{consistent} instead \cite{kasten2019gpsfm}.

In the case of $n=3$, a classical result \cite[Section 15.4]{Hartley2004} provides triple-wise constraints on $F^{12},F^{13},F^{23}$ in terms of the fundamental matrices and their epipoles. Here, the $i$-th epipole in the $j$-th image is defined as $e_j^i:=\ker F^{ij}$. For non-collinear cameras, \cite[Theorem 1]{kasten2019gpsfm} provides necessary and sufficient conditions for compatibility for any $n$. These conditions rely on the eigenvalues and rank of the $n$-view fundamental matrix, which is obtained by stacking all fundamental matrices into a $3n\times 3n$ matrix. In the follow-up work, \cite[Theorem 2]{geifman2020averaging} arrives at a similar condition in the collinear case. Both methods rely on fixing a correct scaling of each matrix and are therefore not projectively well-defined, nor are the conditions expressed in terms of the fundamental matrices and their epipoles, as in the $n=3$ case.


The contributions of this paper include a necessary and sufficient condition for compatibility for any viewing graph via a \emph{cycle condition} detailed in \Cref{s: Can}. In \Cref{s: Kn} we state explicit homogeneous polynomials that provide necessary and sufficient conditions for the compatibility of fundamental matrices in the case of complete graphs. Specifically, for the case of $n=4$, we establish that a set of six fundamental matrices admits a reconstruction of camera matrices with linearly independent centers only if the triple-wise constraints and an additional polynomial equation involving all six fundamental matrices and their epipoles are satisfied. We also demonstrate, using the computer algebra system \texttt{Macaulay2} \cite{M2}, that the eigenvalue conditions from \cite{kasten2019gpsfm, geifman2020averaging} are superfluous. We end in \Cref{s: Image} with a discussion on the \emph{viewing graph variety}. Proofs that are left out in the main body of the paper appear in the Appendix.



\subsection{Related work} We approach compatibility of fundamental matrices from an algebraic point of view, i.e., we aim to describe constraints through algebraic equations and polynomial equations using techniques and software from applied algebraic geometry. This approach to questions in computer vision has a long standing tradition \cite{heyden1997algebraic,trager2015joint,agarwal2019ideals,duff2019plmp,kileel2022snapshot}.

\paragraph{History.} The problem of determining whether a set of fundamental matrices is compatible has a curious history. In 2007, the paper \cite[Theorem 2.2]{HK} claimed that the triple-wise condition from \cite{Hartley2004} was sufficient for compatibility even in the case of collinear cameras, a claim that we now know to be false, as we show in \Cref{s: Kn}. For the next decade, few advances were made in understanding compatibility. Over time, a belief seemed to develop that triple-wise compatibility was enough to ensure global compatibility. In fact, articles such as \cite[Section 2.1]{falseclaim2} claimed this to be true, based on a faulty proof provided in \cite{rudi2011linear}. In 2018, \cite[Section 3.3]{trager2018solvability} pointed out that the proof in \cite{rudi2011linear} fails in some cases, but still agreed that the result holds for complete graphs. However, we provide an explicit counterexample to this claim in \Cref{s: Kn} for the complete graph on four nodes.

In terms of practical applications, \cite{kasten2019gpsfm} proposes an algorithm for projective structure-from-motion that employs their necessary and sufficient condition for compatibility. The algorithm is designed to handle collections of measured fundamental matrices, both complete and partial, and aims to find camera matrices that minimize a global algebraic error for the given set of matrices.




\paragraph{Essential matrices.} 

In the context of \emph{uncalibrated cameras}, which are defined as any full-rank $3\times 4$ matrix, this work, as well as \cite{kasten2019gpsfm}, provide necessary and sufficient conditions for compatibility of fundamental matrices. However, camera matrices are often assumed to be \emph{calibrated}, represented in the form of $[R|t]$ for a rotation matrix $R$ and a translation vector $t$. The corresponding fundamental matrices are called \emph{essential matrices}. In \cite{kasten2019algebraic}, the authors build upon their previous work and provide a necessary and sufficient condition for compatibility of essential matrices, in terms of the $n$-view essential matrix obtained by stacking all essential matrices into a larger matrix. This condition is then used to recover a consistent set of essential matrices, given a partial set of measured essential matrices.


\paragraph{Solvability.} There has been extensive research on the topic of \emph{solvability} of \emph{viewing graphs} in computer vision, as evidenced by various studies such as \cite{levi2003viewing,rudi2011linear,nardi2011augmented,trager2015joint,trager2018solvability,arrigoni2021viewing,arrigoni2022revisiting}. A viewing graph is considered solvable if, given a generic set of cameras, their fundamental matrices have a unique solution in terms of cameras up to global projective transformation. Recently, \cite{arrigoni2021viewing} proposed a new formulation of solvability and developed an effective algorithm for testing it, which was able to resolve some open questions from previous studies, such as \cite{trager2018solvability}.

In contrast, the question of compatibility has received less attention in the literature. The primary distinction between solvability and compatibility lies in the fact that, in the latter, the existence of cameras that correspond to a set of fundamental matrices is not assumed to exist. Moreover, compatibility has mostly been studied for graphs where each possible fundamental matrix is given, whereas papers on solvability study viewing graphs without such restrictions.

Furthermore, solvability has been investigated in the case of calibrated cameras, where it is known that the solvable graphs are precisely those that are \emph{parallel rigid} \cite{ozyesil2015robust,sattler2016efficient}.



\paragraph{Acknowledgements.} The authors would like to thank Kathlén Kohn, Kristian Ranestad, Timothy Duff, and Paul Breiding for helpful discussions. Martin Bråtelund was supported by the Norwegian National Security Authority. Felix Rydell was supported by the Knut and Alice Wallenberg Foundation within their WASP (Wallenberg AI, Autonomous Systems and Software Program) AI/Math initiative.

%------------------------------------------------------------------------
\section{Preliminaries}\label{s: Pre} In this section we recall established notation and results. We refer the reader to \cite{Gathmann} for the basics on algebraic geometry and \cite{Hartley2004} for the application of algebra in 3D reconstruction problems. 

We work over the real numbers, although all results in this paper either directly hold in the complex case or can be reformulated to do so. Where slight adjustments have to be made over the complex numbers, we make a remark.  

Let $\RR^n$ denote the set of real vectors with $n$ coordinates, we call this \emph{affine space}. $\PP^{n-1}$ is the quotient space $(\RR^{n}\setminus \{0\})/\sim$, where $x\sim y$ if and only if $x$ and $y$ differ by a non-zero constant, we call this \emph{projective space}. We write $\RR^{n\times m}$ to denote the set of real $n\times m$ matrices, and we write $\PP^{n\times m}$ to denote the set of real projective $n\times m$ matrices. In order to denote an element of affine space we use underline. For instance, if $F\in \PP^{n\times m}$, then $\underline{F}\in \RR^{n\times m}\setminus\{0\}$ is a representative of $F$ and vice versa. 


We define a map,
\begin{equation}
    \psi : \RR^{3\times 4}\times \RR^{3\times 4}\to \RR^{3\times 3},
\end{equation}
as follows. Given a pair of matrices $\underline{P}_1,\underline{P}_2$, let $x_1$ and $x_2$ be two $3\times1$ vectors. The determinant
\begin{align}\label{eq: det}
\det\begin{bmatrix}
\underline{P}_1&x_1&0\\
\underline{P}_2&0&x_2
\end{bmatrix},
\end{align}
is a billinear polynomial in $x_1$ and $x_2$, meaning there is a matrix $\underline{F}^{12}$ such that \Cref{eq: det} equals $x_1^T\underline{F}^{12}x_2$. We define $\psi(\underline{P}_1,\underline{P}_2)$ to be this $3\times 3$ matrix. Note that this map induces a projective rational map 
\begin{equation}
    \psi : \PP^{3\times 4}\times \PP^{3\times 4}\dashrightarrow \PP^{3\times 3}.
\end{equation}
 This map is undefined, i.e. $\psi(P_1,P_2)=0$, precisely when $\ker P_1\cap \ker P_2\neq \{0\}$. 
 
Let $M_{r}^{n\times m}\subseteq \PP^{m\times n}$ denote the space of $m\times n$ matrices of rank $r$, defined up to non-zero scaling. We refer to elements in $M_2^{3\times3}$ as \emph{fundamental matrices}. We refer to elements in $M_3^{3\times4}$ as \emph{cameras}. The \emph{center} of a camera $P$ is its kernel $\ker P$.

Before we list the a set of well-known results, partly found in \cite[Section 9]{Hartley2004}, we recall that $\mathrm{GL}_n$ denotes the set of invertible $n\times n$ matrices and that $\mathrm{PGL}_n$ is its projectivization.

\begin{proposition}\label{prop:properties_of_the_fundamental_matrix} $ $

\begin{enumerate} 
      \item $\psi(P_1,P_2)$ is of rank at most 2, and it attains this rank if $P_1,P_2$ are cameras with distinct centers;
    \item for any element $F^{12}\in M_2^{3\times3}$, there exists two cameras $P_1,P_2$ such that $F^{12}$ is their fundamental matrix. All other cameras $C_1,C_2$ with fundamental matrix $F^{12}$ satisfy $C_1=P_1H,C_2=P_2H$ for some $H\in \mathrm{PGL}_4$;
    \item $\psi(\underline{P}_2,\underline{P}_1)=\psi(\underline{P}_1,\underline{P}_2)^T$;
    \item if $F^{12}$ is the fundamental matrix of $P_1,P_2$, then $\ker F^{12}=P_2 (\ker(P_1))$;
    \item for cameras $P_1,P_2$ we have $F^{12}=\psi(P_1,P_2)$ if and only if $P_1^TF^{12}P_2$ is a skew-symmetric matrix.
\end{enumerate}
\end{proposition}

Given a \emph{viewing graph} $\mathcal{G}=(V,E)$ with vertices $V=\{1,\ldots,n\}$ and undirected edges $E$, let $\{F^{ij}\}$ for $(ij)\in E$ denote a set of fundamental matrices. The edge $(ij)\in E$ defines two fundamental matrices, $F^{ij},F^{ji}$ satisfying $F^{ji}=(F^{ij})^T$. We say that $\{F^{ij}\}$ is \emph{compatible} if there are cameras $P_1,\ldots,P_n$ such that $F^{ij}=\psi(P_i,P_j)$. The cameras $P_1,\ldots,P_m$ are called a \emph{solution} to $F^{ij}$. In this paper, we focus mostly on complete viewing graphs $K_n$, i.e. the graph on $n$ nodes with all possible $n\choose 2$ undirected edges present. 

 We define the $i$-th \emph{epipole} in the $j$-th image to be $e_j^i:=\ker F^{ij}$. Note that strictly speaking, $e_j^i$ is not a polynomial in the entries of $F^{ij}$, because there is no way to write a generator of
the left kernel of a matrix $X$ as a polynomial expression that works for every $3\times 3$ matrix of rank 2. However, one can for instance turn the expression $(e_i^s)^TF^{ij}e_j^s=0$ into a polynomial system in $F^{si},F^{ij}$ and $F^{sj}$ by defining the epipoles on affine patches of the fundamental matrices, which we don't explain here in further detail. % and writing $e_i^sF^{ij}e_j^t$ as a system of 9 equations, although we don't describe this process in detail here.  

\begin{lemma}[{\hspace{1sp}\cite[Section 15.4]{Hartley2004}}]
\label{lem:triple_has_unique_solution}
    Let $\Set{F^{ij}}$ be a triple of compatible fundamental matrices. The triple has a unique solution if and only if the two epipoles in each image are distinct.
\end{lemma}

Given a fixed set of fundamental matrices $F^{ij}$, we point out that there is a rather simple method of finding possible solutions in terms of cameras by first using $F^{12}$ to recover $P_1,P_2$ and then using \Cref{lem:triple_has_unique_solution} with matrices $\Set{F^{12},F^{1i},F^{2i}}$ to recover the remaining $P_i$ (a detailed algorithm can be found in \cite[Section 6.1]{HK}). Finding explicit equations in terms of the fundamental matrices and epipoles for compatability is however more difficult, and is the subject of this paper.



%------------------------------------------------------------------------

%------------------------------------------------------------------------
\section{The Fundamental Action}\label{s: Action}

%------------------------------------------------------------------------

In this section we formally introduce the fundamental action. Let $\mathcal G=(V,E)$ be a viewing graph of $n$ nodes with fundamental matrices $\Set{F^{ij}}$. $\mathrm{GL}_3^n$ (or equivalently $\mathrm{PGL}_3^n$) acts on a set of fundamental matrices $\Set{F^{ij}}$ by
\begin{align}
    F^{ij}\mapsto H_i^TF^{ij}H_j.
\end{align}
We call this the \emph{fundamental action} of $\mathrm{GL}_3^n$. The main appeal of this action is that we can use it to simplify a set of fundamental matrices, without affecting compatibility. 

\begin{proposition} 
\label{prop:fundamental_action_preserves_compibility} Let $\Set{F^{ij}}$ be a set of fundamental matrices for a viewing graph $\mathcal G$. Let $P_i$ be a solution to $\Set{F^{ij}}$. For any $(H_1,\ldots,H_m,H)\in \mathrm{PGL}_3^n\times \mathrm{PGL}_4$, we have, 
\begin{align}\label{eq: fund}
\psi(H_i^{-1}P_iH,H_j^{-1}P_jH)=H_i^T\psi(P_i,P_j)H_j.
\end{align} 
In particular, $\Set{F^{ij}}$ is compatible if and only if $\Set{G^{ij}}$ is compatible, where $G^{ij}:=H_i^TF^{ij}H_j$. 
\end{proposition}

\begin{proof} It is a standard fact that the action of $H\in \mathrm{GL}_4$ in \Cref{eq: fund} does not change the fundamental matrix, so we may set $H=I$. Consider the following equality up to scaling,
\begin{align}
    \det \begin{bmatrix} H_i^{-1}P_i & x_i & 0 \\
H_j^{-1}P_j & 0 & x_j\end{bmatrix}=\det \begin{bmatrix}P_i & H_ix_i & 0 \\
P_j & 0 & H_jx_j\end{bmatrix}.
\end{align}
Writing these expressions in terms of fundamental matrices, we get exactly \Cref{eq: fund}. \end{proof}

We call the action $(H_1,\ldots,H_n,H)\in \mathrm{GL}_3^n\times \mathrm{GL}_4$ on cameras $P_i$ by $H_i^{-1}P_iH$, \emph{fundamental action on cameras.} 

The fundamental action gives rise to an equivalence relation. %One can therefore ask questions regarding how many different equivalence classes exist, 
For compatible fundamental matrices, the equivalence classes turns out to be the equivalence classes of $n$ points in $\p3$ under $\PGL_4$.

\begin{proposition} \label{prop:equivalence} Let $\mathcal{G}$ be a viewing graph on $n$ nodes. Let $\Set{F^{ij}}$ and $\Set{G^{ij}}$ be two sets of compatible fundamental matrices. They are equivalent under fundamental action if and only if they have solutions whose camera centers are equivalent under $\mathrm{PGL}_4$.% with solutions $P_i$ and $Q_i$ respectively that belong to the same equivalence class if their solutions  with solution $P_i$ whose centers $c_1,\ldots,c_n$ are linearly independent are equivalent under fundamental action. 
\end{proposition}

%Since $F^{ij}$ are compatible, there exists a solution $P_i$ such that $P_i^{T}F^{ij}P_j$ is skew-symmetric for $(ij)\in E(G)$. Let $C_i$ denote the camera matrix $H_i^{-1}P_i$. Then $P_i$ and $C_i$ share the same camera center, and
%\begin{align}
%C_i^{T}S^{ij}C_j&=%(H_i^{-1}P_i)^{T}H_i^{T}F^{ij}H_j(H_j^{-1}P_j)\\
%&=P_i^{T}F^{ij}P_j.
%\end{align}
%This implies that $C_i^{T}G^{ij}C_j$ is skew-symmetric and that $C_i$ is a solution of $S^{ij}$, meaning $G^{ij}$ are compatible. The other direction is analogous. 

In our study, quantities on the form $\textbf{e}_{sijt}:=(e_i^s)^TF^{ij}e_j^t$, called \emph{epipolar numbers}, are important (see \Cref{thm:compatible_forms,thm: 4tuple-condition}). Given a viewing graph $\mathcal G=(V,E)$, they are defined for $s,i,j,t$ such that $(si),(ij),(jt)\in E$. The epipolar numbers are invariant under the fundamental action: 
\begin{lemma} Let $\Set{\underline{F}^{ij}}$ be a set of fundamental matrices with epipoles $\Set{\underline{e}_j^i}$. Let $\underline{H}_i\in \mathrm{GL}_3^n$ and consider the fundamental matrices $\underline{G}^{ij}:=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$, whose epipoles are $\underline{h}_j^i=\underline{H}_j^{-1}\underline{e}_j^i$. Then
\begin{align}
(\underline{e}_i^s)^T\underline{F}^{ij}\underline{e}_j^t=(\underline{h}_i^s)^T\underline{G}^{ij}\underline{h}_j^t.
\end{align}
\end{lemma}


%The epipolar numbers are invariant under the fundamental action: let $\Set{\underline{F}^{ij}}$ be a set of fundamental matrices. If $\{\underline{e}_j^i\}$ are the epipoles, then $\{\underline{H}_j^{-1}\underline{e}_j^i\}$ are the epipoles of $\underline{G}^{ij}:=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$, for $\underline{H}_i\in \mathrm{GL}_4^n$. Write $\underline{h}_j^i=\underline{H}_j^{-1}\underline{e}_j^i$. Projectively,
%\begin{align}
%\begin{aligned}
%(e_i^s)^TF^{ij}e_j^t&=(H_i^{-1}e_i^s)^TH_i^TF^{ij}H_j(H_j^{-1}e_j^t)\\
%&=(h_i^s)^TG^{ij}h_j^t.
%\end{aligned}
%\end{align}
%Given $\mathcal G=(V,E)$ and fundamental matrices $F^{ij}$ we call $\textbf{e}_{sijt}= (e_i^s)^TF^{ij}e_j^t$ the \emph{epipolar numbers}, defined for $s,i,j,t$ such that $(si),(ij),(jt)\in E$. The epipolar number for $s,i,j,t$ depends on the variables of $F^{si},F^{ij},F^{jt}$ with corresponding multi-degree $(2,1,2)$. 

We have the following geometrical interpretation of the epipolar numbers. 

\begin{lemma}\label{le: epip-coplane} Let $\mathcal G$ be a viewing graph with edges $(si),(ij)$ and $(jt)$ and let $\Set{F^{ij}}$ be compatible. We have $\textnormal{\textbf{e}}_{sijt}=0$ if and only if the centers $c_s,c_i,c_j,c_t$ of any solution are coplanar. 
\end{lemma}

\begin{proof} Let $P_1,\ldots,P_n$ be any solution to $\Set{F^{ij}}$. Let $L_{i,s}$ be the back-projected line of $e_{i}^s$ with respect to the $i$-th camera and $L_{j,t}$ the back-projected line of $e_j^t$ with respect to the $j$-th camera. Then since $e_i^s=P_ic_s$ by \Cref{prop:properties_of_the_fundamental_matrix} 4., $c_s$ lies in $L_{s,i}$, and similarly $c_t$ lies in $L_{j,t}$. However, $e_i^sF^{ij}e_j^t=0$ means precisely that the back-projected lines $L_{i,s}, L_{j,t}$ meet in a point. Therefore, $L_{i,s}$ and $L_{j,t}$ together span a plane, unless they are the same line. In either case, all centers lie in this span. The other direction follows similarly. 
\end{proof}


It follows from the lemma that $\textbf{e}_{sijs}$ is always zero for compatible fundamental matrices, because three centers are always in a plane. %Choosing suitable representatives of the epipoles, one may think of the epipolar numbers as a measure of how close the corresponding centers are to being coplanar.


Another invariant under the fundamental action is $(e_j^i\times e_j^s)^Te_j^t$, where $\times$ is the cross product. Indeed, for an invertible matrix $A$ we have up to scaling $(Au\times Av)=A^{-T}(u\times v)$. Then projectively,
\begin{align}
    (H_j^{-1}e_j^i\times H_j^{-1}e_j^s)^TH_j^{-1}e_j^t=(e_j^i\times e_j^s)^Te_j^i.
\end{align}
However, this invariant is equivalent to the epipolar numbers in the following sense:

\begin{lemma}\label{le: newepip} If $\textnormal{\textbf{e}}_{sijs}=0$, then $e_j^i\times e_j^s=F^{ji}e_i^s$.
\end{lemma}
\begin{proof} If $e_j^i\times e_j^s=0$, then $e_j^i=e_j^s$. This implies that $F^{ji}e_i^s=0$. Otherwise $e_j^i\times e_j^s\neq0$ and we proceed as follows. By construction, we have $(e_j^i)^T( e_j^i\times e_j^s)= (e_j^s)^T(e_j^i\times e_j^s)=(e_j^i)^T F^{ji}e_i^s=0$ and by assumption $(e_j^s)^T F^{ji}e_i^s =0$. In $\PP^3$, this implies that $e_j^i\times e_j^s=F^{ji}e_i^s$.
\end{proof}


Finally, we state an important observation that we apply in \Cref{s: Kn}, regarding expressions on the form $F^{ij}e_j^k$. For a fixed scaling $\underline{F}^{ij}$, we get a fixed scaling of $F^{ji}$ via $\underline{F}^{ji}=(\underline{F}^{ij})^T$. We denote by $\langle,\rangle$ and $\|\|$ the standard inner product and norm on $\RR^3$. 



\begin{lemma}\label{le: compat triplet} Let $F^{12},F^{13},F^{23}$ be compatible fundamental matrices. For any distinct $i,j,k\in \{1,2,3\}$, $F^{ij}e_j^k=F^{ik}e_k^j$. 

Moreover, fix scalings $\underline{F}^{ij},\underline{e}_j^k$ and assume $e_j^k\neq e_j^i$. Then over the real numbers, 
\begin{align}\label{eq: xi inv}
    \xi:=\frac{\langle \underline{F}^{ij}\underline{e}_j^k,\underline{F}^{ik}\underline{e}_k^j\rangle }{\|\underline{F}^{ik}\underline{e}_k^j\|^2} =\frac{(\underline{e}_j^k)^T\underline{F}^{ji}\underline{F}^{ik}\underline{e}_k^j}{\|\underline{F}^{ik}\underline{e}_k^j\|^2}\in \RR,
\end{align}
is invariant under fundamental action and $\underline{F}^{ij}\underline{e}_j^k= \xi \underline{F}^{ik}\underline{e}_k^j$.
\end{lemma}

\begin{remark}
Note that both $F^{ij}e_j^k$ and $F^{ik}e_k^j$ can be geometrically interpreted as the linear equation defining line spanned by the epipoles $e_i^j$ and $e_i^k$, hence they must be equal (up to scale).     
\end{remark}

\begin{proof} The first statement is a direct application of \Cref{le: newepip}. For the last statement, observe that if $x=\lambda y$ for non-zero vectors $x,y\in \RR^n$, then
\begin{align}
    \frac{\langle x,y\rangle }{\| x\|^2}= \lambda \frac{\langle x,x\rangle }{\|x\|^2}=\lambda.
\end{align}
To see that \Cref{eq: xi inv} is invariant under fundamental action, note that $\underline{F}^{ij}\underline{e}_j^k= \xi \underline{F}^{ik}\underline{e}_k^j$ implies that 
\begin{align}
\underline{H}_i^T\underline{F}^{ij}\underline{H}_j(\underline{H}_j^{-1}\underline{e}_j^k)= \xi \underline{H}_i^T\underline{F}^{ik}\underline{H}_k(\underline{H}_k^{-1}\underline{e}_k^j),
\end{align}
and we are done. %In other words, $\underline{G}^{ij}\underline{h}_j^k= \xi \underline{G}^{ik}\underline{h}_k^j$ for $\underline{G}^{ij}=\undelrine{H}_i^T\underline{G}^{ij}\underline{H}_j,\underline{G}^{ik}=\undelrine{H}_i^T\underline{G}^{ik}\underline{H}_k$ and $\underline{h}_j^k=\underline{H}_j^{-1}\underline{e}_j^k,\underline{h}_k^j=\underline{H}_k^{-1}\underline{e}_k^j$.
\end{proof}

%$\o_{iklj}:= \langle F^{ik}e_k^j,F^{il}e_l^j \rangle$
%%%%%% ----------------------------------------------


\section{Canonical Forms}\label{s: Can} Let $\mathcal G$ be a graph with compatible fundamental matrices $\Set{F^{ij}}$. Let $P_i$ be cameras such that $F^{ij}=\psi(P_i,P_j)$. By right action of $H\in \mathrm{PGL}_4$, we may assume that all centers have a non-zero last coordinate. This implies that the first three columns of all cameras are linearly independent and that the cameras can be written $[\underline{H}_i|v^{(i)}]$ with $\underline{H}_i\in \mathrm{GL}_3$. By left multiplication with $\underline{H}_i^{-1}$, we may then assume that all cameras are on the form $\underline{C}_i=[I| t^{(i)}]$. Write 
\begin{align}
    [t^{(i)}]_\times=\begin{bmatrix} 0 & -t_3^{(i)}& t_2^{(i)}\\
t_3^{(i)} & 0 & -t_1^{(i)}\\ -t_2^{(i)} &t_1^{(i)} &0\end{bmatrix}.
\end{align}
One can then check that 
\begin{align}\label{eq: fundcan}
\begin{aligned}
    \psi(\underline{C}_i,\underline{C}_j)&=[t^{(j)}]_\times-[t^{(i)}]_\times\\
    &=[t^{(j)}-t^{(i)}]_\times \in \RR^{3\times 3},
\end{aligned}
\end{align}
and we call these skew-symmetric matrices $\underline{G}^{ij}$. Recall that a directed cycle $C$ of a graph is a closed path, i.e. a path that starts and ends at the same vertex. Let $E(C)$ denote its directed edges. Since $\underline{G}^{ij}=[t^{(j)}]_\times-[t^{(i)}]_\times$, it is clear that the following \emph{cycle condition} holds,   
\begin{align}\label{eq: cycleC}
    \sum_{(ij)\in E(C)}\underline{G}^{ij}=0, \textnormal{ for each directed cycle }C \textnormal{ of } \mathcal G.
\end{align}
A set of fundamental matrices $\underline{G^{ij}}$ satisfying \Cref{eq: cycleC} are in \emph{canonical form}.  

By the above construction, for each set of compatible fundamental matrices $\Set{\underline{F}^{ij}}$ there exists a scaling $\lambda_{ij}=\lambda_{ji}\neq 0$ and $\underline{H}_i$ such that $\underline{G}^{ij}=\lambda_{ij}\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$ satisfy the cycle conditions. In particular, for each set of compatible fundamental matrices, there is an equivalent set of fundamental matrices that satisfy the cycle conditions. The canonical form isn't necessarily unique. For instance, consider $\mathcal G=K_2$, the complete graph on two nodes. Any $3\times 3 $ matrix $F^{12}$ of rank 2 can via $H_1^TF^{12}H_2$ be taken to any other $3\times 3$ matrix of rank 2.

%Observe that the cycles of length two in \Cref{eq: cycleC} imply that $\underline{G}^{ij}$ are skew-symmetric. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The cycle theorem}\label{ss: Cycle} The cycle theorem below gives a necessary and sufficient condition for when a set of fundamental matrices are compatible using the cycle condition for any graph $\mathcal G$.

Recall that for an element $F$ in projective space, we write $\underline{F}$ to denote a fixed representative.

\begin{theorem}\label{thm:cycle} Let $\Set{F^{ij}}$ be a set of fundamental matrices for a graph $\mathcal G$. Fix a representative $\underline{F}^{ij}$ for each fundamental matrix such that $\underline{F}^{ji}=(\underline{F}^{ij})^T$. $\Set{F^{ij}}$ is compatible if and only if there are matrices $\underline{H}_i\in \mathrm{GL}_{3}$ and scalars $\lambda_{ij}=\lambda_{ji}\neq 0$ such that $\underline{G}^{ij}:=\lambda_{ij}\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$ satisfy
\begin{align}
    \sum_{(ij)\in E(C)}\underline{G}^{ij}=0, \textnormal{ for each directed cycle }C \textnormal{ of } \mathcal G. \tag{\ref{eq: cycleC}}
\end{align}
In particular, any set of $3\times 3$ rank-two matrices $\underline{G}^{ij}$ satisfying the cycle condition are the fundamental matrices of some set of cameras.
\end{theorem}

%This theorem works both over the real and complex numbers. Since the 2-cycles imply that $G^{ij}$ are skew-symmetric, we see a correspondence to \Cref{prop:properties_of_the_fundamental_matrix} 5., where the difference is that $P_i$ are $3\times 4$ matrices and $H_i$ are $3\times 3$ matrices. However, the skew-symmetry given by $H_i$ is not enough to imply compatibility. 

The $\Rightarrow$ direction of this theorem was explained in \Cref{s: Can}. The last part of the statement follows directly from the $\Leftarrow$ direction, which we prove in the appendix.


We can use the cycle theorem to find conditions that must hold for compatible fundamental matrices. For instance, let $\mathcal G =K_3$ and let $\underline{G}^{12},\underline{G}^{13},\underline{G}^{23}$ be fundamental matrices satisfying the cycle conditions. Then writing $\underline{G}^{ij}=[g^{ij}]_\times$ and letting $\{\underline{h}_j^i\}$ be the epipoles defined as
\begin{align}\label{eq: Gepip}
    \underline{h}_j^i:=(g_1^{ij},g_2^{ij}, g_3^{ij})^T,
\end{align}
one can check that 
\begin{align}
    (\underline{h}_2^1)^T\underline{G}^{23}\underline{h}_3^1=\det [g^{12}\;g^{23}\;g^{31}].
\end{align}
Therefore, $g^{12}+g^{23}+g^{31}=0$ implies $(\underline{h}_2^1)^T\underline{G}^{23}\underline{h}_3^1=0$. Since the epipolar numbers are invariant under fundamental action, this is another proof that $\textbf{e}_{sijs}=0$ for compatible fundamental matrices.


We next sketch an argument using the cycle theorem for why the $n$-view fundamental matrix $\mathbf{F}=(F^{ij})_{ij}$ (see \cite{kasten2019gpsfm} or \Cref{s: Kn}) for compatible $\Set{F^{ij}}$ is at most rank 6. Since the rank is invariant under conjugation, it suffices to consider $\textbf{G}=(G^{ij})_{ij}$, where $G^{ij}+G^{jk}+G^{ki}=0$ for any $i,j,k$. For the sake of simplicity assume $n=4$, but note that the below principle directly extends to any $n$. Subtracting the first row of $\textbf{G}$ from the other rows, we have 
\begin{align}
    \textbf{G}=\begin{bmatrix}0 & G^{12} & G^{13} & G^{14}\\  
G^{21} & 0 & G^{23} & G^{24}\\ 
G^{31} & G^{32} & 0 & G^{34}\\ 
G^{41} & G^{42} & G^{43} & 0\end{bmatrix}\sim \begin{bmatrix}0 & G^{12} & G^{13} & G^{14}\\  
-G^{12} & -G^{12} & -G^{12} & -G^{12}\\ 
-G^{13} & -G^{13} & -G^{13} & -G^{13}\\ 
-G^{14} & -G^{14} & -G^{14} & -G^{14} \end{bmatrix},\label{eq: Gauss}
\end{align}
where $\sim$ denotes equivalence under Gaussian eliminiation. The rank of the first three rows of \Cref{eq: Gauss} is at most 3, and the rank of the last nine rows is the rank of the first three columns of \Cref{eq: Gauss}, which is at most 3. In total, the matrix is at most of rank 6.

We finally use the cycle theorem to find an algebraic condition for compatibility for fundamental matrices $F^{ij}$ of $K_4$ that we return to later. Assume that we are given any skew-symmmetric matrices $\Set{\underline{G}^{ij}}$, and write $\underline{G}^{ij}=[g^{ij}]_\times$. We are looking for scalars $\lambda_{ij}=\lambda_{ji}\neq 0$ such that $\lambda_{ij}\underline{G}^{ij}$ satisfy the cycle conditions. Now if the cycle conditions hold for this scaling, then $\lambda_{kl}g^{kl}=-\lambda_{jk}g^{jk}-\lambda_{ij}g^{ij}-\lambda_{li}g^{li}$. It follows that 
\begin{align}
\begin{aligned}
    &\det [\lambda_{ij}g^{ij}\;\lambda_{jk}g^{jk}\;\lambda_{kl}g^{kl}]\\
    =&\det [\lambda_{ij}g^{ij}\;\lambda_{jk}g^{jk}\;-\lambda_{li}g^{li}]\\
    =&-\det[\lambda_{li}g^{li}\;\lambda_{ij}g^{ij}\;\lambda_{jk}g^{jk}],\label{eq: det3x3}
\end{aligned}
\end{align}
for all $i,j,k,l\in \{1,2,3,4\}$. Factoring out the constants, and with $\underline{h}_j^i$ defined as in \Cref{eq: Gepip}, we get
\begin{align}
    \lambda_{ij}\lambda_{jk}\lambda_{ki}(\underline{h}_j^i)^T\underline{G}^{jk}\underline{h}_k^l=-\lambda_{li}\lambda_{ij}\lambda_{jk}(\underline{h}_i^l)^T\underline{G}^{ij}\underline{h}_j^k.
\end{align}
Assume that all epipolar numbers $ (\underline{h}_j^i)^T\underline{G}^{jk}\underline{h}_k^l$ are non-zero, and recalling that all $\lambda_{ij}$ are non-zero, we find that 
\begin{align}\label{eq: epip ratio}
\frac{(\underline{h}_j^i)^T\underline{G}^{jk}\underline{h}_k^l}{(\underline{h}_i^l)^T\underline{G}^{ij}\underline{h}_j^k}=-\frac{\lambda_{li}}{\lambda_{ki}}.
\end{align}
At the same using $\lambda_{ij}=\lambda_{ji}$,
\begin{align}\label{eq: lam prod}
\frac{\lambda_{31}}{\lambda_{21}}\frac{\lambda_{12}}{\lambda_{32}}\frac{\lambda_{23}}{\lambda_{43}}\frac{\lambda_{34}}{\lambda_{24}}\frac{\lambda_{24}}{\lambda_{14}}\frac{\lambda_{41}}{\lambda_{31}}=1.
\end{align}
Combining \Cref{eq: epip ratio,eq: lam prod}, we get a equation in the fundamental matrices $\underline{G}^{ij}$ and their epipoles $\underline{h}_j^i$ that is invariant of scaling in each fundamental matrix and epipole. By the invariance under fundamental action, we can rewrite this as the following equation that must hold for all compatible fundamental matrices of $K_4$ in terms of the epipolar numbers,
\begin{align}
\textbf{e}_{4123}\textbf{e}_{2134}\textbf{e}_{3142}\textbf{e}_{4231}\textbf{e}_{1243}\textbf{e}_{2341}
=\textbf{e}_{3124}\textbf{e}_{4132}\textbf{e}_{2143}\textbf{e}_{1234}\textbf{e}_{3241}\textbf{e}_{1342}.
\end{align}
We prove that in the generic case, this condition together with the triple-wise conditions are enough for compatibility in \Cref{thm: 4tuple-condition}. 



%------------------------------------------------------------------------
\section{Compatibility for Complete Graphs}\label{s: Kn} We now consider the complete graphs, that is, the case where all the fundamental matrices are known. Let $K_n$ denote the complete graph on $n$ nodes. The compatibility of $n\choose 2$ fundamental matrices $F^{ij}$ is studied in \cite{kasten2019gpsfm}, where the main result uses the \emph{$n$-view fundamental matrix}. Given a set of $n\choose2$ fundamental matrices $F^{ij}$, the $n$-view fundamental matrices is the $3n\times 3n$ symmetric matrix
\begin{align}
    \textbf{F}:=\begin{bmatrix} 0 & F^{12} & \cdots & F^{1n}\\
    F^{21} & 0 & \cdots & F^{2n}\\
    \vdots & \vdots & \ddots & \vdots\\
    F^{n1} & F^{n2} & \cdots & 0\\
    \end{bmatrix}.
\end{align}
\begin{remark}
In this section, we work only with real numbers because it allows us give polynomials equations using the standard inner product and norm on $\RR^3$. However, all of our statements in \Cref{ss: K3} and \Cref{ss: K4} can be extended to the complex numbers as explained in the appendix.  %using proofs analogous to those in the Supplementary Material. 
\end{remark}

\begin{theorem}[Theorem 1 of \cite{kasten2019gpsfm}, Theorem 2 of \cite{geifman2020averaging}]\label{thm: KGGB} Given a complete graph on $n\ge 3$ vertices $\mathcal{G}=K_n$, a set of real fundamental matrices $F^{ij}$ is compatible with a solution of real cameras whose centers are not all collinear if and only if there exists non-zero scalars $\lambda_{ij}$ for $1\le i,j\le n$ such that $\lambda_{ij}=\lambda_{ji}$ and
\begin{enumerate}
    \item the $n$-view fundamental matrix \textnormal{$\textbf{F}$} of $\lambda_{ij}F^{ij}$ is rank 6 and has exactly three positive and three negative eigenvalues;
    \item the $3\times 3n$ and $3n\times 3$ block rows and block columns of \textnormal{$\textbf{F}$} are all of rank 3.
\end{enumerate}

Further, the set of $F^{ij}$ is compatible with a solution of real cameras whose centers are all collinear if and only if there exists
there exists non-zero scalars $\lambda_{ij}$ for $1\le i,j\le n$ such that $\lambda_{ij}=\lambda_{ji}$ and
\begin{enumerate}
    \item the $n$-view fundamental matrix \textnormal{$\textbf{F}$} of $\lambda_{ij}F^{ij}$ is rank 4 and has exactly two positive and two negative eigenvalues;
    \item the $3\times 3n$ and $3n\times 3$ block rows and block columns of \textnormal{$\textbf{F}$} are all of rank 2.
\end{enumerate}
\end{theorem}

The scalars $\lambda_{ij}$ are determined in \cite{kasten2019gpsfm,geifman2020averaging} as a consequence of defining cameras on the form $P_i=K_iR_i^T[I|-t^{(i)}]$, for rotation matrices $R_i$, calibration matrices $K_i$ and vectors $t^{(i)}$ as done in \cite[Chapter 6]{Hartley2004}. The fundamental matrices then equal $F^{ij}=V_i(T_i-T_j)V_j^T$ for invertible matrices $V_i=K_i^{-T}R_i$, and $T_i=[t^{(i)}]_\times$.

The first result of this section show that the eigenvalue condition of this theorem can be dropped completely. 

\begin{theorem}\label{thm: redundant} In \Cref{thm: KGGB}, the eigenvalue conditions are implied by the other conditions, and can therefore be dropped from the necessary and sufficient conditions for compatibility. %conditions on the eigenvalues are satisfied if the conditions on the rank are satisfied. As such, the conditions on the eigenvalues can be dropped.
\end{theorem}

The rest of this section aims to express the rank conditions in terms of concrete homogeneous algebraic equations. We begin by showing that in order to study the compatibility conditions of $K_n$, it suffices to look at the compatibility of $K_4$:

\begin{theorem}
\label{thm:compatible_if_each_sextuple_is_compatible}
Let $\Set{F^{ij}}$ be a complete set of $n\choose2$, $n\ge 4$, fundamental matrices. If for each set of four distinct indices $i,j,k,l$, the sextuple $\{F^{ij},F^{ik},F^{jk},F^{il},F^{jl},F^{kl}\}$ is compatible, then $\Set{F^{ij}}$ is compatible.

Moreover, if all epipoles in each image coincide, then triple-wise compatibility implies that $\Set{F^{ij}}$ is compatible. The reconstruction in this case will be a set of cameras whose centers all lie on a line.
\end{theorem}

Note that the first part of this theorem is a less general version of \cite[Theorem 2]{kasten2019gpsfm}. We also make the following observation.

\begin{proposition}
\label{prop:unique_solution}
    A compatible set of $n\choose2$ fundamental matrices has a unique solution up 
 to action by $\mathrm{PGL}_4$ unless all the epipoles in each image are equal.
\end{proposition}

%% ------------------------------

\subsection{$K_3$} \label{ss: K3}
The case of three fundamental forms is fairly straightforward. We have two possible configurations for the three cameras; they either all lie on a line, or they do not.% The compatibility conditions in the latter case are given in \cite{Hartley2004}:
\begin{theorem}[{\hspace{1sp}\cite[Section 15.4]{Hartley2004}}]
\label{thm:compatible_forms}
Let $F^{12}$, $F^{13}$, $F^{23}$ be fundamental matrices. There exist non-collinear cameras $P_1,P_2,P_3$ such that $F^{ij}=\psi(P_i,P_j)$ if and only if,
\begin{align}
\label{eq_compatible}
(e_{1}^{3})^{T}F^{12}e_{2}^{3}=(e_{1}^{2})^{T}F^{13}e_{3}^{2}=(e_{2}^{1})^{T}F^{23}e_{3}^{1}=0,
\end{align}
and
\begin{align}
\label{eq_non_collinear}
e_{1}^{2}\neq e_{1}^{3}, \quad e_{2}^{1}\neq e_{2}^{3}, \quad e_{3}^{1}\neq e_{3}^{2},
\end{align}
\end{theorem}

If $P_1,P_2,P_3$ are cameras with collinear centers, then it follows that $P_i(\ker P_j)=P_i(\ker P_k)$ for all distinct $i,j,k$. This implies that for the corresponding fundamental matrices $F^{12},F^{13},F^{23}$, we have $e_j^i=e_j^k$ for all distinct $i,j,k$. The following example shows that the conditions in \Cref{eq_compatible} are not enough in the collinear case.

\begin{example}
\textnormal{Consider the fundamental matrices:}
\begin{align}
    F^{12}=\begin{bmatrix} 0&0&0\\0&1&0\\0&0&1 \end{bmatrix},  \quad F^{13}=\begin{bmatrix} 0&0&0\\0&0&1\\0&1&0 \end{bmatrix}, \quad      F^{23}=\begin{bmatrix} 0&0&0\\0&1&1\\0&-1&1 \end{bmatrix},  
\end{align}
\textnormal{with epipoles:}
\begin{align}
\begin{aligned}
    &e_1^2=[1,0,0], & &e_2^1=[1,0,0],  & &e_3^1=[1,0,0],  \\
    &e_1^3=[1,0,0], & &e_2^3=[1,0,0],  & &e_3^2=[1,0,0].  
\end{aligned}
\end{align}
 \textnormal{These six matrices satisfy the conditions in \Cref{eq_compatible}. However, no solution of cameras $P_1,P_2,P_3$ exist, for which $F^{12},F^{13},F^{23}$ are the fundamental matrices. This can be checked for instance via the algorithm described at the end of \Cref{s: Pre}.}
\hfill$\diamond$
\end{example}



\begin{proposition}\label{prop: K3 colin} Let $F^{12}$, $F^{13}$, $F^{23}$ be fundamental matrices. There exist collinear cameras $P_1,P_2,P_3$ such that $F^{ij}=\psi(P_i,P_j)$ if and only if,
\begin{align}
\label{eq_non_collinear}
e_{1}^{2}= e_{1}^{3}, \quad e_{2}^{1}= e_{2}^{3}, \quad e_{3}^{1}= e_{3}^{2},
\end{align}  
and 
\begin{align}
    F^{21}[e_1^2]_\times F^{13}=F^{23}.
\end{align}
\end{proposition}

%In \cite{HK} Theorem 2.2, it is mistakenly stated that for the collinear case, a triple is compatible if and only if it satisfies
%\begin{align}
%\label{eq_collinear}
%e_{1}^{2}= e_{1}^{3}, \quad e_{2}^{1}= e_{2}^{3}, \quad e_{3}^{1}= e_{3}^{2}.
%\end{align}
%While this condition is necessary, it is not sufficient, as an additional constraint is needed:
%\MB{Add theorem stating result}

\subsection{$K_4$}\label{ss: K4}

We start this section with a counterexample to the previous belief that triple-wise compatibility is enough to ensure full compatibility.
\begin{example}
\textnormal{Consider the fundamental matrices:}
\begin{align}
\begin{aligned}
    &F^{12}=\begin{bmatrix} 0&0&0\\0&0&1\\0&1&0 \end{bmatrix}, & &F^{13}=\begin{bmatrix} 0&0&1\\0&0&0\\0&1&0 \end{bmatrix}, &     &F^{14}=\begin{bmatrix} 0&0&1\\0&1&0\\0&0&0 \end{bmatrix}, \\ &F^{23}=\begin{bmatrix} 0&0&1\\0&0&0\\1&0&0 \end{bmatrix}, &     &F^{24}=\begin{bmatrix} 0&0&1\\1&0&0\\0&0&0 \end{bmatrix}, &      &F^{34}=\begin{bmatrix} 0&1&0\\2&0&0\\0&0&0 \end{bmatrix},  
\end{aligned}
\end{align}
\textnormal{with epipoles:}
\begin{align}
\begin{aligned}
    &e_1^2=[1,0,0], & &e_2^1=[1,0,0],  & &e_3^1=[1,0,0],  & &e_4^1=[1,0,0],\\
    &e_1^3=[0,1,0], & &e_2^3=[0,1,0],  & &e_3^2=[0,1,0],  & &e_4^2=[0,1,0],\\
    &e_1^4=[0,0,1], & &e_2^4=[0,0,1],  & &e_3^4=[0,0,1],  & &e_4^3=[0,0,1].
\end{aligned}
\end{align}
 \textnormal{These six matrices satisfy the $3{4\choose 3}=12$ triple-wise conditions from \Cref{thm:compatible_forms}. Nonetheless, no solution exists. Any attempt to find four cameras will end up matching at most five of the six fundamental matrices. We will soon see that this is because the sextuple does not satisfy the conditions in \Cref{thm: 4tuple-condition}.}
\hfill$\diamond$
\end{example}

Before we get to the main results, we list the possible configurations of camera centers in the case of four cameras (six fundamental matrices). By \Cref{prop:equivalence}, these correspond to the equivalence classes of compatible fundamental matrices. Each of these is recognizable from the epipoles $e_i^j$.

\begin{enumerate}[leftmargin =3.5em]
    \item [Case 1:] The cameras are in generic position, meaning no plane contains all four centers. In each image, the three epipoles are in generic position, meaning they do not lie on a line.
    \item [Case 2:] All camera centers lie in the same plane, but no three lie on a line. In each image, the three epipoles are distinct and lie on a line.
    \item [Case 3:] Precisely three camera centers lie on a line. In the three corresponding images, the epipoles corresponding to the other two cameras among this triplet are equal, with the last one different from these two. In the final image, the three epipoles are distinct and lie on a line. %exactly two epipoles coincide. In the final image the three epipoles are distinct and lie on a line.
    \item [Case 4:] All four camera centers lie on a line. In each image, the three epipoles coincide.
\end{enumerate}



Any compatible sextuple $\Set{F^{ij}}$ must have its epipoles in one of the configurations above. If we have, for instance,  collinear epipoles in two images, and not in the other two, the fundamental matrices can not be compatible. In all four cases above, the configuration of the epipoles together with the triple-wise conditions alone is not enough to ensure compatibility; we need additional constraints. Case 4 is already covered by the second half of \Cref{thm:compatible_if_each_sextuple_is_compatible,prop: K3 colin}. We cover the remaining three cases in this section one by one. Recall the definition of the epipolar number: $\textbf{e}_{sijt}=(e_i^s)^TF^{ij}e_j^t$.

\begin{theorem}[Case 1] 
\label{thm: 4tuple-condition} Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices such that the three epipoles in each image do not lie on a line. % satisfying the triple-wise conditions. Assume further that the three epipoles in each image do not lie on a line. 
Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold and
\begin{align}
\begin{aligned} \label{eq: 4-tuple}
\textnormal{\textbf{e}}_{4123}\textnormal{\textbf{e}}_{2134}\textnormal{\textbf{e}}_{3142}\textnormal{\textbf{e}}_{4231}\textnormal{\textbf{e}}_{1243}\textnormal{\textbf{e}}_{2341}=\textnormal{\textbf{e}}_{3124}\textnormal{\textbf{e}}_{4132}\textnormal{\textbf{e}}_{2143}\textnormal{\textbf{e}}_{1234}\textnormal{\textbf{e}}_{3241}\textnormal{\textbf{e}}_{1342}.
\end{aligned}
\end{align}
%\begin{align}
%\begin{aligned}
%&e_1^4F^{12}e_2^3e_1^2F^{13}e_3^4e_1^3F^{14}e_4^2e_2^4F^{23}e_3^1e_2^1F^{24}e_4^3e_3^2F^{34}e_4^1\\
%=&e_1^3F^{12}e_2^4e_1^4F^{13}e_3^2e_1^2F^{14}e_4^3e_2^1F^{23}e_3^4e_2^3F^{24}e_4^1e_3^1F^{34}e_4^2 
%\end{aligned}
%\end{align}
\end{theorem}
%\MB{Which representation is best?}
\begin{remark}  The condition that the epipoles in each image do not lie on a line is equivalent to all epipolar number $\textnormal{\textbf{e}}_{ijkl}$ being non-zero for distinct $i,j,k,l$. \Cref{eq: 4-tuple} is homogeneous in every fundamental matrix and every epipole.
\end{remark}

In the next two cases, the three epipoles in each image lie on a line, this is equivalent to all epipolar numbers $\textnormal{\textbf{e}}_{ijkl}$ being zero for distinct $i,j,k,l$. 


%We let $\textbf{x}_i$ denote any point in the $i$-th image not lying on the line spanned by the epipoles. Giving conditions on such a loosely defined variable might seem strange, but the proof makes it clear that if one choice of $\textbf{x}_i$ satisfies the conditions, so does any other choice.

\begin{theorem}[Case 2]\label{thm: Case 2} Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices whose epipoles in each image are distinct and lie on a line. Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold,
%Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices satisfying the triple-wise conditions, and let $e_i^j$ denote their epipoles. Assume further that the three epipoles in each image lie on a line but do not coincide. The sextuple is compatible if and only if
\begin{align}%\label{eq: ijk F main}
    \langle F^{jk}e_k^i,F^{jl}e_l^i \rangle \langle F^{kj}e_j^i,F^{kl}e_l^i \rangle\langle F^{lj}e_j^i,F^{lk}e_k^i \rangle 
   +\|F^{lj}e_j^i\|^2\|F^{jk}e_k^i\|^2\|F^{kl}e_l^i\|^2 =0 ,
\end{align}
for all distinct $i,j,k,l$ satisfying $l>k>j$, and for 
\begin{align}
    \textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{21}e_1^4,\quad \textbf{x}_3=F^{31}e_1^4,\quad \textbf{x}_4=F^{41}e_1^3,
\end{align}
we have%, and for $\textbf{x}_i=F^{ij}e_j^l$ with $l>k>j$ we have
\begin{align}
\begin{aligned}\label{eq:long_equation main}
    \frac{e_3^2F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}\frac{\textbf{x}_1F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^2}-\frac{e_2^3F^{24}\textbf{x}_4}{\textbf{x}_2F^{24}e_4^1}\frac{\textbf{x}_1F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^3}-\frac{\textbf{x}_3F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}&\\ 
    +\frac{e_3^2F^{34}\textbf{x}_4}{e_1^2F^{14}\textbf{x}_4}\frac{e_1^2F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^2}\frac{\textbf{x}_1F^{14}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}+\frac{\textbf{x}_2F^{24}\textbf{x}_4}{\textbf{x}_2F^{24}e_4^1} +\frac{e_3^1F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}\frac{\textbf{x}_2F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^1}&=0.
\end{aligned}
\end{align}
\end{theorem}

\begin{remark}
As \Cref{eq:long_equation main} and \Cref{eq:less_long_equation main} below are already oversaturated with sub/superscript, we are omitting the transpose symbol from these equations. 
It is to be understood that the 3-vectors $\textbf{x}_i$ and $e_i^j$ are column-vectors when directly right of a fundamental matrix, and row-vectors when to the left.
\end{remark}

\begin{theorem}[Case 3]\label{thm: Case 3} Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices such that 
\begin{align}
        e_1^2=e_1^3\neq e_1^4, \quad e_2^1=e_2^3\neq e_2^4, \quad e_3^1=e_3^2\neq e_3^4, 
\end{align}
and $e_4^1,e_4^2,e_4^3$ are distinct and lie on a line. Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold,
%Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices satisfying the triple-wise conditions. Assume further that the epipoles satisfy\\
%$e_1^2=e_1^3\neq e_1^4$, $e_2^1=e_2^3\neq e_2^4$, $e_3^1=e_3^2\neq e_3^4$, and $e_4^1,e_4^2,e_4^3$ collinear. Then the sextuple is compatible if and only if
\begin{align}
\begin{aligned}
    \langle F^{12}e_2^4,F^{13}e_3^4 \rangle\langle F^{21}e_1^4,F^{23}e_3^4 \rangle \langle F^{31}e_1^4,F^{32}e_2^4 \rangle
    +\|F^{12}e_2^4\|^2\|F^{23}e_3^4\|^2\|F^{31}e_1^4\|^2 =0,
\end{aligned}
\end{align}
and for %$\textbf{x}_i=F^{ij}e_j^l$ with $l>k>j$,
%Put $x_1=F^{12}e_2^4, x_2 =F^{23}e_3^4, x_3=F^{31}e_1^4$.
\begin{align}
\textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{23}e_3^4,\quad \textbf{x}_3=F^{31}e_1^4,
\end{align}
we have
%and for $\textbf{x}_i=F^{ij}e_j^l$ with $l>k>j$,
%Put $x_1=F^{12}e_2^4, x_2 =F^{23}e_3^4, x_3=F^{31}e_1^4$.
\begin{align}
\label{eq:less_long_equation main}
    \frac{e_2^4F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}\frac{\textbf{x}_1F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^4}+\frac{\textbf{x}_1F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^4}-\frac{\textbf{x}_2F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}=0.
\end{align}
\end{theorem}



%% -----------------------------------------

\section{Image of the fundamental map}\label{s: Image} Related to the study of the constraints satisfied by compatible fundamental matrices, is the image of the \emph{fundamental map} given a viewing graph $\mathcal{G}=(V,E)$:
\begin{align}
\begin{aligned}
    \Psi_{\mathcal{G}}:(\PP^{3\times 4})^m&\dashrightarrow (\PP^{3\times 3})^{E},\\
    (P_1,\ldots,P_m)&\mapsto (\psi(P_i,P_j))_{(ij)\in E}.
\end{aligned}
\end{align}
The fundamental map sends projective camera matrices to a set of corresponding fundamental matrices. We define the \emph{viewing graph variety} $\mathcal{V}_\mathcal{G}$ to be the \emph{Zariski closure} of the image $\mathrm{Im}\Psi_\mathcal{G}$, meaning the smallest solution set to a polynomial system that contains the image. By Chevalley's theorem, in this case, the Zariski closure is equal to the Euclidean closure \cite[Theorem 4.19]{michalek2021invitation}. 

A natural question from the algebraic geometry point of view, is if this variety in the complete graph case is described by the constraints we proposed in \Cref{s: Kn}. We prove that that is not the case, and leave it is as an open problem to describe the viewing graph variety precisely.

\begin{proposition} 
\label{prop: image}
The viewing graph variety of $K_n$ for $n\ge 3$ is a proper subset of the variety in $(\PP^{3\times 3})^{n\choose 2}$ defined by the $3{n\choose 3}$ triple-wise constraints and the ${n\choose 4}$ quadruple-wise constraints of \Cref{thm: 4tuple-condition}.
\end{proposition}

%------------------------------------------------------------------------




%\nocite{BARTOLI01}
\nocite{Sola2012}
%\nocite{Vieville96}
{\small
\bibliographystyle{ieee_fullname}
\bibliography{VisionBib}
}


\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% Appendix %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

\section*{Appendix} In this appendix we prove all the mathematical results that were left unproven in the main body of the paper. For the convenience of the
reader, we explain some concepts from applied algebraic geometry that are helpful to understand the appendix in \Cref{s: Prelim App}. Results that appear in the main body
of the paper are restated and given the same number. Additional results not stated in the main body, are numbered independently.

In \Cref{s: Fund App} we prove the statements of \Cref{s: Action}. In \Cref{s: Can App} we prove the cycle theorem as stated in \Cref{s: Can App}. We prove all results on compatibility for complete graphs from \Cref{s: Kn} in \Cref{s: Kn App}. Finally, in \Cref{s: Image App} we prove the statement about the viewing graph variety in \Cref{s: Image}.

%-------------------------------------------------------------------------
%------------------------------------------------------------------------
\section{Algebraic Geometry Preliminaries} \label{s: Prelim App} In the main body of the text, we used the term \textit{rational map}. To define this we first define what an \textit{variety} is. Given a field $k$ such as $\RR$, a variety is the solution set to a system of polynomial equations. A variety $\mathcal V$ is called \textit{irreducible} if it cannot be written as a union of two proper varieties, meaning that for two subvarieties $X,Y$ of $\mathcal{V}$, the equality $\mathcal V= X\cup Y$ implies $\mathcal V=X$ or $\mathcal V=Y$. %Over $k=\QQ,\RR,\CC$, there is a unique decomposition of any variety into a union of finitely many irreducible varieties. %by the Lasker-Noether theorem. 
A rational map $f$ between projective varieties $X$ and $Y$, with $X$ irreducible, is written
\begin{align}
    f: X\dashrightarrow Y.
\end{align}
This map is defined on a \textit{Zariski open} set of $X$, which is a set that can be written $X\setminus Y$ for a proper subvariety $Y\subseteq X$. 




For the proofs in \Cref{s: Kn App}, it is helpful to understand saturation, elimination, and implicitization of \textit{ideals}. We refer the reader to \cite{cox1994ideals} for a detailed study of these topics.  Consider a field $k$ and its polynomial ring $k[x]=k[x_1,\ldots,x_m]$, which is simply the set of all polynomials with coefficients in $k$. That $k[x]$ is a \textit{ring} means that addition and multiplication of polynomials satisfy a certain set of axioms that we don't list here. An \textit{ideal} $I$ of a ring $R$ is an additive subgroup that is closed under multiplication of elements in $R$. 

Let $f_1,\ldots,f_s\in k[x]$ be polynomials. They generate an ideal of $k[x]$ as follows:
\begin{align}
    \langle f_1,\ldots,f_s\rangle:=\big\{\sum g_if_i: g_i\in k[x]\big\}\subseteq k[x].
\end{align}
From the geometric point of view, an ideal in a polynomial ring defines a \textit{variety} $\mathcal V$ as the zero set of all polynomials in the ideal. In other words,
\begin{align}
    \mathcal V(I):=\big\{ x\in k^m: f(x)=0,\;\forall f\in I\big\}.
\end{align}
 The goal of saturation is to remove unwanted components from a variety. Let $I,J$ be ideals. The saturation of $I$ with respect to $J$ is
\begin{align}
    I:J^\infty:=\big\{f\in k[x]: \forall g\in J,\; \exists N\in \NN: fg^N\in I\big\}.
\end{align}

\begin{theorem}[{\hspace{1sp}\cite[p. 203]{cox1994ideals}}] Let $\mathcal{V}(J),\mathcal{V}(I)$ be two algebraic sets defined by ideals. Then
\begin{align}
    \overline{\mathcal{V}(I)\setminus \mathcal{V}(J)}\subseteq \mathcal{V}(I:J^\infty).
\end{align}
\end{theorem}

The \textit{elimination} of variables $x_1,\ldots,x_l$ from an ideal $I\subseteq k[x]$ is the intersection
\begin{align}
    I\cap k[x_{l+1},\ldots,x_m].
\end{align}
Given $(x_1,\ldots,x_n)\in \mathcal{V}(I)$, we have that $(x_{l+1},\ldots,x_n)\in \mathcal{V}(I\cap k[x_{l+1},\ldots,x_m])$. This is simply because any $f\in I\cap k[x_{l+1},\ldots,x_m]$ also lies in $I$ by construction. In this way, elimination of variables gives us conditions on the projection of $\mathcal{V}(I)$ away from the first $l$ coordinates.


\textit{Implicitization} refers to the following setup. Consider a polynomial system
\begin{align}\label{eq: syst}
\begin{aligned}
    x_1=&f_1(t_1,\ldots,t_m),\\
    &\vdots\\
    x_n=&f_n(t_1,\ldots,t_m),
\end{aligned}
\end{align}
and write $F:k^m\to k^n$ for the function corresponding to these polynomials. We wish to describe the image of $F$ in terms of conditions on $x_1,\ldots,x_n$. 
\begin{theorem}[{\hspace{1sp}\cite[p. 134]{cox1994ideals}}] For an infinite field, let $I=\langle x_1-f_1,\ldots,x_n-f_n\rangle\subseteq k[x,t]$ denote the system corresponding to \Cref{eq: syst}. The variety of $I\cap k[x]$ is the smallest variety containing the image of $F$.
\end{theorem}

\texttt{Macaulay2} \cite{M2} is a symbolic programming language which handles exact computations over $\QQ$. We use this program to symbolically saturate ideals and eliminate variables from ideals in the ring $\QQ[x]$.


%------------------------------------------------------------------------

\section{The Fundamental Action}\label{s: Fund App}


\begin{customproposition}{\ref{prop:equivalence}}
Let $\mathcal{G}$ be a viewing graph on $n$ nodes. Let $\Set{F^{ij}}$ and $\Set{G^{ij}}$ be two sets of compatible fundamental matrices. They are equivalent under fundamental action if and only if they have solutions whose camera centers are equivalent under $\mathrm{PGL}_4$.% with solutions $P_i$ and $Q_i$ respectively that belong to the same equivalence class if their solutions  with solution $P_i$ whose centers $c_1,\ldots,c_n$ are linearly independent are equivalent under fundamental action. 
\end{customproposition}


%\begin{proof} Let $P_i$ be a solution to $\Set{F^{ij}}$. Then by action of $H\in \mathrm{GL}_4$, we may assume that the $i$-th column of $P_i$ is zero. Let $A_i$ be the $3\times 3$ matrix we get by removing column $i$ from $P_i$. Then $A_i$ is invertible and $C_i=A_i^{-1}P_i$ is the $3\times 3$ identity matrix with a 0 column in position $i$. As a consequence, any compatible $\Set{F^{ij}}$ is up to fundamental action equal to the fundamental matrices defined by the fixed matrices $C_i$.  
%\end{proof}
%\MB{alternative proof:

For the proof we need the following lemma:
\begin{lemma} [{\hspace{1sp}\cite[Result 22.1]{Hartley2004}}]
\label{lem:cameras_sharing_center_are_equivalent}
Let $P$ and $P'$ be two camera matrices with the same center. Then there
exists $H\in\PGL_3$ such that $P' = HP$.
\end{lemma}

\begin{proof}[Proof of \Cref{prop:equivalence}] $ $

$\Rightarrow)$ Let $G^{ij}=H_i^TF^{ij}H_j$. If $P_1,\ldots,P_n$ is a solution to $\Set{F^{ij}}$, then by \Cref{prop:fundamental_action_preserves_compibility} $H_1^{-1}P_1,\ldots,H_n^{-1}P_n$ is a solution to $G^{ij}$, which have the same centers as $P_1,\ldots,P_n$. 

$\Leftarrow)$ Let $P_1,\ldots,P_n$ be a solution to $\Set{F^{ij}}$ with centers $c_i$ and $P_1',\ldots,P_n'$ a solution to $\Set{G^{ij}}$ with centers $c_i'$ such that $c_i'=H^{-1}c_i$ for some $H\in \mathrm{PGL}_4$. By \Cref{lem:cameras_sharing_center_are_equivalent}, there are $H_i\in \mathrm{PGL}_3$ such that $P_i'=H_iP_iH$, since $P_i'$ and $P_iH$ have the same kernel $H^{-1}c_i$.
%The fundamental action 
%\begin{align}
%    (H_1,\ldots,H_n,H)\in \mathrm{PGL}_3^n\times \mathrm{PGL}_4
%\end{align}
%acts on cameras $P_i$ by $H_i^{-1}P_iH$, and on fundamental matrices $F^{ij}$ by $(H_i)^TF^{ij}H_j$. Since the only thing acting on the camera centers is $H$, it is clear that if $\Set{F^{ij}}$ and $\Set{G^{ij}}$ are compatible, then their camera centers must be equivalent under $\PGL_4$. For the converse, assume their camera centers are equivalent under some $H'\in\PGL_4$. Since their camera centers are equal, \Cref{lem:cameras_sharing_center_are_equivalent} tells us that there are matrices $H_i'\in\PGL_3$ making them equal. Then the two configurations are equal under $ (H_1',\ldots,H_n',H')$.
\end{proof}


%------------------------------------------------------------------------

\section{Canonical Forms}\label{s: Can App} In order to prove the cycle theorem we need a lemma.

\begin{lemma}\label{le: graph} Let $\mathcal G$ be a connected graph and $T$ any spanning tree subgraph. Then there is a sequence $T^i\subseteq \mathcal G$ such that
\begin{align}
    T=T^0\subseteq \cdots \subseteq T^k=\mathcal G,
\end{align}
where $T^{i+1}$ contains exactly one more edge than $T^i$ and this edge is part of a cycle of $T^{i+1}$.
\end{lemma}

\begin{proof} We get $T^{k-1}$ from $T^k$ by removing an edge of $T^k$ that is not in $T$. We repeat this process until we reach $T^0$. If at any point the edge we remove is not part of a cycle, then this disconnects the graph by definition, implying that $T$ is not connected, which is a contradiction.
\end{proof}

Recall that in order to denote either fundamental matrices or epipoles as elements of affine space we use underline. For instance, if $F\in \PP^{3\times 3}$, then $\underline{F}\in \RR^{3\times 3}\setminus\{0\}$ is a representative of $F$ and vice versa. 


\begin{customtheorem}{\ref{thm:cycle}} Let $\Set{F^{ij}}$ be a set of fundamental matrices for a graph $\mathcal G$. Fix a representative $\underline{F}^{ij}$ for each fundamental matrix such that $\underline{F}^{ji}=(\underline{F}^{ij})^T$. $\Set{F^{ij}}$ is compatible if and only if there are matrices $\underline{H}_i\in \mathrm{GL}_{3}$ and scalars $\lambda_{ij}=\lambda_{ji}\neq 0$ such that $\underline{G}^{ij}:=\lambda_{ij}\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$ satisfy
\begin{align}
    \sum_{(ij)\in E(C)}\underline{G}^{ij}=0, \textnormal{ for each directed cycle }C \textnormal{ of } \mathcal G. %\tag{\ref{eq: cycleC}}
\end{align}
In particular, any set of $3\times 3$ rank-two matrices $\underline{G}^{ij}$ satisfying the cycle condition are the fundamental matrices of some set of cameras.
\end{customtheorem}

\begin{proof} $ $

%$\Rightarrow)$ If $F^{ij}$ are compatible, then there is a solution $P_i$ that up to the fundamental action of $(H_1,\ldots,H_m,H)\in \mathrm{GL}_{3}^m\times \mathrm{GL}_{4}$ equal $\underline{C}_i=[I|t^{(i)}]$ as in \Cref{ss: Can}. Then set $\underline{G}^{ij}=\psi(\underline{C}_i,\underline{C}_j)$, which equals $H_i^T\underline{F}^{ij}H_j$ by \Cref{prop:fundamental_action_preserves_compibility}. As noted in \Cref{ss: Can}, there is a representative $\underline{G}^{ij}=[t^{(j)}]_{\times }-[t^{(i)}]_\times$ and these matrices are skew-symmetric and satisfy the cycle condition since.  

$\Leftarrow)$ We find a set of cameras $\underline{C}_i$ such that $\psi(\underline{C}_i,\underline{C}_j)$ equals $\underline{G}^{ij}$. Since $F^{ij}$ and $G^{ij}$ are equivalent under fundamental action, this is enough. We may without restriction assume that $\mathcal G$ is connected with $n$ nodes. Since $\underline{G}^{ij}$ are skew-symmetric by the 2-cycles, there are non-zero $g^{ij}\in \RR^3$ such that $\underline{G}^{ij}=[g^{ij}]_\times$. The cycle condition is then equivalent to 
\begin{align}
    \sum_{(ij)\in E(C)}g^{ij}=0, \textnormal{ for each directed cycle }C \textnormal{ of } \mathcal G.
\end{align}
Let $T$ be a spanning tree subgraph of $\mathcal G$. 

Fix $i=1$ and let $t^{(1)}=0$. To any node $v$ in $T$ there is a unique simple path from $1$ to $v$ in $T$, since $T$ is a tree. Let $\sigma_{u,v}=\{u=i_1,i_2,\ldots,i_k=v\}$ denote the unique path between two vertices $u,v$ of $T$. For $i>1$, 
\begin{align}
  t^{(v)}:=\sum_{(ij)\in \sigma_{1,v} }g^{ij}.  
\end{align}
This defines cameras $\underline{C}_i=[I|t^{(i)}]$ for each $i=1,\ldots,n$. We must check that $\underline{G}^{ij}=\psi(\underline{C}_i,\underline{C}_j)$ for every edge of $\mathcal G$. If $(ij)$ is an edge of $T$, then $t^{(j)}-t^{(i)}=g^{ij}$ by construction. Consider the sequence $T^i$ of \Cref{le: graph}. We proceed via induction to show that $\underline{G}^{ij}=\psi(\underline{C}_i,\underline{C}_j)$ for every edge of $T^l$ for any $l$. The base case $T^0=T$ is already done. Assume that $\underline{C}_i$ satisfy $\underline{G}^{ij}=\psi(\underline{C}_i,\underline{C}_j)$ for all edges of $T^l$. In $T^{l+1}$ there is precisely one new edge $(ij)$ and that edge is part of a cycle $C$ of $T^{l+1}$. After some cancellation, we have for some vertex $u$ of the cycle that 
\begin{align}
  \psi(\underline{C}_i,\underline{C}_j)&=[t^{(j)}-t^{(i)}]_\times =\sum_{(st)\in \sigma_{u,j}} [g^{st}]_\times-\sum_{(st)\in \sigma_{u,i}} [g^{st}]_\times.  
\end{align}
By skew-symmetry of $\underline{G}^{ij}$ we have $g^{ji}=-g^{ij}$, and therefore we get 
\begin{align}
\psi(\underline{C}_i,\underline{C}_j)=\sum_{(st)\in \sigma_{i,j}} [g^{st}]_\times.  
\end{align}
However, by the cycle condition for the cycle $C$, this equals $[g^{ij}]_\times$ which is what we needed.
\end{proof}

%------------------------------------------------------------------------
\section{Complete Graphs}\label{s: Kn App}

We recall the following theorem from \cite{kasten2019gpsfm,geifman2020averaging}.

\begin{customtheorem}{\ref{thm: KGGB}}Given a complete graph on $n\ge 3$ vertices $\mathcal{G}=K_n$, a set of real fundamental matrices $F^{ij}$ is compatible with a solution of real cameras whose centers are not all collinear if and only if there exists non-zero scalars $\lambda_{ij}$ for $1\le i,j\le n$ such that $\lambda_{ij}=\lambda_{ji}$ and
\begin{enumerate}
    \item the $n$-view fundamental matrix \textnormal{$\textbf{F}$} of $\lambda_{ij}F^{ij}$ is rank 6 and has exactly three positive and three negative eigenvalues;
    \item the $3\times 3n$ and $3n\times 3$ block rows and block columns of \textnormal{$\textbf{F}$} are all of rank 3.
\end{enumerate}

Further, the set of $F^{ij}$ is compatible with a solution of real cameras whose centers are all collinear if and only if there exists
there exists non-zero scalars $\lambda_{ij}$ for $1\le i,j\le n$ such that $\lambda_{ij}=\lambda_{ji}$ and
\begin{enumerate}
    \item the $n$-view fundamental matrix \textnormal{$\textbf{F}$} of $\lambda_{ij}F^{ij}$ is rank 4 and has exactly two positive and two negative eigenvalues;
    \item the $3\times 3n$ and $3n\times 3$ block rows and block columns of \textnormal{$\textbf{F}$} are all of rank 2.
\end{enumerate}
\end{customtheorem}


\begin{customtheorem}{\ref{thm: redundant}} In \Cref{thm: KGGB}, the eigenvalue conditions are implied by the other conditions, and can therefore be dropped from the necessary and sufficient conditions for compatibility. 
\end{customtheorem}

We prove this theorem at the end of this section.


\begin{customtheorem}{\ref{thm:compatible_if_each_sextuple_is_compatible}}
Let $\Set{F^{ij}}$ be a complete set of $n\choose2$, $n\ge 4$, fundamental matrices. If for each set of four distinct indices $i,j,k,l$, the sextuple $\{F^{ij},F^{ik},F^{jk},F^{il},F^{jl},F^{kl}\}$ is compatible, then $\Set{F^{ij}}$ is compatible.


Moreover, if all epipoles in each image coincide, then triple-wise compatibility implies that $\Set{F^{ij}}$ is compatible. The reconstruction in this case will be a set of cameras whose centers all lie on a line.
\end{customtheorem}

 We prove this theorem after \Cref{prop: K3 colin}.

\begin{customproposition}{\ref{prop:unique_solution}}
    A compatible set of $n\choose2$ fundamental matrices has a unique solution up 
 to action by $\mathrm{PGL}_4$ unless all the epipoles in each image are equal.
\end{customproposition}

 

\begin{proof} Assume that all epipoles in each image are not equal. Since the set of fundamental matrices is compatible%, and the epipoles in each image are not all equal
, we know that there exists a reconstruction consisting of $n$ cameras, not all lying on a line. In particular, there are at least two cameras $P_1,P_2$ such that the line spanned by their camera center does not contain any other camera centers. 
By \Cref{lem:triple_has_unique_solution}, a triple of compatible fundamental matrices has a unique solution up to action by $\mathrm{PGL}_4$ if the two epipoles in each image are distinct, or equivalently: If their reconstruction consists of three non-collinear cameras. So we can uniquely recover $P_1,P_2$ from $F^{12}$. Then each other cameras $P_i$ is uniquely determined by the triplet $F^{12},F^{1i},F^{2i}$. Since this uniquely determines all cameras, the fundamental matrices $F^{ij}$ can only have one solution.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{$K_3$}


\begin{customproposition}{\ref{prop: K3 colin}} Let $F^{12}$, $F^{13}$, $F^{23}$ be fundamental matrices. There exist collinear cameras $P_1,P_2,P_3$ such that $F^{ij}=\psi(P_i,P_j)$ if and only if,
\begin{align}
\label{eq_collinear}
e_{1}^{2}= e_{1}^{3}, \quad e_{2}^{1}= e_{2}^{3}, \quad e_{3}^{1}= e_{3}^{2},
\end{align}  
and 
\begin{align}
    F^{21}[e_1^2]_\times F^{13}=F^{23}.
\end{align}
\end{customproposition}

\begin{remark} When we in the proofs below write ``it can be verified that'' or ``it can be checked that'' in relation to the shape of fundamental matrices, we have checked this fact in \texttt{Macaulay2}.
\end{remark}

\begin{proof} Recall that the epipole $e_i^j$ equals $P_i(\ker(P_j))$. It follows that if a solution to $F^{12},F^{13},F^{23}$ consists of collinear cameras, then \Cref{eq_collinear} must be satisfied. Conversely, if \Cref{eq_collinear} is satisfied, any solution must consist of collinear camera centers.

We begin by simplifying the problem using the fundamental action. Let
\begin{align}
    \underline{H}_i=\begin{bmatrix}
    \underline{e}_i^j\,\, \textbf{x}_i\,\, \textbf{y}_i
    \end{bmatrix},
\end{align} for any $j\neq i$ and $\textbf{x}_i,\textbf{y}_i\in \RR^3$ such that the determinant is non-zero, meaning $H_i$ are invertible. We get a new triple of fundamental matrices
\begin{align}
\underline{G}^{ij}=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j.
\end{align}
Since the fundamental action preserves compatibility, the sextuple $\Set{G^{ij}}$ is compatible if and only if $\Set{F^{ij}}$ is. They are of the following form
\begin{align} \label{eq: Gform}
\begin{aligned}
    &\underline{G}^{12}=\begin{bmatrix} 0&0&0\\0&a_{12}&b_{12}\\0&c_{12}&d_{12} \end{bmatrix}, & &\underline{G}^{13}=\begin{bmatrix} 0&0&0\\0&a_{13}&b_{13}\\0&c_{13}&d_{13} \end{bmatrix}, & &\underline{G}^{23}=\begin{bmatrix} 0&0&0\\0&a_{23}&b_{23}\\0&c_{23}&d_{23}  \end{bmatrix},  
\end{aligned}
\end{align}
for some $a_{ij},b_{ij},c_{ij},d_{ij}\in \RR$ making the matrices of \Cref{eq: Gform} rank-two. Their epipoles are:
\begin{align}
\begin{aligned}
    &\underline{h}_1^2=[1,0,0], & &\underline{h}_2^1=[1,0,0],  & &\underline{h}_3^1=[1,0,0], \\
    &\underline{h}_1^3=[1,0,0], & &\underline{h}_2^3=[1,0,0], & &\underline{h}_3^2=[1,0,0]. 
\end{aligned}
\end{align}

We next find conditions on triplets of cameras $P_1,P_2,P_3$ with collinear centers whose fundamental matrices are on the form $G^{12},G^{13},G^{23}$. We may up to $\mathrm{PGL}_4$ action assume that the center of $P_1$ is $[1,0,0,0]$, the center of $P_2$ is $[0,1,0,0]$ and the center of $P_3$ is $[1,1,0,0]$. Fix $P_1$ to be:
\begin{align}\label{eq: P1 c4}
        P_1&=\begin{bmatrix}
        0&1&0&0\\
        0&0&1&0\\
        0&0&0&1
    \end{bmatrix}.
\end{align}
Using the fact that $e_i^j=P_i(\ker P_j)$, we find that $P_2$ and $P_3$ must be on the form below:%  such that $G^{12}$ is the fundamental matrix of $P_1$ and $P_2$ is of the form below, respectively for $P_3$.
\begin{align}
    P_2=\begin{bmatrix} 
        1&0&*&*\\
        0&0&*&*\\
        0&0&*& *    \end{bmatrix},\quad
     P_3=\begin{bmatrix}
        1&-1&*&*\\
        0&0&*&*\\
        0&0&*&*
    \end{bmatrix}.
    \end{align}
One can check that the two right-most elements of the first row of $P_2$ and $P_3$ do not affect the fundamental matrices. In particular, one solution must be 
\begin{align}\label{eq: P2P3 c4}
    P_2=\begin{bmatrix} 
        1&0&0&0\\
        0&0&\alpha_1&\alpha_2\\
        0&0&\alpha_3&\alpha_4    \end{bmatrix},\quad
     P_3&=\begin{bmatrix}
        1&-1&0&0\\
        0&0&\beta_1&\beta_2\\
        0&0&\beta_3&\beta_4
    \end{bmatrix},
    \end{align}
for $\alpha_i$ and $\beta_i$ such that $\alpha_1\alpha_4-\alpha_2\alpha_3\neq 0$ and $\beta_1\beta_4-\beta_2\beta_3\neq 0$. Given such cameras, the fundamental matrices are calculated as  
\begin{align}
\begin{aligned}
    \psi(P_1,P_2)&=\begin{bmatrix} 
        0&0&0\\
        0&-\alpha_3&\alpha_1\\
        0&-\alpha_4&\alpha_2    \end{bmatrix},\quad
     \psi(P_1,P_3)=\begin{bmatrix}
        0&0&0\\
        0&-\beta_3&\beta_1\\
        0&-\beta_4&\beta_2
    \end{bmatrix},\\     \psi(P_2,P_3)&=\begin{bmatrix} 
        0&0&0\\
        0&-\alpha_4\beta_2+\alpha_2\beta_4&\alpha_4\beta_1-\alpha_2\beta_3\\
        0&\alpha_3\beta_2-\alpha_1\beta_4&-\alpha_3\beta_1+\alpha_1\beta_3    \end{bmatrix}.
\end{aligned}
    \end{align}
This tells us that in the collinear setting, $F^{12}$ and $F^{13}$ uniquely determine $F^{23}$. In particular, $G^{12}$ and $G^{13}$ from \Cref{eq: Gform} determine the elements of $G^{23}$ as described below.    

Define the $\star$ operator on $2\times 2$ matrices as
\begin{align}
\begin{aligned}
    \begin{bmatrix}
        x_1 & x_3 \\ x_2 & x_4
    \end{bmatrix}\star\begin{bmatrix}
        y_1 & y_3 \\ y_2 & y_4
    \end{bmatrix}:=\begin{bmatrix}
        x_1y_2-x_2y_1 & x_1y_4 -x_2y_3\\ x_3y_2-x_4y_1 & x_3y_4 -x_4y_3
    \end{bmatrix}=\begin{bmatrix}
        x_1 & x_2 \\ x_3 & x_4
    \end{bmatrix}\begin{bmatrix}
        y_2 & y_4 \\ -y_1 & -y_3
    \end{bmatrix}.
\end{aligned}
\end{align}
Then up to scaling,
\begin{align}
\begin{aligned}
    \begin{bmatrix}
        a_{12} & b_{12} \\ c_{12} & d_{12}
    \end{bmatrix}\star\begin{bmatrix}
        a_{13} & b_{13} \\ c_{13} & d_{13}
    \end{bmatrix}=\begin{bmatrix}
        a_{23} & b_{23} \\ c_{23} & d_{23}
    \end{bmatrix}.
\end{aligned}
\end{align}
Observe that since $\underline{G}^{ij}=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j$, we get
\begin{align}
\begin{aligned}
    a_{ij}=[0,1,0]\underline{G}^{ij}[0,1,0]^T=\textbf{x}_i^T\underline{F}^{ij}\textbf{x}_j,\\
    b_{ij}=[0,0,1]\underline{G}^{ij}[0,1,0]^T=\textbf{y}_i^T\underline{F}^{ij}\textbf{x}_j,\\
    c_{ij}=[0,1,0]\underline{G}^{ij}[0,0,1]^T=\textbf{x}_i^T\underline{F}^{ij}\textbf{y}_j,\\
    d_{ij}=[0,0,1]\underline{G}^{ij}[0,0,1]^T=\textbf{y}_i^T\underline{F}^{ij}\textbf{y}_j.
\end{aligned}
\end{align}
In the below, and throughout this section, we skip the transpose notation and write for instance $\textbf{x}_i\underline{F}^{ij}\textbf{x}_j$ instead of $\textbf{x}_i^T\underline{F}^{ij}\textbf{x}_j$. We have
\begin{align}
\begin{aligned}
    \begin{bmatrix}
        \textbf{x}_1\underline{F}^{12}\textbf{x}_2 & \textbf{y}_1\underline{F}^{12}\textbf{x}_2 \\ \textbf{x}_1\underline{F}^{12}\textbf{y}_2 & \textbf{y}_1\underline{F}^{12}\textbf{y}_2
    \end{bmatrix}\star&\begin{bmatrix}
\textbf{x}_1\underline{F}^{13}\textbf{x}_3 & \textbf{y}_1\underline{F}^{13}\textbf{x}_3 \\ \textbf{x}_1\underline{F}^{13}\textbf{y}_3 & \textbf{y}_1\underline{F}^{13}\textbf{y}_3
    \end{bmatrix}=\begin{bmatrix}
        \textbf{x}_2\underline{F}^{23}\textbf{x}_3 & \textbf{y}_2\underline{F}^{23}\textbf{x}_3 \\ \textbf{x}_2\underline{F}^{23}\textbf{y}_3 & \textbf{y}_2\underline{F}^{23}\textbf{y}_3
    \end{bmatrix}.
\end{aligned}
\end{align}
However,
\begin{align}
    \begin{bmatrix}
    \textbf{x}_1\underline{F}^{ij}\textbf{x}_2 & \textbf{y}_1\underline{F}^{ij}\textbf{x}_2 \\ \textbf{x}_1\underline{F}^{ij}\textbf{y}_2 & \textbf{y}_1\underline{F}^{ij}\textbf{y}_2
    \end{bmatrix}=\begin{bmatrix}
        \textbf{x}_i^T\\ \textbf{y}_i^T\end{bmatrix}\underline{F}^{ij}\begin{bmatrix}
        \textbf{x}_j & \textbf{y}_j
    \end{bmatrix},
\end{align}
and therefore, 
   \begin{align}
   \begin{aligned}
    \begin{bmatrix}
        \textbf{x}_1\underline{F}^{12}\textbf{x}_2 & \textbf{y}_1\underline{F}^{12}\textbf{x}_2 \\ \textbf{x}_1\underline{F}^{12}\textbf{y}_2 & \textbf{y}_1\underline{F}^{12}\textbf{y}_2
    \end{bmatrix}\star\begin{bmatrix}
\textbf{x}_1\underline{F}^{13}\textbf{x}_3 & \textbf{y}_1\underline{F}^{13}\textbf{x}_3 \\ \textbf{x}_1\underline{F}^{13}\textbf{y}_3 & \textbf{y}_1\underline{F}^{13}\textbf{y}_3
    \end{bmatrix}&=\begin{bmatrix}
        \textbf{x}_2^T\\ \textbf{y}_2^T\end{bmatrix}\Big(\underline{F}^{21}\begin{bmatrix}
        \textbf{x}_1 & \textbf{y}_1
    \end{bmatrix}\begin{bmatrix}
        \textbf{y}_1^T\\ -\textbf{x}_1^T\end{bmatrix}\underline{F}^{13}\Big)\begin{bmatrix}
        \textbf{x}_3 & \textbf{y}_3
    \end{bmatrix}\\
    &=\begin{bmatrix}
        \textbf{x}_2^T\\ \textbf{y}_2^T\end{bmatrix}\underline{F}^{23}\begin{bmatrix}
        \textbf{x}_3 & \textbf{y}_3
    \end{bmatrix}.
   \end{aligned}
\end{align} 
Since this holds for generic choices of $\textbf{x}_2,\textbf{y}_2,\textbf{x}_3,\textbf{y}_3$, we conclude that projectively
   \begin{align}
    F^{21}\begin{bmatrix}
        \textbf{x}_1 & \textbf{y}_1
    \end{bmatrix}\begin{bmatrix}
        \textbf{y}_1^T\\ -\textbf{x}_1^T\end{bmatrix}F^{13}=F^{23},
\end{align} 
for any $\textbf{x}_1,\textbf{y}_1$ such that $[\underline{e}_1^2\; \textbf{x}_1\; \textbf{y}_1]$ is invertible. Further, 
   \begin{align}
    A=\begin{bmatrix}
        \textbf{x}_1 & \textbf{y}_1
    \end{bmatrix}\begin{bmatrix}
        \textbf{y}_1^T\\ -\textbf{x}_1^T\end{bmatrix}
\end{align} 
is skew-symmetric and equals $[\ell]_\times$ for $\ell=-\textbf{x}_1\times \textbf{y}_1\in \RR^3$. Choosing $\textbf{x}_1,\textbf{y}_1$ such that $\ell=\underline{e}_1^2$, we have $\ell^T\underline{e}_1^2\neq 0$ over the real numbers and it follows that $[\underline{e}_1^2\; \textbf{x}_1\; \textbf{y}_1]$ is full-rank. In other words, 
   \begin{align}\label{eq: e12}
    F^{21}[e_1^2]_\times F^{13}=F^{23},
\end{align} 
which is what we wanted.
\end{proof}


\begin{remark} In the complex setting, it does not always suffice to put $\ell=e_1^2$, because it could be the case that $(e_1^2)^Te_1^2=0$. Then $\ell$ should be any vector such that $\ell^Te_1^2\neq 0$. One can obtain a polynomials system by vectorizing both sides of \Cref{eq: e12} and setting the rank of the $2\times 4$ matrix given by these two vectors to one. In the complex case, we get three such systems by replacing $e_1^2$ with each of the unit vectors of $\CC^3$. \end{remark}

\begin{proof}[Proof of \Cref{thm:compatible_if_each_sextuple_is_compatible}]
    It is clear that triple-wise and quadruple-wise compatibility is necessary to ensure full compatibility (the former follows from the latter), we need only show that it is sufficient.

    We start with the case where all the epipoles in each image coincide and prove that triple-wise compatibility is sufficient in this case.
    
   % In each image, all the epipoles coincide. We start by changing coordinates so that in each image the epipoles have the coordinates $[1,0,0]$ (by \Cref{prop:fundamental_action_preserves_compibility}, this does not affect compatibility). Let $G^{ij}$ be the fundamental matrices after this change of coordinates. Since the epipoles are the kernel and cokernel of the fundamental matrices, we have that the $G^{ij}$ are all on the form

   As in the proof of \Cref{prop: K3 colin}, it suffices to prove the statement for fundamental matrices
    \begin{align}
        G^{ij}=\begin{bmatrix}
        0&0&0\\
        0&a_{ij}&b_{ij}\\
        0&c_{ij}&d_{ij}
    \end{bmatrix}.
    \end{align}
    By compatibility of $\Set{G^{1i},G^{1j},G^{ij}}$, we have by \Cref{prop: K3 colin} 
    \begin{align}
        G^{ij}=\begin{bmatrix}
        0&0&0\\
        0&a_{1i}c_{1j}-c_{1i}a_{1j}&a_{1i}d_{1j}-c_{1i}b_{1j}\\
        0&b_{1i}c_{1j}-d_{1i}a_{1j}&b_{1i}d_{1j}-d_{1i}b_{1j}
    \end{bmatrix},
    \end{align}
    for all $i,j\neq1$. It can be verified that the following cameras $P_i$ form a reconstruction of these fundamental matrices:
    \begin{align}
        P_1&=\begin{bmatrix}
        0&1&0&0\\
        0&0&1&0\\
        0&0&0&1
    \end{bmatrix}, \quad P_i=\begin{bmatrix} 
        i&1&0&0\\
        0&0&b_{1i}&d_{1i}\\
        0&0&-a_{1i}&-c_{1i}
    \end{bmatrix}, \forall i\neq1.
    \end{align}
    Hence the $n\choose2$-tuple is compatible whenever each triple is compatible. We also observe that all cameras have a center lying on the line $[\lambda_1,\lambda_2,0,0]$.

   Now assume that in some image, not all epipoles coincide. The statement in this case follows from \cite[Theorem 2]{kasten2019gpsfm}, but we give a proof here for completeness. We prove the theorem for the case $n=5$ and note that the principle extends to any $n$. 
   
   Choose a 4-tuple for which not all epipoles in each image is the same, say $S_{1234}=\Set{F^{12},F^{13},F^{14},F^{23},F^{24},F^{34}}$. Let $P_1,P_2,P_3,P_4$ be a solution. The centers of these cameras are not collinear, indeed at most one triple, say $P_2,P_3,P_4$, can be collinear. Let $P_1',P_2',P_3',P_5$ be a solution to $S_{1235}=\Set{F^{12},F^{13},F^{15},F^{23},F^{25},F^{35}}$. By \Cref{lem:triple_has_unique_solution}, we have that $P_1,P_2,P_3$ and $P_1',P_2',P_3'$ differ by $\mathrm{PGL}_4$, and we may therefore assume them to be equal. 
   
   It remains to prove that $F^{45}$ is the fundamental matrix of $P_4,P_5$. For this we note that either 1) $P_1,P_2,P_5$ or 2) $P_1,P_3,P_5$ are not collinear cameras, since $P_1,P_2,P_3$ are not collinear. In the first case 1), consider the tuple $S_{1245}=\Set{F^{12},F^{14},F^{15},F^{24},F^{25},F^{45}}$ with solution $P_1'',P_2'',P_4'',P_5''$. By \Cref{lem:triple_has_unique_solution}, the overlap between $S_{1235}$ and $S_{1245}$ imply that we can via $\mathrm{PGL}_4$ action assume $P_1''=P_1,P_2''=P_2,P_5''=P_5$, and the overlap between $S_{1234}$ and $S_{1245}$ imply that we can also assume $P_4''=P_4$. But since $F^{45}$ is the fundamental matrix of $P_4'',P_5''$ we conclude that it is also the fundamental matrix of $P_4,P_5$. In the second case 2) the argument is analogous when we consider $S_{1345}$ instead of $S_{1245}$.  
   %Now assume that in some image, not all epipoles coincide. Since each triple is compatible we can for any triple of indices, determine whether the three corresponding cameras should lie on a line or not. In the case where not all cameras lie on a line, there exists at least one pair of cameras, say $P_1, P_2$, such that the line spanned by their camera centers does not contain any of the other three camera centers.
%Since each quadruple is compatible, we can find a solution $P_1,P_2,P_3,P_4$ to $\Set{F^{12},F^{13},F^{14},F^{23},F^{24},F^{34}}$, similarly we can find a solution $P_1',P_2',P_3',P_5$ to $\Set{F^{12},F^{13},F^{15},F^{23},F^{25},F^{35}}$. Since $P_1,P_2$ have the same fundamental matrix as $P_1',P_2'$ we can let $P_1'=P_1$ and $P_2'=P_2$. Furthermore, $P_3$ does not lie on the line spanned by $P_1,P_2$, so by \Cref{lem:triple_has_unique_solution} the triple $F^{12},F^{13},F^{23}$ uniquely determines the cameras $P_1,P_2,P_3$, and since the triple appears is both cases above we have $P_3'=P_3$. The only thing that remains to be proven is that $F^{45}$ is the fundamental matrix of $P_4,P_5$.
%Consider the sextuple $\Set{F^{12},F^{14},F^{15},F^{24},F^{25},F^{45}}$, it is again compatible and must have a solution $P_1',P_2',P_4',P_5'$ where $F^{45}$ is the fundamental matrix of $P_4',P_5'$. However, by the same arguments as above, we can take $P_i'=P_i$, so $F^{45}$ is the fundamental matrix of $P_4,P_5$ as well, proving that the whole 10-tuple is compatible.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{$K_4$}


\begin{customtheorem}{\ref{thm: 4tuple-condition}}[Case 1] 
Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices such that the three epipoles in each image do not lie on a line. % satisfying the triple-wise conditions. Assume further that the three epipoles in each image do not lie on a line. 
Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold and
\begin{align}
\begin{aligned} \label{eq: 4-tuple SM}
\textnormal{\textbf{e}}_{4123}\textnormal{\textbf{e}}_{2134}\textnormal{\textbf{e}}_{3142}\textnormal{\textbf{e}}_{4231}\textnormal{\textbf{e}}_{1243}\textnormal{\textbf{e}}_{2341}=\textnormal{\textbf{e}}_{3124}\textnormal{\textbf{e}}_{4132}\textnormal{\textbf{e}}_{2143}\textnormal{\textbf{e}}_{1234}\textnormal{\textbf{e}}_{3241}\textnormal{\textbf{e}}_{1342}.
\end{aligned}
\end{align}
\end{customtheorem}


%\begin{proof}[First Proof] One direction is explained in \Cref{s: Can}. For the other direction, first note that triple-wise conditions imply that $\Set{F^{ij}}$ can be turned skew-symmetric by fundamental action. We can see this by considering any subset of 5 fundamental matrices. For them triple-wise conditions are enough to guarantee compatability, and a solution of cameras of the form $C_i=[I|t^{(i)}]$ exists. For such $C_i$, all six fundamental matrices are skew-symmetric. However, as shown in \Cref{s: Can}, \Cref{eq: 4-tuple SM} implies that a scaling exists such that the cycle conditions hold. This argument works under the assumption that all epipolar numbers are non-zero.   
%\end{proof}

\begin{proof} The triple-wise conditions are clearly necessary for compatibility, so we assume that they are satisfied and prove that in this case compatibility is equivalent to \Cref{eq: 4-tuple SM} being satisfied. We begin by simplifying the problem. Let
\begin{align}
    \underline{H}_i=\begin{bmatrix}
    \underline{e}_i^j\,\, \underline{e}_i^k\,\, \underline{e}_i^l
    \end{bmatrix}.
\end{align}
This $3\times3$ matrix is of full rank and takes the unit vectors to the three epipoles in the $i$-th image. Using this as our fundamental action, we get a new sextuple of fundamental matrices
\begin{align}
    \underline{G}^{ij}=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j.
\end{align}
Since the fundamental action preserves compatibility, the sextuple $\Set{G^{ij}}$ is compatible if and only if $\Set{F^{ij}}$ is. Note that the epipoles of $G^{ij}$ are as follows, we denote them by $h$:
\begin{align}
\begin{aligned}
    &\underline{h}_1^2=[1,0,0],   &     &\underline{h}_2^1=[1,0,0],   &        &\underline{h}_3^1=[1,0,0],  &   &\underline{h}_4^1=[1,0,0],\\
    &\underline{h}_1^3=[0,1,0],   &     &\underline{h}_2^3=[0,1,0],   &        &\underline{h}_3^2=[0,1,0],  &   &\underline{h}_4^2=[0,1,0],\\
    &\underline{h}_1^4=[0,0,1],   &     &\underline{h}_2^4=[0,0,1] ,  &        &\underline{h}_3^4=[0,0,1],  &   &\underline{h}_4^3=[0,0,1].
\end{aligned}
\end{align}
Moreover, since the $G^{ij}$ satisfy the triple-wise conditions (we assumed $F^{ij}$ did, and these are preserved under fundamental action) we know that the six matrices must be on the form: 
\begin{align}\label{eq: Gform c1}
\begin{aligned}
    &\underline{G}^{12}=\begin{bmatrix} 0&0&0\\0&0&x_{12}\\0&y_{12}&0 \end{bmatrix},      &&\underline{G}^{13}=\begin{bmatrix} 0&0&x_{13}\\0&0&0\\0&y_{13}&0 \end{bmatrix}, &&\underline{G}^{14}=\begin{bmatrix} 0&0&x_{14}\\0&y_{14}&0\\0&0&0 \end{bmatrix},\\
    &\underline{G}^{23}=\begin{bmatrix} 0&0&x_{23}\\0&0&0\\y_{23}&0&0 \end{bmatrix},       &&\underline{G}^{24}=\begin{bmatrix} 0&0&x_{24}\\y_{24}&0&0\\0&0&0 \end{bmatrix},      &&\underline{G}^{34}=\begin{bmatrix} 0&x_{34}&0\\y_{34}&0&0\\0&0&0 \end{bmatrix}.  
\end{aligned}
\end{align}
The sextuple $\Set{G^{ij}}$ is compatible if and only if there exists a reconstruction consisting of 4 cameras $P_i$. We are free to choose coordinates in $\p3$ without affecting compatibility. Assuming cameras exist, we take the four camera centers %(assuming cameras exist) 
to be the four unit vectors % points where all but the $i$-th coordinate is zero 
(such a choice is only possible if the four camera centers do not lie in a plane, but the fact that the epipoles do not lie on a line ensures that any reconstruction must have non-coplanar camera centers). Furthermore, by the definition of the epipole, we know that the cameras must satisfy
\begin{align}
\label{eq:epipole}
    P_i(\ker(P_j))=e_i^j.
\end{align}
So if $\Set{G^{ij}}$ has a reconstruction $\Set{P_i}$, it must be on the form:
\begin{align}
\begin{aligned}
    &P_1=\begin{bmatrix} 0&\alpha_1^1&0&0\\0&0&\alpha_1^2&0\\0&0&0&\alpha_1^3 \end{bmatrix}, 
    & &P_2=\begin{bmatrix} \alpha_2^1&0&0&0\\0&0&\alpha_2^2&0\\0&0&0&\alpha_2^3 \end{bmatrix},\\
    &P_3=\begin{bmatrix} \alpha_3^1&0&0&0\\0&\alpha_3^2&0&0\\0&0&0&\alpha_3^3 \end{bmatrix},
    & &P_4=\begin{bmatrix} \alpha_4^1&0&0&0\\0&\alpha_4^2&0&0\\0&0&\alpha_4^3&0 \end{bmatrix},    
\end{aligned}
\end{align}
where $\alpha_i^j$ are scalars.
Since the fundamental matrices are of rank 2 and the cameras of rank 3, all the $\alpha_i^j$, as well as the $x_{ij}$ and $y_{ij}$ are nonzero. Computing the fundamental matrices of these four cameras, and setting them equal to the $G^{ij}$, we get the following six equations:
\begin{align}\label{eq: elimsystem}
\begin{aligned}
    &x_{12}\alpha_1^2\alpha_2^3=y_{12}\alpha_1^3\alpha_2^2, \quad & &x_{13}\alpha_1^1\alpha_3^3=y_{13}\alpha_1^3\alpha_3^2, \quad &  &x_{14}\alpha_1^1\alpha_4^3=y_{14}\alpha_1^2\alpha_4^2, \\
    &x_{23}\alpha_2^1\alpha_3^3=y_{23}\alpha_2^3\alpha_3^1, \quad & &x_{24}\alpha_2^1\alpha_4^3=y_{24}\alpha_2^2\alpha_4^1, \quad & &x_{34}\alpha_3^1\alpha_4^2=y_{34}\alpha_3^2\alpha_4^1.
\end{aligned}
\end{align}
Eliminating the variables $\alpha_i^j$, for instance as in the attached code, we are left with a single polynomial,
\begin{align}
\label{eq:4_tuple_as_x_y}
    x_{12}y_{13}x_{14}x_{23}y_{24}x_{34}-y_{12}x_{13}y_{14}y_{23}x_{24}y_{34}=0.
\end{align}
This tells us that \Cref{eq: elimsystem} implies \Cref{eq:4_tuple_as_x_y}, and we are left to argue that if $x_{ij},y_{ij}$ are non-zero numbers such that \Cref{eq:4_tuple_as_x_y} holds, then there are non-zero $\alpha_i^j$ such that \Cref{eq: elimsystem} holds. Note that we can assume $\alpha_1^j=1$ by $\mathrm{PGL}_4$ action and that $\alpha_i^1=1$ by scaling. Writing $\lambda_{ij}=x_{ij}/y_{ij}$, we then aim to find non-zero $\alpha_i^j$ such that 
\begin{align}
\begin{aligned}
   \lambda_{12}\alpha_2^3&=\alpha_2^2, &  \lambda_{13}\alpha_3^3&=\alpha_3^2, & \lambda_{14}\alpha_4^3&=\alpha_4^2,\\
\lambda_{23}\alpha_3^3&=\alpha_2^3, &  \lambda_{24}\alpha_4^3&=\alpha_2^2, & \lambda_{34}\alpha_4^2&=\alpha_3^2.
\end{aligned}
\end{align}
It is clear that we can find non-zero $\alpha_i^j$ that solve the first five equations. However, this is enough because using $\lambda_{12}\lambda_{14}\lambda_{23}\lambda_{34}=\lambda_{13}\lambda_{24}$, the sixth equation $\lambda_{34}\alpha_4^2=\alpha_3^2$ is implied by the other five through substitution. 


It follows that the set $\Set{G^{ij}}$ is compatible if and only if  \Cref{eq:4_tuple_as_x_y} is satisfied. Finally, we can express the $x_{ij}$ and $y_{ij}$ in terms of $\underline{F}^{ij}$ and $\underline{e}_i^j$, for instance we have
\begin{align}
\begin{aligned}
x_{12}=(\underline{h}_1^3)^T\underline{G}^{12}\underline{h}_2^4=(\underline{h}_1^3)^T\underline{H}_1^T\underline{F}^{12}\underline{H}_2\underline{h}_2^4=(\underline{e}_1^3)^T\underline{F}^{12}\underline{e}_2^4.
\end{aligned}
\end{align}
Making these substitutions for all the $x_{ij}$ and $y_{ij}$, we get \Cref{eq: 4-tuple SM}, which is homogeneous in every epipole and fundamental matrix.
\end{proof}

\begin{customtheorem}{\ref{thm: Case 2}}[Case 2] Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices whose epipoles in each image are distinct and lie on a line. Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold,
%Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices satisfying the triple-wise conditions, and let $e_i^j$ denote their epipoles. Assume further that the three epipoles in each image lie on a line but do not coincide. The sextuple is compatible if and only if
\begin{align}\label{eq: ijk F}
    \langle F^{jk}e_k^i,F^{jl}e_l^i \rangle \langle F^{kj}e_j^i,F^{kl}e_l^i \rangle\langle F^{lj}e_j^i,F^{lk}e_k^i \rangle 
   +\|F^{lj}e_j^i\|^2\|F^{jk}e_k^i\|^2\|F^{kl}e_l^i\|^2 =0 ,
\end{align}
for all distinct $i,j,k,l$ satisfying $l>k>j$, and for 
\begin{align}
    \textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{21}e_1^4,\quad \textbf{x}_3=F^{31}e_1^4,\quad \textbf{x}_4=F^{41}e_1^3,
\end{align}
we have%, and for $\textbf{x}_i=F^{ij}e_j^l$ with $l>k>j$ we have
\begin{align}
\begin{aligned}\label{eq:long_equation}
    \frac{e_3^2F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}\frac{\textbf{x}_1F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^2}-\frac{e_2^3F^{24}\textbf{x}_4}{\textbf{x}_2F^{24}e_4^1}\frac{\textbf{x}_1F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^3}-\frac{\textbf{x}_3F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}&\\ 
    +\frac{e_3^2F^{34}\textbf{x}_4}{e_1^2F^{14}\textbf{x}_4}\frac{e_1^2F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^2}\frac{\textbf{x}_1F^{14}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}+\frac{\textbf{x}_2F^{24}\textbf{x}_4}{\textbf{x}_2F^{24}e_4^1} +\frac{e_3^1F^{34}\textbf{x}_4}{\textbf{x}_3F^{34}e_4^1}\frac{\textbf{x}_2F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^1}&=0.
\end{aligned}
\end{align}
\end{customtheorem}



\begin{proof}
Like in the previous proof, we begin by assuming the triple-wise conditions are satisfied and then simplify the problem. The three epipoles in each image lie on a line, we fix a scaling such that for each $i$ we have $\underline{e}_i^l=\underline{e}_i^j+\underline{e}_i^k$, where $l>k>j$. Let
\begin{align}
\underline{H}_i=\begin{bmatrix}
    \underline{e}_i^j\,\, \underline{e}_i^k \,\, \textbf{x}_i
    \end{bmatrix},
\end{align}
%Note that $(e_i^j)^T\textbf{x}_i$ and $(e_i^k)^T\textbf{x}_i$ for $\textbf{x}_i$ in the statement are both zero, so $H_i$ is of full-rank. 
where $\textbf{x}_i$ is chosen in such a way that $H_i$ is of full rank. Using this as our fundamental action, we get a new sextuple of fundamental matrices
\begin{align}    \underline{G}^{ij}=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j.
\end{align}
Since the fundamental action preserves compatibility, the sextuple $\Set{G^{ij}}$ is compatible if and only if $\Set{F^{ij}}$ is. Note that the epipoles of $G^{ij}$ are as follows:
\begin{align}
\begin{aligned}
    &\underline{h}_1^2=[1,0,0],    & &\underline{h}_2^1=[1,0,0],   & &\underline{h}_3^1=[1,0,0],   & &\underline{h}_4^1=[1,0,0],\\
    &\underline{h}_1^3=[0,1,0],    & &\underline{h}_2^3=[0,1,0],   & &\underline{h}_3^2=[0,1,0],   & &\underline{h}_4^2=[0,1,0],\\
    &\underline{h}_1^4=[1,1,0],    & &\underline{h}_2^4=[1,1,0],   & &\underline{h}_3^4=[1,1,0],   & &\underline{h}_4^3=[1,1,0].
\end{aligned}   
\end{align}
With these epipoles and the fact that the $G^{ij}$ satisfy the triple-wise conditions (we assumed $F^{ij}$ did, and these are preserved under fundamental action), we know that the six matrices must be on the form:

\begin{align}\label{eq: Gform c2}
\begin{aligned}
    &\underline{G}^{12}=\begin{bmatrix} 0&0&0\\0&0&x_{12}\\0&y_{12}&z_{12} \end{bmatrix},
    &&\underline{G}^{13}=\begin{bmatrix} 0&0&x_{13}\\0&0&0\\0&y_{13}&z_{13} \end{bmatrix}, &&\underline{G}^{14}=\begin{bmatrix} 0&0&x_{14}\\0&0&-x_{14}\\0&y_{14}&z_{14} \end{bmatrix},\\
    &\underline{G}^{23}=\begin{bmatrix} 0&0&x_{23}\\0&0&0\\y_{23}&0&z_{23} \end{bmatrix}, &&\underline{G}^{24}=\begin{bmatrix} 0&0&x_{24}\\0&0&-x_{24}\\y_{24}&0&z_{24} \end{bmatrix},
    &&\underline{G}^{34}=\begin{bmatrix} 0&0&x_{34}\\0&0&-x_{34}\\y_{34}&-y_{34}&z_{34} \end{bmatrix}.
\end{aligned}
\end{align}
The sextuple $\Set{G^{ij}}$ is compatible if and only if there exists a reconstruction consisting of 4 cameras $P_i$. Since the three epipoles in each image are collinear, any such reconstruction must consist of four cameras whose camera centers all lie in the same plane. We are free to choose coordinates in $\p3$ without changing the fundamental matrices, so we take the four camera centers (assuming they exist) to be $[1,0,0,0]$, $[0,1,0,0]$, $[0,0,1,0]$, and $[1,1,1,0]$. Furthermore, by the definition of the epipole, we know that the cameras must satisfy
\begin{align}
    P_i(\ker(P_j))=e_i^j. %\tag{\ref{eq:epipole}}
\end{align}
So if $\Set{G^{ij}}$ has a reconstruction $\Set{P_i}$, it must be on the form:
\begin{align}
\begin{aligned}
    &P_1=\begin{bmatrix} 0&1&0&\alpha_1^1\\0&0&1&\alpha_1^2\\0&0&0&\alpha_1^3 \end{bmatrix},  & &P_2=\begin{bmatrix} 1&0&0&\alpha_2^1\\0&0&1&\alpha_2^2\\0&0&0&\alpha_2^3 \end{bmatrix},\\
    &P_3=\begin{bmatrix} 1&0&0&\alpha_3^1\\0&1&0&\alpha_3^2\\0&0&0&\alpha_3^3 \end{bmatrix},  & &P_4=\begin{bmatrix} 1&0&-1&\alpha_4^1\\0&1&-1&\alpha_4^2\\0&0&0&\alpha_4^3 \end{bmatrix},
\end{aligned}
\end{align}
where the $\alpha_i^j$ are scalars. Since the fundamental matrices are of rank 2 and the cameras of rank 3, the four scalars $\alpha_i^3$, as well as all the $x_{ij}$ and $y_{ij}$ are nonzero. Computing the fundamental matrices of these four cameras, and setting them equal to the $G^{ij}$, we get the following set of equations: 
\begin{align}\label{eq: c2 before elim}
\begin{aligned}
    &\frac{x_{12}}{y_{12}}=-\frac{\alpha_1^3}{\alpha_2^3},  & &\frac{x_{13}}{y_{13}}=-\frac{\alpha_1^3}{\alpha_3^3}, & &\frac{x_{14}}{y_{14}}=-\frac{\alpha_1^3}{\alpha_4^3},\\ &\frac{x_{23}}{y_{23}}=-\frac{\alpha_2^3}{\alpha_3^3},& &\frac{x_{24}}{y_{24}}=-\frac{\alpha_2^3}{\alpha_4^3}, & &\frac{x_{34}}{y_{34}}=-\frac{\alpha_3^3}{\alpha_4^3},
\end{aligned}
 \end{align}
and 
\begin{align}\label{eq: c2 before elim 2}
\begin{aligned}
    &\frac{z_{12}}{y_{12}}=\frac{\alpha_1^2-\alpha_2^2}{\alpha_2^3},  & &\frac{z_{13}}{y_{13}}=\frac{\alpha_1^1-\alpha_3^2}{\alpha_3^3}, &
    &\frac{z_{14}}{y_{14}}=\frac{\alpha_1^1-\alpha_1^2-\alpha_4^2}{\alpha_4^3},\\
    &\frac{z_{23}}{y_{23}}=\frac{\alpha_2^1-\alpha_3^1}{\alpha_3^3}, &
    &\frac{z_{24}}{y_{24}}=\frac{\alpha_2^1-\alpha_2^2-\alpha_4^1}{\alpha_4^3}, &
    &\frac{z_{34}}{y_{34}}=\frac{\alpha_3^1+\alpha_4^2-\alpha_3^2-\alpha_4^1}{\alpha_4^3}.
\end{aligned}
\end{align}
Eliminating the $\alpha_i^j$, as done in the attached code, from these equations gives us the following constraints:
\begin{align}
\label{eq:condition1}
    \frac{x_{12}}{y_{12}}\frac{x_{23}}{y_{23}}=-\frac{x_{13}}{y_{13}},\quad \frac{x_{12}}{y_{12}}\frac{x_{24}}{y_{24}}=-\frac{x_{14}}{y_{14}},\quad \frac{x_{13}}{y_{13}}\frac{x_{34}}{y_{34}}=-\frac{x_{14}}{y_{14}},\quad \frac{x_{23}}{y_{23}}\frac{x_{34}}{y_{34}}=-\frac{x_{24}}{y_{24}},
    %x_{jk}x_{kl}y_{jl}+y_{jk}y_{kl}x_{jl}=0, \quad %\forall l>k>j,
\end{align}
and
\begin{align}
\label{eq:condition2}
    \frac{x_{24}}{y_{24}}\frac{z_{12}}{y_{12}}-\frac{x_{34}}{y_{34}}\frac{z_{13}}{y_{13}}+\frac{x_{34}}{y_{34}}\frac{z_{23}}{y_{23}}-\frac{z_{14}}{y_{14}}+\frac{z_{24}}{y_{24}}-\frac{z_{34}}{y_{34}}=0.
\end{align}
This tells us that \Cref{eq: c2 before elim,eq: c2 before elim 2} imply \Cref{eq:condition1,eq:condition2}, and we now argue that if $x_{ij},z_{ij},y_{ij}$ are such that $x_{ij},y_{ij}$ are non-zero numbers and \Cref{eq:condition1,eq:condition2} hold, then there are $\alpha_i^j$ such that $\alpha_i^3$ are non-zero and \Cref{eq: c2 before elim,eq: c2 before elim 2} hold. By inspection there clearly exists such $\alpha_i^j$ for which the 3 equations of \Cref{eq: c3 before elim} involving $x_{12},x_{23},x_{24}$ and \Cref{eq: c3 before elim 2} not involving $z_{34}$ are satisfied. However, the remaining 4 equations are implied by \Cref{eq:condition1,eq:condition2} through substitution.


The fundamental matrices are therefore compatible if and only if \Cref{eq:condition1,eq:condition2} are satisfied. Let $k$ be the smallest index satisfying $k\neq i,j$, then by construction
\begin{align}
    \begin{aligned}
    \label{eq:substitution}
        &x_{ij}=\underline{e}_i^k\underline{F}^{ij}\textbf{x}_j,\\
        &y_{ij}=\textbf{x}_i\underline{F}^{ij}\underline{e}_j^k,\\
        &z_{ij}=\textbf{x}_i\underline{F}^{ij}\textbf{x}_j.\\
    \end{aligned}
\end{align}
Making the following choices of $\textbf{x}_i$,
\begin{align}\label{eq: c2 choice}
    \textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{21}e_1^4,\quad \textbf{x}_3=F^{31}e_1^4,\quad \textbf{x}_4=F^{41}e_1^3,
\end{align}
ensures that $\underline{H}_i$ are full-rank. In the case of $i=1$, this follows directly from the fact that by \Cref{le: newepip}, $F^{12}e_2^4=e_1^2\times e_1^4$, which further equals $e_1^2\times e_1^3$, and $e_1^2,e_1^3, e_1^2\times e_1^3$ are three linearly independent vectors. Further, with this choice of $\textbf{x}_i$, \Cref{eq:condition2} is equivalent to \Cref{eq:long_equation}.   

Now we focus on the first equality of \Cref{eq:condition1}. It is equivalent to 
\begin{align}\label{eq: c2 trip}
\frac{\underline{e}_1^3\underline{F}^{12}\textbf{x}_2}{\textbf{x}_1\underline{F}^{12}\underline{e}_2^3}\frac{\underline{e}_2^1\underline{F}^{23}\textbf{x}_3}{\textbf{x}_2\underline{F}^{23}\underline{e}_3^1}+\frac{\underline{e}_1^2\underline{F}^{13}\textbf{x}_3}{\textbf{x}_1\underline{F}^{13}\underline{e}_3^2}=0.
\end{align}
This equation is not homogeneous in every epipole, but using the identities $\underline{e}_i^l=\underline{e}_i^j+\underline{e}_i^k$, we can rewrite \Cref{eq: c2 trip} to  
\begin{align}\label{eq: c2 trip 2}
\frac{\textbf{x}_1\underline{F}^{13}\underline{e}_3^4}{\textbf{x}_1\underline{F}^{12}\underline{e}_2^4}\frac{\textbf{x}_2\underline{F}^{21}\underline{e}_1^4}{\textbf{x}_2\underline{F}^{23}\underline{e}_3^4}+\frac{\textbf{x}_3\underline{F}^{31}\underline{e}_1^4}{\textbf{x}_3\underline{F}^{32}\underline{e}_2^4}=0.
\end{align}
It is clear that if \Cref{eq: c2 trip 2} holds for one choice of $\textbf{x}_i$ making the denominators non-zero, then this equations holds for all $\textbf{x}_i$ making the denominators non-zero. Therefore, we can make another of $\textbf{x}_i$ for \Cref{eq:condition1} (which we do because it makes the equations look nicer). Pluggin in
 \begin{align}\label{eq: c2 choice}
    \textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{23}e_3^4,\quad \textbf{x}_3=F^{13}e_3^4,
\end{align}
into \Cref{eq: c2 trip 2}, we get the equation of \Cref{eq: ijk F} corresponding to $i=4$. Analogously we arrive at the other three equations of \Cref{eq: ijk F}.

In summary, we have proven \Cref{eq: c2 choice} satisfy \Cref{eq:condition1,eq:condition2} if and only if $\Set{G^{ij}}$ and therefore $\Set{F^{ij}}$ are compatible. In addition, we argued that this still holds if we make different choice of $\textbf{x}_i$ in \Cref{eq:condition1} that correspond to
\Cref{eq: ijk F}.
%Note that since compatibility is preserved under fundamental action, so if \Cref{eq:condition1,eq:condition2} are satisfied for one choice of $\textbf{x}_i$, they are satisfied for all choices. Substituting \Cref{eq:substitution} into \Cref{eq:condition1}, and setting 
%\begin{align}
%\textbf{x}_i=\underline{F}^{ij}\underline{e}_j^l,\quad
    %\textbf{x}_j=\underline{F}^{jk}\underline{e}_k^i,\quad \textbf{x}_k=\underline{F}^{kl}\underline{e}_l^i,\quad \textbf{x}_l=\underline{F}^{lj}\underline{e}_j^i,
%\end{align} 
%we get:
%\begin{align}
%\begin{aligned}
%    0&=y_{jl}x_{jk}x_{kl}+x_{jl}y_{jk}y_{kl}\\
%    &=(\textbf{x}_jF^{jl}e_l^i)(e_j^iF^{jk}\textbf{x}_k)(e_k^iF^{kl}\textbf{x}_l)+(e_j^iF^{jl}\textbf{x}_l)(\textbf{x}_jF^{jk}e_k^i)(\textbf{x}_kF^{kl}e_l^i)\\
    %=&(e_k^iF^{kj}F^{jl}e_l^i)(e_j^iF^{jk}F^{kl}e_l^i)(e_j^iF^{jl}F^{lk}e_k^i)+(e_j^iF^{jl}F^{lj}e_j^i)(e_k^iF^{kj}F^{jk}e_k^i)(e_l^iF^{lk}F^{kl}e_l^i),\\
%     &=\langle F^{jk}e_k^i,F^{jl}e_l^i \rangle \langle F^{kj}e_j^i,F^{kl}e_l^i \rangle\langle F^{lj}e_j^i,F^{lk}e_k^i \rangle +\|F^{lj}e_j^i\|^2\|F^{jk}e_k^i\|^2\|F^{kl}e_l^i\|^2 ,
%    \end{aligned}
%\end{align}
%hence we arrive at \Cref{eq: ijk F}. Similarly, we can substitute \Cref{eq:substitution} into \Cref{eq:condition2}, and choose $\textbf{x}_i$ as in the statement of the theorem to get \Cref{eq:long_equation}.
%For \Cref{eq:condition2}, we first use \Cref{eq:condition1} to substitute 
%\begin{align}
%  -\frac{1}{y_{14}}=\frac{x_{13}x_{34}}{x_{14}y_{13}y_{34}}  
%\end{align}
%and then plug in $\textbf{x}_i=\underline{F}^{ij}\underline{e}_j^l$ to get a homogeneous equation in every fundamental matrix and epipole. This gives us \Cref{eq:long_equation}. Observe that .
\end{proof}


\begin{remark} In the complex setting, we cannot always put $\textbf{x}_i=F^{ij}e_j^l$, because there is no longer any guarantee that this makes $\underline{H}_i$ invertible. For fixed complex $F^{ij}$, one can check if they are compatible in Case 2 instead by choosing any $\textbf{x}_i$ that make $\underline{H}_i$ invertible. The same principle applies in Case 3. 
\end{remark}

\begin{customtheorem}{\ref{thm: Case 3}}[Case 3] Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices such that 
\begin{align}
    \begin{aligned}
        e_1^2=e_1^3\neq e_1^4,\quad  e_2^1=e_2^3\neq e_2^4,\quad e_3^1=e_3^2\neq e_3^4, 
    \end{aligned}
\end{align}
and $e_4^1,e_4^2,e_4^3$ are distinct and lie on a line. Then $\Set{F^{ij}}$ is compatible if and only if the triple-wise conditions hold,
%Let $\Set{F^{ij}}$ be a sextuple of fundamental matrices satisfying the triple-wise conditions. Assume further that the epipoles satisfy\\
%$e_1^2=e_1^3\neq e_1^4$, $e_2^1=e_2^3\neq e_2^4$, $e_3^1=e_3^2\neq e_3^4$, and $e_4^1,e_4^2,e_4^3$ collinear. Then the sextuple is compatible if and only if
\begin{align}
\begin{aligned}
\label{eq:condition3}
    \langle F^{12}e_2^4,F^{13}e_3^4 \rangle\langle F^{21}e_1^4,F^{23}e_3^4 \rangle \langle F^{31}e_1^4,F^{32}e_2^4 \rangle+\|F^{12}e_2^4\|^2\|F^{23}e_3^4\|^2\|F^{31}e_1^4\|^2 =0,
\end{aligned}
\end{align}
and for %$\textbf{x}_i=F^{ij}e_j^l$ with $l>k>j$,
%Put $x_1=F^{12}e_2^4, x_2 =F^{23}e_3^4, x_3=F^{31}e_1^4$.
\begin{align}\label{eq: c3 xi choices}   \textbf{x}_1=F^{12}e_2^4,\quad \textbf{x}_2=F^{23}e_3^4,\quad \textbf{x}_3=F^{31}e_1^4,
\end{align}
we have
\begin{align}
\label{eq:less_long_equation}
    \frac{e_2^4F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}\frac{\textbf{x}_1F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^4}+\frac{\textbf{x}_1F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^4}-\frac{\textbf{x}_2F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}=0.
\end{align}
\end{customtheorem}

\begin{proof} Like in the two previous proofs, we begin by assuming the triple-wise conditions are satisfied since we know them to be necessary and then we simplify the problem. Let
\begin{align}
    \underline{H}_i=\begin{bmatrix}
    \underline{e}_i^j\,\, \underline{e}_i^l\,\, \textbf{x}_i
    \end{bmatrix},
\end{align}
for $l>k>j$ and $\textbf{x}_i$ making $H_i$ invertible, and
\begin{align}  \underline{G}^{ij}=\underline{H}_i^T\underline{F}^{ij}\underline{H}_j.
\end{align}
The fundamental matrices $G^{ij}$ are compatible if and only if $F^{ij}$ are. Note that the epipoles of $G^{ij}$ are as follows:
\begin{align*}
    &\underline{h}_1^2=[1,0,0],        \quad\underline{h}_2^1=[1,0,0],           \quad\underline{h}_3^1=[1,0,0],     \quad\underline{h}_4^1=[1,0,0],\\
    &\underline{h}_1^3=[1,0,0],        \quad\underline{h}_2^3=[1,0,0],           \quad\underline{h}_3^2=[1,0,0],     \quad\underline{h}_4^2=[0,1,0],\\
    &\underline{h}_1^4=[0,1,0],        \quad\underline{h}_2^4=[0,1,0],           \quad\underline{h}_3^4=[0,1,0],     \quad\underline{h}_4^3=[1,1,0].
\end{align*}
With these epipoles and the fact that the $G^{ij}$ satisfy the triple-wise conditions (preserved under fundamental action), we know that the six matrices must be on the form:

\begin{align}\label{eq: Gform c3}
\begin{aligned}
    &\underline{G}^{12}=\begin{bmatrix} 0&0&0\\0&0&x_{12}\\0&y_{12}&z_{12} \end{bmatrix},      
    & &\underline{G}^{13}=\begin{bmatrix} 0&0&0\\0&0&x_{13}\\0&y_{13}&z_{13} \end{bmatrix},
    & &\underline{G}^{14}=\begin{bmatrix} 0&0&x_{14}\\0&0&0\\0&y_{14}&z_{14} \end{bmatrix},\\
    &\underline{G}^{23}=\begin{bmatrix} 0&0&0\\0&0&x_{23}\\0&y_{23}&z_{23} \end{bmatrix},        
    & &\underline{G}^{24}=\begin{bmatrix} 0&0&x_{24}\\0&0&0\\y_{24}&0&z_{24} \end{bmatrix},
    & &\underline{G}^{34}=\begin{bmatrix} 0&0&x_{34}\\0&0&0\\y_{34}&-y_{34}&z_{34} \end{bmatrix}. 
\end{aligned}
\end{align}
By \Cref{prop: K3 colin}, we must have (up to scale) 
\begin{align}
    \underline{G}^{23}=\begin{bmatrix} 0&0&0\\0&0&-y_{12}x_{13}\\0&x_{12}y_{13}&x_{12}z_{13}-x_{13}z_{12} \end{bmatrix}.
\end{align}
The sextuple $\Set{G^{ij}}$ is compatible if and only if there exists a reconstruction consisting of 4 cameras $P_i$. Since the three epipoles in each image are collinear, any such reconstruction must consist of four cameras whose camera centers lie in the same plane. Furthermore, since two epipoles coincide in the first three images, the centers of $P_1,P_2,P_3$ must lie on a line. We are free to choose coordinates in $\p3$ without changing the fundamental matrices, so we take the four camera centers (assuming they exist) to be $[1,0,0,0]$, $[0,1,0,0]$, $[1,1,0,0]$, and $[0,0,1,0]$. Furthermore, by the definition of the epipole, we know that the cameras must satisfy
\begin{align}
    P_i(\ker(P_j))=e_i^j. %\tag{\ref{eq:epipole}}
\end{align}
So if $\Set{G^{ij}}$ has a reconstruction $\Set{P_i}$, it must be on the form:
\begin{align}
\begin{aligned}
    &P_1=\begin{bmatrix} 0&1&0&\alpha_1^1\\0&0&\beta_1&\alpha_1^2\\0&0&0&\alpha_1^3 \end{bmatrix},      
    & &P_2=\begin{bmatrix} 1&0&0&\alpha_2^1\\0&0&\beta_2&\alpha_2^2\\0&0&0&\alpha_2^3 \end{bmatrix},\\
    &P_3=\begin{bmatrix} 1&-1&0&\alpha_3^1\\0&0&\beta_3&\alpha_3^2\\0&0&0&\alpha_3^3 \end{bmatrix},      
    & &P_4=\begin{bmatrix} 1&0&0&\alpha_4^1\\0&1&0&\alpha_4^2\\0&0&0&\alpha_4^3 \end{bmatrix}.
\end{aligned}
\end{align}
where the $\beta_i,\alpha_i^j$ are scalars. Since the fundamental matrices are of rank 2 and the cameras of rank 3, the four scalars $\alpha_i^3$, as well as all the $\beta_i$, $x_{ij}$ and $y_{ij}$ are nonzero. Computing the fundamental matrices of these four cameras, and setting them equal to the $G^{ij}$, we get the following two set of equations: 
\begin{align}\label{eq: c3 before elim}
\begin{aligned}
    &\frac{x_{12}}{y_{12}}=-\frac{\alpha_1^3\beta_2}{\alpha_2^3\beta_1},  & &\frac{x_{13}}{y_{13}}=-\frac{\alpha_1^3\beta_3}{\alpha_3^3\beta_1}, & &\frac{x_{14}}{y_{14}}=-\frac{\alpha_1^3}{\alpha_4^3},\\ &\frac{x_{23}}{y_{23}}=-\frac{\alpha_2^3\beta_3}{\alpha_3^3\beta_2},& &\frac{x_{24}}{y_{24}}=-\frac{\alpha_2^3}{\alpha_4^3}, & &\frac{x_{34}}{y_{34}}=-\frac{\alpha_3^3}{\alpha_4^3},
\end{aligned}
 \end{align}
and 
\begin{align}\label{eq: c3 before elim 2}
\begin{aligned}
    &\frac{z_{12}}{y_{12}}=\frac{\alpha_1^2\beta_2-\alpha_2^2\beta_1}{\alpha_2^3\beta_1},  & &\frac{z_{13}}{y_{13}}=\frac{\alpha_1^2\beta_3-\alpha_3^2\beta_1}{\alpha_3^3\beta_1}, &
    &\frac{z_{14}}{y_{14}}=\frac{\alpha_1^1-\alpha_4^2}{\alpha_4^3},\\
    &\frac{z_{23}}{y_{23}}=\frac{\alpha_2^2\beta_3-\alpha_3^2\beta_2}{\alpha_3^3\beta_2}, &
    &\frac{z_{24}}{y_{24}}=\frac{\alpha_2^1-\alpha_4^1}{\alpha_4^3}, &
    &\frac{z_{34}}{y_{34}}=\frac{\alpha_3^1-\alpha_4^1+\alpha_4^2}{\alpha_4^3}.
\end{aligned}
\end{align}
After eliminating $\alpha_i^j$ and $\beta_i$, as in the attached code, we are left with
\begin{align}\label{eq: c3 after elim}
x_{12}x_{23}y_{13}+x_{13}y_{12}y_{23}=0,
\end{align}
and
\begin{align}\label{eq: c3 after elim 2}
\frac{x_{23}}{y_{23}}\frac{z_{12}}{y_{12}}+\frac{z_{13}}{y_{13}}-\frac{z_{23}}{y_{23}}=0.
\end{align}
This tells us that \Cref{eq: c3 before elim,eq: c3 before elim 2} imply \Cref{eq: c3 after elim,eq: c3 after elim 2}, and we now argue that if $x_{ij},z_{ij},y_{ij}$ are such that $x_{ij},y_{ij}$ are non-zero numbers and \Cref{eq: c3 after elim,eq: c3 after elim 2} hold, then there are $\alpha_i^j$ and $\beta_i$ such that $\alpha_i^3,\beta_i$ are non-zero and \Cref{eq: c3 before elim,eq: c3 before elim 2} hold. Now by inspection there clearly exists $\alpha_i^j$ and $\beta_i$ for which the 10 equations of \Cref{eq: c3 before elim,eq: c3 before elim 2} not involving $x_{13},y_{13},z_{13}$ are satisfied. However, the final two equations are implied by the other 10 via substitution using \Cref{eq: c3 after elim,eq: c3 after elim 2}.

\Cref{eq: c3 after elim,eq: c3 after elim 2} are homogeneous in every fundamental matrix and epipole:
\begin{align}
\label{eq:condition4}
    \frac{e_1^4F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^4}\frac{e_2^4F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}+\frac{e_1^4F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^4}=0,
\end{align}
and
\begin{align}
\label{eq:condition5}
    \frac{e_2^4F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}\frac{\textbf{x}_1F^{12}\textbf{x}_2}{\textbf{x}_1F^{12}e_2^4}+\frac{\textbf{x}_1F^{13}\textbf{x}_3}{\textbf{x}_1F^{13}e_3^4}-\frac{\textbf{x}_2F^{23}\textbf{x}_3}{\textbf{x}_2F^{23}e_3^4}=0.
\end{align}
Setting $\textbf{x}_i$ as in \Cref{eq: c3 xi choices}, we have that $\underline{H}_i$ are full-rank matrices by \Cref{le: newepip}. And with this choice of $\textbf{x}_i$, \Cref{eq:condition4,eq:condition5} become \Cref{eq:condition3,eq:less_long_equation} respectively, proving that these are necessary and sufficient to ensure compatibility.
\end{proof}




\begin{proof}[Proof of \Cref{thm: redundant}] We first prove it for $n=4$ in the non-collinear case and for $n=3$ in the collinear case. In each of the four cases, we prove that the eigenvalue condition of \Cref{thm: KGGB} is implied by the other conditions. %We do this by showing that the rank condition in the four cases is equivalent to conditions given in \Cref{prop: K3 colin,thm: 4tuple-condition,thm: Case 2,thm: Case 3}

Consider first Case 1: In the proof of \Cref{thm: 4tuple-condition} we show that in this case any six-tuple of compatible fundamental matrices can up to fundamental action be written as \Cref{eq: Gform c1}. We create the $12\times 12$ four-view fundamental matrix $\textbf{G}$ corresponding to them. In \texttt{Macaulay2}, we consider the ideal $I$ generated by the $7\times 7$ minors of $\textbf{G}$, where we first multiply $\underline{G}^{23},\underline{G}^{24}$ and $\underline{G}^{34}$ by indeterminates $\lambda_{23},\lambda_{24}$ and $\lambda_{34}$ respectively. After saturation and elimination of $\lambda_{ij}$, as in the attached code, we are left with \Cref{eq:4_tuple_as_x_y}, meaning that any fundamental matrices on the form \Cref{eq: Gform c1}, satisfy \Cref{eq:4_tuple_as_x_y}. In the proof of \Cref{thm: 4tuple-condition}, we prove that for fundamental matrices on the form \Cref{eq: Gform c1}, \Cref{eq:4_tuple_as_x_y} is equivalent to compatibility, which suffices.

Cases 2 and 3 are proven analogously. 

For the collinear case, Case 4, we instead create the $9\times 9$ three-view fundamental matrix $\textbf{G}$ according to \Cref{eq: Gform}. In \texttt{Macaulay2}, we consider the ideal $I$ generated by $5\times 5$ minors of $\textbf{G}$, where we first multiply $\underline{G}^{23}$ by the indeterminate $\lambda$. After saturation and elimination of $\lambda$, we get the same ideal as the ideal generated by the projective equalities $G^{21}[h_1^2]G^{13}=G^{23},G^{21}[h_2^1]G^{23}=G^{13}$ and $G^{31}[h_1^2]G^{32}=G^{12}$, as seen in the attached code. However, by \Cref{prop: K3 colin}, three fundamental matrices satisfy the equations of the latter ideal precisely if they are compatible in the collinear case. 

%This is done in \texttt{Macaulay2}; the code is attached. For the collinear case, plug the fundamental matrices of \Cref{eq: Gform} into the $9\times 9$ $3$-view fundamental matrix and consider the ideal generated by the $5\times 5$ minors. After saturation and elimination, the conditions we arrive at are the same as the conditions from the elimination of the proof of \Cref{prop: K3 colin}.  

%For Case 1, 2, and 3, we create the $4$-view fundamental matrices using \Cref{eq: Gform c1,eq: Gform c2,eq: Gform c3} respectively and look at the ideal generated by the $7\times 7$ minors. After saturation and elimination, the conditions we arrive at are the same as those of the elimination in \Cref{thm: 4tuple-condition,thm: Case 2,thm: Case 3} respectively.


Now consider the non-collinear case for arbitrary $n\ge4$. Let $\underline{F}^{ij}$ be scaled such that the $n$-view fundamental matrix $\textbf{F}$ is of rank 6 and the rank of the $3\times 3n$ matrix that is the first three rows of $\textbf{F}$ is rank 3. We prove that these conditions alone are enough to ensure compatibility of $\Set{F^{ij}}$. Note that we can find two fundamental matrices $F^{1i},F^{1j}$ such that the $3\times 6$ matrix $[F^{1i}\; F^{1j}]$ is rank 3. Fix those two indices $i,j$. Let $\textbf{F}_{i,j,k,l}$ be the $4$-view fundamental matrix corresponding to indices $i,j,k,l$ for two other indices $k,l$. Then $\mathrm{rank}~\textbf{F}_{i,j,k,l}=6$ is implied by $\mathrm{rank}~\textbf{F}=6$. Since the eigenvalue condition of \Cref{thm:compatible_if_each_sextuple_is_compatible} can be dropped in the case of $n=4$, this guarantees that the six fundamental matrices corresponding to $i,j,k,l$ are compatible. If all such six tuples of fundamental matrices with fixed $i,j$ are compatible, then \cite[Theorem 2]{kasten2019gpsfm}, which is a more general statement than \Cref{thm:compatible_if_each_sextuple_is_compatible}, shows that the complete set of fundamental matrices are compatible. 

Finally we consider the collinear case for arbitrary $n\ge4$. Let $\underline{F}^{ij}$ be scaled such that the $n$-view fundamental matrix $\textbf{F}$ is of rank 4. We prove that these conditions alone are enough to ensure compatibility of $\Set{F^{ij}}$. Let $\textbf{F}_{i,j,k}$ be the $3$-view fundamental matrix corresponding to indices $i,j,k$. Then $\mathrm{rank}~\textbf{F}_{i,j,k}=4$ is implied by $\mathrm{rank}~\textbf{F}=4$. Since the eigenvalue condition of \Cref{thm:compatible_if_each_sextuple_is_compatible} can be dropped in the case of $n=3$, this guarantees that the six fundamental matrices corresponding to $i,j,k$ are compatible. If all such three tuples of fundamental matrices are compatible, then \Cref{thm:compatible_if_each_sextuple_is_compatible} shows that the complete set of fundamental matrices are compatible. 
%As seen in the proof of \Cref{thm:compatible_if_each_sextuple_is_compatible}, we don't need to assume compatibility of all 4-tuples. The rank condition on the $n$ -view fundamental matrix implies that the rank of the $4$-view fundamental matrices of enough $4$-tuples is rank 6 and therefore compatible.
%We first prove it for $n=3$ in Case 4 and $n=4$ for Cases 1, 2, and 3. In each of the four cases, we prove that the eigenvalue condition of \Cref{thm: KGGB} is implied by the other conditions. We do this by showing that the rank condition in the four cases is equivalent to the conditions given in \Cref{prop: K3 colin,thm: 4tuple-condition,thm: Case 2,thm: Case 3}
%This is done in \texttt{Macaulay2}; the code is attached. For the collinear case, plug the fundamental matrices of \Cref{eq: Gform} into the $9\times 9$ $3$-view fundamental matrix and consider the ideal generated by the $5\times 5$ minors. After saturation and elimination, the conditions we arrive at are the same as the conditions from the elimination of the proof of \Cref{prop: K3 colin}.  
%For Case 1, 2, and 3, we create the $4$-view fundamental matrices using \Cref{eq: Gform c1,eq: Gform c2,eq: Gform c3} respectively and look at the ideal generated by the $7\times 7$ minors. After saturation and elimination, the conditions we arrive at are the same as those of the elimination in \Cref{thm: 4tuple-condition,thm: Case 2,thm: Case 3} respectively.
%\MB{Here we should reference Theorem 2 instead}
%With this, we have proven the Theorem for 4 cameras (or 3, in the collinear case). As seen in the proof of \Cref{thm:compatible_if_each_sextuple_is_compatible}, we don't need to assume compatibility of all 4-tuples. The rank condition on the $n$ -view fundamental matrix implies that the rank of the $4$-view fundamental matrices of enough $4$-tuples is rank 6 and therefore compatible. % To prove that the result extends to higher numbers of cameras, note that the rank conditions will still give us the triple- and quadruple-wise constraints since these are given by certain $7\times7$ (or $5\times5$) minors. By \Cref{thm:compatible_if_each_sextuple_is_compatible} these are all the constraints we need, so the rank condition is sufficient in this case also.
\end{proof}

%------------------------------------------------------------------------


\section{Image of the Fundamental Map}\label{s: Image App}

\begin{customproposition}{\ref{prop: image}} The viewing graph variety of $K_n$ for $n\ge 3$ is a proper subset of the variety in $(\PP^{3\times 3})^{n\choose 2}$ defined by the $3{n\choose 3}$ triple-wise constraints and the ${n\choose 4}$ quadruple-wise constraints of \Cref{thm: 4tuple-condition}.
\end{customproposition}


\begin{proof} We do the proof for $K_3$, but note that our counterexample below can be directly extended to any $K_n$. 

The Euclidean closure of the set of rank 3 matrices of different centers in $(\PP^{3\times 4})^3$ is all of $(\PP^{3\times 4})^3$. Then since $\mathcal{V}_{K_3}$ is the Euclidean closure of $\mathrm{Im}\Psi_\mathcal{G}$, any element of its elements can be arbitrarily approximated by the image of full-rank cameras. We give an example showing that the triple-wise constraints are not enough to describe $\mathcal{V}_{K_3}$ by finding an element that cannot be approximated in the way described above. Consider the following example:
    \begin{align}
        F^{12}=\begin{bmatrix}
            0 & 1 & 0 \\
            -1 & 0 & 0\\
            0 & 0 & 0
        \end{bmatrix},  F^{13}=\begin{bmatrix}
            0 & 0 & 1 \\
            0 & 0 & 0\\
            -1 & 0 & 0
        \end{bmatrix}.
    \end{align}
    We can assume $P_1,P_2$ to be $[I|0]$ and $P_2=[I|(0;0;-1)]$. Then the following are the options for $P_3$:
    \begin{align}
        P_3=\begin{bmatrix}
            1 & 0 & 0 & 0 \\
        a & 1+b & c & d\\
            0 & 0 & 1 & 0 
         \end{bmatrix},
    \end{align}
    for any $a,b,c,d$ such that $d\neq 0$. We get that     \begin{align}\label{eq: F23}
        F^{23}=\psi(P_2,P_3)=\begin{bmatrix}
            a & -1 & c+d \\
            b+1 & 0 & 0\\
            -d & 0 & 0
        \end{bmatrix}.
    \end{align}
    This matrix is rank-two if and only if $d\neq 0,b\neq -1$. Any such choice gives a triplet satisfying the triple-wise conditions. Also $F^{12},F^{13},S^{23}$ satisfy the triple-wise constraints, where
     \begin{align}
        S^{23}=\begin{bmatrix}
            0 & 0 & 0 \\
            0 & 0 & 0\\
            0 & 0 & 1
        \end{bmatrix},
    \end{align}
    because the epipole of a rank 1 matrix is 0.
    
    Now any arbitrarily small perturbance of $F^{12}$ and $F^{13}$ leads to an arbitrarily small change in the choice of $F^{23}$ from \Cref{eq: F23}. But no small perturbance of \Cref{eq: F23} equals $S^{23}$, which shows that $F^{12},F^{13},S^{23}$ does not lie in $\mathcal{V}_{K_3}$ and we are done. \end{proof}

\end{document}