\begin{figure}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
        xmode=log,
        width=\textwidth,
        height=.6\textwidth,
        stack negative=separate,
        ybar stacked,
        ymin=-0.2,
        ymax=1.3,
        xtick={1,2,4,8,16,32,64,128,256},
        xticklabels={1M{,} 1N,2M{,} 2N,4M{,} 4N,8M{,} 8N,16M{,} 16N,32M{,} 32N,64M{,} 64N,128M{,} 128N,256M{,} 256N},
        xticklabel style={align=center,text width=10mm},
        xlabel={Matrix dimension (1M=$10^6$), number of nodes (1 Node = 56 cores)},
        x label style={at={(axis description cs:0.5,-0.15)},anchor=north},
        ylabel={time (s)},
        ymajorgrids=true,
        legend pos=north west,
        ytick={-0.2, 0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2},
        yticklabels={0.2, 0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2},
    ]
    \addplot +[draw=black,
    color=hcblue,
    bar shift=-.2cm] table [x=nodes,y=SpMV(comp)] {Figures_data/Scaling/gmres.dat};
    % \addplot +[draw=black,
    % color=gray,
    % bar shift=-.2cm] table [x=nodes,y=SpMV(comm)] {Figures_data/Scaling/gmres.dat};
    \addplot +[draw=black,
    color=hcgreen,
    bar shift=-.2cm] table [x=nodes,y=Ortho(comp)] {Figures_data/Scaling/gmres.dat};
    \addplot +[draw=black,
    color=black,
    bar shift=-.2cm] table [x=nodes,y=Ortho(comm)] {Figures_data/Scaling/gmres.dat};
    \addplot +[draw=black,
    color=hcred,
    bar shift=-.2cm] table [x=nodes,y=Other] {Figures_data/Scaling/gmres.dat};
    \legend{SpMV/MPK, Ortho.\ (comp.), Ortho.\ (comm.), Other}
    \end{axis}
    \begin{axis}[
        xmode=log,
        width=\textwidth,
        height=.6\textwidth,
        stack negative=separate,
        ybar stacked,
        ymin=-0.2,
        ymax=1.3,
        hide axis,
    ]
    \addplot +[draw=black,
    color=hcblue,
    bar shift=.2cm] table [x=nodes,y=SpMV(comp)] {Figures_data/Scaling/cagmres.dat};
    % \addplot +[draw=black,
    % color=gray,
    % bar shift=.2cm] table [x=nodes,y=SpMV(comm)] {Figures_data/Scaling/cagmres.dat};
    \addplot +[draw=black,
    color=hcgreen,
    bar shift=.2cm] table [x=nodes,y=Ortho(comp)] {Figures_data/Scaling/cagmres.dat};
    \addplot +[draw=black,
    color=black,
    bar shift=.2cm] table [x=nodes,y=Ortho(comm)] {Figures_data/Scaling/cagmres.dat};
    \addplot +[draw=black,
    color=hcred,
    bar shift=.2cm] table [x=nodes,y=Other] {Figures_data/Scaling/cagmres.dat};
    \end{axis}
    \end{tikzpicture}
    \caption{Timing breakdown of GMRES (left) and adaptive $s$-step GMRES (right) for weak scaling test of 3D Laplace matrix. The timing of SpMV is inverted in the bar plot to showcase scalability of different operations. Both the computation (comp.) and communication (comm.) of orthogonalization (Ortho.) steps are shown. Other miscellaneous operations such as updating the upper Hessenberg matrix are included as well though their timings are almost negligible.}
    \label{fig:weakscaling}
\end{figure}