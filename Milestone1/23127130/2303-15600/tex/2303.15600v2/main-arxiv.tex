\documentclass[a4paper]{article}
\usepackage{amsmath,amsthm,amssymb}
\usepackage[legacycolonsymbols]{mathtools}
\input{defs.tex}
\bibliographystyle{abbrv}

\title{Finite representation of quantile sets for multivariate data via vector linear programming}
\author{Andreas L{\"o}hne \and Benjamin Weißing}

\begin{document}
\maketitle

\begin{abstract} \noindent A well-known result states that empirical quantiles for finitely distributed univariate random variables can be obtained by solving a linear program. We show in this short note that multivariate empirical quantiles can be obtained in a very similar way by solving a vector linear program. This connection provides a new approach for computing Tukey depth regions and more general cone quantile sets.
	
\end{abstract}

\noindent
Let $X = \Set{x^1,x^2,\dots,x^N} \subseteq \R$ be a finite collection of data points. The \emph{empirical lower quantile function} of $\tilde X$ is given by
\begin{equation}
  q^-_{X}:[0,1] \to \R,\qquad q^-_X(p)
  \coloneqq
  \min\Set{\bar{x} \in X \given \#\Set{x \in X \given x \leq \bar{x}} \geq \ceil{Np}}\text{,}
\end{equation}
where $\ceil{y}\coloneqq \min\Set{z \in \Z \given y\geq z}$.
The following connection to linear programming is discussed in e.g.\
\cite{KoeBas78}:  Consider the linear program
\leqnomode
\begin{equation}
  \label{eq:lp}\tag{LP}
  \max \sum_{i=1}^N x^i(u_i - v_i) \qquad \text{ s.t. } \quad
  \begin{cases}
      0 \leq u \leq p e\\
      0 \leq v \leq (1-p) e\\
      e^T u = e^T v		
  \end{cases}
\end{equation}
\reqnomode
where $e=(1,\dots,1)^T$ denotes the all-one vector of suitable dimension.
The dual linear program of \eqref{eq:lp} can be expressed as
\leqnomode
\begin{equation}
  \label{eq:lp_d}
  \tag{LP\ensuremath{^*}\kern-\scriptspace}
  \min_{  t  \in \R}{%
    \underbrace{\sum_{i = 1}^N{%
         p\pospart{x^i -  t }
        +
        (1 -  p)\negpart{x^i -  t }
      }}_{\eqqcolon\phi_X( t )}
  }\text{,}
\end{equation}
\reqnomode
where $y^+ \coloneqq \max\Set{0,y}$ and $y^- \coloneqq \max\Set{0,-y}$. The objective function $\phi_X$ is polyhedral convex. By inserting $2N$ additional variables, \eqref{eq:lp_d} can be transformed into a standard linear program. Under a mild assumption, the values of the empirical lower quantile function can be obtained from optimal solutions of \eqref{eq:lp_d}.
\begin{prop0}\label{prop:1}
  If $Np \notin \Z$, then \eqref{eq:lp_d} has the
  unique optimal solution $\bar{ t } = q^-_X(p)$.
\end{prop0}
\begin{proof}
	The directional derivative of $\phi \coloneqq \phi_X$ at $ t  \in \R$ in direction $h=1$ is $\phi'( t ,1)= \#\Set{x \in X \given x \leq  t }-pN$. Thus the smallest $ t $ where $\phi'( t ,1)\geq 0$ is $\bar  t  = q^-_X(p)$. Since $Np \notin \Z$, we have $\phi'(\bar  t ,1) \neq 0$, which yields the claim.
\end{proof}

Quantiles may be defined also for multivariate variables, as is done
for instance in \cite{HamKos18}.  The goal of this note is to show
that, analogously to the univariate case outlined above, the
multivariate \emph{cone quantile} from \cite{HamKos18} can be obtained
from the solution of a single vector linear program.

It should be noted that an alternative extension of quantiles to a
multivariate context can be found in \cite{HalPaiSim10}.  (This
article may be consulted for further references about different
approaches to multivariate extensions of the concept of quantiles.)
The \emph{quantile regions} defined there coincide with the cone
quantiles from \cite{HamKos18} in the case of the trivial ordering
cone \(C = \Set{0}\).  In \cite{HalPaiSim10}, computation of a
quantile region is carried out using parametric linear programming.
While the main result of this present note is derived directly (see
the last paragraph for the case \(C = \Set{0}\)), it could, at least
in the case \(C = \Set{0}\), also be inferred from \cite{HalPaiSim10}
as an implication of the equivalence between vector linear programs
and parametric linear programming (c.f.\ \cite{LoeWei16}).

Let $X = \Set{x^1,x^2,\dots,x^N} \subseteq \R^d$ be a finite
collection of $d$-dimensional data points. For a vector $w \in \R^d$
we obtain by
$$w^T X \coloneqq \Set{w^T x^1, w^T x^2,\dots,w^T x^N} \subseteq \R$$
a scalar data set.

Let $C \subseteq \R^d$ be polyhedral convex cone, i.e., $C=\Set{Y^T y \given y \geq 0}$ for some matrix $Y \in \R^{r \times d}$, $r \in \N$. The \emph{dual cone} of $C$ is the polyhedral convex set $C^+ \coloneqq \Set{w \given Y w \geq 0}$. We assume that $C$ has nonempty interior and is free of lines. Let $c$ be an interior point of $C$. Then $B^+ \coloneqq \Set{w \in C^+ \given c^T w = 1}$ is a basis of $C^+$.
 
 
For $d \in \N$ and $p \in (0,1)$, the \emph{empirical lower $C$-quantile} of $X$, introduced in a more general form in \cite{HamKos18}, is the set
  \begin{equation}
    \label{eq:2}
    Q^-_{X,C}(p) \coloneqq \bigcap_{w \in C^+}
    \Set{z \in \R^d \given w^T z \geq q^-_{w^T X}(p) }\text{.}
  \end{equation}
For simplicity, we use here the characterization from \cite[Proposition 6]{HamKos18} as a definition. For other equivalent variants, the reader is referred to \cite{HamKos18}. For the empirical variants, see also \cite{HamKos22}.

In order to compute for given $X, C, p$ the polyhedral convex set $Q^-_{X,C}(p)$, we consider the following vector linear program with ordering cone $C$:
\leqnomode
\begin{equation}\label{eq:vlp}\tag{VLP}
  \max_C \sum_{i=1}^N x^i(u_i - v_i) \qquad \text{ s.t. } \quad
	\begin{cases}
		0 \leq u \leq p e\\
	    0 \leq v \leq (1-p) e\\
		e^T u = e^T v 
	\end{cases}\text{.}		
\end{equation}
\reqnomode
For the choice $d=1$ and $C=\R_+$, \eqref{eq:vlp} reduces to the linear program \eqref{eq:lp} from the univariate case.
Without loss of generality, we can choose a basis $B^+$ such that the last component of $c \in \Int C$ is nonzero, i.e., $\absval{c_d}\neq 0$. 
Then the geometric dual problem of \eqref{eq:vlp} is
\begin{equation}\label{eq:geom_dual}
	\min_K \begin{pmatrix}
	  	\tfrac{c_d}{\absval{c_d}} w_1 \\ 
		  \vdots \\
		\tfrac{c_d}{\absval{c_d}} w_{d-1} \\
	      \displaystyle\sum_{i=1}^N pr_i + (1-p)s_i
	  \end{pmatrix} \; \text{ s.t. } \,
	  \begin{cases}
	  	\hphantom{-}w \in B^+ \\ 
		\hphantom{-}w^T x^i - t \leq r_i,\,
		0 \leq r_i\\
		-w^T x^i + t \leq s_i,\,
		0 \leq s_i\\
		\hphantom{-}(i \in \Set{1,\dots,N})	
	  \end{cases}
\end{equation}  
with variables $w \in \R^d$, $t\in \R$, $r \in \R^N$, $s\in \R^N$ and ordering cone 
\[
  K \coloneqq \Set{y \in \R^d \given y_1 = \cdots = y_{d - 1} =
    0,\, y_d \geq 0}.
\]
Geometric duality was introduced in \cite{HeyLoe08}. The slightly extended variant we use here can be found in \cite{LoeWei17} (see (VLP$_{\text{max}}$) there and note the typo that in the dual problem $K$-maximize has to be replaced by $K$-minimize). The geometric dual problem in \eqref{eq:geom_dual} can be expressed more compactly by using the polyhedral convex function $\phi_{w^T X}$ as introduced above in problem \eqref{eq:lp_d}:
\leqnomode
\begin{gather}\label{eq:vlp_d}\tag{VLP\ensuremath{^*}\kern-\scriptspace}
  \min_K  D(w, t ) \qquad \text{ s.t. } \quad
	w \in B^+,  t  \in \R,
\end{gather}
\reqnomode
with dual objective function
\[
 D(w, t) \coloneqq \begin{pmatrix}
  	\tfrac{c_d}{\absval{c_d}} w_1 \\ 
	  \vdots \\
	\tfrac{c_d}{\absval{c_d}} w_{d-1} \\
      \phi_{w^T X}( t )
  \end{pmatrix}\text{.}
\]
An (optimal) solution $\bar T$ of \eqref{eq:vlp_d} consists of finitely many feasible vectors $(w, t ) \in T \coloneqq B^+ \times \R$ having the property that their objective values $D(w,t)$ cover all vertices of the extended image $\D \coloneqq D[T]+K$. If no point of $\bar T$ can be omitted to cover all vertices of $\D$, the solution $\bar T$ is called irredundant. A solution of \eqref{eq:vlp_d} yields a finite representation of the empirical lower $C$-quantile of $X$.

\begin{thm0} Let $X = \Set{x^1,x^2,\dots,x^N} \subseteq \R^d$, $p \in (0,1)$ such that $pN \notin \Z$, $C \subseteq \R^d$ a line-free polyhedral convex cone with interior point $c$ such that $c_d \neq 0$. Then \eqref{eq:vlp_d} has a unique irredundant optimal solution $\bar T$ and
  \begin{equation*}
     Q^-_{X,C}(p)
    =
     \bigcap_{(w,t) \in \bar T}
      \Set{z \in \R^d
        \given
        w^T z
        \geq t
      }\text{.}
  \end{equation*}
\end{thm0}
\begin{proof}
 By the proposition we know that the function $\phi_{w^T X}$ attains its minimum uniquely in $t(w)\coloneqq q^-_{w^T X}(p)$. Let $z \in \R^d$ such that $w^T z \geq t$ holds for all $(w,t)\in \bar T$. According to \eqref{eq:2} we need to show that $w^T z \geq t(w)$ holds for all $w \in B^+$. For arbitrary $\bar w \in B^+$, $\bar y \coloneqq D(\bar w,t(\bar w))$ belongs to a face $F$ of $\D$ which consists of only $K$-minimal points. The point $\bar y$ is a convex combination of the vertices $y^1,\dots,y^k$ of $F$. Since every vertex $y^i$ of $F$ is also a vertex of $\D$ it must be of the form $y^i = D(w^i,t(w^i))$ for $(w^i,t(w^i)) \in \bar T$, according to the solution concept for \eqref{eq:vlp_d}. Finally we show that $(\bar w,t(\bar w))$ is a convex combination (with the same coefficients as used above) of the points $(w^i,t(w^i))$ for $i \in\Set{1,\dots,k}$. For the first $d-1$ components this is clear from the definition of the objective function $D$. It follows for the $d$-th component from the condition $c^T w = 1$ in the definition of $B^+$. For the last component it follows from the fact that the convex combination of the points $t(w^i)$ minimizes $\phi_{\bar w^T X}$ (which follows by using the extended formulation \eqref{eq:geom_dual}) and thus, by uniqueness, it must be $t(\bar w)$. Combining the inequalities $(w^i)^T \bar z \geq t(w^i)$  yields $\bar w^T \bar z \geq t(\bar w)$. 
\end{proof}

The classical \emph{Tukey depth regions} \cite{Tukey75} provide an important special case of the cone quantiles $Q^-_{X,C}(p)$ and are obtained for the choice $C=\Set{0}$, see \cite[Section 5]{HamKos18}. Since this cone has empty interior, the above results cannot be applied directly. However, it is possible to lift the data set as
$$ \ell(X) = \left\{\begin{pmatrix}
	x \\
-e^T x
\end{pmatrix} \bigg|\; x \in X\right\}\text{.}$$
The lifted data set $\ell(X)$ in $\R^{d+1}$ belongs to the hyperplane $H=\Set{z \in \R^{d+1} \given e^T z = 0}$. For $C=\R^{d+1}_+$ we obtain a finite representation of $Q^-_{\ell(X),C}(p)$ from a solution $\bar T$ of \eqref{eq:vlp_d}. Defining the ``unlifted'' normals as $\lambda(w) \coloneqq (w_1-w_{d+1},\dots,w_d-w_{d+1})$, we have $w^T \ell(X) = \lambda(w)^T X$ and we obtain a finite representation of Tukey depth regions as
  \begin{equation*}
     Q^-_{X,\{0\}}(p)
    =
     \bigcap_{(w,t) \in \bar T}
      \Set{z \in \R^d
        \given
        \lambda(w)^T z
        \geq t
      }\text{.}
  \end{equation*}
  
\subsection*{Acknowledgements}
This research was motivated by a talk of Daniel Kostner and by discussions with Andreas H. Hamel at the SKI\footnote{scientific key ideas} workshop in Bruneck-Brunico in March 2023.  
% \bibliography{ref}
\begin{thebibliography}{1}

\bibitem{HalPaiSim10}
M.~Hallin, D.~Paindaveine, and M.~Šiman.
\newblock Multivariate quantiles and multiple-output regression quantiles: From
  ${L}_1$ optimization to halfspace depth [with discussion and rejoinder].
\newblock {\em The Annals of Statistics}, 38(2):635--703, 2010.

\bibitem{HamKos18}
A.~H. Hamel and D.~Kostner.
\newblock Cone distribution functions and quantiles for multivariate random
  variables.
\newblock {\em J. Multivariate Anal.}, 167:97--113, 2018.

\bibitem{HamKos22}
A.~H. Hamel and D.~Kostner.
\newblock Computation of quantile sets for bivariate ordered data.
\newblock {\em Comput. Statist. Data Anal.}, 169:Paper No. 107422, 20, 2022.

\bibitem{HeyLoe08}
F.~Heyde and A.~L\"{o}hne.
\newblock Geometric duality in multiple objective linear programming.
\newblock {\em SIAM J. Optim.}, 19(2):836--845, 2008.

\bibitem{KoeBas78}
R.~Koenker and G.~Bassett, Jr.
\newblock Regression quantiles.
\newblock {\em Econometrica}, 46(1):33--50, 1978.

\bibitem{LoeWei17}
A.~L\"{o}hne and B.~Wei{\ss}ing.
\newblock The vector linear program solver {\it {b}ensolve}---notes on
  theoretical background.
\newblock {\em European J. Oper. Res.}, 260(3):807--813, 2017.

\bibitem{LoeWei16}
A.~Löhne and B.~Weißing.
\newblock Equivalence between polyhedral projection, multiple objective linear
  programming and vector linear programming.
\newblock {\em Math. Methods Oper. Res.}, 84(2):411--426, 2016.

\bibitem{Tukey75}
J.~W. Tukey.
\newblock Mathematics and the picturing of data.
\newblock In {\em Proceedings of the {I}nternational {C}ongress of
  {M}athematicians ({V}ancouver, {B}.{C}., 1974), {V}ol. 2}, pages 523--531.
  Canad. Math. Congress, Montreal, Que., 1975.

\end{thebibliography}

\end{document}
