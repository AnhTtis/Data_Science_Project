%================================================================================
\section{Introduction}
%================================================================================
\vspace{-5pt}
\begin{wrapfigure}[18]{r}{0.55\textwidth}
    \vspace{-15pt}%
    \includegraphics[width=0.55\textwidth]{figures/edgi_sketch.pdf}%
    \vspace{-10pt}
    \caption{Schematic of \eqd in a navigation task, where the agent (red square) plans the next actions (red dots) to reach the goal (green star) without touching obstacles (grey circles). \textbf{Top}: planning as conditional sampling from a diffusion model. \textbf{Bottom}: effect of a group action. Equivariance requires the diagram to commute.}
    \label{fig:edgi_sketch}
    \vspace{-5pt}
\end{wrapfigure}

Our world is awash with symmetries. The laws of physics are the same everywhere in space and time---they are symmetric under translations and rotations of spatial coordinates as well as under time shifts.\footnote{This is true in the approximately flat spacetime on Earth, as long as all velocities are much smaller than the speed of light. A machine learning researcher who finds herself close to a black hole may disagree.} In addition, whenever multiple identical or equivalent objects are labeled with numbers, the system is symmetric with respect to a permutation of the labels.
Embodied agents are exposed to this structure, and many common robotic tasks exhibit spatial, temporal, or permutation symmetries. The gaits of a quadruped are independent of whether it is moving East or North, and a robotic gripper would interact with multiple identical objects independently of their labeling.
However, most reinforcement learning (RL) and planning algorithms do not take this rich structure into account. While they have achieved remarkable success on well-defined problems after sufficient training, they are often sample-inefficient \citep{holland2018effect} and lack robustness to changes in the environment.

To improve the sample efficiency and robustness of RL algorithms, we believe it is paramount to develop them with an awareness of their symmetries. % of their nature.
Such algorithms should satisfy two key desiderata.
First, policy and world models should be equivariant with respect to the relevant symmetry group. Often, for embodied agents this will be a subgroup of the product group of the spatial symmetry group $\sethree$, the group of discrete time shifts $\timetranslation$, and one or multiple object permutation groups $\permutation$.
Second, it should be possible to softly break (parts of) the symmetry group to solve concrete tasks. For example, a robotic gripper might be tasked with moving an object to a specific point in space, which breaks the symmetry group $\sethree$. 
First works on equivariant RL have demonstrated the potential benefits of this approach~\citep{Van_der_Pol2020-mm,Walters2020-iz,Mondal2021-hu,Muglich2022-id,wang2022so,wang2022robot,Cetin2022,rezaei2022continuous,Deac2023-tg}. However, these works generally only consider small finite symmetry groups such as $C_n$ and do not usually allow for soft symmetry breaking at test time.

In this paper, we introduce the \emph{Equivariant Diffuser for Generating Interactions} (\eqd), an equivariant algorithm for model-based reinforcement learning and planning. \eqd consists of a base component that is equivariant with respect to the full product group $\fullgroup$ and supports the multiple different representations of this group we expect to encounter in embodied environments. Moreover, \eqd allows for a flexible soft breaking of the symmetry at test time depending on the task.

Our work builds on the Diffuser method by \citet{janner2022planning}, who approach both the learning of a dynamics model and planning within it as a generative modeling problem.
The key idea in Diffuser is to train a diffusion model on an offline dataset of state-action trajectories.
To plan with this model, one samples from it conditionally on the current state, using classifier guidance to maximize the reward.

\looseness=-1
Our main contribution is a new diffusion model that is equivariant with respect to the product group $\fullgroup$ of spatial, temporal, and permutation symmetries and supports data consisting of multiple representations. We introduce a new way of embedding multiple input representations into a single internal representation, as well as novel temporal, object, and permutation layers that act on the individual symmetries.  When integrated into a planning algorithm, our approach allows for a soft breaking of the symmetry group through test-time task specifications both through conditioning and classifier guidance. 
We demonstrate \eqd in 3D navigation and robotic object manipulation environments. Compared to non-equivariant baselines, we find a performance improvement in the low-data regime as well as increased robustness to symmetry transformations of the environment.
