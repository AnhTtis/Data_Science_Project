\section{Experiments}
\label{sec:experiments}

We evaluate our proposed consistency loss function on different datasets, using a variety of VQA models and compare our performances to state-of-the-art methods.

\input{sections/04_Datasets}

%%%---------------------------%%%
\subsection{Quantifying consistency}
%$Given a test set, $\mathcal{T}= \{t_n\}^{=1,\ldots,|\mathcal{T}|}$, where $t_n=(\x, \q, a) $ is a test sample triplet, we evaluate the performance of all models using the strict accuracy of predictions as in ~\cite{selvaraju2020squinting,vu2020question} by computing,
%\begin{equation}
%    acc = \frac{1}{|\mathcal{T}|}\sum_{n=1}^{|\mathcal{T}|} 1_{ \{a^n = \tilde{a}^n \}},
%\end{equation}
%where $\tilde{a}^n = \argmax_{a^* \in \mathcal{A}} p(a^* | \x^n,\q^n; \theta)$ is the produced answer of an evaluated method. \STM{I think we could omit the definition of accuracy here. Most recent CVPR papers on consistency only mention that they use accuracy. This would be easier because LXMERT computes the accuracy slightly differenttly due to the soft scores of the GT answers}

Given a test set~$\mathcal{T}= \{t_n\}_{n=1}^{|\mathcal{T}|}$, where $t_n=(\x, \q, a)$ is a test sample triplet, we wish to measure the level of consistency of a VQA model. To this end, we define~$G(\mathcal{T}) \subset \mathcal{T}^2$ as the set of all pairs of test samples~$((\x_i, \q_i, a_i), (\x_j, \q_j, a_j))$ for which~$(\q_i, a_i) \rightarrow (\q_j, a_j)$ and~$\x_i=\x_j$. 
% To do so, we define $G_\leftarrow$, $G_\rightarrow$, $G_\leftrightarrow$, $G_\leftrightarrow$ and $G_{-}$ as sets containing all image-question-answer triplets in $\mathcal{T}$ according to their relation. For instance, $G_\leftarrow$ contains all pairs $((\x, \q_i, a_i), (\x, \q_j, a_j))$ for which $(\q_i, a_i) \leftarrow (\q_j, a_j)$. 

We count the inconsistencies produced by a VQA model~$p$ evaluated on~$\mathcal{T}$ as the number of times the model evaluates a sufficient condition as true and a necessary condition as false,
\begin{equation}
    I_p(\mathcal{T}) = \sum_{(t_i, t_j)\in G(\mathcal{T})} \mathbbm{1}[e_p((\q_i, a_i), \x) \wedge \neg e_p((\q_j, a_j), \x)].
\end{equation}
The function~$e_p$ returns the truth value of the proposition~$(\q, a)$ for image~$\x$ evaluated by the VQA model~$p$,
\begin{equation}
    e_p((\q, a), \x) = \mathbbm{1}[\hat{a}=a],
\end{equation}
where $\hat{a}$ is the answer of maximum probability following Eq.~\eqref{eq:vqa}. In other words, $e_p$~returns whether the estimated answer for question~$\q$ matches the answer of the proposition~$a$.
Finally, the consistency ratio~$c$ for model~$p$ on the test set~$\mathcal{T}$ is the proportion of implications in~$G(\mathcal{T})$ that did not lead to an inconsistency,
\begin{equation}
    c_p(\mathcal{T}) = 1 - \dfrac{I_p(\mathcal{T})}{G(\mathcal{T})}.
\end{equation}
% \begin{equation}
%     c() = 1 - \frac{I_{\rightarrow} + I_{\leftarrow} + I_{\leftrightarrow}}{|G_{\leftarrow}| + |G_{\leftarrow}| + 2|G_{\leftrightarrow}|}.
%     \label{eq:consistency_metric}
% \end{equation}
