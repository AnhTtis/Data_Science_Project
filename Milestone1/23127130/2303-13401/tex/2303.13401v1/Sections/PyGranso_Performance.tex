% \input{Sections/section_elements/Table-Granso_attack_acc_l1.tex}
%
\section{Performance of PWCF in solving max-loss form and min-radius form}
\label{Sec: experiments and results}
In this section, we show the effectiveness of PWCF in solving max-loss form and min-radius form with general distance metrics $d$. First in \cref{min max l1 l2 linf}, we compare the performance of PWCF with other existing numerical algorithms when $d$ is the $\ell_1$, $\ell_2$, and $\ell_\infty$ distance. Next in \cref{min max l15 l8}, we take the $\ell_{1.5}$ and $\ell_8$ distances as examples to show that PWCF can effectively handle max-loss form and min-radius form with general $\ell_p$ metrics. Finally in \cref{subsec: min max perceptual}, we show that PWCF can also handle both formulations with the perceptual distance (PD, a non-$\ell_p$ metric). In this section, due to the variety of capacity differences of the DNN models used, we conservatively use $k=40$ and $K=400$ for experiments on max-loss form, $k=50$ and $K=4000$ for min-radius form on CIFAR-10 dataset, $k=200$ and $K=5000$ for min-radius form on ImageNet-100 dataset and $r=10$ for all cases to avoid possible premature terminations.

\subsection{Solving max-loss form and min-radius form with the $\ell_1$, $\ell_2$ and $\ell_\infty$ distance}
\label{min max l1 l2 linf}
We now compare the performance of PWCF with other existing numerical algorithms  in solving max-loss form and min-radius form when $d$ is the $\ell_1$, $\ell_2$, and $\ell_\infty$ distance to show that PWCF can solve both formulations effectively.

\input{Sections/section_elements/Fig-FAB-min-radius}
\input{Sections/section_elements/Table-Granso_attack_min.tex}

\subsubsection{PWCF offers competitive attack performance in solving max-form with diverse solutions}
\label{subsec: max formulation with l1, l2, linf}
We use several publicly available models that are adversarially trained by $\ell_1$\footnote{For $\ell_1$ experiment, we use the model `L1.pt' from \url{https://github.com/locuslab/robust_union/tree/master/CIFAR10}, which is adversarially trained by $\ell_1$-attack.}, $\ell_2$, and $\ell_\infty$\footnote{For $\ell_2$ ad $\ell_\infty$ experiments, we use the models `L2-Extra.pt' and `Linf-Extra.pt' from \url{https://github.com/deepmind/deepmind-research/tree/master/adversarial_robustness}, with the WRN-70-16 network architecuture.} attacks on CIFAR-10, and by perceptual attack (See \cref{subsec: formulation with general lp norm} for details) on ImageNet-100~\cite{laidlaw2021perceptual}.\footnote{We use the `pat\_alexnet\_0.5.pt' from \url{https://github.com/cassidylaidlaw/perceptual-advex}, where the authors tested and showed its $\ell_2$- and $\ell_\infty$- robustness in the original work.} We then compare the robust accuracy achieved by these selected models by solving max-loss form with PWCF and APGD\footnote{We implement the margin loss on top of the original APGD.} from \texttt{AutoAttack}. The bound $\eps$ for each case is set to follow the common practice of RE\footnote{The $\eps$ of $\ell_2$ and $\ell_\infty$ for CIFAR-10 are chosen from \url{https://robustbench.github.io/}; $\ell_1$ for CIFAR-10 is chosen from \url{https://github.com/locuslab/robust_union}; $\ell_2$ and $\ell_\infty$ for ImageNet-100 are from \cite{laidlaw2021perceptual}.}. The result is shown in \cref{tab: granso_l1_acc}.

We can conclude from \cref{tab: granso_l1_acc} that \textbf{1)} PWCF performs strongly and comparably to APGD on solving max-loss form with the $\ell_1$, $\ell_2$ and $\ell_\infty$ distances, especially when margin loss is used. The weak performance of PWCF on $\ell_1$ and $\ell_\infty$ cases using CE loss is likely due to poor numerical scaling of the loss itself: the gradient magnitude of CE loss grows much larger as the loss value increases (see \cref{fig:loss_clipping} for a visualization example of the loss). Therefore, as the CE loss increases during the optimization of max-loss form while the constraint violation scale remains unchanged or even decreases, PWCF may suffer from the imbalanced contributions from the objective and constraint. In contrast, the gradient scale is always $1$ using the margin loss and PWCF will not have similar struggles. APGD has an explicit step-size rule different from the vanilla PGD algorithms to improve attack performance under CE loss~\cite{croce2020reliable}, while PWCF does not have special handling for this case. In fact, APGD methods also prefer the use of margin loss over CE as pointed out in~\cite{croce2020reliable}, although the consideration is different from PWCF. \textbf{2)} Combining all successful attack samples found by APGD and PWCF using CE and margin loss (column A\&P in \cref{tab: granso_l1_acc}) achieves the lowest robust accuracy for all distance metrics---PWCF and APGD provide diverse and complementary solutions in terms of attack effectiveness. A direct message here is that lacking diversity (e.g., solving max-loss form with a restricted set of algorithms) will result in overestimated robust accuracy. Note that~\cite{CarliniEtAl2019Evaluating} also remarks that the diversity of solvers matters more than the superiority of individual solver, which motivates \texttt{AutoAttack} to include Square Attack---a zero-th order black-box attack method that does not perform strongly itself as shown in \cref{tab: granso_l1_acc}. We will provide further discussions on the importance of diversity later in \cref{sec:pattern_theory}, based on the differences in the solution patterns found in solving max-loss form. 

\subsubsection{PWCF provides competitive solutions to min-radius form}
\label{subsec: min formulation with l1, l2 and linf}
We take models adversarially trained on CIFAR-10\footnote{We use model `pat\_self\_0.5.pt' from \url{https://github.com/cassidylaidlaw/perceptual-advex}.} and ImageNet-100\footnote{The same ImageNet-100 model used in \cref{tab: granso_l1_acc}.} and compare the robustness radii found by solving min-radius form with PWCF and FAB in \cref{Fig:FAB-min-radius-details}, and \cref{tab: granso_min} summarizes the mean, median, and standard deviation of the results in \cref{Fig:FAB-min-radius-details}. From the column Mean and Median in \cref{tab: granso_min}, we can conclude that PWCF performs on average \textbf{1)} better than FAB in solving min-radius form with the $\ell_1$ and $\ell_2$ distances, and \textbf{2)} comparably to FAB for the $\ell_\infty$ case.

\subsection{Solving max-loss form and min-radius form with general distance metrics}
\label{subsec: formulation with general lp norm}
As highlighted in \cref{sec:background}, a major limitation of the existing numerical methods is that they mostly handle limited choice of $d$. On the contrary, PWCF stands out as a convenient choice for other general distances. We now present solving max-loss form and min-radius form with $\ell_{1.5}$, $\ell_{8}$ norm and the perceptual distance (PD, a non-$\ell_p$ distance that involves a DNN) by PWCF. To the best of our knowledge, no prior work has studied handling general distance metrics in the two constraint optimization problems;~\cite{laidlaw2021perceptual} has proposed 3 algorithms to solve max-loss form with PD, which will be compared with PWCF in the following sections.

\subsubsection{Solving min-radius form and max-loss form with $\ell_{1.5}$ and $\ell_{8}$ distances}
\label{min max l15 l8}
Due to the lack of existing methods for comparison, we conduct the following experiments to show the effectiveness of PWCF:
\begin{itemize}[leftmargin=*]
    \item We first apply PWCF to solve min-radius form with the $\ell_{1.5}$ and $\ell_{8}$ distances, and compare the robustness radii with the $\ell_2$ results found in \cref{Fig:FAB-min-radius-details}. One necessary condition for effective optimization is that the robustness radius found using different $\ell_p$ metrics should have $\ell_{1.5} \ge \ell_2 \ge \ell_{8}$. \cref{fig: L1.5 L8 min radius plot} shows the per-sample radii found by PWCF under $\ell_{1.5}$ and $\ell_{8}$ metrics and confirms the satisfaction of the above condition.
    \item We employ two sample-adaptive strategies to set the perturbation budget $\eps$ for PWCF to solve max-loss form with the $\ell_{1.5}$ and $\ell_{8}$ distances: using the same DNN model to evaluate, we take $0.8$ and $1.2$ times the robustness radii found in \cref{fig: L1.5 L8 min radius plot} as $\eps$. If the robustness radii found in \cref{fig: L1.5 L8 min radius plot} are tight, PWCF should achieve close to $100 \%$ robust accuracy under the $0.8$ strategy and $0 \%$ robust accuracy under the $1.2$ strategy, respectively when solving max-loss form. In fact, PWCF achieves $98.33 \%$ and $13 \%$ robust accuracy, respectively for the $\ell_{1.5}$ case; PWCF achieves $93.33 \%$ and $1\%$, respectively for $\ell_{8}$ case---PWCF solves both max-loss form and min-radius form with reasonable quality.
\end{itemize}

\begin{figure}[!tb]
    \centering
    \includegraphics[width=0.45\textwidth]{Figures/L15-L8.png}
    \caption{Robustness radii (y-axis) found by PWCF to solve min-radius form with the $\ell_{1.5}$, $\ell_2$ and $\ell_8$ distances on $60$ CIFAR-10 images. The x-axis represent the sample indices. Effective optimization should respect that the robustness radii found with different metrics satisfy $\ell_{1.5} \ge \ell_2 \ge \ell_{8}$ for every sample.} 
    \label{fig: L1.5 L8 min radius plot} 
\end{figure}

\subsubsection{Solving min-radius form and max-loss form with PD}
\label{subsec: min max perceptual}
Similar to the problems with the $\ell_{1.5}$ and $\ell_{8}$ distances, we are unaware of any existing work that has considered solving min-radius form with PD:\footnote{There are several existing variants of the perceptual distance. Here, we consider the LPIPS distance (first introduced in~\cite{Zhang_2018_CVPR}).}
\begin{align}
\label{Eq. LPIPS Constraint} 
\begin{split}
& d(\mb x, \mb x') \doteq \norm{\phi(\mb x) - \phi(\mb x')}_{2}\\
\text{where} \quad & \phi(\mb x) \doteq [~\wh{g}_{1}(\mb x), \dots, \wh{g}_{L}(\mb x)~]
\end{split}
\end{align}
where $\wh{g}_{1}(\mb x), \dots, \wh{g}_{L}(\mb x)$ are the vectorized intermediate feature maps from pre-trained DNNs (e.g., AlexNet). For max-loss form, three methods are proposed in~\citep{laidlaw2021perceptual}: Perceptual Projected Gradient Descent (PPGD), Lagrangian Perceptual Attack (LPA) and its variant Fast Lagrangian Perceptual Attack (Fast-LPA), all developed in~\cite{laidlaw2021perceptual} based on iterative linearization and projection (PPGD), or penalty method (LPA, Fast-LPA), respectively. In~\citep{laidlaw2021perceptual}, a preset perturbation level $\eps=0.5$ is used in max-loss form (termed perceptual adversarial attack, PAT). 

\begin{figure}[!tb]
    \centering
    \includegraphics[width=0.45\textwidth]{Figures/Min_Radius/imagenetPAT.png}
    \caption{Robustness radius (y-axis) found by solving min-radius form using PWCF with PD on $85$ ImageNet-100 images. The x-axis shows the image indices. The \textcolor{red}{red} dashed line is the proposed bound $\eps$ used to solve max-loss form in~\cite{laidlaw2021perceptual}, which is much larger than each radius found by solving min-radius form with PWCF.} 
    \label{fig: perceptual min radius plot} 
\end{figure}

\input{Sections/section_elements/Table-PAT-Solution-Quality}

We first plot the robustness radii\footnote{Using the same model adversarially pretrained on ImageNet dataset as in \cref{tab: granso_min}} found by PWCF in solving min-radius form in \cref{fig: perceptual min radius plot} on $85$ ImageNet-100 images. Comparing each robustness radius and the preset $\eps$ used in the max-loss form proposed in~\citep{laidlaw2021perceptual}, we observe that PWCF finds much smaller robustness radii for every sample. We can conclude that: 1) PWCF solves min-radius form with PD reasonably well; 2) the choice of $\eps$ is too large in~\cite{laidlaw2021perceptual} to be a reasonable perturbation budget in max-loss form.

Next, we solve max-loss form on the ImageNet-100 validation set with $\eps=0.5$\footnote{Using the same model as in \cref{fig: perceptual min radius plot}}, reporting both the attack success rate and the constraint violation rate of the solutions found. According to \cref{fig: perceptual min radius plot}, the sample-wise robustness radii are much smaller than the preset $\eps$, indicating that effective solvers should achieve $100\%$ attack success rate with $0\%$ violations. As shown in \cref{tab: granso_pat_compare}, PWCF with margin loss is the only one that meets this standard.

