% \newpage
% \clearpage
\section{Method}
\label{sec:method}
The proposed planning pipeline shown in \figref{fig:pipeline} consists of two important steps:
\begin{enumerate*}[label=(\roman*)]
    \item learning to predict the contact between the deformable tool and target objects,
    \item planning an area-coverage trajectory on the target objects.
\end{enumerate*}
\begin{figure*}[!t]
    \centering
    \def\svgwidth{.9\linewidth}
     {\fontsize{10}{10}%\selectfont\sf
    % \input{figures_tex/datagennew.pdf_tex}}
    \input{figures_tex/pipeline.pdf_tex}} 
    \caption{The proposed planning pipeline consists of: a contact map prediction module learns from target object point clouds, which form the input to a dense point cloud network to produce per-point contacts; a sequence planning module that harnesses the trained prediction model to generate an optimal trajectory to accomplish the task.}
    \label{fig:pipeline}
    \vspace{-0.5cm}
\end{figure*}
\subsection{Contact Map Prediction Model}
Knowledge of the contact area between two bodies is crucial when it comes to planning manipulation tasks associated with the interaction between two bodies. Let us consider \figref{fig:idea}, in which a human manipulates a deformable sponge to clean rigid dishes. From the figure, we can see that the contact areas between the sponge and the dishes are highly dependent on the contact location and the geometric features at that contact location. For example, in the case of objects with curved surfaces (\figref{fig:idea}~a,b,c), the deformability of the sponge allows it to conform to the curved surface to cover more area of the object. Let us examine \figref{fig:idea}~a, one can wipe both the bottom and the wall of the pan simply by pressing the sponge on the intersection line, which would not be possible if the sponge is rigid. Inspired by this behavior, we want to develop a model that learns a mapping from the geometric features of the rigid objects to the contact areas between the deformable and the rigid objects.

To this end, we propose using a dense point cloud network to model the contact information between the deformable tool and the target object. Specifically, we use a Pointnet segmentation network \cite{qi2016pointnet}, which, given an input point cloud of the target object $\mathcal{P}_O$ produces per-point outputs. It is worth noting that we are not training the Pointnet segmentation network to do segmentation, as the name implies, but to predict per-point contact class, which indicates whether a point of the target object is in contact with the deformable tool or not. 

The input of the network includes the position and normal vector of each point $p_i \in \mathcal{P}_O$ and a feature vector associated with each point $p_i$. Point positions are normalized to the zero mean, enabling the model to be invariant for point-cloud translations. The feature vector is a two-dimensional vector [$sin(\theta), cos(\theta)$] representing the orientation of the deformable tool around the Z axis at the contact location $p_c$. For points that are not the contact location, the feature vectors are defined as [0,0]. The output of the contact prediction model is the contact class of each point $p_i$ of the target object, where 1 is in contact and 0 is not in contact with the deformable tool. The proposed network is trained with supervised learning manner on a synthetic dataset with the Binary Classification Loss funtion. The synthetic training dataset is explained further in \secref{sec:dataset}.

\subsection{Area Coverage Planning Under Deformations}
As stated in \secref{sec:prob_form}, in this paper we address the problem of area coverage planning under deformations, where our goal is to plan an optimal trajectory that covers the entire surface of the target objects using a deformable tool while harnessing the learned contact map prediction model. The proposed algorithm consists of two steps: 
\begin{enumerate*}
    \item sampling waypoints, where we solve the Set Cover problem to sample sets of waypoints that ensure 100\% of the deformable tool's area coverage of the target objects, 
    \item sequence planning, where we choose and optimize the optimal trajectory from the obtained sets of waypoints. 
\end{enumerate*}
A summary of the algorithm for the sampling waypoints step is shown in Algorithm \ref{alg:planning}.

{\centering
\begin{minipage}{\linewidth}
 \removelatexerror
  \begin{algorithm}[H]
    \caption{Sampling sets of waypoints}\label{alg:planning}
    \SetKwInOut{Input}{Input}   
    \SetKwInOut{Output}{Output}
    \Input{Target object point cloud $\mathcal{P}_O$, number of sets to be sampled $n_{sets}$} 
    \Output{$n_{sets}$ sets of waypoints $\mathcal{T} = \{[p_{i_1} \dots p_{i_n}],[p_{i_1} \dots p_{i_n}],\dots\}$}
    \For {$j = 0, \dots n_{sets}$}{
        \begin{enumerate}
            \item Sample a random contact point $p_{i} \in \mathcal{P}_O$ and \\ gripper orientation $\theta_i$
            \item Predict contact map at $p_{i}: \mathcal{P}_{Ci} = \mathcal{M}(\mathcal{P}_O,p_{i},\theta_i)$
            \item Append contact point $p_i$ to $\mathcal{T}_j$
            \item Remove all points that are in contact with the \\  original target point cloud: $\tilde{\mathcal{P}_O} = \mathcal{P}_O - \mathcal{P}_{Ci}$
        \end{enumerate}
            \Repeat{$\tilde{\mathcal{P}_O} =\emptyset$}{%
            \text{Steps 1 to 3.} 
            \text{Update $\tilde{\mathcal{P}_O} = \tilde{\mathcal{P}_O} - \mathcal{P}_{Ci}$}
                    }
        }
  \end{algorithm}
\end{minipage}
\par
}
More specifically, the planning algorithm takes the point cloud of the target object along with the number of sets to be sampled and produces $\mathcal{T}$ containing $n_{sets}$  sets of contact points on the surface of the target object. We achieve this by solving the set cover problem using a heuristic bottom-up sampling algorithm, where we first randomly sample a contact point on the target object surface, predict the contact areas at that point, and remove all the points that are in contact from the target object point cloud. This process is repeated until the remaining point cloud of the target object is empty, indicating that we have covered the entire object. 

Once $\mathcal{T}$ is obtained, we proceed to the sequence planning step, where the goal is to produce an optimal trajectory that achieves full area coverage of the target objects while minimizing a certain cost measure, such as the travel distance. We frame this problem in relation to the well-known travel salesman problem (TSP). We achieve this by solving the TSP with the 2-Opt algorithm for the best set of waypoints $\mathcal{T}_{j} \in \mathcal{T}$, which ensures 100\% of the area coverage of the target objects with the least number of waypoints. More formally, the optimal trajectory is defined as
\begin{equation}
    \mathcal{T}_{opt} =  TSP(\mathop{\arg \min}\limits_{\mathcal{T}_j \in \mathcal{T}} len(\mathcal{T}_j))
\end{equation}
