\begin{wrapfigure}[20]{r}{0.6\linewidth}
\vspace{-20pt}
\begin{minipage}{0.6\textwidth}
\begin{algorithm}[H]
  \caption{Building the Graph}\label{alg:build_graph}
\small
  \begin{algorithmic}[1]
    \State \textbf{input} \texttt{model}, \texttt{buffer}
    \For{$\{(o_t, a_t, o_{t+1})\}_n$ in \texttt{buffer}} 
        \State{\textcolor{gray}{\footnotesize{\# infer entities from transition}}}
        \State $\{(\mathbf{h}_t, a_t, \mathbf{h}_{t+1})\}_n \gets \texttt{model}\left(\{o_t, a_t, o_{t+1}\}_n\right)$.
        \State{\textcolor{gray}{\footnotesize{\# identify which entity changed in transition}}}
        \State $\{(h^k_t, a_t, h^k_{t+1})\}_n\gets \texttt{isolate}\left(
        \{(\mathbf{h}_t, a_t, \mathbf{h}_{t+1})\}_n\right)$
    \EndFor
    \State{\textcolor{gray}{\footnotesize{\# partition transitions by clustering entities}}}
    \State $\{s_*\}_{m=1}^M \gets \texttt{cluster}\left(\{(s^k_t, a_t, s^k_{t+1})\}_{n=1}^N\right)$ 
    \State{\textcolor{gray}{\footnotesize{\# transitions between clusters are edges}}}
    \State \textbf{initialize} \texttt{graph} with nodes $s_*^{[m]}$, for $m \in [1:M]$
    \ForEach{$\{(h^k_t, a_t, h^k_{t+1})\}_n$}
        \State{\textcolor{gray}{\footnotesize{\# infer cluster assignments}}}
        \State $[i], [j]  \gets \texttt{bind}\left(h_{t}^k\right), \texttt{bind}\left(h_{t+1}^k\right)$
        \State{\textcolor{gray}{\footnotesize{\# tag edge with action $a_t$}}}
        \State \texttt{graph.edges}$[i, j] \gets \texttt{create-edge}\left(s_*^{[i]} \overset{a_t}{\rightarrow} s_*^{[j]}\right)$
    \EndFor
    \State \Return \texttt{graph}
  \end{algorithmic}
\end{algorithm}
\end{minipage}
\vspace{-10pt}
\end{wrapfigure}