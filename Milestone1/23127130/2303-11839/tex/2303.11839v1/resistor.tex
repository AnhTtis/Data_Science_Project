%\documentclass[copyright,creativecommons]{eptcs}
\documentclass[submission,copyright,creativecommons]{eptcs}
\providecommand{\event}{QPL 2023} % Name of the event you
\usepackage[utf8]{inputenc}

\usepackage[pdftex,dvipsnames]{xcolor}  % Coloured text etc.
%\usepackage[top=2cm, bottom=2.5cm, right=2.5cm, left=2.5cm]{geometry} 
%\usepackage{breakurl}
\usepackage{amsmath,amsthm,amssymb,amsfonts,graphicx}
\usepackage{stmaryrd}
\usepackage{tikz}
\usepackage{proof}
\usepackage{enumerate}
\usepackage{mathtools}
\usepackage{lscape}
\usepackage{multicol} 
\usepackage{leftidx}
\usepackage{bbm}
\usepackage{rotating}
\usepackage{extarrows}
\usepackage{graphicx}
\usepackage{placeins}
\usepackage{dsfont}
\usepackage{caption}
\providecommand{\event}{QPL 2023}


%\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=blue, hyperindex, breaklinks]{hyperref}

\input{tikz.tex}

\newcommand{\s}{{\sf s}}
\renewcommand{\t}{{\sf t}}
\renewcommand{\u}{{\sf{u}}}
\renewcommand{\v}{{\sf{v}}}
\newcommand{\<}{\langle}
\renewcommand{\>}{\rangle}
\newcommand{\X}{\mathbb{X}}
\newcommand{\A}{\mathbb{A}}
\newcommand{\B}{\mathbb{B}}
\newcommand{\C}{\mathbb{D}}
\newcommand{\D}{\mathbb{C}}
\newcommand{\I}{\mathbb{I}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\U}{\mathbb{U}}
\newcommand{\V}{\mathbb{V}}
\newcommand{\Y}{\mathbb{Y}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\dsa}{$\dag$-$*$-autonomous}  
\newcommand{\dldc}{$\dag$-LDC}  
\newcommand{\m}{{\sf m}}
\newcommand{\f}{{\sf f}}

 
\newcommand{\nat}{\text{nat. }} 
\newcommand{\id}{\text{id}} 
\newcommand{\CP}{\mathsf{CP}}
\newcommand{\ox}{\otimes}
\newcommand{\pr}{\oplus}
\newcommand{\oa}{\oplus}
\newcommand{\op}{\mathsf{op}}
\newcommand{\rev}{\mathsf{rev}}
\newcommand{\mx}{\mathsf{mx}}
\newcommand{\Chu}{\mathsf{Chu}}
\newcommand{\FRel}{\mathsf{FRel}}
\newcommand{\FMat}{\mathsf{FMat}}
\newcommand{\Rel}{\mathsf{Rel}}
\newcommand{\Mat}{\mathsf{Mat}}
\newcommand{\Core}{\mathsf{Core}}
\newcommand{\Unitary}{\mathsf{Unitary}}
\newcommand{\dual}{\text{\reflectbox{$\Vdash$}}}
\newcommand{\fin}{\mathsf{FinSp}}
\newcommand{\lollipop}{\ensuremath{\!-\!\!\circ}}
\renewcommand{\bar}[1]{\overline{#1}}
\newcommand{\x}{\times}
\newcommand {\poppilol} {\reflectbox{$\multimap$}}

\newcommand{\priyaa}[1]{\textcolor{purple}{#1}}
\newcommand{\todo}[1]{\textcolor{red}{#1}}

\newcommand{\subcat}{\subseteq}
\newcommand{\free}{\mathsf{free}}

\newcommand{\dashvv}{\dashv \!\!\!\!\! \dashv}  
\newcommand{\lindual}{\dashvv}

\newcommand{\chaos}{\mathsf{chaos}}
\newcommand{\order}{\mathsf{order}}

\renewcommand{\phi}{\varphi}
\newcommand{\Asp}{\mathsf{Asp}}
%\renewcommand{\epsilon}{\varepsilon}


% categories
\newcommand{\Rand}{{\sf Rand}}
\newcommand{\Uniform}{{\sf Uniform}}
\newcommand{\Bip}{{\sf Bip}}
\newcommand{\PureBip}{{\sf PureBip}}
\newcommand{\LOCC}{{\sf LOCC}}
\newcommand{\LOCCp}{{\sf LOCC_p}}
\newcommand{\Divergence}{{\sf Distinguish}}
\newcommand{\cDivergence}{{\sf cDistinguish}}
\newcommand{\Processing}{{\sf Processing}}
\newcommand{\cProcessing}{{\sf cProcessing}}
\newcommand{\qRand}{{\sf qRand}}
\newcommand{\qUniform}{{\sf qUniform}}
\newcommand{\pCat}[2]{\left({\sf chaos}_{#1}, #2_{#1}\right)}
\newcommand{\Schmidt}{{\sf Schmidt}}
\newcommand{\mon}{\pcat{[0,\infty]}{\leq}}
\newcommand{\opmon}{\pcat{[0,\infty]}{\geq}}
\newcommand{\chan}[1]{\mathcal{#1}}
\newcommand{\maxmix}[1]{\frac{1}{{\sf dim}(#1) } 1_{#1}}

\newcommand{\Shannon}{\mathsf{Shannon}}

\newcommand{\isabelle}[1]{\textcolor{purple}{#1}}

%\newtheorem{observation}{dummy}[section]
\newcounter{dummy} 
\numberwithin{dummy}{section}

\newtheorem{lemma}[dummy]{Lemma}  %%share counter with remark
\newtheorem{theorem}[dummy]{Theorem}
\theoremstyle{definition}
\newtheorem{definition}[dummy]{Definition}
\newtheorem{remark}[dummy]{Remark}
\newtheorem{notation}[dummy]{Notation}
\newtheorem{proposition}[dummy]{Proposition} 
\newtheorem{corollary}[dummy]{Corollary} 
\theoremstyle{definition}
\newtheorem{example}[dummy]{Example}
\numberwithin{equation}{section}

\iffalse
\let\oldsection\section% Store \section
\renewcommand{\section}{% Update \section
  \renewcommand{\theequation}{\thesection.\arabic{equation}}% Update equation number
  \oldsection}% Regular \section
\let\oldsubsection\subsection% Store \subsection
\renewcommand{\subsection}{% Update \subsection
  \renewcommand{\theequation}{\thesubsection.\arabic{equation}}% Update equation number
  \oldsubsection}% Regular \subsection  
\let\oldsubsubsection\subsubsection% Store \subsection
\renewcommand{\subsubsection}{% Update \subsection
  \renewcommand{\theequation}{\thesubsubsection.\arabic{equation}}% Update equation number
  \oldsubsubsection}% Regular \subsection
\fi 

% Jeff Egger's tensor and par
\newlength{\llcfoo}
\def\superimpose#1#2{
  \settowidth{\llcfoo}{#2}
  \makebox[\llcfoo]{\makebox[0pt]{#1}\makebox[0pt]{#2}}}
%% \superimpose assumes that the first argument is narrower (or
%% equal-in-width) to the second.
\def\mathsuperimpose#1#2{\mathchoice{
  \superimpose{\ensuremath{\displaystyle#1}}{\ensuremath{\displaystyle#2}}}{
  \superimpose{\ensuremath{\textstyle#1}}{\ensuremath{\textstyle#2}}}{
  \superimpose{\ensuremath{\scriptstyle#1}}{\ensuremath{\scriptstyle#2}}}{
  \superimpose{\ensuremath{\scriptscriptstyle#1}}{\ensuremath{\scriptscriptstyle#2}}}}

      \def\quasipt{1pt}     	% if 12pt font
%     \def\quasipt{0.75pt}  	% if 11pt font
%     \def\quasipt{0.67pt}  	% if 10pt font
      \def\minipt{0.6pt}	% seems to work reasonably well in all fonts
      \def\tinypt{0.4pt}	% seems to work reasonably well in all fonts
    \def\smalltimes{\raisebox{\quasipt}{$\scriptstyle\times$}}
    \def\tinytimes{\raisebox{\minipt}{$\scriptscriptstyle\times$}}
    \def\teenytimes{\cdot} % or {\scriptscriptstyle\ast}} or similar
    \def\fixnormalcup{\raisebox{-\quasipt}{$\cup$}}
    \def\fixsmallcup{\raisebox{-\minipt}{$\scriptstyle\cup$}}
    \def\fixtinycup{\raisebox{-\tinypt}{$\scriptscriptstyle\cup$}}
  \def\fixtimes{
    \mathchoice{\smalltimes}{\smalltimes}{\tinytimes}{\teenytimes}}
  \def\fixcup{
    \mathchoice{\fixnormalcup}{\fixnormalcup}{\fixsmallcup}{\fixtinycup}}
\def\ocap{\mathrel{\mathsuperimpose{\fixtimes}{\cap}}}
\def\ocup{\mathrel{\mathsuperimpose{\fixtimes}{\fixcup}}}
\def\bigocap{\mathop{\mathsuperimpose{\times}{\bigcap}}\limits}
\def\bigocup{\mathop{\mathsuperimpose{\times}{\bigcup}}\limits}
\def\bip{\mathop{\mathsuperimpose{\times}{+}}\limits}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% M. Barr uses the following:  "It gives a \to that can be used as
% $A\to B$ or $A\to^f B$ or $A\to^{f\o g\o h}B$ or even $A\to^f_gB$.  The
% arrow will grow to fit the label(s).  There are similar definitions for
% \two and \tofro, for which you really might want labels both above and
% below.  Actually, by reading your definition of \kto, I was able to
% simplify this.  But it is still nice to have the optional arguments.
% There is only caveat: although you can have one or the other or both
% labels, if you have both the upper must precede the lower.  These defs
% must either be placed in a style file xor surrounded by \makeatletter
% and \makeatother (but NOT both)."  (Modifications by rags)
% The definitions below look more elaborate than they need to be.
% The reason is that an empty asscript will still cause extra vertical
% spacing and the only way to avoid ugly extra space seems to be using
% some such method as this.

\makeatletter
\newenvironment{myproof}[1][\proofname]{\par
    \pushQED{\qed}%
    \normalfont \topsep6\p@\@plus6\p@\relax
    \trivlist
    \item[\hskip\labelsep
        \itshape
        #1\@addpunct{.} ]\mbox{}\par\nobreak}
    {\popQED\endtrivlist\@endpefalse}
\makeatother

\makeatletter

% In-text size:

\newdimen\w@dth

\def\setw@dth#1#2{\setbox\z@\hbox{\scriptsize $#1$}\w@dth=\wd\z@
\setbox\@ne\hbox{\scriptsize $#2$}\ifnum\w@dth<\wd\@ne \w@dth=\wd\@ne \fi
\advance\w@dth by 1.2em}

\def\t@^#1_#2{\allowbreak\def\n@one{#1}\def\n@two{#2}\mathrel
{\setw@dth{#1}{#2}
\mathop{\hbox to \w@dth{\rightarrowfill}}\limits
\ifx\n@one\empty\else ^{\box\z@}\fi
\ifx\n@two\empty\else _{\box\@ne}\fi}}
\def\t@@^#1{\@ifnextchar_ {\t@^{#1}}{\t@^{#1}_{}}}


\def\t@left^#1_#2{\def\n@one{#1}\def\n@two{#2}\mathrel{\setw@dth{#1}{#2}
\mathop{\hbox to \w@dth{\leftarrowfill}}\limits
\ifx\n@one\empty\else ^{\box\z@}\fi
\ifx\n@two\empty\else _{\box\@ne}\fi}}
\def\t@@left^#1{\@ifnextchar_ {\t@left^{#1}}{\t@left^{#1}_{}}}


\def\two@^#1_#2{\def\n@one{#1}\def\n@two{#2}\mathrel{\setw@dth{#1}{#2}
\mathop{\vcenter{\hbox to \w@dth{\rightarrowfill}\kern-1.7ex
                 \hbox to \w@dth{\rightarrowfill}}%
       }\limits
\ifx\n@one\empty\else ^{\box\z@}\fi
\ifx\n@two\empty\else _{\box\@ne}\fi}}
\def\tw@@^#1{\@ifnextchar_ {\two@^{#1}}{\two@^{#1}_{}}}


\def\tofr@^#1_#2{\def\n@one{#1}\def\n@two{#2}\mathrel{\setw@dth{#1}{#2}
\mathop{\vcenter{\hbox to \w@dth{\rightarrowfill}\kern-1.7ex
                 \hbox to \w@dth{\leftarrowfill}}%
       }\limits
\ifx\n@one\empty\else ^{\box\z@}\fi
\ifx\n@two\empty\else _{\box\@ne}\fi}}
\def\t@fr@^#1{\@ifnextchar_ {\tofr@^{#1}}{\tofr@^{#1}_{}}}

% Displaysize:

\newdimen\W@dth
\def\setW@dth#1#2{\setbox\z@\hbox{$#1$}\W@dth=\wd\z@
\setbox\@ne\hbox{$#2$}\ifnum\W@dth<\wd\@ne \W@dth=\wd\@ne \fi
\advance\W@dth by 1.2em}

\def\T@^#1_#2{\allowbreak\def\N@one{#1}\def\N@two{#2}\mathrel
{\setW@dth{#1}{#2}
\mathop{\hbox to \W@dth{\rightarrowfill}}\limits
\ifx\N@one\empty\else ^{\box\z@}\fi
\ifx\N@two\empty\else _{\box\@ne}\fi}}
\def\T@@^#1{\@ifnextchar_ {\T@^{#1}}{\T@^{#1}_{}}}


\def\T@left^#1_#2{\def\N@one{#1}\def\N@two{#2}\mathrel{\setW@dth{#1}{#2}
\mathop{\hbox to \W@dth{\leftarrowfill}}\limits
\ifx\N@one\empty\else ^{\box\z@}\fi
\ifx\N@two\empty\else _{\box\@ne}\fi}}
\def\T@@left^#1{\@ifnextchar_ {\T@left^{#1}}{\T@left^{#1}_{}}}


\def\Tofr@^#1_#2{\def\N@one{#1}\def\N@two{#2}\mathrel{\setW@dth{#1}{#2}
\mathop{\vcenter{\hbox to \W@dth{\rightarrowfill}\kern-1.7ex
                 \hbox to \W@dth{\leftarrowfill}}%
       }\limits
\ifx\N@one\empty\else ^{\box\z@}\fi
\ifx\N@two\empty\else _{\box\@ne}\fi}}
\def\T@fr@^#1{\@ifnextchar_ {\Tofr@^{#1}}{\Tofr@^{#1}_{}}}


\def\Two@^#1_#2{\def\N@one{#1}\def\N@two{#2}\mathrel{\setW@dth{#1}{#2}
\mathop{\vcenter{\hbox to \W@dth{\rightarrowfill}\kern-1.7ex
                 \hbox to \W@dth{\rightarrowfill}}%
       }\limits
\ifx\N@one\empty\else ^{\box\z@}\fi
\ifx\N@two\empty\else _{\box\@ne}\fi}}
\def\Tw@@^#1{\@ifnextchar_ {\Two@^{#1}}{\Two@^{#1}_{}}}


\def\to{\@ifnextchar^ {\t@@}{\t@@^{}}}
\def\from{\@ifnextchar^ {\t@@left}{\t@@left^{}}}
\def\tofro{\@ifnextchar^ {\t@fr@}{\t@fr@^{}}}
\def\To{\@ifnextchar^ {\T@@}{\T@@^{}}}
\def\From{\@ifnextchar^ {\T@@left}{\T@@left^{}}}
\def\Two{\@ifnextchar^ {\Tw@@}{\Tw@@^{}}}
\def\Tofro{\@ifnextchar^ {\T@fr@}{\T@fr@^{}}}

\makeatother
\newcommand{\vcenteredinclude}[2]{\begingroup
\setbox0=\hbox{\includegraphics[#1]{#2}}%
\parbox{\wd0}{\box0}\endgroup}
% for pullback corner
\newcommand{\pullbackcorner}[1][ul]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}
\newcommand{\pushoutcorner}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}

%\usepackage{authblk}
%\renewcommand{\mix}{\mathbb{1}} 

\begin{document}
\title{Normalizing Resistor Networks}
\author{Robin Cockett
\institute{Department of Computer Science}
\institute{University of Calgary\\
Alberta, Canada}
\email{robin@ucalgary.ca}
\and
Amolak Ratan Kalra 
\institute{Institute for Quantum Computing\\ Department of Combinatorics and Optimization}
\institute{University of Waterloo\\
Ontario, Canada}
\email{arkalra@uwaterloo.ca}
\and
Priyaa Varshinee Srinivasan
\institute{University of Calgary\\
Alberta, Canada\\ National Institute of Standards and Technology,\\
Maryland, USA}
\email{priyaavarshinee.srin@ucalgary.ca}
}

\def\titlerunning{Normalizing Resistor Networks}
\def\authorrunning{R.Cockett, A.R Kalra, P. Srinivasan}

\maketitle 
\begin{abstract}
This article describes a rewriting system for resistor circuits over any positive division rig using general star to mesh transformations. Star to mesh transformations, which are reminiscent of local complementation for graph states in qudit stabilizer quantum mechanics, are well-known in electrical engineering.  Here we show how these transformations can be organized into a confluent and terminating rewriting system on the category of resistor circuits.  The star to mesh transformations are an infinite family of identities: an obvious -- yet seemingly open -- question concerns whether there is a finite presentation for these identities.
\end{abstract}

\section{Introduction}

Electrical circuits are well-studied and, indeed, the basis of an eponymous engineering discipline. One would therefore expect that there is not much more that can be usefully said about the simplest and most basic of these circuits, namely circuits consisting of just resistors.   However, it turns out that there is always more to say!  Indeed, it seems possible that modern mathematical methods can even provide new insight into what is an old and well-studied subject. Furthermore, 
by considering resistor networks with resistance values in finite fields -- which is not the most natural direction of generalization from an electrical engineering perspective -- has a tantalizing connection to the theory of qudit stabilizer quantum mechanics.

 A categorical description for electrical circuits was provided in Brendan Fong's thesis \cite{fong2016algebra}, described in a paper with John Baez \cite{baez2015compositional}, and was also the subject of Brandon Coya's thesis \cite{Coyer}.  Following the work of Cole Comfort and Alex Kissinger \cite{comfort2021graphical}, the current authors with Shiroman Prakash investigated the relationship between electrical circuits and quantum circuits \cite{cockett2022categories,kalra2022category}. There it was noted that the structure of parity check matrices arising from resistor networks and graph states are precisely the same. This work, in turn, relied on the developments of Graphical Linear Algebra \cite{Bonchi2019GraphicalAA, zanasi} where it was realized that there was a natural encoding of resistors (and electrical circuits) into categories of linear relations.


Resistor networks (or circuits) form a hypergraph category, \cite{fong2019hypergraph}, which we call ${\sf Resist}$: this is a symmetric monoidal category category in which each object is (coherently) a commutative Fr\"obenius algebra.  It is an open issue as to whether the equality of maps in ${\sf Resist}$ can in general be resolved by a simple rewriting system.
We resolve this question in this article for resistor circuits over a positive division rig. Our rewriting system uses the an important identity for electrical circuits of resistors called the star/mesh or $(Y/\Delta)$ identity, which asserts that a ``star-shaped'' circuit (with $n$-points) is equivalent to a ``mesh-shaped'' circuit (on $n$ points).  This a classical observation in electrical engineering with proofs going back almost a century \cite{stardelta}.  

While it is well-known that the $(Y/\Delta)_3$ transform for three nodes is a two-way identity, in the sense that any three pointed star can be transformed into a triangular mesh and conversely any such mesh can be transformed into a star, this fails for $n > 3$.  It fails for a simple reason: meshes of resistors with $n$-nodes when $n>3$ have more degrees of freedom than stars with $n$-nodes.  Meshes on $n$-nodes have $n(n-1)/2$ resistors while stars have only $n$: only at $n=3$ do they have the same number of resistors!  Thus, it is not the case that {\em every\/} $n$-mesh is be equivalent to a $n$-star for $n>3$.  However, it does remain the case for every $n \in \mathbb{N}$) that every $n$-star can be transformed into an equivalent $n$-mesh, thereby, suggesting a natural orientation for these identities.

Not surprisingly the normalizing procedure we introduce uses the general star/mesh identity is oriented in the star to mesh direction: we prove that this forms part of a confluent rewriting system on the category of resistor circuits, ${\sf Resist}$.  Regrettably, this rewriting does not make the circuits more efficient in terms of hardware or real-estate, however, it certainly does provide a simple, easily automated, decision procedure for equality.

Practical circuit designs are often constrained to be planar and there is, thus, a sophisticated literature on planar circuits which, in particular, use the $(Y/\Delta)_3$ identity in the opposite mesh to star direction to optimize circuits.  This has led -- perhaps prematurely -- to the view that ``normalizing'' resistor circuits in general might be hard and, indeed, in the planar case this may be so.   However, as we show in this article that for non-planar circuits this is not the case and there is, in fact, a very natural way to normalize resistor circuits. 

The resulting normal form for circuits is a family of meshes (with ``extra inputs''); a form foreshadowed not only by the work in \cite{fong2016algebra,baez2015compositional,Coyer} but also in the work using parity matrices \cite{cockett2022categories}.   The purpose of the current paper is to show how those observations can be translated into a rewriting system on resistor circuits in which the conductances of the resistors are taken from an arbitrary {\em positive division rig}, $R$.  The division subrigs of the positive reals, $\mathbb{R}_{>0}$, provide a large family of examples of  positive division rigs.  Clearly, $\mathbb{R}_{>0}$ is, the usual ``base'' for resistors in electrical engineering.  

A more ambitious objective would be to show that our results hold for {\em all\/} division rigs.  All fields, including finite fields, are examples of division rigs.  Resistors over finite fields can be interpreted as (special) stabilizer quantum circuits: thus, obtaining such a generalization would have provided normal forms for these quantum circuits which might perhaps be generalized to arbitrary stabilizer circuits.  However, positive rigs are certainly necessary in our formulation as often the formulae demand division by sums which in a non-positive rig can become zero. 

In this paper, we have chosen to using conductances rather than impedances (or resistances) of resistors in an attempt to simplify the calculations. However, the calculation in its impedance form may also provide some advantages as there is then only one case in which division by a sum occurs and that is in the parallel rewrite.  Thus for a division rig there is only one place where a possible division by zero occurs.  Unfortunately, this does not quite suffice to allow the generalization to arbitrary division rigs!

\medskip 

\noindent
{\bf Notation:} Throughout this paper composition is written in diagrammatic order: $fg$ means apply $f$ followed by $g$. The string diagrams are to be read from top to bottom (following the direction of gravity) or left to right.


\section{Preliminaries}

\subsection{Hypergraph categories}

A category is a {\bf hypergraph category} in case it is a symmetric monoidal category in  which every object is coherently a special commutative Fr\"obenius algebra, \cite{fong2019hypergraph}.  
This means that each object $X$ in the category  has an associated special Fr\"obenius algebra structure $(X, \nabla_X: X \ox X \to X, \eta_X: I \to X, \Delta_X: X \to X \ox X, \epsilon_X: X \to I)$, whose identities are graphically depicted below (with $\circ$ indicating both the multiplication, comultiplication, and units): 

The multiplication, the unit, the comultiplication and the counit are drawn as follows:
\[ \includegraphics[scale=0.03]{diag/Frob.png}\] 
The maps satisfy the following equations and their vertically flipped image:
\begin{align*} 
(a) \vcenteredinclude{scale=0.07}{diag/Unitlaw.png} ~~~~~ %\includegraphics[scale=0.05]{diag/Unitlaw.png} ~~~~ 
(b) \vcenteredinclude{scale=0.07}{diag/Assolaw.png} ~~~~~
(c) \vcenteredinclude{scale=0.06}{diag/Commlaw.png} ~~~~~
\end{align*}
\begin{align} \label{eq:Frob}
 (e)~~ \vcenteredinclude{scale=0.07}{diag/Froblaw.png} ~~~~~ %\includegraphics[scale=0.05]{diag/Unitlaw.png} ~~~~ 
 (f)~~ \vcenteredinclude{scale=0.07}{diag/Spllaw.png} 
\end{align}

The Frobenius structure is not natural but is ``coherent'' in the sense that the multiplication on the tensor of two objects is given by $\Delta_{X \ox Y}:= {X \ox Y} \ox (X \ox Y) \to^{\sf ex} (X \ox X) \ox (Y \ox Y) \to^{\Delta_X \ox \Delta_Y} X \ox Y$ and the comultiplication and units are similarly given.

Hypergraph categories are automatically compact closed: each object is self-dual.   This has the effect that the directionality of inputs and outputs is not as important as the connectivity.   

\section{Spider Rewriting}

There is a well-known rewriting system on any hypergraph category, often called ``spider'' rewriting, which normalizes  Fr\"obenius operations,  $\circ^n_m$, called ``spiders'' which have $m$ inputs and $n$ outputs (whose order does not matter).  Within this rewriting system, two spiders which are connected can then be amalgamated to form a bigger spider, see equation {\sf Spider}-(a).  The ``special'' rule allows loops, to be eliminated, see equation {\sf Spider}-(b). The main rewriting rules for spiders are:
\begin{equation}
    (a)~ \vcenteredinclude{scale=0.12}{diag/Rewrite2.png} ~~~~ 
    (b)~ \vcenteredinclude{scale=0.1}{diag/Rewrite3.png} \tag{{\sf Spider}}
\end{equation}

The following unusual rewrite is an {\em expansion} which replaces a wire with a wire with a $\circ^1_1$ junction:
\[ \includegraphics[scale=0.05]{diag/Rewrite5.png}\]
Clearly this, as a rewrite can be performed indefinitely, however, an expansion is only used when there are no rewrites which can immediately undo it: thus, expansion rules are only be used {\em irreducibly\/}.  For example, an expansion of a wire on which there is already a spider can be always be reduced and so is not irreducible. 

The spiders $\circ^0_1$, $\circ^1_0$, and $\circ^1_1$ are given by the unit, the counit, and the identity maps respectively. The spiders $\circ^0_2$ and $\circ^2_0$ are given as follows:
\[ \vcenteredinclude{scale=0.06}{diag/Rewrite6.png} ~~~~~~~~
   \vcenteredinclude{scale=0.06}{diag/Rewrite7.png}  \]

A few examples of the spider of rewriting are as follows:
   \[ (a) \vcenteredinclude{scale=0.1}{diag/Rewrite1.png} ~~~~~~~~
     (b) \vcenteredinclude{scale=0.07}{diag/Rewrite4.png}\]

\subsection{Rigs}

The category ${\sf Resist}_R$ is built atop a rig, $R$, which must satisfy some special properties: the elements of the rig will represent conductances (recall we shall work with conductances rather than impedances) as this makes for slightly simpler calculations.  This means that the rule for amalgamating parallel resistors is achieved by simply adding their conductances.  However, composing resistors in series then becomes more complicated and uses the ability to ``divide''. 

Recall that a {\bf rig} is a ``ring without negatives'' in the sense that, under addition it is a commutative monoid, and under multiplication a monoid.  These operations must satisfy the distributive laws: $r \cdot (p + q) = r \cdot p + r \cdot q$,  $(p + q) \cdot r = p \cdot r + q \cdot r$, and $0 \cdot r = 0 = s \cdot 0$.   Here we shall  consider only {\bf commutative} rigs in which $p \cdot q = q \cdot p$.   The paradigmatic and initial rig is the rig of natural numbers $\mathbb{N}$.   

A {\bf division rig} is a rig in which all non-zero elements have a multiplicative inverse.  Fields are clearly examples of division rigs as are the positive rationals, $\mathbb{Q}_{>0}$, and the positive reals, $\mathbb{R}_{>0}$. Furthermore, the two element lattice with join as addition and meet as multiplication is also a division rig.   

A rig is {\bf positive} if $x + y = 0$ implies that both $x=0$ and $y=0$.  $\mathbb{Q}_{\geq 0}$, $\mathbb{R}_{\geq 0}$, and the two element lattice are all positive division rigs in this sense. However, fields and, in particular, finite fields are not positive rigs.  

Another important examples of positive division rigs is the so called ``tropical'' rig, $(\mathbb{R} \cup \{ -\infty\}, \vee,+)$, where the addition of the rig uses the maximum (with unit $-\infty$) and multiplication uses addition (with $-\infty$ as a zero).  

Below we show how to build a category of resistors based on a positive division rig, $R$.

\subsection{The category ${\sf Resist}_R$}

\begin{definition}
\label{Defn: ResistR}
The category ${\sf Resist}_R$, where $R$ is a positive division rig, is a hypergraph category that consists of:
\begin{description}
\item [Objects:] Natural numbers 
\item [Maps:] Generated by {\bf conductances} $y: 1\to 1$ where $y~\in~ R$ with $y\neq 0$ and ``junctions'' $\circ^n_m$.
\end{description}
\end{definition}
Together with the [{\sf Spider}] rules, the maps satisfy the following identities: 
\[ 
[{\sf Self-adjoint}]~~ \vcenteredinclude{scale=0.07}{diag/R1.png} ~~~~~~
[{\sf Short~circuit}]~~ \vcenteredinclude{scale=0.07}{diag/R2-a.png} 
\]
\[
[{\sf Parallel}]~~ \vcenteredinclude{scale=0.07}{diag/R4.png}
\]

 Thus, resistors are self-adjoint. The [{\sf Short circuit}] rule states that if there is an infinite conductance in parallel with a conductance of any finite value, the current would take the path of ``least resistance" can flow through the infinite conductance wire.  The [{\sf Parallel rule}] is used to collapse a number of parallel conductance into one conductance. A wire may be thought of as a resistor with infinite conductance.  On the other hand, a wire with conductance of zero  implies that no current can flow through the wire and, thus, this is a disconnection.

The resistors in addition satisfy a family of {\em star-mesh identities}, $(Y/\Delta)_n$.  Each of these identities equates a star resistor network, that is a network which has one {\em internal node} (a node which has connections only within the circuit) to a completely connected graph of resistors with no internal nodes which is referred to as a {\em mesh}. 

\begin{figure}[h]
\centering
\includegraphics[scale=0.1]{diag/Star.png}
\caption{n-node star network}
\label{Fig: star}
\end{figure}

\FloatBarrier

Given an n-node star network as shown in Figure \ref{Fig: star}, the corresponding mesh network consists of a completely connected graph with nodes $1, 2, 3, \cdots, n$ in which the edge between each pair of nodes $i$ and $j$ having conductance value,
\begin{equation}
\label{eqn: mesh conductance}
Y_{ij}= \frac{y_{i}y_{j}}{\sum_{k=1}^{n}y_{k}}
\end{equation}

%Suppose, in \textcolor{red}{Figure} \ref{Fig: star}, the labels $y_1, y_2, \cdots, y_n$ refer to impedance value of the resistor instead of conductance, then the impedance between node $i$ and $j$ in the corresponding mesh network is given as: 
%\begin{equation}
 %   R_{ij} = y_i y_j \sum_k^n \frac{1}{y_k}
%\end{equation}

%In the rest of the article, we reserve the labels $r_i$ and $R_{ij}$ for impedance, and $y_i$ and $Y_{ij}$ for conductance. 

A few special cases of the star-mesh transformation are shown below:
\begin{figure}[!h]
    \begin{minipage}[b]{.2\linewidth}
        \centering
        \includegraphics[scale=0.03]{diag/YDelta0.png}
        {\caption*{(Y/$\Delta$)$_0$}}
            \end{minipage}%
    \begin{minipage}[b]{.2\linewidth}
        \centering
        \includegraphics[scale=0.03]{diag/YDelta1.png}
        {\caption*{(Y/$\Delta$)$_1$}}
    \end{minipage}   
    \begin{minipage}[b]{.24\linewidth}
        \centering
        \includegraphics[scale=0.06]{diag/YDelta2b.png}
        {\caption*{(Y/$\Delta$)$_2$}}
    \end{minipage} 
    \begin{minipage}[b]{.32\linewidth}
        \centering
        \includegraphics[scale=0.06]{diag/YDelta3.png}
        {\caption*{(Y/$\Delta$)$_3$}}
    \end{minipage} 
\end{figure}
\FloatBarrier

\section{Rewriting for ${\sf Resist}_R$}

Given any resistor circuit with non-zero impedance on each wire, one can reduce the circuit to a family of meshes, thus to a normal form, by removing all the parallel resistors and the internal nodes using the identities of ${\sf Resist}_R$. Our goal in this section is to prove that the resulting rewriting systems terminates and is confluent.

The following is the main result of this paper:

\begin{theorem}
${\sf Resist}_{R}$ has a confluent terminating rewriting system on maps.
\end{theorem}

%\begin{enumerate}[(a)]
%\item Spider rewriting rule given by equation \ref{eqn: spider}
% \item Star to mesh rewriting rule given by equation \ref{eqn: mesh conductance}
% \item The [{\em Parallel rule}], see definition \ref{Defn: ResistR}
% \end{enumerate}
\begin{proof}

First observe that the reduction using rewriting rules of ${\sf Resist}_R$ must terminate. This may be observed by keeping track of the number of nodes $N$ (after expansion) and the number of parallel arrows $P$ and using lexicographical ordering on the pairs $(N,P)$.  The $[{\sf Spider}]$ and $[{\sf Parallel}]$ rules reduce both $N$ and $P$. The star-mesh family of identities reduce the number of nodes $N$ as an internal node is always removed -- note that the star-mesh rule, on the other hand, can increase the number of parallel connections. As the lexicographical ordering on $\mathbb{N} \times \mathbb{N}$ is a well-ordering, this shows that the reduction process must eventually terminate.

Since the rewriting terminates, local confluence, that is {\em resolutions} of diverging single step rewrites, implies global confluence. Hence, it suffices to prove the local confluence property for the distinct pairs of terms produced by overlapping divergent one step rewrites: these are often called critical pairs. This amounts to proving that the order of reducing overlapping rewrites does not matter. 
%In Figure \ref{fig:confluence example} rewritings for eliminating node $a$ and $b$ overlap, thus when sequentialized, they are not independent of each other.  If the rewriting system is locally confluent, eliminating node $a$ followed by node $b$ must yield the same result as eliminating $b$ followed by $a$.
The critical pairs (excluding the spider rewrites) that occur in the this rewriting system are drawn below:

\begin{enumerate}[(a)]
    \item {\bf Overlapping [{\sf Parallel}] rewrites:}
    
    \begin{minipage}[h]{0.3\textwidth}
            \[ \includegraphics[scale=0.07]{diag/CP2.png} \]
    \end{minipage}
    \begin{minipage}[h]{0.7\textwidth}
    Rewriting the network on the left requires $m-1$ overlapping applications of the [{\sf Parallel}] rule. Since, combining two parallel resistors involves adding their conductances, and addition is associative, all the orders of application of the [{\sf Parallel}] rule yield the same final circuit. Hence, local confluence holds in this case. 

    \end{minipage}
    \item{\bf Overlapping $(Y/\Delta)_1$ and $(Y/\Delta)_2$ rewrite:}
    
    \begin{minipage}[h]{0.3\textwidth}
            \[ \includegraphics[scale=0.03]{diag/CP1.png} \]
    \end{minipage}
    \begin{minipage}[h]{0.7\textwidth}
    To rewrite the network on the left, one may apply $(Y/\Delta)_1$ to eliminate node $b$ first, or apply $(Y/\Delta)_2$ to eliminate node $a$ first. This results in a critical pair $((Y/\Delta)_1, (Y/\Delta)_2)$ in the rewriting process of such networks. However, the critical pair is locally confluent, see below: 
    \end{minipage}
    \[ \includegraphics[scale=0.03]{diag/CP1.png} 
   ~~\xRightarrow{(Y\Delta)_2} ~~\includegraphics[scale=0.03]{diag/A1.png} 
   ~~\xRightarrow{(Y\Delta)_1} ~~\includegraphics[scale=0.015]{diag/A4.png} \]
   \[ \includegraphics[scale=0.03]{diag/CP1.png} 
      ~~ \xRightarrow{(Y\Delta)_1} ~~ \includegraphics[scale=0.026]{diag/A2.png} 
      ~~ \xRightarrow{(Y\Delta)_1} ~~ \includegraphics[scale=0.015]{diag/A3.png} \]
        
    \item {\bf Overlapping $(Y/\Delta)_1$ and star-mesh rewrite:}

    \begin{minipage}[h]{0.3\textwidth}
            \[ \includegraphics[scale=0.06]{diag/Unit1.png} \]
    \end{minipage}
    \begin{minipage}[h]{0.7\textwidth}
             To rewrite the network on the left, one may apply $(Y/\Delta)_1$ to eliminate node $b$ first (and then apply $(Y/\Delta)_m$ to eliminate $a$), or apply $(Y/\Delta)_{m+1}$ to eliminate node $a$ first (and then apply $(Y/\Delta)_m$ to eliminate $b$). This results in a critical pair $((Y/\Delta)_1,(Y/\Delta)_m) $ in the rewriting of such networks. However, by Lemma \ref{Lemma: unit-star rewrite}, local confluence holds for this critical pair. 
    \end{minipage}
    
    \item {\bf Overlapping two star-mesh rewrites:}
    
    \begin{minipage}[h]{0.3\textwidth}
            \[ \includegraphics[scale=0.045]{diag/Confluence_2.png} \]
    \end{minipage}
    \begin{minipage}[h]{0.7\textwidth}
    To rewrite the network on the left, $(Y/\Delta)_{n+1}$ may be applied first to eliminate node $b$ first (followed by $(Y/\Delta)_{m+n}$ to eliminate node $a$), or $(Y/\Delta)_{m+1}$ may be applied to eliminate node $a$ first (followed by $(Y/\Delta)_{m+n}$ to eliminate node $b$). This results in a critical pair $((Y/\Delta)_{n+1}, (Y/\Delta)_{m+1})$ in the rewriting process of such networks. However, by Lemma \ref{Lemma: star-star rewrite}, local confluence holds for this critical pair. 
    \end{minipage}
\end{enumerate}

\end{proof}

An immediate consequence is:
\begin{corollary}
Modulo the decidability of the positive division rig $R$, $
{\sf Resisit}_{R} $ has a decidable equality by reduction to normal form.
\end{corollary} 

\begin{lemma}  
\label{Lemma: unit-star rewrite}
The unit/star-mesh critical pairs in ${\sf Resist}_R$ resolve. 
\end{lemma}
\begin{proof}
Consider the star network composed on one of its outgoing edges with the unit, see circuit  (a). 

\[ ( a)~~~ \vcenteredinclude{scale=0.05}{diag/Unit1.png} \quad \quad
    (b)~~~ \vcenteredinclude{scale=0.05}{diag/Unit2.png} 
\]

To rewrite circuit $(a)$, node $b$ shall be eliminated first by applying $(\text{Y}/\Delta)_1$ or node $a$ shall be eliminated first by applying $(\text{Y}/\Delta)_{m+1}$, thereby resulting in a critical pair. 

Resolving the node $b$ first by applying $(\text{Y}/\Delta)_1$ results in an $m$-node star network (with one internal node $a$), see circuit (b) above. Applying $(Y/\Delta)_m$ to circuit (b) to eliminate node $a$ results a mesh in which for each pair of nodes $1 \leq i,j \leq m$, the resistor edge connecting them has conductance $Y_{ij}^{ba}$ with value: 
\[Y_{ij}^{ba}  = \frac{y_i y_j}{\sum_k^m y_k} \]

On the other hand, resolving node $a$ first by applying $(Y/\Delta)_{m+1}$ results in a mesh network with $m$ external nodes, each one of which are connected to the internal node $b$, see the figure below. In the resulting circuit, each external node $i$ is connected to node $b$ via a resistor with conductance $Y_{ix}^a$, see equation \ref{eqn: R1}-(a). Every pair of external nodes $i$ and $j$ are connected by a resistor with conductance $Y_{ij}^{a}$, see \ref{eqn: R1}-(b). 
\[ \includegraphics[scale=0.05]{diag/Last1.png} \]
\begin{align} 
\label{eqn: R1}
(a)~~~ Y_{ij}^a = \frac{y_i y_j}{\sum_k^m y_k + x} ~~~~~~~~~ 
(b) ~~~ Y_{ix}^a = \frac{y_i x}{\sum_k^m y_k + x} 
\end{align}

Now, applying $(Y/\Delta)_m$ to resolve node $b$ in the resulting circuit, leads to parallel conductances $Y_{ij}^a$ and $Y_{ij}^{ab}$ between any two nodes $1 \leq i, j \leq m$, see the diagram below. 
\[\vcenteredinclude{scale=0.05}{diag/Last2.png}\] 
The value of $Y_{ij}^{ab}$ is computed as follows:
\[ Y_{ij}^{ab} = \frac{Y_{ix}^a Y_{jx}^a}{\sum_k^m Y_{kx}^a} 
= \frac{\frac{y_i x y_j x}{(\sum_k^m y_k + x)^2}}{\frac{\sum_k^m y_k x}{(\sum_k^m y_k + x)}} = \frac{\frac{y_i y_j x}{(\sum_k^m y_k + x)}}{(\sum_k^m y_k )} 
= \frac{y_i y_j x}{(\sum_k^m y_k )(\sum_k^m y_k + x)}\]
%\[ \includegraphics[scale=0.04]{diag/Last2.png} \]

Combining the parallel edges, 
\begin{align*}
Y_{ij}^a + Y_{ij}^{ab} &= \frac{y_i y_j}{\sum_k^m y_k + x} + \frac{y_i y_j x}{(\sum_k^m y_k)(\sum_k^m y_k + x)} \\ 
&= \frac{y_i y_j (\sum_k^m y_k) + y_i y_j x}{(\sum_k^m y_k)(\sum_k^m y_k + x)} \\ 
&= \frac{y_i y_j(\sum_k^m y_k+x)}{(\sum_k^m y_k)(\sum_k^m y_k + x)} \\ 
& = \frac{y_i y_j}{(\sum_k^m y_k)} = Y_{ij}^{ba}
\end{align*}

Thus the two orders of rewriting the circuit in diagram (a) produce equivalent results.
\end{proof}

\begin{lemma}
\label{Lemma: star-star rewrite}
The star-mesh critical pairs in ${\sf Resist}_R$ can be resolved.
% By definition all the sar arms must be non-zero!
\end{lemma}

\begin{proof} 

Consider the circuit shown below. We must show that eliminating node $a$ first by applying $(Y/\Delta)_{m+1}$ and then node $b$ by applying $(Y/\Delta)_{n+m}$ yields same result as eliminating node $b$ first by applying $(Y/\Delta)_{n+1}$ and then node $a$ by applying $(Y/\Delta)_{n+m}$. 

\[ \includegraphics[scale=0.05]{diag/Confluence_2.png}\]

Note that, in order to rewrite a star network all its arms must have non-zero conductances (these would result in an open circuit) nor can there be any infinite conductances (these would be a bare wire).

We first develop a general algorithm for the naming new edges resulting from each rewrite of the circuit. The algorithm is as follows:

{\bf Algorithm for labelling edges:} 
\begin{enumerate}
\item At each step, the new edges always carry the names of the eliminated nodes as superscript in the order of their elimination. 
\item The subscripts (in general) refer to the index of resistors being combined -- $Y_{ij}^a$ is given by combining $y_i$ and $y_j$ by eliminating $a$ with $i \leq j$; combining the edges $Y_{ix}^a$ and $Y_{jx}^a$ by eliminating $b$ gives $Y_{ij}^{ab}$; $Y_{ix}^a$ is given by combining the edge $y_i$ with $x$ eliminating node $a$. 
\item Whenever only `$y_i$' resistors are combined create to a new edge, the new edge carries label `Y' with appropriate super and subscripts; label `$\phi$' means a $y$ and a $u$ resistor are combined; label `$U$' means only $u$ resistors have been combined. 
\end{enumerate}

To make the naming procedure clear, we consider a simple case shown in Figure \ref{fig:confluence example}:

\begin{figure}[h]
    \centering
    \includegraphics[scale=0.05]{diag/Confluence_3.png}
    \caption{Node $a$ and node $b$ connected by resistor $x$}
    \label{fig:confluence example}
\end{figure} 
\FloatBarrier 

Two possible ways of reducing the circuit in Figure \ref{fig:confluence example} are shown below: 

Eliminate internal node $a$ followed by internal node $b$:
\[ \vcenteredinclude{scale=0.04}{diag/Confluence_3.png} \xRightarrow{(Y/\Delta)_3}
   \vcenteredinclude{scale=0.08}{diag/Step1a.png} \xRightarrow{(Y/\Delta)_4}
   \vcenteredinclude{scale=0.09}{diag/Step2a.png} \xRightarrow{\sf[Parallel]}
   \vcenteredinclude{scale=0.09}{diag/Step3a.png} \]

Eliminate internal node $b$ followed by internal node $a$:
\[ \vcenteredinclude{scale=0.04}{diag/Confluence_3.png} \xRightarrow{(Y/\Delta)_3} %\stackrel{(Y/\Delta)_3}{\xRightarrow} 
   \vcenteredinclude{scale=0.08}{diag/Step1b.png} \xRightarrow{(Y/\Delta)_4}
   \vcenteredinclude{scale=0.09}{diag/Step2b.png} \xRightarrow{\sf[Parallel]}{\Rightarrow}
   \vcenteredinclude{scale=0.09}{diag/Step3b.png} \]

The two ways of reducing the circuit are equal if:
    \begin{align*}
    \text{for } 1 \leq i,j \leq 2, ~~~  \phi^{ab}_{ij} &= \phi^{ba}_{ij}  \\
    \text{for } 1 \leq i,j \leq 2,~~~     U^{ab}_{ij} &= U^{b+ba}_{ij} \\
    \text{for } 1 \leq i,j \leq 2,~~~    Y^{a+ab}_{ij} &= Y^{ba}_{ij}  
    \end{align*}

Following this approach, the two ways of reducing the general circuit (given in the beginning of this proof) are equal if:
   \begin{align}
    \label{eqn: confluence-1}
    \text{for } 1 \leq i \leq m, ~~~ 1 \leq j \leq n ~~~   \phi^{ab}_{ij} &= \phi^{ba}_{ij}  \\
    \label{eqn: confluence-3}
    \text{for } 1 \leq i,j \leq n ~~~     U^{ab}_{ij} &= U^{b+ba}_{ij} \\
    \label{eqn: confluence-2}
    \text{for } 1 \leq i,j \leq m ~~~    Y^{a+ab}_{ij} &= Y^{ba}_{ij}  
    \end{align}
where,

\begin{minipage}[b]{0.45\textwidth} % 3rd set of equations
    \begin{align*}
    \text{for } 1 \leq i,j \leq m, ~~~ Y^{a+ab}_{ij} &= Y^{a}_{ij}+Y^{ab}_{ij}
    \end{align*}
\end{minipage} \hfill
\begin{minipage}[b]{0.45\textwidth}
    \begin{align*}
     \text{for } 1 \leq i,j \leq n, ~~~ U^{ba+a}_{ij} &= U^{b}_{ij}+U^{ba}_{ij} 
    \end{align*}
\end{minipage}
\begin{align*} %2nd set of equations
\text{for } 1 \leq i \leq m ~\text{ and }~ 1 \leq j \leq n, ~~~~~  
\phi^{ab}_{ij} &= \frac{Y^{a}_{ix}u_{j}}{\sum_{k}^{n}u_{k}+\sum_{k}^m Y^{a}_{kx}} \\
\text{for } 1 \leq i \leq m ~\text{ and }~ 1 \leq j \leq n, ~~~~~
{\phi}_{ij}^{ba} &= \frac{y^{b}_{i} U^{b}_{jx}}{\sum_{k}^m y_{k}+\sum_{k}^{n}U^{b}_{kx}} 
\end{align*}
\begin{minipage}[b]{0.45\textwidth} %1st set of equations
    \begin{align*}
     \text{for } 1 \leq i,j \leq m, ~~~ Y^{ab}_{ij} 
     &= \frac{Y^{a}_{ix}Y^{a}_{jx}}{\sum_{k}^{n}u_{k}+\sum_{k}^m Y^{a}_{kx}} \\ 
     \text{for } 1 \leq i,j \leq n, ~~~ U^{ab}_{ij} 
     &= \frac{u_{i}u_{j}}{\sum_{k}^{n} u_{k}+\sum_{k}^m Y^{a}_{kx}}  \\ 
         \text{for } 1 \leq i,j \leq m, ~~~ Y^{a}_{ij} &= \frac{y_{i}y_{j}}{\sum_{k}^m y_{k}+x} \\
     \text{for } 1 \leq i \leq m, ~~~ Y^{a}_{ix} &= \frac{y_{i}x}{\sum_{k}^m y_{k}+x} 
    \end{align*}
\end{minipage} \hfill
\begin{minipage}[b]{0.45\textwidth}
    \begin{align*}
    \text{for } 1 \leq i,j \leq n, ~~~ U_{ij}^{ba} 
    &= \frac{U_{ix}^b U_{jx}^b}{\sum_{k}^m y_{k}+\sum_{k}^{n}U^{b}_{kx}} \\ 
    \text{for } 1 \leq i,j \leq m, ~~~ Y^{ba}_{ij} 
    &= \frac{y^{a}_{i} y^{a}_{j}}{\sum_{k}^m y_{k}+\sum_{k}^{n}U^{b}_{kx}} \\
    \text{for } 1 \leq i,j \leq n, ~~~ U^{b}_{ij} &= \frac{u_{i}u_{j}}{\sum_{k}^{n}u_{k}+x} \\
    \text{for } 1 \leq i \leq n, ~~~  U^{b}_{ix} &= \frac{u_{i}x}{\sum_{k}^{n}u_{k}+x} 
  \end{align*}
\end{minipage} 
\FloatBarrier

\vspace{1em}

Now, proving \ref{eqn: confluence-1}, $\phi_{ij}^{ab} = \phi_{ij}^{ba}$:
\begin{align*}
\phi^{ab}_{ij} 
&= \frac{ \frac{y_{i}x}{\sum_{k}^m y_{k}+x} u_{j}}{\sum_{k}^{n}u_{k}+\sum_{k}^m \frac{y_{k}x}{y_{k}+x}} 
=  \frac{ y_{i} x u_{j}}{(\sum_{k}^{n}u_{k})(\sum_{k}^m y_{k}+x) +\sum_{k}^m y_{k}x} \\
&=  \frac{ y_{i} x u_{j}}{(\sum_{k}^m y_{k})(\sum_{k}^{n}u_{k}) + \sum_{k}^{n}u_{k}x 
+ \sum_{k}^m y_{k}x } 
=  \frac{ y_{i} x u_{j}}{ \sum_{k}^{n} u_{k} x
+ \sum_{k}^m y_{k}( \sum_{k}^{n}u_{k} + x) } \\
&= \frac{ \frac{y_{i} x u_{j}}{\sum_{k}^{n}u_{k} + x} }{\frac{\sum_{k}^{n} u_{k} x}{\sum_{k}^{n}u_{k} + x} 
+ \sum_{k}^m y_{k} } 
= \frac{ y_{i} U_{jx}^b }{\sum_{k}^{n} U_{kx}^b
+ \sum_{k}^m y_{k} } = \phi_{ij}^{ba}
\end{align*}

Now, proving \ref{eqn: confluence-3}, $U_{ij}^{ab} = U_{ij}^{b+ba}$:

\begin{align}
\label{eqn: LHS}
U^{ab}_{ij} &= \frac{u_{i}{u_j}}{\sum_{k}^{n} u_k + \sum_k^m Y_{kx}^a} = 
\frac{u_{i}u_j}{\sum_{k}^{n} u_k + \frac{\sum_k^m Y_{k}x}{\sum_k^m y_k +x}} = 
\frac{u_{i}u_{j}}{\sum_{k}^{n} u_k ({\sum_k^m y_k +x}) + \sum_k^m Y_{k}x}  \notag \\ 
& \stackrel{(*)}{=} \frac{u_{i}u_{j}}{\sum_k^m y_k ({\sum_{k}^{n} u_k +x}) + \sum_{k}^{n} u_{k}x} 
= \frac{\frac{u_i u_j}{\sum_{k}^{n} u_k + x}(\sum_k^m y_k+x)}
{\sum_k^m y_k  + \frac{\sum_{k}^{n} u_k x}{ \sum_{k}^{n} u_k +x}} 
\end{align}

For step $(*)$, see computation of denominator in the proof of \ref{eqn: confluence-1}, $\phi_{ij}^{ab} = \phi_{ij}^{ba}$.

\begin{align}
\label{eqn: RHS}
    U^{b + ba}_{ij} =  U_{ij}^b + U_{ij}^{ba} 
    &= \frac{u_i u_j}{\sum_{k}^{n} u_k + x} + \frac{\frac{u_i u_j x^2}{(\sum_k^n u_k + x)^2}}{\sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{\sum_{k}^{n} u_k + x}} 
    = \frac{u_i u_j\left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{\sum_{k}^{n} u_k + x}  \right) + \left( \frac{u_i u_j x^2}{\sum_k^n u_k + x}  \right)}{\left(\sum_{k}^{n} u_k + x \right)\left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{ \sum_k^m y_k + x} \right)} \notag \\ 
    &= \frac{u_i u_j\left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{\sum_{k}^{n} u_k + x}   
    +  \frac{x^2}{\sum_{k}^{n} u_k + x}  \right)}
    {\left(\sum_{k}^{n} u_k + x \right)
    \left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{ \sum_{k}^{n} u_k + x} \right)} 
   = \frac{\frac{u_i u_j}{\sum_{k}^{n} u_k + x } 
    \left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}
    {\sum_{k}^{n} u_k + x} +  \frac{x^2}{\sum_{k}^{n} u_k + x} \right) }
    {\left( \sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{ \sum_{k}^{n} u_k + x} \right)} 
\end{align}

The denominators of equations \ref{eqn: LHS} and \ref{eqn: RHS} are the same. Hence, multiplying the numerators of these equations by $\frac{\sum_{k}^{n} u_k + x }{u_i u_j}$ , it suffices to prove that: 
\begin{align} 
\sum_k^m y_k + \frac{\sum_{k}^{n} u_k x}{\sum_{k}^{n} u_k + x} +  \frac{x^2}{\sum_{k}^{n} u_k + x} = \sum_k^m y_k + x \left( 
\frac{\sum_{k}^{n} u_k + x}{\sum_{k}^{n} u_k + x} \right) = \sum_k^m y_k + x
\end{align}

The proof for equation \ref{eqn: confluence-2} is analogous. 

\end{proof}

\section{Discussion}
In this paper we have provided a normal form for resistor networks over a positive division rig and, thereby, a decision procedure for equality of resistor circuits (given decidability of equality for the rig).  Even though modest, as far as we know, ours is the first such result in the literature.

Of course, our motivation came from the difficulty of working with the exisiting ``normal forms'' for stabilizer circuits 
\cite{backens2016completeness}. As pointed out by Kissinger in \cite{kissinger2022phase}, these normal forms for stabilizer circuits are hard to work with and ``almost a decade after completeness was proven for the stabiliser fragment of the ZX calculus, new ideas are still needed".  Based on the recently established connection between quantum and electrical circuits \cite{comfort2021graphical, cockett2022categories}, our thought was that, studying simpler cases such as resistor circuits might provide new insights into normal forms for stabilizer circuits.

An interesting and a more challenging question is whether the results in this paper can be generalized to arbitrary division rigs so as to cover the ``resistor'' case arising from qudit stabilizer quantum mechanics. As has been mentioned, to apply these ideas to stabilizer circuits a necessary step is to generalize these results to division rigs and so, in particular, to finite fields.  The technical difficulty of applying these ideas verbatim is the question of how one handles zeros and divisions by zero. 

An example of this difficulty over a finite field, arises when resolving the critical pair $(Y/\Delta)_1$ with 
$(Y/\Delta)_n$ (for $n \geq 3$)  (essentially Lemma \ref{Lemma: unit-star rewrite} above).  The rewriting of the $n$-star 
to an $n$-mesh can involve a division by zero (when $\sum_{i = 1}^n y_i = 0$): it is tempting to think that this should be 
interpreted as giving ``infinite conductances'' in the mesh.  However, removing a point of the star using $(Y/\Delta)_1$ 
will also remove the division by zero in the subsequent $(Y/\Delta)_{n-1}$ rewriting showing such an interpretation is not 
valid.  

The point is that for finite fields and division rings the star/mesh transformations are only valid when the sum of the 
conductances of the star is non-zero.   This, of course complicates the rewriting story and also reopens the question what 
a convenient presentation of resistor circuits over finite fields and division rigs might be!  Resolving these issues 
requires further spade work! 
 
A surprisingly basic -- and as far as we know open -- question which arises from this work concerns whether there is a finite presentation of ${\sf Resist}_R$ in terms of generators and relation. In order to provide a presentation for ${\sf Resist}_R$, we assume an infinite family of star-mesh identities, $(Y/\Delta)_n$, for each $n \in \mathbb{N}$.  While we have shown that this infinite set of identities completely characterize equality between circuits, it is an open question whether there is a finite presentation of the category. We conjecture there is not.

\newpage

\bibliographystyle{eptcs}
\bibliography{resistor}

\end{document}


Recent works in categorical quantum mechanics and graphical affine algebra show that electrical circuits and quantum stabilizer circuits are intimately connected. Comfort and Kissinger showed that affine Lagrangian relations are isomorphic to qudit stabilizer circuits of odd prime dimensions\cite{comfort2021graphical}. Cockett et al. in \cite{cockett2022categories} further extracted a current-conserving subcategory called Kirchhoff relations. The generators of Kirchhoff relations have one-to-one correspondence with elements of an electrical circuit (junctions, resistors, voltage and current sources). They further gave normal forms for Kirchhoff relations and its subcategories using parity-check matrices. These parity-check matrices arise in quantum error correction thereby suggesting a formal connection between graph states and resistor networks. The structure of parity check matrices arising from resistor networks and graph states are exactly the same. Furthermore there is a connection between graph states with extra wires (``generalized graph states") and resistor networks with arbitrary number of inputs and outputs. 

Graph states and graph states with local Clifford operations naturally arise in the study of normal form for stabilizer circuits \cite{backens2016completeness}. As pointed out by Kissinger in \cite{kissinger2022phase}, these normal forms for stabilizer circuits are hard to work with and ``almost a decade after completeness was proven for the stabiliser fragment of the ZX calculus, new ideas are still needed". In this work we take a first step towards using this newly discovered connection between graph states and resistor networks as an approach towards studying normal forms for stabilizer circuits. A major motivation to study this approach is that its inherently compositional, whereas the graph state structure does not lend itself to a complete categorical characterization.



\subsection{Further remarks}
A  reasonable question to ask is whether the category we have presented using the family of $(Y/\Delta)_n$ rules is really the This is true because the validity of the rules is well known \cite{stardelta} which implies a functor into the 
category ${\sf ResRel}$ described in \cite{cockett2022categories}. The category ${\sf ResRel}$, on the other hand, is precisely the category of resistances as described in Graphical Linear Algebra (GLA)  \cite{Bonchi2019GraphicalAA, zanasi} and can also be tracked back to the category described in \cite{baez2015compositional}. 
Furthermore, the normal form of the resistor circuits of ${\sf Resist}_R$ as developed here
translates immediately into the special form of the parity matrices of ${\sf ResRel}$. This shows that the functor from ${\sf Resist}_R$ to ${\sf ResRel}$ (which is already bijective on objects), is full and faithful. Hence it is an isomorphism of categories.  So this stacks up the evidence that ${\sf Resist}_R$ is indeed the category of resistors!

A further question is whether, when one adds other electrical elements and still obtain corresponding normal forms? In particular, adding current sources and voltage sources pushes one into affine algebra.  Can one still normalize these circuits?  we conjecture the answer is still yes  based on the well known Thevenin and Norton's theorems! An interpretation of these theorems in-terms of stabilizer circuits is a further open question.


%However, an interesting question and a more challenging question is whether this result can be generalized to arbitrary division rigs so as to cover the ``resistor'' case arising from qudit stabilizer quantum mechanics. Another surprisingly basic -- and as far as we know open -- question which arises from this work concerns whether there is a finite presentation of ${\sf Resist}$ in terms of generators and relation. 

We have chosen to do our calculations using conductances rather than impedances (or resistances) in an attempt to simplify the calculations. However, the calculation in its impedance form may also provide some advantages as there is then only one case in which division by a sum occurs and that is in the parallel rewrite.  Thus for a division rig there is only one place where a possible division by zero occurs.  Unfortunately, this does not quite suffice to allow the generalization to arbitrary division rigs, an issue which we leave to future work!
 
Recall that, in order to provide a presentation for ${\sf Resist}_R$, we assume here an infinite family of star mesh identities, $(Y/\Delta)_n$, for each $n \in \mathbb{N}$.  While we can show that this infinite set of identities completely characterize equality between circuits, it is -- as far as we know -- an open question (as mentioned above) whether there is a finite presentation of the category. We conjecture there is not.

The conductance values of the edges after each rewrite in Figure \ref{Fig: elim a first} is as follows:

After eliminating node $a$:
\[ Y^{a}_{ij}=\frac{y_{i}y_{j}}{\sum_{i}y_{i}+x} \quad \quad \quad
Y^{a}_{ix}=\frac{y_{i}x}{\sum_{i}y_{i}+x} \]

After eliminating node $b$:
\[ Y^{b}_{ij}=\frac{Y^{a}_{ix}Y^{a}_{jx}}{\sum_{i}u_{i}+\sum_{k}Y^{a}_{kx}} \quad \quad
\phi^{ab}_{ij}=\frac{Y^{a}_{ix}u_{j}}{\sum_{i}u_{i}+\sum_{k}Y^{a}_{kx}} \quad \quad
U^{ab}_{ij}=\frac{u_{i}u_{j}}{\sum_{i}u_{i}+\sum_{k}Y^{a}_{kx}} \]
After combining parallel edges: 
\begin{align}
Y^{a+ab}_{ij}=Y^{a}_{ij}+Y^{ab}_{ij}
\end{align}


The conductance values of the edges after each rewrite in Figure \ref{Fig: elim b first} is as follows:

After eliminating node $b$:
\[ U^{b}_{ij} = \frac{u_{i}u_{j}}{\sum_{i}u_{i}+x} \quad \quad \quad
U^{b}_{ix} = \frac{u_{i}x}{\sum_{i}u_{i}+x} \]

After eliminating node $a$:
\[ U_{ij}^a = \frac{U_{ix}^b U_{jx}^b}{\sum_{i}y_{i}+\sum_{k}u^{b}_{kx}} \quad \quad
{\phi}_{ij}^{ba} = \frac{y^{b}_{i} U^{b}_{jx}}{\sum_{i}y_{i}+\sum_{k}u^{b}_{kx}} \quad \quad
Y^{ba}_{ij} = \frac{y^{b}_{i}y^{b}_{j}}{\sum_{i}y_{i}+\sum_{k}u^{b}_{kx}} \]

After combining parallel edges:
\[ U^{b+ba}_{ij} = U^{b}_{ij}+U^{ba}_{ij}  \]

\begin{figure}[!h]
    \begin{minipage}[b]{.22\linewidth}
        \centering
        \includegraphics[scale=0.04]{diag/Confluence_3.png}
        {\caption*{\em Eliminating node $a$ $\Rightarrow$}} 
            \end{minipage}% 
    \begin{minipage}[b]{.22\linewidth}
        \centering
        \includegraphics[scale=0.07]{diag/Step1a.png}
        {\caption*{\em Eliminating node $a$ $\Rightarrow$}}
            \end{minipage}%
    \begin{minipage}[b]{.22\linewidth}
        \centering
        \includegraphics[scale=0.09]{diag/Step2a.png}
        {\caption*{\em Eliminating node $b$ $\Rightarrow$}}
    \end{minipage} 
    \begin{minipage}[b]{.22\linewidth}
        \centering
        \includegraphics[scale=0.09]{diag/Step3a.png}
        {\caption*{\em Combining parallel edges}}
    \end{minipage} 
    \caption{ {\bf Eliminate internal node $a$ followed by internal node $b$} }
    \label{Fig: elim a first}
\end{figure}