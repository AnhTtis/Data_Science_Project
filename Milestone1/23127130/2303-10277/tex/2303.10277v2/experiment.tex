Experiments are designed to show that 1. the prerequisite of the method can be easily achieved; 2. the method ensures persistent feasibility for high dimensional systems; 3. the synthesized safety index can be transferred to systems with different dynamics.


The robot's task is to reach a goal while avoiding collision with obstacles or humans. We consider a collision avoidance constraint $\phi_0 = d_{min} - d$, where $d_{min}=0.05$ and $d$ is the relative distance.
Our methods are tested on a 7 degrees-of-freedom (DoF) Franka Panda robot arm in Panda3D simulation with a 1.5GHz AMD EPYC 7H12 64-Core Processor, and a 7 DoF FANUC LR Mate 200i real robot.

\subsection{Distribution of $M$ and $\dot M$}

We first show the distribution of $M$ and $\dot M$ in \cref{fig:distribution}. It reveals that $M$ is always above $0$, very few states have a small range, and Therefore, the extended abstraction greatly reduced conservativeness.
Most states have a small $\dot M$ which eases finding feasible safe control. It takes 14 hours to sample 100000 $\dot M$ and estimate $\dot M_{*}$.
\Cref{fig:poses} shows the corresponding poses for $\hat M_{max}$ $\hat M_{min}$ and $\hat{\dot M}_*$. We can see that these poses usually corresponds to singular states, such as fully extended. Therefore, users may accelerate the system property verification by starting from these poses.


\begin{figure}[tbh]
     \centering
     \begin{subfigure}[b]{0.48\linewidth}
         \centering
         \includegraphics[width=\textwidth]{img/M_dist.pdf}
         \caption{$M$ distribution. \vspace{-2mm}}
         \label{fig:M-dist}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.48\linewidth}
         \centering
         \includegraphics[width=\textwidth]{img/dot_M_dist.pdf}
         \caption{$\dot M$ distribution. \vspace{-2mm}}
         \label{fig:dot-M-dist}
     \end{subfigure}
    \caption{Distribution of $M$ and $\dot M$. \vspace{-4mm}}
    \label{fig:distribution}
\end{figure}

\begin{figure}[tbh]
     \centering
     \begin{subfigure}[b]{0.35\linewidth}
         \centering
         \includegraphics[height=1.5cm]{img/M_min_pose.png}
         \caption{$\hat M_{min}$ pose\vspace{-2mm}}
         \label{fig:M-min}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.3\linewidth}
         \centering
         \includegraphics[height=1.5cm]{img/M_max_pose.png}
         \caption{$\hat M_{max}$ pose\vspace{-2mm}}
         \label{fig:M-max}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.25\linewidth}
         \centering
         \includegraphics[height=1.5cm]{img/dot_M_max_pose.png}
         \caption{$\hat{\dot M}_*$ pose\vspace{-2mm}}
         \label{fig:dot-M-max}
     \end{subfigure}
    \caption{Poses for $\hat M_{max}$ $\hat M_{min}$ and $\hat{\dot M}_*$. \vspace{-4mm}}
    \label{fig:poses}
\end{figure}


\subsection{Persistent Feasibility}

The safety index is designed as the following form:
\begin{align}
    \phi = \max(\phi_0, \phi^*),\ \text{where }
    \phi^* = d_{min}^2-d^2-k\dot{d}/M.
\end{align}
%%% Experiment details added by Shucheng Kang
The persistent feasibility of $\phi$ can be guaranteed by the persistent feasibility of $\phi^*$ as shown in~\cite{liu2014control}. Therefore, we can use system abstraction to directly determine the value of $k$ that guarantees feasibility of $\phi^*$ and $\phi$. Assuming $d\in [0.0, 0.8] m$ and $\dot{d}\in [-1.0, 1.0] m/s$: 
% The derivation details are provided in the Appendix. 
$\forall (d, \dot{d}, M)$, s.t. $\phi^*=0$, there exists $\ddot{d}\in \left[ -M,M \right]$ such that:  
\begin{align}
    \dot{\phi}^* &= -2d\dot{d}-k\frac{\ddot{d}}{M}+k\frac{\dot{d}}{M^2}\dot{M} \\
    &\le -2d\dot{d}-k\frac{\ddot{d}}{M}+\mid \dot{d}\mid \frac{k}{M^2}\dot{M}_{\max}\le 0
\end{align}
We let $\ddot{d}=M$, then $k\ge -2d\dot{d}+ k|\dot{d}| \dot{M}_{\max} /M^2$.
% \begin{align}
%     k\ge -2d\dot{d}+\mid \dot{d}\mid \frac{k}{M^2}\dot{M}_{\max}
% \end{align}
Since $\phi^*=0$, we have $k=M(d_{min}^{2}-d^2)/\dot{d}$ and 
\begin{align}
    k &\ge -2d\dot{d}+\frac{\mid \dot{d}\mid}{\dot{d}}\left( d_{min}^{2}-d^2 \right) \cdot \frac{\dot{M}_{\max}}{M} \\
    &\ge 2\mid d\dot{d}\mid _{\max}+\mid d_{min}^{2}-d^2\mid _{\max}\cdot \frac{\dot{M}_{\max}}{M_{\min}}
\end{align}
which implies $k \ge 133.31$. Based on \cref{lem:sampling}, we can guarantee that at least $99.99\%$ states are feasible with the probability $99.99\%$.
As shown in Table \ref{tab:results}, this value of $k$ ensures no collisions in 100 randomly generated goal-obstacle pairs. 
% Additionally, since the space is small, we can also use neural networks to represent the safety index and verify its feasibility numerically \cite{wei2021safe}. 
In contrast, it is too complex to derive the analytical condition for the concrete system, which has hundreds of terms with nonlinear transformations such as trigonometric functions and multiplication.
The exponential time complexity of numerical methods also makes it infeasible to check feasibility. For example, for a 7 degree-of-freedom robot arm, even with only 10 samples per dimension, it would require checking $10^{14}$ samples.
%%%

\begin{table}[tb]
    \caption{Collision count in 100 randomly generated scenarios and dynamics sensitivity to DoF and End Effectors. \vspace{-5mm}}
    \centering
    \small
    \begin{tabular}{cccc}
        \toprule
        Case         & Collision & Range of $M$         & $\dot M_{*}$ \\
        \midrule
        5 DoF + EE 1 & 0         & {[1.67, 114.37]} & 1052.93       \\
        6 DoF + EE 1 & 0         & {[3.26, 121.34]} & 891.80         \\
        7 DoF + EE 1 & 0         & {[4.13, 127.32]} & 847.42         \\
        7 DoF + EE 2 & 0         & {[4.53, 120.19]} & 710.97         \\
        7 DoF + EE 3 & 0         & {[3.82, 131.55]} & 856.18         \\
        \bottomrule
        \end{tabular}\label{tab:results}
\end{table}


\subsection{Transplant to other systems}

%%% Experiment details added by Shucheng Kang
In this experiment, we change robot's degree-of-freedoms (DoF) and end-effectors (EE) to discuss when the safety index can be directly transferred to other systems. EE 1 is the baseline. In EE 2, a $0.1kg$-rod is attached to the end-effector. In EE 3, the offset of the seventh joint has a 0.05m increment in y-axis. In 6 DOF robot, the seventh joint is fixed. In the 5 DOF robot, both the sixth and seventh joints are fixed. As shown in \cref{tab:results}, $\dot M_{*}$ decreases when the DoF increases, and the range of $M$ does not change too much with the dynamics. We can conclude that if we consider a small enough of $M_{min}$ and a large enough $\dot M_{*}$ during the design of the safety index, the same safety index can ensure safety for a wide range of unseen systems. This method is particularly useful for robot arms with real-time tool switching.
%%%

\subsection{Experiment on real robots}

We also test the method on a real FANUC LR Mate 200i robot with two different tools: a drill and a bat. These two tools have different shapes and different kinematics. The relative distance/velocity is estimated by detecting the human skeleton with a Kinect Camera in real time. Our method significantly reduces conservativeness when the tool is unknown. As shown in \cref{fig:FANUC_exp}, to ensure safety during tool use, the baseline method constructs a large sphere space that covers all possible tools. However, this method leads to conservative interaction with humans. But with our method, we can consider the nearest point from the robot to the human because the nearest points can be viewed as different end effectors that our safety index can be directly transplanted. Therefore  we can provide safety guarantees for both tools while remaining non-conservative, the profiles of $\phi_0$ are shown in \cref{fig:FANUC_profile}. 

\begin{figure}
    \centering
    % \includegraphics[width=\linewidth]{img/fanuc_exp_hor.pdf}
    \includegraphics[width=.8\linewidth]{img/fanuc_exp.pdf}
    \caption{Experiments on FANUC with two different tools. The baseline method ensures safety by considering a large sphere that contains all possible tools. But our method can guarantee safety by considering the nearest point from the tool to the human, which is much less conservative than the baseline.}
    \label{fig:FANUC_exp}
\end{figure}

\begin{figure}[htb]
\centering
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{img/Stick-Baseline.pdf}
% \caption{Figure 1}
\end{subfigure}
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{img/Stick-Abstract_Safe_Control.pdf}
% \caption{Figure 2}
\end{subfigure}
\par\medskip
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{img/Drill-Baseline.pdf}
% \caption{Figure 3}
\end{subfigure}
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{img/Drill-Abstract_Safe_Control.pdf}
% \caption{Figure 4}
\end{subfigure}
\caption{$\phi_0$ profiles ($-d$). Our abstract safe control method is much less conservative, allowing a closer distance to the human while maintaining safety. The interaction sessions are shaded in yellow. \vspace{-5mm}}
\label{fig:FANUC_profile}
\end{figure}