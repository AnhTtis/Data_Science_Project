\tikzmath{%
    \colone = 0;
    \coltwo = 5;
    \yoffset = 1;
    \yshiftrule = 0;
}

\begin{tikzpicture}%[background rectangle/.style={fill=plotgrey}, show background rectangle]
    \coordinate (label0l) at (\colone - 3/4, -4 * \yoffset);
    \coordinate (left0l) at (\colone, -4 * \yoffset);
    \coordinate (right0l) at (\colone + 1.5, -4 * \yoffset);
    \coordinate (label0r) at (\coltwo - 3/4, -4 * \yoffset);
    \coordinate (left0r) at (\coltwo, -4 * \yoffset);
    \coordinate (right0r) at (\coltwo + 1.5, -4 * \yoffset);
    \coordinate (arrow0) at (\colone + 4, -4 * \yoffset);

    % rule0
    \begin{scope}[scale=1]
        \begin{scope}[scale=1/2, shift={(left0l)}, local bounding box]
            % \node [] at (label0l) () {\({\times 2}\)};
            \node [lhs] at (0, 0) (lhsl) {\scriptsize 2};
            \node [blank] at (right0l) (rhsl) {};
            \draw [->, edge] (lhsl) -- (rhsl);
        \end{scope}
        \begin{scope}[scale=1/2, shift={(right0l)}]
            \node [node] at (0.75, \yshiftrule + 0) (rhsl0) {};
            \node [node] at (1.85, \yshiftrule + 0.649519) (rhsl1) {};
            \node [node] at (1.85, \yshiftrule + -0.649519) (rhsl2) {};
            \node [node] at (2.95, \yshiftrule + 0) (rhsl3) {};
            \draw [edge] (rhsl0) -- (rhsl2);
            \draw [edge] (rhsl1) -- (rhsl2);
            \draw [edge] (rhsl1) -- (rhsl3);

            \draw [edge] (rhsl0) -- (0.2196699, 0.53033);
            \draw [edge] (rhsl0) -- (0.2196699, -0.53033);
        \end{scope}
    \end{scope}
    \node [] at (arrow0) () {$\implies$};
    \begin{scope}[scale=1]
        \begin{scope}[scale=1/2, shift={(left0r)}]
            \node [text opacity=1] at (label0r) () {};
            \node [addlhs] at (0, 0) (lhsr) {\scriptsize 3};
            \node [blank] at (right0r) (rhsr) {};
            \draw [->, edge] (lhsr) -- (rhsr);
        \end{scope}
        \begin{scope}[scale=1/2, shift={(right0r)}]
            \node [node] at (0.75, \yshiftrule + 0) (rhsr0) {};
            \node [node] at (1.85, \yshiftrule + 0.649519) (rhsr1) {};
            \node [node] at (1.85, \yshiftrule + -0.649519) (rhsr2) {};
            \node [delnode] at (2.95, \yshiftrule + 0) (rhsr3) {};
            \draw [edge] (rhsr0) -- (rhsr2);
            \draw [edge] (rhsr1) -- (rhsr2);
            \draw [addedge] (rhsr0) -- (rhsr1);
            \draw [deledge] (rhsr1) -- (rhsr3);

            \draw [addedge] (rhsr0) -- (-0.05, 0.0);
            \draw [edge] (rhsr0) -- (0.2196699, 0.53033);
            \draw [edge] (rhsr0) -- (0.2196699, -0.53033);
        \end{scope}
        \begin{pgfonlayer}{background} 
            \coordinate (lsw) at ([shift={(-0.575, -0.575)}]current bounding box.south west);
            \coordinate (lne) at ([shift={(0.575 - 5, 0.575)}]current bounding box.north east);
            \coordinate (rsw) at ([shift={(-0.575 + 5, -0.575)}]current bounding box.south west);
            \coordinate (rne) at ([shift={(0.575, 0.575)}]current bounding box.north east);

            \draw[draw=plotgrey, fill=plotgrey, opacity=0.75] (lsw) rectangle (lne);
            \draw[draw=plotgrey, fill=plotgrey, opacity=0.75] (rsw) rectangle (rne);
        \end{pgfonlayer}
        \node [] at ([shift={(0.0, -1.3)}]right0l) (note0l) {Timestep $t$};
        \node [] at ([shift={(0.0, -0.65)}]lhsl) (note1l) {LHS};
        \node [] at ([shift={(0.875, -0.65)}]rhsl) (note2l) {RHS};
        \node [scale=0.9, font=\scriptsize, align=center] at ([shift={(0.0, 0.575)}]lhsl) (note3l) {Non-\\[-0.5ex]terminal\\[-0.5ex]node};
        \node [scale=0.9, font=\scriptsize, align=center] at ([shift={(0.0, 0.375)}]rhsl1) (note4l) {Terminal\\[-0.5ex]node};
        \node [scale=0.9, font=\scriptsize, align=center] at ([shift={(-0.6, -0.75)}]rhsl0) (note5l) {Boundary\\[-0.5ex]edges};

        \node [] at ([shift={(0.0, -1.3)}]right0r) (note0r) {Timestep $t + 1$};
        \node [] at ([shift={(0.0, -0.65)}]lhsr) (note1r) {LHS};
        \node [] at ([shift={(0.875, -0.65)}]rhsr) (note2r) {RHS};
        % \node [scale=0.9, font=\scriptsize, align=center, text=plotteal] at ([shift={(0.0, 0.5)}]lhsr) (note3r) {Boundary\\[-0.5ex]increase};
        \node [scale=0.9, font=\scriptsize, align=center, text=plotteal] at ([shift={(-0.5, 0.65)}]rhsr0) (note4r) {Edge\\[-0.5ex]additions};
        \node [scale=0.9, font=\scriptsize, align=center, text=plotorange] at ([shift={(0.1, 0.65)}]rhsr3) (note5r) {Edge\\[-0.5ex]deletion};
        \node [scale=0.9, font=\scriptsize, align=center, text=plotorange] at ([shift={(0.2, -0.75)}]rhsr3) (note6r) {Node\\[-0.5ex]deletion};

        \coordinate (nts) at ([shift={(-0.215, 0.0)}]lhsl);
        \coordinate (ts) at ([shift={(0.1, 0.2)}]rhsl3);
        \coordinate (bdry1) at ([shift={(-0.25, 0.1)}]rhsl0);
        \coordinate (bdry2) at ([shift={(-0.1, -0.25)}]rhsl0);

        \coordinate (addededge1) at ([shift={(0.2, 0.2)}]rhsr0);
        \coordinate (addededge2) at ([shift={(-0.35, 0.1)}]rhsr0);

        \coordinate (deletededge) at ([shift={(-0.2, 0.2)}]rhsr3);
        \coordinate (deletednode) at ([shift={(0.08, -0.15)}]rhsr3);

        \path [-to, bend right=30] ([shift={(0.2, 0.0)}]note3l.south west) edge (nts);
        \path [-to, bend left=45] ([shift={(-0.1, -0.1)}]note4l.east) edge (ts);
        \path [-to, bend left=45] ([shift={(0.0, 0.0)}]note5l.north) edge (bdry1);
        \path [-to, bend right=10] ([shift={(-0.15, 0.0)}]note5l.north east) edge (bdry2);
        \draw [->, draw=plotteal] ([shift={(-0.25, 0.0)}]note4r.south east) -> (addededge1);
        \draw [->, draw=plotteal] ([shift={(0.0, 0.0)}]note4r.south) -> (addededge2);
        \draw [->, draw=plotorange] ([shift={(0.0, 0.0)}]note5r.south) -> (deletededge);
        \draw [->, draw=plotorange] ([shift={(0.0, 0.0)}]note6r.north) -> (deletednode);
    \end{scope}
\end{tikzpicture}
