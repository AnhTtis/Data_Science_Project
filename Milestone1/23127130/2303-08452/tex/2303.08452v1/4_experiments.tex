\section{Experiments}
\textbf{Datasets.} We trained our model using two publicly available brain T1w MRI datasets, including FastMRI+ (131 train, 15 val, 30 test) and IXI (581 train samples), to capture the healthy distribution. Performance evaluation was done on a large stroke T1-weighted MRI dataset, ATLAS v2.0~\cite{atlas2022}, containing 655 images with manually segmented lesion masks for training and 355 test images with hidden lesion masks. We evaluated the model using the 655 training images with public annotations. The mid axial slices were normalized to the $98^{th}$ percentile, padded, and resized to $128\times128$ resolution. During training, we performed random rotations up to 10 degrees, translations up to 0.1, scaling from 0.9 to 1.1, and horizontal flips with a 0.5 probability. We trained for 1500 epochs, with a batch size of 8, lr of $5e^{-5}$, and early stopping (see Appendix for details). 
\subsection{Reversing Synthetic Anomalies\label{sec::synth}}
\input{4_1_ph_table}
\begin{figure}[tb]
    \centering
    \includegraphics[width=0.8\textwidth]{fig_phr_ra.png}
    \caption{\textbf{Reversing synthetic anomalies.} \textit{PHANES} successfully removes synthetic anomalies and produces the most accurate pseudo-healthy reconstructions. }
    \label{fig::phr}
\end{figure}
In this section, we test whether reconstruction-based methods can generate pseudo-healthy images and reverse synthetic anomalies. Results are evaluated in~\autoref{tab::synth_phr} and~\autoref{fig::phr} using 30 test images and synthetic masks as reference. VAEs produce blurry results that lead to poor reconstruction of both healthy and anomalous regions (LPIPS) and thus poor segmentation performance. While DAEs preserve the healthy tissues well with an LPIPS of 3.94, they do not generate pseudo-healthy reconstructions in anomalous regions (LPIPS $\approx20$). However, they change the intensity of some structures, e.g., hypo-intensities, allowing for improved detection accuracy (see AUPRC and Dice). Simplex noise in~\cite{Wyatt_2022_CVPR} is designed to detect large hypo-intense lesions, leaving small anomalies undetected by AnoDDPM. SI-VAEs and RA produce pseudo healthy versions of the abnormal inputs, with the latter achieving the best results among the baselines. Our proposed method, \textit{PHANES}, successfully reverses the synthetic anomalies, with its reconstructions being the most similar to ground truth healthy samples, as can be seen in~\autoref{fig::phr}. It achieved an improvement of 77\% and 47\% in generating pseudo-healthy samples in healthy and anomalous regions, respectfully. This enables the precised localization of anomalies (see bottom row in~\autoref{fig::phr}). 
\subsection{Ischemic Stroke Lesion Segmentation on T1w Brain MRI}
\input{4_2_ano_table}
\begin{figure}[tb]
    \centering
    \includegraphics[width=\textwidth]{fig_quali_diffusion.png}
    \caption{\textbf{Stroke lesion segmentation.} We show input images with expert annotations in red along with masked images generated by the latent generative networks in~\autoref{fig::phanes}, pseudo-healthy reconstructions, and anomaly maps. On the right, we show the performance of diffusion models on the same inputs. Different rows show cases ranging from large anomalies at the top to more subtle ones at the bottom. Green arrows mark unlabeled anomalies. \textit{PHANES} successfully reverses the anomalies and accurately localizes even very subtle anomalies.}
    \label{fig::quali}
\end{figure}
In this section, we evaluate the performance of our approach in segmenting stroke lesions and show the results in~\autoref{tab::benchmark_anomaly_detection} and ~\autoref{fig::quali}. For completeness, we compare our approach to teacher-student methods that use multi-scale knowledge distillation (MKD) for anomaly segmentation. The unsupervised detection of (subtle) stroke lesions is challenging. The lack of healthy data from the same scanner and the limited size of the healthy datasets limit the successful application of such methods, with a maximum achievable Dice score of just under $6\%$. On the other hand, PatchCore, which is currently the SOTA method in industrial anomaly detection, has demonstrated comparable performance to the top-performing baselines. VAEs yield many false positive detections due to the blurry reconstructions and achieve poor localization results. DAEs can identify anomalies that resemble the learned noise distribution and improve segmentation results (AUPRC of $9.22$), despite not producing pseudo-healthy reconstructions of abnormal samples (see~\autoref{sec::synth}). The best performing latent restoration method is RA, achieving a remarkable $79\%$ improvement over SI-VAE. Unlike experiments in~\autoref{sec::synth}, the Simplex noise aligns more closely with the hypo-intense pathology distribution of stroke in T1w brain MRI. As a result, AnoDDPM achieves the highest detection accuracy among the baselines. Compared to AnoDDPM, \textit{PHANES} increases the detection results by $22\%$ AUPRC.~\autoref{fig::quali} shows a visual comparison between the two approaches. Diffusion models tend to be more susceptible to domain shifts (first three rows) and yield more false positives. In contrast, \textit{PHANES} demonstrates more precise localization, especially for subtle anomalies (bottom rows). Generally, unsupervised methods tend to have lower Dice scores partly due to unlabeled artefacts in the dataset. These include non-pathological (rows 1,2) as well as other pathological effects, such as changes in ventricle structure (rows 3,4). \textit{PHANES} correctly identifies these as anomalous, but their lack of annotation limits numerical evaluations.
%\textbf{Ablation Study: Bridging the domain gap.} Training unsupervised methods for brain MRI anomaly segmentation is challenging due to the lack of datasets containing both annotated pathologies and healthy samples from the same distribution [TBD...]
%To overcome this limitation, unsupervised methods are trained on datasets that contain healthy samples, such as IXI. However, brain MRI has a considerable domain shift between different scanners and acquisition parameters, which limits the generalizability and effectiveness of these methods. \textit{PHANES} has the capability to curate anomalous datasets by generating pseudo-healthy versions of the pathological inputs. This enables new avenues for various research areas such as monitoring nodule growth or predicting disease progression. One simple approach to take advantage of these curated datasets is to employ them as data augmentation for unsupervised learning methods. We demonstrate this by curating the test set of the ATLAS challenge for which the ground truth annotations are hidden. \textit{$PHANES^+$} in ~\autoref{tab::benchmark_anomaly_detection} first generates pseudo-healthy version of the 355 anomalous samples. By using this additional dataset, we were able to further increase the performance by...  