\section{Numerical Examples}

\urg{Add CVAR content}

MATLAB (2022a) code to replicate experiments is available at \url{https://github.com/Jarmill/chance\_peak} (tail-bound) and \url{https://github.com/Jarmill/cvar\_peak} (\ac{CVAR}). 
Dependencies include Mosek \cite{mosek92} and YALMIP \cite{lofberg2004yalmip}.  \ac{MC} sampling to empirically find \ac{VAR} estimates is conducted over 50,000 \ac{SDE} paths under antithetic sampling with a time spacing of $\Delta t = 10^{-3}$. All experiments contain a table of chance-peak bounds as well as solver-times to compute these bounds.
\label{sec:examples}

% \urg{github link to code}
% MATLAB (2021a) code to generate the below examples is publicly available at
% \url{https://github.com/daishuyu/noise-in-observations}. 

MATLAB (2022a) code to replicate experiments is available at \url{https://github.com/Jarmill/chance_peak}. 
Dependencies include Mosek \cite{mosek92} and YALMIP \cite{lofberg2004yalmip}. All instances of $\epsilon=0.5$ bounds refer to the non-chance-peak program \eqref{eq:peak_meas} (or its appropriate modification). \ac{MC} sampling to empirically find \ac{VAR} estimates is conducted over 50,000 \ac{SDE} paths under antithetic sampling with a time spacing of $\Delta t = 10^{-3}$. All experiments contain a table of chance-peak bounds as well as solver-times to compute these bounds.
% \urg{Possibly include mp-yalmip, because I've been getting \texttt{UNKNOWN} statuses from Mosek on some of the problems}. 


% \subsection{Two-Dimensional Flow System}

% \subsection{Deterministic Dynamics}
% % An ODE in which $\mu_0$ is a uniform distribution over a box.
% The Flow system of \cite{prajna2004safety} satisfies,
% \begin{equation}
% \label{eq:flow}
%     \dot{x} = \begin{bmatrix}x_2 \\ -x_1 -x_2 + \frac{1}{3}x^3_1\end{bmatrix}.
% \end{equation}

% This example will include maximization of $p(x) = -x_2$  over trajectories \eqref{eq:flow} when considering the state set $X = [-1, 2] \times [-1, 1.5]$ and time horizon $T = 5$. These trajectories and results are visualized in Figure \ref{fig:det_flow} in cyan. Initial conditions are uniformly distributed ($\mu_0$) in the box $X_0=[0.8, 1.2]^2$ (black box). The $\epsilon=0.5$ row of table \ref{tab:flow_det} displays the bounds on the mean distribution as solved through finite-degree \ac{SDP} truncations of \eqref{eq:peak_meas}. The bounds at $\epsilon = \{0.15, 0.1, 0.05\}$ are obtained through the \ac{VP} expression in \eqref{eq:var_vp} and solving the \acp{SDP} obtained from \eqref{eq:chance_lmi}. The dotted and solid red lines in Figure \ref{fig:det_flow} are the $\epsilon=0.5$ and $\epsilon=0.2$ bounds respectively at order 6. 

% The true maximum value of $p(x) = -x_2$ over when choosing a point in the initial region of $X_0$ (without imposing a uniform distribution) is $0.5570$ (at order-6 of \eqref{eq:peak_meas}).
% The $\epsilon \leq 0.15$ bounds are therefore conservative (from the \ac{VP} approximation) but remain valid.

% \begin{table}[h]
%   \centering
%   \caption{Chance-Peak estimation of the Deterministic Flow System \eqref{eq:flow} \label{tab:flow_det}}
% \begin{tabular}{ccccccc}
% order           & 1      & 2      & 3      & 4      & 5      & 6      \\ \hline
% $\epsilon=0.5$  & 1.0000 & 0.5681 & 0.5426 & 0.5421 & 0.5411 & 0.5396 \\
% $\epsilon=0.15$  & 1.2781 & 0.9998 & 0.9451 & 0.9384 & 0.9373 & 0.9364\\
% $\epsilon=0.1$  & 1.5706 & 1.2523 & 1.1882 & 1.1808 & 1.1794 & 1.1789 \\
% $\epsilon=0.05$ & 2.2287 & 1.8174 & 1.7329 & 1.7245 & 1.7234 & 1.7230 
% \end{tabular}
% \end{table}

% \begin{figure}[h]
%     \centering
%     \includegraphics[width=\linewidth]{img/determinstic_flow_6_top_corner.png}
%     \caption{Trajectories of \eqref{eq:flow} with $\epsilon = \{0.5, 0.2\}$ bounds}
%     \label{fig:det_flow}
% \end{figure}



\subsection{Two States}

Example 1 of \cite{prajna2004stochastic} is the following two-dimensional cubic polynomial \ac{SDE}
\begin{equation}
\label{eq:flow_sde}
    dx = \begin{bmatrix}x_2 \\ -x_1 -x_2 - \frac{1}{2}x^3_1\end{bmatrix}dt + \begin{bmatrix} 0 \\ 0.1 \end{bmatrix}dw.
\end{equation}

This example performs chance-peak maximization of $p(x) = -x_2$ starting at the point (Dirac-delta initial measure $\mu_0$) $X_0 = [1, 1]$ with $X= [-1, 2] \times  [-1, 1.5]$ and $T=5$. Trajectories of \eqref{eq:flow_sde} are displayed in cyan in Figure \ref{fig:sde_flow} starting from the black-circle $X_0$, and four of these trajectories are marked in non-cyan colors.
The $\epsilon=0.5$ row of Table \ref{tab:flow_sde} displays the bounds on the mean distribution as solved through finite-degree \ac{SDP} truncations of \eqref{eq:peak_meas}. The bounds at $\epsilon = \{0.15, 0.1, 0.05\}$ are obtained through the \ac{VP} expression in \eqref{eq:var_vp} and solving the \acp{SDP} obtained from \eqref{eq:chance_lmi}.
The dotted and solid red lines in Figure \ref{fig:sde_flow} are the $\epsilon=0.5$ and $\epsilon=0.15$ bounds respectively at order 5.
% \ac{VP} bounds derived from solving the \acp{SDE} \eqref{eq:flow_sde} from \eqref{eq:peak_meas} and \eqref{eq:chance_lmi} are recorded in Table \ref{tab:flow_sde} in the same manner as in Table \ref{tab:flow_det}. Figure \ref{fig:sde_flow} plots trajectories and bounds of \eqref{eq:flow_sde} starting from the black-circle $X_0$ point. Four of these trajectories are visibly distinguished. Just as in Figure \ref{fig:det_flow}, the red dotted line is the $\epsilon=0.5$ bound and the red solid line is the $\epsilon=0.15$ bound.

% \begin{table}[h]
%   \centering
%   \caption{Chance-Peak estimation of the Stochastic Flow System \eqref{eq:flow_sde} to maximize $p(x) = -x_2$ \label{tab:flow_sde}}
% \begin{tabular}{lcccccc}
% \multicolumn{1}{c}{order}      & 1      & 2      & 3      & 4      & 5      & 6      \\ \hline
% $\epsilon = 0.5$  & 1.5000 & 0.8817 & 0.8773 & 0.8747 & 0.8745 & 0.8744 \\
% $\epsilon = 0.15$ & 1.2910 & 1.2210 & 1.1817 & 1.1689 & 1.1657 & 1.1642 \\
% $\epsilon = 0.1$  & 1.5811 & 1.5009 & 1.4520 & 1.4361 & 1.4323 & 1.4303 \\
% $\epsilon = 0.05$ & 2.2361 & 2.1306 & 2.0613 & 2.0387 & 2.0332 & 2.0305
% \end{tabular}
% \end{table}

\begin{table}[h]
   \centering
   \caption{Chance-Peak estimation of the Stochastic Flow System \eqref{eq:flow_sde} to maximize $p(x) = -x_2$ \label{tab:flow_sde}}
\begin{tabular}{lcccccc}
\multicolumn{1}{c}{order}      & 2      & 3      & 4      & 5      & 6  & \ac{MC}     \\ \hline
$\epsilon = 0.5$ &  0.8817 & 0.8773 & 0.8747 & 0.8745 & 0.8744 & 0.8559\\
$\epsilon = 0.15$  & 1.2210 & 1.1817 & 1.1689 & 1.1657 & 1.1642 & 0.9142\\
$\epsilon = 0.1$  & 1.5009 & 1.4520 & 1.4361 & 1.4323 & 1.4303 & 0.9279\\
$\epsilon = 0.05$  & 2.1306 & 2.0613 & 2.0387 & 2.0332 & 2.0305 & 0.9484
\end{tabular}
\end{table}


\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{img/stochastic_flow_6_top_corner.png}
    \caption{Trajectories of \eqref{eq:flow_sde} with $\epsilon=0.5$ (dashed red) and $\epsilon=0.15$ (solid red) bounds}
    \label{fig:sde_flow}
\end{figure}


\begin{table}[h]
   \centering
   \caption{Solver time (seconds) to compute Table \ref{tab:flow_sde} \label{tab:flow_sde_time}}
\begin{tabular}{lccccc}
\multicolumn{1}{c}{order}      & 2      & 3      & 4      & 5      & 6      \\ \hline
$\epsilon = 0.5$   & 0.417 & 0.431 & 1.963 & 1.659 & 3.641 \\
$\epsilon = 0.15$  & 0.216 & 0.325 & 1.592 & 4.178 & 7.464 \\
$\epsilon = 0.1$   & 0.213 & 0.316 & 1.651 & 1.339 & 4.225 \\
$\epsilon = 0.05$  & 0.222 & 0.366 & 0.936 & 2.446 & 5.298
\end{tabular}
\end{table}

% \begin{table}[h]
%   \centering
%   \caption{Solver time (seconds) to compute Table \ref{tab:flow_sde} \label{tab:flow_sde_time}}
% \begin{tabular}{lcccccc}
% \multicolumn{1}{c}{order}      & 1      & 2      & 3      & 4      & 5      & 6      \\ \hline
% $\epsilon = 0.5$  & 0.643 & 0.417 & 0.431 & 1.963 & 1.659 & 3.641 \\
% $\epsilon = 0.15$ & 0.272 & 0.216 & 0.325 & 1.592 & 4.178 & 7.464 \\
% $\epsilon = 0.1$  & 0.264 & 0.213 & 0.316 & 1.651 & 1.339 & 4.225 \\
% $\epsilon = 0.05$ & 0.184 & 0.222 & 0.366 & 0.936 & 2.446 & 5.298
% \end{tabular}
% \end{table}
\subsection{Three States}

\Iac{SDE} modification of the Twist system from \cite{miller2022distance_short} is,
\begin{equation}
\label{eq:twist_sde}
    dx = \begin{bmatrix}-2.5x_1 + x_2 - 0.5x_3 + 2x_1^3+2x_3^3 \\
    -x_1+1.5x_2+0.5x_3-2x_2^3-2x_3^3 \\
    1.5 x_1 + 2.5x_2 - 2 x_3 - 2x_1^3 - 2 x_2^3\end{bmatrix}dt + \begin{bmatrix} 0 \\ 0\\  0.1 \end{bmatrix}dw.
\end{equation}

This second example performs chance-peak maximization of $p(x) = x_3$ starting at the point $X_0 = [0.5, 0, 0]$ with $X=[-0.6, 0.6] \times  [-1, 1] \times [-1, 1.5]$ and $T=5$. \ac{VP} bounds from solving the \acp{SDE} from \eqref{eq:peak_meas} and \eqref{eq:chance_lmi} are recorded in Table \ref{tab:twist_sde} in the same manner as in Table \ref{tab:flow_sde}. Figure \ref{fig:sde_twist} plots trajectories and bounds of \eqref{eq:twist_sde} starting from the black-circle $X_0$ point, with four of these trajectories visibly distinguished. The solid red plane in Figure \ref{fig:sde_twist} is the $\epsilon=0.15$ bound on $x_3$ at order 6, and the transluscent red plane is the $\epsilon=0.5$ bound on $x_3$ (also at order 6).

% Just as in Figure \ref{fig:det_flow}, the red dotted line is the $\epsilon=0.5$ bound and the red solid line is the $\epsilon=0.15$ bound.



\begin{table}[t]
   \centering
   \caption{Chance-Peak estimation of the Stochastic Twist System \eqref{eq:twist_sde}  to maximize $p(x) = x_3$ \label{tab:twist_sde}}
\begin{tabular}{lcccccc}
\multicolumn{1}{c}{order}            & 2      & 3      & 4      & 5      & 6     & \ac{MC} \\ \hline
$\epsilon=0.5$                              & 0.9100                 & 0.8312                 & 0.8231                 & 0.8211                 & 0.8203    & 0.7206         \\
$\epsilon=0.15$                             & 1.1729                 & 1.0813                 & 1.0171                 & 0.9891                 & 0.9755& 0.7685              \\
$\epsilon=0.1$                              & 1.4358                 & 1.3180                 & 1.2217                 & 1.1859                 & 1.1694   & 0.7801            \\
$\epsilon=0.05$                             & 2.0288                 & 1.8497                 & 1.6866                 & 1.6299                 & 1.5894 & 0.7970
\end{tabular}
\end{table}

% \begin{table}[t]
%   \centering
%   \caption{Chance-Peak estimation of the Stochastic Twist System \eqref{eq:twist_sde}  to maximize $p(x) = x_3$ \label{tab:twist_sde}}
% \begin{tabular}{lcccccc}
% \multicolumn{1}{c}{order}           & 1      & 2      & 3      & 4      & 5      & 6      \\ \hline
% $\epsilon=0.5$             & 1.4682                 & 0.9100                 & 0.8312                 & 0.8231                 & 0.8211                 & 0.8203             \\
% $\epsilon=0.15$             & 1.2910                 & 1.1729                 & 1.0813                 & 1.0171                 & 0.9891                 & 0.9755              \\
% $\epsilon=0.1$             & 1.5811                 & 1.4358                 & 1.3180                 & 1.2217                 & 1.1859                 & 1.1694               \\
% $\epsilon=0.05$            & 2.2361                 & 2.0288                 & 1.8497                 & 1.6866                 & 1.6299                 & 1.5894 
% \end{tabular}
% \end{table}

\begin{figure}[!h]
    \centering
    \includegraphics[width=\linewidth]{img/stochastic_twist_6.png}
    \caption{Trajectories of \eqref{eq:twist_sde} with $\epsilon=0.5$ (dashed red) and $\epsilon=0.15$ (solid red) bounds}
    \label{fig:sde_twist}
\end{figure}

% \begin{table}[!h]
%   \centering
%   \caption{Solver time (seconds) to compute Table \ref{tab:twist_sde} \label{tab:twist_sde_time}}
% \begin{tabular}{lcccccc}
% \multicolumn{1}{c}{order}      & 1      & 2      & 3      & 4      & 5      & 6      \\ \hline
% $\epsilon = 0.5$  & 0.734 & 0.526 & 1.880 & 5.213 & 28.269 & 81.736  \\
% $\epsilon = 0.15$ & 0.316 & 0.397 & 1.117 & 3.876 & 23.302 & 132.539 \\
% $\epsilon = 0.1$  & 0.144 & 0.210 & 1.080 & 6.313 & 27.829 & 116.733 \\
% $\epsilon = 0.05$ & 0.118 & 0.185 & 1.352 & 4.999 & 20.863 & 137.833
% \end{tabular}
% \end{table}

\begin{table}[!h]
   \centering
   \caption{Solver time (seconds) to compute Table \ref{tab:twist_sde} \label{tab:twist_sde_time}}
\begin{tabular}{lccccc}
\multicolumn{1}{c}{order}         & 2      & 3      & 4      & 5      & 6      \\ \hline
$\epsilon = 0.5$   & 0.526 & 1.880 & 5.213 & 28.269 & 81.736  \\
$\epsilon = 0.15$  & 0.397 & 1.117 & 3.876 & 23.302 & 132.539 \\
$\epsilon = 0.1$   & 0.210 & 1.080 & 6.313 & 27.829 & 116.733 \\
$\epsilon = 0.05$  & 0.185 & 1.352 & 4.999 & 20.863 & 137.833
\end{tabular}
\end{table}

