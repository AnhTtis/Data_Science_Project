\documentclass{article}

% if you need to pass options to natbib, use, e.g.:
%     \PassOptionsToPackage{numbers, compress}{natbib}
% before loading neurips_2021

% % ready for submission
% \usepackage{neurips_2021}

% IMPORTANT: if you are submitting attention track, please add the attention option:
% \usepackage[attention]{neurips_2021}

% to compile a preprint version, e.g., for submission to arXiv, add add the
% [preprint] option:
%     \usepackage[preprint]{neurips_2021}

% to compile a camera-ready version, add the [final] option, e.g.:
\usepackage[final]{neurips_2021}

% to avoid loading the natbib package, add option nonatbib:
%    \usepackage[nonatbib]{neurips_2021}

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{xcolor}         % colors

% Recommended, but optional, packages for figures and better typesetting:
\usepackage{microtype}
\usepackage{graphicx}
% \usepackage{subfigure}
\usepackage{booktabs} % for professional tables
\usepackage{subcaption}
% For theorems and such
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}
% For Diagrams
\usepackage{tikz}
% if you use cleveref..
\usepackage[capitalize,noabbrev]{cleveref}
\usepackage{ulem}
% Todonotes is useful during development; simply uncomment the next line
%    and comment out the line below the next line to turn off comments
%\usepackage[disable,textsize=tiny]{todonotes}
\usepackage[textsize=tiny]{todonotes}

\usepackage{soul}
\usepackage{xcolor}
\usepackage{float}
% \usepackage{placeins}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% THEOREMS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

% \newcommand{\albert}[1]{\textcolor{red}{#1}}
% \newcommand{\albertl}[1]{\textcolor{green}{#1}}
\newcommand{\albert}[1]{#1}
% \newcommand{\albertl}[1]{#1}
% \newcommand{\vj}{\textcolor{blue}}
\newcommand{\vj}[1]{#1}

\title{Predicting the Initial Conditions of the Universe using \albert{a Deterministic Neural Network}}

\author{%
    Vaibhav Jindal\textsuperscript{1,2,*} \\
    \texttt{vaibhav.jndl@gmail.com}
    \And
    Albert Liang\textsuperscript{1,3,*} \\
    \texttt{ajliang@cs.cmu.edu}
    \AND
    Aarti Singh\textsuperscript{1} \\
    \texttt{aartisingh@cmu.edu}
    \And
    Shirley Ho\textsuperscript{4,5,6} \\
    \texttt{shirleyho@flatironinstitute.org}
    \And
    Drew Jamieson\textsuperscript{7} \\
    \texttt{jamieson@mpa-garching.mpg.de}
}


\begin{document}

\maketitle

% Manually setting footnotes
\footnotetext[1]{Machine Learning Department, Carnegie Mellon University}
\footnotetext[2]{Cohesity}
\footnotetext[3]{Two Sigma Investments}
\footnotetext[4]{Center for Computational Astrophysics, Flatiron Institute}
\footnotetext[5]{Department of Physics \& Center for Data Science, New York University}
\footnotetext[6]{Department of Astrophysical Sciences, Princeton University}
\footnotetext[7]{Max Planck Institute for Astrophysics}

% Custom footnote
\setcounter{footnote}{1} % Set counter to 1 for \textdagger symbol
\renewcommand{\thefootnote}{\fnsymbol{footnote}} % Use symbols instead of numbers
\footnotetext{Work done while at Carnegie Mellon University}

% Reset footnote style and counter
\renewcommand{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{5} % Reset to the number of existing footnotes


\begin{abstract}
% TODO: add a line somewhere to mention equivalence of displacement field and density field

Finding the initial conditions that led to the current state of the universe is challenging because it involves searching over an \albert{intractable} input space of initial conditions, \vj{along with modeling their evolution via tools such as N-body simulations which are computationally expensive}. Recently, deep learning has emerged as a \albert{surrogate} for N-body simulations by directly learning the mapping between the linear input of an N-body simulation and the final nonlinear output from the simulation, significantly accelerating the forward modeling. However, this still does not reduce the search space for initial conditions. In this work, we pioneer the use of \albert{a deterministic convolutional neural network for learning the reverse mapping and show that it accurately recovers the initial linear displacement field over a wide range of scales ($<1$-$2\%$ error up to nearly \albert{$k\simeq0.8$ -- $0.9 \text{ Mpc}^{-1}h$}), despite the one-to-many mapping of the inverse problem (due to the divergent backward trajectories at smaller scales)}. Specifically, we train a \albert{V-Net architecture}, which outputs the linear displacement of an N-body simulation, given the nonlinear displacement \albert{at redshift $z=0$} and the cosmological parameters. \albert{The results of our method suggest that a simple deterministic neural network is sufficient for accurately approximating the initial linear states, potentially obviating the need for the more complex and computationally demanding backward modeling methods that were recently proposed.}
% This document provides a basic paper template and submission guidelines.
% Abstracts must be a single paragraph, ideally between 4--6 sentences long.
% Gross violations will trigger corrections at the camera-ready phase.
\end{abstract}

\input{introduction.tex}
\input{methodology.tex}
\input{results.tex}
\input{conclusion.tex}
% \input{future_work.tex}

\bibliography{main}
\bibliographystyle{plainnat}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% APPENDIX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\appendix
\onecolumn
\section{Appendix}
% \subsection{Plots for Section \ref{sec:qualitative-analysis}}\label{sec:a1}
% \begin{figure*}[ht!]
%     \centering
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.6\linewidth]{images/N128/slices_lin.png}
%         \caption{Slices from Linear Fields}
%         \label{slices:lin}
%     \end{subfigure}
    
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.6\linewidth]{images/N128/slices_dis.png}
%         \caption{Slices from Nonlinear Field}
%         \label{slices:dis}
%     \end{subfigure}
    
%     \caption{Qualitative comparison of the $x,y, \text{and } z$ displacements for a $128 \times 128$ slice of particles for a field sampled using the training parameters. (a) Slice from the original linear field and the corresponding linear field predicted by our inverse model. (b) Slice from the original nonlinear field and the nonlinear field predicted by the forward emulator \cite{jamieson} for the linear field predicted by our inverse model.}
%     \label{slices}
% \end{figure*}

% \clearpage

\subsection{Results for the 0th percentile OOD setting of cosmological parameters ($\Omega_m = 0.296, \Omega_b = 0.067, h = 0.523, n_s = 1.091, \sigma_8 = 0.806$)}

\begin{figure}[h!]
\begin{center}
\centerline{\includegraphics[width=0.5\columnwidth]{images/N512_closest/one_pt_512.png}}
\caption{Distribution of the displacements of particles for the 0th percentile OOD Quijote simulation linear field and the corresponding linear field predicted by our inverse model. The distribution has been calculated by considering the $x,y, \text{and } z$ displacements of $512^3$ particles separately. Relative error denotes the relative errors in probability density for different bins. The theoretical distributions for this setting is $\mathcal{N}(0, 6.193)$ (Equation \ref{eq:sigdis}).}
\label{one_pt_512_first}
\end{center}
\end{figure}
\begin{figure*}[h!]
    \centering
    \begin{subfigure}[b]{0.9\linewidth}
        \centering
        \includegraphics[width=\linewidth]{images/N512_closest/lin_512.png}
        \caption{Power spectra comparison for linear field}
        \label{fig0:linear}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.9\linewidth}
        \centering
        \includegraphics[width=\linewidth]{images/N512_closest/dis_512.png}
        \caption{Power spectra comparison for nonlinear field}
        \label{fig0:nonlinear}
    \end{subfigure}
    \caption{Power spectra comparison for the 0th percentile OOD Quijote simulation data point. (a) Comparison between the original linear field and the linear field predicted by our inverse model. (b) Comparison between the original nonlinear field and the nonlinear field predicted by the forward emulator \cite{jamieson} for the linear field predicted by our inverse model.}
    \label{fig0:two_point}
\end{figure*}

\begin{figure*}[h!]
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.7\linewidth]{images/N512_closest/slices_lin.png}
        \caption{Slices from Linear Fields}
        \label{fig1:linear_field}
    \end{subfigure}
    
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.7\linewidth]{images/N512_closest/slices_dis.png}
        \caption{Slices from Nonlinear Field}
        \label{fig1:nonlinear_field}
    \end{subfigure}
    
    \caption{Qualitative comparison of the $x,y, \text{and } z$ displacements for a $512 \times 512$ slice of particles for the 0th percentile OOD Quijote simulation data point. (a) Slice from the original linear field and the corresponding linear field predicted by our inverse model. (b) Slice from the original nonlinear field and the nonlinear field predicted by the forward emulator \cite{jamieson} for the linear field predicted by our inverse model.}
    \label{fig1:fields}
\end{figure*}

\clearpage




\subsection{Results for the 20th percentile OOD simulation from the Quijote suite ($\Omega_m = 0.311, \Omega_b = 0.067, h = 0.673, n_s = 0.993, \sigma_8 = 0.977$)}

\begin{figure}[h!]
\begin{center}
\centerline{\includegraphics[width=0.5\columnwidth]{images/N512_second_closest/one_pt_512.png}}
\caption{Distribution of the displacements of particles for the 20th percentile OOD Quijote simulation linear field and the corresponding linear field predicted by our inverse model. The distribution has been calculated by considering the $x,y, \text{and } z$ displacements of $512^3$ particles separately. Relative error denotes the relative errors in probability density for different bins. The theoretical distributions for this setting is $\mathcal{N}(0, 7.159)$ (Equation \ref{eq:sigdis}).}
\label{one_pt_512_second}
\end{center}
\end{figure}

\begin{figure*}[h!]
    \centering
    \begin{subfigure}[b]{0.9\linewidth}
        \centering
        \includegraphics[width=\linewidth]{images/N512_second_closest/lin_512.png}
        \caption{Power spectra comparison for linear field}
        \label{fig2:linear}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.9\linewidth}
        \centering
        \includegraphics[width=\linewidth]{images/N512_second_closest/dis_512.png}
        \caption{Power spectra comparison for nonlinear field}
        \label{fig2:nonlinear}
    \end{subfigure}
    \caption{Power spectra comparison for the 20th percentile OOD Quijote simulation data point. (a) Comparison between the original linear field and the linear field predicted by our inverse model. (b) Comparison between the original nonlinear field and the nonlinear field predicted by the forward emulator \cite{jamieson} for the linear field predicted by our inverse model.}
    \label{fig2:two_point}
\end{figure*}

\begin{figure*}[h!]
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.7\linewidth]{images/N512_second_closest/slices_lin.png}
        \caption{Slices from Linear Fields}
        \label{fig3:linear_field}
    \end{subfigure}
    
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.7\linewidth]{images/N512_second_closest/slices_dis.png}
        \caption{Slices from Nonlinear Field}
        \label{fig3:nonlinear_field}
    \end{subfigure}
    
    \caption{Qualitative comparison of the $x,y, \text{and } z$ displacements for a $512 \times 512$ slice of particles for the 20th percentile OOD Quijote simulation data point. (a) Slice from the original linear field and the corresponding linear field predicted by our inverse model. (b) Slice from the original nonlinear field and the nonlinear field predicted by the forward emulator \cite{jamieson} for the linear field predicted by our inverse model.}
    \label{fig3:fields}
\end{figure*}

\clearpage

% \subsection{Power Spectra Analysis for Linear Fields in OOD settings}
% \vspace{-1mm}
% \begin{figure*}[h!]
%     \centering
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/0.png}
%         \caption{0th percentile ($\Omega_m = 0.296, \Omega_b = 0.067, h = 0.523, n_s = 1.091, \sigma_8 = 0.806$)}
%         \label{ood_lin:0}
%     \end{subfigure}
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/20.png}
%         \caption{20th percentile ($\Omega_m = 0.311, \Omega_b = 0.067, h = 0.673, n_s = 0.993, \sigma_8 = 0.977$)}
%         \label{ood_lin:20}
%     \end{subfigure}
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/40.png}
%         \caption{40th percentile ($\Omega_m = 0.373, \Omega_b = 0.054, h = 0.869, n_s = 0.922, \sigma_8 = 0.678$)}
%         \label{ood_lin:40}
%     \end{subfigure}
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/60.png}
%         \caption{60th percentile ($\Omega_m = 0.412, \Omega_b = 0.036, h = 0.840, n_s = 0.942, \sigma_8 = 0.680$)}
%         \label{ood_lin:60}
%     \end{subfigure}
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/80.png}
%         \caption{80th percentile ($\Omega_m = 0.491, \Omega_b = 0.069, h = 0.518, n_s = 0.932, \sigma_8 = 0.820$)}
%         \label{ood_lin:80}
%     \end{subfigure}
%     \begin{subfigure}[b]{\linewidth}
%         \centering
%         \includegraphics[width=0.7\linewidth]{images/ood_lin/100.png}
%         \caption{100th percentile ($\Omega_m = 0.497, \Omega_b = 0.044, h = 0.805, n_s = 0.910, \sigma_8 = 0.600$)}
%         \label{ood_lin:100}
%     \end{subfigure}
%     \caption{Power spectra comparison between the linear fields and the inverse model predictions for the 0th, 20th, 40th, 60th, 80th, and 100th percentile OOD Quijote simulation data points.}
%     \label{ood_lin}
% \end{figure*}

\clearpage 
\subsection{Power Spectra Analysis for Nonlinear Fields in OOD settings}
\vspace{-1mm}
\begin{figure*}[h!]
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/0.png}
        \caption{0th percentile ($\Omega_m = 0.296, \Omega_b = 0.067, h = 0.523, n_s = 1.091, \sigma_8 = 0.806$)}
        \label{ood_dis:0}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/20.png}
        \caption{20th percentile ($\Omega_m = 0.311, \Omega_b = 0.067, h = 0.673, n_s = 0.993, \sigma_8 = 0.977$)}
        \label{ood_dis:20}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/40.png}
        \caption{40th percentile ($\Omega_m = 0.373, \Omega_b = 0.054, h = 0.869, n_s = 0.922, \sigma_8 = 0.678$)}
        \label{ood_dis:40}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/60.png}
        \caption{60th percentile ($\Omega_m = 0.412, \Omega_b = 0.036, h = 0.840, n_s = 0.942, \sigma_8 = 0.680$)}
        \label{ood_dis:60}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/80.png}
        \caption{80th percentile ($\Omega_m = 0.491, \Omega_b = 0.069, h = 0.518, n_s = 0.932, \sigma_8 = 0.820$)}
        \label{ood_dis:80}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{images/ood_dis/100.png}
        \caption{100th percentile ($\Omega_m = 0.497, \Omega_b = 0.044, h = 0.805, n_s = 0.910, \sigma_8 = 0.600$)}
        \label{ood_dis:100}
    \end{subfigure}
    \caption{Power spectra comparison between the actual nonlinear field and the nonlinear field generated by the forward emulator for the linear field predicted by our inverse model for the 0th, 20th, 40th, 60th, 80th, and 100th percentile OOD Quijote simulation data points.}
    \label{ood_dis}
\end{figure*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}