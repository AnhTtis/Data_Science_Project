\documentclass[aps,pre,preprint,superscriptaddress,onecolumn]{revtex4-2}

\usepackage{color}

\usepackage{epsfig,amssymb,amsmath,amsthm,amsfonts,amsbsy,mathrsfs}

\usepackage{graphicx}

\usepackage{subfigure}

\usepackage{float}

\usepackage{verbatim}

\usepackage{physics}

\usepackage{epstopdf}

% \usepackage{amsmath}
% \usepackage{amssymb}
% \usepackage{caption}
% \usepackage{subcaption}
% \usepackage[margin=1in, top=1.5in]{geometry}
% \setlength\headheight{20pt}
% \usepackage[slantedGreek]{mathptmx}
% \usepackage{url}
% \usepackage{stmaryrd}
% \usepackage{amsthm}
% \usepackage{pdfpages}

\newcommand{\sgn}{\mbox{\rm sign}}
\newcommand{\im}{\mathrm{i}}
\newcommand{\e}{\varepsilon}
% \newcommand{\grad}{\nabla}
\newcommand{\tf}{\tilde{f}}
\newcommand{\tF}{\tilde{F}}
\renewcommand{\div}{{\rm div}}
\renewcommand{\i}{{\rm \bf i}}
\newcommand{\bx}{{\bf x}}
%\newcommand{\drmt}{\hspace{3pt}\text{d}t}
\newcommand{\drmt}{\hspace{2pt}\Delta t}


\begin{document}

\title{Breakdown of Boltzmann-type Models for Nematic Alignment of Self-propelled Rods}
%changed failure to breakdown and I think the title is fine as is. The intro clearly leads to this message so we are ok [OI]


\author{Patrick Murphy\footnote[1]{These authors contributed equally to this project}
% \footnote[2]{corresponding authors}
}
\affiliation{Department of Bioengineering, Rice University, Houston, TX 77005}
\affiliation{Center for Theoretical Biological Physics, Rice University, Houston, TX 77005}

\author{Misha Perepelitsa$^{\textrm{a}}$
}
\affiliation{Department of Mathematics, University of Houston, TX 77204}
\email[Corresponding author: ]{mperepel$@$central.uh.edu}

\author{Ilya Timofeyev}
\affiliation{Department of Mathematics, University of Houston, TX 77204},

\author{Matan Lieber-Kotz}
\affiliation{Department of Bioengineering, Rice University, Houston, TX 77005}

\author{Brandon Islas}
\affiliation{Department of Computational and Applied Mathematics, Rice University, Houston, TX 77005}

\author{Oleg A. Igoshin$^\textrm{b,}$}
\affiliation{Department of Bioengineering, Rice University, Houston, TX 77005}
\affiliation{Center for Theoretical Biological Physics, Rice University, Houston, TX 77005} 
\affiliation{Department of Chemistry, Rice University, Houston, TX 77005}
\affiliation{Department of Biosciences, Rice University, Houston, TX 77005}
\email[Corresponding author: ]{igoshin$@$rice.edu}
\date{\today}




\begin{abstract}
Studies in active matter systems and in the collective motility of organisms utilize a range of analytical approaches to formulate continuous kinetic models of collective dynamics from the rules or equations describing agent interactions. However, the derivation of these models often relies on Boltzmann's hypothesis of "molecular chaos", often simply called statistical independence. While it is often the simplest way to derive tractable models it is not clear whether the statistical independence assumption is valid in practice. In this work, we develop a Boltzmann-type kinetic model for the nematic alignment of self-propelled rods where rod reorientation occurs upon binary collisions. We identify relevant parameters and derive kinetic equations for the corresponding asymptotic regime. By comparing numerical solutions of the kinetic equations to an agent-based model that implements our microscopic alignment rules, we examine the accuracy of the continuous model. The results indicate that our kinetic model fails to replicate the underlying dynamics due to the formation of clusters that violate statistical independence. Additionally, we show that a mechanism limiting cluster formation helps to improve the agreement between the analytical model and agent simulations. These results highlight the need to improve modeling approaches for active matter systems.
\end{abstract}

\maketitle




% \keywords{alignment of rods, polar alignment; Boltzmann-type model; kinetic model.}

% \ccode{AMS Subject Classification: 22E46, 53C35, 57S20}


%%Introduction
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

% introduce models of alignment of rods and background examples
Self-propelled rods are a fascinating class of active matter seen across both living and non-living systems \cite{ndlec97,riedel05,narayan07,schaller10,sumino12,balagam14b,balagam15b}. Due to their shape, such systems are intrinsically capable of collective behavior through realignments of rods due to physical collisions \cite{baskaran08,baskaran08a} or longer-ranged hydrodynamic interactions when in a fluid \cite{riedel05,baskaran09}.
These interactions lead to the emergence of macroscopic collective motion such as flocking, clustering, phase changes, and vortexes. Two notable biological examples of collective motion in self-propelled rods are the dynamics of rod-shaped gliding bacteria such as the soil bacterium \textit{Myxococcus xanthus} \cite{kaiser03,wu07,thutupalli15c}, and the behavior of groups of cellular cytoskeletal rods (such as F-actin \cite{schaller10} or microtubules \cite{sumino12}) driven by molecular motors deposited on the surface. Collisions between \textit{M. xanthus} cells often result in the head of the colliding cell reorienting along the length of the cell that was struck (see Fig. \ref{fig:myxo}) \cite{balagam14b}. Reorientation itself occurs on a characteristic time scale related to the ratio of the cell length to cell velocity. Microtubule collisions on a 2D surface also exhibit asymmetric realignments upon collision, with the additional possibility of the colliding microtubule stalling until the struck microtubule has passed \cite{sumino12}.

\begin{figure}[htbp]
\centering
\includegraphics[ width=1.00\textwidth]{images/fig1.png}

\caption{An example of asymmetric alignment during the collision of two \textit{M. xanthus} cells due to cell-substrate forces. Adapted from \cite{balagam14b}.
\label{fig:myxo}
}
\end{figure} 

% Models of alignment classically use Boltzmann's hypothesis of molecular chaos to describe many-body interactions
Due to the interest surrounding systems of self-propelled rods, researchers have developed various methods of modeling them. A popular approach to studying the emergent behavior of these systems is by deriving a probabilistic description \cite{Bertin,degond18,degond08,Manhart1,baskaran08a,peruani06a,ihle_kinetic_2011,bolley12,hanke_understanding_2013,peshkov_boltzmann-ginzburg-landau_2014,perepelitsa_mean-field_2022}. 
A number of heuristic mean-field models based on the notion of the mean nematic director have been considered in \cite{Peruani2008, Ginelli2010, degond08, degond10, degond17, degond18}. Since rod reorientation takes place only when rods collide, a more accurate approach consists in tracing rod collisions as they naturally occur and updating the kinetic distribution function accordingly. A common starting point for such derivations is Boltzmann formalism from gas dynamics\cite{Bertin,Manhart1,hanke_understanding_2013,perepelitsa_mean-field_2022}. This approach relies on the molecular chaos hypothesis and the assumption that rod collisions (or more general interactions) are binary events, see for example \cite{CercignaniBook} and allows the derivation of a kinetic model from the rules for how pairs of rods realign when they interact. For example, in Bertin et al (2006) \cite{Bertin}, the alignment of a pair of interacting, circular-shaped cells reorients them to the average of their pre-collision orientations with a certain amount of noise added. The authors derived a Boltzmann-type equation for the distribution of cells and postulated a reduced hydrodynamic-type model for the first few moments of the cell density distribution. In Hittmeir et al (2021) \cite{Manhart1}, the authors considered a model in which a pair of colliding co-oriented cells (rods with angle difference $|\theta_1-\theta_2| < \pi/2$) change their orientation to their average alignment;  otherwise ($|\theta_1-\theta_2| > \pi/2$) both colliding cells reverse their direction of motion. With this setup, they formulated a Boltzmann-type equation under the assumption $Nl/L$ is finite, where $N$ is the number of cells, $l$ is the cell length and $L$ is some characteristic length scale. For special sets of cell orientations, the authors identify the corresponding set of equilibrium distributions and derive a hydrodynamic-type model in the limit $Nl/L\to\infty.$

% Boltzmann formalism for self-propelled rods has received some critical investigations into its accuracy.
Over the last decade, the validity of Boltzmann formalism has come into question. Evidence has shown that in some biological systems, this modeling approach is not enough to reproduce the observed system dynamics due to either weak binary interactions when stronger, multiparticle interactions are needed \cite{suzuki_polar_2015}, or due to rapid cluster formation that violates the molecular chaos hypothesis \cite{hanke_understanding_2013,thuroff_critical_2013,ihle_towards_2014}. These latter studies suggest that biologically-relevant phenomena reliant on cluster formation, such as the transitions from unordered to collective motion \cite{peruani06a,peruani_collective_2012,weber_nucleation-induced_2012}, may not be accurately modeled with Boltzmann-type equations. However, results from Th√ºroff et al (2013) \cite{thuroff_critical_2013} suggest that a Boltzmann approach can be appropriate for systems that align weakly or gradually over time.



% We investigated a Boltzmann-type model of alignment among self-propelled rods and identify where and why it fails.

In this work, we investigate the validity of the Boltzmann approach to the collective dynamics of self-propelled rigid rods. We assume that a given rod, upon striking a second rod, instantly turns around its head to match a second rod's orientation. We derive a Boltzmann-type kinetic equation for the collective motion of these rods from the first principles by incorporating the geometry of the binary collisions.  We then reduce this general kinetic equation to a finite system of tractable PDEs by assuming only a finite number of orientations are present. Next, we investigate the validity of these equations using agent-based simulations using the same collision scheme underlying the kinetic model. We show that even in simple cases the agent model exhibits cluster formation, with the rate of clustering increasing with the number of rods. This corresponds to a violation of Boltzmann's hypothesis of molecular chaos, i.e. indicates a loss of statistical independence. Finally, we test if the agreement between the two models can be improved by inhibiting cluster formation through the addition of diffusion.




%%%%%%%%%%%%%%%%%%%%%%
%%%%%Section 2%%%%%%%%
\section{Derivation of kinetic equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Our goal is to derive a tractable kinetic description of a system of $N$ self-propelled rods of length $l$ moving at constant speed $v$, starting from a microscopic description of collisions.
Let $f(x,\theta,t)$ be Gibb's probability a rod with orientation $\theta$ has its head located at $x$ at time $t$. We will next derive a kinetic equation for $f$ by finding an expression for the change in $f$ over a single time step of size $\Delta t$. To this end, we make several assumptions about rod collisions. First, we assume that collisions are binary events, with the striking rod reorienting to match the struck rod's orientation modulo $\pi$. This results in the nematic alignment of rods. Motivated by \textit{M. xanthus} dynamics, we further assume that reorientation occurs through the head of the rod. Since we assume binary collisions, we will make use of the 2-particle distribution function $f_2(x,\theta,x_1,\theta_1,t)$ to help calculate collision events.


Denote by $\Delta f$ the change of $f$ along the trajectory: 
\[\Delta f(x,\theta,t)=f(x+v{\bf e}(\theta)\drmt,\theta,t+\Delta t)-f(x,\theta,t),
\] 
with $N\Delta f$ representing the change in the number of rods with a given location and orientation.  In the absence of collisions, the change is zero. If a collision occurred it could result in the gain or loss of rods of orientation $\theta.$  The associated geometry of rods for gain and loss is determined by fixing a spatial location $x$ and considering two cases using two (non-interacting) rods with orientations $\theta$ and $\theta_1$ and heads at $x$. We then look at the sets of collisions in the next $dt$ time that will result in either a gain of a rod with orientation $\theta$ (due to a collision with a $\theta$-rod) or an equivalent loss (due to the $\theta$-rod colliding). This yields two regions $P_1(x,\theta,\theta_1)$ and $P_2(x,\theta,\theta_1)$ where another rod could be located to cause a collision (see Figure \ref{fig:2_1}).
\begin{figure}[htbp]
\centering
    \includegraphics[width=0.7\textwidth]{images/collision_box.PNG}
    \caption{Geometry of the collision scheme considered in our model. $P_1$ is the set of heads of rods with orientation $\theta_1$ that will hit the side of the rod with orientation $\theta$ having its head at $x,$ at time $t,$ when it moves for $\Delta t$ units of time. Likewise, a rod with orientation $\theta$ at $x$ at time $t$ will hit the side of a rod with orientation $\theta_1$ having its head in $P_2$ at time $t.$ $P_1$ is formed by vectors $le(\theta)$ and $v\drmt({\bf e}(\theta_1)-{\bf e}(\theta)).$ $P_2$ is formed by vectors $l{\bf e}(\theta_1)$ and $v\drmt({\bf e}(\theta_1)-{\bf e}(\theta)).$    
    }
    \label{fig:2_1}
\end{figure}





We can now use this setup to derive the change $\Delta f.$
\begin{equation}
\begin{split}
\Delta f(x,\theta,t) =& 
-(N-1)\int_{-\pi}^{\pi}\int_{P_2(x,\theta,\theta_1)}f_{2}(x,\theta,x_1,\theta_1,t)\,dx_1d\theta_1\\
&+(N-1)\int_{\theta-\pi/2}^{\theta+\pi/2}\int_{P_1(x,\theta,\theta_1)}f_{2}(x,\theta_1,x_1,\theta,t)\,dx_1d\theta_1\\
&+(N-1)\int_{\theta-\pi/2}^{\theta+\pi/2}\int_{P_1(x,\theta+\pi,\theta_1)}f_2(x,\theta_1,x_1,\theta+\pi,t)\,dx_1d\theta_1\\
% &:= N(-Q^-+Q^+_1+Q^+_2)
\end{split}
\end{equation}
To get a closed-form equation for $f$ we employ a commonly used assumption that 2-particle distribution $f_2(x,\theta,x_1,\theta_1,t)$ can be written as the product of the marginal distributions $f(x,\theta,t)$ and $f(x_1,\theta_1,t)$, i.e.
\begin{equation}\label{eqInd}
    f_2(x,\theta,x_1,\theta_1,t) {}={} f(x,\theta,t)f(x_1,\theta_1,t),
\end{equation}
for all pairs $(x,\theta)$ and $(x_1,\theta_1).$ This first-order moment closure is known as statistical independence, or molecular chaos, as it implies that the presence of one rod does not affect the probability of finding the other at the given position and orientation. Next, we write the integral terms using a Taylor expansion in $x_1$
\begin{equation}
f(x_1,\theta_1,t) = f(x,\theta_1,t) + \grad_xf(x,\theta_1,t)\cdot(x_1-x) + O(|x_1-x|^2),
\end{equation}
so that only an integral over $\theta_1$ remains. Note that $|x_1-x| = O(l)$ since two rods must be close to enable collision. A geometric computation shows that the regions $P_1$ and $P_2$ where collisions can take place have area $|P_1|=|P_2|=l v \drmt|\sin(\theta-\theta_1)|.$
Substituting the Taylor expansion into the expression for $\Delta_1 f$ and using the areas of $P_1$, $P_2$ with the integrals
\begin{equation}
\int_{P_2(x,\theta,\theta_1)} (x_1-x)\,dx_1{}={}\frac{l^2 v \drmt}{2}|\sin(\theta-\theta_1)| \, {\bf e}(\theta_1)+O(l^3v\drmt),
\end{equation}
and
\begin{equation}
\int_{P_1(x,\theta,\theta_1)} (x_1-x)\,dx_1{}={}\frac{l^2 v \drmt}{2}|\sin(\theta-\theta_1)| \, {\bf e}(\theta)+O(l^3v\drmt),
\end{equation}
we obtain
\begin{equation}
%\label{Model3:Delta}
\begin{split}
&    \Delta f(x,\theta,t) =(N-1)l v \drmt\int\limits_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|f(x,\theta+\pi,t)f(x,\theta_1,t)\,d\theta_1\\
&    {}-{}
    (N-1)l v \drmt\int\limits_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|f(x,\theta,t)f(x,\theta_1+\pi,t)\,d\theta_1\\
&    {}+{}\frac{(N-1)l^2 v \drmt}{2}\int\limits_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta_1,t)\left({\bf e}(\theta)\cdot\grad_xf(x,\theta,t)+{\bf e}(\theta+\pi)\cdot\grad_xf(x,\theta+\pi,t)\right)\,d\theta_1 \\
&    {}-{}\frac{(N-1)l^2 v \drmt}{2}\int\limits_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)| f(x,\theta,t)\left({\bf e}(\theta_1)\cdot\grad_xf(x,\theta_1,t)+{\bf e}(\theta_1+\pi)\cdot\grad_xf(x,\theta_1+\pi,t)\right)\,d\theta_1\\
&     {}+{}O(Nl^3v\drmt\max|f|\max|\grad_x^2f|){}+{}O(Nl^2\drmt^2).
\end{split}
\end{equation}
Dividing %\eqref{Model3:Delta}
the equation above
by $\Delta t$ and letting $\Delta t\to 0,$ we obtain the kinetic equation
\begin{equation}\label{eqn:kin1}
\partial_t f+v{\bf e}(\theta)\cdot\grad_x f =
(N-1)lv Q_0 + \frac{(N-1)l^2v}{2}Q_1 + O\left(Nl^3v\max|f|\max|\grad_x^2f|\right),
\end{equation}
where
\begin{equation}
Q_0 {}={}\int\limits_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|\left(f(x,\theta+\pi,t)f(x,\theta_1,t)-f(x,\theta,t)f(x,\theta_1+\pi,t)\right)\,d\theta_1,
\end{equation}
and

\begin{equation}
\begin{split}
Q_1{}&={}\int\limits_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta_1,t){\bf e}(\theta)\cdot\grad_x\left(f(x,\theta,t)-f(x,\theta+\pi,t)\right)\,d\theta_1\\
&-\int\limits_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta,t){\bf e}(\theta_1)\cdot\grad_x (f(x,\theta_1,t)-f(x,\theta_1+\pi))\,d\theta_1.
\end{split}
\end{equation}
In deriving $Q_1$ term we used the identity ${\bf e}(\theta+\pi)=-{\bf e}(\theta).$


We nondimensionalize equation \eqref{eqn:kin1} by setting $\tau{}={}L/v$ and rescaling the variables using 
\begin{equation}
\hat{x}=x/L,\quad \hat{t}= t/\tau,\quad \hat{f}(\hat{x},\theta,\hat{t})=L^{2} f(\hat{x}L,\theta,\hat{t}\tau).
\end{equation}
Dropping hats, the resulting scaled kinetic equation is
\begin{equation}
%\label{eqn:kin2}
\partial_t f+{\bf e}(\theta)\cdot\grad_x f =
\frac{(N-1)l}{L} Q_0 + \frac{(N-1)l^2}{2L^2}Q_1 + O\left(\frac{Nl^3}{L^3}\right),
\end{equation}
where we assumed that the variations in the kinetic density $f$ are bounded, that is $\max|f|\max|\grad^2_xf|\leq C.$ For a typical experiment with $N=1000$ \textit{M. xanthus} bacteria ($l=5\mu m$) on a domain of size $L=10^3\mu m,$  parameter $\frac{Nl}{L}=5$ and $\frac{Nl^2}{L^2}=0.025,$ and $\frac{Nl^3}{L^3}=0.000125.$ Thus, when $C$ is of order 1, as a reasonable approximation we keep only the first two terms on the right-hand side. We set $\kappa = \frac{N l^2}{2 L^2}.$ Parameter $\kappa$ is related to the mean free path, $d,$ and rod length $l$ as:
\[
\kappa\leq \frac{l}{2d},
\]
see \eqref{eq:kappa_bound} of the Appendix. The binary collision assumption fails if $d$ is of order $l$ or smaller, meaning that $\kappa$ should be small. In the numerical simulations in the subsequent sections, we will restrict $\kappa<0.5.$
The resulting kinetic equation becomes
\begin{equation}\label{eqn:kin3}
\partial_t f+{\bf e}(\theta)\cdot\grad_x f =
\frac{2\kappa L}{l}Q_0(f)+\kappa Q_1(f).
\end{equation}

In the model of alignment that we consider in this paper, a rod after an interaction assumes the orientation of the rod it collides with. The set of orientations $\theta_i,$ $\theta_i+\pi,$ 
$i=1,\ldots,k$, if
present initially, will be preserved by the dynamics of transport and collision. In such situations, the kinetic density $f$ is determined by the set of $2k$ densities of the corresponding orientations, and equation \eqref{eqn:kin3} can be written as a system of $2k$ partial differential equations for the orientation densities. An example of such a system is considered in the following sections. 


%%%%%%%%%%%%%%%%%%%%%%
%%%%%Section 3%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% SIMULATIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Numerical solutions and results from agent-based simulations for case study}

To test the accuracy of our first-order kinetic equations, we compare the behavior of their numerical solutions to agent-based simulations for a simple test case. The agent-based model will implement the alignment dynamics of a finite set of rods colliding based on the physical rules from which the kinetic equations were derived. For our comparisons, we will focus on two interacting bands of rods with distinct orientations given by angles $\theta_1 = \pi/4$ and $\theta_2 = 3\pi/4$. This ensures no additional orientations beyond the original two appear as a result of collisions. We will consider both models in the spatial domain $(x,y) \in \Omega = [0, \, L] \times [0, \, L]$ with periodic boundary conditions.

\subsection{A model with two orientations}
%Simplified kinetic equations}
\label{sec:two_conservative}
Consider equation \eqref{eqn:kin3} for distributions with two orientation angles $\theta_1$ and $\theta_2$ with $|\theta_2-\theta_1|\leq \pi/2.$ In this case there is no nematic alignment, and the term $Q_0(f)$ vanishes and the kinetic equation becomes
\begin{equation}
%\label{eqn:kin2}
\partial_t f+{\bf e}(\theta)\cdot\grad_x f = \kappa Q_1.
\end{equation}

We are restricting rods to two possible orientations, therefore we can substitute $f(x,\theta,t) = \rho_1(x,t)\delta(\theta - \theta_1) + \rho_2(x,t)\delta(\theta - \theta_2)$, yielding a system for ${\bf \rho} = (\rho_1,\rho_2)$ of the form
\begin{equation}
    \label{Model3:2angles}
    \partial_t{\bf \rho} + A({\bf \rho})\partial_x{\bf \rho} + B({\bf \rho})\partial_y{\bf \rho} {}={} 0
\end{equation}
where the matrices $A$ and $B$ are given by
\[
A{}={}
\left[
\begin{array}{rr}
\cos(\theta_1)-\kappa\cos(\theta_2)\rho_2 &\quad \kappa\cos(\theta_1)\rho_1 \\
\kappa\cos(\theta_2)\rho_2 &\quad \cos(\theta_2)-\kappa\cos(\theta_1)\rho_1
\end{array}
\right],
\]
\[
B{}={}
\left[
\begin{array}{rr}
\sin(\theta_1)-\kappa\sin(\theta_2)\rho_2 &\quad \kappa\sin(\theta_1)\rho_1 \\
\kappa\sin(\theta_2)\rho_2 &\quad \sin(\theta_2)-\kappa\sin(\theta_1)\rho_1
\end{array}
\right].
\]

To simplify these kinetic equations to a form easily analyzed, we will assume that all densities vary only in the spatial direction $x$. In this setting, the system (\ref{Model3:2angles}), with $\theta_1=\frac{\pi}{4},$ $\theta_2=\frac{3\pi}{4}$, can be written in conservation form as
\begin{equation}\label{Model4:2angles_sim}
    \begin{split}
    \partial_t\rho_1 + \frac{\sqrt{2}}{2}\partial_x\left(\rho_1\left[1-\kappa\rho_2\right]\right)  {}&={}0\\
    \partial_t\rho_2- \frac{\sqrt{2}}{2}\partial_x\left(\rho_2\left[1-\kappa\rho_1\right]\right)  {}&={}0.
    \end{split}
\end{equation}
We restrict ourselves to the regime $0 < \kappa < 0.5$ (see Appendix \ref{append:mfp} for the underlying rationale based on enforcing the mean free path of rods is greater than the rod length $l$). We will consider a test case with two waves moving toward each other over a background density. The linear factor $1-\kappa\rho_i$ inside the spatial derivative will decrease both the left-and right-moving density profiles' speeds when they interact. In other words, the collisions in this model effectively result in a local decrease in the velocity, reflecting the fact that when a rod re-orients, its head is located behind the head of the rod it hits relative to the struck rod's direction of motion. Finally, we impose symmetric initial conditions for the profile. Each is a Gaussian wave (with maximum amplitude set below the bound established in Appendix \ref{append:hyper}) moving over a uniform background density of rods. The system \eqref{Model4:2angles_sim} is then solved numerically using the method described in Appendix \ref{append:num}.


\subsection{Agent-based model setup}

For the agent-based model, we set the domain size to $L = 400$ and the velocity to $v = \sqrt{2}$. Denote by $N$ the number of rods that will be used in the agent simulations. The initial locations of the rods were determined by first scaling the initial conditions of the kinetic equations to create probability densities, then sampling from them. Collisions between rods were determined using the schematic in Figure \ref{fig:2_1}. If a rod would collide with multiple rods in a single time step, it was assumed that it collided with the first rod in its path to ensure collisions are binary. We restricted the mean-free path of rods to be greater than the rod length $l$ based on the physical timescale of reorientation $l/v$ (see Appendix \ref{append:mfp}). Therefore, to speed up computational time we took time steps of $\Delta t = l/v$.

As the simulation is deterministic after initial rod positions are set, we combined  1000 simulations with random initial positions to average random fluctuations and recover the mean behavior. Since the solutions of system \eqref{Model4:2angles_sim} are 1D in space, we compared them to agent-based simulations as follows. By looking only at the $x$-coordinates in the set of simulated rods over all agent simulations, we constructed a 1D kernel density estimate (KDE). The resulting density profiles were then scaled to probability densities on $x \in [0, \, 1]$ and compared to the density profiles from the numerical solutions of the kinetic equations.







\subsection{Discrepancy between agent-based model and kinetic equations due to cluster formation}

%Agent-based model fails to match kinetic model even for large $N$
Our agent-based simulations deviate from the numerical solutions of the kinetic equations, with the latter exhibiting a far less pronounced change in the density profile shape (Figure \ref{fig:4} A\&B). The peaks of the density profiles for both orientations slow down slightly as they approach each other, but the slowdown and the increase in the peak density are much greater in the agent framework. If this discrepancy is due to not being near the limit $N \to \infty$, $l \to 0$ with $\kappa$ held constant, increasing the number of simulated rods while keeping $\kappa \propto Nl^2$ fixed should theoretically improve the agreement. However, we see that this is not the case (Figure \ref{fig:4}C). The simulations using higher numbers of rods showed greater discrepancies. This suggests the disagreement is due to one or more flaws in the assumptions used to derive the kinetic equations.

\begin{figure}[htbp]
\centering
    \includegraphics[width=\textwidth]{images/fig3.png}
    \caption{A) Numerical solution of the kinetic equations for $\kappa = 0.1$. B) Density profile for agent-based simulations for $\kappa = 0.1$ with $N = 2856$ rods. C) Density profile for agent-based simulations for $\kappa = 0.1$ with $N = 45700$ rods. (Inset) The discrepancy at the final time between the kinetic model density profile and the density profile from agent simulations for various numbers of rods. The results indicate that the agent simulations show much greater changes in the density profile and do not converge to the kinetic model in the limit $N \to \infty$, $l \to 0$.}
    \label{fig:4}
\end{figure}


%The loss of statistical independence can be theoretically linked with cluster formation.
The key assumption used in deriving the Boltzmann-type equation was the statistical independence of the joint probability distribution \eqref{eqInd}. This allowed us to express the probability that a pair of rods would have a spatial configuration leading to a collision in terms of the probability of each rod individually occupying the corresponding spatial region. This assumption is invalid if there are correlations between rods. Such correlations appear in clusters of aligned rods since they have a high chance of having similar orientations due to collisions. Our collision scheme results in both rods possessing the same orientation, so cluster formation is possible and would be a violation of our assumption of statistical independence.


%Our agent simulations show clusters form and grow over time, with the rate of growth increasing for higher kappa.
To measure the clustering present in our agent simulations, we used a standard algorithm based on Euclidean distance to group rods. The minimum distance between the heads of rods was picked to be the length of a rod $l$. We then measured the proportion of rods in clusters of size 4 or more (Figure \ref{fig:5}A). As expected, clusters grew over time in our agent simulations, with the rate of growth increasing with $\kappa$ for fixed $N$. This increase in $\kappa$ corresponds to a greater rod length, increasing the chance of collisions between rods.


\subsection{Quantifying loss of statistical independence}
% The loss of statistical independence is calculated using a global average of a coarse-grained approximation.
Since cluster formation is linked to a loss of statistical independence \cite{hanke_understanding_2013,thuroff_critical_2013,ihle_towards_2014}, we next quantified the extent of this loss. Observing a rod with orientation $\theta_1$ would decrease the probability of a nearby rod having orientation $\theta_2$. We can use this idea to computationally check the quantity $f_2(x_1,\theta_1,x_2,\theta_2,t) - f(x_1,\theta_1,t)f(x_2,\theta_2,t)$ in our agent simulations to see if a loss of independence is present. To do this, we first divided our domain $\Omega = [0, \, L] \times [0, \, L]$ into $2^{10}$ square subregions $\Omega_{ij}$, $i,\, j = 1,\dots,2^5$. We then calculated coarse-grained approximations of the joint and marginal distributions in two steps. First, we calculated the proportion of rods for each orientation and the proportion of rod pairs with distinct orientations in each subregion. The local estimates of $f_2^{ij}(\theta_1,\theta_2,t)$, $f^{ij}(\theta_1,t)$, and $f^{ij}(\theta_2,t)$ in each subregion were then obtained by averaging over all 1000 simulations. We chose as a local metric of independence the relative difference between the averages of the joint distribution function and the product of the marginals given by
\begin{equation}
E_r^{ij}(t) = (f_2^{ij}(\theta_1,\theta_2,t) - f^{ij}(\theta_1,t)f^{ij}(\theta_2,t))/(f^{ij}(\theta_1,t)f^{ij}(\theta_2,t)).
\end{equation}
We finally obtain a global average of the local estimate
\begin{equation}\label{eqn:error}
E_r(t) = \langle E_r^{ij}(t) \rangle_{ij}
\end{equation}
by averaging over all subregions.

% The loss of statistical independence is similar to the results of cluster growth.
As shown in Figure \ref{fig:5}B, the metric $E_r(t)$ shows similar trends over time to the cluster formation. The loss of statistical independence increases over time, with higher values of $\kappa$ showing a greater loss for fixed $N$. The fact that $E_r$ is negative reflects the fact that the chance of finding a pair of rods with different orientations is lowered from what is expected if statistical independence held true.


\begin{figure}[htbp]
\centering
    \includegraphics[width=\textwidth]{images/fig4.png}
    \caption{A) The percentage of rods in clusters with more than 4 rods over time. This quantity grows over time as rods collide and co-orient. B) The loss of statistical independence $E_r(t)$ from \eqref{eqn:error} between the two sets of rods with different orientations. The negative values growing over time indicate that it becomes rarer to see nearby rods having different orientations, indicating cluster formation. C) Snapshots of an agent simulation at the end of a simulation. The snapshot is taken at the center of the domain where the two waves interact.}
    \label{fig:5}
\end{figure} 

%Data collapse suggests increased rod collision are responsible for increased clustering and loss of statistical independence with higher values of kappa.
Since cluster formation is the result of co-alignment between rods upon collision, it is natural to see if the increase in cluster growth with higher values of $\kappa$ is due to a greater number of collisions. Calculating the mean number of collisions per rod by time $t$ shows that the number does increase as $\kappa$ increases (Figure \ref{fig:6}A). Furthermore, there is strong evidence of data collapse when plotting both the proportion of rods in clusters (Figure \ref{fig:6}B) and the loss of statistical independence versus the cumulative number of collisions per rod (Figure \ref{fig:6}C). There is a slight difference in the rescaled curve for $\kappa = 0.1$ compared to the other two curves. This is the result of some rods starting in clusters at $t = 0$ at higher densities. The reasons for the deviation in the rescaled $E_r$ cure for $\kappa = 0.1$ is less clear but could be the result of cluster-cluster interactions once most rods reside in such clusters. The rescaling is based on rod-rod collisions, so cluster-cluster interactions might not fully be accounted for.


\begin{figure}[htbp]
\centering
    \includegraphics[width=\textwidth]{images/fig5.png}
    \caption{A) The total number of collisions experienced on average per rod over time for $\kappa = 0.001$ (blue), $\kappa = 0.01$ (orange), and $\kappa = 0.1$ (purple). B) The fraction of rods in clusters with more than 4 rods versus the mean number of collisions experienced per rod by time $t$. This is plotted for $\kappa = 0.001$ (blue), $\kappa = 0.01$ (orange), and $\kappa = 0.1$ (purple) C) The loss of statistical independence $E_r(t)$ between the joint and marginal distributions for the two sets of rods with different orientations versus the mean number of collisions experienced per rod by time $t$. Both figures show some data collapse when compared to Figure \ref{fig:4}, especially for low mean rod collisions per rod.}
    \label{fig:6}
\end{figure} 



% \subsection{Agent simulations can better match the kinetic model when clusters are destroyed by the addition of vertical diffusion}
\subsection{Improving agreement between agent simulations and kinetic equations by inhibiting cluster formation}

% The introduction of diffusion in the y-direction can destroy clusters without changing the kinetic equations in the x-direction.
While the results of our simulations have indicated close links between cluster formation, loss of independence, and the discrepancy between the equations and agent simulations, they have not shown a strict cause and effect. To illustrate that clustering is the main cause of the discrepancy, we introduce diffusion in $y$-direction into our agent simulations. The addition of this noise will cause rods forming a cluster to slowly drift apart at a rate dependent on the noise strength. This addition will not impact the test case we considered for the kinetic model. Since initial conditions are constant in the $y$-direction, the system given in \ref{Model4:2angles_sim} will remain unchanged by the vertical diffusion. 

% Vertical diffusion restores agreement between the agent simulations and the kinetic equations up to a point.
We implemented the same sets of agent simulations as before ($N = 2856$, $\kappa = 0.1$) with the addition of different levels of noise $\sigma$. Agent rods step in the $y$-direction a random distance drawn from a normal distribution $N(0,\sigma)$ every $\Delta t = l/v$. Since agent simulations are run with unscaled variables, we nondimensionalize the noise by using the scaling $\sigma \rightarrow \sigma/(l/\sqrt{2})$ in order to compare the strength of the noise to the rod length $l$. The results of these simulations show that the addition of noise in the $y$-direction improves agreement between the agent simulations and the kinetic equations, with the former now resembling the latter for a sufficient level of noise (Figure \ref{fig:7}A). Increasing the noise strength from zero reduces the measured discrepancy between the kinetic and agent density profiles (Figure \ref{fig:7}B) and decreases the proportion of rods in clusters (Figure \ref{fig:7}C). However, the discrepancy is reduced only up to a point. Once the strength of the scaled noise exceeds roughly $1$ (corresponding to the standard deviation of the normal distribution equaling the projection of a rod in the y-direction), the discrepancy increases slightly before plateauing. Why this is the case is unclear; however, the reduction in clustering slows down at around the same level of noise. It is possible that there are some aspects of rod correlations that the added diffusion does not affect. For example, our collision scheme results in both rods having similar x-coordinates. The addition of vertical diffusion does not change this either. Therefore, successive collisions result in more rods sharing similar x-coordinates, and potentially forming vertical bands of rods, regardless of vertical diffusion.



\begin{figure}[!htbp]
\centering
    \includegraphics[width=0.8\textwidth]{images/fig6.png}
    \caption{A) Density profile for agent-based simulations with $y$-directional scaled noise of $1.06$ for $\kappa = 0.1$ with $N = 2856$ rods. A scaled noise level of 1 corresponds to an agent rod's vertical movement over time $\Delta t = l/v$ being distributed normally as $y(t+dt)-y(t) \sim N(l \sin(\theta_i), l \sin(\theta_i)) = N(l/\sqrt{2}, l /\sqrt{2})$ in between collisions, or equivalently to a vertical diffusion coefficient of $l^2/4$.   B) Percentage of rods in clusters with more than 4 rods versus noise in $y$-direction. Increasing the noise in the vertical direction decreases the proportion of rods in larger clusters C) Discrepancy between the kinetic model and the agent-based simulations for different levels of white noise in the $y$-direction. The discrepancy initially drops sharply but then increases slightly once the strength of the noise increases past $1$, the length of a rod projected in the y-direction. Snapshots of agent simulations near noise levels of $0$, $1$, and $2$ are shown on the right. The snapshots are taken at the final time in the center of the domain ($[150,\, 250]\times[150,\, 250]$) where the two waves interact.}
    \label{fig:7}
\end{figure} 





\newpage 

\section{Discussion}
% Our simulation's resulting dynamics do not match the kinetic model due to the formation of clusters that violate our assumption of statistical independence. 
In this paper, we developed a kinetic model for the alignment of self-propelled hard rods where collisions result in asymmetric alignment. Using this model, we showed Boltzmann formalism severely underestimates the change in rod density profiles when two opposing waves of rods interact. We explicitly measured the loss of statistical independence that invalidates the classic assumption of molecular chaos Boltzmann-type equations rely on. Such a loss corresponds to the formation of rod clusters due to alignment from binary rod collisions. Our results mirror those in other studies \cite{hanke_understanding_2013,thuroff_critical_2013}, however, we have built upon these works by showing that mechanisms that destroy or inhibit cluster formation help restore agreement between the kinetic model and agent-based implementations of the microscopic alignment rules. As this discrepancy occurs even in the simple setup we consider, our work highlights the need to extend current methodologies beyond Boltzmann-type kinetic equations in order to accurately capture the properties of active matter in biological systems.

%implications of the kinetic model UNDERESTIMATING the level of interactions resulting from cluster formation and implications for biological problems. Relation to studies showing binary interactions can be insufficient to explain the strength of the alignment of fibers?


% Boltzmann formalism can fail because of non-binary collisions or loss of statistical independence.
Boltzmann's hypothesis can be justified when the mean free path is large compared to the range of local interactions, however, this is rarely satisfied at realistic densities when ordered motion is established \cite{pismen_active_2021}. Additionally, several studies have indicated that rapid cluster formation can lead to a strong violation of the molecular chaos assumption needed in the Boltzmann approach \cite{hanke_understanding_2013,thuroff_critical_2013}. While gradual alignment results in a better match, in principle any collision rule between particles resulting in alignment can cause correlations to appear. Such collisions are prevalent in collective dynamics at the cellular level due to a low Reynolds number, where cells must actively exert energy to maintain their motion. This is in contrast to Boltzmann gas dynamics, where collisions are assumed to be non-elastic and conserve momentum, resulting in particles simply bouncing off each other. In addition to violations of Boltzmann's hypothesis, the assumption of binary interactions used in such models is not enough to reproduce the observed dynamics in some biological systems \cite{suzuki_polar_2015}. Binary interactions can simply be too weak to produce the alignment seen experimentally, even when corrections are made to account phenomenologically for correlations. These breakdowns of Boltzmann-type models suggest they are an overly-simplistic approach to modeling the emergence or stability of collective alignment. The emergence of local order almost by definition involves the breakdown of statistical independence and the growth of correlations as agents align and start moving together, violating Boltzmann's hypothesis.

% Possible alternatives to Boltzmann formalism include kinetic modeling of clusters of various sizes, higher-order moment closures in BBGKY hierarchy, and additions to correct equations in the presence of correlations.
There are several ways to extend kinetic models to incorporate orientational correlations. Perhaps the simplest is to explicitly extend the kinetic model to explicitly include equations for clusters of various sizes. Gain and loss terms for these additional equations are then the natural result of collisions among clusters and rods \cite{peruani10,weber_role_2013}. Peruani et al (2010) developed a framework where cluster size was explicitly tracked in a hierarchy of equations, while Weber et al (2013) \cite{weber_role_2013} considered a simplified framework with two reaction equations for clusters and single cells. Another set of approaches for incorporating correlations involves direct modifications to the moment closure method. A simple example is replacing the joint distribution $f_2(x_1,\theta_1,x_2,\theta_2,t)$ with $\chi(\theta_2-\theta_1)f(x_1,\theta_1,t)f(x_2,\theta_2,t)$, where $\chi(\theta_2-\theta_1)$ is a phenomenological term accounting for correlations between different angles \cite{suzuki_polar_2015}. More sophisticated methods involve higher-order moment closures of the BBGKY hierarchy \cite{Bogoliubov1946, balagam14b, Grad1949}) using the so-called cluster expansion that explicitly incorporates the evolution of the joint distribution $f_2$ \cite{CercignaniBook}. Such an approach was used by Chou and Ihle for Vicsek-style models to extend beyond mean-field theory \cite{chou_active_2015}. With the rapid advancement of biological studies in the last decades, developing and applying new analytical models to understand active matter in biology is of crucial importance. Creating a tractable class of models that can capture correlations or non-binary interactions would provide a cornerstone for this young field.


\section{Acknowledgments}
Research is supported by National Science Foundation Division of Mathematical Sciences awards 1903270 (to M.P. and I.T.) and 1903275 (to OAI and PM).
We also would like to thank prof. D. Kuzmin (TU Dortmund) for helpful discussions on the numerical methods for the kinetic model presented in this paper.


\newpage


% \newpage




\begin{appendix}

%%%%%%%%%Mean Free Path%%%%%%%%%%
\section{Mean free path}\label{append:mfp}

The mean free path (MFP) is defined as the average distance that a rod moves between collisions. This distance can be computed as the product of the speed $v$ and the time $\tau$ a rod moves between re-orientations. To estimate $\tau,$ we first compute the number of rods with orientation ${\bf e}(\theta)=(\cos\theta,\sin\theta)$ that 
will collide with a given rod (rod 1) in the time $[t^*, t^*+\Delta t]$, were $t^*$ marks the last change in rod 1's orientation. Without loss of generality, we consider rod 1 as moving horizontally to the right, as in Figure \ref{mfp}. Suppose that a coordinate system is chosen so that the rod is at rest. Then the velocity of rods with orientation $\theta$ is described by the vector ${\bf w}{}={}v(\cos\theta-1,\sin\theta).$ The heads of the rods that rod 1 can collide with are located in a parallelogram $P$ formed by vectors ${\bf w}\drmt$ and $l {\bf e}(\theta).$ The area of this parallelogram equals $|\sin\theta|vl\drmt.$ Using that $Nf(x,\theta,t^*)$ is the local number of rods with a given orientation, we estimate the number of collisions with $\theta$-oriented rods in time $dt$ as $vl N f(x,\theta,t^*)|\sin\theta|\drmt,$ which is maximized at $\theta=\pi/2.$ 
Thus, the number of collisions over all orientations in $\Delta t$ time can be estimated as
\[
v l N \drmt\int f(x,\theta,t^*)\,d\theta{}\leq{} n(x) v l \drmt,
\]
where $n(x,t^*)$ is the local rod number density.
From this, we obtain an upper bound for the frequency of collisions as $n(x,t^*)vl$. The time between collisions and the MFP are then bounded by
\[
\tau \geq \frac{1}{n(x,t^*)vl},\quad 
d \geq \frac{1}{n(x,t^*)l}.
\]
Note that both $\tau$ and the MFP $d$ are local quantities depending on $x.$

\begin{figure}[!htbp]
\centering
\includegraphics[width=\textwidth]{images/figA2.png}

\caption{Vector geometry used in the estimation of the MFP. A) rod at $x$ where ${\bf e}(\theta)=(\cos\theta,\sin\theta)$ moves with velocity $v {\bf e}(\theta).$ In a reference coordinates of a horizontally moving rod with velocity $(v,0),$ the rod velocity is ${\bf w}.$ B) a rod moving horizontally to the right, during time interval $[t^*,t^*+\Delta t]$ can collide with a rod which has orientation ${\bf e}(\theta)$ whose center is located in the parallelogram P, formed by vectors ${\bf w}\drmt$ and $l{\bf e}(\theta).$ The area of the parallelogram equals $|\sin\theta|v l \drmt.$
\label{mfp}}
\end{figure} 

For the model we consider in this paper, we restrict the MFP to $d\geq l$. The rationale behind this is physics-based. When two rods collide, there is a characteristic time scale for reorientation to occur given by $\tau_\theta = l/v$ \cite{balagam15b}. Therefore it makes sense to restrict the mean time between collisions $\tau$ to the regime $\tau \geq \tau_\theta = l/v$. This naturally yields $d \geq l$.

Our assumption that $d\geq l$ puts a restriction on the local density of the form $n(x,t^*)l^2\leq1,$ and subsequently on the parameter $\kappa$ of the form
\begin{equation}
\label{eq:kappa_bound}
\kappa = \frac{Nl^2}{2L^2}\leq \frac{1}{2}l^2\max_x\,n(x,t^*)\leq\frac{1}{2}.
\end{equation}
Here we use that $N/L^2$ is a lower bound on the maximum of $n(x,t^*).$ Note that we cannot have $\kappa = 0$ without the local density being identically 0.











%%%%%%%%%Hyperbolicity Regime%%%%%%%%%%
\section{Domain of hyperbolicity of system of equations\eqref{Model4:2angles_sim}}\label{append:hyper}
Here we will determine conditions under which system \eqref{Model4:2angles_sim} is hyperbolic. The system is given by
\begin{equation}
    \begin{split}
    \partial_t\rho_1 + \partial_x\left[\rho_1(1-\kappa\rho_2)\right]  {}&={}0\\
    \partial_t\rho_2- \partial_x\left[\rho_2(1-\kappa\rho_1)\right]  {}&={}0,
    \end{split}
\end{equation}
where $\kappa = \dfrac{Nl^2}{2L^2}$. Denote the column vector $U=(\rho_1,\rho_2)^T$ and column of the  fluxes $F(U)=\frac{\sqrt{2}}{2}(\rho_1-\kappa\rho_1\rho_2,-\rho_2+\kappa\rho_1\rho_2)^T.$ Then the system of equations is expressed as
\[
\partial_t U + \grad_U F(U){}={}0.
\]
The system is hyperbolic if the eigenvalues of the gradient matrix 
\[
\grad_U F(U){}={}
\left[
\begin{array}{cc}
1-\kappa\rho_2 & -\kappa \rho_1\\
\kappa \rho_2 & -1+\kappa\rho_1
\end{array}\right]
\]
are real. The eigenvalues equal
\[
\lambda_\pm = \frac{1}{\sqrt{2}}\left(
\kappa(\rho_1-\rho_2) \pm \sqrt{\kappa^2(\rho_1-\rho_2)^2 + 4 - 4\kappa(\rho_1+\rho_2)}\right).
\]
Thus, the system is hyperbolic whenever
\[ 
\kappa^2(\rho_1-\rho_2)^2 + 4 - 4\kappa(\rho_1+\rho_2)\geq 0
\]
with a sufficient condition
\[
\kappa(\rho_1+\rho_2)\leq 1.
\]
Since \eqref{eq:kappa_bound} implies $\kappa < 0.5$, our kinetic model \eqref{Model4:2angles_sim} must be restricted to cases where the sum of the maximum density profiles for $\rho_1$ and $\rho_2$ total less than 2.



%%%%%%%%%Numerical Methods%%%%%%%%%%
\section{Numerical Methods}\label{append:num}

 We express the system in \eqref{Model4:2angles_sim} in flux form
\begin{equation}
\partial_t U = - \partial_x F, 
\end{equation}
with $U = (\rho_1, \rho_2)^T$ and $F=A(\rho_1, \rho_2)^T$. In particular,
for two orientations $\pi/4$ and $3\pi/4$ the
fluxes become
$F_1 = \rho_1(1+\rho_2)$ and $F_2 = \rho_2(1+\rho_1)$.
Next, we discretize the equation in space and time using the Lax-Friedrichs method \cite{LeVeque2002}
\[
U_i^{n+1} = U_i^n - \frac{\Delta t}{\Delta x}
[\hat{F}_{i+1/2} - \hat{F}_{i-1/2}]
\]
and define 
\[
\hat{F}_{i+1/2} = \frac{F(U_{i+1}^n) + F(U_i^n)}{2} - \frac{K}{2}(U_{i+1}^n - U_i^n)
\]
where $K=\cos(\theta_1)(1+|\sin(\theta_2-\theta_1)|)$ is the upper bound on the speed of propagation given $\rho_1, \, \rho_2 <1$. Therefore, the CFL condition for the scheme above is $K\Delta t / \Delta x < 1$, and the additional diffusion introduced by the scheme is proportional to $D = K \Delta x / 2$. The scheme is first order in space and time, but we found that it was sufficient for our simulations.

%%%%%%%%%Mode with 4 orientations%%%%%%%%%%
%\section{A model with 2 nematic orientations}\label{append:2nematic}




\end{appendix}

\bibliographystyle{plain}
\bibliography{referencesMain}
% \bibliographystyle{Definitions/ws-m3as}



















\end{document}




% Assumptions behind collision scheme are binary collisions and discrete steps for dynamics.
Our goal is to derive a tractable kinetic description of a system of $N$ self-propelled rods of length $l$ moving at constant speed $v$, starting from a microscopic description of collisions. We first define a probability density $f(x,\theta,t)$ for the probability a rod with orientation $\theta$ has its head located at $x$ at time $t$. We will next derive a kinetic equation for $f$ by finding an expression for the change in $f$ over a single time step of size $dt$. To this end, we make several assumptions about rod collisions. First, we assume that collisions are binary events, with the striking rod reorienting to match the struck rod's orientation modulo $\pi$. This results in the nematic alignment of rods. Motivated by \textit{M. xanthus} dynamics, we further assume that reorientation occurs through the head of the rod.






We start by modeling the dynamics as proceeding in discrete time steps. Reorientations can occur at time points $t_n=ndt$, where $dt$ is chosen to be small enough to ensure a rod experiences at most one collision in $dt$ time. Rod motion is ballistic in the time intervals $[t_n,t_{n+1}]$. We assume that collisions leading to this reorientation occur in the time interval $[t_n-dt/2,t_n+dt/2]$. This modeling approach is valid when the mean free path of rods between collisions is greater than $v dt$. In this regime, rapid sequential collisions are unlikely. Therefore the probability of a rod experiencing a collision at time $T \in [t_n-dt/2,t_n+dt/2]$ is approximately uniform, making it reasonable to assume collisions occur in the middle at $T = t_n$. 
%Realistically, reorientation does not take place instantaneously but over a period of time with a characteristic timescale given by $l/v$, where $l$ is the length of a rod and $v$ is its velocity (citation?).

% Collision parallelograms
We next establish a rule for what determines if a collision occurs. Rods will reorient at $t_n$ if they experience a collision, then move with a ballistic motion for $dt$ time at speed $v$ with their given orientation $\theta$. At this time point $t_{n+1}$, another reorientation is possible, and the pattern of motion continues. Since $t_n$ can be considered a mean time for a collision event in $[t_n-dt/2,t_n+dt/2]$, we determine if a given rod will experience a collision by determining if its head could collide with the body of another rod in this time interval. The associated geometry is determined by fixing a spatial location $x$ and considering two cases using two (non-interacting) rods with orientations $\theta$ and $\theta_1$ and heads at $x$. We then look at the sets of collisions in the next $dt$ time that will result in either a gain of a rod with orientation $\theta$ (due to a collision with a $\theta$-rod) or an equivalent loss (due to the $\theta$-rod colliding). This yields two regions $P_1(x,\theta,\theta_1)$ and $P_2(x,\theta,\theta_1)$ where another rod could be located to cause a collision (see Figure \ref{fig:2}). We can now use this setup to derive the change in the probability density $f(x,\theta,t)$ over the time interval $[t_n,t_{n+1}]$.

\begin{figure}[htbp]
\centering
    \includegraphics[width=0.7\textwidth]{images/fig2.png}
    \caption{Geometry of the collision scheme considered in our model. A rod with orientation $\theta_1$ (take to be 0 here) at $x$ at time $t_n$ will collide with a rod with orientation $\theta$ in the region $P_1$ sometime in the interval $[t_n-dt/2, t_n+dt/2]$. Likewise, a rod with orientation $\theta$ at $x$ at time $t_n$ will collide with a rod with orientation $\theta_2$ in the region $P_2$ sometime in the interval $[t_n-dt/2, t_n+dt/2]$.}
    \label{fig:2}
\end{figure} 

Define $f_n(x,\theta) = f(x,\theta,t_n)$. The change in the probability density during $[t_n,t_{n+1}]$, given by
\begin{equation}
\Delta f_n(x,\theta) \equiv f_{n+1}(x,\theta)-f_n(x,\theta),
\end{equation}
can be rewritten as
\begin{equation}
\begin{split}
\label{Model3:Delta}
\Delta f_n(x,\theta) &{}={} f_{n+1}(x,\theta) - \hat{f}_n(x,\theta)
{}+{}\hat{f}_n(x,\theta)-f_n(x,\theta)\\
&{}={} f_{n+1}(x,\theta) - f_{n+1}(x+{\bf e}(\theta)vdt,\theta)
{}+{}\Delta_1 f_n(x,\theta).
\end{split}
\end{equation}
Here ${\bf e}(\theta) = (\cos(\theta),\sin(\theta))$ is a unit vector capturing the direction of a rod's ballistic motion, $\hat{f}_n$ describes the values of $f_n$ after collisions have occurred, and $\Delta_1 f_n(x,\theta)$ is defined as
\begin{equation}
\Delta_1 f_n(x,\theta) := \hat{f}_n(x,\theta)-f_n(x,\theta).
\end{equation}

The change in the probability density $f_n$ due to collisions, $\Delta_1 f_n(x,\theta)$, is found by first considering the change in the number of rods with a given orientation at a given position, i.e. $N\Delta_1 f_n(x,\theta)$. For a fixed location $x$ and orientation $\theta$, we then sum the probabilities for all possible collisions. This is done by first integrating the probability of finding a pair of rods at $x$ and $x_1$ with orientations $\theta$ and $\theta_1$ over the parallelograms $P_1$ and $P_2$ illustrated in Figure \ref{fig:2}B, then integrating again over all possible values of $\theta_1$. This probability is given by the joint density function (distribution for a pair of rods) $f_2(x,\theta,x_1,\theta_1,t_n) := f_{2,n}(x,\theta,x_1,\theta_1)$. Multiplying the resulting probability of collision by the number of possible pairs of rods $N(N-1)$ gives us the number of reorientations that can occur
\begin{equation}
\begin{split}
N\Delta_1 f_n(x,\theta) =& 
-N(N-1)\int_{-\pi}^{\pi}\int_{P_1(x,\theta,\theta_1)}f_{2,n}(x,\theta,x_1,\theta_1)\,dx_1d\theta_1\\
&+N(N-1)\int_{\theta-\pi/2}^{\theta+\pi/2}\int_{P_2(x,\theta,\theta_1)}f_{2,n}(x,\theta,x_1,\theta_1)\,dx_1d\theta_1\\
&+N(N-1)\int_{\theta-\pi/2}^{\theta+\pi/2}\int_{P_1(x,\theta+\pi,\theta_1)}f_{2,n}(x,\theta,x_1,\theta_1+\pi)\,dx_1d\theta_1\\
% &:= N(-Q^-+Q^+_1+Q^+_2)
\end{split}
\end{equation}
where the two integrals over $P_1$ account explicitly for two possible collision cases that end up with the orientation $\theta$ due to nematic alignment. Note that a factor of $N$ can be divided from each side to isolate $\Delta_1 f_n(x,\theta)$.

To get a closed-form equation for $f$ we employ a commonly used assumption that the joint probability distribution $f_{2,n}(x,\theta,x_1,\theta_1)$ of finding a pair of rods at $x$ with orientation $\theta$ and at $x_1$ with orientation $\theta_1$ can be written as the product of the marginal distributions $f_n(x,\theta)$ and $f_n(x_1,\theta_1)$. This first-order moment closure is known as statistical independence, or molecular chaos, as it implies that the presence of one rod does not affect the probability of finding the other at the given position and orientation. With this assumption, we can substitute
\begin{equation}\label{eqInd}
\begin{split}
    f_{2,n}(x,\theta,x_1,\theta_1) &{}={} f_n(x,\theta)f_n(x_1,\theta_1)\\ f_{2,n}(x,\theta,x_1,\theta_1+\pi) &{}={} f_n(x,\theta)f_n(x_1,\theta_1+\pi)
\end{split}
\end{equation}
Next, we will simplify the integral terms using a Taylor expansion in $x_1$
\begin{equation}
f_n(x_1,\theta_1) = f_n(x,\theta_1) + \grad_xf_n(x,\theta)\cdot(x_1-x) + O(|x_1-x|^2),
\end{equation}
so that only an integral over $\theta_1$ remains. Note that $(x_1-x) = O(l)$ since two rods must be close to enable collision. A geometric computation shows that the regions $P_1$ and $P_2$ where collisions can take place have area $|P_1|=|P_2|=l v dt|\sin(\theta-\theta_1)|.$
Substituting the Taylor expansion into the expression for $\Delta_1 f_n$ and using the areas of $P_1$, $P_2$ with the integrals
\begin{equation}
\int_{P_2(x,\theta,\theta_1)} (x_1-x)\,dx_1{}={}\frac{l^2 v dt}{2}|\sin(\theta-\theta_1)| \, {\bf e}(\theta_1)
\end{equation}
and
\begin{equation}
\int_{P_1(x,\theta,\theta_1)} (x_1-x)\,dx_1{}={}\frac{l^2 v dt}{2}|\sin(\theta-\theta_1)| \, {\bf e}(\theta),
\end{equation}
we obtain
% \begin{multline}\label{eqn:Q-}
%     Q^- = \int_{-\pi}^\pi l^2|\sin(\theta-\theta_1)|f_n(x,\theta)f_n(x,\theta_1)\,d\theta_1 \\
%     {}+{} \int_{-\pi}^\pi\frac{l^3}{2}f_n(x,\theta){\bf e}(\theta_1)\cdot\grad_xf_n(x,\theta_1)\,d\theta_1 {}+{}O(l^4),
% \end{multline}
% \begin{multline}\label{eqn:Q+1}
%     Q^+_1 = \int_{\theta-\pi/2}^{\theta+\pi/2} l^2|\sin(\theta-\theta_1)|f_n(x,\theta)f_n(x,\theta_1)\,d\theta_1 \\
%     {}+{} \int_{\theta-\pi/2}^{\theta+\pi/2}\frac{l^3}{2}f_n(x,\theta_1){\bf e}(\theta)\cdot\grad_xf_n(x,\theta)\,d\theta_1 {}+{}O(l^4),
% \end{multline}
% \begin{multline}\label{eqn:Q+2}
%     Q^+_2 = \int_{\theta-\pi/2}^{\theta+\pi/2} l^2|\sin(\theta-\theta_1)|f_n(x,\theta+\pi)f_n(x,\theta_1)\,d\theta_1 \\
%     {}+{} \int_{\theta-\pi/2}^{\theta+\pi/2}\frac{l^3}{2}f_n(x,\theta_1){\bf e}(\theta)\cdot\grad_xf_n(x,\theta+\pi)\,d\theta_1 {}+{}O(l^4).
% \end{multline}
% Using equations \eqref{eqn:Q-}-\eqref{eqn:Q+2} above, we can write
\begin{equation}
\begin{split}
    \Delta_1f_n(x,\theta) &= (N-1)l v dt\int_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|f_n(x,\theta)f_n(x,\theta_1+\pi)\,d\theta_1\\
    &{}-{}
    (N-1)l v dt\int_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|f_n(x,\theta+\pi)f_n(x,\theta_1)\,d\theta_1\\
    &{}-{}\frac{(N-1)l^2 v dt}{2}\int_{-\pi}^\pi|\sin(\theta-\theta_1)| f_n(x,\theta){\bf e}(\theta_1)\cdot\grad_xf_n(x,\theta_1)\,d\theta_1\\
    &{}+{}\frac{(N-1)l^2 v dt}{2}\int_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f_n(x,\theta_1){\bf e}(\theta)\cdot\grad_x(f_n(x,\theta)\textcolor{red}{-}+f_n(x,\theta+\pi)\,d\theta_1 \\ &{}+{}O(Nl^3 dt).
\end{split}
\end{equation}
Dividing \eqref{Model3:Delta} by $dt$ and assuming $f_n(x,\theta)$, $n = 1,2,\cdots$, are the values of continuously varying function $f(x,t,\theta)$ at times $t=t_n$ we obtain the kinetic equation
\begin{equation}\label{eqn:kin1}
\partial_t f+v{\bf e}(\theta)\cdot\grad_x f =
(N-1)lv Q_0 + \frac{(N-1)l^2v}{2}Q_1 + O\left(Nl^3\right) + O\left(dt\right),
\end{equation}
where
\begin{equation}
Q_0 {}={}\int_{\theta-\pi/2}^{\theta+\pi/2} |\sin(\theta-\theta_1)|\left(f(x,\theta+\pi,t)f(x,\theta_1,t)-f(x,\theta,t)f(x,\theta_1+\pi,t)\right)\,d\theta_1,
\end{equation}
and
\begin{equation}
\begin{split}
Q_1{}&={}\int_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta_1,t){\bf e}(\theta)\cdot\grad_x\left(f(x,\theta,t)+f(x,\theta+\pi,t)\right)\,d\theta_1\\
&-\int_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta,t){\bf e}(\theta_1)\cdot\grad_x f(x,\theta_1,t)\,d\theta_1.
\end{split}
\end{equation}

\begin{equation}
\begin{split}
Q_1{}&={}\int_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta_1,t){\bf e}(\theta)\cdot\grad_x\left(f(x,\theta,t)-f(x,\theta+\pi,t)\right)\,d\theta_1\\
&-\int_{\theta-\pi/2}^{\theta+\pi/2}|\sin(\theta-\theta_1)|f(x,\theta,t){\bf e}(\theta_1)\cdot\grad_x (f(x,\theta_1,t)-f(x,\theta_1+\pi))\,d\theta_1.
\end{split}
\end{equation}








The $O(dt)$ term in equation \eqref{Model3:Delta} comes from the relations 
\begin{equation}
    \Delta f_n(x,\theta)/dt = \left(f(x,\theta,t_n+dt)-f(x,\theta,t_n)\right)/dt = \partial_t f(x,\theta,t_n) + O(dt).
\end{equation}
