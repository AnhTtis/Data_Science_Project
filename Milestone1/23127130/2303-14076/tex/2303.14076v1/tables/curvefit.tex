\begin{algorithm}[!htbp]
    \SetAlgoLined
    \DontPrintSemicolon
    \SetKwInOut{KwInput}{Input:}
    \SetKwInOut{KwDefinitions}{Characteristics of the tree}
    \SetKwInOut{KwInitialization}{Initialization}
    \KwResult{
        \begin{itemize}
            \item Parameters' Estimation: $\widehat{\bm{\beta}}_{:k}=\left[\widehat{\delta}_k;\,\widehat{\mathcal{R}}_k;\,\widehat{\varphi}^{[0]}_k;\,\widehat{\mathcal{T}}^2_k\right],\;\forall \range{k}{1}    {N_k}$
        \end{itemize}
    }
    
    \textbf{Input:}
        \begin{itemize}
            \item Matrix of acquisitions: $\mathbf{Y}\in\mathbb{R}^{N_k\times N_a}$ whose rows are $\{\mathbf{y}_{k:}\}_{\range{k}{1}{N_k}}$
            \item Wave model label (e.g., $2$ or $\infty$ waves)
            \item Input spectra $\mathbf{X}\in\mathbb{R}^{N_b \times N_a}$
            \item Maximum number of iterations $N_q$
            \item Tolerance: $J_{tol}$
            %\mathbb{E}_l[\sigma_{l+1}-\sigma_l]
        \end{itemize}
        
    % \textbf{Initialization:}\\
    %     \begin{itemize}[noitemsep]
    %         \item Vector of parameters: $\bm{\beta}^{(0)}$ calculated via the \gls{ml} Algorithm~\ref{alg:SPIE}
    %         \item Objective function value: $ J^{(0)} \gets +\infty$
    %         \item Iteration: $i \gets 0$
    %     \end{itemize}
    \textbf{Procedure:}\\
        \medskip
        %\everypar={\nl}
        Initialize $\left\{\bm{\beta}_k^{(0)}\right\}_{k\in[\![1..N_k]\!]}$ with Algorithm~\ref{alg:SPIE} (\glsentryshort{ml} method)\;
        \For{$k=1,...,N_k$}{
             $J^{(-1)} \gets \infty$\tcp*{Initialize the objective function value}
             $q \gets 0$\tcp*{Initialize the iterations}
             $\mathbf{a}_{k:} \gets \left\{a_{kl}\biggr\rvert_{\left[\delta_k;\,\mathcal{R}_k;\,\varphi^{[0]}_k;\;\mathcal{T}_k^2\right]=\bm{\beta}_k^{(0)}}\right\}_{\range{l}{1}{N_b}}$ with $a_{kl}$ from \tablename~\ref{tab:gaussnewt}\;
             $J^{(0)} \gets \|\mathbf{a}_{k:}\mathbf{X}-\mathbf{y}_{k:}\|_2$\;
            \While {$q<N_q$ {\textbf{ and }} $\left|J^{(q)}-J^{(q-1)}\right|>J_{tol}$}{
                $q \gets q+1$\;
                $\mathbf{a}_{k:} \gets \left\{a_{kl}\biggr\rvert_{\left[\delta_k;\,\mathcal{R}_k;\,\varphi^{[0]}_k;\,\mathcal{T}_k^2\right]=\bm{\beta}_k^{(q)}}\right\}_{\range{l}{1}{N_b}}$ with $a_{kl}$ from \tablename~\ref{tab:gaussnewt}\;
                $\bm{\nabla}_A \gets
                \left\{
                \left.
                \left[
                \frac{\partial a_{kl}}{\partial \delta_k};\,
                \frac{\partial a_{kl}}{\partial \mathcal{R}_k};\,
                \frac{\partial a_{kl}}{\partial \varphi^{[0]}_k};\,
                \frac{\partial a_{kl}}{\partial \mathcal{T}^2_k}
                \right]
                \right\rvert_{\left[\delta_k;\mathcal{R}_k;\varphi^{[0]}_k;\mathcal{T}_k^2\right]=\bm{\beta}_k^{(q)}}
                \right\}_{\range{l}{1}{N_b}}$ with partial derivatives from \tablename~\ref{tab:gaussnewt}\; $\mathbf{r}\gets\mathbf{a}_{k:}\mathbf{X}-\mathbf{y}_{k:}$\tcp*{Evaluate the residual}
                $\bm{\nabla}_r\gets \bm{\nabla}_A\mathbf{X}$\tcp*{Compute the Jacobian}
                %Evaluate the step size: $\dot{\gamma}=1.99 \mathbin{/} \|\bm{\nabla}_r\|_{op}$\;
                $\bm{\beta}_{:k}^{(q)}=\bm{\beta}_{:k}^{(q-1)}-\left({\bm{\nabla}_r}\bm{\nabla}_r\T\right)^{-1}{\bm{\nabla}_r}\,\mathbf{r}\T$\tcp*{Update the parameters}
                $J^{(q)}=\left\|\mathbf{r}\T\right\|^2_2$\tcp*{Compute the current error}
            }
            $\widehat{\bm{\beta}}_{:k} \gets \bm{\beta}_{:k}^{(q)}$\;
        }
    \caption{\Glsfirst{gn} for parameter estimation.}
    \label{alg:CURVEFIT}
\end{algorithm}

% \begin{algorithm}[H]
% \SetAlgoLined
% \KwResult{ $\widehat{\bm{\beta}}$ }
%  \textbf{Input:}\\
%  Acquisitions: $\mathbf{w}_b$\\
%  Maximum amount of iterations: $maxiter$\\
%  \textbf{Inizialization:} $\bm{\beta}^{(0)}$, $s=0$\\
%  \While{$i < maxiter$}{
%     Calculate $\mathbf{w}_b^{[sim]}(\mathbf{\beta}^{(q)})$ \dan{with any model}\\
%     $\mathbf{D}_i=\mathbf{w}_b-\mathbf{w}_b^{[sim]}(\mathbf{\beta}^{(q)})$
%     $\mathbf{J}_i=\nabla\mathbf{w}_b^{[sim]}(\mathbf{\beta}^{(q)})$\\
%     $\bm{\beta}^{(q)}=(\mathbf{J}_i^*\mathbf{J}_i)^{-1}\mathbf{J}_i^*\mathbf{D}_i$\\
%     $i=i+1$
% }
% \caption{Non Linear Regression\dan{change with current formalism}}
% \end{algorithm}