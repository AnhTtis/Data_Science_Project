\begin{figure}[t]
\begin{subfigure}[b]{\linewidth}
\centering
\begin{tikzpicture}
 \node(mvdefinition)[minimum height=10mm, minimum width=31mm, anchor=south] at (10.8, 0){};

\begin{scope}[every node/.style={rectangle,thick, anchor=east}]
    \node[align=right] (label5) at (-0.7, 1) {\textbf{Memory}};
    \node[align=right] (label6) at (-0.7, 0) {\textbf{Storage}} ;
\end{scope}

% ours
\begin{scope}[every node/.style={rectangle, anchor=west, inner sep=0.05cm,fill opacity = 0.6,text opacity=1, minimum height = 4mm, minimum width = 10mm}]
    \node[densely dotted,draw=black] (X1) at (0.1, 1) {\footnotesize \texttt{MV1}};
    \node[draw=black] (X2) at ($(X1.west) + (1.4, 0)$) {\footnotesize \texttt{MV1}};
    \node[draw=black] (X3) at ($(X2.west) + (1.4, 0)$) {\footnotesize \texttt{MV1}};
    \node[draw=black,  pattern=crosshatch, pattern color = black] (X4) at ($(X3.west) + (1.4, 0)$) {};
    \node[densely dotted, draw=black] (Y1) at ($(X2.west) + (0, -0.6)$) {\footnotesize \texttt{MV1}};
    \node[densely dotted, draw=black] (Y2) at ($(Y1.west) + (1.4, 0)$) {\footnotesize \texttt{MV1}};
    \node[draw=black] (Y3) at ($(Y2.west) + (1.4, 0)$){\footnotesize \texttt{MV1}};
    \node[densely dotted,draw=black] (B1) at ($(Y1.west) + (0, -0.4)$) {\footnotesize \texttt{MV2}};
    \node[draw=black] (B2) at ($(B1.west) + (1.4, 0)$) {\footnotesize \texttt{MV2}};
    \node[draw=black] (B3) at ($(B2.west) + (1.4, 0)$) {\footnotesize \texttt{MV2}};
    \node[densely dotted,draw=black] (A1) at ($(B2.west) + (0, -0.4)$) {\footnotesize \texttt{MV3}};
    \node[draw=black] (A2) at ($(A1.west) + (1.4, 0)$) {\footnotesize \texttt{MV3}};

    \node[densely dotted,draw=black] (l1) at (-2.0, -1.5) {};
    \node[align=left] (l11) at ($(l1.east) + (0.1, 0)$) {\footnotesize In-progress\\[-0.4em]\footnotesize computation} ;
    \node[draw=black] (l2) at ($(l11.east) + (0.3, 0)$) {};
    \node[align=left] (l21) at ($(l2.east) + (0.1, 0)$) {\footnotesize Complete\\[-0.4em]\footnotesize computation};
    \node[fill=FlagColor,draw=black, pattern=crosshatch] (l3) at ($(l21.east) + (0.3, 0)$) {};
    \node[align=left] (l31) at ($(l3.east) + (0.1, 0)$) {\footnotesize Deleted \\[-0.4em] \footnotesize table};
\end{scope}

\node[align=right] (t1) at ($(X1) + (0, -1.8)$) {\small \textbf{t1}} ;
\node[align=right] (t2) at ($(t1) + (1.4, 0)$) {\small \textbf{t2}} ;
\node[align=right] (t3) at ($(t2) + (1.4, 0)$) {\small \textbf{t3}} ;
\node[align=right] (t4) at ($(t3) + (1.4, 0)$) {\small \textbf{t4}} ;
\node[align=right,anchor=east] (tlabel) at (-0.7, -0.8) {\small \textbf{Time}\\[-0.2em]\small \textbf{steps}} ;


% plot lines
\begin{scope}[>={Stealth[black]},
              every node/.style={fill=none,circle,dashed},
              every edge/.style={draw=black,dashed}]
    \draw[-,dashed] (1.3, 1.3) -- (1.3, -0.7);
    \draw[-,dashed] (2.7, 1.3) -- (2.7,-0.7);
    \draw[-,dashed] (4.1, 1.3) -- (4.1, -0.7);
\end{scope}

% plot lines
\begin{scope}[>={Stealth[black]},
              every node/.style={fill=none,circle},
              every edge/.style={draw=black}]
    \draw[-] (0, 0.7) -- (5.4, 0.7);
    \draw[-] ($(t1.west) + (-1.0, 0)$) -- ($(t1.west)$);
    \draw[-] ($(t1.east)$) -- ($(t2.west)$);
    \draw[-] ($(t2.east)$) -- ($(t3.west)$);
    \draw[-] ($(t3.east)$) -- ($(t4.west)$);
    \draw[->] ($(t4.east)$) -- ($(t4.east) + (1.0, 0)$);
\end{scope}

% \node[anchor=north east, align=left] at ($(B1.south east) + (0.2, -0.1)$) {\footnotesize \texttt{CREATE MV \textcolor{green}{MV2}/\textcolor{blue}{MV3}}\\[-0.4em] \footnotesize \texttt{AS ... FROM \textcolor{red}{MEM.MV1}}};

% \node[anchor=south, align=left] (e1) at ($(X1.north) + (0, 0.2)$) {\footnotesize \texttt{CREATE MV \textcolor{red}{MEM.MV1}...}};
% \node[anchor=south, align=left] (e2) at ($(X4.north) + (-0.3, 0.2)$) {\footnotesize \texttt{DROP MV \textcolor{red}{MEM.MV1}...}};
% \node[anchor=east, align=left] (e3) at ($(Y1.west) + (-0.2, 0.1)$) {\footnotesize \texttt{SELECT\! *\! INTO \textcolor{red}{MV1}}\\[-0.4em]\footnotesize \texttt{FROM \textcolor{red}{MEM.MV1}}};

% \node[anchor=west, align=left] at ($(mvdefinition.south west) + (0.2, 0.2)$) {(S6)};
% \node[anchor=west, align=left] (S7) at ($(mvdefinition.south west) + (4, 1.3)$) {(S7)};

% \begin{scope}[>={Stealth[black]},
%               every node/.style={fill=none,circle},
%               every edge/.style={draw=black}]
%     \draw[->] ($(X1.north) + (0, 0.25)$) -- ($(X1.north)$);
%     \draw[->] ($(X4.north) + (0, 0.25)$) -- ($(X4.north)$);
%     \draw[-] ($(A1.south) + (-0.9, -0.25)$) -- ($(A1.south) + (0, -0.25)$);
%     \draw[->] ($(A1.south) + (0, -0.25)$) -- ($(A1.south)$);
%     \draw[-] ($(B1.west) + (-0.25, -0.25)$) -- ($(B1.west) + (-0.25, 0)$);
%     \draw[->] ($(B1.west) + (-0.25, 0)$) -- ($(B1.west)$);
%     \draw[->] ($(Y1.west) + (-0.8, 0)$) -- ($(Y1.west)$);
% \end{scope}

% % ours label
% \begin{scope}[>={Stealth[black]},
%               every node/.style={fill=none,circle},
%               every edge/.style={draw=black}]
%     \node[] (y) at (5.2, 0.7) {};
%     \node[] (z) at (2.55, 0.5) {};
%     \draw[->] (y)  to [bend right = 20] (z);
% \end{scope}
% \node[text width=2.1cm, align=center] (X) at (6.0,0.3) 
% {\scriptsize MV A is kept in memory, eliminating overhead\par};

\end{tikzpicture}
\end{subfigure}
\vspace{-5mm}
\caption{The example MV refresh process by timestamp (t1-t4) for the workload given the plan in \cref{fig:input}.}
\label{fig:mv_refresh}
\vspace{-4mm}
\end{figure}
