%!TEX root = main.tex

\begin{figure*}[t]


\pgfplotsset{accfig/.style={
    width=33mm,
    height=32mm,
    xmin=10,
    ymin=0,
    ymax=150,
    xlabel=Dependency graph size ({=} number of nodes),
    ylabel=RMS Error,
    xlabel near ticks,
    ylabel near ticks,
    ylabel style={align=center,font=\footnotesize\linespread{0.1},align=center},
    xtick={0, 10, ..., 100},
    %xticklabels={80\%, 85\%, 90\%, 95\%, 99\%, 99.5\%},
    ytick={0, 30, 60, 90, 120, 150},
    yticklabels={0\%, 30\%, 60\%, 90\%, 120\%, 150\%},
    % xticklabel style={rotate=30,yshift=-2mm,anchor=east,xshift=1.5mm},
    % yticklabels={0 hr, 0.5 hr, 1 hr, 1.5 hr, 2.0 hr},
    % extra y ticks={10, 20, 30, 40},
    % extra y tick style={yticklabels={}},
    ylabel shift=-2pt,
    xlabel shift=-2pt,
    legend style={
        at={(-0, 1.1)},anchor=south west,column sep=2pt,
        draw=black,fill=none,line width=.5pt,
        /tikz/every even column/.append style={column sep=3pt},
        font=\scriptsize
    },
    legend columns=8,
    every axis/.append style={font=\footnotesize},
    % ymajorgrids,
    % yminorgrids,
    % minor grid style=lightgray,
    % nodes near coords,
    % every node near coord/.append style={font=\footnotesize,anchor=west,rotate=60}
}}

\pgfplotsset{timefig/.style={
    width=58mm,
    height=32mm,
    xmin=10,
    xmax=100,
    ymin=0,
    ymax=60,
    xlabel=Number of Queries,
    ylabel=Runtime (sec),
    xlabel near ticks,
    ylabel near ticks,
    ylabel style={align=center},
    xtick={0, 10, ..., 100},
    % xticklabels={80\%, 85\%, 90\%, 95\%, 99\%, 99.5\%},
    ytick={0, 10, ..., 60},
    % yticklabels={0\%, 10\%, 20\%, 30\%},
    % xticklabel style={rotate=30,yshift=-2mm,anchor=east,xshift=1.5mm},
    % yticklabels={0 hr, 0.5 hr, 1 hr, 1.5 hr, 2.0 hr},
    % extra y ticks={10, 20, 30, 40},
    % extra y tick style={yticklabels={}},
    ylabel shift=-2pt,
    xlabel shift=-2pt,
    legend style={
        at={(0, 1)},anchor=south west,column sep=2pt,
        draw=black,fill=none,line width=.5pt,
        /tikz/every even column/.append style={column sep=5pt}
    },
    legend columns=4,
    every axis/.append style={font=\footnotesize},
    % ymajorgrids,
    % yminorgrids,
    minor grid style=lightgray,
    % nodes near coords,
    % every node near coord/.append style={font=\footnotesize,anchor=west,rotate=60}
}}
\begin{subfigure}[b]{0.16\linewidth}
\centering
\begin{tikzpicture}
\begin{scope}[every node/.style={circle, minimum width = 2mm, minimum height = 2mm,fill opacity = 1,fill=black, text opacity=1, inner sep = 0mm}]
    \node[] (X00) at (0, 1.6) {};
    \node[] (X01) at (0, 1.2) {};
    \node[] (X02) at (0, 0.8) {};
    \node[] (X03) at (0, 0.4) {};
    \node[] (X10) at (0.4, 1.6) {};
    \node[] (X11) at (0.4, 1.2) {};
    \node[] (X12) at (0.4, 0.8) {};
    \node[] (X13) at (0.4, 0.4) {};
    \node[] (X14) at (0.4, 0) {};
    \node[] (X20) at (0.8, 1.6) {};
    \node[] (X21) at (0.8, 1.2) {};
    \node[] (X22) at (0.8, 0.8) {};
    \node[] (X30) at (1.2, 1.6) {};
    \node[] (X31) at (1.2, 1.2) {};
    \node[] (X32) at (1.2, 0.8) {};
    \node[] (X33) at (1.2, 0.4) {};
    \node[] (X40) at (1.6, 1.6) {};
    \node[] (X41) at (1.6, 1.2) {};
    \node[] (X42) at (1.6, 0.8) {};
    \node[] (X43) at (1.6, 0.4) {};
    \node[] (X44) at (1.6, 0) {};
\end{scope}
\node[] (X55) at (2.7, 0) {};
% plot lines
\begin{scope}[>={Stealth[black]},
              every node/.style={fill=none,circle},
              every edge/.style={draw=black}]
    \draw[->] ($(X00)$) -- ($(X10)$);
    \draw[->] ($(X00)$) -- ($(X11)$);
    \draw[->] ($(X01)$) -- ($(X10)$);
    \draw[->] ($(X01)$) -- ($(X11)$);
    \draw[->] ($(X01)$) -- ($(X12)$);
    \draw[->] ($(X02)$) -- ($(X13)$);
    \draw[->] ($(X03)$) -- ($(X13)$);
    \draw[->] ($(X03)$) -- ($(X14)$);
    \draw[->] ($(X10)$) -- ($(X21)$);
    \draw[->] ($(X11)$) -- ($(X20)$);
    \draw[->] ($(X11)$) -- ($(X22)$);
    \draw[->] ($(X12)$) -- ($(X21)$);
    \draw[->] ($(X13)$) -- ($(X22)$);
    \draw[->] ($(X14)$) -- ($(X22)$);
    \draw[->] ($(X20)$) -- ($(X31)$);
    \draw[->] ($(X21)$) -- ($(X32)$);
    \draw[->] ($(X22)$) -- ($(X33)$);
    \draw[->] ($(X20)$) -- ($(X30)$);
    \draw[->] ($(X30)$) -- ($(X40)$);
    \draw[->] ($(X31)$) -- ($(X40)$);
    \draw[->] ($(X32)$) -- ($(X41)$);
    \draw[->] ($(X33)$) -- ($(X42)$);
    \draw[->] ($(X33)$) -- ($(X43)$);
    \draw[->] ($(X33)$) -- ($(X44)$);
\end{scope}

% traditional label
\begin{scope}[>={Stealth[black]},
              every node/.style={fill=none,circle},
              every edge/.style={draw=black}]
    \draw [decorate,
    decoration = {brace}] (-0.1, 1.8) --  (1.7, 1.8);
    \draw [decorate,
    decoration = {brace}] (1.8, 1.7) --  (1.8, -0.1);
    \draw [decorate,
    decoration = {brace}] (-0.2, -0.1) --  (-0.2, 0.9);
\end{scope}
\node[align=center] (X) at (0.8, 2.0) {\scriptsize DAG height (stages)};
\node[align=center, rotate=-90] (X) at (2.2, 0.8) {\scriptsize DAG width\\[-0.6em]\scriptsize (nodes per stage)};
\node[align=center, rotate=90] (X) at (-0.6, 0.4) {\scriptsize Stage node\\[-0.6em]\scriptsize count StDev};
\draw[thick] (1.4, 0.4) ellipse (1mm and 3.5mm);
\node[align=center] (X) at (1.0, 0) {\scriptsize Max.\\[-0.6em]\scriptsize outdegree};
\end{tikzpicture}
\end{subfigure}
\hspace{1mm}
\hfill
\begin{subfigure}[b]{0.20\linewidth}
\centering
\begin{tikzpicture}
\begin{axis}[accfig,
ylabel=Normalized\\savings,
ymin =0.6,
ymax=1.1,
xmin = 0.5,
xmax = 3.5,
xlabel=DAG size,
xtick={1, 2, 3},
xticklabels={25, 50, 100},
ytick={0.7, 0.8, 0.9, 1.0},
yticklabels={0.7, 0.8, 0.9, 1.0},
ymajorgrids,
    ]

\addplot[mark=triangle*,mark size=1.5,mark options={fill=SCColor,draw=SCColor},
very thick,draw=SCColor,
]
table[x=x,y=y] {
x y
1 0.67
2 0.85
3 1.00
};

\node (mark) [draw, draw=black, fill=black, circle, minimum size = 5pt, inner sep=2pt, thick] 
      at (axis cs: 3, 1.00) {};

\end{axis}
\end{tikzpicture}
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.20\linewidth}
\centering
\begin{tikzpicture}
\begin{axis}[accfig,
ylabel=Normalized\\savings,
ymin =0.7,
ymax=1.3,
xmin = 0.5,
xmax = 5.5,
xlabel=DAG height/width,
xtick={1, 2, 3, 4, 5},
xticklabels={4, 2, 1, .5, .25},
ytick={0.8,1,1.2},
yticklabels={0.8,1,1.2},
ymajorgrids,
    ]

\addplot[mark=triangle*,mark size=1.5,mark options={fill=SCColor,draw=SCColor},
very thick,draw=SCColor,
]
table[x=x,y=y] {
x y
1 1.14
2 1.11
3 1.00
4 0.87
5 0.72
};

\node (mark) [draw, draw=black, fill=black, circle, minimum size = 5pt, inner sep=2pt, thick] 
      at (axis cs: 3, 1.00) {};

\end{axis}
\end{tikzpicture}
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.20\linewidth}
\centering
\begin{tikzpicture}
\begin{axis}[accfig,
ylabel=Normalized\\savings,
ymin =0.4,
ymax=1.3,
xmin = 0.5,
xmax = 5.5,
xlabel=Node max. outdegree,
xtick={1, 2, 3, 4, 5},
xticklabels={1, 2, 3, 4, 5},
ytick={0.6, 0.8,1,1.2},
yticklabels={0.6, 0.8,1,1.2},
ymajorgrids,
    ]

\addplot[mark=triangle*,mark size=1.5,mark options={fill=SCColor,draw=SCColor},
very thick,draw=SCColor,
]
table[x=x,y=y] {
x y
1 0.49
2 0.70
3 0.87
4 1.00
5 1.12
};

\node (mark) [draw, draw=black, fill=black, circle, minimum size = 5pt, inner sep=2pt, thick] 
      at (axis cs: 4, 1.00) {};

\end{axis}
\end{tikzpicture}
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.20\linewidth}
\centering
\begin{tikzpicture}
\begin{axis}[accfig,
ylabel=Normalized\\savings,
ymin =0.7,
ymax=1.3,
xmin = 0.5,
xmax = 5.5,
xlabel=Stage node count StDev,
xtick={1, 2, 3, 4, 5},
xticklabels={0, 1, 2, 3, 4},
ytick={0.8,1,1.2},
yticklabels={0.8,1,1.2},
ymajorgrids,
    ]

\addplot[mark=triangle*,mark size=1.5,mark options={fill=SCColor,draw=SCColor},
very thick,draw=SCColor,
]
table[x=x,y=y] {
x y
1  1.00
2  1.00
3  1.02
4  1.04
5  1.05
};
\node (mark) [draw, draw=black, fill=black, circle, minimum size = 5pt, inner sep=2pt, thick] 
      at (axis cs: 2, 1.00) {};

\end{axis}
\end{tikzpicture}
\end{subfigure}

\vspace{-2mm}
\caption{
Analysis of DAG complexity vs. predicted savings from \system on synthetic DAGs. Savings normalized w.r.t. DAGs with 100 nodes, height/width ratio 1, max. out-degree 4, and stage node count StDev 1 (Parameters in \cref{fig:scalability}, marked in black).
}
\vspace{-4mm}
\label{fig:complexity}
\end{figure*}
