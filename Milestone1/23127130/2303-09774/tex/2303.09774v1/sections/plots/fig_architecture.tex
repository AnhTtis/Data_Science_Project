\begin{figure}[t]
% \centerline{\includegraphics[width=\linewidth]{figures/system_overview.jpg}}
\begin{subfigure}{\columnwidth}
\centering
\begin{tikzpicture}
\tikzset{cbox/.style={
	minimum height=10mm,draw=black,fill=white,ultra thick,align=center,
	minimum width=14mm,anchor=north
}}
\tikzset{dbox/.style={
	minimum height=6mm,minimum width=14mm,draw=black,fill=white,thick,
    font=\scriptsize, align=center,anchor=north,inner sep=1mm
}}

\node(bg)
 [minimum height=32mm, minimum width=42mm,
  draw=black, fill=gray, opacity=0.2, anchor=north,
  dashed,ultra thick]
 at (2.2,0.75) {};
\node [anchor=north east,font=\bf\Large] at ($(bg.north east)$) {\system};
 
\node(opt) [cbox,minimum height = 17mm, minimum width = 17mm, align=center,anchor=center]
 at ($(bg.south east) + (-1.0, 1.05)$) {};
 
\node [anchor=center] at ($(opt.north) + (0,-1.2)$) {\bf \small Optimizer};

\node(optalgm) [dbox,
  minimum height=6mm,minimum width=10mm]
 at ($(opt.north) + (0, -0.175)$) {Optimization\\algorithm};
 
\node(metadata) [dbox,align=center,anchor=center]
 at ($(opt.north) + (0, 0.4)$) {Metadata};
 
\node(engine) [cbox,minimum height = 29mm, minimum width = 20mm, align=center,anchor=center]
 at ($(opt.west) + (-1.15, 0.6)$) {};
 
  \node(mqueue) [dbox,align=center,anchor=center]
 at ($(engine.south) + (0,0.5)$) {Materialization\\queue};
 
  \node(optresult) [dbox,align=center,anchor=south]
 at ($(mqueue.north) + (0,0.1)$) {Optimization\\result};
 
 \node(depgraph) [dbox,align=center,anchor=south]
 at ($(optresult.north) + (0,0.1)$) {Dependency\\graph};
 
 \node [anchor=south] at ($(depgraph.north) + (0,0.025)$) {\bf \small Controller};
 
\node(database) [cbox,minimum height = 22mm, minimum width = 17mm, align=center,anchor=east]
 at ($(bg.west) + (-0.2, -0.35)$) {};
 
   \node(inmemory) [dbox,align=center,anchor=center]
 at ($(database.south) + (0,0.5)$) {Memory\\ Catalog};
 
  \node(ondisk) [dbox,align=center,anchor=south]
 at ($(inmemory.north) + (0,0.1)$) {Physical\\ catalog };
 
  \node [anchor=south] at ($(ondisk.north) + (0,0.05)$) {\bf \small DBMS};
 
 
 

 
\draw[thick,->] 
($(metadata.west) + (-0.3, 0)$) --
($(metadata.west)$);

\draw[thick,->] 
($(metadata.south)$) --
($(optalgm.north)$);

\draw[thick,->] 
($(optresult.east) + (0.5, 0)$) --
($(optresult.east)$);

\draw[thick,->] 
($(optresult.west)$) --
($(optresult.west) + (-0.7, 0)$);

\draw[thick,->] 
($(mqueue.west)$) --
($(inmemory.east) + (0, 0.025)$);

\node(disk) [dbox,align=center,font=\footnotesize,minimum width=16mm,anchor=east] at ($(ondisk.west)+(-0.6,0)$) {external\\ storage};

\draw[thick,->] 
($(ondisk.west)$) --
($(disk.east)$);

\draw[thick,->] 
($(disk.east)$) --
($(ondisk.west)$);

\draw[thick,-] 
($(inmemory.west)$) --
($(disk.south) + (0, -0.425)$);

\draw[thick,->] 
($(disk.south) + (0, -0.425)$) --
($(disk.south)$);

    \node [anchor=north] at ($(disk.south) + (0.2,-0.375)$) {\footnotesize Materialization};
    
\node(input) [dbox,align=center,font=\footnotesize,anchor=south] at ($(disk.north)+(0, 0.5)$) {SQL\\ workload};

\draw[thick,->] 
($(input.east)$) --
($(input.east) + (2.5, 0)$);




\end{tikzpicture}
\label{fig:internal_architecture}
\end{subfigure}
\vspace{-5mm}
\caption{\system architecture. 
Optimizer determines which intermediate data to keep in \memory. 
DBMS can directly access data (temporarily) kept in \memory for computations, saving the time for reading data from external storage.}
\label{fig:system_overview}
\vspace{-4mm}
\end{figure}
