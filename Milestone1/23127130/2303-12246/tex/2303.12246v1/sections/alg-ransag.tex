%!TEX root = ../main.tex
\setlength{\textfloatsep}{5pt}%
\begin{algorithm}[t]
\SetAlgoLined
{\bf Input:} an ICP set $\Feps(x)$~\eqref{eq:icpunify} and its corresponding \eqref{eq:purse} $\Seps$; maximum trials $T$; initial $\hat{S} = \emptyset$; \\
{\bf Output:} sample poses ${S} \subset \SEthree$ in \purse, and an average pose $\bar{s} \in \SEthree$; \\
\For{ $\tau \gets 1$ to $T$ \label{line:p3piter}}{
	Sample $\{k_1,k_2,k_3\}$ from $[K]$ ($k_1 \neq k_2 \neq k_3$); \label{line:samplek}\\
	Sample $\haty_{k_i}, i=1,2,3$ from \label{line:samplekeypoints}
	\begin{equation}
	\{ y \in \Real{2} \mid (y - \mu_{k_i})\tran \Lambda_{k_i} (y - \mu_{k_i}) \leq 1 \}; \nonumber
	\end{equation}\\
	$\hat{S} \leftarrow \hat{S} \cup ( \Seps \cap \text{\pthreep}(\{\haty_{k_i} \leftrightarrow Y_{k_i}\}_{i=1}^3 ) )$; \label{line:solvep3p}
}
$S = \hat{S}$;\\
\If{$\hat{S} = \emptyset$ \label{line:emptyset} }{
	\For{$\tau \gets 1$ to $\floor{T/20}$}{
	Sample $\haty_{k}, k=1,\dots,K$ from $\Feps(x)$;\\
	$\hat{S} \leftarrow \hat{S} \cup \text{\pnp}(\{\haty_{k} \leftrightarrow Y_{k}\}_{k=1}^K)$;\label{line:solvepnp}
	}
}
\label{line:rotavg} $\bar{R} = \text{proj}_{\SOthree}( \sum_{(R_j,*) \in \hat{S}} R_j )$; \\
\label{line:transavg} $\bar{t} = \frac{1}{\vert \hat{S} \vert } \sum_{(*,t_j) \in \hat{S}} t_j $; \\
{\bf return:} $S$, $\bar{s} = (\bar{R},\bar{t})$ 
\caption{RANdom SAmple averaGing \label{alg:ransag}}
\end{algorithm}
