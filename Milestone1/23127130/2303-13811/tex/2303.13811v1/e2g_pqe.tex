\section{Introducing \Eg}
\label{sec:eg_pqe}

In this section, we describe a simple SAT-based algorithm for
performing PQE called \Eg. Here \ti{'EG'} stands for 'Enumerate and
Generalize'.  \Eg accepts a formula \prob{X}{F(X,Y)} and a clause $C
\in F$. It outputs a formula $H(Y)$ such that $\prob{X}{\Sub{F}{ini}}
\equiv H \wedge \prob{X}{\Sub{F}{ini} \setminus \s{C}}$ where
\Sub{F}{ini} is the initial formula $F$. (This point needs
clarification because \Eg changes $F$ by adding clauses.)

%
% example
%
\input{e6g_pqe_example}

%
% SUBSECTION
%
\subsection{Description of \Eg}
The pseudo-code of \Eg is shown in Fig.~\ref{fig:eg_pqe}.  \Eg starts
with storing the initial formula $F$ and initializing formula \pl that
accumulates the plugging clauses generated by \Eg (line 1). As we
mentioned in the previous subsection, plugging clauses are used to
avoid re-visiting the subspaces where the formula $F$ is proved
satisfiable.



All the work is carried out in a while loop. First, \Eg checks if
there is a new subspace \pnt{y} where \prob{X}{\cof{(F \setminus
    \s{C})}{y}} does not imply \cof{F}{y}. This is done by searching
for an assignment (\pnt{y},\pnt{x}) satisfying $\pl \wedge (F
\setminus \s{C}) \wedge \overline{C}$ (lines 3-4). If such an
assignment does not exist, the clause $C$ is redundant in
\prob{X}{F}. (Indeed, let \pnt{y} be a full assignment to $Y$. The
formula $\pl \wedge (F \setminus \s{C}) \wedge \overline{C}$ is
unsatisfiable in subspace \pnt{y} for one of the two reasons. First,
\pnt{y} falsifies \pl. Then \cof{C}{y} is redundant because \cof{F}{y}
is satisfiable. Second, $\cof{(F \setminus \s{C})}{y} \wedge
\overline{\cof{C}{y}}$ is unsatisfiable.  In this case, \cof{(F
  \setminus \s{C})}{y} implies \cof{C}{y}.)  Then \Eg returns the set
of clauses added to the initial formula $F$ as a solution $H$ to the
PQE problem (lines 5-6).

\input{e3g_pqe.fig}

If the satisfying assignment (\pnt{y},\pnt{x}) above exists, \Eg
checks if the formula \cof{F}{y} is satisfiable (line 7).  If not,
then the clause \cof{C}{y} \ti{is not} redundant in
\prob{X}{\cof{F}{y}} (because \cof{(F \setminus \s{C})}{y} is
satisfiable).  So, \Eg \ti{makes} \cof{C}{y} redundant by generating a
clause $B(Y)$ falsified by \pnt{y} and adding it to $F$ (line 9).
Note that adding $B$ also prevents \Eg from re-visiting the subspace
\pnt{y} again.  The clause $B$ is built by finding an
\ti{unsatisfiable} subset of \cof{F}{y} and collecting the literals of
$Y$ removed from clauses of this subset when obtaining \cof{F}{y} from
$F$. The unsatisfiable subset above can be easily extracted from
a resolution proof that \cof{F}{y} is unsatisfiable.

If \cof{F}{y} is satisfiable, \Eg generates an assignment $\pnt{x}^*$
to $X$ such that $(\pnt{y},\pnt{x}^*)$ satisfies $F$ (line 7). The
satisfiability of \cof{F}{y} means that every clause of \cof{F}{y}
including \cof{C}{y} is redundant in \prob{X}{\cof{F}{y}}. At this
point, \Eg uses the longest clause $D(Y)$ falsified by \pnt{y} as a
plugging clause (line 11). The clause $D$ is added to \pl to avoid
re-visiting subspace \pnt{y}. Sometimes it is possible to remove
variables from \pnt{y} to produce a shorter assignment $\pnt{y}^*$
such that $(\pnt{y}^*,\pnt{x}^*)$ still satisfies $F$. Then one can
use a shorter plugging clause $D$ involving only the variables
assigned in $\pnt{y}^*$.
%
% SUBSECTION
%
\subsection{Discussion}
\label{ssec:disc1}
\Eg is similar to the QE algorithm presented
in~\cite{blocking_clause}. We will refer to it as \cv. Given a formula
\prob{X}{F(X,Y)}, \cv enumerates full assignments to $Y$. In subspace
\pnt{y}, \cv either adds to $F$ a clause falsified by \pnt{y} (if
\cof{F}{y} is unsatisfiable) or generates a plugging clause. To apply
the idea of \cv to PQE, we reformulated it in terms of redundancy based
reasoning.

The main flaw of \Eg inherited from \cv is the necessity to use
plugging clauses produced from a satisfying assignment. Consider the
PQE problem of taking a clause $C$ out of \prob{X}{F(X,Y)}.  If $F$ is
proved \ti{unsatisfiable} in subspace \pnt{y}, typically, only a small
subset of clauses of \cof{F}{y} is involved in the proof. Then the
clause generated by \Eg is short and thus proves $C$ redundant in many
subspaces different from \pnt{y}. On the contrary, to prove $F$
\ti{satisfiable} in subspace \pnt{y}, every clause of \cof{F}{y} must
be satisfied. So, the plugging clause built off a satisfying
assignment includes almost every variable of $Y$. Despite this flaw of
\Eg we present it for two reasons. First, it is a very simple
SAT-based algorithm that can be easily implemented. Second, \Eg has a
powerful advantage over \cv since it solves PQE rather than
QE. Namely, \Eg does not need to examine the subspaces \pnt{y} where
$C$ is implied by $F \setminus \s{C}$. Surprisingly, for many formulas
this allows \Eg to \ti{completely avoid} examining subspaces where $F$
is satisfiable.  In this case, \Eg is very efficient and can solve
very large problems. Note that when \cv performs complete QE on
\prob{X}{F}, it \ti{cannot} avoid subspaces \pnt{y} where \cof{F}{y}
is satisfiable \ti{unless} $F$ itself is unsatisfiable (which is
very rare in practical applications).
