\begin{figure}
\begin{mdframed}[style=myframe]

\footnotesize

\startN
\begin{itemize}[leftmargin=*,itemsep=1pt,topsep=0pt]
    \item \textbf{Publisher} first encrypts its content $m$ and then sends the ciphertext $c_0$ to the gateway \textbf{Broker 1}. 
    \item \textbf{Broker 1} then first reencrypts $c_0$ using the reencryption key $Rek_{P-B2}$ with the direction from the publisher to \textbf{Broker 2}, then encrypts the result with its own public key $Pk_{B1}$. The re-processed ciphertext $c_1$ is sent to \textbf{Broker 2}. 
    \item \textbf{Broker 2} reencrypts $c_1$ using the reencryption key $Rek_{B1-B3}$ from \textbf{Broker 1} to \textbf{Broker 3} and then passes the reencrypted ciphertext $c_2$ to \textbf{Broker 3}. 
    \item \textbf{Broker 3} first decrypts $c_2$ using its own private key $Sk_{B3}$ to $c_3$, then reencrypts $c_3$ using the reencryption key $Rek_{B2-B4}$ from \textbf{Broker 2} to \textbf{Broker 4}, and encrypts it with its own public key $Pk_{B3}$ to $c_4$ before sending it to the next node.
\end{itemize}


\middleN
\begin{itemize}[leftmargin=*,itemsep=1pt,topsep=0pt]
    \item The above process propagates with the odd number broker performing decrypt-reencrypt-encrypt and the even number broker performing only reencrypt. 
\end{itemize}

\lastN
\begin{itemize}[leftmargin=*,itemsep=1pt,topsep=0pt]
    \item If the number of intermediate brokers is odd, the last broker \textbf{Broker N} simply just decrypts the ciphertext and reencrypts the result using the reencryption key $Rek_{B(N-1)-S}$ from its predecessor to the subscriber. The subscriber receives the ciphertext from its broker and decrypts it with its own private key $Sk_S$. 
    \item If the number of intermediate brokers is even, the last broker \textbf{Broker N} simply just reencrypts the ciphertext using the reencryption key $Rek_{B(N-1)-S}$ from its predecessor to the subscriber. The subscriber first decrypts the first layer using its own private key $Sk_S$, then reencryts the result using the reencryption key $Rek_{BN-S}$ from the last broker to the subscriber, and finally decrypts the ciphertext using its own private key $Sk_S$ again. 
\end{itemize}


\end{mdframed}
\caption{Protocol}

\label{fig:protocol}
\end{figure}