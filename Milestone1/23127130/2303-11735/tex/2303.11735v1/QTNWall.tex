\begin{tikzpicture}
	\coordinate (L1) at (0,0);
	\node at ($(L1)+(0,1)$) {(a)};
	
	\draw[line width=1pt] ($(L1)+(.5,0)$)--(L1)--++(0,-2.25)--++(.5,0);
	\draw[line width=1pt] ($(L1)+(.5,-.75)$)--++(-.5,0);
	\draw[line width=1pt] ($(L1)+(.5,-1.5)$)--++(-.5,0);
	
	\TNode{-2}{L1}{lblue}{};
	\TNode{-2}{$(L1)-(0,.75)$}{lblue}{};
	\TNode{-2}{$(L1)-(0,1.5)$}{lblue}{};
	\TNode{-2}{$(L1)-(0,2.25)$}{lblue}{};
	
	\node at ($(L1)+(1,-1)$) {$\rightarrow$};
	
	\coordinate (U1) at ($(L1)+(2,0)$);
	
	\draw[line width=1pt] (U1)--++(2.75,0);
	\draw[line width=1pt] ($(U1)+(0,-.75)$)--++(2.75,0);
	\draw[line width=1pt] ($(U1)+(0,-1.5)$)--++(2.75,0);
	\draw[line width=1pt] ($(U1)+(0,-2.25)$)--++(2.75,0);
	
	\Gate{H}{$(U1)+(.5,0)$}{2}{white}{$I$};
	\Gate{H}{$(U1)+(.5,-1.5)$}{2}{lblue}{$U_c$};
	\Gate{H}{$(U1)+(1.25,-.75)$}{2}{lblue}{$U_c$};
	\Gate{H}{$(U1)+(2,0)$}{2}{lblue}{$U_c$};
	\Gate{H}{$(U1)+(2,-1.5)$}{2}{white}{$I$};
	
	\Qin{H0}{U1};
	\Qin{H0}{$(U1)-(0,.75)$};
	\Qin{H0}{$(U1)-(0,1.5)$};
	\Qin{H0}{$(U1)-(0,2.25)$};
	
	\Qout{HM}{$(U1)+(2.75,0)$};
	\Qout{HM}{$(U1)-(-2.75,.75)$};
	\Qout{HM}{$(U1)-(-2.75,1.5)$};
	\Qout{HM}{$(U1)-(-2.75,2.25)$};
	
	\node at ($(U1)+(3.75,-1)$) {$\rightarrow$};
	
	\coordinate (U2) at ($(U1)+(4.75,0)$);
	
	\draw[line width=1pt] (U2)--++(2.75,0);
	\draw[line width=1pt] ($(U2)+(0,-.75)$)--++(2.75,0);
	\draw[line width=1pt] ($(U2)+(0,-1.5)$)--++(2.75,0);
	\draw[line width=1pt] ($(U2)+(0,-2.25)$)--++(2.75,0);
	
	\Gate{H}{$(U2)+(.5,0)$}{2}{green!80!black}{$W$};
	\Gate{H}{$(U2)+(.5,-1.5)$}{2}{green!50!black}{$U_o$};
	\Gate{H}{$(U2)+(1.25,-.75)$}{2}{green!50!black}{$U_o$};
	\Gate{H}{$(U2)+(2,0)$}{2}{green!50!black}{$U_o$};
	\Gate{H}{$(U2)+(2,-1.5)$}{2}{green!80!black}{$W$};
	
	\Qin{H0}{U2};
	\Qin{H0}{$(U2)-(0,.75)$};
	\Qin{H0}{$(U2)-(0,1.5)$};
	\Qin{H0}{$(U2)-(0,2.25)$};
	
	\Qout{HM}{$(U2)+(2.75,0)$};
	\Qout{HM}{$(U2)-(-2.75,.75)$};
	\Qout{HM}{$(U2)-(-2.75,1.5)$};
	\Qout{HM}{$(U2)-(-2.75,2.25)$};
	
	\coordinate (L2) at ($(L1)-(-.5,4.5)$);
	\node at ($(L2)+(-.5,1)$) {(b)};
	
	\draw[double,line width=1pt] (L2)--++(7.75,0);
	
	\Qin{H0}{L2};
	\Gate{H}{$(L2)+(.5,0)$}{1}{dyell}{$U_R$};
	
	\draw[line width=2pt] ($(L2)+(1.25,.5)$)--++(-.25,0)--++(0,-1.75)--++(.25,0);
	\draw[line width=2pt] ($(L2)+(2.75,.5)$)--++(.25,0)node[right,align=left]{$N_b$}--++(0,-1.75)--++(-.25,0);
	\draw[line width=1pt] ($(L2)+(1.75,-.75)$)--++(1,0);
	\Qin{H0}{$(L2)+(1.75,-.75)$};
	\Gate{H}{$(L2)+(2.25,0)$}{2}{lblue}{$U_G$};
	\Qout{H}{$(L2)+(2.75,-.75)$}{};
	
	\draw[line width=2pt] ($(L2)+(4,.5)$)--++(-.25,0)--++(0,-1.75)--++(.25,0);
	\draw[line width=2pt] ($(L2)+(5.5,.5)$)--++(.25,0)node[right,align=left]{$N_x$}--++(0,-1.75)node[right,align=left]{$i=1$}--++(-.25,0);
	\draw[line width=1pt] ($(L2)+(4.5,-.75)$)--++(1,0);
	\node[left,align=right] at ($(L2)+(4.5,-.75)$){$|x_i\rangle$};
	\Gate{H}{$(L2)+(5,0)$}{2}{dgreen}{$U_D^{(i)}$};
	\Qout{H}{$(L2)+(5.5,-.75)$}{};
	
	\draw[line width=1pt] ($(L2)+(6.75,-.75)$)--++(1,0);
	\Qin{H0}{$(L2)+(6.75,-.75)$};
	\Gate{H}{$(L2)+(7.25,0)$}{2}{red}{$U_C$};
	\Qout{H}{$(L2)+(7.75,0)$}{};
	\Qout{HM}{$(L2)+(7.75,-.75)$}{};
	
\end{tikzpicture}