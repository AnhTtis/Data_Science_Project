\definecolor{lblue}{rgb}{.1,.6,1}
\colorlet{dyell}{yellow!75!black}
\colorlet{dgreen}{green!50!black}
\colorlet{orng}{yellow!50!red}

\newcommand{\TNode}[4]{ % Some tensor node
	\coordinate (temp) at (#2);
	\ifthenelse{\equal{#1}{}}{
		\draw[line width=1pt,fill=#3] (temp)circle(.25);}
	{\ifthenelse{\equal{#1}{C}}{
			\draw[rounded corners=2pt,line width=1pt,fill=#3] ($(temp)-(.25,.25)$)rectangle++(.5,.5);}
		{\ifthenelse{\isodd{#1}}{
				\draw[rounded corners=2pt,line width=1pt,fill=#3] (temp)--++($(.25,0)+#1*(0,.25)$)--++($#1*(0,-.5)$)--++(-.5,0)--(temp);
            \coordinate (temp) at ($(temp)-#1*(0,.05)-(.05,0)$);}
			{\draw[rounded corners=2pt,line width=1pt,fill=#3] (temp)--++($(-.25,0)+#1*(0,.125)$)--++($#1*(0,-.25)$)--++(.5,0)--(temp);
            \coordinate (temp) at ($(temp)-#1*(0,.05)-(.05,0)$);}}}
	\node at (temp) {#4}}

\newcommand{\Gate}[5]{ % Some gate with some width
	\coordinate (temp) at (#2);
	\ifthenelse{\equal{#1}{V}}{
		\draw[rounded corners=2pt,line width=1pt,fill=#4!50!white] ($(temp)-(.25,.25)$)rectangle++($(-.25,.5)+#3*(.75,0)$)node[midway]{#5}}
	{\draw[rounded corners=2pt,line width=1pt,fill=#4!50!white] ($(temp)-(.25,-.25)$)rectangle++($(.5,.25)-#3*(0,.75)$)node[midway]{#5}}}

\newcommand{\Qin}[2]{ % Input or dummy qubits
	\coordinate (temp) at (#2);
	\StrLen {#1}[\tmpLn]
	\ifthenelse{ \tmpLn= 1}{
	\ifthenelse{\equal{#1}{V}}{
	\draw[line width=1pt, fill=yellow!75!red] ($(temp)-(0,.1)$)circle(.15)}
	{\draw[line width=1pt, fill=yellow!75!red] ($(temp)-(.1,0)$)circle(.15)}}
	{\ifthenelse{\equal{#1}{V0}}{
		\node[below] at (temp) {$|0\rangle$}}
		{\node[left,align=right] at (temp){$|0\rangle$}}}}

\newcommand{\Qout}[3]{ % Discard or measure qubits
	\coordinate (temp) at (#2);
	\StrLen {#1}[\tmpLn]
	\ifthenelse{ \tmpLn= 1}{
	\ifthenelse{\equal{#1}{V}}{
		\draw[line width=1pt] ($(temp)+(-.1,.05)$) --++(.2,.1)node[above]{#3};
		\draw[line width=1pt] ($(temp)+(-.1,0)$) --++(.2,.1)}
	{\draw[line width=1pt] ($(temp)+(-.05,.1)$) --++(.1,-.2)node[right]{#3};
	\draw[line width=1pt] ($(temp)+(0,.1)$) --++(.1,-.2)}}{
	\ifthenelse{\equal{#1}{VM}}{\coordinate (temp2) at ($(temp)+(0,.25)$);}{\coordinate (temp2) at ($(temp)+(.25,0)$);}
	\draw[line width=1pt] ($(temp2)-(.25,.25)$)rectangle++(.5,.5);\draw[line width=1pt,->] ($(temp2)+(-.25,-.25)$)--++(.35,.35);}}

\newcommand{\Qreset}[3]{% reset of a qubit
	\coordinate (temp) at (#2);
	\ifthenelse{\equal{#1}{V}}{
		\ifthenelse{\equal{#3}{in}}{
			\draw[fill=white,color=white] ($(temp)-(.1,-.1)$)rectangle++(.2,.4);
			\Qout{V}{$(temp)$}{};
			\Qin{V}{$(temp)+(0,.5)$}}{
			\ifthenelse{\equal{#3}{out}}{\draw[fill=white,color=white] ($(temp)-(.1,-.1)$)rectangle++(.2,1.2);
				\Qout{VM}{$(temp)$}{};
				\Qin{V0}{$(temp)+(0,1.2)$}}{\draw[fill=white,color=white] ($(temp)-(.1,-.1)$)rectangle++(.2,.4);
				\Qout{V}{$(temp)$}{};
				\Qin{V0}{$(temp)+(0,.5)$}}}}{
		\ifthenelse{\equal{#3}{in}}{
			\draw[fill=white,color=white] ($(temp)-(0,.1)$)rectangle++(.4,.2);
			\Qout{H}{$(temp)$}{};
			\Qin{H}{$(temp)+(.5,0)$}}{
			\ifthenelse{\equal{#3}{out}}{
			\draw[fill=white,color=white] ($(temp)-(0,.1)$)rectangle++(1.1,.2);
			\Qout{HM}{$(temp)$}{};
			\Qin{H0}{$(temp)+(1.2,0)$}}{\draw[fill=white,color=white] ($(temp)-(0,.1)$)rectangle++(.65,.2);
			\Qout{H}{$(temp)$}{};
			\Qin{H0}{$(temp)+(.75,0)$}}}}}
	        
	        