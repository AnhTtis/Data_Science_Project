

\begin{figure*}[t]
  \vspace*{0.1in}
  \centering
  \hspace*{-0.62in}
  \begin{tikzpicture}[inner sep=0pt,outer sep=0pt]
    \node[anchor=south west] at ($(0, 0)$)
    	{{\scalebox{0.85}{\input{figs/flowchart}}}};
  \end{tikzpicture}%
  \caption{Hierarchical navigation system with Safer Gap local planner. Red blocks are perception module to generate egocircle. Blue blocks are planning modules. Green block is the control module.\label{fig:pipeline}}
  \vspace*{-1.1em}
\end{figure*}

% The solution to mobile robotics navigation problems https://www.overleaf.com/project/63f3bb7c00a47e28f53173a4typically employs a hierarchical control architecture, as solving the complete navigation problem end-to-end is likely to be challenging or infeasible due to, e.g., computational complexity and unforeseen obstacles. A typical hierarchy involves three tiers. First, a high-level path planner that only uses coarse information about the environment and robot dynamics to generate high-level paths, e.g., waypoints for the robot to sequentially pass through in order to get to the final destination. The second tier is the trajectory planner, which takes the high-level plans along with a finer representation of the environment to generate dynamically feasible and safe trajectories. Finally, the last tier executes the low-level controller to track the trajectories generated by the second tier. Further, in some applications, the functions of the second and third tiers are effectively merged when receding-horizon control is deployed, which is used in this work.

% What is local navigation
%     generate movement to progress towards the goal
%     use sensory data to process free space
    

% Safety is in local navigation

% Different mechanisms, safety guarantee

The local planner module in a hierarchical navigation system processes sensory data to perceive the local environment and represent it as needed by planning and control algorithms. Gaps are such representations, which were shown to support collision-free navigation of idealized robots based on artificial potential fields (APF)
\cite{pgap}. The method, called \textit{Potential Gap} generates safe trajectories guiding the robot through its ego-centric free space toward local gap-based goals. Safety guarantees hold for point-mass holonomic robots
but not for nonholonomic robots. Additional robustification mechanisms were added to improve forward invariance of the  safe space prescribed by the APF. Formal safety guarantees were lost and passage through gaps was compromised.  This paper extends gap-based local planning safety guarantees to nonholonomic models. 
%by utilizing B\'{e}zier curves and a barrier function (BF) approach to guarantee safety at various stages, i.e., planning and control.

Safety relies on adequately modeling the collision-free space of the robot. Fig.~\ref{fig:bezier_safe} depicts such a region specialized to the gap between two obstacles. It is represented by the union of the largest robot-centered disc and the region between the gap lines. Also depicts is the inflated free area, in dark gray, due to the robot's physical footprint. To use zeroing barrier function (ZBF) safe control synthesis, the free space must be represented by a continuously differentiable implicit function positive inside the safe region and negative outside (the zero level-set defines the boundary). As safe region resembles the shape of a ``keyhole'', we will call the ZBF a {\keyhole}.

The hierarchical navigation system, depicted in Fig.~\ref{fig:pipeline}, relies on a global planner to generate a candidate path to the goal in the world map. The {\saferGap} local planner reacts to local unknown environments and achieves obstacle avoidance. First, a smooth collision-free path based on B\'{e}zier curves is generated from detected gaps. 
% BF safety is incorporated at both stages, as shown in Figure \ref{fig:pipeline}.
If the B\'{e}zier curve control points are contained in the {\keyhole} boundary, then the curve is also contained in the same region \cite{bezierbook}; thus, the path is guaranteed to be collision-free. 
Nonlinear model predictive control (NMPC) is applied to track that path under kinematic feasibility constraints. To guarantee safe path tracking, the {\keyhole} is transcribed as a hard constraint in NMPC. Finally, as a last measure of safety to cope with the rapidly changing environment and the slower rate of NMPC, the {\keyhole} is enforced in a control BF (CBF) point-wise optimization safe control synthesis.

The contributions and organization of {\saferGap} as annotated in Fig.~\ref{fig:pipeline} (dashed) are: \textbf{(i)} Joined B\'{e}zier path generation (\S \ref{sec:bp}) guarantees safety and kinematic passibility through gaps. \textbf{(ii)} The real-time synthesized {\keyhole} (\S \ref{sec:keyhole}) models the safe keyhole region.  NMPC trajectory tracking (\S \ref{sec:nmpc}) with {\keyhole} constraint and nonholonomic dynamics synthesizes safe trajectories. \textbf{(iii)} The {\keyhole} acts as a CBF (\S \ref{sec:cbf}) to ensure safety at the lowest level. 
Simulation benchmarking and real experiments in \S \ref{sec:exp} confirm {\saferGap}'s collision-free properties.
