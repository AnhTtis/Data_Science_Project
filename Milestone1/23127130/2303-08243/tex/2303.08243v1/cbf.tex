\subsection{Keyhole Control Barrier Function \label{sec:cbf}}
% \TODO{Ahmad}

Since the domain of the {\keyhole} will be the position of the robot (excluding orientation), a single integrator model is assumed for the robot in CBF-QP. The reference control command is the instantaneous translational velocity of the robot, i.e., $u_r=[\nu_r\cos\theta,\nu_r\sin\theta]^T$. Again, the subscript $r$ denotes the outputs from the reference controller, which NMPC in this case. The calculated safe velocity commands by CBF-QP \eqref{cbf-qp}, $u=[\dot{x}_s,\dot{y}_s]^T$, are mapped to the robot commands using \eqref{w-qp} and \eqref{v-qp}. $\Delta\theta$ is the angle difference between the vectors $u_r$ and $u$ and is added to the current rotation rate to correct the angle difference. $k_{\omega}$ is a positive tunable parameter. The translational velocity is damped down proportional to the ratio of $\Delta\theta$ to a maximum angle $\theta_{max}$. If $\abs{\Delta\theta}\geq\theta_{max}$, the robot will only rotate. 
\begin{align}
    \omega &= \omega_r + k_{\omega}\Delta\theta \eqlabel{w-qp} \\ 
    \nu      &= \max\left(0,1-\frac{\abs{\Delta\theta}}{\theta_{max}}\right)\norm{u} \eqlabel{v-qp}
\end{align}

Overall, the {\saferGap} local planner is designed to maintain safety and passibility for nonholonomic mobile robots. From joined B\'{e}zier path planning, NMPC trajectory tracking with {\keyhole}, and control barrier function, safety guarantee is proved.
