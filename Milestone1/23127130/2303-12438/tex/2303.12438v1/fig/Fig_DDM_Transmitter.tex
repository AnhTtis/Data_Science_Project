

%\newcommand\DELTA{0.5}
\begin{figure}[!t]
\centering
\begin{tikzpicture}[scale=0.8, style=thick, rounded corners=1pt,inner sep=3.2pt,node distance=.8cm,every text node part/.style={align=center}]
%\tikzset{
%    mynode/.style={sharp corners=2pt,inner sep=7pt,node distance=.8cm,every text node part/.style={align=center}},
%    myarrow/.style={->, >=latex', shorten >=1pt, thick},
%    mylabel/.style={text width=7em, text centered} ,
%    classical/.style={thick,->,>=stealth},
%    cirarrow/.style={thick,->,>=stealth, dashed,shorten >=4pt,shorten <=4pt},
%}

% Draw rectangular nodes (switch sharp to smooth for different corners)
\node[ minimum height = 1cm, minimum width = 1cm] (state0){\small Transmit data \\ $\m{S} \in \mathbb{C}^{N_\text{c} \times N_\text{sym}}$};

\node[above right =-0.8cm and 1.6cm of state0, minimum height = 0cm, minimum width = 0cm]{ $\vdots $};
\node[above right =-0.8cm and 3.4cm of state0, minimum height = 0cm, minimum width = 0cm]{ $\vdots $};
\node[above right =-0.8cm and 5.0cm of state0, minimum height = 0cm, minimum width = 0cm]{ $\vdots $};

\node[draw, above right =-0.2cm and 0.6cm of state0, minimum height = 1cm, minimum width = 1cm](state1u){\small $ \m{D}_{N_\text{sym}} \left( \frac{\Delta \psi_0}{2 \pi} \right)  $};

\node[right=0.1cm of state1u](yarr1){};
\node[above=0.4cm of yarr1](yarr2){$\m{S}_{0}$};
\draw [->, shorten <=0.01cm, shorten >=0.01cm, style=solid] (yarr1) to [out=80,in=260] (yarr2);

\node[draw, below right =-0.2cm and 0.6cm of state0, minimum height = 1cm, minimum width = 1cm](state1d){\small $ \m{D}_{N_\text{sym}} \left( \frac{\Delta \psi_3}{2 \pi} \right)  $};

\node[right=0.1cm of state1d](yarr1a){};
\node[above=0.4cm of yarr1a](yarr2a){$\m{S}_{3}$};
\draw [->, shorten <=0.01cm, shorten >=0.01cm, style=solid] (yarr1a) to [out=80,in=260] (yarr2a);


\draw[->] (state0.east)  -- ++(0.3cm,0) -- ++(0,1.035cm) -- (state1u.west);
\draw[->] (state0.east)  -- ++(0.3cm,0) -- ++(0,-1.035cm) -- (state1d.west);

\node[draw,right=0.4cm of state1u, minimum height = 1cm, minimum width = 1cm](state2u){\small $\m{F}_{N_\text{c}}^{-1} \downarrow$};
\node[draw,right=0.4cm of state1d, minimum height = 1cm, minimum width = 1cm](state2d){\small $\m{F}_{N_\text{c}}^{-1} \downarrow$};

\draw[->] (state1u.east)  -- (state2u.west);
\draw[->] (state1d.east)  -- (state2d.west);

\node[draw,right=0.4cm of state2u, minimum height = 1cm, minimum width = 1cm](state3u){\small Add CP};
\node[draw,right=0.4cm of state2d, minimum height = 1cm, minimum width = 1cm](state3d){\small Add CP};

\draw[->] (state2u.east)  -- (state3u.west);
\draw[->] (state2d.east)  -- (state3d.west);

%\node[draw,right=0.5cm of state3u, minimum height = 1cm, minimum width = 1cm](state4u){\small Analog \\ front-end};
%\node[draw,right=0.5cm of state3d, minimum height = 1cm, minimum width = 1cm](state4d){\small Analog \\ front-end};
%
%\draw[->] (state3u.east)  -- (state4u.west);
%\draw[->] (state3d.east)  -- (state4d.west);

\draw (state3u.east)  -- ++(0.4,0) coordinate (Ant1u);
\draw (Ant1u)  -- ++(0,0.4) coordinate (IntAnt1u);
\draw (IntAnt1u)  -- ++(-0.2,0.3);
\draw (IntAnt1u)  -- ++(0.2,0.3);

\draw (state3d.east)  -- ++(0.4,0) coordinate (Ant1d);
\draw (Ant1d)  -- ++(0,0.4) coordinate (IntAnt1d);
\draw (IntAnt1d)  -- ++(-0.2,0.3);
\draw (IntAnt1d)  -- ++(0.2,0.3);




\end{tikzpicture}
\caption{DDM signal processing chain in the transmitter for the case of $N_\text{Tx}=4$. The the parallel-to-serial conversion, the DAC, and the analog front-end are not shown for simplicity.}
\label{fig:DDM_Transmitter}
\end{figure}



