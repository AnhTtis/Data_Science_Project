\documentclass[article,twocolumn,floatfix,superscriptaddress,longbibliography]{revtex4-1}
%\usepackage[printfigures,blank]{figcaps}
%\usepackage[nomarkers,notables,nolists]{endfloat}
%\usepackage[font=small,  justification=justified,format=plain]{caption}
\usepackage[hidelinks]{hyperref}
\usepackage{physics}
\pagestyle{empty}
\usepackage{xr}
\externaldocument[M-]{main}
\renewcommand{\theequation}{S.\arabic{equation}}
%\usepackage{caption}

%\captionsetup[figure]{font=small,labelsep=period, name={Fig. S}}
%\captionsetup[table]{font=small,labelsep=period, justification=raggedright}

\setcitestyle{super}
\setlength{\parindent}{0in}
\usepackage{graphicx}
\makeatletter
\usepackage{mathtools}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{bbold}
\newtagform{flat mode}[]()
%\counterwithin*{equation}{section}
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\renewcommand{\thetable}{S\arabic{table}}  
\renewcommand{\thefigure}{S\arabic{figure}} 
\makeatother
\begin{document}

\title{{\bf Supplementary Material for the article:}\\ ``Electron-photon Chern number in cavity-embedded 2D moir\'{e} materials"}

\author{Danh-Phuong Nguyen}
\affiliation{Universit\'{e} Paris Cit\'e, CNRS, Mat\'{e}riaux et Ph\'{e}nom\`{e}nes Quantiques, 75013 Paris, France}
\author{Geva Arwas}
\affiliation{Universit\'{e} Paris Cit\'e, CNRS, Mat\'{e}riaux et Ph\'{e}nom\`{e}nes Quantiques, 75013 Paris, France}
\author{Zuzhang Lin}
\affiliation{Department of Physics, The University of Hong Kong, Hong Kong, China}
\affiliation{HKU-UCAS Joint Institute of Theoretical and Computational Physics at Hong Kong, China} 
\author{Wang Yao}
\affiliation{Department of Physics, The University of Hong Kong, Hong Kong, China}
\affiliation{HKU-UCAS Joint Institute of Theoretical and Computational Physics at Hong Kong, China}
\author{ Cristiano Ciuti}
\affiliation{Universit\'{e} Paris Cit\'e, CNRS, Mat\'{e}riaux et Ph\'{e}nom\`{e}nes Quantiques, 75013 Paris, France}



\date{\today}
\maketitle
\newtagform{supplementary}[]()
\section{Cavity QED Hamiltonian}
In this section we derive a four-band continuum model \cite{Wu2019,Zhai2020} for small angle twisted bilayer TMD. The electron-photon Hamiltonian can be written as:
\begin{equation}
\label{eq:S-f4}
    \hat{H} = \hbar\omega_c\hat{a}^{\dagger}\hat{a} + \begin{pmatrix}
        \hat{H}_{t} & 0 \\ 0 & \hat{H}_{b}
    \end{pmatrix} + \begin{pmatrix}
        \hat{V}_t & \hat{U} \\ \hat{U}^{\dagger} & \hat{V}_b
    \end{pmatrix},
\end{equation}
where $\hat{a}^{\dagger}$ creates a photon of frequency $\omega_c$, $\hat{H}_{t}$ ($\hat{H}_{b}$) is a $2 \cross 2$ matrix corresponding to the top (bottom) layer describing the TMD material along with the coupling to the cavity photon. The last term is a $4 \cross 4$ matrix describing the moir\'{e} potential. $\hat{V}_{t}$ and $\hat{V}_{b}$ describe the intra-layer interactions, while $\hat{U}$ is the layer-layer interaction. Each layer is a honeycomb lattice with the lattice constant $a_0$ and is defined by the two primitive vectors $\mathbf{a}_1 = a_0\sqrt{3}/2(1, \sqrt{3}, 0)$, $\mathbf{a}_2 = a_0\sqrt{3}/2(-1, \sqrt{3}, 0)$ and their reciprocal counterparts $\mathbf{b}_1 = 2\pi/(3a_0)(\sqrt{3},1,0)$, $\mathbf{b}_2 = 2\pi/(3a_0)(-\sqrt{3},1,0)$. % such that $\mathbf{a}_i\cdot\mathbf{b}_j = 2\pi\delta_{ij}$.
The top layer is rotated in-plane by a small angle $\theta$ in order to create a moir\'{e} pattern. 
%A point $\mathbf{r}$ in the top layer was originally at the point $\mathbf{r}_0 = R^{-1}(\theta)\mathbf{r}$ where $R(\theta)$ is the rotation matrix about the $z$-axis, hence the mismatch between layers is $\boldsymbol{\Delta}(\mathbf{r}) = [\mathbb{1} - R^{-1}(\theta)]\mathbf{r}$. 
The mismatch between layers is given by $\boldsymbol{\Delta}(\mathbf{r}) = [\mathbb{1} - R^{-1}(\theta)]\mathbf{r}$, where $R(\theta)$ is a rotation matrix about the $z$-axis. One moir\'{e} unit cell is defined by $\mathbf{L}_{i=1,2}$ such that $\boldsymbol{\Delta}(\mathbf{L}_i)= \mathbf{a}_i$, hence $\mathbf{L}_i = [\mathbb{1} - R^{-1}(\theta)]^{-1}\mathbf{a}_i$. Similarly, the moir\'{e} reciprocal lattice vectors $\mathbf{G}_i = [\mathbb{1} - R(\theta)]\mathbf{b}_i$, satisfying $\mathbf{L}_i \cdot \mathbf{G}_j = 2\pi \delta_{ij}$. %With a well-defined set of vectors, we will now demonstrate each term in the $4 \cross 4$ matrix in equation (\ref{eq:S-f4}).
\begin{figure}
\centering
%\includegraphics[scale=0.22]{Images/cavity-moire-2.pdf} \\ 
%\centering
\includegraphics[width = 0.49\hsize]{SM_fig_1_1.pdf}
\includegraphics[width = 0.49\hsize]{SM_fig_1_2.pdf}
%\includegraphics[scale=0.33]{Images/Main/TMD/all BZ.png}
\caption{First Brillouin zone with Dirac points of the bottom layer (left) and moir\'{e} Brillouin zone (shown in red) of moir\'e superlattice (right).}\label{fig:SM-TMD-mBZ}
\end{figure}

Each layer is described by a tight binding Hamiltonian on the honeycomb lattice, with hopping coupling quantified by $t$. The unit cell consists of two sites $A, B$ having an on-site energy difference of $2\Delta$. The electron-photon interaction is introduced via Peierls substitution. For the bottom layer, we can write the Hamiltonian as:
\begin{equation}
\label{eq:S:H2f}
    \begin{aligned}
        \hat{H}_{b} &= \Delta\sum_{\mathbf{R}}\bigg(\ket{A,\mathbf{R}}\bra{A,\mathbf{R}} - \ket{B,\mathbf{R}}\bra{B,\mathbf{R}}\bigg)\\
        &+ t\sum_{\mathbf{R},j=1,2,3}e^{-ig(\hat{a}+\hat{a}^{\dagger})\mathbf{u}\cdot\mathbf{e}_j}\ket{B,\mathbf{R} + \mathbf{a}_j}\bra{A,\mathbf{R}} + \text{h.c},
    \end{aligned}
\end{equation}
where $g = eA_0a_0/\hbar$, $\mathbf{u}$ is the cavity orientation, $\mathbf{e}_{j=1,2,3} = R\left(j2\pi/3\right)(0,-1,0)$ and $\mathbf{a}_3 = (0,0,0)$. We assume the cavity field $\mathbf{A}$ is uniform, such that the Hamiltonian (\ref{eq:S:H2f}) is block-diagonal in $\mathbf{k}$ space. The Bloch Hamiltonian $H^e_b({\mathbf{k}})$ is given by:
\begin{equation}
\label{eq:S:H3f}
    \begin{aligned}
        \hat{H}_b(\mathbf{k}) &= \Delta\ket{A,\mathbf{k}}\bra{A,\mathbf{k}} - \Delta\ket{B,\mathbf{k}}\bra{B,\mathbf{k}}\\
        &+ t\sum_{j=0,1,2} e^{-ig(\hat{a}+\hat{a}^{\dagger})\mathbf{u}\cdot\mathbf{e}_j}e^{-i\mathbf{k}\cdot\mathbf{a}_j}\ket{B,\mathbf{k}}\bra{A,\mathbf{k}} + \text{h.c},
    \end{aligned}
\end{equation}
where $\mathbf{k}$ is in the Brillouin zone (BZ) as shown in Figure \ref{fig:SM-TMD-mBZ}. Next, we expand around one valley $\mathbf{K}_b$ such that $\mathbf{K}_b\cdot\mathbf{a}_1 = -2\pi/3$, and at the  first order in $g$, we have: 
%
\begin{equation}
\begin{aligned}
\hat{H}_b({\mathbf{k}}) &= \Delta\sigma_z + \frac{3a_0t}{2}\left(\mathbf{k} - \mathbf{K}_b + \frac{e\mathbf{A}^{(xy)}}{\hbar}\left(\hat{a} + \hat{a}^{\dagger}\right)\right)\cdot \boldsymbol{\sigma},
\end{aligned}
\label{SM:eq-Heb}
\end{equation}
where $\boldsymbol{\sigma} = (\sigma_x,\sigma_y,\sigma_z)$ are the Pauli matrices for the sub-lattice degree of freedom, $\mathbf{A}^{(xy)}$ is the in-plane projection of the cavity field $\mathbf{A}$.


The top layer is rotated in real space by an angle $\theta$ such that the lattice vectors in equation (\ref{eq:S:H2f}) are transformed as $\mathbf{a} \to \tilde{\mathbf{a}} = R(\theta)\mathbf{a}$. Following the same procedure and restricting $\mathbf{k}$ to the vicinity of $\mathbf{K}_t = R(\theta)\mathbf{K}_b$ one gets:
\begin{equation}
\label{SM:eq-Het}
\begin{aligned}
\hat{H}_t({\mathbf{k}}) \ &= \ \Delta\sigma_z \\ &+ \frac{3a_0t}{2}R^{-1}(\theta)\left(\mathbf{k} - \mathbf{K}_t + \frac{e\mathbf{A}^{(xy)}}{\hbar}\left(\hat{a} + \hat{a}^{\dagger}\right)\right)\cdot \boldsymbol{\sigma}.
\end{aligned}
\end{equation}

In the presence of the cavity, the interlayer hopping $\hat{U}$ between site $\mathbf{R}_b$ of the bottom and $\mathbf{R}_t$ of the top can be approximated as:
\begin{equation}
    \hat{U} = \sum_{\substack{\mathbf{R}_b,\mathbf{R}_t \\ \sigma = A,B}}e^{-i\Phi_{\mathbf{R}_t,\mathbf{R}_b}(\hat{a}+\hat{a}^{\dagger})}T(\mathbf{R}_t -\mathbf{R}_b)\ket{\sigma,\smash{\mathbf{R}_t}}\bra{\sigma,\mathbf{R}_b} ,
\end{equation}
where $ T(\mathbf{R}_t -\mathbf{R}_b)$ is the hopping coefficient in the absence of a cavity \cite{Wang2017,Bistritzer2011}. We assume that the interlayer hopping is only between sub-lattices of the same type. $\mathbf{R}_t - \mathbf{R}_b = \mathbf{d} + \boldsymbol{\Delta}(\mathbf{r})$ where $\mathbf{d} = d(0,0,1)$ is the distance between two layers. The Peierls phase can be approximated by $\Phi_{\mathbf{R}_t,\mathbf{R}_b} = e\mathbf{A}\cdot(\mathbf{R}_t-\mathbf{R}_b)/\hbar \approx eA^{(z)}d/\hbar$, where $A^{(z)}$ is the $z$-component of the cavity field. Since the Peierls phase does not depend on $\mathbf{r}$, we can write the interlayer coupling as:
\begin{equation}
    \hat{U} = e^{-i\frac{eA^{(z)}d}{\hbar}(\hat{a}+\hat{a}^{\dagger})}\hat{U}_0,
\end{equation}
where $\hat{U}_0$ is a moir\'{e} interlayer hopping in the absence of the cavity. 

Combining all terms and defining $v_F = 3a_0 t/(2\hbar)$ one gets a low-energy Hamiltonian for the twisted bilayer TMD coupled to cavity field:
\begin{widetext}
\begin{equation}
\label{eq:S:H5}
    \widetilde{H} = 
    \begin{pmatrix}
    \Delta \sigma_z + v_F R^{-1}(\theta)\left[\mathbf{\hat{p}} - \hbar\boldsymbol{\kappa}_- +  e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger}) \right]\cdot\boldsymbol{\sigma} + \hat{V}_t & e^{-i\frac{eA^{(z)} d}{\hbar} (\hat{a}+\hat{a}^{\dagger})}\hat{U}_0 \\
    e^{i\frac{eA^{(z)} d}{\hbar}(\hat{a}+\hat{a}^{\dagger})}\hat{U}_0^{\dagger} &  \Delta \sigma_z + v_F \left[\mathbf{\hat{p}} -\hbar\boldsymbol{\kappa}_+ + e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger})  \right]\cdot\boldsymbol{\sigma}  + \hat{V}_b
    \end{pmatrix} + \hbar \omega_c \hat{a}^{\dagger}\hat{a}.
\end{equation}
%\end{widetext}
Note that here we change the notation as $\mathbf{K}_b$ ($\mathbf{K}_t$) $\rightarrow \boldsymbol{\kappa}_+ $ ($\boldsymbol{\kappa}_-$) to highlight the moir\'{e} mini-BZ (see Fig. \ref{fig:SM-TMD-mBZ}). Next, we apply the unitary transformation $\hat{T}_{\theta} = \text{diag}(e^{-i\frac{\theta}{2}\sigma_z},\mathbb{1})$, leading to
%\begin{widetext}
\begin{equation}
    \hat{T}_{\theta}\widetilde{H}\hat{T}_{\theta}^{\dagger} = \begin{pmatrix}
    \Delta \sigma_z + v_F \left[\mathbf{\hat{p}} - \hbar\boldsymbol{\kappa}_- +  e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger}) \right]\cdot\boldsymbol{\sigma} + \hat{V}_t & e^{-i\frac{eA^{(z)} d}{\hbar} (\hat{a}+\hat{a}^{\dagger})}e^{-i\frac{\theta}{2}\sigma_z}\hat{U}_0 \\
    e^{i\frac{eA^{(z)} d}{\hbar}(\hat{a}+\hat{a}^{\dagger})}e^{i\frac{\theta}{2}\sigma_z}\hat{U}_0^{\dagger} &  \Delta \sigma_z + v_F \left[\mathbf{\hat{p}} -\hbar\boldsymbol{\kappa}_+ + e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger})  \right]\cdot \boldsymbol{\sigma} + \hat{V}_b
    \end{pmatrix} + \hbar \omega_c \hat{a}^{\dagger}\hat{a} .
\end{equation}
%\end{widetext}
We remove the photonic operators from the off-diagonal terms using the unitary transformation $\hat{T}_{d} = \text{diag}(e^{i\frac{eA^{(z)}d}{2\hbar}\left(\hat{a}+ \hat{a}^{\dagger}\right)},e^{-i\frac{eA^{(z)}d}{2\hbar}\left(\hat{a}+ \hat{a}^{\dagger}\right)})$. The photonic number operator transforms as $\hat{a}^{\dagger}\hat{a} \to \hat{a}^{\dagger}\hat{a} + i\frac{eA^{(z)}d}{2\hbar}\left(\hat{a} - \hat{a}^{\dagger}\right)\tau_z + \text{constant}$, where $\tau_z$ is the Pauli matrix with respect to the layer pseudo-spin. Finally, the four-band Hamiltonian $\hat{H}^{(4)} = \hat{T}_d\hat{T}_{\theta}\widetilde{H}\hat{T}^{\dagger}_{\theta}\hat{T}^{\dagger}_d$ can be written as:
%\begin{widetext}
\begin{equation}
\label{eq:S:Hf}
\begin{aligned}
    \hat{H}^{(4)} &= \begin{pmatrix}
    \Delta \sigma_z + v_F \left[\mathbf{\hat{p}} - \hbar\boldsymbol{\kappa}_- +  e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger}) \right]\cdot\boldsymbol{\sigma} + \hat{V}_t & e^{-i\frac{\theta}{2}\sigma_z}\hat{U}_0 \\
    e^{i\frac{\theta}{2}\sigma_z}\hat{U}_0^{\dagger} &  \Delta \sigma_z + v_F \left[\mathbf{\hat{p}} -\hbar\boldsymbol{\kappa}_+ + e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger})  \right]\cdot \boldsymbol{\sigma} + \hat{V}_b
    \end{pmatrix} \\
    &+ \hbar \omega_c \hat{a}^{\dagger}\hat{a} + i\frac{\omega_c e A^{(z)} d}{2}\left(\hat{a} - \hat{a}^{\dagger}\right)\tau_z.
    \end{aligned}
\end{equation}
\end{widetext}
\section{Effective model for the valence bands}

For the case of large $\Delta$ we can construct an effective model for the valence bands. Let $\Psi = (\Psi_{t}^c, \Psi_{t}^v, \Psi_{b}^c, \Psi_{b}^v)^T$ be an eigenvector of $\hat{H}^{(4)}$ with energy $E$, where $c$ ($v$) corresponds to the conduction (valence) bands. Using (\ref{eq:S:Hf}), we can write
\begin{widetext}
 \begin{equation}
 \label{SM:eq-all 4}
 \begin{aligned}
     \left(\Delta + \hat{V}_t^c + \hbar\omega_c\hat{a}^{\dagger}\hat{a} + \hat{D}\right)\Psi_{t}^c + v_F\left(\hat{\Pi}_{tx} - i\hat{\Pi}_{ty}\right)\Psi_{t}^v + e^{-i\frac{\theta}{2}}_{c}\hat{U}_{0}^c\Psi_{b}^c &= E\Psi_{t}^c,\\
     v_F\left(\hat{\Pi}_{tx} + i\hat{\Pi}_{ty}\right)\Psi_{t}^c + \left(-\Delta + \hat{V}_t^v + \hbar\omega_c\hat{a}^{\dagger}\hat{a} + \hat{D}\right)\Psi_{t}^v + e^{i\frac{\theta}{2}}\hat{U}_{0}^v\Psi_{b}^v &=  E\Psi_{t}^v,\\ 
     \left(\Delta + \hat{V}_b^c + \hbar\omega_c\hat{a}^{\dagger}\hat{a} - \hat{D}\right)\Psi_{b}^c + v_F\left(\hat{\Pi}_{bx} - i\hat{\Pi}_{by}\right)\Psi_{b}^v + e^{i\frac{\theta}{2}}_{c}(\hat{U}^c_{0})^{\dagger}\Psi_{t}^c &= E\Psi_{b}^c,\\
     v_F\left(\hat{\Pi}_{bx} + i\hat{\Pi}_{by}\right)\Psi_{b}^c + \left(-\Delta + \hat{V}_b^v + \hbar\omega_c\hat{a}^{\dagger}\hat{a} - \hat{u}\right)\Psi_{b}^v + e^{-i\frac{\theta}{2}}(\hat{U}^v_{0})^{\dagger}\Psi_{t}^v &=  E\Psi_{b}^v,      
 \end{aligned}
 \end{equation}
 \end{widetext}
where for brevity we introduce the notation $\hat{\boldsymbol{\Pi}}_{b,t} = \hat{\mathbf{p}} - \hbar\boldsymbol{\kappa}_{+,-} + e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger})$ and $\hat{D} = i\frac{\omega_c e A^{(z)} d}{2}\left(\hat{a} - \hat{a}^{\dagger}\right)$.

We consider a TMD material that has a large gap between the conduction and valence bands, and for states localized in the latter, we have $E \approx -\Delta$ and $||\Psi_{t}^c||, ||\Psi_{b}^c|| \ll ||\Psi_{t}^v||, ||\Psi_{b}^v|| $. Additionally, the moir\'{e} potentials and photon energy are also weak such that $||\hat{U}_0||, ||\hat{V}_t||, ||\hat{V}_b||, \hbar\omega_c \ll \Delta$. By neglecting higher order terms, the first two equations of (\ref{SM:eq-all 4}) corresponding to the top layer become:
\begin{widetext}
\begin{equation}
\begin{aligned}
    &2\Delta\Psi_{t}^c + v_F\left(\hat{\Pi}_{tx} - i\hat{\Pi}_{ty}\right)\Psi_{t}^v = 0,\\
    &v_F\left(\hat{\Pi}_{tx} + i\hat{\Pi}_{ty}\right)\Psi_{t}^c + \left(-\Delta + \hat{V}_t^v + \hbar\omega_c\hat{a}^{\dagger}\hat{a} - \hat{D}\right)\Psi_{t}^v + e^{i\frac{\theta}{2}}\hat{U}_{0}^v\Psi_{b}^v =  E\Psi_{t}^v.
\end{aligned}
\end{equation}
%\end{widetext}
Solving the first line for $\Psi_{t}^c$ and defining the effective mass $m^{\star} = \frac{\Delta}{v_F^2}$, the second line can be written as
%\begin{widetext}
\begin{equation}
\left(-\frac{\left[\hat{\mathbf{p}} -\hbar\boldsymbol{\kappa}_-+ e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger})\right]^2}{2m^{\star}} + \hat{V}_t^v - \Delta + \hbar\omega_c\hat{a}^{\dagger}\hat{a} + \hat{D}\right)\Psi_{t}^v + e^{i\frac{\theta}{2}}\hat{U}_{0}^v\Psi_{b}^v = E\Psi_{t}^v.
\end{equation}
%\end{widetext}
Following the same procedure, we obtain another equation for the bottom layer with $\boldsymbol{\kappa}_- \to \boldsymbol{\kappa}_+$, $t \to b$. Combining the two equations we get an effective Hamiltonian for the valence bands: 
%\begin{widetext}
 \begin{equation}
\widetilde{\mathcal{H}} = 
    -\frac{1}{2m^{\star}}\begin{pmatrix}
   (\hat{\mathbf{p}} - \hbar\mathbf{\boldsymbol{\kappa}_-}  + e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger}))^2 & 0 \\
    0 & (\hat{\mathbf{p}} - \hbar\boldsymbol{\kappa}_+ +e\mathbf{A}^{(xy)}(\hat{a}+\hat{a}^{\dagger}))^2
\end{pmatrix} 
    +  
    \begin{pmatrix}
    \hat{V}_t^v & \hat{U}_{0}^v \\ \hat{U}_{0}^{v\dagger} & \hat{V}_b^v
    \end{pmatrix}  + \hbar \omega_c \hat{a}^{\dagger}\hat{a} + i \omega_c\frac{eA^{(z)}d}{2}(\hat{a}-\hat{a}^{\dagger})\tau_z.
    \label{SM:eq-last H}
\end{equation}
 \end{widetext}
 The intralayer moir\'{e} potentials $\hat{V}^{v}_{t}$ and $\hat{V}^{v}_{b}$ can be written as \cite{Wu2019,Zhai2020}:
\begin{equation}
\label{eq:S-Vt}
    V_{t/b}^v(\mathbf{r}) = V_0 \sum_{i=1}^3\text{cos}(\mathbf{K}_i\cdot\boldsymbol{\Delta}(\mathbf{r}) \pm \alpha),
\end{equation}
where $\mathbf{K}_i$ are shown in Fig. \ref{fig:SM-TMD-mBZ}. In order to simplify the calculation, one could use the relation $\mathbf{K}_i\cdot\boldsymbol{\Delta
}(\mathbf{r}) = \mathbf{G}_i\cdot\mathbf{r}$, where $\mathbf{G}_{1,2}$ are reciprocal lattice vectors of the moir\'{e} system defined above and $\mathbf{G}_3 = \mathbf{G}_1 - \mathbf{G}_2$. The interlayer coupling $\hat{U}_0^v$ is given by \cite{Wu2019,Zhai2020}:
\begin{equation}
\label{eq:S:Uvv}
    U_{0}^v(\mathbf{r}) =
   h_0\sum_{j=1}^{3}  e^{i\left(\mathbf{G}_j-\mathbf{G}_1\right)\cdot\mathbf{r}}.
\end{equation}
For the numerical simulations presented in the paper we used the parameters of $\text{MoTe}_2$: $m^{\star} \approx 0.62m_e$ where $m_e$ is the bare electron mass, $a_0 \approx 3.5$\AA, $d \approx 10$\AA, moir\'{e} potentials $(V_0, \alpha, h_0) \approx (16\text{ meV}, 89.6^{\circ}, -8.5\text{ meV})$ \cite{Wu2019}.

\section{Particle-hole transformation}
In this section we detail the present model (\ref{SM:eq-last H}) in the hole picture. In second quantization, (\ref{SM:eq-last H}) reads:
\begin{widetext}
    \begin{equation}
        \begin{aligned}
            \widetilde{\mathcal{H}} &= \hbar\omega_c\hat{a}^{\dagger}\hat{a}-\frac{\hbar^2}{2m^{\star}}\sum_{\mathbf{q},\nu}\hat{c}_{\nu\mathbf{q}}^{\dagger}\left[\mathbf{q} -\mathbf{K}_{\nu}+ \frac{e\mathbf{A}^{(xy)}}{\hbar}(\hat{a}+\hat{a}^{\dagger})\right]^2\hat{c}_{\nu\mathbf{q}} + \sum_{\nu}\int d\mathbf{r}\hat{c}_{\nu}^{\dagger}(\mathbf{r})V^v_{\nu}(\mathbf{r})\hat{c}_{\nu}(\mathbf{r})\\
            &+ \int d\mathbf{r}\left[\hat{c}_{t}^{\dagger}(\mathbf{r})U_0^v(\mathbf{r})\hat{c}_{b}(\mathbf{r}) + \text{h.c}\right] + i\omega_c\frac{eA^{(z)}d}{2}\left(\hat{a}-\hat{a}^{\dagger}\right)\int d\mathbf{r}\left(\hat{c}^{\dagger}_t(\mathbf{r})\hat{c}_{t}(\mathbf{r}) - \hat{c}^{\dagger}_b\mathbf{r}\hat{c}_{b}\right),
        \end{aligned}
    \end{equation}
%\end{widetext}
where $\nu = t,b$ and $\mathbf{K}_{b,t} = \boldsymbol{\kappa}_{+,-}$. The particle-hole transformation can be defined by a unitary operator $\hat{\Gamma}$, such that $\hat{\Gamma} \hat{c}^{\dagger}_{\nu}(\mathbf{r}) \hat{\Gamma}^{\dagger} = \hat{c}_{\nu}(\mathbf{r})$. Under this transformation the momentum operators transform as $\hat{c}_{\nu\mathbf{q}}^{\dagger} \rightarrow \hat{\Gamma} \hat{c}^{\dagger}_{\nu\mathbf{q}} \hat{\Gamma}^{\dagger} = \hat{c}_{\nu-\mathbf{q}}$. Using the particle-hole transformation, the Hamiltonian $\hat{\mathcal{H}} = \hat{\Gamma}\widetilde{H}\hat{\Gamma}^{\dagger}$ becomes: 
%\begin{widetext}
    \begin{equation}
    \label{SM:eq-2hole}
        \begin{aligned}
            \hat{\mathcal{H}} &= \hbar\omega_c\hat{a}^{\dagger}\hat{a}+\frac{\hbar^2}{2m^{\star}}\sum_{\mathbf{q},\nu}\hat{c}_{\nu\mathbf{q}}^{\dagger}\left[\mathbf{q} +\mathbf{K}_{\nu}- \frac{e\mathbf{A}^{(xy)}}{\hbar}(\hat{a}+\hat{a}^{\dagger})\right]^2\hat{c}_{\nu\mathbf{q}} - \sum_{\nu}\int d\mathbf{r}\hat{c}_{\nu}^{\dagger}(\mathbf{r})V^v_{\nu}(\mathbf{r})\hat{c}_{\nu}(\mathbf{r})\\
            &- \int d\mathbf{r}\left[\hat{c}_{b}^{\dagger}(\mathbf{r})U_0^v(\mathbf{r})\hat{c}_{t}(\mathbf{r}) + \text{h.c}\right] - i\omega_c\frac{eA^{(z)}d}{2}\left(\hat{a}-\hat{a}^{\dagger}\right)\int d\mathbf{r}\left(\hat{c}^{\dagger}_t(\mathbf{r})\hat{c}_{t}(\mathbf{r}) - \hat{c}^{\dagger}_b(\mathbf{r})\hat{c}_{b}(\mathbf{r})\right).
        \end{aligned}
    \end{equation}
\end{widetext}
Equation (\ref{SM:eq-2hole}) results in the change of the sign of the effective mass, the charge and the moir\'{e} potentials. Note that we have disregarded divergent sums that result from the interaction of all valance electrons with the photonic field. This is justified if we assume the light-matter interaction vanishes when all valence mini-bands are completely filled.
\section{Purity of mixed states}
We provide here more details about the purity of the electronic reduced density matrix that is discussed in the manuscript.  By diagonalizing the light-matter Hamiltonian in Equation (3) in the main text, one obtains electron-photon eigenstates $\vert \Psi^{{\mathrm{(e-p})}}\rangle$ that belong to the Hilbert space, which is the product of the electron and photon Hilbert spaces. If one wants to focus on the electronic properties only, the standard approach is to consider the reduced density matrix defined as \cite{CohenTannoudji2020} $\hat{\rho} = \text{Tr}_{\text{phot}}\left(\vert \Psi^{{\mathrm{(e-p})}}\rangle \langle \Psi^{{\mathrm{(e-p})}}\vert\right)$, where the trace is here over the photonic degrees of freedom. 
The purity of a density matrix is defined as $\mathbb{P} = \text{Tr}_{\text{el}}\left(\hat{\rho}^2\right)$, where here the trace is over the electronic degrees of freedom. Indeed, when the reduced density matrix describes a pure state, the purity is equal to 1, since $\hat{\rho}^2 = \hat{\rho} $ in that case. This occurs for electron-photon states that are separable, namely of the form $\vert \Psi^{{\mathrm{(e-p})}}\rangle = \vert \psi^{(e)}\rangle\otimes\vert \phi^{(p)}\rangle$, implying that the purity is merely $\text{Tr}_{\text{el}}\left(\hat{\rho}^2\right) = \text{Tr}_{\text{el}}\left(\hat{\rho}\right) = \text{Tr}_{\text{el}}\left(\vert \psi^{{\mathrm{(e})}}\rangle \langle \psi^{{\mathrm{(e})}}\vert\right) = 1$. Instead, when the reduced density matrix is mixed, it can be written as $\hat{\rho} = \sum_{\lambda = 1}^{d}p_{\lambda}\vert \psi^{(e)}_{\lambda}\rangle \langle \psi^{(e)}_{\lambda}\vert$ where $\{\vert \psi^{(e)}_{\lambda}\rangle\}$ is an  orthonormal basis of an electronic Hilbert subspace of dimension $d$ and $p_{\lambda}$ is the probability of finding the state in $\vert\psi^{(e)}_{\lambda}\rangle$, with $0 \leq p_{\lambda} \leq 1$ and $\sum_{\lambda=1}^{d}p_{\lambda} = 1$. 
These conditions lead to $\text{Tr}_{\text{el}}\left(\hat{\rho}^2\right) = \sum_{\lambda}p^2_{\lambda} \leq \sum_{\lambda}p_{\lambda} = 1$. Moreover, the Cauchyâ€“Schwarz inequality gives $\sum_{\lambda}p^2_{\lambda} \geq 1/d$: hence, the purity reaches its minimum value $1/d$ if and only if $\forall \lambda, p_{\lambda} = 1/d$, which is known as a maximally mixed state. When the dimension $d$ tends to infinity, the purity tends to $0$. 
%\begin{figure}
%\includegraphics[width = 0.95\hsize]{Purity0.06.pdf}
%\includegraphics[scale=0.33]{Images/Main/TMD/all BZ.png}
%\caption{Electron-photon energy-momentum dispersion with electronic purity at $g = 0.06$. Same configuration as in Fig. 5 of the main text.}\label{fig:SM-TMD-Purity}
%\end{figure}\\

%Fig. \ref{fig:SM-TMD-Purity} shows electron-photon energy-momentum dispersion with electronic purity. Far from resonance (consulting Fig. 5 in main text) the states are nearly pure, while close to it the purity is about $50\%$.

\section{Effective electronic Hamiltonian in high purity regime}
In this section, we provide details about the effective electronic Hamiltonian obtained by adiabatic elimination of the photonic degree of freedom \cite{Ciuti2021,Arwas2023}. Moreover, we use this theory to compare to the topological diagram in Fig. 2 of the main text, where the electron purity is very close to 1. Fig. 2 in the manuscript has been calculated using the exact electron-photon eigenstates and the electron-photon Chern number. The topological phase boundary in Fig. 2 can be calculated approximately  by using the eigenstates of the effective electronic Hamiltonian and the traditional electron Chern number. Such approach works well in the regime considered in Fig. 2, where the electronic purity is close to 1.

Let us see here the details of the effective electronic Hamiltonian.
Eq. (3) in main text can be written as $\hat{\mathcal{H}} = \hat{\mathcal{H}}_0 + \hbar\omega_c\hat{a}^{\dagger}\hat{a} + D(\hat{a}+\hat{a}^{\dagger})^2 + \hat{V}_{xy}(\hat{a}+\hat{a}^{\dagger}) + \hat{V}_zi(\hat{a}-\hat{a}^{\dagger})$, where $\hat{\mathcal{H}}_0$ is the bare electronic Hamiltonian with its eigenstates $\vert\psi^0_{n\mathbf{k}}\rangle$ and energies $\epsilon^{0}_{n\mathbf{k}}$. The term $D = e^2|\mathbf{A}^{(xy)}|^2/(2m^{\star})$ is due  to the diamagnetic energy, while $\hat{V}_{xy}$ and $\hat{V}_z$ are respectively in-plane and out-of-plane coupling term with the following form:
\begin{equation}
    \begin{aligned}
        &\hat{V}_{xy} = -\frac{e}{m^{\star}}\mathbf{A}^{(xy)}\cdot\begin{pmatrix}
            \hat{\mathbf{p}} + \hbar\boldsymbol{\kappa}_- && 0 \\ 0 && \hat{\mathbf{p}} + \hbar\boldsymbol{\kappa}_-
        \end{pmatrix},\\
        &\hat{V}_z = \frac{\omega_c e A^{(z)} d}{2}\begin{pmatrix}
            1 && 0 \\ 0 && -1
        \end{pmatrix}.
    \end{aligned}
\end{equation}
By performing a Bogoliubov transformation for the photonic degrees of freedom, we can diagonalize the photonic part in the form $\hbar\omega_c\hat{a}^{\dagger}\hat{a} + D(\hat{a}+\hat{a}^{\dagger})^2 = \hbar\tilde{\omega}_c\hat{\alpha}^{\dagger}\hat{\alpha}$, where the dressed photon frequency  reads $\tilde{\omega}_c = \sqrt{\omega^2_c + 2\omega_ce^2|\mathbf{A}^{(xy)}|^2/(m^{\star}\hbar)}$ and the corresponding dressed boson operators are such that: $\hat{a} + \hat{a}^{\dagger} = \sqrt{\omega_c/\tilde{\omega}_c}(\hat{\alpha}+\hat{\alpha}^{\dagger})$ and $\hat{a} - \hat{a}^{\dagger} = \sqrt{\tilde{\omega}_c/\omega_c}(\hat{\alpha}-\hat{\alpha}^{\dagger})$. At the lowest order in perturbation theory, there is an effective coupling between different miniband states via an an intermediate state with a (dressed) cavity photon. Namely, we have 
%\begin{figure}[t!]
%\includegraphics[width = 0.95\hsize]{Compare_PD_g_twistang.pdf}
%\includegraphics[width = 0.95\hsize]{Compare_PD_g_Vz.pdf}
  %\caption{Electron-photon Chern numbers of the first three (top panel) and two (bottom panel) moir\'{e} minibands of the twisted TMD bilayer system but including the phase boundary (dashed lines) predicted by an effective electronic Hamiltonian (\ref{eq:SM:Heff}). Same configuration as in Fig. 2 of the main text.}
%\label{fig:SM-TMD-phase diagram}
%\end{figure}
\begin{equation}
 \vert\psi_{n\mathbf{k}}^0\rangle\vert 0\rangle \rightarrow \vert\psi_{\lambda\mathbf{k}}^0\rangle\vert 1\rangle \rightarrow \vert\psi_{n'\mathbf{k}}^0\rangle\vert 0\rangle.
\end{equation}
Such a process couples $\vert\psi^0_{n\mathbf{k}}\rangle$ and $\vert\psi^0_{n'\mathbf{k}}\rangle$ with a corresponding coupling energy:
\begin{equation}
    \Gamma_{n'n\mathbf{k}} \simeq \frac{1}{2}\sum_{\lambda\mathbf{k}}\left(\frac{V_{n'\lambda\mathbf{k}}V_{\lambda n\mathbf{k}}}{\epsilon^0_{\lambda\mathbf{k}}+\hbar\tilde{\omega}_c-\epsilon^0_{n'\mathbf{k}}} + \frac{V_{n'\lambda\mathbf{k}}V_{\lambda n\mathbf{k}}}{\epsilon^0_{\lambda\mathbf{k}}+\hbar\tilde{\omega}_c -\epsilon^0_{n\mathbf{k}}}\right),
\label{eq:SM:coeff}
\end{equation}
with $V_{n'n\mathbf{k}} = \langle \psi_{n'\mathbf{k}}^0\vert \beta \hat{V}_{xy} + \beta^{-1}\hat{V}_z \vert \psi_{n\mathbf{k}}^0 \rangle$ and $\beta = \sqrt{\omega_c/\tilde{\omega}_c}$. The effective electronic Hamiltonian reads:
\begin{equation}
    \hat{\mathcal{H}}_{\text{eff}} = \sum_{n,\mathbf{k}}\epsilon^0_{n\mathbf{k}}\vert\psi_{n\mathbf{k}}^0\rangle \langle\psi_{n\mathbf{k}}^0\vert + \sum_{n',n,\mathbf{k}}\Gamma_{n'n\mathbf{k}}\vert\psi_{n'\mathbf{k}}^0\rangle \langle\psi_{n\mathbf{k}}^0\vert.
\label{eq:SM:Heff}
\end{equation}
Equations (\ref{eq:SM:coeff}) and (\ref{eq:SM:Heff}) are valid only when the photon can be adiabatically eliminated. The agreement in Fig. 2 of the main text is excellent with only small variations at larger couplings due to the small deviations of the electron purity from unity with the parameters considered there.   
    
%Fig. \ref{fig:SM-TMD-phase diagram} compares phase diagrams of electron-photon Chern number with their effective counterparts. We observe that the latter is able to qualitatively capture the phase transition in both cases. 
\section{Electronic spectral function and spatial distribution}
In this section, we provide some details about the electron spectral function, a quantity that can be measured via Angular Resolved Photo-Emission Spectroscopy (ARPES) and the spatial distribution of the edge states, which can be measured for example via Scanning Tunneling Microscopy (STM) or Microwave Impedance Microscopy.
In this section, we will consider ribbon samples with open boundary conditions in the short direction.
The spatially resolved electronic density of state is given by:
\begin{widetext}
\begin{equation}
    A(\mathbf{k},\omega,r_1) = \sum_n\sum_{\nu = t,b}\int dr_2\left|\langle\Psi^{(e-p)}_{n\mathbf{k}}\vert r_1,r_2,\nu,\mathbf{k},0\rangle\right|^2\delta\left(\omega - \mathcal{E}^{(e-p)}_{n\mathbf{k}}\right),
\label{SM:eq-SF}
\end{equation}
\end{widetext}
where $r_1$ ($r_2$) corresponds to the position in the short (long) direction, $\nu = t,b$ describes the layer degree of freedom. Moreover, $\vert\Psi^{(e-p)}_{n\mathbf{k}}\rangle$ and $\mathcal{E}^{(e-p)}_{n\mathbf{k}}$ are respectively electron-photon eigenstates and energies of the Hamiltonian, while $\vert0\rangle$ is a zero-photon state. Note that the domain of $r_2$ is restricted to one unit cell. From (\ref{SM:eq-SF}), the spectral function is directly obtained by taking the integral $\int dr_1$ of the spectral function $A$. Detailed plots of this
observable are reported in Fig. \ref{SM-Fig-SF}, which has the same parameters as in Fig. 3 and 5 of the manuscript. 
\begin{figure}[t!]
\hspace{5pt}\includegraphics[width = 0.95\hsize]{SM_fig_2_1.pdf}
\includegraphics[width = 0.95\hsize]{SM_fig_2_2.pdf}
    \caption{Color plot of the electron spectral function  (amplitude normalized by its maximum value) corresponding to the off-resonant (top panels) and resonant (bottom panels) configurations considered in Fig. 3 and 5 of the manuscript, respectively.}
  \label{SM-Fig-SF}
\end{figure}\\
Given an electron-photon eigenstate $\vert \Psi^{(e-p)}_{n\mathbf{k}}\rangle$, its spatial distribution on the short direction (open boundary) is calculated by tracing over all the other degrees of freedom, namely: 
\begin{equation}
    \mathcal{D}^{(e-p)}_{n\mathbf{k}}(r_1) = \text{Tr}_{\text{phot},r_2,\nu}\left(\vert\Psi^{(e-p)}_{n\mathbf{k}}\rangle\langle\Psi^{(e-p)}_{n\mathbf{k}}\vert\right).
    \label{SM:eq-ep distri}
\end{equation}
However, equation (\ref{SM:eq-ep distri}) is not the electronic local density of states. Instead from (\ref{SM:eq-SF}) the electronic local density of states is calculated as:
\begin{equation}
\label{SM:eq-e distri}  
\begin{aligned}
    D^{(e)}_{n\mathbf{k}}(r_1) &= \int_{\mathcal{E}^{(e-p)}_{n\mathbf{k}}-\Delta\mathcal{E}}^{\mathcal{E}^{(e-p)}_{n\mathbf{k}}+\Delta\mathcal{E}} d\omega A(\mathbf{k},\omega,r_1)\\
    &\simeq\sum_{\nu = t,b}\int dr_2\left|\langle\Psi^{(e-p)}_{n\mathbf{k}}\vert r_1,r_2,\nu,\mathbf{k},0\rangle\right|^2\, .
\end{aligned} 
\end{equation}
The spatial distribution of the edge states created by the cavity coupling is reported in Fig. \ref{fig:SM-distribution}.
\begin{figure}[b!]
\includegraphics[width = 0.45\hsize]{SM_fig_3_1.pdf}
\includegraphics[width = 0.49\hsize]{SM_fig_3_2.pdf}\\
\includegraphics[width = 0.45\hsize]{SM_fig_3_3.pdf}
\includegraphics[width = 0.49\hsize]{SM_fig_3_4.pdf}
\caption{Spatial distribution of the states indicated in the energy-momentum diagram for the electron-photon eigenstates. The top panels correspond to no cavity coupling, while the botton panels correspond to $g_{\perp} = 0.35$. These plots correspond to the same configuration (perpendicular polarization) and parameters as in Fig. 5 of the manuscript.}
\label{fig:SM-distribution}
\end{figure}


%\begin{figure*}[t!]
%\includegraphics[width = 0.3\hsize]{spatial_0.0_band.pdf}
%\includegraphics[width = 0.318\hsize]{spatial_0.0_v1.pdf}\\
%\includegraphics[width = 0.3\hsize]{spatial_0.06_band.pdf}
%\includegraphics[width = 0.318\hsize]{spatial_0.06_all_p.pdf}
%\includegraphics[width = 0.318\hsize]{spatial_0.06_v1.pdf}
%\includegraphics[width = 0.318\hsize]{spatial_0.06_only 0.pdf}
%\caption{Spatial distribution of the states indicated in the energy-momentum diagram for the electron-photon eigenstates. The top panels correspond to no cavity coupling, while the botton panels correspond to 
 %$g = 0.06$. For the latter, the middle plot corresponds to the spatial distribution tracing over all photonic degrees of freedom. The right plot instead show the spatial distribution corresponding to the electron spectral function  (only the zero-photon subspace contributes). }
%\label{fig:SM-distribution-v2}
%\end{figure*}
\bibliography{Bib.bib}
\end{document}

