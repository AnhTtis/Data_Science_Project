\section{Outline}

\subsection{Condensed outline}
\begin{outline}
    \1 Title: Enabling fairness for traders competing on speed in  environments with unpredictable latency \radhika{perhaps too long and wordy: maybe ``Fair Trading in Environments with Unpredictable Latency'' or ``Response Time Fairness in Cloud-hosted Financial Exchanges''}
    \1 Introduction
        \2 Purpose
            \3 Why is what we are doing important
            \3 What is cool?
            \3 What are our results?
            \3 \pg{What is the selling point?}
    \1 Background and Motivation
        \2 Key points
            \3 Financial exchanges are moving to the cloud
            \3 Model of competing speed trades
            \3 How people solve it currently
            \3 Broad point Hard to provide fairness for speed trading in unequal latency environment
            \3 Insight: we can solve without actually ensuring equal delivery
            \3 One way latency model\pg{why include it}
            \3 Assumptions and Goals and Non Goals \pg{Global network.}
            \3 \pg{related work?}
    \1 Design
        \2 Key points
            \3 Strawman + challenges
                \4 \pg{Impossibility result}
            \3 DBO on its own: Talk about equal inter-delivery time. Just DBO is good.
            \3 DBO + Batching and Pacing: 
                \4  Theorem: Talk about that is the minimum property you need 
            \3 Ordering Buffer
            \3 Section on analysis, parameter setting
                \4 \pg{Trades based on different data points?}
                \4 Latency: Theoretical bound and what our system achieves
                \4 Straggler mitigation
                \4 Impact of C and delta, heartbeats
                \4 Trades > $\delta$: 
                \4 Is batching and pacing necessary.
                \4 Communication with the outside world, preventing frontrunning, other attack earliest submission
                \4 Impact of clock drift rate 
                \4 Impact of losses \pg{All loses are handled out of band. If a market data is lost, retransmitted out of band does not hit delivery clock, If a trade is lost}
                \4 Impact of RB->MP latency: \pg{Maybe say that what if RB cannot be implemented close to the MP NIC}
                \4 What if RB/OB overflows
    \1 Implementation and Practical Challenges 
        \2 Question: To what extent should we go into details on the Blue Field and the cloud implementation. 
            \3 Help from Eashan, Frank and Ilias required.
            \3 \radhika{An alternative is to split this into two sections. First one is ``practical challenges'' that tackles the question you have below on the properties you need. It could also be a more general section where you are not tying yourself to a specific implementation e.g. based on smartNICs. Perhaps some of the analysis/parameter setting points that are less theoretical and more empirical/implementation oriented can also come under this section. The following section can be the implementation section where we talk about the BlueField and the cloud implementation.}
        \2 Purpose
            \3 How do you implement OB and RB and what properties should they have. Specific Blue field implementation.
        \2 Key points to make
            \3 RB: Should be close to the MP, RB should have access to a clock and maintain the delivery clock, mark and modify packets, Hold and release packets at the specified time. Trusted RB. \pg{Is RB bump in the wire?}
            \3 OB: Handling so many heartbeats, multi-threaded operation. Trusted OV
            \3 Blue field implementation
    \1 Evaluation
        \2 Key points to make
            \3 Blue field: fix RTs, two MPs, compare Direct + DBO, DBO+LRTF, Direct delivery, + anythgin you can think of
            \3 Cloud: 10 MPs, Response Times taken from a distribution (burdisch paper https://www.bis.org/publ/work955.pdf), Show impact of heartbeats, delta and C on latency and fairnessÂ \3 Simulation: Large scale, ideal latency comparison, impact of large number of participants, straggler mitigation
    \1 Discussion
        \2 Multiple exchanges
        \2 Limitations of the compute model
        \2 Failures 
        \2 other settings where applicable
    
                 

\end{outline}

\subsection{All thoughts}


\begin{outline}
    \1 Title: Enabling fairness for traders competing on speed in  environments with unpredictable latency
    \1 Introduction
        \2 Purpose
            \3 Why is what we are doing important
            \3 What is cool?
            \3 What are our results?
    \1 Background and Motivation
        \2 Question: Should there be a separate CES for each asset class. \pg{How does this work relate to the work in the distributed systems space (talk to Lamport, Jay Lorch)} \pg{we should talk to some HFT participant. Talk about how jitter and latency differences kill competition. Ensuring latency on average is not enough. Talk about fair racing in the burdisch model.}
        \2 Purpose
            \3 Necessary background information for people to understand the problem and the challenges associated.
        \2 Key points to make (not necessarily in order)
            \3 References: Based on our discussion with three major exchanges
            \3 Background on how financial exchanges operate today, emphasis on speed based traders, and how fairness is important, talk about which data is communicated and how. (maybe a forward pointer to external streams)
            \3 Financial exchanges are considering moving to the cloud. Benefits include lower cost, ease of usage, scalability. (Minor talk about how all financial exchanges located within the same datacenter might improve things for participants [same MPs machines for different exchanges will be able to communicate with other faster]).
            \3 Unpredictable latencies make fairness or rather simultaneous delivery of data challenging
            \3 Previous solutions: clock syncronization (even with perfect clock sync we dont solve the problem, impossibility theorem on simultaneous delivery of data, high latency on average problem walk through an example? Past work on two generals problem) and financial systems based solutions. Why is replicating the current setup not possible? Why setting a deadline is hard (increases latency).
            \3 Non Goals We are not attempting to provide an answer to how networking and communication should be handled in such a scenario. We are also not going to bother which reliability of the CES and the MP machines. No mention of losses. \pg{Even in current system losses are handled out of band.}
            \3 Goals/Advantages: Provide fairness in an uncertain network environment. Overall system latency is critical. No changes to how the CES and the MPs operate. No looking at the data. Trust model: The CES cannot trust the MPs. No collusion between MP attacks possible (no front running essentially). Plug and play? While we dont care about loss recovery, losses shouldn't slow down the entire system.
            \3 Other kinds of logical clocks? Here or later?
            \3 \eg{Other use cases of RTF?}
    \1 Design
        \2 Question \pg{(flow is still unclear?), how do logical clocks fit into this stuff, Justify the compute model? What should be the definition of fairness be (ordering for two trades generated using two different points). Should we have a theorem proving the minimum bound on latency for such fairness. Maybe show equivalence of response time fairness to equal latency system.}
        \2 Key Points to make
            \3 Key Insight: Trades are not generated in isolation, look at market data and trade ordering together
                \4 Introduce the basic architecture, compute model and definition of response time fairness. Single response time, a single machine will be relaxed later. Assumptions about network.
                \4 Not all trades fit this model 1) External data streams 2) Trades generated using multiple data points
                \4 Challenges response time is not known
                \4 Definition in words, later define properly
            \3 Solution
                \4 Part 1: Simple scenario with two participants and fixed latency, how do we solve this?
                \4 terminology
                \4 Introduce DBO
                \4 Show DBO alone doesn't show when delivery times are not consistent
                \4 Define fairness and derive minimum properties for delivery times and show it works
                \4 Strong fairness, impossibility result
                \4 approximate fairness, Include S1, talk about a PID controller 
                \4 limited fairness, Include S2
                \4 How the OB works and it orders stuff, heartbeats. Latency variations on the reverse path.
            \3 Miscellaneous design concerns
                \4 Stopping front running attacks
                \4 Straggler mitigation
                \4 Impact of RB to MP latency: \pg{if we can measure can we correct it. Prbably not. HArd to maintain inter-delivery time properties. we can still quantify impacy of RB->Mp latency by assuming bounds.}
                \4 Trades generated using multiple data points. What does response time fairness mean in this case and 
                \4 Allowing external participants
                \4 Impact of clock drift rate.
    \1 Implementation and Practical Challenges 
        \2 Question: To what extent should we go into details on the Blue Field and the cloud implementation. 
            \3 Help from Eashan, Frank and Ilias required.
        \2 Purpose
            \3 How do you implement OB and RB and what properties should they have. Specific Blue field implementation.
        \2 Key points to make
            \3 RB: Should be close to the MP, RB should have access to a clock and maintain the delivery clock, mark and modify packets, Hold and release packets at the specified time. Trusted RB
            \3 OB: Handling so many heartbeats, multi-threaded operation. Trusted OV
            \3 Blue field implementation
    \1 Evaluation
        \2 Questions: \pg{Eashan and Ilias can you add here?} \pg{Handle RB->MP latency}
        \2 key points to make
            \3 Three subsections for three implementations (blue field, cloud, simulation). For each think about what kind of experiments would we and can we show. Eashan a good starting point is to think about the purpose of each one. Think about specific experiments and graphs.
                \4 BlueField. Purpose: Real hardware feasibility. Capability: Can show simple experiments with two participants. Graphs?
                \4 Cloud. Purpose: Advantage of our system in real cloud settings. I think we should do a single experiment with 5/10 participants. Graphs? Evaluate different parts of the design.
                \4 Simulations. Purpose: System working with a large number of participants. Establish micro points about our design here. Include s2 from hotnets paper here. Graphs? Some sort of optimal baseline based on a oracle? What people use simulations for: 1) Scale 2) Sensitivity Analysis 3) Insights (Impact of various parts of design e.g., heart beat duration, comparison with some sort of an oracle scheme, break down of latency on our system, impact of delta and C on the latency distribution of the system).
            \3 Evaluation metrics
        \2 Graphs: Trying to answer why use our system (better fairness numbers) and what the limitations are (latency in large-scale experiment). Trust issues resolved by hardware implementation.
            \3 Simulation: start with simulation heatmaps from HotNets paper showing improved fairness numbers for our schemes. Cover all new schemes we are proposing against Cloudex and direct data delivery. Skip latency numbers. Run with only 2 MPs.
            \3 Cloud: Run a single experiment with 5-10 MPs. Skip fairness numbers.
                \4 Show End-to-End latency (from generation to trade being forwarded to ME minus response time) over time for one MP. Run setup for 10min. We could add lines for all schemes on one graph. Can be used to show regions of spikes where we had stragglers/latency spikes. Additionally shows stability of schemes.
                \4 Show the CDF of above graph. Shows how much additional latency is introduced by our schemes in general over other schemes.
            \3 Bluefield: 
                \4 Compare DBO to the ideal fairness number. Run experiment by sampling Response time from a distribution. Get ideal response time fairness number and get fairness number due to various schemes. Show bar graph for a pair of MPs.
                \4 Show end-to-end latency graph for 1 MP and compare with cloud. Shows any performance change against cloud.
            \3 Others?:
                \4 Study about RB to MP latency - compare latency and fairness numbers between Bluefield and Cloud implementation.
                \4 Show fairness numbers in Cloud implementation?
                \4 Show how, on changing hyperparameters, performance changes. (end-to-end latency over time and fairness).
    \1 Discussion and Limitation
        \2 Purpose
            \3 Answer Potential questions a reviewer might have
            \3 Future directions
        \2 Key Points to make
            \3 Fundamental limitation slowest network latency slows down the entire system. \pg{Discuss tradeoff our system offers?}
            \3 RB OB failure
            \3 Limitations of the compute model
            \3 Impact of other streams such as news
            \3 Other considerations: Multicast, HPC cluster, reliability, etc.
            \3 Multi exchange scenario, multiple sources of information
            \3 Multi cloud scenario
            \3 Other metrics of fairness: Resource Fairness
            \3 Other settings where this is applicable
            \3 Speculative execution to leave out particcipants that are not placing trades.
    \1 \pg{Concerns raised by HotNets Reviewers}
        \2 Impact of RB->MP latency
            \3 Answer: We are at the NIC, Boundaru of MP is the NIC. Additionally analyse the impact of RB->MP latency in our system.
        \2 Why would exchanges move to the cloud
            \3 Answer: Its already happening. Talk about the partnerships that already happened.
        \2 Collusion attacks.
            \3 Answer: Have a specific sub section
        \2 External streams of market data
            \3 There are much more infrequent events. Fairness w.r.t. such streams is not required.
        \2 Writing and Notation is complicated
            \3 Answer: Explain in words to the extent possible. Ask Radhika.
\end{outline}